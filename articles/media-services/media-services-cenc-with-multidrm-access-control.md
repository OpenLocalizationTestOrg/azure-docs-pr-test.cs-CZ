---
title: "Šifrování CENC s více technologiemi DRM a řízením přístupu: referenční návrhu a implementace v Azure a Azure Media Services | Microsoft Docs"
description: "Informace o tom, jak toolicensing hello Microsoft® technologie Smooth Streaming klienta portování Kit."
services: media-services
documentationcenter: 
author: willzhan
manager: cfowler
editor: 
ms.assetid: 7814739b-cea9-4b9b-8370-538702e5c615
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: willzhan;kilroyh;yanmf;juliako
ms.openlocfilehash: 033fb618650c4fbe9069d467159a8734da759bba
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="cenc-with-multi-drm-and-access-control-a-reference-design-and-implementation-on-azure-and-azure-media-services"></a><span data-ttu-id="25233-103">CENC využívající Multi-DRM a Access Control: Referenční návrh a implementace v prostředí Azure a Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="25233-103">CENC with Multi-DRM and Access Control: A Reference Design and Implementation on Azure and Azure Media Services</span></span>
 
## <a name="introduction"></a><span data-ttu-id="25233-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="25233-104">Introduction</span></span>
<span data-ttu-id="25233-105">Je dobře známé je složité úlohy toodesign a sestavení DRM subsystém pro OTT nebo online řešení datového proudu.</span><span class="sxs-lookup"><span data-stu-id="25233-105">It is well known that it is a complex task toodesign and build a DRM subsystem for an OTT or online streaming solution.</span></span> <span data-ttu-id="25233-106">A je běžné praxi pro operátory, online toooutsource poskytovatelů videa poskytovatelé tuto část toospecialized DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-106">And it is a common practice for operators/online video providers toooutsource this part toospecialized DRM service providers.</span></span> <span data-ttu-id="25233-107">Hello cílem tohoto dokumentu je toopresent odkaz návrhu a implementace začátku do konce DRM subsystému v OTT nebo streamování řešení online.</span><span class="sxs-lookup"><span data-stu-id="25233-107">hello goal of this document is toopresent a reference design and implementation of end-to-end DRM subsystem in OTT or online streaming solution.</span></span>

<span data-ttu-id="25233-108">čtečky Hello cílem tohoto dokumentu se technici práce v subsystému DRM OTT nebo streamování nebo více-screen řešení online nebo všechny zájem o DRM subsystém čtečky.</span><span class="sxs-lookup"><span data-stu-id="25233-108">hello targeted readers of this document are engineers working in DRM subsystem of OTT or online streaming/multi-screen solutions, or any readers interested in DRM subsystem.</span></span> <span data-ttu-id="25233-109">Hello předpokladem je, že čtečky obeznámeni s alespoň jedním z technologiemi DRM hello na trhu hello, jako je například technologie PlayReady, Widevine, FairPlay nebo Adobe Access.</span><span class="sxs-lookup"><span data-stu-id="25233-109">hello assumption is that readers are familiar with at least one of hello DRM technologies on hello market, such as PlayReady, Widevine, FairPlay or Adobe Access.</span></span>

<span data-ttu-id="25233-110">Pomocí DRM jsme také zahrnovat CENC (Common Encryption) s více technologiemi DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-110">By DRM, we also include CENC (Common Encryption) with multi-DRM.</span></span> <span data-ttu-id="25233-111">Hlavní trend v online streamování a OTT odvětví je toouse CENC s více-native technologiemi DRM na různých platformách klienta, což je shift z předchozí trend hello pomocí jednoho DRM a jeho klientskou sadou SDK pro různé platformy klienta.</span><span class="sxs-lookup"><span data-stu-id="25233-111">A major trend in online streaming and OTT industry is toouse CENC with multi-native-DRM on various client platforms, which is a shift from hello previous trend of using a single DRM and its client SDK for various client platforms.</span></span> <span data-ttu-id="25233-112">Při použití šifrování CENC s více native DRM, technologie PlayReady a Widevine jsou šifrované podle hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specifikace.</span><span class="sxs-lookup"><span data-stu-id="25233-112">When using CENC with multi-native-DRM, both PlayReady and Widevine are encrypted per hello [Common Encryption (ISO/IEC 23001-7 CENC)](http://www.iso.org/iso/home/store/catalogue_ics/catalogue_detail_ics.htm?csnumber=65271/) specification.</span></span>

<span data-ttu-id="25233-113">Hello CENC s více technologiemi DRM výhody následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="25233-113">hello benefits of CENC with multi-DRM are as follows:</span></span>

1. <span data-ttu-id="25233-114">Snižuje náklady, protože zpracování jedné šifrování se používá cílení na různých platformách s nativní technologiemi DRM; šifrování</span><span class="sxs-lookup"><span data-stu-id="25233-114">Reduces encryption cost since a single encryption processing is used targeting different platforms with its native DRMs;</span></span>
2. <span data-ttu-id="25233-115">Snižuje hello náklady na správu šifrované prostředky, protože je vyžadována pouze jedna kopie šifrované prostředků;</span><span class="sxs-lookup"><span data-stu-id="25233-115">Reduces hello cost of managing encrypted assets since only a single copy of encrypted assets is needed;</span></span>
3. <span data-ttu-id="25233-116">Eliminuje DRM klientů na licence náklady, protože nativního klienta DRM hello je obvykle volné v jeho nativní platforma.</span><span class="sxs-lookup"><span data-stu-id="25233-116">Eliminates DRM client licensing cost since hello native DRM client is usually free on its native platform.</span></span>

<span data-ttu-id="25233-117">Microsoft byl aktivní vykonavatel DASH a šifrování CENC společně s některé přehrávače hlavní odvětví.</span><span class="sxs-lookup"><span data-stu-id="25233-117">Microsoft has been an active promoter of DASH and CENC together with some major industry players.</span></span> <span data-ttu-id="25233-118">Microsoft Azure Media Services má poskytování podpory DASH a šifrování CENC.</span><span class="sxs-lookup"><span data-stu-id="25233-118">Microsoft Azure Media Services has been providing support of DASH and CENC.</span></span> <span data-ttu-id="25233-119">Poslední oznámení, najdete v tématu Mingfei na blozích: [služeb doručování licence Google Widevine uvedení ve službě Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), a [Azure Media Services přidá balení Google Widevine pro doručení datový proud více technologiemi DRM](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span><span class="sxs-lookup"><span data-stu-id="25233-119">For recent announcements, please see Mingfei’s blogs: [Announcing Google Widevine license delivery services in Azure Media Services](https://azure.microsoft.com/blog/announcing-general-availability-of-google-widevine-license-services/), and [Azure Media Services adds Google Widevine packaging for delivering multi-DRM stream](https://azure.microsoft.com/blog/azure-media-services-adds-google-widevine-packaging-for-delivering-multi-drm-stream/).</span></span>  

### <a name="overview-of-this-article"></a><span data-ttu-id="25233-120">Přehled tohoto článku</span><span class="sxs-lookup"><span data-stu-id="25233-120">Overview of this article</span></span>
<span data-ttu-id="25233-121">cílem Hello Tento článek obsahuje následující hello:</span><span class="sxs-lookup"><span data-stu-id="25233-121">hello goal of this article includes hello following:</span></span>

1. <span data-ttu-id="25233-122">Poskytuje referenční návrhu podsystému DRM pomocí šifrování CENC s více technologiemi DRM;</span><span class="sxs-lookup"><span data-stu-id="25233-122">Provides a reference design of DRM subsystem using CENC with multi-DRM;</span></span>
2. <span data-ttu-id="25233-123">Poskytuje implementaci odkaz na platformě Microsoft Azure nebo Azure Media Services;</span><span class="sxs-lookup"><span data-stu-id="25233-123">Provides a reference implementation on Microsoft Azure/Azure Media Services platform;</span></span>
3. <span data-ttu-id="25233-124">Popisuje některé témata týkající se návrhu a implementace.</span><span class="sxs-lookup"><span data-stu-id="25233-124">Discusses some design and implementation topics.</span></span>

<span data-ttu-id="25233-125">V článku hello obsahuje "více technologiemi DRM" hello následující:</span><span class="sxs-lookup"><span data-stu-id="25233-125">In hello article, “multi-DRM” covers hello following:</span></span>

1. <span data-ttu-id="25233-126">Microsoft PlayReady</span><span class="sxs-lookup"><span data-stu-id="25233-126">Microsoft PlayReady</span></span>
2. <span data-ttu-id="25233-127">Google Widevine</span><span class="sxs-lookup"><span data-stu-id="25233-127">Google Widevine</span></span>
3. <span data-ttu-id="25233-128">Apple FairPlay</span><span class="sxs-lookup"><span data-stu-id="25233-128">Apple FairPlay</span></span> 

<span data-ttu-id="25233-129">Hello následující tabulka shrnuje hello nativní platforma/nativní aplikaci a prohlížeče nepodporuje každý DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-129">hello following table summarizes hello native platform/native app, and browsers supported by each DRM.</span></span>

| <span data-ttu-id="25233-130">**Klientské platformy**</span><span class="sxs-lookup"><span data-stu-id="25233-130">**Client Platform**</span></span> | <span data-ttu-id="25233-131">**Podpora nativní DRM**</span><span class="sxs-lookup"><span data-stu-id="25233-131">**Native DRM Support**</span></span> | <span data-ttu-id="25233-132">**Aplikace nebo prohlížeče**</span><span class="sxs-lookup"><span data-stu-id="25233-132">**Browser/App**</span></span> | <span data-ttu-id="25233-133">**Streamování formáty**</span><span class="sxs-lookup"><span data-stu-id="25233-133">**Streaming Formats**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="25233-134">**Inteligentní televizní přijímače, operátor externích zařízení, externích OTT zařízení**</span><span class="sxs-lookup"><span data-stu-id="25233-134">**Smart TVs, operator STBs, OTT STBs**</span></span> |<span data-ttu-id="25233-135">PlayReady především se stává, nebo Widevine, nebo jiné</span><span class="sxs-lookup"><span data-stu-id="25233-135">PlayReady primarily, and/or Widevine, and/or other</span></span> |<span data-ttu-id="25233-136">Linux, Opera, WebKit, jiné</span><span class="sxs-lookup"><span data-stu-id="25233-136">Linux, Opera, WebKit, Other</span></span> |<span data-ttu-id="25233-137">Různými formáty</span><span class="sxs-lookup"><span data-stu-id="25233-137">Various formats</span></span> |
| <span data-ttu-id="25233-138">**Zařízení s Windows 10 (počítače s Windows, tablety s Windows, Windows Phone, Xbox)**</span><span class="sxs-lookup"><span data-stu-id="25233-138">**Windows 10 devices (Windows PC, Windows Tablets, Windows Phone, Xbox)**</span></span> |<span data-ttu-id="25233-139">PlayReady</span><span class="sxs-lookup"><span data-stu-id="25233-139">PlayReady</span></span> |<span data-ttu-id="25233-140">MS Edge/IE11/EME</span><span class="sxs-lookup"><span data-stu-id="25233-140">MS Edge/IE11/EME</span></span><br/><br/><br/><span data-ttu-id="25233-141">UWP</span><span class="sxs-lookup"><span data-stu-id="25233-141">UWP</span></span> |<span data-ttu-id="25233-142">DASH (pro HLS, technologie PlayReady není podporována.)</span><span class="sxs-lookup"><span data-stu-id="25233-142">DASH (For HLS, PlayReady is not supported)</span></span><br/><br/><span data-ttu-id="25233-143">DASH, technologie Smooth Streaming (HLS pro, PlayReady není podporována.)</span><span class="sxs-lookup"><span data-stu-id="25233-143">DASH, Smooth Streaming (For HLS, PlayReady is not supported)</span></span> |
| <span data-ttu-id="25233-144">**Zařízení se systémem Android (telefon, Tablet, TV)**</span><span class="sxs-lookup"><span data-stu-id="25233-144">**Android devices (Phone, Tablet, TV)**</span></span> |<span data-ttu-id="25233-145">Widevine</span><span class="sxs-lookup"><span data-stu-id="25233-145">Widevine</span></span> |<span data-ttu-id="25233-146">Chrome nebo EME</span><span class="sxs-lookup"><span data-stu-id="25233-146">Chrome/EME</span></span> |<span data-ttu-id="25233-147">DASH, HLS</span><span class="sxs-lookup"><span data-stu-id="25233-147">DASH,HLS</span></span> |
| <span data-ttu-id="25233-148">**iOS (iPhone, iPad), klienty OS X a Apple TV**</span><span class="sxs-lookup"><span data-stu-id="25233-148">**iOS (iPhone, iPad), OS X clients and Apple TV**</span></span> |<span data-ttu-id="25233-149">FairPlay</span><span class="sxs-lookup"><span data-stu-id="25233-149">FairPlay</span></span> |<span data-ttu-id="25233-150">Safari 8 +/ EME</span><span class="sxs-lookup"><span data-stu-id="25233-150">Safari 8+/EME</span></span> |<span data-ttu-id="25233-151">HLS</span><span class="sxs-lookup"><span data-stu-id="25233-151">HLS</span></span> |


<span data-ttu-id="25233-152">S ohledem hello aktuální stav nasazení pro každý DRM, služba obvykle mají toomake technologiemi DRM tooimplement 2 nebo 3 se vyřešit všechny hello typy koncových bodů v hello nejlepší způsob, jak.</span><span class="sxs-lookup"><span data-stu-id="25233-152">Considering hello current state of deployment for each DRM, a service will typically want tooimplement 2 or 3 DRMs toomake sure you address all hello types of endpoints in hello best way.</span></span>

<span data-ttu-id="25233-153">Je kompromis mezi hello složitost hello služby logiky a složitost hello na hello klientské straně tooreach určitá úroveň uživatelské prostředí na hello různých klientů.</span><span class="sxs-lookup"><span data-stu-id="25233-153">There is a tradeoff between hello complexity of hello service logic and hello complexity on hello client side tooreach a certain level of user experience on hello various clients.</span></span>

<span data-ttu-id="25233-154">toomake váš výběr, mějte na paměti tyto skutečnosti:</span><span class="sxs-lookup"><span data-stu-id="25233-154">toomake your selection, keep in mind these facts:</span></span>

* <span data-ttu-id="25233-155">PlayReady je nativně implementované v každé zařízení s Windows, na některých zařízeních se systémem Android a dostupný prostřednictvím sady SDK softwaru na prakticky jakékoli platformě</span><span class="sxs-lookup"><span data-stu-id="25233-155">PlayReady is natively implemented in every Windows device, on some Android devices, and available through software SDKs on virtually any platform</span></span>
* <span data-ttu-id="25233-156">Widevine je nativně implementována v každé zařízení se systémem Android, Chrome a některá další zařízení</span><span class="sxs-lookup"><span data-stu-id="25233-156">Widevine is natively implemented in every Android device, in Chrome, and in some other devices</span></span>
* <span data-ttu-id="25233-157">FairPlay je k dispozici jenom v iOS a Mac OS klienty nebo prostřednictvím iTunes.</span><span class="sxs-lookup"><span data-stu-id="25233-157">FairPlay is available only on iOS and Mac OS clients or through iTunes.</span></span>

<span data-ttu-id="25233-158">Proto by byl typické více technologiemi DRM:</span><span class="sxs-lookup"><span data-stu-id="25233-158">So a typical multi-DRM would be:</span></span>

* <span data-ttu-id="25233-159">Možnost 1: PlayReady a Widevine</span><span class="sxs-lookup"><span data-stu-id="25233-159">Option 1: PlayReady and Widevine</span></span>
* <span data-ttu-id="25233-160">Možnost 2: PlayReady, Widevine a FairPlay</span><span class="sxs-lookup"><span data-stu-id="25233-160">Option 2: PlayReady, Widevine and FairPlay</span></span>

## <a name="a-reference-design"></a><span data-ttu-id="25233-161">Návrh odkazu</span><span class="sxs-lookup"><span data-stu-id="25233-161">A reference design</span></span>
<span data-ttu-id="25233-162">V této části jsme nabídne odkaz návrhu, což je tooimplement lhostejné tootechnologies používá ji.</span><span class="sxs-lookup"><span data-stu-id="25233-162">In this section, we will present a reference design which is agnostic tootechnologies used tooimplement it.</span></span>

<span data-ttu-id="25233-163">Subsystém DRM může obsahovat hello následující součásti:</span><span class="sxs-lookup"><span data-stu-id="25233-163">A DRM subsystem may contain hello following components:</span></span>

1. <span data-ttu-id="25233-164">Správa klíčů</span><span class="sxs-lookup"><span data-stu-id="25233-164">Key management</span></span>
2. <span data-ttu-id="25233-165">Balení DRM</span><span class="sxs-lookup"><span data-stu-id="25233-165">DRM packaging</span></span>
3. <span data-ttu-id="25233-166">Doručování licencí DRM</span><span class="sxs-lookup"><span data-stu-id="25233-166">DRM license delivery</span></span>
4. <span data-ttu-id="25233-167">Kontrola oprávnění</span><span class="sxs-lookup"><span data-stu-id="25233-167">Entitlement check</span></span>
5. <span data-ttu-id="25233-168">Ověřování/autorizace</span><span class="sxs-lookup"><span data-stu-id="25233-168">Authentication/authorization</span></span>
6. <span data-ttu-id="25233-169">Player</span><span class="sxs-lookup"><span data-stu-id="25233-169">Player</span></span>
7. <span data-ttu-id="25233-170">Původ nebo CDN</span><span class="sxs-lookup"><span data-stu-id="25233-170">Origin/CDN</span></span>

<span data-ttu-id="25233-171">Hello následující diagram znázorňuje hello vysoké úrovně interakce mezi součástmi hello v subsystému DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-171">hello following diagram illustrates hello high level interaction among hello components in a DRM subsystem.</span></span>

![Subsystému DRM s CENC](./media/media-services-cenc-with-multidrm-access-control/media-services-generic-drm-subsystem-with-cenc.png)

<span data-ttu-id="25233-173">Existují tři základní "vrstvy" hello návrhu:</span><span class="sxs-lookup"><span data-stu-id="25233-173">There are three basic “layers” in hello design:</span></span>

1. <span data-ttu-id="25233-174">Zálohování vrstvy office (v černé), které nejsou vystaveny externě;</span><span class="sxs-lookup"><span data-stu-id="25233-174">Back office layer (in black) which are not exposed externally;</span></span>
2. <span data-ttu-id="25233-175">"DMZ" vrstvu (modrá), která obsahuje všechny koncové body hello čelí veřejné;</span><span class="sxs-lookup"><span data-stu-id="25233-175">“DMZ” layer (blue) containing all hello endpoints facing public;</span></span>
3. <span data-ttu-id="25233-176">Veřejné internetové vrstvy (světla modrá) obsahující CDN a přehrávače s přenosy přes veřejný Internet.</span><span class="sxs-lookup"><span data-stu-id="25233-176">Public Internet layer (light blue) containing CDN and players with traffic across public Internet.</span></span>

<span data-ttu-id="25233-177">Měla by existovat nástroj správy obsahu, k nimž ochrany DRM, bez ohledu na to je statické nebo dynamické šifrování.</span><span class="sxs-lookup"><span data-stu-id="25233-177">There should be a content management tool for controlling DRM protection, regardless it is static or dynamic encryption.</span></span> <span data-ttu-id="25233-178">Hello vstupy pro šifrování DRM by měla obsahovat:</span><span class="sxs-lookup"><span data-stu-id="25233-178">hello inputs for DRM encryption should include:</span></span>

1. <span data-ttu-id="25233-179">Video obsah MBR;</span><span class="sxs-lookup"><span data-stu-id="25233-179">MBR video content;</span></span>
2. <span data-ttu-id="25233-180">Klíč obsahu;</span><span class="sxs-lookup"><span data-stu-id="25233-180">Content key;</span></span>
3. <span data-ttu-id="25233-181">Licence získání adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25233-181">License acquisition URLs.</span></span>

<span data-ttu-id="25233-182">Během doby přehrávání toku na vysoké úrovni hello je:</span><span class="sxs-lookup"><span data-stu-id="25233-182">During playback time, hello high level flow is:</span></span>

1. <span data-ttu-id="25233-183">Uživatel je ověřen;</span><span class="sxs-lookup"><span data-stu-id="25233-183">User is authenticated;</span></span>
2. <span data-ttu-id="25233-184">Autorizační token se vytvoří pro uživatele hello;</span><span class="sxs-lookup"><span data-stu-id="25233-184">Authorization token is created for hello user;</span></span>
3. <span data-ttu-id="25233-185">DRM chráněný obsah (manifestu) je stažené tooplayer;</span><span class="sxs-lookup"><span data-stu-id="25233-185">DRM protected content (manifest) is downloaded tooplayer;</span></span>
4. <span data-ttu-id="25233-186">Přehrávač odešle licenčních pořízení požadavek toolicense serverů společně s klíče ID a autorizační token.</span><span class="sxs-lookup"><span data-stu-id="25233-186">Player submits license acquisition request toolicense servers together with key ID and authorization token.</span></span>

<span data-ttu-id="25233-187">Před přesunutí dalším tématu toohello pár slov o hello návrhu služby správy klíčů.</span><span class="sxs-lookup"><span data-stu-id="25233-187">Before moving toohello next topic, a few words about hello design of key management.</span></span>

| <span data-ttu-id="25233-188">**ContentKey – prostředek**</span><span class="sxs-lookup"><span data-stu-id="25233-188">**ContentKey–to-Asset**</span></span> | <span data-ttu-id="25233-189">**Scénář**</span><span class="sxs-lookup"><span data-stu-id="25233-189">**Scenario**</span></span> |
| --- | --- |
| <span data-ttu-id="25233-190">1 – 1</span><span class="sxs-lookup"><span data-stu-id="25233-190">1–to-1</span></span> |<span data-ttu-id="25233-191">nejjednodušším případě Hello.</span><span class="sxs-lookup"><span data-stu-id="25233-191">hello simplest case.</span></span> <span data-ttu-id="25233-192">Poskytuje nejlepší kontrolu hello.</span><span class="sxs-lookup"><span data-stu-id="25233-192">It provides hello finest control.</span></span> <span data-ttu-id="25233-193">Ale obecně výsledkem hello nejvyšší licence doručení náklady.</span><span class="sxs-lookup"><span data-stu-id="25233-193">But this generally results in hello highest license delivery cost.</span></span> <span data-ttu-id="25233-194">Požadavek na minimální jednu licenci je požadované pro každý chráněný prostředek.</span><span class="sxs-lookup"><span data-stu-id="25233-194">At minimum one license request is required for each protected asset.</span></span> |
| <span data-ttu-id="25233-195">1 –-mnoho</span><span class="sxs-lookup"><span data-stu-id="25233-195">1–to-Many</span></span> |<span data-ttu-id="25233-196">Můžete použít hello obsahu stejný klíč pro více prostředků.</span><span class="sxs-lookup"><span data-stu-id="25233-196">You could use hello same content key for multiple assets.</span></span> <span data-ttu-id="25233-197">Například pro všechny prostředky hello logické skupiny, jako je genre nebo podmnožinu genre (nebo gen film), můžete použít jeden klíč obsahu.</span><span class="sxs-lookup"><span data-stu-id="25233-197">For example, for all hello assets in a logical group such as a genre or subset of genre (or Movie Gene), you could use a single content key.</span></span> |
| <span data-ttu-id="25233-198">N – 1</span><span class="sxs-lookup"><span data-stu-id="25233-198">Many–to-1</span></span> |<span data-ttu-id="25233-199">Více klíčů k obsahu, je potřeba pro každý prostředek.</span><span class="sxs-lookup"><span data-stu-id="25233-199">Multiple content keys are needed for each asset.</span></span> <br/><br/><span data-ttu-id="25233-200">Pokud potřebujete tooapply dynamické ochranu CENC s více technologiemi DRM pro MPEG-DASH a dynamické šifrování AES-128 pro HLS, například musíte dva samostatné obsahu klíče, každou s vlastním ContentKeyType.</span><span class="sxs-lookup"><span data-stu-id="25233-200">For example, if you need tooapply dynamic CENC protection with multi-DRM for MPEG-DASH, and dynamic AES-128 encryption for HLS, you need two separate content keys, each with its own ContentKeyType.</span></span> <span data-ttu-id="25233-201">(Hello obsahu klíč používaný k dynamické šifrování CENC ochrany, ContentKeyType.CommonEncryption by měl použít, když pro hello obsahu, je klíč používaný k dynamické šifrování AES-128, ContentKeyType.EnvelopeEncryption by měl být použit.)</span><span class="sxs-lookup"><span data-stu-id="25233-201">(For hello content key used for dynamic CENC protection, ContentKeyType.CommonEncryption should be used, while for hello content key used for dynamic AES-128 encryption, ContentKeyType.EnvelopeEncryption should be used.)</span></span><br/><br/><span data-ttu-id="25233-202">Další příklad v CENC ochrany DASH obsahu teoreticky, jeden klíč obsahu lze použít tooprotect datový proud videa a jiné zvukový datový proud obsahu tooprotect klíče.</span><span class="sxs-lookup"><span data-stu-id="25233-202">Another example, in CENC protection of DASH content, in theory, one content key can be used tooprotect video stream and another content key tooprotect audio stream.</span></span> |
| <span data-ttu-id="25233-203">Mnoho – příliš mnoho</span><span class="sxs-lookup"><span data-stu-id="25233-203">Many – too- Many</span></span> |<span data-ttu-id="25233-204">Kombinace hello výše ve dvou situacích: jednu sadu obsahu, které se používají klíče pro každý hello více prostředků v hello stejné asset "skupina".</span><span class="sxs-lookup"><span data-stu-id="25233-204">Combination of hello above two scenarios: one set of content keys are used for each of hello multiple assets in hello same asset “group”.</span></span> |

<span data-ttu-id="25233-205">Další důležitý faktor tooconsider je hello použití trvalé a dočasnou licencí.</span><span class="sxs-lookup"><span data-stu-id="25233-205">Another important factor tooconsider is hello use of persistent and non-persistent licenses.</span></span>

<span data-ttu-id="25233-206">Tyto aspekty jsou důležité</span><span class="sxs-lookup"><span data-stu-id="25233-206">Why are these considerations important?</span></span>

<span data-ttu-id="25233-207">Budou mít přímý vliv toolicense doručení náklady, pokud používáte veřejného cloudu pro doručování licencí.</span><span class="sxs-lookup"><span data-stu-id="25233-207">They have direct impact toolicense delivery cost if you use public cloud for license delivery.</span></span> <span data-ttu-id="25233-208">Zvažte následující dvou různých případech tooillustrate hello:</span><span class="sxs-lookup"><span data-stu-id="25233-208">Let’s consider hello following two different design cases tooillustrate:</span></span>

1. <span data-ttu-id="25233-209">Měsíční předplatné: použití trvalé licence a obsahu klíč asset mapování 1: n.</span><span class="sxs-lookup"><span data-stu-id="25233-209">Monthly subscription: Use persistent license, and 1-to-many content key-to-asset mapping.</span></span> <span data-ttu-id="25233-210">Například</span><span class="sxs-lookup"><span data-stu-id="25233-210">E.g.</span></span> <span data-ttu-id="25233-211">pro všechny hello dětí filmy použijeme jeden klíč obsahu pro šifrování.</span><span class="sxs-lookup"><span data-stu-id="25233-211">for all hello kids movies, we use a single content key for encryption.</span></span> <span data-ttu-id="25233-212">V takovém případě:</span><span class="sxs-lookup"><span data-stu-id="25233-212">In this case:</span></span>

    <span data-ttu-id="25233-213">Celkový počet licencí # požadované pro všechny děti filmy a zařízení = 1</span><span class="sxs-lookup"><span data-stu-id="25233-213">Total # licenses requested for all kids movies/device = 1</span></span>
2. <span data-ttu-id="25233-214">Měsíční předplatné: použít dočasnou licence a mapování 1: 1 mezi klíč obsahu a asset.</span><span class="sxs-lookup"><span data-stu-id="25233-214">Monthly subscription: Use non-persistent license, and 1-to-1 mapping between content key and asset.</span></span> <span data-ttu-id="25233-215">V takovém případě:</span><span class="sxs-lookup"><span data-stu-id="25233-215">In this case:</span></span>

    <span data-ttu-id="25233-216">Celkový počet licencí # požadované pro všechny děti filmy a zařízení = [# filmy sledovaná] x [relací #]</span><span class="sxs-lookup"><span data-stu-id="25233-216">Total # licenses requested for all kids movies/device = [# movies watched] x [# sessions]</span></span>

<span data-ttu-id="25233-217">Jak můžete snadno vidět, hello dvou různých návrzích mít za následek velmi jiné licenční žádost vzory proto doručování licencí náklady Pokud službu doručování licencí poskytuje veřejného cloudu, jako je například Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="25233-217">As you can easily see, hello two different designs result in very different license request patterns hence license delivery cost if license delivery service is provided by a public cloud such as Azure Media Services.</span></span>

## <a name="mapping-design-tootechnology-for-implementation"></a><span data-ttu-id="25233-218">Mapování tootechnology návrhu pro implementaci</span><span class="sxs-lookup"><span data-stu-id="25233-218">Mapping design tootechnology for implementation</span></span>
<span data-ttu-id="25233-219">V dalším kroku jsme mapovat naše tootechnologies obecné návrhu na platformě Microsoft Azure nebo Azure Media Services, zadáním které toouse technologie pro každý stavební blok.</span><span class="sxs-lookup"><span data-stu-id="25233-219">Next, we map our generic design tootechnologies on Microsoft Azure/Azure Media Services platform, by specifying which technology toouse for each building block.</span></span>

<span data-ttu-id="25233-220">Hello následující tabulka uvádí mapování hello:</span><span class="sxs-lookup"><span data-stu-id="25233-220">hello following table shows hello mapping:</span></span>

| <span data-ttu-id="25233-221">**Stavební blok.**</span><span class="sxs-lookup"><span data-stu-id="25233-221">**Building Block**</span></span> | <span data-ttu-id="25233-222">**Technologie**</span><span class="sxs-lookup"><span data-stu-id="25233-222">**Technology**</span></span> |
| --- | --- |
| <span data-ttu-id="25233-223">**Player**</span><span class="sxs-lookup"><span data-stu-id="25233-223">**Player**</span></span> |[<span data-ttu-id="25233-224">Přehrávač médií Azure</span><span class="sxs-lookup"><span data-stu-id="25233-224">Azure Media Player</span></span>](https://azure.microsoft.com/services/media-services/media-player/) |
| <span data-ttu-id="25233-225">**Zprostředkovatel identity (IDP)**</span><span class="sxs-lookup"><span data-stu-id="25233-225">**Identity Provider (IDP)**</span></span> |<span data-ttu-id="25233-226">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="25233-226">Azure Active Directory</span></span> |
| <span data-ttu-id="25233-227">**Služba tokenů zabezpečení (STS)**</span><span class="sxs-lookup"><span data-stu-id="25233-227">**Secure Token Service (STS)**</span></span> |<span data-ttu-id="25233-228">Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="25233-228">Azure Active Directory</span></span> |
| <span data-ttu-id="25233-229">**Pracovní postup ochrany DRM**</span><span class="sxs-lookup"><span data-stu-id="25233-229">**DRM Protection Workflow**</span></span> |<span data-ttu-id="25233-230">Dynamické ochrany služby Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="25233-230">Azure Media Services Dynamic Protection</span></span> |
| <span data-ttu-id="25233-231">**Doručování licencí DRM**</span><span class="sxs-lookup"><span data-stu-id="25233-231">**DRM License Delivery**</span></span> |<span data-ttu-id="25233-232">1. Azure Media Services licence doručení (PlayReady, Widevine, FairPlay), nebo</span><span class="sxs-lookup"><span data-stu-id="25233-232">1. Azure Media Services License Delivery (PlayReady, Widevine, FairPlay), or</span></span> <br/><span data-ttu-id="25233-233">2. Axinom licenční Server,</span><span class="sxs-lookup"><span data-stu-id="25233-233">2. Axinom License Server,</span></span> <br/><span data-ttu-id="25233-234">3. Vlastní PlayReady licenčního serveru</span><span class="sxs-lookup"><span data-stu-id="25233-234">3. Custom PlayReady License Server</span></span> |
| <span data-ttu-id="25233-235">**Počátek**</span><span class="sxs-lookup"><span data-stu-id="25233-235">**Origin**</span></span> |<span data-ttu-id="25233-236">Koncový bod streamování služby Azure Media Services</span><span class="sxs-lookup"><span data-stu-id="25233-236">Azure Media Services Streaming Endpoint</span></span> |
| <span data-ttu-id="25233-237">**Správa klíčů**</span><span class="sxs-lookup"><span data-stu-id="25233-237">**Key Management**</span></span> |<span data-ttu-id="25233-238">Není skutečně potřeba pro odkaz na implementaci</span><span class="sxs-lookup"><span data-stu-id="25233-238">Not needed for reference implementation</span></span> |
| <span data-ttu-id="25233-239">**Správa obsahu**</span><span class="sxs-lookup"><span data-stu-id="25233-239">**Content Management**</span></span> |<span data-ttu-id="25233-240">Konzolovou aplikaci C#</span><span class="sxs-lookup"><span data-stu-id="25233-240">A C# console application</span></span> |

<span data-ttu-id="25233-241">Jinými slovy zprostředkovatele Identity (IDP) a zabezpečené tokenu služby (STS) bude Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-241">In other words, both Identity Provider (IDP) and Secure Token Service (STS) will be Azure AD.</span></span> <span data-ttu-id="25233-242">Přehrávač, použijeme [rozhraní API služby Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="25233-242">For player, we will use [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="25233-243">Azure Media Services a Azure Media Player podporovat DASH a šifrování CENC s více technologiemi DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-243">Both Azure Media Services and Azure Media Player support DASH and CENC with multi-DRM.</span></span>

<span data-ttu-id="25233-244">Následující diagram ukazuje Hello hello celkové struktuře a toku s hello výše technologie mapování.</span><span class="sxs-lookup"><span data-stu-id="25233-244">hello following diagram shows hello overall structure and flow with hello above technology mapping.</span></span>

![Šifrování CENC na AMS](./media/media-services-cenc-with-multidrm-access-control/media-services-cenc-subsystem-on-AMS-platform.png)

<span data-ttu-id="25233-246">V pořadí tooset až dynamického šifrování CENC použije nástroj pro správu obsahu hello hello následující vstupy:</span><span class="sxs-lookup"><span data-stu-id="25233-246">In order tooset up dynamic CENC encryption, hello content management tool will use hello following inputs:</span></span>

1. <span data-ttu-id="25233-247">Otevřete obsahu;</span><span class="sxs-lookup"><span data-stu-id="25233-247">Open content;</span></span>
2. <span data-ttu-id="25233-248">Klíč obsahu z klíče generace nebo správu;</span><span class="sxs-lookup"><span data-stu-id="25233-248">Content key from key generation/management;</span></span>
3. <span data-ttu-id="25233-249">Adresy URL získávání licencí;</span><span class="sxs-lookup"><span data-stu-id="25233-249">License acquisition URLs;</span></span>
4. <span data-ttu-id="25233-250">Seznam informací ze služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-250">A list of information from Azure AD.</span></span>

<span data-ttu-id="25233-251">bude mít Hello výstup hello nástroje správy obsahu:</span><span class="sxs-lookup"><span data-stu-id="25233-251">hello output of hello content management tool will be:</span></span>

1. <span data-ttu-id="25233-252">ContentKeyAuthorizationPolicy obsahující specifikace hello na tom, jak doručování licencí ověří JWT token a specifikace licence DRM;</span><span class="sxs-lookup"><span data-stu-id="25233-252">ContentKeyAuthorizationPolicy containing hello specification on how license delivery verifies a JWT token and DRM license specifications;</span></span>
2. <span data-ttu-id="25233-253">AssetDeliveryPolicy obsahující specifikace na streamování formátu, ochrany DRM a adresy URL získání licence.</span><span class="sxs-lookup"><span data-stu-id="25233-253">AssetDeliveryPolicy containing specifications on streaming format, DRM protection and license acquisition URLs.</span></span>

<span data-ttu-id="25233-254">Během doby běhu, hello tok je jako níže:</span><span class="sxs-lookup"><span data-stu-id="25233-254">During runtime, hello flow is as below:</span></span>

1. <span data-ttu-id="25233-255">Po ověření uživatele se generuje JWT token;</span><span class="sxs-lookup"><span data-stu-id="25233-255">Upon user authentication, a JWT token is generated;</span></span>
2. <span data-ttu-id="25233-256">Jedna z deklarací identity hello obsažených v tokenu JWT hello je "skupiny" deklarace obsahující ID objektu skupiny hello "EntitledUserGroup".</span><span class="sxs-lookup"><span data-stu-id="25233-256">One of hello claims contained in hello JWT token is “groups” claim containing hello group object ID of “EntitledUserGroup”.</span></span> <span data-ttu-id="25233-257">Tento požadavek se použije pro předávání "Kontrola nárocích".</span><span class="sxs-lookup"><span data-stu-id="25233-257">This claim will be used for passing “entitlement check”.</span></span>
3. <span data-ttu-id="25233-258">Přehrávač stahování klienta manifest CENC chráněného obsahu a "vidí" hello následující:</span><span class="sxs-lookup"><span data-stu-id="25233-258">Player downloads client manifest of a CENC protected content and “sees” hello following:</span></span>

   1. <span data-ttu-id="25233-259">klíč ID,</span><span class="sxs-lookup"><span data-stu-id="25233-259">key ID,</span></span>
   2. <span data-ttu-id="25233-260">šifrování CENC chráněný, je obsah Hello</span><span class="sxs-lookup"><span data-stu-id="25233-260">hello content is CENC protected,</span></span>
   3. <span data-ttu-id="25233-261">Licence získání adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25233-261">License acquisition URLs.</span></span>
4. <span data-ttu-id="25233-262">Přehrávač odešle požadavek získávání licencí podle hello prohlížeče nebo DRM podporována.</span><span class="sxs-lookup"><span data-stu-id="25233-262">Player makes a license acquisition request based on hello browser/DRM supported.</span></span> <span data-ttu-id="25233-263">V žádosti o získání licence hello, klíče ID a hello JWT bude také odeslat token.</span><span class="sxs-lookup"><span data-stu-id="25233-263">In hello license acquisition request, key ID and hello JWT token will also be submitted.</span></span> <span data-ttu-id="25233-264">Službu doručování licencí ověří hello JWT token a hello deklarace obsažené předtím, než vydávající hello potřeby licence.</span><span class="sxs-lookup"><span data-stu-id="25233-264">License delivery service will verify hello JWT token and hello claims contained before issuing hello needed license.</span></span>

## <a name="implementation"></a><span data-ttu-id="25233-265">Implementace</span><span class="sxs-lookup"><span data-stu-id="25233-265">Implementation</span></span>
### <a name="implementation-procedures"></a><span data-ttu-id="25233-266">Implementace postupů</span><span class="sxs-lookup"><span data-stu-id="25233-266">Implementation procedures</span></span>
<span data-ttu-id="25233-267">implementace Hello bude zahrnovat hello následující kroky:</span><span class="sxs-lookup"><span data-stu-id="25233-267">hello implementation will include hello following steps:</span></span>

1. <span data-ttu-id="25233-268">Příprava testovacího majetek: kódování nebo balíčku testovací video toomulti přenosovými fragmentovaný soubor MP4 ve službě Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="25233-268">Prepare test asset(s): encode/package a test video toomulti-bitrate fragmented MP4 in Azure Media Services.</span></span> <span data-ttu-id="25233-269">Tento prostředek není DRM chráněný.</span><span class="sxs-lookup"><span data-stu-id="25233-269">This asset is NOT DRM protected.</span></span> <span data-ttu-id="25233-270">DRM ochrany se provádí dynamické ochrany později.</span><span class="sxs-lookup"><span data-stu-id="25233-270">DRM protection will be done by dynamic protection later.</span></span>
2. <span data-ttu-id="25233-271">Vytvoření klíče ID a obsah klíče (volitelně od počáteční hodnoty klíčů).</span><span class="sxs-lookup"><span data-stu-id="25233-271">Create key ID and content key (optionally from key seed).</span></span> <span data-ttu-id="25233-272">Pro naše účely není vyžadována systémem správy klíčů, protože jsme se zabývají pouze jedinou sadu klíčů ID a klíč obsahu pro několik prostředků testovací;</span><span class="sxs-lookup"><span data-stu-id="25233-272">For our purpose, key management system is not needed since we are dealing with only a single set of key ID and content key for a couple of test assets;</span></span>
3. <span data-ttu-id="25233-273">Pomocí služeb o doručování licencí DRM více tooconfigure AMS rozhraní API pro prostředek testovací hello.</span><span class="sxs-lookup"><span data-stu-id="25233-273">Use AMS API tooconfigure multi-DRM license delivery services for hello test asset.</span></span> <span data-ttu-id="25233-274">Pokud používáte vlastní licenčních serverů ve vaší společnosti nebo vaše společnost dodavatelé místo licenční služby ve službě Azure Media Services, můžete tento krok přeskočit a zadat licenční získání adresy URL v kroku hello ke konfiguraci doručování licencí.</span><span class="sxs-lookup"><span data-stu-id="25233-274">If you are using custom license servers by your company or your company’s vendors instead of license services in Azure Media Services, you can skip this step and specify license acquisition URLs in hello step for configuring license delivery.</span></span> <span data-ttu-id="25233-275">Rozhraní API AMS je potřebné toospecify některé podrobné konfigurace, například omezení zásady autorizace, licence odpovědi šablony pro různé služby licence DRM, atd. V tomto okamžiku hello portál Azure nemá ještě poskytují hello potřeby uživatelského rozhraní pro tuto konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="25233-275">AMS API is needed toospecify some detailed configurations, such as authorization policy restriction, license response templates for different DRM license services, etc. At this time, hello Azure portal does not yet provide hello needed UI for this configuration.</span></span> <span data-ttu-id="25233-276">Můžete najít informace o úroveň rozhraní API a ukázkový kód v dokumentu Dita Kornich: [pomocí PlayReady nebo Widevine běžného dynamického šifrování](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="25233-276">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
4. <span data-ttu-id="25233-277">Použijte zásady doručení assetu tooconfigure AMS rozhraní API pro prostředek testovací hello.</span><span class="sxs-lookup"><span data-stu-id="25233-277">Use AMS API tooconfigure asset delivery policy for hello test asset.</span></span> <span data-ttu-id="25233-278">Můžete najít informace o úroveň rozhraní API a ukázkový kód v dokumentu Dita Kornich: [pomocí PlayReady nebo Widevine běžného dynamického šifrování](media-services-protect-with-drm.md).</span><span class="sxs-lookup"><span data-stu-id="25233-278">You can find API level info and sample code in Julia Kornich’s document: [Using PlayReady and/or Widevine Dynamic Common Encryption](media-services-protect-with-drm.md).</span></span>
5. <span data-ttu-id="25233-279">Vytvořit a nakonfigurovat klienta služby Azure Active Directory v Azure;</span><span class="sxs-lookup"><span data-stu-id="25233-279">Create and configure an Azure Active Directory tenant in Azure;</span></span>
6. <span data-ttu-id="25233-280">Vytvořit několik uživatelských účtů a skupin v klientovi služby Azure Active Directory: je třeba vytvořit alespoň "EntitledUser" skupiny a přidat skupinu uživatelů toothis.</span><span class="sxs-lookup"><span data-stu-id="25233-280">Create a few user accounts and groups in your Azure Active Directory tenant: you should create at least “EntitledUser” group and add a user toothis group.</span></span> <span data-ttu-id="25233-281">Uživatelé v této skupině předá kontrolu oprávnění v získání licence a uživatelé není v této skupině se nezdaří kontrola ověřování toopass a nebude možné tooacquire žádné licence.</span><span class="sxs-lookup"><span data-stu-id="25233-281">Users in this group will pass entitlement check in license acquisition and users not in this group will fail toopass authentication check and will not be able tooacquire any license.</span></span> <span data-ttu-id="25233-282">Je členem této skupiny "EntitledUser" je taková deklarace požadované "skupiny" v hello tokenu JWT vydaného Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-282">Being a member of this “EntitledUser” group is a required “groups” claim in hello JWT token issued by Azure AD.</span></span> <span data-ttu-id="25233-283">Tento požadavek deklarace identity musí být zadán v konfiguraci krok služeb doručování licence více technologiemi DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-283">This claim requirement should be specified in configuring multi-DRM license delivery services step.</span></span>
7. <span data-ttu-id="25233-284">Vytvoření aplikace ASP.NET MVC, který bude hostitelem vaší přehrávání videa.</span><span class="sxs-lookup"><span data-stu-id="25233-284">Create an ASP.NET MVC app which will be hosting your video player.</span></span> <span data-ttu-id="25233-285">Tato aplikace ASP.NET, budou chráněné s ověřováním uživatele proti hello klienta Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="25233-285">This ASP.NET app will be protected with user authentication against hello Azure Active Directory tenant.</span></span> <span data-ttu-id="25233-286">Správné deklarací identity bude součástí hello přístupové tokeny získat po ověření uživatele.</span><span class="sxs-lookup"><span data-stu-id="25233-286">Proper claims will be included in hello access tokens obtained after user authentication.</span></span> <span data-ttu-id="25233-287">Pro tento krok se doporučuje OpenID Connect rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="25233-287">OpenID Connect API is recommended for this step.</span></span> <span data-ttu-id="25233-288">Je třeba tooinstall hello následující balíčky NuGet:</span><span class="sxs-lookup"><span data-stu-id="25233-288">You need tooinstall hello following NuGet packages:</span></span>
   * <span data-ttu-id="25233-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span><span class="sxs-lookup"><span data-stu-id="25233-289">Install-Package Microsoft.Azure.ActiveDirectory.GraphClient</span></span>
   * <span data-ttu-id="25233-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span><span class="sxs-lookup"><span data-stu-id="25233-290">Install-Package Microsoft.Owin.Security.OpenIdConnect</span></span>
   * <span data-ttu-id="25233-291">Install-Package Microsoft.Owin.Security.Cookies</span><span class="sxs-lookup"><span data-stu-id="25233-291">Install-Package Microsoft.Owin.Security.Cookies</span></span>
   * <span data-ttu-id="25233-292">Instalovat balíček Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="25233-292">Install-Package Microsoft.Owin.Host.SystemWeb</span></span>
   * <span data-ttu-id="25233-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span><span class="sxs-lookup"><span data-stu-id="25233-293">Install-Package Microsoft.IdentityModel.Clients.ActiveDirectory</span></span>
8. <span data-ttu-id="25233-294">Vytvoření přehrávač pomocí [rozhraní API služby Azure Media Player](http://amp.azure.net/libs/amp/latest/docs/).</span><span class="sxs-lookup"><span data-stu-id="25233-294">Create a player using [Azure Media Player API](http://amp.azure.net/libs/amp/latest/docs/).</span></span> <span data-ttu-id="25233-295">[Rozhraní API Azure Media Player ProtectionInfo](http://amp.azure.net/libs/amp/latest/docs/) vám umožní toospecify které toouse technologie DRM na jiné platformě DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-295">[Azure Media Player’s ProtectionInfo API](http://amp.azure.net/libs/amp/latest/docs/) allows you toospecify which DRM technology toouse on different DRM platform.</span></span>
9. <span data-ttu-id="25233-296">Testovací matrice:</span><span class="sxs-lookup"><span data-stu-id="25233-296">Test matrix:</span></span>

| <span data-ttu-id="25233-297">**DRM**</span><span class="sxs-lookup"><span data-stu-id="25233-297">**DRM**</span></span> | <span data-ttu-id="25233-298">**Prohlížeč**</span><span class="sxs-lookup"><span data-stu-id="25233-298">**Browser**</span></span> | <span data-ttu-id="25233-299">**Výsledek nárok uživatele**</span><span class="sxs-lookup"><span data-stu-id="25233-299">**Result for Entitled User**</span></span> | <span data-ttu-id="25233-300">**Výsledek pro zrušení nárok uživatele**</span><span class="sxs-lookup"><span data-stu-id="25233-300">**Result for Un-entitled User**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="25233-301">**PlayReady**</span><span class="sxs-lookup"><span data-stu-id="25233-301">**PlayReady**</span></span> |<span data-ttu-id="25233-302">MS Edge nebo IE11 v systému Windows 10</span><span class="sxs-lookup"><span data-stu-id="25233-302">MS Edge or IE11 on Windows 10</span></span> |<span data-ttu-id="25233-303">Úspěšné</span><span class="sxs-lookup"><span data-stu-id="25233-303">Succeed</span></span> |<span data-ttu-id="25233-304">Selhání</span><span class="sxs-lookup"><span data-stu-id="25233-304">Fail</span></span> |
| <span data-ttu-id="25233-305">**Widevine**</span><span class="sxs-lookup"><span data-stu-id="25233-305">**Widevine**</span></span> |<span data-ttu-id="25233-306">Chrome ve Windows 10</span><span class="sxs-lookup"><span data-stu-id="25233-306">Chrome on Windows 10</span></span> |<span data-ttu-id="25233-307">Úspěšné</span><span class="sxs-lookup"><span data-stu-id="25233-307">Succeed</span></span> |<span data-ttu-id="25233-308">Selhání</span><span class="sxs-lookup"><span data-stu-id="25233-308">Fail</span></span> |
| <span data-ttu-id="25233-309">**FairPlay**</span><span class="sxs-lookup"><span data-stu-id="25233-309">**FairPlay**</span></span> |<span data-ttu-id="25233-310">Bude doplněno</span><span class="sxs-lookup"><span data-stu-id="25233-310">TBD</span></span> | | |

<span data-ttu-id="25233-311">George Trifonov Azure Media Services týmu byl zápis blog, který poskytuje podrobné pokyny k nastavení Azure Active Directory pro aplikaci ASP.NET MVC player: [integrovat Azure Media Services OWIN MVC na základě aplikace pomocí Azure Active Directory a omezit obsah na základě deklarací JWT doručení klíče](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span><span class="sxs-lookup"><span data-stu-id="25233-311">George Trifonov of Azure Media Services Team has written a blog providing detailed steps in setting up Azure Active Directory for an ASP.NET MVC player app: [Integrate Azure Media Services OWIN MVC based app with Azure Active Directory and restrict content key delivery based on JWT claims](http://gtrifonov.com/2015/01/24/mvc-owin-azure-media-services-ad-integration/).</span></span>

<span data-ttu-id="25233-312">George také zapisují blog na [ověření pomocí tokenu JWT v Azure Media Services a dynamickým šifrováním](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span><span class="sxs-lookup"><span data-stu-id="25233-312">George has also written a blog on [JWT token Authentication in Azure Media Services and Dynamic Encryption](http://gtrifonov.com/2015/01/03/jwt-token-authentication-in-azure-media-services-and-dynamic-encryption/).</span></span> <span data-ttu-id="25233-313">A tady je svůj [ukázku v Azure AD integraci s Azure Media Services doručení klíče](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span><span class="sxs-lookup"><span data-stu-id="25233-313">And here is his [sample on Azure AD integration with Azure Media Services key delivery](https://github.com/AzureMediaServicesSamples/Key-delivery-with-AAD-integration/).</span></span>

<span data-ttu-id="25233-314">Informace o službě Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="25233-314">For information on Azure Active Directory:</span></span>

* <span data-ttu-id="25233-315">Můžete najít informace pro vývojáře v [Azure Active Directory – Příručka vývojáře](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="25233-315">You can find developer information in [Azure Active Directory Developer’s Guide](../active-directory/active-directory-developers-guide.md).</span></span>
* <span data-ttu-id="25233-316">Můžete najít informace pro správce v [spravovat váš adresář Azure AD](../active-directory/active-directory-administer.md).</span><span class="sxs-lookup"><span data-stu-id="25233-316">You can find administrator information in [Administer Your Azure AD Directory](../active-directory/active-directory-administer.md).</span></span>

### <a name="some-gotchas-in-implementation"></a><span data-ttu-id="25233-317">Některé gotchas v implementaci</span><span class="sxs-lookup"><span data-stu-id="25233-317">Some gotchas in implementation</span></span>
<span data-ttu-id="25233-318">V implementaci hello nejsou některé "gotchas".</span><span class="sxs-lookup"><span data-stu-id="25233-318">There are some “gotchas” in hello implementation.</span></span> <span data-ttu-id="25233-319">Zpravidla hello následující seznam "gotchas" vám může pomoci řešení problémů v případě, že narazíte na problémy.</span><span class="sxs-lookup"><span data-stu-id="25233-319">Hopefully hello following list of “gotchas” can help you troubleshooting in case you run into issues.</span></span>

1. <span data-ttu-id="25233-320">**Vystavitel** adresa URL musí končit **"/"**.</span><span class="sxs-lookup"><span data-stu-id="25233-320">**Issuer** URL should end with **"/"**.</span></span>  

    <span data-ttu-id="25233-321">**Cílová skupina** by měl být hello ID klienta aplikace přehrávače a měli byste také přidat **"/"** na konci hello URL vystavitele hello.</span><span class="sxs-lookup"><span data-stu-id="25233-321">**Audience** should be hello player application client ID and you should also add **"/"** at hello end of hello issuer URL.</span></span>

        <add key="ida:audience" value="[Application Client ID GUID]" />
        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/" />

    <span data-ttu-id="25233-322">V [JWT Decoder](http://jwt.calebb.net/), měli byste vidět **oblast** a **iss** jako níže v tokenu JWT hello:</span><span class="sxs-lookup"><span data-stu-id="25233-322">In [JWT Decoder](http://jwt.calebb.net/), you should see **aud** and **iss** as below in hello JWT token:</span></span>

    ![1. gotcha](./media/media-services-cenc-with-multidrm-access-control/media-services-1st-gotcha.png)
2. <span data-ttu-id="25233-324">Přidejte oprávnění toohello aplikací v AAD (na kartě Konfigurace aplikace hello).</span><span class="sxs-lookup"><span data-stu-id="25233-324">Add Permissions toohello application in AAD (on Configure tab of hello application).</span></span> <span data-ttu-id="25233-325">To je potřeba pro každou aplikaci (místní a nasazené verze).</span><span class="sxs-lookup"><span data-stu-id="25233-325">This is required for each application (local and deployed versions).</span></span>

    ![gotcha 2.](./media/media-services-cenc-with-multidrm-access-control/media-services-perms-to-other-apps.png)
3. <span data-ttu-id="25233-327">Použijte hello správné vystavitele v nastavení dynamické šifrování CENC ochrany:</span><span class="sxs-lookup"><span data-stu-id="25233-327">Use hello right issuer in setting up dynamic CENC protection:</span></span>

        <add key="ida:issuer" value="https://sts.windows.net/[AAD Tenant ID]/"/>

    <span data-ttu-id="25233-328">Hello následující funkce nebudou fungovat:</span><span class="sxs-lookup"><span data-stu-id="25233-328">hello following will not work:</span></span>

        <add key="ida:issuer" value="https://willzhanad.onmicrosoft.com/" />

    <span data-ttu-id="25233-329">Hello GUID je ID hello AAD klienta.</span><span class="sxs-lookup"><span data-stu-id="25233-329">hello GUID is hello AAD tenant ID.</span></span> <span data-ttu-id="25233-330">Hello GUID naleznete v automaticky otevřeném okně koncových bodů na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="25233-330">hello GUID can be found in Endpoints popup in Azure portal.</span></span>
4. <span data-ttu-id="25233-331">Členství ve skupině udělit deklarací oprávnění.</span><span class="sxs-lookup"><span data-stu-id="25233-331">Grant group membership claims privileges.</span></span> <span data-ttu-id="25233-332">Zajistěte, aby v souboru manifestu aplikace AAD, že máme následující hello</span><span class="sxs-lookup"><span data-stu-id="25233-332">Make sure in AAD application manifest file, we have hello following</span></span>

    <span data-ttu-id="25233-333">"groupMembershipClaims": "Vše", (hello výchozí hodnota je null)</span><span class="sxs-lookup"><span data-stu-id="25233-333">"groupMembershipClaims": "All",    (hello default value is null)</span></span>
5. <span data-ttu-id="25233-334">Nastavení správné TokenType při vytváření omezení požadavků.</span><span class="sxs-lookup"><span data-stu-id="25233-334">Setting proper TokenType when creating restriction requirements.</span></span>

        objTokenRestrictionTemplate.TokenType = TokenType.JWT;

    <span data-ttu-id="25233-335">Vzhledem k tomu, že přidání podpory JWT (AAD) kromě tooSWT (ACS), je výchozí hello TokenType TokenType.JWT.</span><span class="sxs-lookup"><span data-stu-id="25233-335">Since adding support of JWT (AAD) in addition tooSWT (ACS), hello default TokenType is TokenType.JWT.</span></span> <span data-ttu-id="25233-336">Pokud používáte SWT/ACS, je nutné nastavit tooTokenType.SWT.</span><span class="sxs-lookup"><span data-stu-id="25233-336">If you use SWT/ACS, you must set tooTokenType.SWT.</span></span>

## <a name="additional-topics-for-implementation"></a><span data-ttu-id="25233-337">Další témata pro implementaci</span><span class="sxs-lookup"><span data-stu-id="25233-337">Additional Topics for Implementation</span></span>
<span data-ttu-id="25233-338">Potom jsme se disk uss některá další témata v našem návrhu a implementace.</span><span class="sxs-lookup"><span data-stu-id="25233-338">Next we will disc uss some additional topics in our design and implementation.</span></span>

### <a name="http-or-https"></a><span data-ttu-id="25233-339">Protokol HTTP nebo HTTPS?</span><span class="sxs-lookup"><span data-stu-id="25233-339">HTTP or HTTPS?</span></span>
<span data-ttu-id="25233-340">Hello player aplikace ASP.NET MVC, které vytvoříme, musí podporovat hello následující:</span><span class="sxs-lookup"><span data-stu-id="25233-340">hello ASP.NET MVC player application we built must support hello following:</span></span>

1. <span data-ttu-id="25233-341">Ověření uživatele prostřednictvím služby Azure AD, který se musí toobe pod HTTPS;</span><span class="sxs-lookup"><span data-stu-id="25233-341">User authentication through Azure AD which needs toobe under HTTPS;</span></span>
2. <span data-ttu-id="25233-342">Exchange tokenu JWT mezi klientem a Azure AD, který se musí toobe pod HTTPS;</span><span class="sxs-lookup"><span data-stu-id="25233-342">JWT token exchange between client and Azure AD which needs toobe under HTTPS;</span></span>
3. <span data-ttu-id="25233-343">Získání licence DRM hello klienta, který je požadovaný toobe v rámci protokolu HTTPS, pokud se službou Azure Media Services poskytuje doručování licencí.</span><span class="sxs-lookup"><span data-stu-id="25233-343">DRM license acquisition by hello client which is required toobe under HTTPS if license delivery is provided by Azure Media Services.</span></span> <span data-ttu-id="25233-344">Samozřejmě sady produktů PlayReady nenutí HTTPS pro doručování licencí.</span><span class="sxs-lookup"><span data-stu-id="25233-344">Of course, PlayReady product suite does not mandate HTTPS for license delivery.</span></span> <span data-ttu-id="25233-345">Pokud je server licence PlayReady mimo Azure Media Services, by bylo možné pomocí protokolu HTTP nebo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-345">If your PlayReady license server is outside of Azure Media Services, either HTTP or HTTPS could be used.</span></span>

<span data-ttu-id="25233-346">Proto hello aplikace přehrávače ASP.NET použije HTTPS jako osvědčený postup.</span><span class="sxs-lookup"><span data-stu-id="25233-346">Therefore, hello ASP.NET player application will use HTTPS as a best practice.</span></span> <span data-ttu-id="25233-347">To znamená hello přehrávač médií Azure bude na stránce v rámci protokolu HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-347">This means hello Azure Media Player will be on a page under HTTPS.</span></span> <span data-ttu-id="25233-348">Ale pro streamování jsme raději HTTP, proto potřebujeme tooconsider smíšeného obsahu problém.</span><span class="sxs-lookup"><span data-stu-id="25233-348">However, for streaming we prefer HTTP, hence we need tooconsider mixed content issue.</span></span>

1. <span data-ttu-id="25233-349">Prohlížeč nepovoluje smíšený obsah.</span><span class="sxs-lookup"><span data-stu-id="25233-349">Browser does not allow mixed content.</span></span> <span data-ttu-id="25233-350">Můžete ale povolit moduly plug-in, jako je modul plug-in Silverlight a OSMF pro protokol smooth a POMLČKY.</span><span class="sxs-lookup"><span data-stu-id="25233-350">But plugins like Silverlight and OSMF plugin for smooth and DASH allow.</span></span> <span data-ttu-id="25233-351">Potíže se zabezpečením je smíšený obsah – to je z důvodu toohello hrozeb z hello možnost tooinject škodlivý JS, které mohou způsobovat hello toobe dat zákazníka v ohrožení.</span><span class="sxs-lookup"><span data-stu-id="25233-351">Mixed content is a security concern - This is due toohello threat of hello ability tooinject malicious JS which can cause hello customer data toobe at risk.</span></span>  <span data-ttu-id="25233-352">To prohlížeče blokovat ve výchozím nastavení a, pokud je hello pouze způsob toowork kolem něj na straně serveru (původ) hello, tooallow všechny domény (bez ohledu na to https nebo http).</span><span class="sxs-lookup"><span data-stu-id="25233-352">Browsers block this by default and so far hello only way toowork around it is on hello server (origin) side, tooallow all domains (regardless https or http).</span></span> <span data-ttu-id="25233-353">To je pravděpodobně není vhodné buď.</span><span class="sxs-lookup"><span data-stu-id="25233-353">This is probably not a good idea either.</span></span>
2. <span data-ttu-id="25233-354">Jsme byste neměli smíšený obsah: jak používat protokol HTTP nebo oba používat protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-354">We should avoid mixed content: either both use HTTP or both use HTTPS.</span></span> <span data-ttu-id="25233-355">Při přehrávání smíšený obsah, technická silverlightSS uděláte zrušením smíšený obsah upozornění.</span><span class="sxs-lookup"><span data-stu-id="25233-355">When playing mixed content, silverlightSS tech requires clearing a mixed content warning.</span></span> <span data-ttu-id="25233-356">Technická flashSS zpracovává smíšený obsah bez upozornění smíšený obsah.</span><span class="sxs-lookup"><span data-stu-id="25233-356">flashSS tech handles mixed content without mixed content warning.</span></span>
3. <span data-ttu-id="25233-357">Pokud před srpen 2014 byl vytvořen koncový bod streamování, nebudou podporovat protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-357">If your streaming endpoint was created before August 2014, it will not support HTTPS.</span></span> <span data-ttu-id="25233-358">V takovém případě prosím vytvořit a použít nový koncový bod streamování pro protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-358">In this case, please create and use a new streaming endpoint for HTTPS.</span></span>

<span data-ttu-id="25233-359">V implementaci odkaz hello DRM chráněný obsah v části HTTTPS bude aplikace a vysílání datového proudu.</span><span class="sxs-lookup"><span data-stu-id="25233-359">In hello reference implementation, for DRM protected contents, both application and streaming will be under HTTTPS.</span></span> <span data-ttu-id="25233-360">Otevřít obsah, hello player nemusí ověřování nebo licenci, abyste získali hello liberty toouse buď HTTP nebo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="25233-360">For open contents, hello player does not need authentication or license, so you have hello liberty toouse either HTTP or HTTPS.</span></span>

### <a name="azure-active-directory-signing-key-rollover"></a><span data-ttu-id="25233-361">Azure Active Directory podepisování výměna klíče</span><span class="sxs-lookup"><span data-stu-id="25233-361">Azure Active Directory signing key rollover</span></span>
<span data-ttu-id="25233-362">Jde důležité tootake bodu v úvahu vaší implementace.</span><span class="sxs-lookup"><span data-stu-id="25233-362">This is an important point tootake into consideration of your implementation.</span></span> <span data-ttu-id="25233-363">Pokud jste to nepovažujte v implementaci, hello dokončit systému nakonec přestanou fungovat úplně do maximálně 6 týdnů.</span><span class="sxs-lookup"><span data-stu-id="25233-363">If you do not consider this in your implementation, hello completed system will eventually stop working completely within at most 6 weeks.</span></span>

<span data-ttu-id="25233-364">Azure AD používá oborový standard tooestablish důvěryhodnosti mezi samostatně a aplikací pomocí služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-364">Azure AD uses industry standard tooestablish trust between itself and applications using Azure AD.</span></span> <span data-ttu-id="25233-365">Konkrétně Azure AD používá podpisový klíč, který se skládá z pár veřejného a privátního klíče.</span><span class="sxs-lookup"><span data-stu-id="25233-365">Specifically, Azure AD uses a signing key that consists of a public and private key pair.</span></span> <span data-ttu-id="25233-366">Azure AD vytvoří token zabezpečení, který obsahuje informace o uživateli hello, je tento token podepsána pomocí jeho privátní klíč před odesláním zpět toohello aplikace Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-366">When Azure AD creates a security token that contains information about hello user, this token is signed by Azure AD using its private key before it is sent back toohello application.</span></span> <span data-ttu-id="25233-367">tooverify, který hello token je platný, ve skutečnosti původu z Azure AD, hello aplikace musíte ověřit hello token podpis pomocí veřejného klíče hello vystavené Azure AD, která je součástí dokument federačních metadat hello klienta.</span><span class="sxs-lookup"><span data-stu-id="25233-367">tooverify that hello token is valid and actually originated from Azure AD, hello application must validate hello token’s signature using hello public key exposed by Azure AD that is contained in hello tenant’s federation metadata document.</span></span> <span data-ttu-id="25233-368">Tento veřejný klíč – a hello podpisový klíč, ze kterého pochází – je hello shoduje s klíčem pro všechny klienty ve službě Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-368">This public key – and hello signing key from which it derives – is hello same one used for all tenants in Azure AD.</span></span>

<span data-ttu-id="25233-369">Podrobné informace o výměně klíčů Azure AD najdete v dokumentu hello: [důležité informace o podepisování výměny klíče ve službě Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span><span class="sxs-lookup"><span data-stu-id="25233-369">Detailed info on Azure AD key rollover can be found in hello document: [Important Information about Signing Key Rollover in Azure AD](../active-directory/active-directory-signing-key-rollover.md).</span></span>

<span data-ttu-id="25233-370">Mezi hello [pár veřejného a privátního klíče](https://login.microsoftonline.com/common/discovery/keys/),</span><span class="sxs-lookup"><span data-stu-id="25233-370">Between hello [public-private key pair](https://login.microsoftonline.com/common/discovery/keys/),</span></span>

* <span data-ttu-id="25233-371">Při použití privátního klíče Hello pomocí Azure Active Directory toogenerate JWT token;</span><span class="sxs-lookup"><span data-stu-id="25233-371">hello private key is used by Azure Active Directory toogenerate a JWT token;</span></span>
* <span data-ttu-id="25233-372">Hello veřejný klíč slouží aplikací, třeba služeb doručování licencí DRM v tokenu JWT hello AMS tooverify;</span><span class="sxs-lookup"><span data-stu-id="25233-372">hello public key is used by an application such as DRM License Delivery Services in AMS tooverify hello JWT token;</span></span>

<span data-ttu-id="25233-373">Azure Active Directory za účelem zabezpečení, otočí tento certifikát pravidelně (každých 6 týdny).</span><span class="sxs-lookup"><span data-stu-id="25233-373">For security purpose, Azure Active Directory rotates this certificate periodically (every 6 weeks).</span></span> <span data-ttu-id="25233-374">V případě porušení zabezpečení může dojít, výměna klíče hello kdykoli.</span><span class="sxs-lookup"><span data-stu-id="25233-374">In case of security breaches, hello key rollover can occur any time.</span></span> <span data-ttu-id="25233-375">Proto služeb doručování licence hello v AMS potřebovat tooupdate hello veřejný klíč používaný jako Azure AD otočí hello pár klíčů, v opačném případě se nezdaří ověření pomocí tokenu v AMS a budou vydávat žádná licence.</span><span class="sxs-lookup"><span data-stu-id="25233-375">Therefore, hello license delivery services in AMS need tooupdate hello public key used as Azure AD rotates hello key pair, otherwise token authentication in AMS will fail and no license will be issued.</span></span>

<span data-ttu-id="25233-376">Toho dosáhnete pomocí nastavení TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument při konfiguraci služeb doručování licencí DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-376">This is achieved by setting TokenRestrictionTemplate.OpenIdConnectDiscoveryDocument when configuring DRM license delivery services.</span></span>

<span data-ttu-id="25233-377">Hello tok tokenu JWT je jako níže:</span><span class="sxs-lookup"><span data-stu-id="25233-377">hello JWT token flow is as below:</span></span>

1. <span data-ttu-id="25233-378">Azure AD vydá hello JWT token s hello aktuální privátní klíč pro ověřené uživatele.</span><span class="sxs-lookup"><span data-stu-id="25233-378">Azure AD will issue hello JWT token with hello current private key for an authenticated user;</span></span>
2. <span data-ttu-id="25233-379">Když přehrávač uvidí šifrování CENC s více technologiemi DRM chráněný obsah, bude nejprve vyhledat hello tokenu JWT vydaného Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-379">When a player sees a CENC with multi-DRM protected content, it will first locate hello JWT token issued by Azure AD.</span></span>
3. <span data-ttu-id="25233-380">přehrávač Hello odešle žádost o získání licence se služeb doručování toolicense tokenu JWT hello v AMS;</span><span class="sxs-lookup"><span data-stu-id="25233-380">hello player sends license acquisition request with hello JWT token toolicense delivery services in AMS;</span></span>
4. <span data-ttu-id="25233-381">Hello služeb doručování licencí v AMS použije hello aktuální nebo platný veřejný klíč z tokenu JWT tooverify hello Azure AD, před vydáním licence.</span><span class="sxs-lookup"><span data-stu-id="25233-381">hello license delivery services in AMS will use hello current/valid public key from Azure AD tooverify hello JWT token, before issuing licenses.</span></span>

<span data-ttu-id="25233-382">Služeb doručování licencí DRM bude vždy kontroluje hello aktuální nebo platný veřejný klíč z Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-382">DRM license delivery services will always be checking for hello current/valid public key from Azure AD.</span></span> <span data-ttu-id="25233-383">veřejný klíč Hello předloží Azure AD bude hello je klíč používaný k ověřování tokenů JWT tokenem vydaným službou Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-383">hello public key presented by Azure AD will be hello key used for verifying a JWT token issued by Azure AD.</span></span>

<span data-ttu-id="25233-384">Co v případě výměny klíčů hello se stane po generuje JWT token AAD, ale před hello JWT token odesílají přehrávače tooDRM služeb doručování licencí v AMS pro ověření?</span><span class="sxs-lookup"><span data-stu-id="25233-384">What if hello key rollover happens after AAD generates a JWT token but before hello JWT token is sent by players tooDRM license delivery services in AMS for verification?</span></span>

<span data-ttu-id="25233-385">Vzhledem k tomu, že v každém okamžiku může být vrácena klíč, je vždy více než jeden platný veřejný klíč k dispozici v dokumentu metadat federace hello.</span><span class="sxs-lookup"><span data-stu-id="25233-385">Because a key may be rolled at any moment, there is always more than one valid public key available in hello federation metadata document.</span></span> <span data-ttu-id="25233-386">Doručování licencí Azure Media Services můžete použít některou z hello zadány klíče v dokumentu hello vzhledem k tomu, že jeden klíč může být vrácena brzy, jiné může být jeho nahrazení a tak dále.</span><span class="sxs-lookup"><span data-stu-id="25233-386">Azure Media Services license delivery can use any of hello keys specified in hello document, since one key may be rolled soon, another may be its replacement, and so forth.</span></span>

### <a name="where-is-hello-access-token"></a><span data-ttu-id="25233-387">Kde je hello tokenu přístupu?</span><span class="sxs-lookup"><span data-stu-id="25233-387">Where is hello Access Token?</span></span>
<span data-ttu-id="25233-388">Pokud se podíváte na tom, jak webová aplikace volá aplikaci API v části [identita aplikace s udělení pověření klienta OAuth 2.0](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), tok ověřování hello je jako níže:</span><span class="sxs-lookup"><span data-stu-id="25233-388">If you look at how a web app calls an API app under [Application Identity with OAuth 2.0 Client Credentials Grant](../active-directory/develop/active-directory-authentication-scenarios.md#web-application-to-web-api), hello authentication flow is as below:</span></span>

1. <span data-ttu-id="25233-389">Uživatel je přihlášený tooAzure AD ve webové aplikaci hello (viz hello [webový prohlížeč tooWeb aplikace](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span><span class="sxs-lookup"><span data-stu-id="25233-389">A user is signed in tooAzure AD in hello web application (see hello [Web Browser tooWeb Application](../active-directory/develop/active-directory-authentication-scenarios.md#web-browser-to-web-application).</span></span>
2. <span data-ttu-id="25233-390">koncový bod autorizace Hello Azure AD přesměruje hello uživatelského agenta zpět toohello klientská aplikace s autorizační kód.</span><span class="sxs-lookup"><span data-stu-id="25233-390">hello Azure AD authorization endpoint redirects hello user agent back toohello client application with an authorization code.</span></span> <span data-ttu-id="25233-391">Hello uživatelský agent vrátí identifikátor URI pro přesměrování autorizační kód toohello klientské aplikace.</span><span class="sxs-lookup"><span data-stu-id="25233-391">hello user agent returns authorization code toohello client application’s redirect URI.</span></span>
3. <span data-ttu-id="25233-392">Hello webová aplikace musí tooacquire token přístupu, aby mohli ověřit toohello webového rozhraní API a načíst hello požadovaného prostředku.</span><span class="sxs-lookup"><span data-stu-id="25233-392">hello web application needs tooacquire an access token so that it can authenticate toohello web API and retrieve hello desired resource.</span></span> <span data-ttu-id="25233-393">Umožňuje tooAzure požadavek na AD koncovému bodu tokenu, poskytnutí přihlašovacích údajů hello, ID klienta a identifikátor ID URI webové rozhraní API aplikace.</span><span class="sxs-lookup"><span data-stu-id="25233-393">It makes a request tooAzure AD’s token endpoint, providing hello credential, client ID, and web API’s application ID URI.</span></span> <span data-ttu-id="25233-394">Představuje hello autorizační kód tooprove této hello uživatelem.</span><span class="sxs-lookup"><span data-stu-id="25233-394">It presents hello authorization code tooprove that hello user has consented.</span></span>
4. <span data-ttu-id="25233-395">Azure AD ověřuje hello aplikace a vrátí JWT přístupový token, který je použité toocall hello webového rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="25233-395">Azure AD authenticates hello application and returns a JWT access token that is used toocall hello web API.</span></span>
5. <span data-ttu-id="25233-396">Přes protokol HTTPS hello webová aplikace používá hello vrácená JWT přístup k tokenu tooadd hello JWT řetězec, který má označení "Nosiče" v hlavičce autorizace hello hello požadavek toohello webových rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="25233-396">Over HTTPS, hello web application uses hello returned JWT access token tooadd hello JWT string with a “Bearer” designation in hello Authorization header of hello request toohello web API.</span></span> <span data-ttu-id="25233-397">Hello webového rozhraní API pak ověří hello JWT token, a pokud je ověření úspěšné, vrátí hello požadovaného prostředku.</span><span class="sxs-lookup"><span data-stu-id="25233-397">hello web API then validates hello JWT token, and if validation is successful, returns hello desired resource.</span></span>

<span data-ttu-id="25233-398">V tomto toku "Identita aplikace" hello webového rozhraní API důvěřuje tohoto hello webové aplikace hello ověřeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="25233-398">In this “application identity” flow, hello web API trusts that hello web application authenticated hello user.</span></span> <span data-ttu-id="25233-399">Z tohoto důvodu se tento vzor nazývá důvěryhodný subsystém.</span><span class="sxs-lookup"><span data-stu-id="25233-399">For this reason, this pattern is called a trusted subsystem.</span></span> <span data-ttu-id="25233-400">Hello [diagramu na této stránce](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) popisuje, jak funguje tok poskytování autorizačních kódů.</span><span class="sxs-lookup"><span data-stu-id="25233-400">hello [diagram on this page](https://docs.microsoft.com/azure/active-directory/active-directory-protocols-oauth-code) describes how authorization code grant flow works.</span></span>

<span data-ttu-id="25233-401">V získání licence s omezení s tokenem, jsme jsou následující hello stejného vzoru důvěryhodný subsystém.</span><span class="sxs-lookup"><span data-stu-id="25233-401">In license acquisition with token restriction, we are following hello same trusted subsystem pattern.</span></span> <span data-ttu-id="25233-402">A hello licenční doručení služby ve službě Azure Media Services je hello webového rozhraní API prostředku hello "prostředek back-end" Webová aplikace musí tooaccess.</span><span class="sxs-lookup"><span data-stu-id="25233-402">And hello license delivery service in Azure Media Services is hello web API resource, hello “backend resource” a web application needs tooaccess.</span></span> <span data-ttu-id="25233-403">Kde je proto hello přístupový token?</span><span class="sxs-lookup"><span data-stu-id="25233-403">So where is hello access token?</span></span>

<span data-ttu-id="25233-404">Skutečně jsme se získání tokenu přístupu z Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-404">Indeed, we are obtaining access token from Azure AD.</span></span> <span data-ttu-id="25233-405">Po úspěšné ověření uživatele je vrácen autorizační kód.</span><span class="sxs-lookup"><span data-stu-id="25233-405">After successful user authentication, authorization code is returned.</span></span> <span data-ttu-id="25233-406">Hello autorizační kód se pak použije, společně s aplikací a ID klienta klíčem, tooexchange pro přístupový token.</span><span class="sxs-lookup"><span data-stu-id="25233-406">hello authorization code is then used, together with client ID and app key, tooexchange for access token.</span></span> <span data-ttu-id="25233-407">A hello přístupový token je pro přístup k aplikaci "ukazatel" ukazující nebo představuje službu doručování licencí Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="25233-407">And hello access token is for accessing a “pointer” application pointing or representing Azure Media Services license delivery service.</span></span>

<span data-ttu-id="25233-408">Budeme potřebovat tooregister a konfigurace hello "ukazatel" aplikace ve službě Azure AD podle následujících kroků hello:</span><span class="sxs-lookup"><span data-stu-id="25233-408">We need tooregister and configure hello “pointer” app in Azure AD by following hello steps below:</span></span>

1. <span data-ttu-id="25233-409">V klientovi hello Azure AD</span><span class="sxs-lookup"><span data-stu-id="25233-409">In hello Azure AD tenant</span></span>

   * <span data-ttu-id="25233-410">Přidání aplikace (prostředků) s adresou URL přihlašování:</span><span class="sxs-lookup"><span data-stu-id="25233-410">add an application (resource) with sign-on URL:</span></span>

   <span data-ttu-id="25233-411">https://[resource_name].azurewebsites.NET/ a</span><span class="sxs-lookup"><span data-stu-id="25233-411">https://[resource_name].azurewebsites.net/ and</span></span>

   * <span data-ttu-id="25233-412">Adresa URL ID aplikace:</span><span class="sxs-lookup"><span data-stu-id="25233-412">app ID URL:</span></span>

   <span data-ttu-id="25233-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span><span class="sxs-lookup"><span data-stu-id="25233-413">https://[aad_tenant_name].onmicrosoft.com/[resource_name];</span></span>
2. <span data-ttu-id="25233-414">Přidejte nový klíč pro aplikaci hello prostředků;</span><span class="sxs-lookup"><span data-stu-id="25233-414">Add a new key for hello resource app;</span></span>
3. <span data-ttu-id="25233-415">Aktualizujte soubor manifestu aplikace hello tak, aby vlastnost groupMembershipClaims hello má hello následující hodnoty: "groupMembershipClaims": "Vše",</span><span class="sxs-lookup"><span data-stu-id="25233-415">Update hello app manifest file so that hello groupMembershipClaims property has hello following value: "groupMembershipClaims": "All",</span></span>  
4. <span data-ttu-id="25233-416">V aplikaci Azure AD hello odkazující toohello player webové aplikace, v části hello "oprávnění tooother aplikace" přidejte hello prostředků aplikace, která byla přidána v kroku 1 výše.</span><span class="sxs-lookup"><span data-stu-id="25233-416">In hello Azure AD app pointing toohello player web app, in hello section “permissions tooother applications”, add hello resource app which was added in step 1 above.</span></span> <span data-ttu-id="25233-417">V části "delegovaná oprávnění" zkontrolujte zaškrtnutí "Přístup [resource_name]".</span><span class="sxs-lookup"><span data-stu-id="25233-417">Under “delegated permissions” check “Access [resource_name]” checkmark.</span></span> <span data-ttu-id="25233-418">To dává oprávnění webové aplikace hello toocreate přístupových tokenů pro přístup k prostředku aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="25233-418">This gives hello web app permission toocreate access tokens for accessing hello resource app.</span></span> <span data-ttu-id="25233-419">Měli byste to provést pro místní i nasazené verze webové aplikace hello Pokud vyvíjíte pomocí sady Visual Studio a Azure webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="25233-419">You should do this for both local and deployed version of hello web app if you are developing with Visual Studio and Azure web app.</span></span>

<span data-ttu-id="25233-420">Proto hello tokenu JWT vydaného Azure AD, je skutečně hello přístupového tokenu pro přístup k tomuto prostředku "ukazatel".</span><span class="sxs-lookup"><span data-stu-id="25233-420">Therefore, hello JWT token issued by Azure AD is indeed hello access token for accessing this “pointer” resource.</span></span>

### <a name="what-about-live-streaming"></a><span data-ttu-id="25233-421">Co se chystáte živě Streamovat?</span><span class="sxs-lookup"><span data-stu-id="25233-421">What about Live Streaming?</span></span>
<span data-ttu-id="25233-422">V hello výše má byla tato diskuse zaměřovat na prostředky na vyžádání.</span><span class="sxs-lookup"><span data-stu-id="25233-422">In hello above, our discussion has been focusing on on-demand assets.</span></span> <span data-ttu-id="25233-423">Co se chystáte živé streamování?</span><span class="sxs-lookup"><span data-stu-id="25233-423">What about live streaming?</span></span>

<span data-ttu-id="25233-424">Hello Dobrá zpráva je, že můžete použít přesně hello stejné návrhu a implementace pro ochranu živé streamování ve službě Azure Media Services tak, že považuje hello asset přidružený program jako "VOD asset".</span><span class="sxs-lookup"><span data-stu-id="25233-424">hello good news is that you can use exactly hello same design and implementation for protecting live streaming in Azure Media Services, by treating hello asset associated with a program as a “VOD asset”.</span></span>

<span data-ttu-id="25233-425">Konkrétně je dobře známý, toodo živé streamování ve službě Azure Media Services, budete potřebovat toocreate kanál a potom program v rámci kanálu hello.</span><span class="sxs-lookup"><span data-stu-id="25233-425">Specifically, it is well known that toodo live streaming in Azure Media Services, you need toocreate a channel, then a program under hello channel.</span></span> <span data-ttu-id="25233-426">programu hello toocreate, musíte toocreate prostředek, který bude obsahovat archivu živé hello programu hello.</span><span class="sxs-lookup"><span data-stu-id="25233-426">toocreate hello program, you need toocreate an asset which will contain hello live archive for hello program.</span></span> <span data-ttu-id="25233-427">V pořadí tooprovide CENC s více technologiemi DRM ochranu živý obsah hello, stačí toodo, je tooapply hello stejné asset toohello instalace/zpracování jako kdyby byl "VOD asset" před spuštěním programu hello.</span><span class="sxs-lookup"><span data-stu-id="25233-427">In order tooprovide CENC with multi-DRM protection of hello live content, all you need toodo, is tooapply hello same setup/processing toohello asset as if it was a “VOD asset” before you start hello program.</span></span>

### <a name="what-about-license-servers-outside-of-azure-media-services"></a><span data-ttu-id="25233-428">Co licenčních serverů mimo Azure Media Services?</span><span class="sxs-lookup"><span data-stu-id="25233-428">What about license servers outside of Azure Media Services?</span></span>
<span data-ttu-id="25233-429">Zákazníci mohou často investovaly do licence serverové farmy buď v svá vlastní data center nebo hostované poskytovateli služeb DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-429">Often, customers may have invested in license server farm either in their own data center or hosted by DRM service providers.</span></span> <span data-ttu-id="25233-430">Naštěstí Azure Media Services obsahu Protection vám umožní toooperate v režimu hybridní: obsah hostované a dynamicky chráněné v Azure Media Services, zatímco licence DRM se dodávají servery mimo Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="25233-430">Fortunately, Azure Media Services Content Protection allows you toooperate in hybrid mode: contents hosted and dynamically protected in Azure Media Services, while DRM licenses are delivered by servers outside Azure Media Services.</span></span> <span data-ttu-id="25233-431">V takovém případě jsou hello následující aspekty změny:</span><span class="sxs-lookup"><span data-stu-id="25233-431">In this case, there are hello following considerations of changes:</span></span>

1. <span data-ttu-id="25233-432">Hello služby tokenů zabezpečení potřebám tooissue tokeny, které jsou přijatelné a lze ověřit pomocí hello licence serverové farmy.</span><span class="sxs-lookup"><span data-stu-id="25233-432">hello Secure Token Service needs tooissue tokens which are acceptable and can be verified by hello license server farm.</span></span> <span data-ttu-id="25233-433">Například servery licence Widevine hello poskytované Axinom vyžaduje konkrétní token JWT, který obsahuje "nárocích zprávu".</span><span class="sxs-lookup"><span data-stu-id="25233-433">For example, hello Widevine license servers provided by Axinom requires a specific JWT token which contains “entitlement message”.</span></span> <span data-ttu-id="25233-434">Proto musíte toohave tokenů zabezpečení tooissue takový token JWT.</span><span class="sxs-lookup"><span data-stu-id="25233-434">Therefore, you need toohave an STS tooissue such JWT token.</span></span> <span data-ttu-id="25233-435">Autoři Hello dokončili takové implementace a hello informace naleznete v hello následující dokument v [centru dokumentace Azure](https://azure.microsoft.com/documentation/): [pomocí Axinom toodeliver Widevine licencí tooAzure Media Services](media-services-axinom-integration.md).</span><span class="sxs-lookup"><span data-stu-id="25233-435">hello authors have completed such an implementation and you can find hello details in hello following document in [Azure Documentation Center](https://azure.microsoft.com/documentation/): [Using Axinom toodeliver Widevine licenses tooAzure Media Services](media-services-axinom-integration.md).</span></span>
2. <span data-ttu-id="25233-436">Již nepotřebujete tooconfigure licenční doručení služby (ContentKeyAuthorizationPolicy) ve službě Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="25233-436">You no longer need tooconfigure license delivery service (ContentKeyAuthorizationPolicy) in Azure Media Services.</span></span> <span data-ttu-id="25233-437">Co je třeba toodo je tooprovide hello licence získání adresy URL (PlayReady, Widevine a FairPlay) při konfiguraci AssetDeliveryPolicy v nastavení šifrování CENC s více technologiemi DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-437">What you need toodo is tooprovide hello license acquisition URLs (for PlayReady, Widevine and FairPlay) when you configure AssetDeliveryPolicy in setting up CENC with multi-DRM.</span></span>

### <a name="what-if-i-want-toouse-a-custom-sts"></a><span data-ttu-id="25233-438">Co když chci, aby toouse vlastní službu tokenů zabezpečení?</span><span class="sxs-lookup"><span data-stu-id="25233-438">What if I want toouse a custom STS?</span></span>
<span data-ttu-id="25233-439">Může dojít z několika důvodů, které si zákazník může vybrat toouse vlastních tokenů zabezpečení (Secure Token Service) pro poskytování tokenů JWT.</span><span class="sxs-lookup"><span data-stu-id="25233-439">There could be a few reasons that a customer may choose toouse a custom STS (Secure Token Service) for providing JWT tokens.</span></span> <span data-ttu-id="25233-440">Některé z nich jsou:</span><span class="sxs-lookup"><span data-stu-id="25233-440">Some of them are:</span></span>

1. <span data-ttu-id="25233-441">Hello zprostředkovatele Identity (IDP) používané hello zákazníka nepodporuje službu tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="25233-441">hello Identity Provider (IDP) used by hello customer does not support STS.</span></span> <span data-ttu-id="25233-442">Vlastní službu tokenů zabezpečení v takovém případě může být možnost.</span><span class="sxs-lookup"><span data-stu-id="25233-442">In this case a custom STS may be an option.</span></span>
2. <span data-ttu-id="25233-443">Hello zákazníka může být nutné flexibilní nebo náročnější ovládací prvek v integraci služby tokenů zabezpečení do odběratele zákazníka účetním systémem.</span><span class="sxs-lookup"><span data-stu-id="25233-443">hello customer may need more flexible or tighter control in integrating STS with customer’s subscriber billing system.</span></span> <span data-ttu-id="25233-444">Například MVPD operátor může nabízet více balíčků OTT odběratele, jako je premium a basic, sportovní, operátor hello atd. může být vhodné toomatch hello deklarace do tokenu s balíčkem odběratele tak, aby pouze obsah v balíčku správné hello je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="25233-444">For example, an MVPD operator may offer multiple OTT subscriber packages such as premium, basic, sports, etc. hello operator may want toomatch hello claims in a token with a subscriber’s package so that only contents in hello right package is made available.</span></span> <span data-ttu-id="25233-445">V takovém případě vlastní službu tokenů zabezpečení poskytuje hello potřeby flexibilitu a řízení.</span><span class="sxs-lookup"><span data-stu-id="25233-445">In this case, a custom STS provides hello needed flexibility and control.</span></span>

<span data-ttu-id="25233-446">Dvě změny potřebovat toobe provedené při použití vlastních tokenů zabezpečení:</span><span class="sxs-lookup"><span data-stu-id="25233-446">Two changes need toobe made when using a custom STS:</span></span>

1. <span data-ttu-id="25233-447">Pokud nakonfigurujete službu doručování licencí pro určitý prostředek, je potřeba toospecify hello zabezpečení klíč používaný k ověření službou hello vlastních tokenů zabezpečení (Další informace níž) namísto hello aktuální klíč ze služby Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="25233-447">When configuring license delivery service for an asset, you need toospecify hello security key used for verification by hello custom STS (more details below) instead of hello current key from Azure Active Directory.</span></span>
2. <span data-ttu-id="25233-448">Když se vygeneruje JTW token, je určen klíč zabezpečení místo hello privátní klíč certifikátu hello aktuální X509 v Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="25233-448">When a JTW token is generated, a security key is specified instead of hello private key of hello current X509 certificate in Azure Active Directory.</span></span>

<span data-ttu-id="25233-449">Existují dva typy bezpečnostních klíčů:</span><span class="sxs-lookup"><span data-stu-id="25233-449">There are two types of security keys:</span></span>

1. <span data-ttu-id="25233-450">Symetrický klíč: hello stejný klíč se používá pro generování a ověřování token JWT;</span><span class="sxs-lookup"><span data-stu-id="25233-450">Symmetric key: hello same key is used for both generating and verifying a JWT token;</span></span>
2. <span data-ttu-id="25233-451">Asymetrický klíč: páru veřejného a privátního klíče RSA ve X509 certifikát se používá s privátním klíčem pro šifrování nebo generování tokenů JWT token a hello veřejný klíč k ověření tokenu hello.</span><span class="sxs-lookup"><span data-stu-id="25233-451">Asymmetric key: a public-private key pair in an X509 certificate is used with private key for encrypting/generating a JWT token and hello public key for verifying hello token.</span></span>

#### <a name="tech-note"></a><span data-ttu-id="25233-452">Technická poznámka</span><span class="sxs-lookup"><span data-stu-id="25233-452">Tech note</span></span>
<span data-ttu-id="25233-453">Pokud používáte rozhraní .NET Framework / C# jako svou platformu vývoj hello X509 certifikát používaný pro zabezpečení asymetrický klíč musí mít klíč délku aspoň 2048.</span><span class="sxs-lookup"><span data-stu-id="25233-453">If you use .NET Framework/C# as your development platform, hello X509 certificate used for asymmetric security key must have key length at least 2048.</span></span> <span data-ttu-id="25233-454">Toto je požadavek třídy hello System.IdentityModel.Tokens.X509AsymmetricSecurityKey v rozhraní .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="25233-454">This is a requirement of hello class System.IdentityModel.Tokens.X509AsymmetricSecurityKey in .NET Framework.</span></span> <span data-ttu-id="25233-455">Jinak bude vyvolána hello následující výjimky:</span><span class="sxs-lookup"><span data-stu-id="25233-455">Otherwise, hello following exception will be thrown:</span></span>

<span data-ttu-id="25233-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' pro podepisování nemůže být menší než '2048' bits.</span><span class="sxs-lookup"><span data-stu-id="25233-456">IDX10630: hello 'System.IdentityModel.Tokens.X509AsymmetricSecurityKey' for signing cannot be smaller than '2048' bits.</span></span>

## <a name="hello-completed-system-and-test"></a><span data-ttu-id="25233-457">Hello dokončit systému a testování</span><span class="sxs-lookup"><span data-stu-id="25233-457">hello completed system and test</span></span>
<span data-ttu-id="25233-458">Vám ukážeme v systému začátku do konce hello dokončit několik scénářů, tak, aby čtečky může mít základní "formát" hello chování před získáním účet přihlášení.</span><span class="sxs-lookup"><span data-stu-id="25233-458">We will walk through a few scenarios in hello completed end-to-end system so that readers can have a basic “picture” of hello behavior before getting a login account.</span></span>

<span data-ttu-id="25233-459">Hello player webové aplikace a její přihlášení najdete [zde](https://openidconnectweb.azurewebsites.net/).</span><span class="sxs-lookup"><span data-stu-id="25233-459">hello player web application and its login can be found [here](https://openidconnectweb.azurewebsites.net/).</span></span>

<span data-ttu-id="25233-460">Pokud je třeba je "zjistili" scénář: video prostředky hostované ve službě Azure Media Services, které jsou buď nechráněné nebo DRM chráněný, ale bez ověření pomocí tokenu (vydávání licencí toowhoever, o to požádá), můžete otestovat ji bez přihlášení (podle přepínání tooHTTP Pokud video streamování přes protokol HTTP).</span><span class="sxs-lookup"><span data-stu-id="25233-460">If what you need is “non-integrated” scenario: video assets hosted in Azure Media Services which are either unprotected, or DRM protected but without token authentication (issuing a license toowhoever requesting it), you can test it without login (by switching tooHTTP if your video streaming is over HTTP).</span></span>

<span data-ttu-id="25233-461">Pokud je třeba je integrovaný scénář začátku do konce: video prostředky je v části dynamické DRM ochrany ve službě Azure Media Services pomocí tokenu ověření a token JWT generován službou Azure AD, je třeba toologin.</span><span class="sxs-lookup"><span data-stu-id="25233-461">If what you need is end-to-end integrated scenario: video assets is under dynamic DRM protection in Azure Media Services, with token authentication and JWT token being generated by Azure AD, you need toologin.</span></span>

### <a name="user-login"></a><span data-ttu-id="25233-462">Přihlášení uživatele</span><span class="sxs-lookup"><span data-stu-id="25233-462">User login</span></span>
<span data-ttu-id="25233-463">Pořadí tootest hello začátku do konce integrované DRM systému je nutné toohave "účet", nebo přidat.</span><span class="sxs-lookup"><span data-stu-id="25233-463">In order tootest hello end-to-end integrated DRM system, you need toohave an “account” created or added.</span></span>

<span data-ttu-id="25233-464">Který účet?</span><span class="sxs-lookup"><span data-stu-id="25233-464">What account?</span></span>

<span data-ttu-id="25233-465">I když služba Azure původně umožňovala přístup pouze uživatelé s účtem Microsoft, nyní umožňuje přístup uživatelům z obou systémů.</span><span class="sxs-lookup"><span data-stu-id="25233-465">Although Azure originally allowed access only by Microsoft account users, it now allows access by users from both systems.</span></span> <span data-ttu-id="25233-466">K tomu bylo potřeba tak, že všechny vlastnosti služby azur hello Azure AD pro ověřování s Azure AD, která ověřuje organizační uživatele a tím, že vytvoříte vztah federace kde Azure AD důvěřuje systémem identit uživatelů účtů Microsoft hello tooauthenticate spotřebitelské uživatele.</span><span class="sxs-lookup"><span data-stu-id="25233-466">This was done by having all hello Azure properties trust Azure AD for authentication, having Azure AD authenticate organizational users, and by creating a federation relationship where Azure AD trusts hello Microsoft account consumer identity system tooauthenticate consumer users.</span></span> <span data-ttu-id="25233-467">Azure AD v důsledku toho je možné tooauthenticate účty Microsoft "guest" a také "nativní" účty Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-467">As a result, Azure AD is able tooauthenticate “guest” Microsoft accounts as well as “native” Azure AD accounts.</span></span>

<span data-ttu-id="25233-468">Vzhledem k tomu, že Azure AD důvěřuje domény účtu Microsoft (MSA), můžete přidat všechny účty z jakéhokoli z následujících domén toohello vlastní Azure AD hello klienta a použijte účet toologin hello:</span><span class="sxs-lookup"><span data-stu-id="25233-468">Since Azure AD trusts Microsoft Account (MSA) domain, you can add any accounts from any of hello following domains toohello custom Azure AD tenant and use hello account toologin:</span></span>

| <span data-ttu-id="25233-469">**Název domény**</span><span class="sxs-lookup"><span data-stu-id="25233-469">**Domain Name**</span></span> | <span data-ttu-id="25233-470">**Domény**</span><span class="sxs-lookup"><span data-stu-id="25233-470">**Domain**</span></span> |
| --- | --- |
| <span data-ttu-id="25233-471">**Doména klienta vlastní Azure AD**</span><span class="sxs-lookup"><span data-stu-id="25233-471">**Custom Azure AD tenant domain**</span></span> |<span data-ttu-id="25233-472">somename.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="25233-472">somename.onmicrosoft.com</span></span> |
| <span data-ttu-id="25233-473">**Podnikové doméně**</span><span class="sxs-lookup"><span data-stu-id="25233-473">**Corporate domain**</span></span> |<span data-ttu-id="25233-474">Microsoft.com</span><span class="sxs-lookup"><span data-stu-id="25233-474">microsoft.com</span></span> |
| <span data-ttu-id="25233-475">**Účet Microsoft (MSA) domény**</span><span class="sxs-lookup"><span data-stu-id="25233-475">**Microsoft Account (MSA) domain**</span></span> |<span data-ttu-id="25233-476">live.com, Outlook.com, hotmail.com</span><span class="sxs-lookup"><span data-stu-id="25233-476">outlook.com, live.com, hotmail.com</span></span> |

<span data-ttu-id="25233-477">Může kontaktovat kterýkoli z hello autoři toohave účet vytvořit nebo přidat za vás.</span><span class="sxs-lookup"><span data-stu-id="25233-477">You may contact any of hello authors toohave an account created or added for you.</span></span>

<span data-ttu-id="25233-478">Níže jsou snímky obrazovky hello stránek jiné přihlašovací údaje používané účty v jiné doméně.</span><span class="sxs-lookup"><span data-stu-id="25233-478">Below are hello screenshots of different login pages used by different domain accounts.</span></span>

<span data-ttu-id="25233-479">**Vlastní Azure AD klienta účet domény**: V tomto případě vidíte hello přizpůsobená přihlašovací stránku domény klienta hello vlastní Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-479">**Custom Azure AD tenant domain account**: In this case, you see hello customized login page of hello custom Azure AD tenant domain.</span></span>

![Účet domény klienta vlastní Azure AD](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain1.png)

<span data-ttu-id="25233-481">**Microsoft doménový účet s čipovou kartu**: V tomto případě vidíte hello přihlašovací stránky přizpůsobený podle Microsoft podnikové IT s dvoufaktorové ověřování.</span><span class="sxs-lookup"><span data-stu-id="25233-481">**Microsoft domain account with smart card**: In this case you see hello login page customized by Microsoft corporate IT with two-factor authentication.</span></span>

![Účet domény klienta vlastní Azure AD](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain2.png)

<span data-ttu-id="25233-483">**Účet Microsoft (MSA)**: V tomto případě se zobrazí stránka přihlášení hello Account Microsoft pro spotřebitele.</span><span class="sxs-lookup"><span data-stu-id="25233-483">**Microsoft Account (MSA)**: In this case, you see hello login page of Microsoft Account for consumers.</span></span>

![Účet domény klienta vlastní Azure AD](./media/media-services-cenc-with-multidrm-access-control/media-services-ad-tenant-domain3.png)

### <a name="using-encrypted-media-extensions-for-playready"></a><span data-ttu-id="25233-485">Pomocí rozšíření šifrované média pro PlayReady</span><span class="sxs-lookup"><span data-stu-id="25233-485">Using Encrypted Media Extensions for PlayReady</span></span>
<span data-ttu-id="25233-486">Moderní prohlížeč s šifrované média rozšíření (EME) pro podporu, jako je třeba prohlížeč Internet Exploreru 11 na Windows 8.1 nebo vyšší a Microsoft Edge ve Windows 10, PlayReady bude PlayReady hello základní DRM pro EME.</span><span class="sxs-lookup"><span data-stu-id="25233-486">On a modern browser with Encrypted Media Extensions (EME) for PlayReady support, such as IE 11 on Windows 8.1 and up, and Microsoft Edge browser on Windows 10, PlayReady will be hello underlying DRM for EME.</span></span>

![Použití EME pro PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready1.png)

<span data-ttu-id="25233-488">oblast tmavý player Hello je z důvodu toohello fakt, že PlayReady ochrana chrání jeden provádění snímek obrazovky chráněné videa z.</span><span class="sxs-lookup"><span data-stu-id="25233-488">hello dark player area is due toohello fact that PlayReady protection prevents one from making screen capture of protected video.</span></span>

<span data-ttu-id="25233-489">Hello následující obrazovka ukazuje hello player modulů plug-in a MSE/EME podpory.</span><span class="sxs-lookup"><span data-stu-id="25233-489">hello following screen shows hello player plugins and MSE/EME support.</span></span>

![Použití EME pro PlayReady](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-playready2.png)

<span data-ttu-id="25233-491">EME v Microsoft Edge a aplikace Internet Explorer 11 ve Windows 10 umožňuje vyvolání z [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) na zařízení s Windows 10, které ji podporují.</span><span class="sxs-lookup"><span data-stu-id="25233-491">EME in Microsoft Edge and IE 11 on Windows 10 allows invoking of [PlayReady SL3000](https://www.microsoft.com/playready/features/EnhancedContentProtection.aspx/) on Windows 10 devices which support it.</span></span> <span data-ttu-id="25233-492">PlayReady SL3000 odemkne hello toku obsahu rozšířené premium (4K, záhlaví, atd.) a nové modely doručování obsahu (časná okna pro rozšířený obsah).</span><span class="sxs-lookup"><span data-stu-id="25233-492">PlayReady SL3000 unlocks hello flow of enhanced premium content (4K, HDR, etc.) and new content delivery models (early window for Enhanced Content).</span></span>

<span data-ttu-id="25233-493">Zaměřit se na zařízení se systémem Windows hello: PlayReady je hello pouze DRM v HW hello k dispozici na zařízení se systémem Windows (PlayReady SL3000).</span><span class="sxs-lookup"><span data-stu-id="25233-493">Focus on hello Windows devices: PlayReady is hello only DRM in hello HW available on Windows devices (PlayReady SL3000).</span></span> <span data-ttu-id="25233-494">Streamování služby můžete použít PlayReady prostřednictvím EME nebo aplikaci UWP a nabízí vyšší kvalitu videa pomocí PlayReady SL3000 než jiné DRM.</span><span class="sxs-lookup"><span data-stu-id="25233-494">A streaming service can use PlayReady through EME or through a UWP application and offer a higher video quality using PlayReady SL3000 than another DRM.</span></span> <span data-ttu-id="25233-495">Obvykle 2K obsahu budou procházet skrz Chrome nebo Firefox a 4 kB obsahu prostřednictvím Microsoft Edge/IE11 nebo aplikace pro UPW v hello stejného zařízení (v závislosti na nastavení služby a implementaci).</span><span class="sxs-lookup"><span data-stu-id="25233-495">Typically, 2K content will flow through Chrome or Firefox, and 4K content through Microsoft Edge/IE11 or a UWP application on hello same device (depending on service settings and implementation).</span></span>

#### <a name="using-eme-for-widevine"></a><span data-ttu-id="25233-496">Použití EME pro Widevine</span><span class="sxs-lookup"><span data-stu-id="25233-496">Using EME for Widevine</span></span>
<span data-ttu-id="25233-497">Moderní prohlížeč s podporou EME nebo Widevine, jako je například Chrome 41 + na Windows 10, Windows 8.1, Mac OSX Yosemite a Chrome na Android bodu 4.4.4 je Google Widevine DRM za EME hello.</span><span class="sxs-lookup"><span data-stu-id="25233-497">On a modern browser with EME/Widevine support, such as Chrome 41+ on Windows 10, Windows 8.1, Mac OSX Yosemite, and Chrome on Android 4.4.4, Google Widevine is hello DRM behind EME.</span></span>

![Použití EME pro Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine1.png)

<span data-ttu-id="25233-499">Všimněte si, že Widevine nebrání z provedení snímek obrazovky chráněné videa.</span><span class="sxs-lookup"><span data-stu-id="25233-499">Notice that Widevine does not prevent one from making screen capture of protected video.</span></span>

![Použití EME pro Widevine](./media/media-services-cenc-with-multidrm-access-control/media-services-eme-for-widevine2.png)

### <a name="not-entitled-users"></a><span data-ttu-id="25233-501">Není nárok uživatelé</span><span class="sxs-lookup"><span data-stu-id="25233-501">Not entitled users</span></span>
<span data-ttu-id="25233-502">Pokud uživatel není členem skupiny "Uživatelé s názvem", hello uživatel nebude moct toopass "Kontrola nárocích" a hello více technologiemi DRM licenční služby odmítne tooissue hello požadovanou licenci, jak je uvedeno níže.</span><span class="sxs-lookup"><span data-stu-id="25233-502">If a user is not a member of "Entitled Users" group, hello user will not be able toopass “entitlement check” and hello multi-DRM license service will refuse tooissue hello requested license as shown below.</span></span> <span data-ttu-id="25233-503">Hello podrobný popis je "získat licenci se nezdařilo", což je tak, jak má.</span><span class="sxs-lookup"><span data-stu-id="25233-503">hello detailed description is “License acquire failed”, which is as designed.</span></span>

![Zrušení nárok uživatelé](./media/media-services-cenc-with-multidrm-access-control/media-services-unentitledusers.png)

### <a name="running-custom-secure-token-service"></a><span data-ttu-id="25233-505">Spuštění vlastního tokenu služby Zabezpečené</span><span class="sxs-lookup"><span data-stu-id="25233-505">Running custom Secure Token Service</span></span>
<span data-ttu-id="25233-506">Pro scénář hello spuštěných vlastní zabezpečení tokenu služby (STS) bude hello JWT token vystavené službou tokenů zabezpečení vlastní hello pomocí buď symetrický, nebo asymetrický klíč.</span><span class="sxs-lookup"><span data-stu-id="25233-506">For hello scenario of running custom Secure Token Service (STS), hello JWT token will be issued by hello custom STS using either symmetric or asymmetric key.</span></span>

<span data-ttu-id="25233-507">Hello případ použití symetrického klíče (pomocí chromu):</span><span class="sxs-lookup"><span data-stu-id="25233-507">hello case of using symmetric key (using Chrome):</span></span>

![Spuštění vlastní službu tokenů zabezpečení](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts1.png)

<span data-ttu-id="25233-509">Hello případ použití asymetrický klíč prostřednictvím X509 certifikátu (s použitím moderní prohlížeče Microsoft).</span><span class="sxs-lookup"><span data-stu-id="25233-509">hello case of using asymmetric key via an X509 certificate (using Microsoft modern browser).</span></span>

![Spuštění vlastní službu tokenů zabezpečení](./media/media-services-cenc-with-multidrm-access-control/media-services-running-sts2.png)

<span data-ttu-id="25233-511">V obou hello výše případech hello uživatel ověřování zůstane stejný – prostřednictvím služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-511">In both of hello above cases, user authentication stays hello same – through Azure AD.</span></span> <span data-ttu-id="25233-512">Hello jediným rozdílem je, že tokeny JWT vydal hello vlastní službu tokenů zabezpečení místo Azure AD.</span><span class="sxs-lookup"><span data-stu-id="25233-512">hello only difference is that JWT tokens are issued by hello custom STS instead of Azure AD.</span></span> <span data-ttu-id="25233-513">Samozřejmě, při konfiguraci ochrany dynamické šifrování CENC, omezení hello služeb doručování licence Určuje typ hello JWT token, buď symetrický, nebo asymetrický klíč.</span><span class="sxs-lookup"><span data-stu-id="25233-513">Of course, when configuring dynamic CENC protection, hello restriction of license delivery service specifies hello type of JWT token, either symmetric or asymmetric key.</span></span>

## <a name="summary"></a><span data-ttu-id="25233-514">Souhrn</span><span class="sxs-lookup"><span data-stu-id="25233-514">Summary</span></span>
<span data-ttu-id="25233-515">V tomto dokumentu jsme probrali CENC s více native DRM a řízení přístupu prostřednictvím tokenu ověřování: návrh a jeho implementace pomocí Azure, Azure Media Services a Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="25233-515">In this document, we discussed CENC with multi-native-DRM and access control via token authentication: its design and its implementation using Azure, Azure Media Services and Azure Media Player.</span></span>

* <span data-ttu-id="25233-516">Návrh odkazu se zobrazí, který obsahuje všechny komponenty potřebné hello v subsystému DRM nebo CENC;</span><span class="sxs-lookup"><span data-stu-id="25233-516">A reference design is presented which contains all hello necessary components in a DRM/CENC subsystem;</span></span>
* <span data-ttu-id="25233-517">Odkaz na implementaci na Azure, Azure Media Services a Azure Media Player.</span><span class="sxs-lookup"><span data-stu-id="25233-517">A reference implementation on Azure, Azure Media Services and Azure Media Player.</span></span>
* <span data-ttu-id="25233-518">Některá témata přímo účastní hello návrhu a implementace jsou také popsány.</span><span class="sxs-lookup"><span data-stu-id="25233-518">Some topics directly involved in hello design and implementation are also discussed.</span></span>

## <a name="media-services-learning-paths"></a><span data-ttu-id="25233-519">Mapy kurzů ke službě Media Services</span><span class="sxs-lookup"><span data-stu-id="25233-519">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="25233-520">Poskytnutí zpětné vazby</span><span class="sxs-lookup"><span data-stu-id="25233-520">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]
 

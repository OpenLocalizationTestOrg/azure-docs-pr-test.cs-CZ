---
title: "Azure Media Services fragmentovaných MP4 live ingestování specifikace | Microsoft Docs"
description: "Tato specifikace popisuje protokol a formát pro fragmentovaných na základě MP4 živé streamování přijímání pro Azure Media Services. Azure Media Services můžete do datového proudu živé události a všesměrovým vysíláním obsah v reálném čase pomocí služby Azure jako cloudová platforma. Tento dokument taky popisuje osvědčené postupy pro vytváření vysoce redundantní a robustní za provozu ingestování mechanismy."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 6250b73504bec765b8299060a29e84e771791cc9
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="46aa1-105">Azure Media Services fragmentovaných MP4 live ingestování specifikace</span><span class="sxs-lookup"><span data-stu-id="46aa1-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="46aa1-106">Tato specifikace popisuje protokol a formát pro fragmentovaných na základě MP4 živé streamování přijímání pro Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="46aa1-106">This specification describes the protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="46aa1-107">Služba Media Services poskytuje služba živého streamování, které zákazníci mohou používat stream živé události a všesměrového vysílání obsah v reálném čase pomocí služby Azure jako cloudová platforma.</span><span class="sxs-lookup"><span data-stu-id="46aa1-107">Media Services provides a live streaming service that customers can use to stream live events and broadcast content in real time by using Azure as the cloud platform.</span></span> <span data-ttu-id="46aa1-108">Tento dokument taky popisuje osvědčené postupy pro vytváření vysoce redundantní a robustní za provozu ingestování mechanismy.</span><span class="sxs-lookup"><span data-stu-id="46aa1-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="46aa1-109">1. Zápis shoda</span><span class="sxs-lookup"><span data-stu-id="46aa1-109">1. Conformance notation</span></span>
<span data-ttu-id="46aa1-110">Klíč slova ",""Nesmí," "VYŽADOVÁNA," "SHALL", "se nesmí," "SHOULD", "By neměl," "Doporučené" "PRAVDĚPODOBNĚ," a "Volitelné" v tomto dokumentu se budou interpretovat popsané v dokumentu RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="46aa1-110">The key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are to be interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="46aa1-111">2. Diagram služby</span><span class="sxs-lookup"><span data-stu-id="46aa1-111">2. Service diagram</span></span>
<span data-ttu-id="46aa1-112">Následující diagram ukazuje základní architektuře služby živého streamování ve službě Media Services:</span><span class="sxs-lookup"><span data-stu-id="46aa1-112">The following diagram shows the high-level architecture of the live streaming service in Media Services:</span></span>

1. <span data-ttu-id="46aa1-113">Za provozu kodér nabízených oznámení za provozu kanály pro kanály, které jsou vytvořeny a zřízené prostřednictvím Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="46aa1-113">A live encoder pushes live feeds to channels that are created and provisioned via the Azure Media Services SDK.</span></span>
2. <span data-ttu-id="46aa1-114">Kanály, programů a koncových bodů streamování ve službě Media Services zpracování všech funkcí živého streamování, včetně ingestování, formátování, DVR, zabezpečení, škálovatelnosti a redundance v cloudu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-114">Channels, programs, and streaming endpoints in Media Services handle all the live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="46aa1-115">Zákazníci mohou volitelně k nasazení služby Azure Content Delivery Network vrstva mezi koncový bod streamování a koncové body klientů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-115">Optionally, customers can choose to deploy an Azure Content Delivery Network layer between the streaming endpoint and the client endpoints.</span></span>
4. <span data-ttu-id="46aa1-116">Datový proud koncové body klienta z koncového bodu streamování pomocí protokolů HTTP adaptivní streamování.</span><span class="sxs-lookup"><span data-stu-id="46aa1-116">Client endpoints stream from the streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="46aa1-117">Mezi příklady patří Microsoft technologie Smooth Streaming, dynamické adaptivní datové proudy přes protokol HTTP (DASH nebo MPEG-DASH) a Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="46aa1-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![ingestování toku][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="46aa1-119">3. Bitový proud formátu – ISO 14496-12 fragmentovaný soubor MP4</span><span class="sxs-lookup"><span data-stu-id="46aa1-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="46aa1-120">Přenosový formát pro živé streamování ingestování popsané v tomto dokumentu je založena na [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="46aa1-120">The wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="46aa1-121">Podrobné vysvětlení fragmentovaných formátu MP4 a rozšíření jak pro soubory na vyžádání video-on-demand a přijímat živé streamování najdete v tématu [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="46aa1-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="46aa1-122">Za provozu ingestování definice formátu</span><span class="sxs-lookup"><span data-stu-id="46aa1-122">Live ingest format definitions</span></span>
<span data-ttu-id="46aa1-123">Následující seznam popisuje speciální formát, který definice, které platí pro live ingestování do služby Azure Media Services:</span><span class="sxs-lookup"><span data-stu-id="46aa1-123">The following list describes special format definitions that apply to live ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="46aa1-124">**Ftyp**, **Live pole Manifest serveru**, a **moov** polí, musí se poslat spolu s každou žádostí (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="46aa1-124">The **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="46aa1-125">V těchto polích, musí se poslat na začátku datového proudu a ingestování kdykoli kodér musíte znovu připojit ke obnovit datového proudu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-125">These boxes MUST be sent at the beginning of the stream and any time the encoder must reconnect to resume stream ingest.</span></span> <span data-ttu-id="46aa1-126">Další informace najdete v části 6 v [1].</span><span class="sxs-lookup"><span data-stu-id="46aa1-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="46aa1-127">Oddíl 3.3.2 v [1] definuje volitelné pole názvem **StreamManifestBox** pro za provozu ingestování.</span><span class="sxs-lookup"><span data-stu-id="46aa1-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="46aa1-128">Z důvodu logice směrování pro vyrovnávání zatížení Azure pomocí toto pole je zastaralé.</span><span class="sxs-lookup"><span data-stu-id="46aa1-128">Due to the routing logic of the Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="46aa1-129">Pole není by měla být k dispozici při příjem ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="46aa1-129">The box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="46aa1-130">Pokud toto pole je přítomen, Media Services je bezobslužně ignoruje.</span><span class="sxs-lookup"><span data-stu-id="46aa1-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="46aa1-131">**TrackFragmentExtendedHeaderBox** musí být k dispozici pro každý fragment pole definovaná v 3.2.3.2 v [1].</span><span class="sxs-lookup"><span data-stu-id="46aa1-131">The **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="46aa1-132">Verze 2 **TrackFragmentExtendedHeaderBox** pole se má použít k vygenerování médiu segmentech, které mají stejné adresy URL v několika datových centrech.</span><span class="sxs-lookup"><span data-stu-id="46aa1-132">Version 2 of the **TrackFragmentExtendedHeaderBox** box SHOULD be used to generate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="46aa1-133">Pole indexu fragment je REQUIRED mezi datacenter převzetí služeb při selhání na základě indexu streamování formátů, jako je například Apple HLS a na základě indexu MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="46aa1-133">The fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="46aa1-134">Pokud chcete povolit převzetí služeb při selhání mezi datacenter, fragment index musí synchronizovat napříč více kodéry a zvýší o 1 pro každý fragment následných média, dokonce i v jiných kodér restartování nebo selhání.</span><span class="sxs-lookup"><span data-stu-id="46aa1-134">To enable cross-datacenter failover, the fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="46aa1-135">Oddíl 3.3.6 v [1] definuje pole s názvem **MovieFragmentRandomAccessBox** (**mfra**), mohou být odeslány na konci za provozu přijímání znamenat end z stream (SESTAVENÁ) do kanálu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at the end of live ingestion to indicate end-of-stream (EOS) to the channel.</span></span> <span data-ttu-id="46aa1-136">Z důvodu logice ingestování Media Services, je pomocí SESTAVENÁ zastaralé a **mfra** pole pro přijímání za provozu by neměla být odeslána.</span><span class="sxs-lookup"><span data-stu-id="46aa1-136">Due to the ingest logic of Media Services, using EOS is deprecated, and the **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="46aa1-137">Pokud se odeslat, Media Services ji bezobslužně ignoruje.</span><span class="sxs-lookup"><span data-stu-id="46aa1-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="46aa1-138">Pokud chcete resetovat stav bodu ingestování, doporučujeme použít [resetování kanálu](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="46aa1-138">To reset the state of the ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="46aa1-139">Také doporučujeme použít [zastavit Program](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) na konec prezentace a datový proud.</span><span class="sxs-lookup"><span data-stu-id="46aa1-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) to end a presentation and stream.</span></span>
6. <span data-ttu-id="46aa1-140">Doba trvání fragment MP4 by měla být konstantní ke snížení velikosti manifesty klientů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-140">The MP4 fragment duration SHOULD be constant, to reduce the size of the client manifests.</span></span> <span data-ttu-id="46aa1-141">Konstantní MP4 fragment trvání taky zlepšuje heuristiky stažení klienta prostřednictvím opakujte značky.</span><span class="sxs-lookup"><span data-stu-id="46aa1-141">A constant MP4 fragment duration also improves client download heuristics through the use of repeat tags.</span></span> <span data-ttu-id="46aa1-142">Doba trvání může kolísá kompenzovat kmitočet celé číslo.</span><span class="sxs-lookup"><span data-stu-id="46aa1-142">The duration MAY fluctuate to compensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="46aa1-143">Doba trvání MP4 fragment, musí být mezi přibližně 2 až 6 sekund.</span><span class="sxs-lookup"><span data-stu-id="46aa1-143">The MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="46aa1-144">MP4 fragmentovat časová razítka a indexy (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` a `fragment_index`) by MĚL doručení ve vzestupném pořadí.</span><span class="sxs-lookup"><span data-stu-id="46aa1-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="46aa1-145">Sice odolné vůči duplicitní fragmenty Media Services, má omezenou schopnost změnit pořadí fragmenty podle časovou osu média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-145">Although Media Services is resilient to duplicate fragments, it has limited ability to reorder fragments according to the media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="46aa1-146">4. Formát protokolu – HTTP</span><span class="sxs-lookup"><span data-stu-id="46aa1-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="46aa1-147">ISO fragmentovaný soubor MP4 na základě za provozu ingestování pro Media Services využívá standardní požadavku HTTP POST dlouho běžící k přenosu kódovaného média data, která je součástí fragmentovaných formátu MP4 ke službě.</span><span class="sxs-lookup"><span data-stu-id="46aa1-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request to transmit encoded media data that is packaged in fragmented MP4 format to the service.</span></span> <span data-ttu-id="46aa1-148">Každý HTTP POST odešle úplná fragmentovaný proud MP4 ("stream"), od začátku s polí hlavičky (**ftyp**, **Live pole Manifest serveru**, a **moov** polí ) a pokračujte v sekvenci fragmenty (**moof** a **mdat** polí).</span><span class="sxs-lookup"><span data-stu-id="46aa1-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from the beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="46aa1-149">Syntaxe adresy URL pro požadavek HTTP POST naleznete v části in 9.2 [1].</span><span class="sxs-lookup"><span data-stu-id="46aa1-149">For URL syntax for the HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="46aa1-150">Příklad adresy URL POST je:</span><span class="sxs-lookup"><span data-stu-id="46aa1-150">An example of the POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="46aa1-151">Požadavky</span><span class="sxs-lookup"><span data-stu-id="46aa1-151">Requirements</span></span>
<span data-ttu-id="46aa1-152">Zde jsou uvedeny podrobné požadavky:</span><span class="sxs-lookup"><span data-stu-id="46aa1-152">Here are the detailed requirements:</span></span>

1. <span data-ttu-id="46aa1-153">Kodér měli začít vysílání pomocí stejné adresy URL přijímání odeslání požadavku HTTP POST se prázdný "textem" (nulové délky obsahu).</span><span class="sxs-lookup"><span data-stu-id="46aa1-153">The encoder SHOULD start the broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using the same ingestion URL.</span></span> <span data-ttu-id="46aa1-154">To může pomoct kodér rychle zjistit, jestli koncový bod přijímání za provozu je platný, a pokud neexistují žádné ověřování nebo jinými podmínkami vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="46aa1-154">This can help the encoder quickly detect whether the live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="46aa1-155">Na protokolu HTTP server nelze odeslat zpět odpovědi HTTP dokud není přijata žádost o včetně textu POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-155">Per HTTP protocol, the server can't send back an HTTP response until the entire request, including the POST body, is received.</span></span> <span data-ttu-id="46aa1-156">Vzhledem k povaze dlouho běžící živé události, bez tohoto kroku kodér nemusí být schopna zjistit všechny chyby, dokud dokončením odeslání všechna data.</span><span class="sxs-lookup"><span data-stu-id="46aa1-156">Given the long-running nature of a live event, without this step, the encoder might not be able to detect any error until it finishes sending all the data.</span></span>
2. <span data-ttu-id="46aa1-157">Kodér musí zpracovat žádné chyby nebo výzev ověřování z důvodu (1).</span><span class="sxs-lookup"><span data-stu-id="46aa1-157">The encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="46aa1-158">Pokud (1) úspěšné odpovědi 200, pokračovat.</span><span class="sxs-lookup"><span data-stu-id="46aa1-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="46aa1-159">Kodér musí začínat fragmentovaný proud MP4 nový požadavek HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-159">The encoder MUST start a new HTTP POST request with the fragmented MP4 stream.</span></span> <span data-ttu-id="46aa1-160">Do polí hlavičky, za nímž následuje fragmenty musí začínat datové části.</span><span class="sxs-lookup"><span data-stu-id="46aa1-160">The payload MUST start with the header boxes, followed by fragments.</span></span> <span data-ttu-id="46aa1-161">Všimněte si, že **ftyp**, **Live pole Manifest serveru**, a **moov** polí (v tomto pořadí), musí se poslat s každou žádostí, i v případě, že kodér musíte znovu připojit, protože předchozí Požadavek byl ukončen před konec datového proudu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-161">Note that the **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if the encoder must reconnect because the previous request was terminated prior to the end of the stream.</span></span> 
4. <span data-ttu-id="46aa1-162">Kodér musí používat kódování pro odesílání, protože není možné předpovědět celou délku obsahu živé události bloku přenosu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-162">The encoder MUST use chunked transfer encoding for uploading, because it’s impossible to predict the entire content length of the live event.</span></span>
5. <span data-ttu-id="46aa1-163">Pokud události myši, po odeslání poslední fragment kodér musí končit řádně blokové kódování sekvenci zpráv (většina zásobníky klienta HTTP zpracování ji automaticky) přenosu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-163">When the event is over, after sending the last fragment, the encoder MUST gracefully end the chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="46aa1-164">Kodér musí čekat na službu, kterou chcete návratový kód konečné odpovědi a pak ukončit připojení.</span><span class="sxs-lookup"><span data-stu-id="46aa1-164">The encoder MUST wait for the service to return the final response code, and then terminate the connection.</span></span> 
6. <span data-ttu-id="46aa1-165">Kodér nesmí použít `Events()` podstatné jméno, jak je popsáno v 9.2 in [1] pro přijímání za provozu ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="46aa1-165">The encoder MUST NOT use the `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="46aa1-166">Pokud požadavek HTTP POST ukončí nebo časového limitu s chybou TCP před konec datového proudu, musí kodér předal nový požadavek POST s použitím nového připojení a postupujte podle výše uvedených požadavků.</span><span class="sxs-lookup"><span data-stu-id="46aa1-166">If the HTTP POST request terminates or times out with a TCP error prior to the end of the stream, the encoder MUST issue a new POST request by using a new connection, and follow the preceding requirements.</span></span> <span data-ttu-id="46aa1-167">Kromě toho musí kodér znovu odeslal předchozí dva MP4 fragmenty pro každý sledování v datovém proudu a pokračovat bez zavedení nespojitost v časové ose média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-167">Additionally, the encoder MUST resend the previous two MP4 fragments for each track in the stream, and resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="46aa1-168">Odešlete posledních dvou MP4 fragmenty pro každý sledování zajišťuje, že existuje nedošlo ke ztrátě dat.</span><span class="sxs-lookup"><span data-stu-id="46aa1-168">Resending the last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="46aa1-169">Jinými slovy pokud obsahuje datového proudu audio a video sledovat a aktuální žádost POST selže, kodér musíte znovu připojit a opakujte odeslání poslední dva fragmenty pro zvuk sledování, které byly dříve úspěšně odeslán, a posledních dvou fragmenty pro přehrávání videa sledování, které byly dříve úspěšně odeslány, zajistěte, aby nedošlo ke ztrátě dat.</span><span class="sxs-lookup"><span data-stu-id="46aa1-169">In other words, if a stream contains both an audio and a video track, and the current POST request fails, the encoder must reconnect and resend the last two fragments for the audio track, which were previously successfully sent, and the last two fragments for the video track, which were previously successfully sent, to ensure that there is no data loss.</span></span> <span data-ttu-id="46aa1-170">Kodér musí zachovat "forward" vyrovnávací paměti fragmenty média, které opětovně odešle při opětovném připojení.</span><span class="sxs-lookup"><span data-stu-id="46aa1-170">The encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="46aa1-171">5. Časová osa</span><span class="sxs-lookup"><span data-stu-id="46aa1-171">5. Timescale</span></span>
<span data-ttu-id="46aa1-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) popisuje použití časový rámec pro **SmoothStreamingMedia** (část 2.2.2.1) a **StreamElement** (část 2.2.2.3) a **StreamFragmentElement**(Část 2.2.2.6), a **LiveSMIL** (část 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="46aa1-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes the usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="46aa1-173">Pokud časový rámec hodnota neexistuje, je výchozí hodnota používaná pro 10 000 000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="46aa1-173">If the timescale value is not present, the default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="46aa1-174">I když specifikaci formátu technologie Smooth Streaming nebrání použití jiných hodnot časový rámec, většina implementace kodér používat toto výchozí nastavení hodnotu (10 MHz) ke generování, technologie Smooth Streaming ingestovat data.</span><span class="sxs-lookup"><span data-stu-id="46aa1-174">Although the Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) to generate Smooth Streaming ingest data.</span></span> <span data-ttu-id="46aa1-175">Z důvodu [Azure Media dynamické balení](media-services-dynamic-packaging-overview.md) funkce, doporučujeme použít za 90 KHz časový rámec pro datové proudy videa a 44,1 KHz nebo 48.1 KHz pro zvukové datové proudy.</span><span class="sxs-lookup"><span data-stu-id="46aa1-175">Due to the [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="46aa1-176">Pokud jiný časový rámec hodnoty se používají pro různé datové proudy, musí se poslat časový rámec úrovni datového proudu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-176">If different timescale values are used for different streams, the stream-level timescale MUST be sent.</span></span> <span data-ttu-id="46aa1-177">Další informace najdete v tématu [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="46aa1-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="46aa1-178">6. Definice "stream"</span><span class="sxs-lookup"><span data-stu-id="46aa1-178">6. Definition of “stream”</span></span>
<span data-ttu-id="46aa1-179">Datový proud je základní jednotkou operace v za provozu přijímání pro sestavování za provozu prezentací, zpracování datových proudů převzetí služeb při selhání a redundance scénáře.</span><span class="sxs-lookup"><span data-stu-id="46aa1-179">Stream is the basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="46aa1-180">Datový proud je definován jako jeden jedinečný, fragmentovaných MP4 proud, který může obsahovat jediné stopy nebo několik stop.</span><span class="sxs-lookup"><span data-stu-id="46aa1-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="46aa1-181">Prezentace úplné online může obsahovat jeden nebo více datových proudů, v závislosti na konfiguraci kodéry za provozu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-181">A full live presentation might contain one or more streams, depending on the configuration of the live encoders.</span></span> <span data-ttu-id="46aa1-182">Následující příklady znázorňují různé možnosti používání datových proudů do tvoří úplné živé prezentaci.</span><span class="sxs-lookup"><span data-stu-id="46aa1-182">The following examples illustrate various options of using streams to compose a full live presentation.</span></span>

<span data-ttu-id="46aa1-183">**Příklad:**</span><span class="sxs-lookup"><span data-stu-id="46aa1-183">**Example:**</span></span> 

<span data-ttu-id="46aa1-184">Chce zákazník vytvořit živé streamování prezentace, které zahrnuje následující přenosových rychlostí zvuku a videa:</span><span class="sxs-lookup"><span data-stu-id="46aa1-184">A customer wants to create a live streaming presentation that includes the following audio/video bitrates:</span></span>

<span data-ttu-id="46aa1-185">Video – 3000 kB/s, 1 500 kb/s, 750 kb/s</span><span class="sxs-lookup"><span data-stu-id="46aa1-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="46aa1-186">Zvuk – 128 kb/s</span><span class="sxs-lookup"><span data-stu-id="46aa1-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="46aa1-187">Možnost 1: Všechny sleduje v jeden datový proud</span><span class="sxs-lookup"><span data-stu-id="46aa1-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="46aa1-188">V tuto možnost jeden kodér generuje všechny sleduje zvuku a videa a pak je do jedné fragmentovaný proud MP4 obsahuje ureitou.</span><span class="sxs-lookup"><span data-stu-id="46aa1-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="46aa1-189">Fragmentovaný proud MP4 se pak odešlou prostřednictvím jednoho připojení HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-189">The fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="46aa1-190">V tomto příkladu je pouze jeden datový proud pro prezentaci online.</span><span class="sxs-lookup"><span data-stu-id="46aa1-190">In this example, there is only one stream for this live presentation.</span></span>

![Sledování datové proudy: 1][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="46aa1-192">Možnost 2: Každý sledování v samostatných datového proudu</span><span class="sxs-lookup"><span data-stu-id="46aa1-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="46aa1-193">Tuto možnost kodér umístí jeden sledování do každé proud fragment MP4 a odešle všechny datové proudy přes samostatné připojení prostřednictvím protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="46aa1-193">In this option, the encoder puts one track into each fragment MP4 bitstream, and then posts all of the streams over separate HTTP connections.</span></span> <span data-ttu-id="46aa1-194">To lze provést pomocí kodéru jeden nebo více kodéry.</span><span class="sxs-lookup"><span data-stu-id="46aa1-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="46aa1-195">Za provozu přijímání uvidí prezentaci online jako se skládá z čtyři datových proudů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-195">The live ingestion sees this live presentation as composed of four streams.</span></span>

![Sleduje samostatné datové proudy][image3]

### <a name="option-3-bundle-audio-track-with-the-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="46aa1-197">Možnost 3: Sady zvukové stopy s nejnižší sledovat videa přenosovou rychlostí do jednoho datového proudu</span><span class="sxs-lookup"><span data-stu-id="46aa1-197">Option 3: Bundle audio track with the lowest bitrate video track into one stream</span></span>
<span data-ttu-id="46aa1-198">Tuto možnost Zákazník zvolí svázat zvukové stopy s sledovat videa nejnižší přenosovou rychlostí do jednoho fragment MP4 proud a nechte ostatní dva video sleduje jako samostatné datové proudy.</span><span class="sxs-lookup"><span data-stu-id="46aa1-198">In this option, the customer chooses to bundle the audio track with the lowest-bitrate video track in one fragment MP4 bitstream, and leave the other two video tracks as separate streams.</span></span> 

![Sleduje datové proudy zvuk a video][image4]

### <a name="summary"></a><span data-ttu-id="46aa1-200">Souhrn</span><span class="sxs-lookup"><span data-stu-id="46aa1-200">Summary</span></span>
<span data-ttu-id="46aa1-201">Nejedná se o vyčerpávající seznam všech možných přijímání možností v tomto příkladu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="46aa1-202">Jako matter z skutečnosti za provozu přijímání podporuje všechny seskupení sleduje do datových proudů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="46aa1-203">Zákazníci a dodavatelé encoder můžete zvolit vlastní implementací na základě engineering složitost, kodér kapacitu a redundanci a důležité informace o převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="46aa1-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="46aa1-204">Ale ve většině případů není pouze jeden zvuk sledovat v celé prezentaci za provozu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-204">However, in most cases, there is only one audio track for the entire live presentation.</span></span> <span data-ttu-id="46aa1-205">Ano je důležité zajistit healthiness ingestování datového proudu obsahující zvuk sledovat. Tento aspekt často vede k uvedení zvukové stopy v vlastní datový proud (jako možnost 2) nebo sdružování s sledovat videa nejnižší přenosovou rychlostí (jako možnost 3).</span><span class="sxs-lookup"><span data-stu-id="46aa1-205">So, it’s important to ensure the healthiness of the ingest stream that contains the audio track. This consideration often results in putting the audio track in its own stream (as in Option 2) or bundling it with the lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="46aa1-206">Navíc lepší redundanci a odolnost proti chybám, odesílání stejné zvuk sledovat ve dvou různých datových proudů (možnost 2 s redundantní zvukových stop) nebo sdružování zvukové stopy s alespoň dvě z video sleduje nejnižší přenosovou rychlostí (možnost 3 s zvuk dodávat alespoň dvou datové proudy videa) důrazně doporučujeme pro za provozu ingestování ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="46aa1-206">Also, for better redundancy and fault tolerance, sending the same audio track in two different streams (Option 2 with redundant audio tracks) or bundling the audio track with at least two of the lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="46aa1-207">7. Převzetí služeb při selhání služby</span><span class="sxs-lookup"><span data-stu-id="46aa1-207">7. Service failover</span></span>
<span data-ttu-id="46aa1-208">Zadaný povaha živé vysílání datového proudu je důležité pro zajištění dostupnosti služby podpory funkční převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="46aa1-208">Given the nature of live streaming, good failover support is critical for ensuring the availability of the service.</span></span> <span data-ttu-id="46aa1-209">Služba Media Services je navržen pro zpracování různých typů chyb, včetně chyby sítě, server chyb a problémů s úložištěm.</span><span class="sxs-lookup"><span data-stu-id="46aa1-209">Media Services is designed to handle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="46aa1-210">Při použití ve spojení s logikou správné převzetí služeb při selhání ze strany kodér za provozu, můžete dosáhnout zákazníkům vysoce spolehlivá služba živého streamování z cloudu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-210">When used in conjunction with proper failover logic from the live encoder side, customers can achieve a highly reliable live streaming service from the cloud.</span></span>

<span data-ttu-id="46aa1-211">V této části probereme scénáře převzetí služeb při selhání služby.</span><span class="sxs-lookup"><span data-stu-id="46aa1-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="46aa1-212">V takovém případě selhání probíhá někde v rámci služby, a projeví se to jako chybu v síti.</span><span class="sxs-lookup"><span data-stu-id="46aa1-212">In this case, the failure happens somewhere within the service, and it manifests itself as a network error.</span></span> <span data-ttu-id="46aa1-213">Tady jsou některá doporučení pro implementaci kodéru pro zpracování převzetí služeb při selhání služby:</span><span class="sxs-lookup"><span data-stu-id="46aa1-213">Here are some recommendations for the encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="46aa1-214">Použijte 10 sekundu vypršení časového limitu pro vytvoření připojení protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="46aa1-214">Use a 10-second timeout for establishing the TCP connection.</span></span> <span data-ttu-id="46aa1-215">Pokud pokus o připojení trvá déle než 10 sekund, zrušení operace a akci opakujte.</span><span class="sxs-lookup"><span data-stu-id="46aa1-215">If an attempt to establish the connection takes longer than 10 seconds, abort the operation and try again.</span></span> 
2. <span data-ttu-id="46aa1-216">Použijte krátký časový limit pro odesílání zpráv bloky požadavek HTTP.</span><span class="sxs-lookup"><span data-stu-id="46aa1-216">Use a short timeout for sending the HTTP request message chunks.</span></span> <span data-ttu-id="46aa1-217">Pokud platnost cíl MP4 fragment po dobu N sekund, použijte časový limit odeslání N až 2 po dobu N sekund; Například pokud doba fragment MP4 je 6 sekund, použijte vypršení časového limitu 6 až 12 sekund.</span><span class="sxs-lookup"><span data-stu-id="46aa1-217">If the target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if the MP4 fragment duration is 6 seconds, use a timeout of 6 to 12 seconds.</span></span> <span data-ttu-id="46aa1-218">Pokud dojde k vypršení časového limitu, obnovení připojení, otevřít nové připojení a obnovit datový proud ingestování na nové připojení.</span><span class="sxs-lookup"><span data-stu-id="46aa1-218">If a timeout occurs, reset the connection, open a new connection, and resume stream ingest on the new connection.</span></span> 
3. <span data-ttu-id="46aa1-219">Udržujte postupného vyrovnávací paměť, která má posledních dvou fragmenty pro každý sledování, které byly úspěšně a úplně odeslány do služby.</span><span class="sxs-lookup"><span data-stu-id="46aa1-219">Maintain a rolling buffer that has the last two fragments for each track that were successfully and completely sent to the service.</span></span>  <span data-ttu-id="46aa1-220">Pokud požadavku HTTP POST pro datový proud je ukončeno, nebo časového limitu před konec datového proudu, otevřít nové připojení a zahájit další požadavek HTTP POST, znovu odeslat hlavičky datového proudu, znovu odeslat poslední dva fragmenty pro každý sledovat a obnovit datový proud bez Úvod d iscontinuity v časové ose média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-220">If the HTTP POST request for a stream is terminated or times out prior to the end of the stream, open a new connection and begin another HTTP POST request, resend the stream headers, resend the last two fragments for each track, and resume the stream without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="46aa1-221">Tím se snižuje riziko ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="46aa1-221">This reduces the chance of data loss.</span></span>
4. <span data-ttu-id="46aa1-222">Doporučujeme vám, že kodér neomezuje počet opakovaných pokusů připojení nebo obnovení streamování potom, co dojde k chybě protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="46aa1-222">We recommend that the encoder does NOT limit the number of retries to establish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="46aa1-223">Po chybě TCP:</span><span class="sxs-lookup"><span data-stu-id="46aa1-223">After a TCP error:</span></span>
  
    <span data-ttu-id="46aa1-224">a.</span><span class="sxs-lookup"><span data-stu-id="46aa1-224">a.</span></span> <span data-ttu-id="46aa1-225">Aktuální připojení musí být uzavřeny a je třeba vytvořit nové připojení, a to pro nový požadavek HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-225">The current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="46aa1-226">b.</span><span class="sxs-lookup"><span data-stu-id="46aa1-226">b.</span></span> <span data-ttu-id="46aa1-227">Nové HTTP POST adresa URL musí být stejný jako počáteční adresa URL POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-227">The new HTTP POST URL MUST be the same as the initial POST URL.</span></span>
  
    <span data-ttu-id="46aa1-228">c.</span><span class="sxs-lookup"><span data-stu-id="46aa1-228">c.</span></span> <span data-ttu-id="46aa1-229">Nové POST protokolu HTTP musí obsahovat záhlaví datového proudu (**ftyp**, **Live pole Manifest serveru**, a **moov** polí), jsou stejné jako datový proud hlavičky v počáteční POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-229">The new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical to the stream headers in the initial POST.</span></span>
  
    <span data-ttu-id="46aa1-230">d.</span><span class="sxs-lookup"><span data-stu-id="46aa1-230">d.</span></span> <span data-ttu-id="46aa1-231">Poslední dva fragmenty odeslané pro každý sledovat nutné odeslat znovu, a vysílání datového proudu musí pokračovat bez zavedení nespojitost v časové ose média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-231">The last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in the media timeline.</span></span> <span data-ttu-id="46aa1-232">Časová razítka fragment MP4 musíte zvýšit nepřetržitě, i přes požadavky HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="46aa1-232">The MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="46aa1-233">Kodér musí ukončit požadavku HTTP POST, jestliže data nejsou odesílána rychlostí úměrná trvání fragment MP4.</span><span class="sxs-lookup"><span data-stu-id="46aa1-233">The encoder SHOULD terminate the HTTP POST request if data is not being sent at a rate commensurate with the MP4 fragment duration.</span></span>  <span data-ttu-id="46aa1-234">Požadavek HTTP POST, který neodesílá data zabránit rychle z kodéru odpojení v případě aktualizaci služby Media Services.</span><span class="sxs-lookup"><span data-stu-id="46aa1-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update.</span></span> <span data-ttu-id="46aa1-235">Z tohoto důvodu HTTP POST pro zhuštěné (signál ad) sleduje by měla být krátkodobou, ukončení hned, jak se odesílají zhuštěných fragment.</span><span class="sxs-lookup"><span data-stu-id="46aa1-235">For this reason, the HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as the sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="46aa1-236">8. Kodér převzetí služeb při selhání</span><span class="sxs-lookup"><span data-stu-id="46aa1-236">8. Encoder failover</span></span>
<span data-ttu-id="46aa1-237">Kodér převzetí služeb při selhání je druhý typ scénáře převzetí služeb při selhání, který je potřeba vzít v úvahu pro živé streamování doručení začátku do konce.</span><span class="sxs-lookup"><span data-stu-id="46aa1-237">Encoder failover is the second type of failover scenario that needs to be addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="46aa1-238">V tomto scénáři k chybovému stavu dojde na straně kodér.</span><span class="sxs-lookup"><span data-stu-id="46aa1-238">In this scenario, the error condition occurs on the encoder side.</span></span> 

![Kodér převzetí služeb při selhání][image5]

<span data-ttu-id="46aa1-240">Když kodér převzetí služeb při selhání se stane, platí následující očekávání z koncového bodu za provozu přijímání:</span><span class="sxs-lookup"><span data-stu-id="46aa1-240">The following expectations apply from the live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="46aa1-241">Chcete-li pokračovat, streamování, by MĚL vytvořit novou instanci kodér, jak je znázorněno na obrázku (datový proud pro 3000 tisíc video s přerušovanou čáru).</span><span class="sxs-lookup"><span data-stu-id="46aa1-241">A new encoder instance SHOULD be created to continue streaming, as illustrated in the diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="46aa1-242">Nové kodér musí používat stejnou adresu URL pro požadavky HTTP POST jako nezdařených instancí.</span><span class="sxs-lookup"><span data-stu-id="46aa1-242">The new encoder MUST use the same URL for HTTP POST requests as the failed instance.</span></span>
3. <span data-ttu-id="46aa1-243">Požadavek POST na nový kodér musí obsahovat stejnou polí fragmentovaných MP4 záhlaví jako nezdařených instancí.</span><span class="sxs-lookup"><span data-stu-id="46aa1-243">The new encoder’s POST request MUST include the same fragmented MP4 header boxes as the failed instance.</span></span>
4. <span data-ttu-id="46aa1-244">Nové kodér musí správně synchronizovat s všechny ostatní spuštěné kodéry pro stejné za provozu prezentace ke generování synchronizoval ukázky zvuku a videa s hranicemi zarovnaný fragment.</span><span class="sxs-lookup"><span data-stu-id="46aa1-244">The new encoder MUST be properly synced with all other running encoders for the same live presentation to generate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="46aa1-245">Nový datový proud musí být sémanticky ekvivalentní s předchozí datového proudu a na úrovni záhlaví a fragment zaměnitelné.</span><span class="sxs-lookup"><span data-stu-id="46aa1-245">The new stream MUST be semantically equivalent with the previous stream, and interchangeable at the header and fragment levels.</span></span>
6. <span data-ttu-id="46aa1-246">Nové kodéru se pokuste ztráty dat co nejmenší.</span><span class="sxs-lookup"><span data-stu-id="46aa1-246">The new encoder SHOULD try to minimize data loss.</span></span> <span data-ttu-id="46aa1-247">`fragment_absolute_time` a `fragment_index` média měli zvýšit fragmenty z bodu, kde poslední zastavení kodér.</span><span class="sxs-lookup"><span data-stu-id="46aa1-247">The `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from the point where the encoder last stopped.</span></span> <span data-ttu-id="46aa1-248">`fragment_absolute_time` a `fragment_index` měli zvýšit průběžně, ale je přípustné zavádět nespojitost, v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="46aa1-248">The `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible to introduce a discontinuity, if necessary.</span></span> <span data-ttu-id="46aa1-249">Media Services ignoruje fragmenty, které má již přijme a zpracuje, proto je lepší pečlivého odešlete fragmenty než se zavést nespojitosti v časové ose média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-249">Media Services ignores fragments that it has already received and processed, so it's better to err on the side of resending fragments than to introduce discontinuities in the media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="46aa1-250">9. Kodér redundance</span><span class="sxs-lookup"><span data-stu-id="46aa1-250">9. Encoder redundancy</span></span>
<span data-ttu-id="46aa1-251">V případě důležitých živých událostí, vyžádání i vyšší dostupnost a kvalitní uživatelský dojem, doporučujeme dosáhli bezproblémového převzetí služeb při selhání bez ztráty dat pomocí redundantní kodéry v režimu aktivní aktivní.</span><span class="sxs-lookup"><span data-stu-id="46aa1-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders to achieve seamless failover with no data loss.</span></span>

![Kodér redundance][image6]

<span data-ttu-id="46aa1-253">Jak je ukázáno v tomto diagramu, dvě skupiny kodéry dvě kopie každé datového proudu současně push ve službě za provozu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into the live service.</span></span> <span data-ttu-id="46aa1-254">Tato instalace je podporována, protože Media Services můžete filtrovat podle ID a fragment datového proudu časové razítko duplicitní fragmenty.</span><span class="sxs-lookup"><span data-stu-id="46aa1-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="46aa1-255">Výsledný živý datový proud a archivu je jedna kopie všechny datové proudy, které je nejlepší možný agregace ze dvou zdrojů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-255">The resulting live stream and archive is a single copy of all the streams that is the best possible aggregation from the two sources.</span></span> <span data-ttu-id="46aa1-256">Například v hypotetický extreme případě, pokud je jeden kodér (nemusí to být stejný jako ten) spuštěná v libovolném bodě v čase pro každý datový proud, výsledná živý datový proud ze služby je souvislý bez ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="46aa1-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have to be the same one) running at any given point in time for each stream, the resulting live stream from the service is continuous without data loss.</span></span> 

<span data-ttu-id="46aa1-257">Požadavky pro tento scénář jsou téměř stejné jako v případě "Kodér převzetí", s výjimkou spuštěným druhá sada kodéry ve stejnou dobu jako primární kodéry požadavky.</span><span class="sxs-lookup"><span data-stu-id="46aa1-257">The requirements for this scenario are almost the same as the requirements in the "Encoder failover" case, with the exception that the second set of encoders are running at the same time as the primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="46aa1-258">10. Služba redundance</span><span class="sxs-lookup"><span data-stu-id="46aa1-258">10. Service redundancy</span></span>
<span data-ttu-id="46aa1-259">Pro vysoce redundantní globální distribuci někdy musí mít mezi oblastmi zálohování pro zpracování místní havárie.</span><span class="sxs-lookup"><span data-stu-id="46aa1-259">For highly redundant global distribution, sometimes you must have cross-region backup to handle regional disasters.</span></span> <span data-ttu-id="46aa1-260">Rozšíření na topologii "Kodér redundance", zákazníci můžou rozhodnout pro nasazení redundantní služby v jiné oblasti, která je propojená s druhá sada kodéry.</span><span class="sxs-lookup"><span data-stu-id="46aa1-260">Expanding on the “Encoder redundancy” topology, customers can choose to have a redundant service deployment in a different region that's connected with the second set of encoders.</span></span> <span data-ttu-id="46aa1-261">Zákazníci také můžete pracovat s poskytovatelem Content Delivery Network nasazení globální správce provozu před nasazení dvou služby bezproblémově směrovat přenosy klienta.</span><span class="sxs-lookup"><span data-stu-id="46aa1-261">Customers also can work with a Content Delivery Network provider to deploy a Global Traffic Manager in front of the two service deployments to seamlessly route client traffic.</span></span> <span data-ttu-id="46aa1-262">Požadavky kodéry jsou stejné jako "Kodér redundance" případu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-262">The requirements for the encoders are the same as the “Encoder redundancy” case.</span></span> <span data-ttu-id="46aa1-263">Jedinou výjimkou je, že druhá sada kodéry musí být odkazoval na jiný za provozu ingestování koncový bod.</span><span class="sxs-lookup"><span data-stu-id="46aa1-263">The only exception is that the second set of encoders needs to be pointed to a different live ingest endpoint.</span></span> <span data-ttu-id="46aa1-264">Následující diagram znázorňuje tento instalační program:</span><span class="sxs-lookup"><span data-stu-id="46aa1-264">The following diagram shows this setup:</span></span>

![Služba redundance][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="46aa1-266">11. Speciální typy přijímání formáty</span><span class="sxs-lookup"><span data-stu-id="46aa1-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="46aa1-267">Tato část popisuje speciální typy provozu přijímání formátů, které jsou určeny ke zpracování konkrétní scénáře.</span><span class="sxs-lookup"><span data-stu-id="46aa1-267">This section discusses special types of live ingestion formats that are designed to handle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="46aa1-268">Zhuštěný sledování</span><span class="sxs-lookup"><span data-stu-id="46aa1-268">Sparse track</span></span>
<span data-ttu-id="46aa1-269">Při předvádění živé streamování prezentace plně funkčního klienta prostředí, často je nutné přenášet synchronizovat čas události nebo signály integrovaná s daty hlavní média.</span><span class="sxs-lookup"><span data-stu-id="46aa1-269">When delivering a live streaming presentation with a rich client experience, often it's necessary to transmit time-synced events or signals in-band with the main media data.</span></span> <span data-ttu-id="46aa1-270">Příkladem je vkládání reklam dynamické za provozu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="46aa1-271">Tento typ signalizace událostí se liší od regulární zvuku a videa streamování z důvodu jeho zhuštěných povahy.</span><span class="sxs-lookup"><span data-stu-id="46aa1-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="46aa1-272">Jinými slovy signalizační data obvykle neodehrává nepřetržitě a interval může být snadno předpovědět.</span><span class="sxs-lookup"><span data-stu-id="46aa1-272">In other words, the signaling data usually does not happen continuously, and the interval can be hard to predict.</span></span> <span data-ttu-id="46aa1-273">Koncept zhuštěných sledovat byla navržená tak, aby ingestování a všesměrového vysílání v Vzdálená signalizační data.</span><span class="sxs-lookup"><span data-stu-id="46aa1-273">The concept of sparse track was designed to ingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="46aa1-274">Následující kroky jsou doporučené implementace pro příjem zhuštěných sledovat:</span><span class="sxs-lookup"><span data-stu-id="46aa1-274">The following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="46aa1-275">Vytvořte samostatný fragmentovaný proud MP4, obsahující pouze zhuštěných sleduje bez sleduje zvuku a videa.</span><span class="sxs-lookup"><span data-stu-id="46aa1-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="46aa1-276">V **Live pole Manifest serveru** definuje v části 6 [1], použijte *parentTrackName* parametr zadat název nadřazené sledovat. Další informace najdete v části 4.2.1.2.1.2 v [1].</span><span class="sxs-lookup"><span data-stu-id="46aa1-276">In the **Live Server Manifest Box** as defined in Section 6 in [1], use the *parentTrackName* parameter to specify the name of the parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="46aa1-277">V **Live pole Manifest serveru**, **manifestOutput** musí být nastavena na **true**.</span><span class="sxs-lookup"><span data-stu-id="46aa1-277">In the **Live Server Manifest Box**, **manifestOutput** MUST be set to **true**.</span></span>
4. <span data-ttu-id="46aa1-278">Dané zhuštěných podstatě signalizační událostí, doporučujeme následující:</span><span class="sxs-lookup"><span data-stu-id="46aa1-278">Given the sparse nature of the signaling event, we recommended the following:</span></span>
   
    <span data-ttu-id="46aa1-279">a.</span><span class="sxs-lookup"><span data-stu-id="46aa1-279">a.</span></span> <span data-ttu-id="46aa1-280">Na začátku živé události, odešle kodér polí hlavičky počáteční službu, která umožňuje služby zhuštěné sledovat zaregistrovat v manifestu klienta.</span><span class="sxs-lookup"><span data-stu-id="46aa1-280">At the beginning of the live event, the encoder sends the initial header boxes to the service, which allows the service to register the sparse track in the client manifest.</span></span>
   
    <span data-ttu-id="46aa1-281">b.</span><span class="sxs-lookup"><span data-stu-id="46aa1-281">b.</span></span> <span data-ttu-id="46aa1-282">Kodér musí ukončit požadavku HTTP POST, když se data neodesílají.</span><span class="sxs-lookup"><span data-stu-id="46aa1-282">The encoder SHOULD terminate the HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="46aa1-283">Rychle se odpojuje od kodér v případě restartu služby update nebo serveru služby Media Services můžete zabránit HTTP POST dlouho běžící, který není odesílat data.</span><span class="sxs-lookup"><span data-stu-id="46aa1-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from the encoder in the event of a service update or server reboot.</span></span> <span data-ttu-id="46aa1-284">V těchto případech je server mediálních dočasně blokovaných v operace příjmu na soketu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-284">In these cases, the media server is temporarily blocked in a receive operation on the socket.</span></span>
   
    <span data-ttu-id="46aa1-285">c.</span><span class="sxs-lookup"><span data-stu-id="46aa1-285">c.</span></span> <span data-ttu-id="46aa1-286">V době, kdy signalizační data nejsou k dispozici kodér SHOULD zavřete POST protokolu HTTP žádosti.</span><span class="sxs-lookup"><span data-stu-id="46aa1-286">During the time when signaling data is not available, the encoder SHOULD close the HTTP POST request.</span></span> <span data-ttu-id="46aa1-287">Při požadavku POST je aktivní, měli kodér odesílat data.</span><span class="sxs-lookup"><span data-stu-id="46aa1-287">While the POST request is active, the encoder SHOULD send data.</span></span>

    <span data-ttu-id="46aa1-288">d.</span><span class="sxs-lookup"><span data-stu-id="46aa1-288">d.</span></span> <span data-ttu-id="46aa1-289">Při odesílání zhuštěných fragmenty, modulu encoder můžete nastavit explicitní hlavičku content-length, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="46aa1-289">When sending sparse fragments, the encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="46aa1-290">e.</span><span class="sxs-lookup"><span data-stu-id="46aa1-290">e.</span></span> <span data-ttu-id="46aa1-291">Při odesílání zhuštěných fragmenty se nové připojení, začněte kodér odesílání do polí hlavičky, za nímž následuje nové fragmenty.</span><span class="sxs-lookup"><span data-stu-id="46aa1-291">When sending sparse fragments with a new connection, the encoder SHOULD start sending from the header boxes, followed by the new fragments.</span></span> <span data-ttu-id="46aa1-292">Je to pro případy, ve kterých se stane, převzetí služeb při selhání mezi a nové zhuštěných připojení bylo zavedeno na nový server, který nebylo nikdy zhuštěných sledovat před.</span><span class="sxs-lookup"><span data-stu-id="46aa1-292">This is for cases in which failover happens in-between, and the new sparse connection is being established to a new server that has not seen the sparse track before.</span></span>

    <span data-ttu-id="46aa1-293">f.</span><span class="sxs-lookup"><span data-stu-id="46aa1-293">f.</span></span> <span data-ttu-id="46aa1-294">Zhuštěný sledovat fragment k dispozici pro klienta po odpovídající fragment sledovat nadřazené, který má hodnotu větší nebo rovno časové razítko je k dispozici pro klienta.</span><span class="sxs-lookup"><span data-stu-id="46aa1-294">The sparse track fragment becomes available to the client when the corresponding parent track fragment that has an equal or larger timestamp value is made available to the client.</span></span> <span data-ttu-id="46aa1-295">Například pokud zhuštěných fragment obsahuje časové razítko t = 1 000, očekává se, které po klienta vidí "video" (za předpokladu, že název nadřazeného sledovat je "video") fragmentovat časové razítko 1000 nebo i mimo může stahovat zhuštěných fragment t = 1 000.</span><span class="sxs-lookup"><span data-stu-id="46aa1-295">For example, if the sparse fragment has a timestamp of t=1000, it is expected that after the client sees "video" (assuming the parent track name is "video") fragment timestamp 1000 or beyond, it can download the sparse fragment t=1000.</span></span> <span data-ttu-id="46aa1-296">Všimněte si, že skutečný signál by mohly být použity pro jinou pozici v časové ose prezentace jeho určený účel.</span><span class="sxs-lookup"><span data-stu-id="46aa1-296">Note that the actual signal could be used for a different position in the presentation timeline for its designated purpose.</span></span> <span data-ttu-id="46aa1-297">V tomto příkladu je možné, zhuštěných fragment t = 1 000 má datovou část XML, který je pro vkládání ad do pozice, který je několik sekund později.</span><span class="sxs-lookup"><span data-stu-id="46aa1-297">In this example, it’s possible that the sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="46aa1-298">g.</span><span class="sxs-lookup"><span data-stu-id="46aa1-298">g.</span></span> <span data-ttu-id="46aa1-299">Datová část zhuštěných sledovat fragmenty může být v různých formátech (například XML, text nebo binární), v závislosti na scénáři.</span><span class="sxs-lookup"><span data-stu-id="46aa1-299">The payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on the scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="46aa1-300">Redundantní zvuk sledování</span><span class="sxs-lookup"><span data-stu-id="46aa1-300">Redundant audio track</span></span>
<span data-ttu-id="46aa1-301">Typický HTTP adaptivní streamování scénář (například technologie Smooth Streaming nebo pomlčkou) často má jenom jeden zvukové stopy v celé prezentace.</span><span class="sxs-lookup"><span data-stu-id="46aa1-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in the entire presentation.</span></span> <span data-ttu-id="46aa1-302">Na rozdíl od sleduje video, které mají více úrovní kvality pro klienta výběr ve chybové stavy, zvuk sledovat může být jediný bod selhání Pokud možnému datový proud, který obsahuje audio track je poškozená.</span><span class="sxs-lookup"><span data-stu-id="46aa1-302">Unlike video tracks, which have multiple quality levels for the client to choose from in error conditions, the audio track can be a single point of failure if the ingestion of the stream that contains the audio track is broken.</span></span> 

<span data-ttu-id="46aa1-303">Chcete-li tento problém vyřešit, služba Media Services podporuje za provozu přijímání redundantní zvukových stop.</span><span class="sxs-lookup"><span data-stu-id="46aa1-303">To solve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="46aa1-304">Cílem je, že stejné zvuk sledovat lze odeslat vícekrát v různých datových proudů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-304">The idea is that the same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="46aa1-305">I když služba pouze zaregistruje zvuk sledovat jednou v manifestu klienta, může použít redundantní zvukových stop jako záložní pro načítání zvuku fragmenty, pokud má primární zvuk sledování problémů.</span><span class="sxs-lookup"><span data-stu-id="46aa1-305">Although the service only registers the audio track once in the client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if the primary audio track has issues.</span></span> <span data-ttu-id="46aa1-306">Pro ingestování redundantní zvukových stop, kodéru, musí:</span><span class="sxs-lookup"><span data-stu-id="46aa1-306">To ingest redundant audio tracks, the encoder needs to:</span></span>

1. <span data-ttu-id="46aa1-307">Vytvořte stejné zvuk sledovat více fragment MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="46aa1-307">Create the same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="46aa1-308">Redundantní zvukových stop musí být sémanticky ekvivalentní, časová razítka stejné fragment a být na úrovni záhlaví a fragment zaměnitelné.</span><span class="sxs-lookup"><span data-stu-id="46aa1-308">The redundant audio tracks MUST be semantically equivalent, with the same fragment timestamps, and be interchangeable at the header and fragment levels.</span></span>
2. <span data-ttu-id="46aa1-309">Zkontrolujte, zda položka "zvuk" v za provozu Server manifestu (část 6 v [1]) stejný pro všechny redundantní zvukových stop.</span><span class="sxs-lookup"><span data-stu-id="46aa1-309">Ensure that the “audio” entry in the Live Server Manifest (Section 6 in [1]) is the same for all redundant audio tracks.</span></span>

<span data-ttu-id="46aa1-310">Následující implementace se doporučuje pro redundantní zvukových stop:</span><span class="sxs-lookup"><span data-stu-id="46aa1-310">The following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="46aa1-311">Odeslat každý jedinečný zvukové stopy v datovém proudu samostatně.</span><span class="sxs-lookup"><span data-stu-id="46aa1-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="46aa1-312">Navíc odesílat redundantní datový proud pro každou z těchto datových proudů zvuk sledovat, kde druhý datový proud se liší od prvního pouze podle identifikátoru v adrese URL protokolu HTTP POST: {protokolu} :// {serveru address} / {publikování path}/Streams({identifier}) bodu.</span><span class="sxs-lookup"><span data-stu-id="46aa1-312">Also, send a redundant stream for each of these audio track streams, where the second stream differs from the first only by the identifier in the HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="46aa1-313">Použijte samostatné datové proudy k odeslání dvě nejnižší video přenosových rychlostí.</span><span class="sxs-lookup"><span data-stu-id="46aa1-313">Use separate streams to send the two lowest video bitrates.</span></span> <span data-ttu-id="46aa1-314">Každý z těchto datových proudů by obsahovat také kopii každý jedinečný zvuk sledovat. Například když podporuje více jazyky, těchto datových proudů by MĚLO obsahovat zvuk sleduje pro jednotlivé jazyky.</span><span class="sxs-lookup"><span data-stu-id="46aa1-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="46aa1-315">Použijte samostatný server (kodér) instance pro kódování a odesílat redundantní uveden v datové proudy (1) a (2).</span><span class="sxs-lookup"><span data-stu-id="46aa1-315">Use separate server (encoder) instances to encode and send the redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="46aa1-316">Mapy kurzů ke službě Media Services</span><span class="sxs-lookup"><span data-stu-id="46aa1-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="46aa1-317">Poskytnutí zpětné vazby</span><span class="sxs-lookup"><span data-stu-id="46aa1-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png

---
title: "Media Services aaaAzure fragmentovaných MP4 live ingestování specifikace | Microsoft Docs"
description: "Tato specifikace popisuje protokol hello a formát pro fragmentovaných na základě MP4 živé streamování přijímání pro Azure Media Services. Můžete použít Azure Media Services toostream živé události a všesměrového vysílání obsah v reálném čase pomocí služby Azure jako cloudová platforma hello. Tento dokument taky popisuje osvědčené postupy pro vytváření vysoce redundantní a robustní za provozu ingestování mechanismy."
services: media-services
documentationcenter: 
author: cenkdin
manager: cfowler
editor: 
ms.assetid: 43fac263-a5ea-44af-8dd5-cc88e423b4de
ms.service: media-services
ms.workload: media
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/29/2017
ms.author: cenkd;juliako
ms.openlocfilehash: 0c191f8d6c5a595621feaba0e571fb984b666f34
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="azure-media-services-fragmented-mp4-live-ingest-specification"></a><span data-ttu-id="a1435-105">Azure Media Services fragmentovaných MP4 live ingestování specifikace</span><span class="sxs-lookup"><span data-stu-id="a1435-105">Azure Media Services fragmented MP4 live ingest specification</span></span>
<span data-ttu-id="a1435-106">Tato specifikace popisuje protokol hello a formát pro fragmentovaných na základě MP4 živé streamování přijímání pro Azure Media Services.</span><span class="sxs-lookup"><span data-stu-id="a1435-106">This specification describes hello protocol and format for fragmented MP4-based live streaming ingestion for Azure Media Services.</span></span> <span data-ttu-id="a1435-107">Služba Media Services poskytuje služba živého streamování, můžete použít toostream živé události a vysílání obsah v reálném čase pomocí služby Azure jako hello Cloudová platforma zákazníků.</span><span class="sxs-lookup"><span data-stu-id="a1435-107">Media Services provides a live streaming service that customers can use toostream live events and broadcast content in real time by using Azure as hello cloud platform.</span></span> <span data-ttu-id="a1435-108">Tento dokument taky popisuje osvědčené postupy pro vytváření vysoce redundantní a robustní za provozu ingestování mechanismy.</span><span class="sxs-lookup"><span data-stu-id="a1435-108">This document also discusses best practices for building highly redundant and robust live ingest mechanisms.</span></span>

## <a name="1-conformance-notation"></a><span data-ttu-id="a1435-109">1. Zápis shoda</span><span class="sxs-lookup"><span data-stu-id="a1435-109">1. Conformance notation</span></span>
<span data-ttu-id="a1435-110">Hello klíčová slova "musí," "musí není," "VYŽADOVÁNA," "SHALL", "se ne," "SHOULD", "By neměl,", "Doporučené", "PRAVDĚPODOBNĚ," a "Volitelné" v tomto dokumentu jsou toobe interpretují jako jsou popsány v dokumentu RFC 2119.</span><span class="sxs-lookup"><span data-stu-id="a1435-110">hello key words "MUST," "MUST NOT," "REQUIRED," "SHALL," "SHALL NOT," "SHOULD," "SHOULD NOT," "RECOMMENDED," "MAY," and "OPTIONAL" in this document are toobe interpreted as they are described in RFC 2119.</span></span>

## <a name="2-service-diagram"></a><span data-ttu-id="a1435-111">2. Diagram služby</span><span class="sxs-lookup"><span data-stu-id="a1435-111">2. Service diagram</span></span>
<span data-ttu-id="a1435-112">Hello následující diagram znázorňuje hello Architektura vysoké úrovně hello živé streamování služby ve službě Media Services:</span><span class="sxs-lookup"><span data-stu-id="a1435-112">hello following diagram shows hello high-level architecture of hello live streaming service in Media Services:</span></span>

1. <span data-ttu-id="a1435-113">Za provozu kodér doručí toochannels za provozu informační kanály, které jsou vytvořeny a zřízené prostřednictvím hello Azure Media Services SDK.</span><span class="sxs-lookup"><span data-stu-id="a1435-113">A live encoder pushes live feeds toochannels that are created and provisioned via hello Azure Media Services SDK.</span></span>
2. <span data-ttu-id="a1435-114">V cloudu kanály, programů a koncových bodů streamování v Media Services popisovač všechny hello živé streamování funkce, včetně ingestování, formátování, DVR, zabezpečení, škálovatelnosti a redundance.</span><span class="sxs-lookup"><span data-stu-id="a1435-114">Channels, programs, and streaming endpoints in Media Services handle all hello live streaming functionalities, including ingest, formatting, cloud DVR, security, scalability, and redundancy.</span></span>
3. <span data-ttu-id="a1435-115">Zákazníci Volitelně můžete vybrat toodeploy vrstvu Azure Content Delivery Network mezi hello streamování koncový bod a koncové body klienta hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-115">Optionally, customers can choose toodeploy an Azure Content Delivery Network layer between hello streaming endpoint and hello client endpoints.</span></span>
4. <span data-ttu-id="a1435-116">Datový proud koncové body klienta z koncového bodu streamování pomocí protokolů HTTP adaptivní streamování hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-116">Client endpoints stream from hello streaming endpoint by using HTTP Adaptive Streaming protocols.</span></span> <span data-ttu-id="a1435-117">Mezi příklady patří Microsoft technologie Smooth Streaming, dynamické adaptivní datové proudy přes protokol HTTP (DASH nebo MPEG-DASH) a Apple HTTP Live Streaming (HLS).</span><span class="sxs-lookup"><span data-stu-id="a1435-117">Examples include Microsoft Smooth Streaming, Dynamic Adaptive Streaming over HTTP (DASH, or MPEG-DASH), and Apple HTTP Live Streaming (HLS).</span></span>

![ingestování toku][image1]

## <a name="3-bitstream-format--iso-14496-12-fragmented-mp4"></a><span data-ttu-id="a1435-119">3. Bitový proud formátu – ISO 14496-12 fragmentovaný soubor MP4</span><span class="sxs-lookup"><span data-stu-id="a1435-119">3. Bitstream format – ISO 14496-12 fragmented MP4</span></span>
<span data-ttu-id="a1435-120">Hello přenosový formát pro živé streamování ingestování popsané v tomto dokumentu je založena na [ISO-14496-12].</span><span class="sxs-lookup"><span data-stu-id="a1435-120">hello wire format for live streaming ingest discussed in this document is based on [ISO-14496-12].</span></span> <span data-ttu-id="a1435-121">Podrobné vysvětlení fragmentovaných formátu MP4 a rozšíření jak pro soubory na vyžádání video-on-demand a přijímat živé streamování najdete v tématu [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="a1435-121">For a detailed explanation of fragmented MP4 format and extensions both for video-on-demand files and live streaming ingestion, see [[MS-SSTR]](http://msdn.microsoft.com/library/ff469518.aspx).</span></span>

### <a name="live-ingest-format-definitions"></a><span data-ttu-id="a1435-122">Za provozu ingestování definice formátu</span><span class="sxs-lookup"><span data-stu-id="a1435-122">Live ingest format definitions</span></span>
<span data-ttu-id="a1435-123">Hello následující seznam popisuje speciální formát, který definice, které se vztahují toolive ingestování do služby Azure Media Services:</span><span class="sxs-lookup"><span data-stu-id="a1435-123">hello following list describes special format definitions that apply toolive ingest into Azure Media Services:</span></span>

1. <span data-ttu-id="a1435-124">Hello **ftyp**, **Live pole Manifest serveru**, a **moov** polí, musí se poslat spolu s každou žádostí (HTTP POST).</span><span class="sxs-lookup"><span data-stu-id="a1435-124">hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes MUST be sent with each request (HTTP POST).</span></span> <span data-ttu-id="a1435-125">V těchto polích, musí se poslat od začátku hello hello datového proudu a ingestování kdykoli hello kodér musíte znovu připojit ke tooresume datového proudu.</span><span class="sxs-lookup"><span data-stu-id="a1435-125">These boxes MUST be sent at hello beginning of hello stream and any time hello encoder must reconnect tooresume stream ingest.</span></span> <span data-ttu-id="a1435-126">Další informace najdete v části 6 v [1].</span><span class="sxs-lookup"><span data-stu-id="a1435-126">For more information, see Section 6 in [1].</span></span>
2. <span data-ttu-id="a1435-127">Oddíl 3.3.2 v [1] definuje volitelné pole názvem **StreamManifestBox** pro za provozu ingestování.</span><span class="sxs-lookup"><span data-stu-id="a1435-127">Section 3.3.2 in [1] defines an optional box called **StreamManifestBox** for live ingest.</span></span> <span data-ttu-id="a1435-128">Z důvodu toohello směrování logiku pro vyrovnávání zatížení Azure hello pomocí toto pole je zastaralé.</span><span class="sxs-lookup"><span data-stu-id="a1435-128">Due toohello routing logic of hello Azure load balancer, using this box is deprecated.</span></span> <span data-ttu-id="a1435-129">pole Hello by neměl být při příjem ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="a1435-129">hello box SHOULD NOT be present when ingesting into Media Services.</span></span> <span data-ttu-id="a1435-130">Pokud toto pole je přítomen, Media Services je bezobslužně ignoruje.</span><span class="sxs-lookup"><span data-stu-id="a1435-130">If this box is present, Media Services silently ignores it.</span></span>
3. <span data-ttu-id="a1435-131">Hello **TrackFragmentExtendedHeaderBox** musí být k dispozici pro každý fragment pole definovaná v 3.2.3.2 v [1].</span><span class="sxs-lookup"><span data-stu-id="a1435-131">hello **TrackFragmentExtendedHeaderBox** box defined in 3.2.3.2 in [1] MUST be present for each fragment.</span></span>
4. <span data-ttu-id="a1435-132">Verze 2 hello **TrackFragmentExtendedHeaderBox** pole by MĚL být segmentech použité toogenerate média, které mají stejné adresy URL v několika datových centrech.</span><span class="sxs-lookup"><span data-stu-id="a1435-132">Version 2 of hello **TrackFragmentExtendedHeaderBox** box SHOULD be used toogenerate media segments that have identical URLs in multiple datacenters.</span></span> <span data-ttu-id="a1435-133">pole indexu fragment Hello je REQUIRED mezi datacenter převzetí služeb při selhání na základě indexu streamování formátů, jako je například Apple HLS a na základě indexu MPEG-DASH.</span><span class="sxs-lookup"><span data-stu-id="a1435-133">hello fragment index field is REQUIRED for cross-datacenter failover of index-based streaming formats such as Apple HLS and index-based MPEG-DASH.</span></span> <span data-ttu-id="a1435-134">tooenable mezi datacenter převzetí služeb při selhání, hello fragment index musí synchronizovat napříč více kodéry a zvýší o 1 pro každý fragment následných média, dokonce i v jiných kodér restartování nebo selhání.</span><span class="sxs-lookup"><span data-stu-id="a1435-134">tooenable cross-datacenter failover, hello fragment index MUST be synced across multiple encoders and be increased by 1 for each successive media fragment, even across encoder restarts or failures.</span></span>
5. <span data-ttu-id="a1435-135">Oddíl 3.3.6 v [1] definuje pole s názvem **MovieFragmentRandomAccessBox** (**mfra**), mohou být odeslány na konci hello za provozu přijímání tooindicate end datového proudu (SESTAVENÁ) toohello kanálu.</span><span class="sxs-lookup"><span data-stu-id="a1435-135">Section 3.3.6 in [1] defines a box called **MovieFragmentRandomAccessBox** (**mfra**) that MAY be sent at hello end of live ingestion tooindicate end-of-stream (EOS) toohello channel.</span></span> <span data-ttu-id="a1435-136">Kvůli toohello ingestování logiku Media Services pomocí SESTAVENÁ je zastaralá a hello **mfra** pole pro přijímání za provozu by neměla být odeslána.</span><span class="sxs-lookup"><span data-stu-id="a1435-136">Due toohello ingest logic of Media Services, using EOS is deprecated, and hello **mfra** box for live ingestion SHOULD NOT be sent.</span></span> <span data-ttu-id="a1435-137">Pokud se odeslat, Media Services ji bezobslužně ignoruje.</span><span class="sxs-lookup"><span data-stu-id="a1435-137">If sent, Media Services silently ignores it.</span></span> <span data-ttu-id="a1435-138">Stav hello tooreset hello ingestování bodu, doporučujeme vám, že používáte [resetování kanálu](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span><span class="sxs-lookup"><span data-stu-id="a1435-138">tooreset hello state of hello ingest point, we recommend that you use [Channel Reset](https://docs.microsoft.com/rest/api/media/operations/channel#reset_channels).</span></span> <span data-ttu-id="a1435-139">Také doporučujeme použít [zastavit Program](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend prezentace a datový proud.</span><span class="sxs-lookup"><span data-stu-id="a1435-139">We also recommend that you use [Program Stop](https://msdn.microsoft.com/library/azure/dn783463.aspx#stop_programs) tooend a presentation and stream.</span></span>
6. <span data-ttu-id="a1435-140">Doba trvání fragment Hello MP4 by měla být konstantní, velikost hello tooreduce hello manifesty klientů.</span><span class="sxs-lookup"><span data-stu-id="a1435-140">hello MP4 fragment duration SHOULD be constant, tooreduce hello size of hello client manifests.</span></span> <span data-ttu-id="a1435-141">Konstantní trvání fragment MP4 taky zlepšuje heuristiky stažení klienta prostřednictvím použití hello opakování značky.</span><span class="sxs-lookup"><span data-stu-id="a1435-141">A constant MP4 fragment duration also improves client download heuristics through hello use of repeat tags.</span></span> <span data-ttu-id="a1435-142">Doba trvání Hello může kolísá toocompensate pro kmitočet celé číslo.</span><span class="sxs-lookup"><span data-stu-id="a1435-142">hello duration MAY fluctuate toocompensate for non-integer frame rates.</span></span>
7. <span data-ttu-id="a1435-143">Doba trvání Hello MP4 fragment, musí být mezi přibližně 2 až 6 sekund.</span><span class="sxs-lookup"><span data-stu-id="a1435-143">hello MP4 fragment duration SHOULD be between approximately 2 and 6 seconds.</span></span>
8. <span data-ttu-id="a1435-144">MP4 fragmentovat časová razítka a indexy (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` a `fragment_index`) by MĚL doručení ve vzestupném pořadí.</span><span class="sxs-lookup"><span data-stu-id="a1435-144">MP4 fragment timestamps and indexes (**TrackFragmentExtendedHeaderBox** `fragment_ absolute_ time` and `fragment_index`) SHOULD arrive in increasing order.</span></span> <span data-ttu-id="a1435-145">Fragmenty odolné tooduplicate sice Media Services má omezenou fragmenty tooreorder možnost podle časová osa toohello média.</span><span class="sxs-lookup"><span data-stu-id="a1435-145">Although Media Services is resilient tooduplicate fragments, it has limited ability tooreorder fragments according toohello media timeline.</span></span>

## <a name="4-protocol-format--http"></a><span data-ttu-id="a1435-146">4. Formát protokolu – HTTP</span><span class="sxs-lookup"><span data-stu-id="a1435-146">4. Protocol format – HTTP</span></span>
<span data-ttu-id="a1435-147">ISO fragmentovaný soubor MP4 na základě za provozu ingestování pro Media Services použije standardní dlouho běžící HTTP POST požadavek tootransmit kódovaný média data, která je součástí fragmentovaných služby toohello formátu MP4.</span><span class="sxs-lookup"><span data-stu-id="a1435-147">ISO fragmented MP4-based live ingest for Media Services uses a standard long-running HTTP POST request tootransmit encoded media data that is packaged in fragmented MP4 format toohello service.</span></span> <span data-ttu-id="a1435-148">Každý HTTP POST odešle úplná fragmentovaný proud MP4 ("stream"), od začátku hello s polí hlavičky (**ftyp**, **Live pole Manifest serveru**, a **moov** polí) a pokračujte v sekvenci fragmenty (**moof** a **mdat** polí).</span><span class="sxs-lookup"><span data-stu-id="a1435-148">Each HTTP POST sends a complete fragmented MP4 bitstream ("stream"), starting from hello beginning with header boxes (**ftyp**, **Live Server Manifest Box**, and **moov** boxes), and continuing with a sequence of fragments (**moof** and **mdat** boxes).</span></span> <span data-ttu-id="a1435-149">Syntaxe adresy URL pro požadavek HTTP POST hello naleznete v části in 9.2 [1].</span><span class="sxs-lookup"><span data-stu-id="a1435-149">For URL syntax for hello HTTP POST request, see section 9.2 in [1].</span></span> <span data-ttu-id="a1435-150">Je například hello POST URL:</span><span class="sxs-lookup"><span data-stu-id="a1435-150">An example of hello POST URL is:</span></span> 

    http://customer.channel.mediaservices.windows.net/ingest.isml/streams(720p)

### <a name="requirements"></a><span data-ttu-id="a1435-151">Požadavky</span><span class="sxs-lookup"><span data-stu-id="a1435-151">Requirements</span></span>
<span data-ttu-id="a1435-152">Tady jsou hello podrobné požadavky:</span><span class="sxs-lookup"><span data-stu-id="a1435-152">Here are hello detailed requirements:</span></span>

1. <span data-ttu-id="a1435-153">Hello kodér by se MĚL spustit hello vysílání odesláním požadavku HTTP POST s prázdnou "text" (nulové délky obsahu) pomocí hello stejná adresa URL pro přijímání.</span><span class="sxs-lookup"><span data-stu-id="a1435-153">hello encoder SHOULD start hello broadcast by sending an HTTP POST request with an empty “body” (zero content length) by using hello same ingestion URL.</span></span> <span data-ttu-id="a1435-154">To může pomoct hello kodér rychle zjistit, jestli koncový bod za provozu přijímání hello je platný, a pokud neexistují žádné ověřování nebo jinými podmínkami vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="a1435-154">This can help hello encoder quickly detect whether hello live ingestion endpoint is valid, and if there are any authentication or other conditions required.</span></span> <span data-ttu-id="a1435-155">Na protokolu HTTP hello server nelze odeslat zpět odpovědi HTTP dokud hello celý, včetně textu hello POST, obdrží žádost.</span><span class="sxs-lookup"><span data-stu-id="a1435-155">Per HTTP protocol, hello server can't send back an HTTP response until hello entire request, including hello POST body, is received.</span></span> <span data-ttu-id="a1435-156">Zadané hello dlouho běžící povaha živé události, bez tohoto kroku hello kodér nemusí být možné toodetect všechny chyby, dokud nedokončí odeslání všech dat hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-156">Given hello long-running nature of a live event, without this step, hello encoder might not be able toodetect any error until it finishes sending all hello data.</span></span>
2. <span data-ttu-id="a1435-157">Kodér Hello musí zpracovat žádné chyby nebo výzev ověřování z důvodu (1).</span><span class="sxs-lookup"><span data-stu-id="a1435-157">hello encoder MUST handle any errors or authentication challenges because of (1).</span></span> <span data-ttu-id="a1435-158">Pokud (1) úspěšné odpovědi 200, pokračovat.</span><span class="sxs-lookup"><span data-stu-id="a1435-158">If (1) succeeds with a 200 response, continue.</span></span>
3. <span data-ttu-id="a1435-159">Kodér Hello musí začínat hello fragmentovaný soubor MP4 stream nový požadavek HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-159">hello encoder MUST start a new HTTP POST request with hello fragmented MP4 stream.</span></span> <span data-ttu-id="a1435-160">datová část Hello musí začínat polí hlavičky hello, za nímž následuje fragmenty.</span><span class="sxs-lookup"><span data-stu-id="a1435-160">hello payload MUST start with hello header boxes, followed by fragments.</span></span> <span data-ttu-id="a1435-161">Všimněte si, že hello **ftyp**, **Live pole Manifest serveru**, a **moov** polí (v tomto pořadí), musí se poslat s každou žádostí, i v případě, že kodér hello musíte znovu připojit, protože hello předchozí požadavek byl ukončen před toohello konec datového proudu hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-161">Note that hello **ftyp**, **Live Server Manifest Box**, and **moov** boxes (in this order) MUST be sent with each request, even if hello encoder must reconnect because hello previous request was terminated prior toohello end of hello stream.</span></span> 
4. <span data-ttu-id="a1435-162">Kodér Hello musí používat blokové kódování pro odesílání přenosu, protože je možné toopredict hello celého obsahu délce hello živé události.</span><span class="sxs-lookup"><span data-stu-id="a1435-162">hello encoder MUST use chunked transfer encoding for uploading, because it’s impossible toopredict hello entire content length of hello live event.</span></span>
5. <span data-ttu-id="a1435-163">Pokud se hello událostí myši, po odeslání poslední fragment hello, hello kodér musí končit řádně přenos hello blokové kódování sekvenci zpráv (většina zásobníky klienta HTTP zpracování ji automaticky).</span><span class="sxs-lookup"><span data-stu-id="a1435-163">When hello event is over, after sending hello last fragment, hello encoder MUST gracefully end hello chunked transfer encoding message sequence (most HTTP client stacks handle it automatically).</span></span> <span data-ttu-id="a1435-164">Kodér Hello musí počkejte hello služby tooreturn hello konečné odpovědi kód a pak ukončit připojení hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-164">hello encoder MUST wait for hello service tooreturn hello final response code, and then terminate hello connection.</span></span> 
6. <span data-ttu-id="a1435-165">Kodér Hello nesmí použít hello `Events()` podstatné jméno, jak je popsáno v 9.2 in [1] pro přijímání za provozu ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="a1435-165">hello encoder MUST NOT use hello `Events()` noun as described in 9.2 in [1] for live ingestion into Media Services.</span></span>
7. <span data-ttu-id="a1435-166">Pokud požadavek HTTP POST hello ukončí nebo časy se se koncem předchozí toohello chyba TCP hello datového proudu, hello kodér musí předal nový požadavek POST s použitím nového připojení a postupujte podle hello předchozí požadavky.</span><span class="sxs-lookup"><span data-stu-id="a1435-166">If hello HTTP POST request terminates or times out with a TCP error prior toohello end of hello stream, hello encoder MUST issue a new POST request by using a new connection, and follow hello preceding requirements.</span></span> <span data-ttu-id="a1435-167">Kromě toho musí hello kodér znovu odeslal hello předchozí dva MP4 fragmenty pro každý sledování v datovém proudu hello a pokračovat bez zavedení nespojitost v ose média hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-167">Additionally, hello encoder MUST resend hello previous two MP4 fragments for each track in hello stream, and resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a1435-168">Odešlete hello posledních dvou MP4 fragmenty pro každý sledování zajišťuje, že nedochází ke ztrátě dat.</span><span class="sxs-lookup"><span data-stu-id="a1435-168">Resending hello last two MP4 fragments for each track ensures that there is no data loss.</span></span> <span data-ttu-id="a1435-169">Jinými slovy pokud obsahuje datového proudu audio a video sledovat a aktuální požadavek POST hello selže, hello kodér musíte znovu připojit ke a znovu odeslal hello posledních dvou fragmenty pro hello zvuk sledování, které byly dříve úspěšně odeslán, a hello posledních dvou fragmenty pro Hello video sledování, které byly dříve úspěšně odeslán, tooensure, že je dispozici nedošlo ke ztrátě dat.</span><span class="sxs-lookup"><span data-stu-id="a1435-169">In other words, if a stream contains both an audio and a video track, and hello current POST request fails, hello encoder must reconnect and resend hello last two fragments for hello audio track, which were previously successfully sent, and hello last two fragments for hello video track, which were previously successfully sent, tooensure that there is no data loss.</span></span> <span data-ttu-id="a1435-170">Kodér Hello musí zachovat "forward" vyrovnávací paměti fragmenty média, které opětovně odešle při opětovném připojení.</span><span class="sxs-lookup"><span data-stu-id="a1435-170">hello encoder MUST maintain a “forward” buffer of media fragments, which it resends when it reconnects.</span></span>

## <a name="5-timescale"></a><span data-ttu-id="a1435-171">5. Časová osa</span><span class="sxs-lookup"><span data-stu-id="a1435-171">5. Timescale</span></span>
<span data-ttu-id="a1435-172">[[MS-SSTR] ](https://msdn.microsoft.com/library/ff469518.aspx) popisuje využití hello časové osy pro **SmoothStreamingMedia** (část 2.2.2.1) a **StreamElement** (část 2.2.2.3) a **StreamFragmentElement**(Část 2.2.2.6), a **LiveSMIL** (část 2.2.7.3.1).</span><span class="sxs-lookup"><span data-stu-id="a1435-172">[[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx) describes hello usage of timescale for **SmoothStreamingMedia** (Section 2.2.2.1), **StreamElement** (Section 2.2.2.3), **StreamFragmentElement** (Section 2.2.2.6), and **LiveSMIL** (Section 2.2.7.3.1).</span></span> <span data-ttu-id="a1435-173">Pokud hodnota časový rámec hello není přítomný, hello použita výchozí hodnota 10 000 000 (10 MHz).</span><span class="sxs-lookup"><span data-stu-id="a1435-173">If hello timescale value is not present, hello default value used is 10,000,000 (10 MHz).</span></span> <span data-ttu-id="a1435-174">I když hello technologie Smooth Streaming specifikaci formátu nebrání použití jiných hodnot časový rámec, většina implementace kodér používat toto výchozí nastavení toogenerate hodnotu (10 MHz), technologie Smooth Streaming ingestovat data.</span><span class="sxs-lookup"><span data-stu-id="a1435-174">Although hello Smooth Streaming format specification doesn’t block usage of other timescale values, most encoder implementations use this default value (10 MHz) toogenerate Smooth Streaming ingest data.</span></span> <span data-ttu-id="a1435-175">Kvůli toohello [Azure Media dynamické balení](media-services-dynamic-packaging-overview.md) funkce, doporučujeme použít za 90 KHz časový rámec pro datové proudy videa a 44,1 KHz nebo 48.1 KHz pro zvukové datové proudy.</span><span class="sxs-lookup"><span data-stu-id="a1435-175">Due toohello [Azure Media Dynamic Packaging](media-services-dynamic-packaging-overview.md) feature, we recommend that you use a 90-KHz timescale for video streams and 44.1 KHz or 48.1 KHz for audio streams.</span></span> <span data-ttu-id="a1435-176">Pokud jiný časový rámec hodnoty se používají pro různé datové proudy, musí se poslat hello datového proudu úrovni časový rámec.</span><span class="sxs-lookup"><span data-stu-id="a1435-176">If different timescale values are used for different streams, hello stream-level timescale MUST be sent.</span></span> <span data-ttu-id="a1435-177">Další informace najdete v tématu [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span><span class="sxs-lookup"><span data-stu-id="a1435-177">For more information, see [[MS-SSTR]](https://msdn.microsoft.com/library/ff469518.aspx).</span></span>     

## <a name="6-definition-of-stream"></a><span data-ttu-id="a1435-178">6. Definice "stream"</span><span class="sxs-lookup"><span data-stu-id="a1435-178">6. Definition of “stream”</span></span>
<span data-ttu-id="a1435-179">Datový proud je hello je základní jednotkou operace v za provozu přijímání pro sestavování za provozu prezentací, zpracování datových proudů převzetí služeb při selhání a redundance scénáře.</span><span class="sxs-lookup"><span data-stu-id="a1435-179">Stream is hello basic unit of operation in live ingestion for composing live presentations, handling streaming failover, and redundancy scenarios.</span></span> <span data-ttu-id="a1435-180">Datový proud je definován jako jeden jedinečný, fragmentovaných MP4 proud, který může obsahovat jediné stopy nebo několik stop.</span><span class="sxs-lookup"><span data-stu-id="a1435-180">Stream is defined as one unique, fragmented MP4 bitstream that might contain a single track or multiple tracks.</span></span> <span data-ttu-id="a1435-181">Prezentace úplné online může obsahovat jeden nebo více datových proudů, v závislosti na konfiguraci hello kodéry hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-181">A full live presentation might contain one or more streams, depending on hello configuration of hello live encoders.</span></span> <span data-ttu-id="a1435-182">Hello následující příklady znázorňují různé možnosti používání toocompose datové proudy živého prezentace.</span><span class="sxs-lookup"><span data-stu-id="a1435-182">hello following examples illustrate various options of using streams toocompose a full live presentation.</span></span>

<span data-ttu-id="a1435-183">**Příklad:**</span><span class="sxs-lookup"><span data-stu-id="a1435-183">**Example:**</span></span> 

<span data-ttu-id="a1435-184">Zákazník chce toocreate živé streamování prezentace, které zahrnuje následující přenosových rychlostí zvuku a videa hello:</span><span class="sxs-lookup"><span data-stu-id="a1435-184">A customer wants toocreate a live streaming presentation that includes hello following audio/video bitrates:</span></span>

<span data-ttu-id="a1435-185">Video – 3000 kB/s, 1 500 kb/s, 750 kb/s</span><span class="sxs-lookup"><span data-stu-id="a1435-185">Video – 3000 kbps, 1500 kbps, 750 kbps</span></span>

<span data-ttu-id="a1435-186">Zvuk – 128 kb/s</span><span class="sxs-lookup"><span data-stu-id="a1435-186">Audio – 128 kbps</span></span>

### <a name="option-1-all-tracks-in-one-stream"></a><span data-ttu-id="a1435-187">Možnost 1: Všechny sleduje v jeden datový proud</span><span class="sxs-lookup"><span data-stu-id="a1435-187">Option 1: All tracks in one stream</span></span>
<span data-ttu-id="a1435-188">V tuto možnost jeden kodér generuje všechny sleduje zvuku a videa a pak je do jedné fragmentovaný proud MP4 obsahuje ureitou.</span><span class="sxs-lookup"><span data-stu-id="a1435-188">In this option, a single encoder generates all audio/video tracks, and then bundles them into one fragmented MP4 bitstream.</span></span> <span data-ttu-id="a1435-189">Hello fragmentovaný soubor MP4 proud se pak odešlou prostřednictvím jednoho připojení HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-189">hello fragmented MP4 bitstream is then sent via a single HTTP POST connection.</span></span> <span data-ttu-id="a1435-190">V tomto příkladu je pouze jeden datový proud pro prezentaci online.</span><span class="sxs-lookup"><span data-stu-id="a1435-190">In this example, there is only one stream for this live presentation.</span></span>

![Sledování datové proudy: 1][image2]

### <a name="option-2-each-track-in-a-separate-stream"></a><span data-ttu-id="a1435-192">Možnost 2: Každý sledování v samostatných datového proudu</span><span class="sxs-lookup"><span data-stu-id="a1435-192">Option 2: Each track in a separate stream</span></span>
<span data-ttu-id="a1435-193">V tuto možnost hello kodér umístí jeden sledování do každé proud fragment MP4 a odešle všechny hello datové proudy přes samostatné připojení prostřednictvím protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="a1435-193">In this option, hello encoder puts one track into each fragment MP4 bitstream, and then posts all of hello streams over separate HTTP connections.</span></span> <span data-ttu-id="a1435-194">To lze provést pomocí kodéru jeden nebo více kodéry.</span><span class="sxs-lookup"><span data-stu-id="a1435-194">This can be done with one encoder or with multiple encoders.</span></span> <span data-ttu-id="a1435-195">za provozu přijímání Hello uvidí prezentaci online jako se skládá z čtyři datových proudů.</span><span class="sxs-lookup"><span data-stu-id="a1435-195">hello live ingestion sees this live presentation as composed of four streams.</span></span>

![Sleduje samostatné datové proudy][image3]

### <a name="option-3-bundle-audio-track-with-hello-lowest-bitrate-video-track-into-one-stream"></a><span data-ttu-id="a1435-197">Možnost 3: Sady zvukové stopy s hello nejnižší přenosovou rychlostí video sledování do jednoho datového proudu</span><span class="sxs-lookup"><span data-stu-id="a1435-197">Option 3: Bundle audio track with hello lowest bitrate video track into one stream</span></span>
<span data-ttu-id="a1435-198">Tuto možnost zvolí hello zákazníka toobundle hello zvuk sledování s hello sledovat video nejnižší přenosovou rychlostí v jedné fragment MP4 proud a nechte hello další dvě video sleduje jako samostatné datové proudy.</span><span class="sxs-lookup"><span data-stu-id="a1435-198">In this option, hello customer chooses toobundle hello audio track with hello lowest-bitrate video track in one fragment MP4 bitstream, and leave hello other two video tracks as separate streams.</span></span> 

![Sleduje datové proudy zvuk a video][image4]

### <a name="summary"></a><span data-ttu-id="a1435-200">Souhrn</span><span class="sxs-lookup"><span data-stu-id="a1435-200">Summary</span></span>
<span data-ttu-id="a1435-201">Nejedná se o vyčerpávající seznam všech možných přijímání možností v tomto příkladu.</span><span class="sxs-lookup"><span data-stu-id="a1435-201">This is not an exhaustive list of all possible ingestion options for this example.</span></span> <span data-ttu-id="a1435-202">Jako matter z skutečnosti za provozu přijímání podporuje všechny seskupení sleduje do datových proudů.</span><span class="sxs-lookup"><span data-stu-id="a1435-202">As a matter of fact, any grouping of tracks into streams is supported by live ingestion.</span></span> <span data-ttu-id="a1435-203">Zákazníci a dodavatelé encoder můžete zvolit vlastní implementací na základě engineering složitost, kodér kapacitu a redundanci a důležité informace o převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="a1435-203">Customers and encoder vendors can choose their own implementations based on engineering complexity, encoder capacity, and redundancy and failover considerations.</span></span> <span data-ttu-id="a1435-204">Ale ve většině případů není pouze jeden zvuk sledovat hello celé za provozu prezentaci.</span><span class="sxs-lookup"><span data-stu-id="a1435-204">However, in most cases, there is only one audio track for hello entire live presentation.</span></span> <span data-ttu-id="a1435-205">Ano jeho důležité tooensure hello healthiness Dobrý den ingestování datový proud, který obsahuje zvukové stopy hello. Tento aspekt často vede k uvedení hello zvukové stopy v vlastní datový proud (jako možnost 2) nebo sdružování s sledovat videa hello nejnižší přenosovou rychlostí (jako možnost 3).</span><span class="sxs-lookup"><span data-stu-id="a1435-205">So, it’s important tooensure hello healthiness of hello ingest stream that contains hello audio track. This consideration often results in putting hello audio track in its own stream (as in Option 2) or bundling it with hello lowest-bitrate video track (as in Option 3).</span></span> <span data-ttu-id="a1435-206">Navíc lepší redundanci a odolnost proti chybám, odesílání hello stejné zvuk sledovat ve dvou různých datových proudů (možnost 2 s redundantní zvukových stop) nebo instalujícího hello zvukové stopy s alespoň dvě z video sleduje hello nejnižší přenosovou rychlostí (možnost 3 s zvuk dodávat v na minimálně dvě datové proudy videa) důrazně doporučujeme pro za provozu ingestování ve službě Media Services.</span><span class="sxs-lookup"><span data-stu-id="a1435-206">Also, for better redundancy and fault tolerance, sending hello same audio track in two different streams (Option 2 with redundant audio tracks) or bundling hello audio track with at least two of hello lowest-bitrate video tracks (Option 3 with audio bundled in at least two video streams) is highly recommended for live ingest into Media Services.</span></span>

## <a name="7-service-failover"></a><span data-ttu-id="a1435-207">7. Převzetí služeb při selhání služby</span><span class="sxs-lookup"><span data-stu-id="a1435-207">7. Service failover</span></span>
<span data-ttu-id="a1435-208">Zadaný hello povaha živé vysílání datového proudu je důležité pro zajištění dostupnosti hello služby hello podporu funkční převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="a1435-208">Given hello nature of live streaming, good failover support is critical for ensuring hello availability of hello service.</span></span> <span data-ttu-id="a1435-209">Služba Media Services je navrženou toohandle různých typů chyb, včetně chyby sítě, server chyb a problémů s úložištěm.</span><span class="sxs-lookup"><span data-stu-id="a1435-209">Media Services is designed toohandle various types of failures, including network errors, server errors, and storage issues.</span></span> <span data-ttu-id="a1435-210">Při použití ve spojení s logikou správné převzetí služeb při selhání ze strany hello kodér za provozu, můžete dosáhnout zákazníkům vysoce spolehlivá služba živého streamování z cloudu hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-210">When used in conjunction with proper failover logic from hello live encoder side, customers can achieve a highly reliable live streaming service from hello cloud.</span></span>

<span data-ttu-id="a1435-211">V této části probereme scénáře převzetí služeb při selhání služby.</span><span class="sxs-lookup"><span data-stu-id="a1435-211">In this section, we discuss service failover scenarios.</span></span> <span data-ttu-id="a1435-212">V takovém případě se stane chyba hello někde v rámci služby hello a projeví se to jako chybu v síti.</span><span class="sxs-lookup"><span data-stu-id="a1435-212">In this case, hello failure happens somewhere within hello service, and it manifests itself as a network error.</span></span> <span data-ttu-id="a1435-213">Tady jsou některá doporučení pro implementaci hello kodéru pro zpracování převzetí služeb při selhání služby:</span><span class="sxs-lookup"><span data-stu-id="a1435-213">Here are some recommendations for hello encoder implementation for handling service failover:</span></span>

1. <span data-ttu-id="a1435-214">Použijte 10 sekundu vypršení časového limitu pro vytvoření připojení protokolu TCP hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-214">Use a 10-second timeout for establishing hello TCP connection.</span></span> <span data-ttu-id="a1435-215">Pokud připojení k pokusu o tooestablish hello trvá déle než 10 sekund, přerušit hello operace a akci opakujte.</span><span class="sxs-lookup"><span data-stu-id="a1435-215">If an attempt tooestablish hello connection takes longer than 10 seconds, abort hello operation and try again.</span></span> 
2. <span data-ttu-id="a1435-216">Použijte krátký časový limit pro odesílání bloky zpráv hello HTTP žádosti.</span><span class="sxs-lookup"><span data-stu-id="a1435-216">Use a short timeout for sending hello HTTP request message chunks.</span></span> <span data-ttu-id="a1435-217">Pokud doba trvání fragment hello cíl MP4 po dobu N sekund, použijte časový limit odeslání N až 2 po dobu N sekund; Například pokud hello MP4 fragment doba je 6 sekund, použijte vypršení časového limitu 6 too12 sekund.</span><span class="sxs-lookup"><span data-stu-id="a1435-217">If hello target MP4 fragment duration is N seconds, use a send timeout between N and 2 N seconds; for example, if hello MP4 fragment duration is 6 seconds, use a timeout of 6 too12 seconds.</span></span> <span data-ttu-id="a1435-218">Pokud dojde k vypršení časového limitu, resetování hello připojení, otevřete nové připojení a obnovení datového proudu ingestování na hello nové připojení.</span><span class="sxs-lookup"><span data-stu-id="a1435-218">If a timeout occurs, reset hello connection, open a new connection, and resume stream ingest on hello new connection.</span></span> 
3. <span data-ttu-id="a1435-219">Udržujte postupného vyrovnávací paměť, která má hello posledních dvou fragmenty pro každý sledování odeslané úspěšně a úplně toohello služby.</span><span class="sxs-lookup"><span data-stu-id="a1435-219">Maintain a rolling buffer that has hello last two fragments for each track that were successfully and completely sent toohello service.</span></span>  <span data-ttu-id="a1435-220">Pokud hello požadavku HTTP POST pro datový proud je ukončen nebo časového limitu předchozí toohello konec datového proudu hello, otevřít nové připojení a začít další požadavek HTTP POST, znovu odeslat hello datového proudu hlavičky, znovu odeslat hello posledních dvou fragmenty pro každý sledovat a obnovit datového proudu hello bez Představení nespojitost v ose hello média.</span><span class="sxs-lookup"><span data-stu-id="a1435-220">If hello HTTP POST request for a stream is terminated or times out prior toohello end of hello stream, open a new connection and begin another HTTP POST request, resend hello stream headers, resend hello last two fragments for each track, and resume hello stream without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a1435-221">Tím se snižuje riziko ztráty dat hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-221">This reduces hello chance of data loss.</span></span>
4. <span data-ttu-id="a1435-222">Doporučujeme, že kodér hello omezit hello počet opakování tooestablish připojení nebo obnovit streamování potom, co dojde k chybě protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="a1435-222">We recommend that hello encoder does NOT limit hello number of retries tooestablish a connection or resume streaming after a TCP error occurs.</span></span>
5. <span data-ttu-id="a1435-223">Po chybě TCP:</span><span class="sxs-lookup"><span data-stu-id="a1435-223">After a TCP error:</span></span>
  
    <span data-ttu-id="a1435-224">a.</span><span class="sxs-lookup"><span data-stu-id="a1435-224">a.</span></span> <span data-ttu-id="a1435-225">MUSÍ být uzavřeny Hello aktuální připojení a pro nový požadavek HTTP POST je třeba vytvořit nové připojení.</span><span class="sxs-lookup"><span data-stu-id="a1435-225">hello current connection MUST be closed, and a new connection MUST be created for a new HTTP POST request.</span></span>

    <span data-ttu-id="a1435-226">b.</span><span class="sxs-lookup"><span data-stu-id="a1435-226">b.</span></span> <span data-ttu-id="a1435-227">hello Hello nové HTTP POST adresa URL musí být stejný jako hello počáteční adresa URL POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-227">hello new HTTP POST URL MUST be hello same as hello initial POST URL.</span></span>
  
    <span data-ttu-id="a1435-228">c.</span><span class="sxs-lookup"><span data-stu-id="a1435-228">c.</span></span> <span data-ttu-id="a1435-229">Hello nové HTTP POST musí obsahovat záhlaví datového proudu (**ftyp**, **Live pole Manifest serveru**, a **moov** polí), které jsou identické toohello datového proudu hlavičky v hello počáteční POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-229">hello new HTTP POST MUST include stream headers (**ftyp**, **Live Server Manifest Box**, and **moov** boxes) that are identical toohello stream headers in hello initial POST.</span></span>
  
    <span data-ttu-id="a1435-230">d.</span><span class="sxs-lookup"><span data-stu-id="a1435-230">d.</span></span> <span data-ttu-id="a1435-231">poslední dva fragmenty Hello odeslané pro každý sledovat nutné odeslat znovu, a vysílání datového proudu musí pokračovat bez zavedení nespojitost v ose média hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-231">hello last two fragments sent for each track must be resent, and streaming must resume without introducing a discontinuity in hello media timeline.</span></span> <span data-ttu-id="a1435-232">Hello časová razítka fragment MP4 musíte zvýšit nepřetržitě, i přes požadavky HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-232">hello MP4 fragment timestamps must increase continuously, even across HTTP POST requests.</span></span>
6. <span data-ttu-id="a1435-233">Kodér Hello by MĚL skončí požadavku HTTP POST hello, pokud se data neodesílají rychlostí úměrná hello MP4 fragment trvání.</span><span class="sxs-lookup"><span data-stu-id="a1435-233">hello encoder SHOULD terminate hello HTTP POST request if data is not being sent at a rate commensurate with hello MP4 fragment duration.</span></span>  <span data-ttu-id="a1435-234">Požadavek HTTP POST, který neodesílá data zabránit rychle se odpojuje od hello kodér v události hello aktualizace služby Media Services.</span><span class="sxs-lookup"><span data-stu-id="a1435-234">An HTTP POST request that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update.</span></span> <span data-ttu-id="a1435-235">Z tohoto důvodu hello HTTP POST pro zhuštěné (signál ad) sleduje by měla být krátkodobou, hned, jak se odesílají zhuštěných fragment hello se ukončuje.</span><span class="sxs-lookup"><span data-stu-id="a1435-235">For this reason, hello HTTP POST for sparse (ad signal) tracks SHOULD be short-lived, terminating as soon as hello sparse fragment is sent.</span></span>

## <a name="8-encoder-failover"></a><span data-ttu-id="a1435-236">8. Kodér převzetí služeb při selhání</span><span class="sxs-lookup"><span data-stu-id="a1435-236">8. Encoder failover</span></span>
<span data-ttu-id="a1435-237">Kodér převzetí služeb při selhání je hello druhého typu scénáře převzetí služeb při selhání, který potřebuje toobe řešit pro živé streamování doručení začátku do konce.</span><span class="sxs-lookup"><span data-stu-id="a1435-237">Encoder failover is hello second type of failover scenario that needs toobe addressed for end-to-end live streaming delivery.</span></span> <span data-ttu-id="a1435-238">V tomto scénáři hello chybovému stavu dojde na straně kodér hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-238">In this scenario, hello error condition occurs on hello encoder side.</span></span> 

![Kodér převzetí služeb při selhání][image5]

<span data-ttu-id="a1435-240">když kodér převzetí služeb při selhání se stane, platí Hello následující očekávání z koncového bodu za provozu přijímání hello:</span><span class="sxs-lookup"><span data-stu-id="a1435-240">hello following expectations apply from hello live ingestion endpoint when encoder failover happens:</span></span>

1. <span data-ttu-id="a1435-241">Kodér vytvořit novou instanci, by měla být toocontinue streamování, jak ukazuje následující diagram hello (datový proud pro 3000 tisíc video s přerušovanou čáru).</span><span class="sxs-lookup"><span data-stu-id="a1435-241">A new encoder instance SHOULD be created toocontinue streaming, as illustrated in hello diagram (Stream for 3000k video, with dashed line).</span></span>
2. <span data-ttu-id="a1435-242">nové kodér Hello musí použít hello stejné adresy URL pro metodu POST HTTP požadavků jako hello se nezdařilo instance.</span><span class="sxs-lookup"><span data-stu-id="a1435-242">hello new encoder MUST use hello same URL for HTTP POST requests as hello failed instance.</span></span>
3. <span data-ttu-id="a1435-243">Hello požadavek POST nové kodér musí zahrnovat hello stejné jako hello nezdařených instancí fragmentovaný soubor MP4 polí hlavičky.</span><span class="sxs-lookup"><span data-stu-id="a1435-243">hello new encoder’s POST request MUST include hello same fragmented MP4 header boxes as hello failed instance.</span></span>
4. <span data-ttu-id="a1435-244">nové kodér Hello musí správně synchronizovat se všechny ostatní spuštěné kodéry pro hello stejné toogenerate za provozu prezentace synchronizovat ukázky zvuku a videa s zarovnaný fragment hranice.</span><span class="sxs-lookup"><span data-stu-id="a1435-244">hello new encoder MUST be properly synced with all other running encoders for hello same live presentation toogenerate synced audio/video samples with aligned fragment boundaries.</span></span>
5. <span data-ttu-id="a1435-245">Hello nového datového proudu musí být sémanticky ekvivalentní s hello předchozí datového proudu a zaměňovat úrovni záhlaví a fragment hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-245">hello new stream MUST be semantically equivalent with hello previous stream, and interchangeable at hello header and fragment levels.</span></span>
6. <span data-ttu-id="a1435-246">nové kodér Hello opakovat ztráty dat toominimize.</span><span class="sxs-lookup"><span data-stu-id="a1435-246">hello new encoder SHOULD try toominimize data loss.</span></span> <span data-ttu-id="a1435-247">Hello `fragment_absolute_time` a `fragment_index` média měli zvýšit fragmenty z hello bodu, kde poslední zastavení kodér hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-247">hello `fragment_absolute_time` and `fragment_index` of media fragments SHOULD increase from hello point where hello encoder last stopped.</span></span> <span data-ttu-id="a1435-248">Hello `fragment_absolute_time` a `fragment_index` měli zvýšit průběžně, ale je povolený toointroduce nespojitost, v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="a1435-248">hello `fragment_absolute_time` and `fragment_index` SHOULD increase in a continuous manner, but it is permissible toointroduce a discontinuity, if necessary.</span></span> <span data-ttu-id="a1435-249">Služba Media Services ignoruje fragmenty, které má již přijme a zpracuje, tak, aby byl lépe tooerr na straně hello odešlete fragmenty než toointroduce nespojitosti v ose hello média.</span><span class="sxs-lookup"><span data-stu-id="a1435-249">Media Services ignores fragments that it has already received and processed, so it's better tooerr on hello side of resending fragments than toointroduce discontinuities in hello media timeline.</span></span> 

## <a name="9-encoder-redundancy"></a><span data-ttu-id="a1435-250">9. Kodér redundance</span><span class="sxs-lookup"><span data-stu-id="a1435-250">9. Encoder redundancy</span></span>
<span data-ttu-id="a1435-251">V případě důležitých živých událostí, vyžádání i vyšší dostupnost a kvalitní uživatelský dojem, doporučujeme použít redundantní kodéry v režimu aktivní aktivní tooachieve bezproblémové převzetí služeb při selhání bez ztráty dat..</span><span class="sxs-lookup"><span data-stu-id="a1435-251">For certain critical live events that demand even higher availability and quality of experience, we recommended that you use active-active redundant encoders tooachieve seamless failover with no data loss.</span></span>

![Kodér redundance][image6]

<span data-ttu-id="a1435-253">Jak je ukázáno v tomto diagramu, dvě skupiny kodéry dvě kopie každé datového proudu současně vkládání do provozu služby hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-253">As illustrated in this diagram, two groups of encoders push two copies of each stream simultaneously into hello live service.</span></span> <span data-ttu-id="a1435-254">Tato instalace je podporována, protože Media Services můžete filtrovat podle ID a fragment datového proudu časové razítko duplicitní fragmenty.</span><span class="sxs-lookup"><span data-stu-id="a1435-254">This setup is supported because Media Services can filter out duplicate fragments based on stream ID and fragment timestamp.</span></span> <span data-ttu-id="a1435-255">Hello výsledné živý datový proud a archivu je jedna kopie všechny datové proudy hello, který je nejlepší možný agregace hello ze dvou zdrojů hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-255">hello resulting live stream and archive is a single copy of all hello streams that is hello best possible aggregation from hello two sources.</span></span> <span data-ttu-id="a1435-256">Například v případě hypotetický extreme, dokud je jeden kodér (nemá toobe hello stejné jeden) spuštěna v libovolném bodě v čase pro každý datový proud hello výsledná živý datový proud z hello služby je souvislý bez ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="a1435-256">For example, in a hypothetical extreme case, as long as there is one encoder (it doesn’t have toobe hello same one) running at any given point in time for each stream, hello resulting live stream from hello service is continuous without data loss.</span></span> 

<span data-ttu-id="a1435-257">Hello požadavky pro tento scénář jsou téměř stejné hello jako hello požadavky v případě "Kodér převzetí" hello, s výjimkou hello, který hello druhá sada kodéry jsou spuštěné v hello stejný čas hello primární kodéry.</span><span class="sxs-lookup"><span data-stu-id="a1435-257">hello requirements for this scenario are almost hello same as hello requirements in hello "Encoder failover" case, with hello exception that hello second set of encoders are running at hello same time as hello primary encoders.</span></span>

## <a name="10-service-redundancy"></a><span data-ttu-id="a1435-258">10. Služba redundance</span><span class="sxs-lookup"><span data-stu-id="a1435-258">10. Service redundancy</span></span>
<span data-ttu-id="a1435-259">Pro vysoce redundantní globální distribuci někdy musí mít místní havárie zálohování toohandle mezi oblastmi.</span><span class="sxs-lookup"><span data-stu-id="a1435-259">For highly redundant global distribution, sometimes you must have cross-region backup toohandle regional disasters.</span></span> <span data-ttu-id="a1435-260">Rozšíření na topologii "Kodér redundance" hello, zákazníků můžete zvolit toohave nasazení redundantní služby v jiné oblasti, která je propojená s druhou sadu kodéry hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-260">Expanding on hello “Encoder redundancy” topology, customers can choose toohave a redundant service deployment in a different region that's connected with hello second set of encoders.</span></span> <span data-ttu-id="a1435-261">Zákazníci také můžete pracovat s toodeploy zprostředkovatele Content Delivery Network globální Traffic Manager před hello dvě služby nasazení tooseamlessly směrovat Klientský provoz.</span><span class="sxs-lookup"><span data-stu-id="a1435-261">Customers also can work with a Content Delivery Network provider toodeploy a Global Traffic Manager in front of hello two service deployments tooseamlessly route client traffic.</span></span> <span data-ttu-id="a1435-262">Hello požadavky hello kodéry jsou, stejně jako hello případ "Kodér redundance" hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-262">hello requirements for hello encoders are hello same as hello “Encoder redundancy” case.</span></span> <span data-ttu-id="a1435-263">Hello pouze výjimkou je hello druhá sada kodéry potřebám toobe za provozu odkazoval tooa různých ingestování koncový bod.</span><span class="sxs-lookup"><span data-stu-id="a1435-263">hello only exception is that hello second set of encoders needs toobe pointed tooa different live ingest endpoint.</span></span> <span data-ttu-id="a1435-264">Hello následující diagram znázorňuje tento instalační program:</span><span class="sxs-lookup"><span data-stu-id="a1435-264">hello following diagram shows this setup:</span></span>

![Služba redundance][image7]

## <a name="11-special-types-of-ingestion-formats"></a><span data-ttu-id="a1435-266">11. Speciální typy přijímání formáty</span><span class="sxs-lookup"><span data-stu-id="a1435-266">11. Special types of ingestion formats</span></span>
<span data-ttu-id="a1435-267">Tato část popisuje speciální typy provozu přijímání formátů, které jsou navržené toohandle konkrétních scénářů.</span><span class="sxs-lookup"><span data-stu-id="a1435-267">This section discusses special types of live ingestion formats that are designed toohandle specific scenarios.</span></span>

### <a name="sparse-track"></a><span data-ttu-id="a1435-268">Zhuštěný sledování</span><span class="sxs-lookup"><span data-stu-id="a1435-268">Sparse track</span></span>
<span data-ttu-id="a1435-269">Při předvádění živé streamování prezentace plně funkčního klienta prostředí, často je nutné tootransmit synchronizovat čas události nebo signály integrovaná s daty hlavní média hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-269">When delivering a live streaming presentation with a rich client experience, often it's necessary tootransmit time-synced events or signals in-band with hello main media data.</span></span> <span data-ttu-id="a1435-270">Příkladem je vkládání reklam dynamické za provozu.</span><span class="sxs-lookup"><span data-stu-id="a1435-270">An example of this is dynamic live ad insertion.</span></span> <span data-ttu-id="a1435-271">Tento typ signalizace událostí se liší od regulární zvuku a videa streamování z důvodu jeho zhuštěných povahy.</span><span class="sxs-lookup"><span data-stu-id="a1435-271">This type of event signaling is different from regular audio/video streaming because of its sparse nature.</span></span> <span data-ttu-id="a1435-272">Jinými slovy hello signalizace data obvykle neodehrává nepřetržitě a hello interval může být pevný toopredict.</span><span class="sxs-lookup"><span data-stu-id="a1435-272">In other words, hello signaling data usually does not happen continuously, and hello interval can be hard toopredict.</span></span> <span data-ttu-id="a1435-273">Hello konceptu zhuštěných sledovat byl navrženou tooingest a vysílání vzdálené signalizační data.</span><span class="sxs-lookup"><span data-stu-id="a1435-273">hello concept of sparse track was designed tooingest and broadcast in-band signaling data.</span></span>

<span data-ttu-id="a1435-274">Hello následující kroky jsou doporučené implementace pro příjem zhuštěných sledovat:</span><span class="sxs-lookup"><span data-stu-id="a1435-274">hello following steps are a recommended implementation for ingesting sparse track:</span></span>

1. <span data-ttu-id="a1435-275">Vytvořte samostatný fragmentovaný proud MP4, obsahující pouze zhuštěných sleduje bez sleduje zvuku a videa.</span><span class="sxs-lookup"><span data-stu-id="a1435-275">Create a separate fragmented MP4 bitstream that contains only sparse tracks, without audio/video tracks.</span></span>
2. <span data-ttu-id="a1435-276">V hello **Live pole Manifest serveru** definuje v části 6 [1], použijte hello *parentTrackName* parametr toospecify hello název nadřazené dráhy hello. Další informace najdete v části 4.2.1.2.1.2 v [1].</span><span class="sxs-lookup"><span data-stu-id="a1435-276">In hello **Live Server Manifest Box** as defined in Section 6 in [1], use hello *parentTrackName* parameter toospecify hello name of hello parent track. For more information, see section 4.2.1.2.1.2 in [1].</span></span>
3. <span data-ttu-id="a1435-277">V hello **Live pole Manifest serveru**, **manifestOutput** musí být nastaven příliš**true**.</span><span class="sxs-lookup"><span data-stu-id="a1435-277">In hello **Live Server Manifest Box**, **manifestOutput** MUST be set too**true**.</span></span>
4. <span data-ttu-id="a1435-278">Zadané hello zhuštěných povaha hello signalizace událostí, doporučujeme následující hello:</span><span class="sxs-lookup"><span data-stu-id="a1435-278">Given hello sparse nature of hello signaling event, we recommended hello following:</span></span>
   
    <span data-ttu-id="a1435-279">a.</span><span class="sxs-lookup"><span data-stu-id="a1435-279">a.</span></span> <span data-ttu-id="a1435-280">Na hello začátku hello živé události, odešle hello kodér hello počáteční záhlaví polí toohello služby, která umožňuje hello služby tooregister hello zhuštěných sledování v manifestu hello klienta.</span><span class="sxs-lookup"><span data-stu-id="a1435-280">At hello beginning of hello live event, hello encoder sends hello initial header boxes toohello service, which allows hello service tooregister hello sparse track in hello client manifest.</span></span>
   
    <span data-ttu-id="a1435-281">b.</span><span class="sxs-lookup"><span data-stu-id="a1435-281">b.</span></span> <span data-ttu-id="a1435-282">Kodér Hello musí ukončit požadavku HTTP POST hello, když se data neodesílají.</span><span class="sxs-lookup"><span data-stu-id="a1435-282">hello encoder SHOULD terminate hello HTTP POST request when data is not being sent.</span></span> <span data-ttu-id="a1435-283">Rychle se odpojuje od hello kodér v hello události restartu služby update nebo serveru služby Media Services můžete zabránit HTTP POST dlouho běžící, který není odesílat data.</span><span class="sxs-lookup"><span data-stu-id="a1435-283">A long-running HTTP POST that does not send data can prevent Media Services from quickly disconnecting from hello encoder in hello event of a service update or server reboot.</span></span> <span data-ttu-id="a1435-284">V těchto případech je server mediálních hello dočasně blokovaných v operace příjmu soketem hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-284">In these cases, hello media server is temporarily blocked in a receive operation on hello socket.</span></span>
   
    <span data-ttu-id="a1435-285">c.</span><span class="sxs-lookup"><span data-stu-id="a1435-285">c.</span></span> <span data-ttu-id="a1435-286">Během doby hello, pokud není k dispozici signalizace dat zavřete hello kodér hello požadavku HTTP POST.</span><span class="sxs-lookup"><span data-stu-id="a1435-286">During hello time when signaling data is not available, hello encoder SHOULD close hello HTTP POST request.</span></span> <span data-ttu-id="a1435-287">Při požadavku POST hello je aktivní, měli hello kodér odesílat data.</span><span class="sxs-lookup"><span data-stu-id="a1435-287">While hello POST request is active, hello encoder SHOULD send data.</span></span>

    <span data-ttu-id="a1435-288">d.</span><span class="sxs-lookup"><span data-stu-id="a1435-288">d.</span></span> <span data-ttu-id="a1435-289">Při odesílání zhuštěných fragmenty, hello encoder můžete nastavit explicitní hlavičku content-length, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="a1435-289">When sending sparse fragments, hello encoder can set an explicit content-length header, if it’s available.</span></span>

    <span data-ttu-id="a1435-290">e.</span><span class="sxs-lookup"><span data-stu-id="a1435-290">e.</span></span> <span data-ttu-id="a1435-291">Při odesílání zhuštěných fragmenty se nové připojení, by MĚL hello kodér zahájit odesílání z polí hlavičky hello následuje nové fragmenty hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-291">When sending sparse fragments with a new connection, hello encoder SHOULD start sending from hello header boxes, followed by hello new fragments.</span></span> <span data-ttu-id="a1435-292">Se pro případy, ve které převzetí služeb při selhání se stane nevede a hello nové zhuštěných připojení, která má být navázáno tooa nový server, který nebylo nikdy hello zhuštěných sledovat před.</span><span class="sxs-lookup"><span data-stu-id="a1435-292">This is for cases in which failover happens in-between, and hello new sparse connection is being established tooa new server that has not seen hello sparse track before.</span></span>

    <span data-ttu-id="a1435-293">f.</span><span class="sxs-lookup"><span data-stu-id="a1435-293">f.</span></span> <span data-ttu-id="a1435-294">fragment Hello zhuštěných sledování se změní klienta k dispozici toohello při hello odpovídající nadřazené sledovat fragment, který má hodnotu větší nebo rovno časové razítko je k dispozici toohello klienta.</span><span class="sxs-lookup"><span data-stu-id="a1435-294">hello sparse track fragment becomes available toohello client when hello corresponding parent track fragment that has an equal or larger timestamp value is made available toohello client.</span></span> <span data-ttu-id="a1435-295">Například pokud zhuštěných fragment hello obsahuje časové razítko t = 1000, očekává se, které po hello klienta vidí "video" (za předpokladu, že název sledování nadřazené hello je "video") fragmentovat časové razítko 1000 nebo i mimo můžete stáhnout hello zhuštěných fragment t = 1 000.</span><span class="sxs-lookup"><span data-stu-id="a1435-295">For example, if hello sparse fragment has a timestamp of t=1000, it is expected that after hello client sees "video" (assuming hello parent track name is "video") fragment timestamp 1000 or beyond, it can download hello sparse fragment t=1000.</span></span> <span data-ttu-id="a1435-296">Všimněte si, že hello signál skutečné by mohly být použity na jiné místo v ose prezentace hello k určené účelu.</span><span class="sxs-lookup"><span data-stu-id="a1435-296">Note that hello actual signal could be used for a different position in hello presentation timeline for its designated purpose.</span></span> <span data-ttu-id="a1435-297">V tomto příkladu to je možné, že hello zhuštěných fragment t = 1 000 má datovou část XML, který je pro vkládání ad do pozice, který je několik sekund později.</span><span class="sxs-lookup"><span data-stu-id="a1435-297">In this example, it’s possible that hello sparse fragment of t=1000 has an XML payload, which is for inserting an ad in a position that’s a few seconds later.</span></span>

    <span data-ttu-id="a1435-298">g.</span><span class="sxs-lookup"><span data-stu-id="a1435-298">g.</span></span> <span data-ttu-id="a1435-299">Hello datovou část zhuštěných sledovat fragmenty může být v různých formátech (například XML, text nebo binární), v závislosti na scénáři hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-299">hello payload of sparse track fragments can be in different formats (such as XML, text, or binary), depending on hello scenario.</span></span>

### <a name="redundant-audio-track"></a><span data-ttu-id="a1435-300">Redundantní zvuk sledování</span><span class="sxs-lookup"><span data-stu-id="a1435-300">Redundant audio track</span></span>
<span data-ttu-id="a1435-301">Typický HTTP adaptivní streamování scénář (například technologie Smooth Streaming nebo pomlčkou) často má jenom jeden zvukové stopy v celé prezentace hello.</span><span class="sxs-lookup"><span data-stu-id="a1435-301">In a typical HTTP adaptive streaming scenario (for example, Smooth Streaming or DASH), often, there's only one audio track in hello entire presentation.</span></span> <span data-ttu-id="a1435-302">Na rozdíl od sleduje video, které mají více úrovní kvality pro klienta toochoose hello z v chybové stavy, může sledovat zvuk hello být jediný bod selhání, pokud hello přijímání hello datový proud, který obsahuje zvukové stopy hello je poškozená.</span><span class="sxs-lookup"><span data-stu-id="a1435-302">Unlike video tracks, which have multiple quality levels for hello client toochoose from in error conditions, hello audio track can be a single point of failure if hello ingestion of hello stream that contains hello audio track is broken.</span></span> 

<span data-ttu-id="a1435-303">Tyto potíže odstranit, služba Media Services podporuje toosolve live přijímání redundantní zvukových stop.</span><span class="sxs-lookup"><span data-stu-id="a1435-303">toosolve this problem, Media Services supports live ingestion of redundant audio tracks.</span></span> <span data-ttu-id="a1435-304">Hello cílem je, že hello stejné zvuk sledovat lze odeslat vícekrát v různých datových proudů.</span><span class="sxs-lookup"><span data-stu-id="a1435-304">hello idea is that hello same audio track can be sent multiple times in different streams.</span></span> <span data-ttu-id="a1435-305">I když hello služba pouze zaregistruje zvuk sledovat hello jednou v manifestu hello klienta, může použít redundantní zvukových stop jako záložní pro načítání zvuku fragmenty, pokud primární zvuk sledovat hello má problémy.</span><span class="sxs-lookup"><span data-stu-id="a1435-305">Although hello service only registers hello audio track once in hello client manifest, it can use redundant audio tracks as backups for retrieving audio fragments if hello primary audio track has issues.</span></span> <span data-ttu-id="a1435-306">redundantní zvukových stop tooingest hello kodér musí:</span><span class="sxs-lookup"><span data-stu-id="a1435-306">tooingest redundant audio tracks, hello encoder needs to:</span></span>

1. <span data-ttu-id="a1435-307">Vytvořte hello stejné zvuk sledovat více fragment MP4 bitstreams.</span><span class="sxs-lookup"><span data-stu-id="a1435-307">Create hello same audio track in multiple fragment MP4 bitstreams.</span></span> <span data-ttu-id="a1435-308">redundantní zvukových stop Hello musí být sémanticky ekvivalentní, s hello stejné fragmentovat časová razítka a být zaměnitelné na úrovních fragment a hello záhlaví.</span><span class="sxs-lookup"><span data-stu-id="a1435-308">hello redundant audio tracks MUST be semantically equivalent, with hello same fragment timestamps, and be interchangeable at hello header and fragment levels.</span></span>
2. <span data-ttu-id="a1435-309">Zkontrolujte tuto položku "zvuk" hello v hello Live serveru Manifest (část 6 v [1]) je hello stejné pro všechny redundantní zvukových stop.</span><span class="sxs-lookup"><span data-stu-id="a1435-309">Ensure that hello “audio” entry in hello Live Server Manifest (Section 6 in [1]) is hello same for all redundant audio tracks.</span></span>

<span data-ttu-id="a1435-310">Hello následující implementace se doporučuje pro redundantní zvukových stop:</span><span class="sxs-lookup"><span data-stu-id="a1435-310">hello following implementation is recommended for redundant audio tracks:</span></span>

1. <span data-ttu-id="a1435-311">Odeslat každý jedinečný zvukové stopy v datovém proudu samostatně.</span><span class="sxs-lookup"><span data-stu-id="a1435-311">Send each unique audio track in a stream by itself.</span></span> <span data-ttu-id="a1435-312">Navíc odesílat redundantní datový proud pro každou z těchto datových proudů zvuk sledovat, pokud druhý datový proud hello liší od hello nejprve pouze o identifikátor hello v hello adresy URL protokolu HTTP POST: {protokolu} :// {serveru address} / {publikování path}/Streams({identifier}) bodu.</span><span class="sxs-lookup"><span data-stu-id="a1435-312">Also, send a redundant stream for each of these audio track streams, where hello second stream differs from hello first only by hello identifier in hello HTTP POST URL: {protocol}://{server address}/{publishing point path}/Streams({identifier}).</span></span>
2. <span data-ttu-id="a1435-313">Použijte samostatné datové proudy toosend hello dvě nejnižší video přenosových rychlostí.</span><span class="sxs-lookup"><span data-stu-id="a1435-313">Use separate streams toosend hello two lowest video bitrates.</span></span> <span data-ttu-id="a1435-314">Každý z těchto datových proudů by obsahovat také kopii každý jedinečný zvuk sledovat. Například když podporuje více jazyky, těchto datových proudů by MĚLO obsahovat zvuk sleduje pro jednotlivé jazyky.</span><span class="sxs-lookup"><span data-stu-id="a1435-314">Each of these streams SHOULD also contain a copy of each unique audio track. For example, when multiple languages are supported, these streams SHOULD contain audio tracks for each language.</span></span>
3. <span data-ttu-id="a1435-315">Používat samostatný server (kodér) instancí tooencode a odesílat hello redundantní datové proudy uvedený v (1) a (2).</span><span class="sxs-lookup"><span data-stu-id="a1435-315">Use separate server (encoder) instances tooencode and send hello redundant streams mentioned in (1) and (2).</span></span> 

## <a name="media-services-learning-paths"></a><span data-ttu-id="a1435-316">Mapy kurzů ke službě Media Services</span><span class="sxs-lookup"><span data-stu-id="a1435-316">Media Services learning paths</span></span>
[!INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

## <a name="provide-feedback"></a><span data-ttu-id="a1435-317">Poskytnutí zpětné vazby</span><span class="sxs-lookup"><span data-stu-id="a1435-317">Provide feedback</span></span>
[!INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

[image1]: ./media/media-services-fmp4-live-ingest-overview/media-services-image1.png
[image2]: ./media/media-services-fmp4-live-ingest-overview/media-services-image2.png
[image3]: ./media/media-services-fmp4-live-ingest-overview/media-services-image3.png
[image4]: ./media/media-services-fmp4-live-ingest-overview/media-services-image4.png
[image5]: ./media/media-services-fmp4-live-ingest-overview/media-services-image5.png
[image6]: ./media/media-services-fmp4-live-ingest-overview/media-services-image6.png
[image7]: ./media/media-services-fmp4-live-ingest-overview/media-services-image7.png

---
title: "Klientská knihovna pro elastické databáze aaaUsing s Dapper | Microsoft Docs"
description: "Klientská knihovna pro elastické databáze pomocí Dapper."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: c22ece2a977265e93850f0ad3f3ca48f0a8733ac
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="c999e-103">Klientská knihovna pro elastické databáze pomocí Dapper</span><span class="sxs-lookup"><span data-stu-id="c999e-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="c999e-104">Tento dokument je pro vývojáře, které spoléhají na Dapper toobuild aplikace, ale také chcete tooembrace [nástroje elastické databáze](sql-database-elastic-scale-introduction.md) toocreate aplikace, které implementují horizontálního dělení tooscale-out jejich datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="c999e-104">This document is for developers that rely on Dapper toobuild applications, but also want tooembrace [elastic database tooling](sql-database-elastic-scale-introduction.md) toocreate applications that implement sharding tooscale-out their data tier.</span></span>  <span data-ttu-id="c999e-105">Tento dokument ukazuje hello změny v Dapper aplikacím, které jsou nezbytné toointegrate nástroje elastické databáze.</span><span class="sxs-lookup"><span data-stu-id="c999e-105">This document illustrates hello changes in Dapper-based applications that are necessary toointegrate with elastic database tools.</span></span> <span data-ttu-id="c999e-106">Soustředili je na skládání hello elastické databáze horizontálního oddílu správy a závisí na datech směrování s Dapper.</span><span class="sxs-lookup"><span data-stu-id="c999e-106">Our focus is on composing hello elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="c999e-107">**Ukázkový kód**: [nástroje elastické databáze pro databázi SQL Azure - Dapper integrace](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="c999e-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="c999e-108">Integrace **Dapper** a **DapperExtensions** s hello je snadné klientské knihovny pro elastické databáze pro databázi SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c999e-108">Integrating **Dapper** and **DapperExtensions** with hello elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="c999e-109">Aplikace může použít závislé směrování změnou hello vytváření a otevírání nových dat [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volat z hello [klienta Knihovna](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="c999e-109">Your applications can use data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from hello [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="c999e-110">Toto nastavení omezuje změny ve vaší aplikace tooonly, kde jsou vytvořen a otevřít nové připojení.</span><span class="sxs-lookup"><span data-stu-id="c999e-110">This limits changes in your application tooonly where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="c999e-111">Dapper – přehled</span><span class="sxs-lookup"><span data-stu-id="c999e-111">Dapper overview</span></span>
<span data-ttu-id="c999e-112">**Dapper** je objekt relační mapper.</span><span class="sxs-lookup"><span data-stu-id="c999e-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="c999e-113">Mapuje objekty .NET z vaší aplikace tooa relační databáze (a naopak).</span><span class="sxs-lookup"><span data-stu-id="c999e-113">It maps .NET objects from your application tooa relational database (and vice versa).</span></span> <span data-ttu-id="c999e-114">první část Hello hello ukázkový kód ukazuje, jak integrovat hello klientské knihovny pro elastické databáze pomocí aplikace založené na Dapper.</span><span class="sxs-lookup"><span data-stu-id="c999e-114">hello first part of hello sample code illustrates how you can integrate hello elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="c999e-115">Druhá část Hello hello ukázkový kód ukazuje, jak toointegrate při používání Dapper a DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="c999e-115">hello second part of hello sample code illustrates how toointegrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="c999e-116">Funkce mapper Hello v Dapper poskytuje rozšiřující metody u připojení databáze, které zjednodušují odesílá příkazů T-SQL pro provádění nebo dotazování databáze hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-116">hello mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying hello database.</span></span> <span data-ttu-id="c999e-117">Například Dapper umožňuje snadno toomap mezi objekty .NET a hello parametrů příkazů SQL pro **Execute** volání nebo tooconsume hello výsledky vašich dotazů SQL na objekty .NET pomocí **dotazu**volání z Dapper.</span><span class="sxs-lookup"><span data-stu-id="c999e-117">For instance, Dapper makes it easy toomap between your .NET objects and hello parameters of SQL statements for **Execute** calls, or tooconsume hello results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="c999e-118">Při použití DapperExtensions, musíte už tooprovide hello SQL příkazy.</span><span class="sxs-lookup"><span data-stu-id="c999e-118">When using DapperExtensions, you no longer need tooprovide hello SQL statements.</span></span> <span data-ttu-id="c999e-119">Metody rozšíření, jako **GetList** nebo **vložit** přes připojení k databázi hello vytváření hello příkazů SQL pozadí hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-119">Extensions methods such as **GetList** or **Insert** over hello database connection create hello SQL statements behind hello scenes.</span></span>

<span data-ttu-id="c999e-120">Další výhodou Dapper a také DapperExtensions je, že ovládací prvky aplikace hello hello vytvoření připojení k databázi hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-120">Another benefit of Dapper and also DapperExtensions is that hello application controls hello creation of hello database connection.</span></span> <span data-ttu-id="c999e-121">To pomáhá interakci s hello elastické databáze klientskou knihovnu, která připojení na základě mapování hello z shardlets toodatabases databáze zprostředkovatelé.</span><span class="sxs-lookup"><span data-stu-id="c999e-121">This helps interact with hello elastic database client library which brokers database connections based on hello mapping of shardlets toodatabases.</span></span>

<span data-ttu-id="c999e-122">tooget hello Dapper sestavení, najdete v části [Dapper tečka síť](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="c999e-122">tooget hello Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="c999e-123">Hello Dapper rozšíření, najdete v části [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="c999e-123">For hello Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-hello-elastic-database-client-library"></a><span data-ttu-id="c999e-124">Rychlý přehled klientské knihovny pro elastické databáze hello</span><span class="sxs-lookup"><span data-stu-id="c999e-124">A quick Look at hello elastic database client library</span></span>
<span data-ttu-id="c999e-125">S hello elastické databáze klientské knihovny, definujete oddíly data aplikací názvem *shardlets* , jejich namapování toodatabases a identifikovat pomocí *horizontálního dělení klíče*.</span><span class="sxs-lookup"><span data-stu-id="c999e-125">With hello elastic database client library, you define partitions of your application data called *shardlets* , map them toodatabases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="c999e-126">Může mít libovolný počet databází, potřebujete a distribuovat vaše shardlets do těchto databází.</span><span class="sxs-lookup"><span data-stu-id="c999e-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="c999e-127">mapování Hello horizontálního dělení hodnoty klíče toohello databází ukládá horizontálního oddílu mapu poskytované hello knihovně rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="c999e-127">hello mapping of sharding key values toohello databases is stored by a shard map provided by hello library’s APIs.</span></span> <span data-ttu-id="c999e-128">Tato funkce je volána **horizontálního oddílu mapy správu**.</span><span class="sxs-lookup"><span data-stu-id="c999e-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="c999e-129">mapování horizontálních Hello slouží také jako hello zprostředkovatele připojení k databázi pro požadavky, které zajišťují klíč horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="c999e-129">hello shard map also serves as hello broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="c999e-130">Tato funkce je odkazované tooas **závislé směrování dat**.</span><span class="sxs-lookup"><span data-stu-id="c999e-130">This capability is referred tooas **data dependent routing**.</span></span>

![Mapování horizontálních a závislé směrování dat][1]

<span data-ttu-id="c999e-132">správce mapy horizontálního oddílu Hello chrání uživatelé z nekonzistentní zobrazení do shardlet data, která může dojít, když operace správy souběžných shardlet se děje v databázích hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-132">hello shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on hello databases.</span></span> <span data-ttu-id="c999e-133">toodo tedy hello horizontálního oddílu mapy zprostředkovatele hello databáze připojení pro aplikace vytvořené s nástroji hello knihovně.</span><span class="sxs-lookup"><span data-stu-id="c999e-133">toodo so, hello shard maps broker hello database connections for an application built with hello library.</span></span> <span data-ttu-id="c999e-134">Při operacích správy horizontálního oddílu by mohlo mít vliv hello shardlet, tato funkce umožňuje hello horizontálního oddílu mapy funkce tooautomatically kill připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="c999e-134">When shard management operations could impact hello shardlet, this allows hello shard map functionality tooautomatically kill a database connection.</span></span> 

<span data-ttu-id="c999e-135">Místo použití hello tradičním způsobem, jakým toocreate připojení pro Dapper, potřebujeme toouse hello [OpenConnectionForKey metoda](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="c999e-135">Instead of using hello traditional way toocreate connections for Dapper, we need toouse hello [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="c999e-136">To zajišťuje, že všemi ověřovacími hello probíhá a připojení spravuje správně, pokud se přesune všechna data mezi horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="c999e-136">This ensures that all hello validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="c999e-137">Požadavky pro Dapper integrace</span><span class="sxs-lookup"><span data-stu-id="c999e-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="c999e-138">Při práci s klientské knihovny pro elastické databáze hello i hello Dapper rozhraní API, chceme tooretain hello následující vlastnosti:</span><span class="sxs-lookup"><span data-stu-id="c999e-138">When working with both hello elastic database client library and hello Dapper APIs, we want tooretain hello following properties:</span></span>

* <span data-ttu-id="c999e-139">**Škálování**: jsme mají tooadd nebo odebrat databáze z hello datové vrstvy hello horizontálně dělené aplikace podle potřeby pro požadavky na kapacitu hello aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-139">**Scaleout**: We want tooadd or remove databases from hello data tier of hello sharded application as necessary for hello capacity demands of hello application.</span></span> 
* <span data-ttu-id="c999e-140">**Konzistence**: vzhledem k tomu, že naše aplikace je škálovat na více systémů pomocí horizontálního dělení, potřebujeme tooperform data závislé směrování.</span><span class="sxs-lookup"><span data-stu-id="c999e-140">**Consistency**: Since our application is scaled out using sharding, we need tooperform data dependent routing.</span></span> <span data-ttu-id="c999e-141">Chceme, aby tak toouse hello Data závislé směrování možnosti toodo hello knihovně.</span><span class="sxs-lookup"><span data-stu-id="c999e-141">We want toouse hello Data dependent routing capabilities of hello library toodo so.</span></span> <span data-ttu-id="c999e-142">Zejména chceme tooretain hello ověření a konzistence zaručuje poskytované připojení, která jsou zprostředkované prostřednictvím správce mapy hello horizontálního oddílu v pořadí tooavoid poškození nebo výsledky nesprávný dotazu.</span><span class="sxs-lookup"><span data-stu-id="c999e-142">In particular, we want tooretain hello validation and consistency guarantees provided by connections that are brokered through hello shard map manager in order tooavoid corruption or wrong query results.</span></span> <span data-ttu-id="c999e-143">To zajistí, že připojení tooa zadané shardlet jsou odmítl nebo zastavena (například) hello shardlet je aktuálně přesunutý tooa různých horizontálního oddílu pomocí rozhraní API rozdělení nebo Merge, pokud.</span><span class="sxs-lookup"><span data-stu-id="c999e-143">This ensures that connections tooa given shardlet are rejected or stopped if (for instance) hello shardlet is currently moved tooa different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="c999e-144">**Mapování objektu**: chceme tooretain hello pohodlí hello mapování poskytované Dapper tootranslate mezi třídy v aplikaci hello a hello základní struktury databáze.</span><span class="sxs-lookup"><span data-stu-id="c999e-144">**Object Mapping**: We want tooretain hello convenience of hello mappings provided by Dapper tootranslate between classes in hello application and hello underlying database structures.</span></span> 

<span data-ttu-id="c999e-145">Hello následující část obsahuje pokyny pro tyto požadavky pro aplikace na základě **Dapper** a **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="c999e-145">hello following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="c999e-146">Technické pokyny</span><span class="sxs-lookup"><span data-stu-id="c999e-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="c999e-147">Závislé směrování s Dapper dat</span><span class="sxs-lookup"><span data-stu-id="c999e-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="c999e-148">S Dapper je obvykle zodpovědná za vytváření a otevírání hello připojení toohello základní databáze aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-148">With Dapper, hello application is typically responsible for creating and opening hello connections toohello underlying database.</span></span> <span data-ttu-id="c999e-149">Zadaný typ T hello aplikací, Dapper vrátí výsledky dotazu jako kolekcí .NET typu T. Dapper provede mapování hello z hello T-SQL výsledek řádky toohello objekty typu T. Podobně Dapper mapuje objekty .NET do hodnot SQL nebo parametry pro příkazy data manipulaci language (DML).</span><span class="sxs-lookup"><span data-stu-id="c999e-149">Given a type T by hello application, Dapper returns query results as .NET collections of type T. Dapper performs hello mapping from hello T-SQL result rows toohello objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="c999e-150">Dapper nabízí tuto funkci prostřednictvím metody rozšíření na hello regulární [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt z knihoven ADO .NET SQL Client hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-150">Dapper offers this functionality via extension methods on hello regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from hello ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="c999e-151">Hello připojení SQL vrácený hello elastické škálování rozhraní API pro DDR jsou také regulární [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty.</span><span class="sxs-lookup"><span data-stu-id="c999e-151">hello SQL connection returned by hello Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="c999e-152">To umožňuje nám Dapper rozšíření použití toodirectly přes hello typ vrácený rozhraním API DDR hello klientské knihovny, protože je zároveň jednoduchého připojení klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="c999e-152">This allows us toodirectly use Dapper extensions over hello type returned by hello client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="c999e-153">Tyto připomínky díky přehledné toouse připojení pro Dapper zprostředkované pomocí klientské knihovny pro elastické databáze hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-153">These observations make it straightforward toouse connections brokered by hello elastic database client library for Dapper.</span></span>

<span data-ttu-id="c999e-154">Tento příklad kódu (z hello doplňujícími ukázkové) znázorňuje hello přístup, kde je klíč horizontálního dělení hello poskytované hello aplikace toohello knihovny toobroker hello připojení toohello správné horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="c999e-154">This code example (from hello accompanying sample) illustrates hello approach where hello sharding key is provided by hello application toohello library toobroker hello connection toohello right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="c999e-155">Hello volání toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) rozhraní API nahrazuje hello výchozí vytváření a otevírání připojení klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="c999e-155">hello call toohello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces hello default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="c999e-156">Hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volání má hello argumenty, které jsou požadovány pro závislé směrování dat:</span><span class="sxs-lookup"><span data-stu-id="c999e-156">hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes hello arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="c999e-157">Hello horizontálního oddílu mapy tooaccess hello závislé směrování rozhraní dat</span><span class="sxs-lookup"><span data-stu-id="c999e-157">hello shard map tooaccess hello data dependent routing interfaces</span></span>
* <span data-ttu-id="c999e-158">Hello horizontálního dělení klíče tooidentify hello shardlet</span><span class="sxs-lookup"><span data-stu-id="c999e-158">hello sharding key tooidentify hello shardlet</span></span>
* <span data-ttu-id="c999e-159">Hello horizontálního oddílu toohello tooconnect přihlašovací údaje (uživatelské jméno a heslo)</span><span class="sxs-lookup"><span data-stu-id="c999e-159">hello credentials (user name and password) tooconnect toohello shard</span></span>

<span data-ttu-id="c999e-160">objekt map horizontálního oddílu Hello vytvoří horizontálních toohello připojení, která obsahuje hello shardlet pro zadaný klíč horizontálního dělení hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-160">hello shard map object creates a connection toohello shard that holds hello shardlet for hello given sharding key.</span></span> <span data-ttu-id="c999e-161">rozhraní API klienta elastické databáze Hello také označovat tooimplement hello připojení, které zaručuje jeho konzistence.</span><span class="sxs-lookup"><span data-stu-id="c999e-161">hello elastic database client APIs also tag hello connection tooimplement its consistency guarantees.</span></span> <span data-ttu-id="c999e-162">Od hello volání příliš[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) vrátí regulární objekt připojení klienta SQL, hello následných volání toohello **Execute** metoda rozšíření z Dapper způsobem hello standardní Dapper postup.</span><span class="sxs-lookup"><span data-stu-id="c999e-162">Since hello call too[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, hello subsequent call toohello **Execute** extension method from Dapper follows hello standard Dapper practice.</span></span>

<span data-ttu-id="c999e-163">Dotazy na pracovní velmi mnohem hello stejný způsobem - poprvé otevřete pomocí připojení hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) z klienta hello rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="c999e-163">Queries work very much hello same way - you first open hello connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from hello client API.</span></span> <span data-ttu-id="c999e-164">Potom do objektů .NET pomocí hello regulární Dapper rozšíření metody toomap hello výsledky dotazu SQL:</span><span class="sxs-lookup"><span data-stu-id="c999e-164">Then you use hello regular Dapper extension methods toomap hello results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="c999e-165">Všimněte si, že hello **pomocí** blokovat pomocí oborů připojení DDR hello všechny databázové operace v rámci hello bloku toohello jeden horizontálních kde je udržována tenantId1.</span><span class="sxs-lookup"><span data-stu-id="c999e-165">Note that hello **using** block with hello DDR connection scopes all database operations within hello block toohello one shard where tenantId1 is kept.</span></span> <span data-ttu-id="c999e-166">Hello dotaz vrátí jenom blogy uložené na aktuální horizontálního oddílu hello, ale není hello ty, které jsou uložené na jiné horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="c999e-166">hello query only returns blogs stored on hello current shard, but not hello ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="c999e-167">Data závislé směrování s Dapper a DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="c999e-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="c999e-168">Dapper se dodává s prostředí další rozšíření, které můžete zadat další pohodlí a abstrakce z databáze hello při vývoji aplikace databáze.</span><span class="sxs-lookup"><span data-stu-id="c999e-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from hello database when developing database applications.</span></span> <span data-ttu-id="c999e-169">DapperExtensions je příklad.</span><span class="sxs-lookup"><span data-stu-id="c999e-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="c999e-170">Použití DapperExtensions v aplikaci se nezměnil způsob vytváření a spravovaná databázová připojení.</span><span class="sxs-lookup"><span data-stu-id="c999e-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="c999e-171">Je stále aplikace hello odpovědnost tooopen připojení a regulární objekty připojení klienta SQL se očekává metodami rozšíření hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-171">It is still hello application’s responsibility tooopen connections, and regular SQL Client connection objects are expected by hello extension methods.</span></span> <span data-ttu-id="c999e-172">Spoléháme na hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) jak je uvedeno výš.</span><span class="sxs-lookup"><span data-stu-id="c999e-172">We can rely on hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="c999e-173">Jako hello zobrazit následující ukázky kódu hello jedinou změnou je, že jsme již nemáte toowrite hello T-SQL příkazy:</span><span class="sxs-lookup"><span data-stu-id="c999e-173">As hello following code samples show, hello only change is that we do no longer have toowrite hello T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="c999e-174">A zde je ukázka kódu hello hello dotazu:</span><span class="sxs-lookup"><span data-stu-id="c999e-174">And here is hello code sample for hello query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="c999e-175">Zpracování přechodných chyb</span><span class="sxs-lookup"><span data-stu-id="c999e-175">Handling transient faults</span></span>
<span data-ttu-id="c999e-176">Hello postupy společnosti Microsoft Patterns team publikované hello [přechodné chyby zpracování bloku aplikace](http://msdn.microsoft.com/library/hh680934.aspx) vývojáři aplikace toohelp zmírnit běžné podmínky přechodná chyba došlo při spuštění v cloudu hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-176">hello Microsoft Patterns & Practices team published hello [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) toohelp application developers mitigate common transient fault conditions encountered when running in hello cloud.</span></span> <span data-ttu-id="c999e-177">Další informace najdete v tématu [Perseverance, tajný klíč všechny vítězství: hello bloku přechodné chyby zpracování aplikace pomocí](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="c999e-177">For more information, see [Perseverance, Secret of All Triumphs: Using hello Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="c999e-178">Ukázka kódu Hello spoléhá na hello přechodná chyba knihovny tooprotect proti přechodných.</span><span class="sxs-lookup"><span data-stu-id="c999e-178">hello code sample relies on hello transient fault library tooprotect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="c999e-179">**SqlDatabaseUtils.SqlRetryPolicy** v hello výše uvedený kód je definovaný jako **SqlDatabaseTransientErrorDetectionStrategy** s počtem opakování 10 a 5 sekund čekací dobu mezi opakovanými pokusy.</span><span class="sxs-lookup"><span data-stu-id="c999e-179">**SqlDatabaseUtils.SqlRetryPolicy** in hello code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="c999e-180">Pokud používáte transakce, ujistěte se, že váš rozsah opakování přejde zpět toohello zahájení transakce hello v případě hello přechodná chyba.</span><span class="sxs-lookup"><span data-stu-id="c999e-180">If you are using transactions, make sure that your retry scope goes back toohello beginning of hello transaction in hello case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="c999e-181">Omezení</span><span class="sxs-lookup"><span data-stu-id="c999e-181">Limitations</span></span>
<span data-ttu-id="c999e-182">přístupy Hello uvedených v tomto dokumentu za následek několik omezení:</span><span class="sxs-lookup"><span data-stu-id="c999e-182">hello approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="c999e-183">Hello ukázkový kód pro tento dokument není ukazují, jak toomanage schématu napříč horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="c999e-183">hello sample code for this document does not demonstrate how toomanage schema across shards.</span></span>
* <span data-ttu-id="c999e-184">Zadaný požadavek, předpokládáme, že jeho zpracování databáze je obsažena v jedné horizontálního oddílu určeno klíčem horizontálního dělení hello poskytované hello požadavku.</span><span class="sxs-lookup"><span data-stu-id="c999e-184">Given a request, we assume that all its database processing is contained within a single shard as identified by hello sharding key provided by hello request.</span></span> <span data-ttu-id="c999e-185">Však tento předpoklad vždy nemá, například když není možné toomake horizontálního dělení klíč, který je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="c999e-185">However, this assumption does not always hold, for example, when it is not possible toomake a sharding key available.</span></span> <span data-ttu-id="c999e-186">tooaddress se hello klientské knihovny pro elastické databáze zahrnuje hello [MultiShardQuery třída](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="c999e-186">tooaddress this, hello elastic database client library includes hello [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="c999e-187">Hello třída implementuje abstraktní připojení pro dotazování přes několik horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="c999e-187">hello class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="c999e-188">Pomocí MultiShardQuery v kombinaci s Dapper je nad rámec tohoto dokumentu hello.</span><span class="sxs-lookup"><span data-stu-id="c999e-188">Using MultiShardQuery in combination with Dapper is beyond hello scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="c999e-189">Závěr</span><span class="sxs-lookup"><span data-stu-id="c999e-189">Conclusion</span></span>
<span data-ttu-id="c999e-190">Aplikace s použitím Dapper a DapperExtensions můžete snadno využívat nástroje elastické databáze pro databázi SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="c999e-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="c999e-191">Prostřednictvím hello kroků uvedených v tomto dokumentu, můžete tyto aplikace použít nástroj hello schopností závislé směrování změnou hello vytváření a otevírání nových dat [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty toouse hello [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volání hello klientské knihovny pro elastické databáze.</span><span class="sxs-lookup"><span data-stu-id="c999e-191">Through hello steps outlined in this document, those applications can use hello tool's capability for data dependent routing by changing hello creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects toouse hello [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of hello elastic database client library.</span></span> <span data-ttu-id="c999e-192">Toto nastavení omezuje hello aplikace změny požadované toothose místech, kde nová připojení jsou vytvořeny a otevřít.</span><span class="sxs-lookup"><span data-stu-id="c999e-192">This limits hello application changes required toothose places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png

---
title: "Klientská knihovna pro elastické databáze pomocí Dapper | Microsoft Docs"
description: "Klientská knihovna pro elastické databáze pomocí Dapper."
services: sql-database
documentationcenter: 
manager: jhubbard
author: torsteng
ms.assetid: 463d2676-3b19-47c2-83df-f8c50492c9d2
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/27/2016
ms.author: torsteng
ms.openlocfilehash: f0efd37a39c1a60eee7b47304483c27727ca8833
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="using-elastic-database-client-library-with-dapper"></a><span data-ttu-id="e54a6-103">Klientská knihovna pro elastické databáze pomocí Dapper</span><span class="sxs-lookup"><span data-stu-id="e54a6-103">Using elastic database client library with Dapper</span></span>
<span data-ttu-id="e54a6-104">Tento dokument je pro vývojáře, které spoléhají na Dapper vytvářet aplikace, ale také chcete zapojení [nástroje elastické databáze](sql-database-elastic-scale-introduction.md) k vytvoření aplikací, že implementace horizontálního dělení pro škálované jejich datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="e54a6-104">This document is for developers that rely on Dapper to build applications, but also want to embrace [elastic database tooling](sql-database-elastic-scale-introduction.md) to create applications that implement sharding to scale-out their data tier.</span></span>  <span data-ttu-id="e54a6-105">Tento dokument ukazuje změny v Dapper aplikacím, které jsou potřebné k integraci s nástroje elastické databáze.</span><span class="sxs-lookup"><span data-stu-id="e54a6-105">This document illustrates the changes in Dapper-based applications that are necessary to integrate with elastic database tools.</span></span> <span data-ttu-id="e54a6-106">Soustředili je na skládání správu horizontálního oddílu elastické databáze a závisí na datech směrování s Dapper.</span><span class="sxs-lookup"><span data-stu-id="e54a6-106">Our focus is on composing the elastic database shard management and data dependent routing with Dapper.</span></span> 

<span data-ttu-id="e54a6-107">**Ukázkový kód**: [nástroje elastické databáze pro databázi SQL Azure - Dapper integrace](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span><span class="sxs-lookup"><span data-stu-id="e54a6-107">**Sample Code**: [Elastic database tools for Azure SQL Database - Dapper integration](https://code.msdn.microsoft.com/Elastic-Scale-with-Azure-e19fc77f).</span></span>

<span data-ttu-id="e54a6-108">Integrace **Dapper** a **DapperExtensions** s elastickou databází je snadné klientské knihovny pro databázi SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="e54a6-108">Integrating **Dapper** and **DapperExtensions** with the elastic database client library for Azure SQL Database is easy.</span></span> <span data-ttu-id="e54a6-109">Aplikace může použít závislé směrování změnou vytváření a otevírání nových dat [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty, které chcete použít [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volat z [klientské knihovny](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span><span class="sxs-lookup"><span data-stu-id="e54a6-109">Your applications can use data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call from the [client library](http://msdn.microsoft.com/library/azure/dn765902.aspx).</span></span> <span data-ttu-id="e54a6-110">Toto nastavení omezuje změny v aplikaci jenom tam, kde jsou vytvořeny a otevřít nové připojení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-110">This limits changes in your application to only where new connections are created and opened.</span></span> 

## <a name="dapper-overview"></a><span data-ttu-id="e54a6-111">Dapper – přehled</span><span class="sxs-lookup"><span data-stu-id="e54a6-111">Dapper overview</span></span>
<span data-ttu-id="e54a6-112">**Dapper** je objekt relační mapper.</span><span class="sxs-lookup"><span data-stu-id="e54a6-112">**Dapper** is an object-relational mapper.</span></span> <span data-ttu-id="e54a6-113">Mapuje objekty .NET z vaší aplikace na relační databázi (a naopak).</span><span class="sxs-lookup"><span data-stu-id="e54a6-113">It maps .NET objects from your application to a relational database (and vice versa).</span></span> <span data-ttu-id="e54a6-114">První část ukázkový kód ukazuje, jak integrovat klientské knihovny pro elastické databáze pomocí aplikace založené na Dapper.</span><span class="sxs-lookup"><span data-stu-id="e54a6-114">The first part of the sample code illustrates how you can integrate the elastic database client library with Dapper-based applications.</span></span> <span data-ttu-id="e54a6-115">Druhá část ukázkový kód ukazuje, jak integrovat při používání Dapper a DapperExtensions.</span><span class="sxs-lookup"><span data-stu-id="e54a6-115">The second part of the sample code illustrates how to integrate when using both Dapper and DapperExtensions.</span></span>  

<span data-ttu-id="e54a6-116">Funkce mapper v Dapper poskytuje rozšiřující metody u připojení databáze, které zjednodušují odesílá příkazů T-SQL pro provádění nebo dotaz na databázi.</span><span class="sxs-lookup"><span data-stu-id="e54a6-116">The mapper functionality in Dapper provides extension methods on database connections that simplify submitting T-SQL statements for execution or querying the database.</span></span> <span data-ttu-id="e54a6-117">Například Dapper usnadňuje mapování mezi objekty rozhraní .NET a parametry příkazů SQL pro **Execute** volání, nebo využívat výsledky vašich dotazů SQL na objekty .NET pomocí **dotazu** volání z Dapper.</span><span class="sxs-lookup"><span data-stu-id="e54a6-117">For instance, Dapper makes it easy to map between your .NET objects and the parameters of SQL statements for **Execute** calls, or to consume the results of your SQL queries into .NET objects using **Query** calls from Dapper.</span></span> 

<span data-ttu-id="e54a6-118">Při použití DapperExtensions, už potřebujete poskytovat příkazy SQL.</span><span class="sxs-lookup"><span data-stu-id="e54a6-118">When using DapperExtensions, you no longer need to provide the SQL statements.</span></span> <span data-ttu-id="e54a6-119">Metody rozšíření, jako **GetList** nebo **vložit** přes připojení k databázi vytváření příkazů SQL na pozadí.</span><span class="sxs-lookup"><span data-stu-id="e54a6-119">Extensions methods such as **GetList** or **Insert** over the database connection create the SQL statements behind the scenes.</span></span>

<span data-ttu-id="e54a6-120">Další výhodou Dapper a také DapperExtensions je, že aplikace řídí vytváření připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="e54a6-120">Another benefit of Dapper and also DapperExtensions is that the application controls the creation of the database connection.</span></span> <span data-ttu-id="e54a6-121">To pomáhá interakci s klientskou knihovnu elastické databáze, která zprostředkovatelé databáze připojení na základě mapování shardlets k databázím.</span><span class="sxs-lookup"><span data-stu-id="e54a6-121">This helps interact with the elastic database client library which brokers database connections based on the mapping of shardlets to databases.</span></span>

<span data-ttu-id="e54a6-122">Chcete-li získat Dapper sestavení, přečtěte si téma [Dapper tečka síť](http://www.nuget.org/packages/Dapper/).</span><span class="sxs-lookup"><span data-stu-id="e54a6-122">To get the Dapper assemblies, see [Dapper dot net](http://www.nuget.org/packages/Dapper/).</span></span> <span data-ttu-id="e54a6-123">Dapper rozšíření, najdete v části [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span><span class="sxs-lookup"><span data-stu-id="e54a6-123">For the Dapper extensions, see [DapperExtensions](http://www.nuget.org/packages/DapperExtensions).</span></span>

## <a name="a-quick-look-at-the-elastic-database-client-library"></a><span data-ttu-id="e54a6-124">Rychlý přehled klientské knihovny pro elastické databáze</span><span class="sxs-lookup"><span data-stu-id="e54a6-124">A quick Look at the elastic database client library</span></span>
<span data-ttu-id="e54a6-125">Pomocí klientské knihovny pro elastické databáze, definovat oddíly data aplikací názvem *shardlets* , jejich namapování na databáze a identifikovat pomocí *horizontálního dělení klíče*.</span><span class="sxs-lookup"><span data-stu-id="e54a6-125">With the elastic database client library, you define partitions of your application data called *shardlets* , map them to databases, and identify them by *sharding keys*.</span></span> <span data-ttu-id="e54a6-126">Může mít libovolný počet databází, potřebujete a distribuovat vaše shardlets do těchto databází.</span><span class="sxs-lookup"><span data-stu-id="e54a6-126">You can have as many databases as you need and distribute your shardlets across these databases.</span></span> <span data-ttu-id="e54a6-127">Mapování hodnot klíče horizontálního dělení k databázím ukládá horizontálního oddílu mapu poskytuje rozhraní API knihovny.</span><span class="sxs-lookup"><span data-stu-id="e54a6-127">The mapping of sharding key values to the databases is stored by a shard map provided by the library’s APIs.</span></span> <span data-ttu-id="e54a6-128">Tato funkce je volána **horizontálního oddílu mapy správu**.</span><span class="sxs-lookup"><span data-stu-id="e54a6-128">This capability is called **shard map management**.</span></span> <span data-ttu-id="e54a6-129">Mapování horizontálních slouží taky jako zprostředkovatel připojení databáze pro požadavky, které zajišťují klíč horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-129">The shard map also serves as the broker of database connections for requests that carry a sharding key.</span></span> <span data-ttu-id="e54a6-130">Tato funkce se označuje jako **závislé směrování dat**.</span><span class="sxs-lookup"><span data-stu-id="e54a6-130">This capability is referred to as **data dependent routing**.</span></span>

![Mapování horizontálních a závislé směrování dat][1]

<span data-ttu-id="e54a6-132">Mapa správce horizontálního oddílu chrání uživatelé z nekonzistentní zobrazení do shardlet data, která může dojít, když operace správy souběžných shardlet se děje v databázích.</span><span class="sxs-lookup"><span data-stu-id="e54a6-132">The shard map manager protects users from inconsistent views into shardlet data that can occur when concurrent shardlet management operations are happening on the databases.</span></span> <span data-ttu-id="e54a6-133">Uděláte to tak mapy horizontálního oddílu Zprostředkovatel připojení databáze pro aplikace vytvořené s nástroji knihovny.</span><span class="sxs-lookup"><span data-stu-id="e54a6-133">To do so, the shard maps broker the database connections for an application built with the library.</span></span> <span data-ttu-id="e54a6-134">Při operacích správy horizontálního oddílu by mohlo mít vliv shardlet, tato funkce umožňuje funkci horizontálního oddílu mapy automaticky ukončit připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="e54a6-134">When shard management operations could impact the shardlet, this allows the shard map functionality to automatically kill a database connection.</span></span> 

<span data-ttu-id="e54a6-135">Místo použití tradiční způsob, jak vytvořit připojení pro Dapper, je potřeba použít [OpenConnectionForKey metoda](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span><span class="sxs-lookup"><span data-stu-id="e54a6-135">Instead of using the traditional way to create connections for Dapper, we need to use the [OpenConnectionForKey method](http://msdn.microsoft.com/library/azure/dn824099.aspx).</span></span> <span data-ttu-id="e54a6-136">To zajišťuje, že všechny ověřování probíhá a připojení spravuje správně, pokud se přesune všechna data mezi horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="e54a6-136">This ensures that all the validation takes place and connections are managed properly when any data moves between shards.</span></span>

### <a name="requirements-for-dapper-integration"></a><span data-ttu-id="e54a6-137">Požadavky pro Dapper integrace</span><span class="sxs-lookup"><span data-stu-id="e54a6-137">Requirements for Dapper integration</span></span>
<span data-ttu-id="e54a6-138">Při práci s klientské knihovny pro elastické databáze a Dapper rozhraní API, chceme zachovat následující vlastnosti:</span><span class="sxs-lookup"><span data-stu-id="e54a6-138">When working with both the elastic database client library and the Dapper APIs, we want to retain the following properties:</span></span>

* <span data-ttu-id="e54a6-139">**Škálování**: chceme přidat nebo odebrat databáze z datové vrstvy horizontálně dělené aplikace v případě potřeby u požadavky kapacity aplikace.</span><span class="sxs-lookup"><span data-stu-id="e54a6-139">**Scaleout**: We want to add or remove databases from the data tier of the sharded application as necessary for the capacity demands of the application.</span></span> 
* <span data-ttu-id="e54a6-140">**Konzistence**: vzhledem k tomu, že naše aplikace je škálovat na více systémů pomocí horizontálního dělení, je potřeba provést data závislé směrování.</span><span class="sxs-lookup"><span data-stu-id="e54a6-140">**Consistency**: Since our application is scaled out using sharding, we need to perform data dependent routing.</span></span> <span data-ttu-id="e54a6-141">Chceme k tomu použít závislé směrování funkce dat knihovny.</span><span class="sxs-lookup"><span data-stu-id="e54a6-141">We want to use the Data dependent routing capabilities of the library to do so.</span></span> <span data-ttu-id="e54a6-142">Zejména chceme zachovat ověření a konzistence zaručuje poskytované připojení, která jsou zprostředkované prostřednictvím správce mapy horizontálního oddílu aby se zabránilo poškození nebo výsledky nesprávný dotazu.</span><span class="sxs-lookup"><span data-stu-id="e54a6-142">In particular, we want to retain the validation and consistency guarantees provided by connections that are brokered through the shard map manager in order to avoid corruption or wrong query results.</span></span> <span data-ttu-id="e54a6-143">To zajišťuje, že se připojení k dané shardlet odmítl nebo zastavena, pokud (například) shardlet aktuálně přesunout do jiné horizontálních pomocí rozhraní API rozdělení či sloučení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-143">This ensures that connections to a given shardlet are rejected or stopped if (for instance) the shardlet is currently moved to a different shard using Split/Merge APIs.</span></span>
* <span data-ttu-id="e54a6-144">**Mapování objektu**: chceme zachovat pohodlím, které představuje mapování poskytované Dapper pro převod mezi třídy v aplikaci a základní struktury databáze.</span><span class="sxs-lookup"><span data-stu-id="e54a6-144">**Object Mapping**: We want to retain the convenience of the mappings provided by Dapper to translate between classes in the application and the underlying database structures.</span></span> 

<span data-ttu-id="e54a6-145">Následující část obsahuje pokyny pro tyto požadavky pro aplikace na základě **Dapper** a **DapperExtensions**.</span><span class="sxs-lookup"><span data-stu-id="e54a6-145">The following section provides guidance for these requirements for applications based on **Dapper** and **DapperExtensions**.</span></span>

## <a name="technical-guidance"></a><span data-ttu-id="e54a6-146">Technické pokyny</span><span class="sxs-lookup"><span data-stu-id="e54a6-146">Technical Guidance</span></span>
### <a name="data-dependent-routing-with-dapper"></a><span data-ttu-id="e54a6-147">Závislé směrování s Dapper dat</span><span class="sxs-lookup"><span data-stu-id="e54a6-147">Data dependent routing with Dapper</span></span>
<span data-ttu-id="e54a6-148">S Dapper je obvykle zodpovědný za vytváření a otevírání připojení k databázi základní aplikace.</span><span class="sxs-lookup"><span data-stu-id="e54a6-148">With Dapper, the application is typically responsible for creating and opening the connections to the underlying database.</span></span> <span data-ttu-id="e54a6-149">Zadaný typ T aplikací, Dapper vrátí výsledky dotazu jako kolekcí .NET typu T. Dapper provede mapování od řádků výsledek T-SQL pro objekty typu T. Podobně Dapper mapuje objekty .NET do hodnot SQL nebo parametry pro příkazy data manipulaci language (DML).</span><span class="sxs-lookup"><span data-stu-id="e54a6-149">Given a type T by the application, Dapper returns query results as .NET collections of type T. Dapper performs the mapping from the T-SQL result rows to the objects of type T. Similarly, Dapper maps .NET objects into SQL values or parameters for data manipulation language (DML) statements.</span></span> <span data-ttu-id="e54a6-150">Tato funkce prostřednictvím metody rozšíření na běžné nabízí Dapper [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekt z knihoven klienta SQL ADO .NET.</span><span class="sxs-lookup"><span data-stu-id="e54a6-150">Dapper offers this functionality via extension methods on the regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) object from the ADO .NET SQL Client libraries.</span></span> <span data-ttu-id="e54a6-151">Připojení SQL vrácený rozhraními API sady elastické škálování pro DDR jsou také regulární [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty.</span><span class="sxs-lookup"><span data-stu-id="e54a6-151">The SQL connection returned by the Elastic Scale APIs for DDR are also regular [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects.</span></span> <span data-ttu-id="e54a6-152">To umožňuje nám přímo použít Dapper rozšíření přes typ vrácený rozhraním API DDR klientské knihovny, protože je zároveň jednoduchého připojení klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="e54a6-152">This allows us to directly use Dapper extensions over the type returned by the client library’s DDR API, as it is also a simple SQL Client connection.</span></span>

<span data-ttu-id="e54a6-153">Tyto připomínky zjednodušují používat připojení pro Dapper zprostředkované pomocí klientské knihovny pro elastické databáze.</span><span class="sxs-lookup"><span data-stu-id="e54a6-153">These observations make it straightforward to use connections brokered by the elastic database client library for Dapper.</span></span>

<span data-ttu-id="e54a6-154">Tento příklad kódu (od doprovodné vzorku) znázorňuje přístup, kde je klíč horizontálního dělení poskytované aplikaci do knihovny Zprostředkovatel připojení k správné horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="e54a6-154">This code example (from the accompanying sample) illustrates the approach where the sharding key is provided by the application to the library to broker the connection to the right shard.</span></span>   

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                     key: tenantId1, 
                     connectionString: connStrBldr.ConnectionString, 
                     options: ConnectionOptions.Validate))
    {
        var blog = new Blog { Name = name };
        sqlconn.Execute(@"
                      INSERT INTO
                            Blog (Name)
                            VALUES (@name)", new { name = blog.Name }
                        );
    }

<span data-ttu-id="e54a6-155">Volání [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) rozhraní API nahradí výchozí vytváření a otevírání připojení klienta SQL.</span><span class="sxs-lookup"><span data-stu-id="e54a6-155">The call to the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) API replaces the default creation and opening of a SQL Client connection.</span></span> <span data-ttu-id="e54a6-156">[OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volání přijímá argumenty, které jsou požadovány pro závislé směrování dat:</span><span class="sxs-lookup"><span data-stu-id="e54a6-156">The [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call takes the arguments that are required for data dependent routing:</span></span> 

* <span data-ttu-id="e54a6-157">Mapování horizontálních pro přístup k rozhraní závislé směrování dat</span><span class="sxs-lookup"><span data-stu-id="e54a6-157">The shard map to access the data dependent routing interfaces</span></span>
* <span data-ttu-id="e54a6-158">Klíč horizontálního dělení k identifikaci shardlet</span><span class="sxs-lookup"><span data-stu-id="e54a6-158">The sharding key to identify the shardlet</span></span>
* <span data-ttu-id="e54a6-159">Přihlašovací údaje (uživatelské jméno a heslo) pro připojení k horizontálního oddílu</span><span class="sxs-lookup"><span data-stu-id="e54a6-159">The credentials (user name and password) to connect to the shard</span></span>

<span data-ttu-id="e54a6-160">Objekt map horizontálního oddílu vytvoří připojení k horizontálního oddílu, který obsahuje shardlet pro danou horizontálního dělení klíč.</span><span class="sxs-lookup"><span data-stu-id="e54a6-160">The shard map object creates a connection to the shard that holds the shardlet for the given sharding key.</span></span> <span data-ttu-id="e54a6-161">Rozhraní API klienta elastické databáze také označovat připojení k implementaci jeho konzistence záruky.</span><span class="sxs-lookup"><span data-stu-id="e54a6-161">The elastic database client APIs also tag the connection to implement its consistency guarantees.</span></span> <span data-ttu-id="e54a6-162">Od volání [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) vrátí regulární SQL objekt připojení klienta, následných volání **Execute** metoda rozšíření z Dapper dodržovat standardní Dapper postupem.</span><span class="sxs-lookup"><span data-stu-id="e54a6-162">Since the call to [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) returns a regular SQL Client connection object, the subsequent call to the **Execute** extension method from Dapper follows the standard Dapper practice.</span></span>

<span data-ttu-id="e54a6-163">Dotazy na pracovní velmi mnohem stejným způsobem jako – poprvé otevřete připojení pomocí [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) z klientského rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="e54a6-163">Queries work very much the same way - you first open the connection using [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) from the client API.</span></span> <span data-ttu-id="e54a6-164">Potom můžete pomocí regulární Dapper rozšiřující metody mapovat na objekty .NET výsledky dotazu SQL:</span><span class="sxs-lookup"><span data-stu-id="e54a6-164">Then you use the regular Dapper extension methods to map the results of your SQL query into .NET objects:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId1, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate ))
    {    
           // Display all Blogs for tenant 1
           IEnumerable<Blog> result = sqlconn.Query<Blog>(@"
                                SELECT * 
                                FROM Blog
                                ORDER BY Name");

           Console.WriteLine("All blogs for tenant id {0}:", tenantId1);
           foreach (var item in result)
           {
                Console.WriteLine(item.Name);
            }
    }

<span data-ttu-id="e54a6-165">Všimněte si, že **pomocí** blokovat pomocí oborů připojení DDR všechny databázové operace v rámci blok, který má jeden horizontálního oddílu, kde je udržována tenantId1.</span><span class="sxs-lookup"><span data-stu-id="e54a6-165">Note that the **using** block with the DDR connection scopes all database operations within the block to the one shard where tenantId1 is kept.</span></span> <span data-ttu-id="e54a6-166">Dotaz vrátí jenom blogy uložené na aktuální horizontálního oddílu, ale není těm, které jsou uložené na jiné horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="e54a6-166">The query only returns blogs stored on the current shard, but not the ones stored on any other shards.</span></span> 

## <a name="data-dependent-routing-with-dapper-and-dapperextensions"></a><span data-ttu-id="e54a6-167">Data závislé směrování s Dapper a DapperExtensions</span><span class="sxs-lookup"><span data-stu-id="e54a6-167">Data dependent routing with Dapper and DapperExtensions</span></span>
<span data-ttu-id="e54a6-168">Dapper se dodává s prostředí další rozšíření, které můžete zadat další pohodlí a abstrakce z databáze při vývoji aplikace databáze.</span><span class="sxs-lookup"><span data-stu-id="e54a6-168">Dapper comes with an ecosystem of additional extensions that can provide further convenience and abstraction from the database when developing database applications.</span></span> <span data-ttu-id="e54a6-169">DapperExtensions je příklad.</span><span class="sxs-lookup"><span data-stu-id="e54a6-169">DapperExtensions is an example.</span></span> 

<span data-ttu-id="e54a6-170">Použití DapperExtensions v aplikaci se nezměnil způsob vytváření a spravovaná databázová připojení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-170">Using DapperExtensions in your application does not change how database connections are created and managed.</span></span> <span data-ttu-id="e54a6-171">Je stále odpovědnost aplikace k otevření připojení a regulární objekty připojení klienta SQL se očekává metodami rozšíření.</span><span class="sxs-lookup"><span data-stu-id="e54a6-171">It is still the application’s responsibility to open connections, and regular SQL Client connection objects are expected by the extension methods.</span></span> <span data-ttu-id="e54a6-172">Spoléháme na [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) jak je uvedeno výš.</span><span class="sxs-lookup"><span data-stu-id="e54a6-172">We can rely on the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) as outlined above.</span></span> <span data-ttu-id="e54a6-173">Podle následující ukázky kódu ukazují, jedinou změnou je, že se už musí zápisu příkazů T-SQL:</span><span class="sxs-lookup"><span data-stu-id="e54a6-173">As the following code samples show, the only change is that we do no longer have to write the T-SQL statements:</span></span>

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           var blog = new Blog { Name = name2 };
           sqlconn.Insert(blog);
    }

<span data-ttu-id="e54a6-174">A zde je ukázka kódu pro dotaz:</span><span class="sxs-lookup"><span data-stu-id="e54a6-174">And here is the code sample for the query:</span></span> 

    using (SqlConnection sqlconn = shardingLayer.ShardMap.OpenConnectionForKey(
                    key: tenantId2, 
                    connectionString: connStrBldr.ConnectionString, 
                    options: ConnectionOptions.Validate))
    {
           // Display all Blogs for tenant 2
           IEnumerable<Blog> result = sqlconn.GetList<Blog>();
           Console.WriteLine("All blogs for tenant id {0}:", tenantId2);
           foreach (var item in result)
           {
               Console.WriteLine(item.Name);
           }
    }

### <a name="handling-transient-faults"></a><span data-ttu-id="e54a6-175">Zpracování přechodných chyb</span><span class="sxs-lookup"><span data-stu-id="e54a6-175">Handling transient faults</span></span>
<span data-ttu-id="e54a6-176">Tým postupy společnosti Microsoft Patterns publikována [přechodné chyby zpracování bloku aplikace](http://msdn.microsoft.com/library/hh680934.aspx) , což vývojářům aplikací zmírnit běžné podmínky přechodná chyba došlo při spuštění v cloudu.</span><span class="sxs-lookup"><span data-stu-id="e54a6-176">The Microsoft Patterns & Practices team published the [Transient Fault Handling Application Block](http://msdn.microsoft.com/library/hh680934.aspx) to help application developers mitigate common transient fault conditions encountered when running in the cloud.</span></span> <span data-ttu-id="e54a6-177">Další informace najdete v tématu [Perseverance, tajný klíč všechny vítězství: použití bloku aplikace zpracování přechodné chyby](http://msdn.microsoft.com/library/dn440719.aspx).</span><span class="sxs-lookup"><span data-stu-id="e54a6-177">For more information, see [Perseverance, Secret of All Triumphs: Using the Transient Fault Handling Application Block](http://msdn.microsoft.com/library/dn440719.aspx).</span></span>

<span data-ttu-id="e54a6-178">Ukázka kódu spoléhá na knihovnu přechodná chyba k ochraně proti přechodných.</span><span class="sxs-lookup"><span data-stu-id="e54a6-178">The code sample relies on the transient fault library to protect against transient faults.</span></span> 

    SqlDatabaseUtils.SqlRetryPolicy.ExecuteAction(() =>
    {
       using (SqlConnection sqlconn = 
          shardingLayer.ShardMap.OpenConnectionForKey(tenantId2, connStrBldr.ConnectionString, ConnectionOptions.Validate))
          {
              var blog = new Blog { Name = name2 };
              sqlconn.Insert(blog);
          }
    });

<span data-ttu-id="e54a6-179">**SqlDatabaseUtils.SqlRetryPolicy** ve výše uvedeném kódu je definován jako **SqlDatabaseTransientErrorDetectionStrategy** s počtem opakování 10 a 5 sekund čekací dobu mezi opakovanými pokusy.</span><span class="sxs-lookup"><span data-stu-id="e54a6-179">**SqlDatabaseUtils.SqlRetryPolicy** in the code above is defined as a **SqlDatabaseTransientErrorDetectionStrategy** with a retry count of 10, and 5 seconds wait time between retries.</span></span> <span data-ttu-id="e54a6-180">Pokud používáte transakce, ujistěte se, že váš rozsah opakování přejde zpět na začátek v případě přechodná chyba transakce.</span><span class="sxs-lookup"><span data-stu-id="e54a6-180">If you are using transactions, make sure that your retry scope goes back to the beginning of the transaction in the case of a transient fault.</span></span>

## <a name="limitations"></a><span data-ttu-id="e54a6-181">Omezení</span><span class="sxs-lookup"><span data-stu-id="e54a6-181">Limitations</span></span>
<span data-ttu-id="e54a6-182">Přístupy uvedených v tomto dokumentu za následek několik omezení:</span><span class="sxs-lookup"><span data-stu-id="e54a6-182">The approaches outlined in this document entail a couple of limitations:</span></span>

* <span data-ttu-id="e54a6-183">Ukázkový kód pro tento dokument není ukazují, jak spravovat schématu v rámci horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="e54a6-183">The sample code for this document does not demonstrate how to manage schema across shards.</span></span>
* <span data-ttu-id="e54a6-184">Zadaný požadavek, předpokládáme, že všechny jeho zpracování databáze je obsažena v jedné horizontálního oddílu určeno klíčem horizontálního dělení poskytované žádost.</span><span class="sxs-lookup"><span data-stu-id="e54a6-184">Given a request, we assume that all its database processing is contained within a single shard as identified by the sharding key provided by the request.</span></span> <span data-ttu-id="e54a6-185">Však tento předpoklad vždy nemá, například když není možné zpřístupnit klíč horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-185">However, this assumption does not always hold, for example, when it is not possible to make a sharding key available.</span></span> <span data-ttu-id="e54a6-186">Chcete-li to vyřešit, zahrnuje klientské knihovny pro elastické databáze [MultiShardQuery třída](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span><span class="sxs-lookup"><span data-stu-id="e54a6-186">To address this, the elastic database client library includes the [MultiShardQuery class](http://msdn.microsoft.com/library/azure/microsoft.azure.sqldatabase.elasticscale.query.multishardexception.aspx).</span></span> <span data-ttu-id="e54a6-187">Třída implementuje abstraktní připojení pro dotazování přes několik horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="e54a6-187">The class implements a connection abstraction for querying over several shards.</span></span> <span data-ttu-id="e54a6-188">Použití MultiShardQuery v kombinaci s Dapper je nad rámec tohoto dokumentu.</span><span class="sxs-lookup"><span data-stu-id="e54a6-188">Using MultiShardQuery in combination with Dapper is beyond the scope of this document.</span></span>

## <a name="conclusion"></a><span data-ttu-id="e54a6-189">Závěr</span><span class="sxs-lookup"><span data-stu-id="e54a6-189">Conclusion</span></span>
<span data-ttu-id="e54a6-190">Aplikace s použitím Dapper a DapperExtensions můžete snadno využívat nástroje elastické databáze pro databázi SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="e54a6-190">Applications using Dapper and DapperExtensions can easily benefit from elastic database tools for Azure SQL Database.</span></span> <span data-ttu-id="e54a6-191">Tyto aplikace pomocí kroků uvedených v tomto dokumentu, můžete použít funkce nástroje pro data závislé směrování změnou vytváření a otevírání nových [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objekty, které chcete použít [ OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) volání Klientská knihovna pro elastické databáze.</span><span class="sxs-lookup"><span data-stu-id="e54a6-191">Through the steps outlined in this document, those applications can use the tool's capability for data dependent routing by changing the creation and opening of new [SqlConnection](http://msdn.microsoft.com/library/system.data.sqlclient.sqlconnection.aspx) objects to use the [OpenConnectionForKey](http://msdn.microsoft.com/library/azure/dn807226.aspx) call of the elastic database client library.</span></span> <span data-ttu-id="e54a6-192">Toto nastavení omezuje změny aplikace, které jsou potřeba těchto míst, kde jsou vytvořen a otevřít nové připojení.</span><span class="sxs-lookup"><span data-stu-id="e54a6-192">This limits the application changes required to those places where new connections are created and opened.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Image references-->
[1]: ./media/sql-database-elastic-scale-working-with-dapper/dapperimage1.png

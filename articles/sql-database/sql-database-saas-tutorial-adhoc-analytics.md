---
title: "Analýza dotazů ad-hoc aaaRun napříč více databází Azure SQL | Microsoft Docs"
description: "Spuštění dotazů ad-hoc analytics napříč více databází SQL v hello Wingtip SaaS víceklientské aplikace."
keywords: kurz k sql database
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/23/2017
ms.author: billgib; sstein
ms.openlocfilehash: 140cd51fdd03b5a548147282b51ceb0ad80c944d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="run-ad-hoc-analytics-queries-across-all-wingtip-saas-tenants"></a><span data-ttu-id="7bf25-104">Spuštění analytics dotazů ad-hoc napříč všichni klienti Wingtip SaaS</span><span class="sxs-lookup"><span data-stu-id="7bf25-104">Run ad-hoc analytics queries across all Wingtip SaaS tenants</span></span>

<span data-ttu-id="7bf25-105">V tomto kurzu spustíte distribuované dotazy napříč celou sadu databází, klienta hello tooenable ad-hoc analytics.</span><span class="sxs-lookup"><span data-stu-id="7bf25-105">In this tutorial, you run distributed queries across hello entire set of tenant databases tooenable ad-hoc analytics.</span></span> <span data-ttu-id="7bf25-106">Elastické dotaz je použité tooenable distribuovaných dotazů, což vyžaduje, aby další analýze databáze je nasazena (toohello katalogu server).</span><span class="sxs-lookup"><span data-stu-id="7bf25-106">Elastic Query is used tooenable distributed queries, which requires an additional analytics database is deployed (toohello catalog server).</span></span> <span data-ttu-id="7bf25-107">Tyto dotazy můžete extrahovat Statistika schovaný v každodenní provozních dat hello hello Wingtip SaaS aplikace.</span><span class="sxs-lookup"><span data-stu-id="7bf25-107">These queries can extract insights buried in hello day-to-day operational data of hello Wingtip SaaS app.</span></span>


<span data-ttu-id="7bf25-108">V tomto kurzu se dozvíte:</span><span class="sxs-lookup"><span data-stu-id="7bf25-108">In this tutorial you learn:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="7bf25-109">O hello globální zobrazení v každé databázi, které umožňují efektivní dotazování mezi klienty</span><span class="sxs-lookup"><span data-stu-id="7bf25-109">About hello global views in each database, that enable efficient querying across tenants</span></span>
> * <span data-ttu-id="7bf25-110">Jak toodeploy databázi analýzy ad-hoc</span><span class="sxs-lookup"><span data-stu-id="7bf25-110">How toodeploy an ad-hoc analytics database</span></span>
> * <span data-ttu-id="7bf25-111">Jak toorun distribuované dotazy mezi všechny databáze klienta</span><span class="sxs-lookup"><span data-stu-id="7bf25-111">How toorun distributed queries across all tenant databases</span></span>



<span data-ttu-id="7bf25-112">toocomplete dokončení tohoto kurzu, ujistěte se, hello následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="7bf25-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="7bf25-113">Hello Wingtip SaaS aplikace je nasazená.</span><span class="sxs-lookup"><span data-stu-id="7bf25-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="7bf25-114">toodeploy za méně než pět minut, najdete v části [nasazení a seznamte se s hello Wingtip SaaS aplikace](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="7bf25-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="7bf25-115">Je nainstalované prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7bf25-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="7bf25-116">Podrobnosti najdete v článku [Začínáme s prostředím Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="7bf25-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="7bf25-117">SQL Server Management Studio (SSMS) je nainstalována.</span><span class="sxs-lookup"><span data-stu-id="7bf25-117">SQL Server Management Studio (SSMS) is installed.</span></span> <span data-ttu-id="7bf25-118">toodownload a instalace aplikace SSMS, najdete v části [stáhnout SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span><span class="sxs-lookup"><span data-stu-id="7bf25-118">toodownload and install SSMS, see [Download SQL Server Management Studio (SSMS)](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms).</span></span>


## <a name="ad-hoc-analytics-pattern"></a><span data-ttu-id="7bf25-119">Vzor analytics ad-hoc</span><span class="sxs-lookup"><span data-stu-id="7bf25-119">Ad-hoc analytics pattern</span></span>

<span data-ttu-id="7bf25-120">Jedním z velké příležitosti hello s aplikacemi SaaS je toouse hello velká množství dat klienta centrálně uložené v cloudu hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-120">One of hello great opportunities with SaaS applications is toouse hello vast amount of tenant data stored centrally in hello cloud.</span></span> <span data-ttu-id="7bf25-121">Použijte tato data toogain přehledy hello operace a využití vaší aplikace vašich klientů, jejich, předvolby, chování, uživatelů atd. Funkce vývoj, vylepšení použitelnost a další investice do vaší aplikace a služby, můžete tyto přehledy průvodce.</span><span class="sxs-lookup"><span data-stu-id="7bf25-121">Use this data toogain insights into hello operation and usage of your application, your tenants, their users, preferences, behaviors, etc. These insights can guide feature development, usability improvements, and other investments in your apps and services.</span></span>

<span data-ttu-id="7bf25-122">V jedné databázi s více tenanty je přístup k těmto datům jednoduchý, ale třeba v případě distribuce mezi tisícovky databází se situace komplikuje.</span><span class="sxs-lookup"><span data-stu-id="7bf25-122">Accessing this data in a single multi-tenant database is easy, but not so easy when distributed at scale across potentially thousands of databases.</span></span> <span data-ttu-id="7bf25-123">Jeden z přístupů je toouse [elastické dotazu](sql-database-elastic-query-overview.md), což umožňuje dotazování na distribuovanou sadu databází s společné schéma.</span><span class="sxs-lookup"><span data-stu-id="7bf25-123">One approach is toouse [Elastic Query](sql-database-elastic-query-overview.md), which enables querying across a distributed set of databases with common schema.</span></span> <span data-ttu-id="7bf25-124">Elastické dotaz používá jeden *head* databáze, ve kterém jsou definovány externí tabulky, že zrcadlení tabulky a zobrazení hello distribuovaných databází (klientů).</span><span class="sxs-lookup"><span data-stu-id="7bf25-124">Elastic Query uses a single *head* database in which external tables are defined that mirror tables or views in hello distributed (tenant) databases.</span></span> <span data-ttu-id="7bf25-125">Dotazy odeslané toothis head databáze jsou kompilované tooproduce plán distribuovaného dotazu s části dotazu hello posunuta dolů toohello klienta databáze podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="7bf25-125">Queries submitted toothis head database are compiled tooproduce a distributed query plan, with portions of hello query pushed down toohello tenant databases as needed.</span></span> <span data-ttu-id="7bf25-126">Elastické dotaz používá hello horizontálního oddílu mapy v umístění hello hello katalogu databáze tooprovide hello klienta databází.</span><span class="sxs-lookup"><span data-stu-id="7bf25-126">Elastic Query uses hello shard map in hello catalog database tooprovide hello location of hello tenant databases.</span></span> <span data-ttu-id="7bf25-127">Instalační program a dotaz jsou jednoduché, pomocí standardní [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference)a podporují ad hoc dotazy z nástroje, například Power BI a Excel.</span><span class="sxs-lookup"><span data-stu-id="7bf25-127">Setup and query are straightforward using standard [Transact-SQL](https://docs.microsoft.com/sql/t-sql/language-reference), and support ad-hoc querying from tools like Power BI and Excel.</span></span>

<span data-ttu-id="7bf25-128">Mezi databázemi klienta hello distribucí dotazy, poskytuje elastické dotazu okamžitý přehled o provozu provozními daty.</span><span class="sxs-lookup"><span data-stu-id="7bf25-128">By distributing queries across hello tenant databases, Elastic Query provides immediate insight into live production data.</span></span> <span data-ttu-id="7bf25-129">Však jako elastické dotaz získává data ze potenciálně velký počet databází, odeslat dotaz latence v některých případech může být vyšší než pro dotazy na ekvivalentní tooa jedné víceklientské databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-129">However, as Elastic Query pulls data from potentially many databases, query latency can sometimes be higher than for equivalent queries submitted tooa single multi-tenant database.</span></span> <span data-ttu-id="7bf25-130">Potřeba dát pozor při navrhování dotazuje toominimize hello data, která je vrácena.</span><span class="sxs-lookup"><span data-stu-id="7bf25-130">Care should be taken when designing queries toominimize hello data that is returned.</span></span> <span data-ttu-id="7bf25-131">Elastické dotazu je často nejvhodnější pro dotazy malých objemů dat v reálném čase, jako názvem na rozdíl od toobuilding často používají složité analytické dotazy nebo sestavy.</span><span class="sxs-lookup"><span data-stu-id="7bf25-131">Elastic Query is often best suited for querying small amounts of real-time data, as opposed toobuilding frequently used or complex analytics queries or reports.</span></span> <span data-ttu-id="7bf25-132">Pokud dotazy neprovádí dobře, podívejte se na hello [plán spuštění](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee, jaká část dotazu hello bylo posunuto toohello vzdálené databáze a kolik dat se vrací.</span><span class="sxs-lookup"><span data-stu-id="7bf25-132">If queries don't perform well, look at hello [execution plan](https://docs.microsoft.com/sql/relational-databases/performance/display-an-actual-execution-plan) toosee what part of hello query has been pushed down toohello remote database and how much data is being returned.</span></span> <span data-ttu-id="7bf25-133">Dotazy, které vyžadují komplexní analytického zpracování může být lepší obsluhuje v některých případech extrahování dat klienta do vyhrazené databáze nebo datového skladu optimalizované pro analytické dotazy.</span><span class="sxs-lookup"><span data-stu-id="7bf25-133">Queries that require complex analytical processing may be better served in some cases by extracting tenant data into a dedicated database or data warehouse optimized for analytics queries.</span></span> <span data-ttu-id="7bf25-134">Tento vzor je vysvětleno v hello [kurzu analýza klienta](sql-database-saas-tutorial-tenant-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="7bf25-134">This pattern is explained in hello [tenant analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md).</span></span> 

## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="7bf25-135">Získat hello Wingtip aplikační skripty</span><span class="sxs-lookup"><span data-stu-id="7bf25-135">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="7bf25-136">Hello Wingtip SaaS skripty a zdrojový kód aplikace jsou k dispozici v hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) úložiště github.</span><span class="sxs-lookup"><span data-stu-id="7bf25-136">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="7bf25-137">[Kroky toodownload hello Wingtip SaaS skripty](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="7bf25-137">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-ticket-sales-data"></a><span data-ttu-id="7bf25-138">Vytvořit data prodeje lístků</span><span class="sxs-lookup"><span data-stu-id="7bf25-138">Create ticket sales data</span></span>

<span data-ttu-id="7bf25-139">spuštěním hello lístek – generátor toorun dotazy proti zajímavějšího datové sady, vytvořte prodejní data lístku.</span><span class="sxs-lookup"><span data-stu-id="7bf25-139">toorun queries against a more interesting data set, create ticket sales data by running hello ticket-generator.</span></span>

1. <span data-ttu-id="7bf25-140">V hello *prostředí PowerShell ISE*, otevřete hello... \\Learning moduly\\provozní Analytics\\ad hoc Analytics\\*ukázku AdhocAnalytics.ps1* skript a nastavte hello následující hodnoty:</span><span class="sxs-lookup"><span data-stu-id="7bf25-140">In hello *PowerShell ISE*, open hello ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* script and set hello following values:</span></span>
   * <span data-ttu-id="7bf25-141">**$DemoScenario** = 1, **zakoupit lístky pro události na všechna místa**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-141">**$DemoScenario** = 1, **Purchase tickets for events at all venues**.</span></span>
2. <span data-ttu-id="7bf25-142">Stiskněte klávesu **F5** a spusťte skript hello generovat prodeje lístků.</span><span class="sxs-lookup"><span data-stu-id="7bf25-142">Press **F5** to run hello script and generate ticket sales.</span></span> <span data-ttu-id="7bf25-143">Je spuštěn skript hello, pokračujte hello kroky v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="7bf25-143">While hello script is running, continue hello steps in this tutorial.</span></span> <span data-ttu-id="7bf25-144">data lístku Hello je dotazován v hello *spouštění dotazů ad-hoc distribuované* části, proto počkejte toocomplete generátor lístku hello, pokud je stále spuštěn, když získat toothat cvičení.</span><span class="sxs-lookup"><span data-stu-id="7bf25-144">hello ticket data is queried in hello *Run ad-hoc distributed queries* section, so wait for hello ticket generator toocomplete if it's still running when you get toothat exercise.</span></span>

## <a name="explore-hello-global-views"></a><span data-ttu-id="7bf25-145">Prozkoumejte hello globální zobrazení</span><span class="sxs-lookup"><span data-stu-id="7bf25-145">Explore hello global views</span></span>

<span data-ttu-id="7bf25-146">Hello aplikace Wingtip SaaS vytvořená s využitím modelu klienta pro databáze, tak z hlediska jednoho klienta je definována schéma databáze klienta hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-146">hello Wingtip SaaS application is built using a tenant-per-database model, so hello tenant database schema is defined from a single-tenant perspective.</span></span> <span data-ttu-id="7bf25-147">Informace specifické pro klienta existuje v jedné tabulce *místo*, vždy má jeden řádek a je implementovaný jako haldy, bez primárního klíče.</span><span class="sxs-lookup"><span data-stu-id="7bf25-147">Tenant-specific information exists in one table, *Venue*, which always has a single row, and is implemented as a heap, without a primary key.</span></span> <span data-ttu-id="7bf25-148">Ostatní tabulky v hello schématu nepotřebujete toobe související toohello *místo* tabulky, protože při běžném použití, se nikdy pochybností datových hello klienta patří.</span><span class="sxs-lookup"><span data-stu-id="7bf25-148">Other tables in hello schema don't need toobe related toohello *Venue* table, because in normal use, there is never any doubt which tenant hello data belongs to.</span></span>

<span data-ttu-id="7bf25-149">Ale při dotazování mezi všechny databáze, je důležité, aby můžete elastické dotazu, pokud je součástí jedné logické databáze horizontálně dělené klientem považovala hello data.</span><span class="sxs-lookup"><span data-stu-id="7bf25-149">However, when querying across all databases, it's important that Elastic Query can treat hello data as if it is part of a single logical database sharded by tenant.</span></span> <span data-ttu-id="7bf25-150">tooachieve to sadu 'globální' zobrazení jsou přidané toohello klienta databáze, která projektu id klienta do každé hello tabulek, které jsou předmětem dotazování globálně.</span><span class="sxs-lookup"><span data-stu-id="7bf25-150">tooachieve this, a set of 'global' views are added toohello tenant database that project a tenant id into each of hello tables that are queried globally.</span></span> <span data-ttu-id="7bf25-151">Například hello *VenueEvents* zobrazení přidá počítaný *VenueId* toohello sloupce projektovat z hello *události* tabulky.</span><span class="sxs-lookup"><span data-stu-id="7bf25-151">For example, hello *VenueEvents* view adds a computed *VenueId* toohello columns projected from hello *Events* table.</span></span> <span data-ttu-id="7bf25-152">Definováním hello externí tabulky v databázi head hello přes *VenueEvents* (místo hello základní *události* tabulky), elastické dotazu je možné toopush dolů na základě spojení *VenueId* , mohou být provedeny souběžně na každém vzdálené databáze (ne na hello head databáze).</span><span class="sxs-lookup"><span data-stu-id="7bf25-152">By defining hello external table in hello head database over *VenueEvents* (rather than hello underlying *Events* table), Elastic Query is able toopush down joins based on *VenueId* so they can be executed in parallel on each remote database (rather than on hello head database).</span></span> <span data-ttu-id="7bf25-153">Tím se výrazně snižuje hello množství dat, která je vrácena, což vede k podstatné zvýšení výkonu pro mnoho dotazů.</span><span class="sxs-lookup"><span data-stu-id="7bf25-153">This dramatically reduces hello amount of data that is returned, which results in a substantial increase in performance for many queries.</span></span> <span data-ttu-id="7bf25-154">Tato globální zobrazení byly předem vytvořené v všechny databáze klienta (a v *basetenantdb*).</span><span class="sxs-lookup"><span data-stu-id="7bf25-154">These global views have been pre-created in all tenant databases (and in *basetenantdb*).</span></span>

1. <span data-ttu-id="7bf25-155">Otevřete aplikaci SSMS a [připojit toohello tenants1 -&lt;uživatele&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span><span class="sxs-lookup"><span data-stu-id="7bf25-155">Open SSMS and [connect toohello tenants1-&lt;USER&gt; server](sql-database-wtp-overview.md#explore-database-schema-and-execute-sql-queries-using-ssms).</span></span>
2. <span data-ttu-id="7bf25-156">Rozbalte položku **databáze**, klikněte pravým tlačítkem na **contosoconcerthall**a vyberte **nový dotaz**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-156">Expand **Databases**, right-click **contosoconcerthall**, and select **New Query**.</span></span>
3. <span data-ttu-id="7bf25-157">Spusťte následující dotazy tooexplore hello rozdíl mezi hello jednoho klienta tabulek a zobrazení globální hello hello:</span><span class="sxs-lookup"><span data-stu-id="7bf25-157">Run hello following queries tooexplore hello difference between hello single-tenant tables and hello global views:</span></span>

   ```T-SQL
   -- hello base Venue table, that has no VenueId associated.
   SELECT * FROM Venue

   -- Notice hello plural name 'Venues'. This view projects a VenueId column.
   SELECT * FROM Venues

   -- hello base Events table, which has no VenueId column.
   SELECT * FROM Events

   -- This view projects hello VenueId retrieved from hello Venues table.
   SELECT * FROM VenueEvents
   ```

<span data-ttu-id="7bf25-158">V těchto zobrazeních hello *VenueId* se vypočítá jako hodnota hash hello místo názvu, ale žádné přístup může být použité toointroduce jedinečnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="7bf25-158">In these views, hello *VenueId* is computed as a hash of hello Venue name, but any approach could be used toointroduce a unique value.</span></span> <span data-ttu-id="7bf25-159">Tento přístup je podobné toohello způsob, jakým je počítaný hello klíč klienta pro použití v katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-159">This approach is similar toohello way hello tenant key is computed for use in hello catalog.</span></span>

<span data-ttu-id="7bf25-160">definice hello tooexamine hello *místa* zobrazení:</span><span class="sxs-lookup"><span data-stu-id="7bf25-160">tooexamine hello definition of hello *Venues* view:</span></span>

1. <span data-ttu-id="7bf25-161">V **Průzkumník objektů**, rozbalte položku **contosoconcethall** > **zobrazení**:</span><span class="sxs-lookup"><span data-stu-id="7bf25-161">In **Object Explorer**, expand **contosoconcethall** > **Views**:</span></span>

   ![zobrazení](media/sql-database-saas-tutorial-adhoc-analytics/views.png)

2. <span data-ttu-id="7bf25-163">Klikněte pravým tlačítkem na **dbo. Místa**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-163">Right-click **dbo.Venues**.</span></span>
3. <span data-ttu-id="7bf25-164">Vyberte **skript zobrazení jako** > **vytvořit** > **nové okno editoru dotazů**</span><span class="sxs-lookup"><span data-stu-id="7bf25-164">Select **Script View as** > **CREATE To** > **New Query Editor Window**</span></span>

<span data-ttu-id="7bf25-165">Některé z hello další skript *místo* zobrazení toosee jak zvyšují hello *VenueId*.</span><span class="sxs-lookup"><span data-stu-id="7bf25-165">Script any of hello other *Venue* views toosee how they add hello *VenueId*.</span></span>

## <a name="deploy-hello-database-used-for-ad-hoc-distributed-queries"></a><span data-ttu-id="7bf25-166">Nasazení databáze hello použít pro ad-hoc distribuované dotazy</span><span class="sxs-lookup"><span data-stu-id="7bf25-166">Deploy hello database used for ad-hoc distributed queries</span></span>

<span data-ttu-id="7bf25-167">Toto cvičení nasadí hello *adhocanalytics* databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-167">This exercise deploys hello *adhocanalytics* database.</span></span> <span data-ttu-id="7bf25-168">Toto je hello head databáze, která bude obsahovat hello schématu použitého k dotazování mezi všechny databáze klienta.</span><span class="sxs-lookup"><span data-stu-id="7bf25-168">This is hello head database that will contain hello schema used for querying across all tenant databases.</span></span> <span data-ttu-id="7bf25-169">Hello databáze je nasazené toohello existující katalogu server, který je použit pro všechny týkajících se správy databáze v ukázkové aplikace hello server hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-169">hello database is deployed toohello existing catalog server, which is hello server used for all management-related databases in hello sample app.</span></span>

1. <span data-ttu-id="7bf25-170">Otevřete... \\Learning moduly\\provozní Analytics\\ad hoc Analytics\\*ukázku AdhocAnalytics.ps1* v hello *prostředí PowerShell ISE* a sadu hello následující hodnoty:</span><span class="sxs-lookup"><span data-stu-id="7bf25-170">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalytics.ps1* in hello *PowerShell ISE* and set hello following values:</span></span>
   * <span data-ttu-id="7bf25-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database** (Nasadit analytickou databázi ad hoc).</span><span class="sxs-lookup"><span data-stu-id="7bf25-171">**$DemoScenario** = 2, **Deploy Ad-hoc analytics database**.</span></span>

2. <span data-ttu-id="7bf25-172">Stiskněte klávesu **F5** toorun hello skriptu a vytvořit hello *adhocanalytics* databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-172">Press **F5** toorun hello script and create hello *adhocanalytics* database.</span></span>

<span data-ttu-id="7bf25-173">V další části hello přidáte schématu toohello databáze, aby ho bylo možné použít toorun distribuované dotazy.</span><span class="sxs-lookup"><span data-stu-id="7bf25-173">In hello next section, you add schema toohello database so it can be used toorun distributed queries.</span></span>

## <a name="configure-hello-database-for-running-distributed-queries"></a><span data-ttu-id="7bf25-174">Konfigurace hello databáze pro spuštění distribuovaných dotazů</span><span class="sxs-lookup"><span data-stu-id="7bf25-174">Configure hello database for running distributed queries</span></span>

<span data-ttu-id="7bf25-175">Tento postup přidá schématu (hello externí zdroj dat a externí tabulky definice) toohello ad-hoc analytics databázi, která umožňuje dotazování mezi všechny databáze klienta.</span><span class="sxs-lookup"><span data-stu-id="7bf25-175">This exercise adds schema (hello external data source and external table definitions) toohello ad-hoc analytics database that enables querying across all tenant databases.</span></span>

1. <span data-ttu-id="7bf25-176">Otevřete aplikaci SQL Server Management Studio a připojte toohello ad hoc Analytics databáze, kterou jste vytvořili v předchozím kroku hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-176">Open SQL Server Management Studio, and connect toohello Adhoc Analytics database you created in hello previous step.</span></span> <span data-ttu-id="7bf25-177">Název Hello hello databáze bude adhocanalytics.</span><span class="sxs-lookup"><span data-stu-id="7bf25-177">hello name of hello database will be adhocanalytics.</span></span>
2. <span data-ttu-id="7bf25-178">Otevřete ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *inicializovat AdhocAnalyticsDB.sql* v aplikaci SSMS.</span><span class="sxs-lookup"><span data-stu-id="7bf25-178">Open ...\Learning Modules\Operational Analytics\Adhoc Analytics\ *Initialize-AdhocAnalyticsDB.sql* in SSMS.</span></span>
3. <span data-ttu-id="7bf25-179">Zkontrolujte skript SQL hello a poznamenejte si hello následující:</span><span class="sxs-lookup"><span data-stu-id="7bf25-179">Review hello SQL script and note hello following:</span></span>

   <span data-ttu-id="7bf25-180">Elastické dotaz používá přihlašovacích údajů platných pro databázi tooaccess jednotlivých databází hello klienta.</span><span class="sxs-lookup"><span data-stu-id="7bf25-180">Elastic Query uses a database-scoped credential tooaccess each of hello tenant databases.</span></span> <span data-ttu-id="7bf25-181">Tento přihlašovací údaj potřebuje k dispozici ve všech databází hello toobe a by měla být poskytnuta normálně hello minimální oprávnění vyžaduje tooenable těchto dotazů ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="7bf25-181">This credential needs toobe available in all hello databases and should normally be granted hello minimum rights required tooenable these ad-hoc queries.</span></span>

    ![Vytvoření pověření](media/sql-database-saas-tutorial-adhoc-analytics/create-credential.png)

   <span data-ttu-id="7bf25-183">Hello externí zdroj dat, který je definován toouse hello klienta horizontálního oddílu mapy v databázi katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-183">hello external data source, that is defined toouse hello tenant shard map in hello catalog database.</span></span> <span data-ttu-id="7bf25-184">Prostřednictvím tohoto jako zdroj externích dat hello dotazy jsou distribuované tooall databáze zaregistrované v katalogu hello při spuštění dotazu hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-184">By using this as hello external data source, queries are distributed tooall databases registered in hello catalog when hello query is run.</span></span> <span data-ttu-id="7bf25-185">Vzhledem k tomu, že názvy serverů se liší pro každé nasazení, získá tento skript inicializace hello umístění databáze katalogu hello načtením aktuální server hello (@@servername) kde hello skript se spustí.</span><span class="sxs-lookup"><span data-stu-id="7bf25-185">Because server names are different for each deployment, this initialization script gets hello location of hello catalog database by retrieving hello current server (@@servername) where hello script is executed.</span></span>

    ![Vytvoření externího zdroje dat](media/sql-database-saas-tutorial-adhoc-analytics/create-external-data-source.png)

   <span data-ttu-id="7bf25-187">Hello externí tabulky, které odkazují na globální zobrazení hello popsané v předchozí části hello a definovaný s **distribuční = SHARDED(VenueId)**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-187">hello external tables that reference hello global views described in hello previous section, and defined with **DISTRIBUTION = SHARDED(VenueId)**.</span></span> <span data-ttu-id="7bf25-188">Protože každý *VenueId* mapuje tooa jedné databáze, to zvyšuje výkon pro mnoho scénářů, jak je znázorněno v další části hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-188">Because each *VenueId* maps tooa single database, this improves performance for many scenarios as shown in hello next section.</span></span>

    ![Vytvoření externí tabulky](media/sql-database-saas-tutorial-adhoc-analytics/external-tables.png)

   <span data-ttu-id="7bf25-190">místní tabulky Hello *VenueTypes* , je vytvořeny a naplněny.</span><span class="sxs-lookup"><span data-stu-id="7bf25-190">hello local table *VenueTypes* that is created and populated.</span></span> <span data-ttu-id="7bf25-191">Tuto referenční tabulku dat je běžné v všechny databáze klienta, takže může být reprezentován jako na místní tabulku a vyplněná běžné daty hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-191">This reference data table is common in all tenant databases, so it can be represented here as a local table and populated with hello common data.</span></span> <span data-ttu-id="7bf25-192">Pro některé dotazy hello to může snížit množství dat přesunout mezi databázemi hello klienta a hello *adhocanalytics* databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-192">For some queries this may reduce hello amount of data moved between hello tenant databases and hello *adhocanalytics* database.</span></span>

    ![Vytvoření tabulky](media/sql-database-saas-tutorial-adhoc-analytics/create-table.png)

   <span data-ttu-id="7bf25-194">Pokud zahrnete referenční tabulky tímto způsobem, být jisti tooupdate hello tabulky schéma a data při každé aktualizaci databáze klienta hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-194">If you include reference tables in this manner, be sure tooupdate hello table schema and data whenever you update hello tenant databases.</span></span>

4. <span data-ttu-id="7bf25-195">Stiskněte klávesu **F5** toorun hello skriptu a inicializace hello *adhocanalytics* databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-195">Press **F5** toorun hello script and initialize hello *adhocanalytics* database.</span></span> 

<span data-ttu-id="7bf25-196">Nyní můžete spustit distribuované dotazy a shromažďovat statistiky napříč všichni klienti!</span><span class="sxs-lookup"><span data-stu-id="7bf25-196">Now you can run distributed queries, and gather insights across all tenants!</span></span>

## <a name="run-ad-hoc-distributed-queries"></a><span data-ttu-id="7bf25-197">Spuštění dotazů ad-hoc distribuované</span><span class="sxs-lookup"><span data-stu-id="7bf25-197">Run ad-hoc distributed queries</span></span>

<span data-ttu-id="7bf25-198">Teď tento hello *adhocanalytics* databáze je nastavit, aby ihned začít a spustit některé distribuované dotazy.</span><span class="sxs-lookup"><span data-stu-id="7bf25-198">Now that hello *adhocanalytics* database is set up, go ahead and run some distributed queries.</span></span> <span data-ttu-id="7bf25-199">Zahrnout plán spuštění hello lépe porozumět tomu, kde se hello zpracování dotazu děje.</span><span class="sxs-lookup"><span data-stu-id="7bf25-199">Include hello execution plan for a better understanding of where hello query processing is happening.</span></span> 

<span data-ttu-id="7bf25-200">Při kontrole plán spuštění hello, pozastavte ukazatel myši nad hello plán ikony podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="7bf25-200">When inspecting hello execution plan, hover over hello plan icons for details.</span></span> 

<span data-ttu-id="7bf25-201">Toto nastavení je důležité toonote **distribuční = SHARDED(VenueId)** když jsme definovali hello externí zdroj dat, zlepšuje výkon pro mnoho scénářů.</span><span class="sxs-lookup"><span data-stu-id="7bf25-201">Important toonote, is that setting **DISTRIBUTION = SHARDED(VenueId)** when we defined hello external data source, improves performance for many scenarios.</span></span> <span data-ttu-id="7bf25-202">Protože každý *VenueId* mapuje tooa jedné databáze filtrování je snadno done vzdáleně, vracejících pouze hello dat potřebujeme.</span><span class="sxs-lookup"><span data-stu-id="7bf25-202">Because each *VenueId* maps tooa single database, filtering is easily done remotely, returning only hello data we need.</span></span>

1. <span data-ttu-id="7bf25-203">Otevřete skript …\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* v SSMS.</span><span class="sxs-lookup"><span data-stu-id="7bf25-203">Open ...\\Learning Modules\\Operational Analytics\\Adhoc Analytics\\*Demo-AdhocAnalyticsQueries.sql* in SSMS.</span></span>
2. <span data-ttu-id="7bf25-204">Ujistěte se, jsou připojené toohello **adhocanalytics** databáze.</span><span class="sxs-lookup"><span data-stu-id="7bf25-204">Ensure you are connected toohello **adhocanalytics** database.</span></span>
3. <span data-ttu-id="7bf25-205">Vyberte hello **dotazu** nabídky a klikněte na tlačítko **zahrnují skutečné naplánovat spuštění**</span><span class="sxs-lookup"><span data-stu-id="7bf25-205">Select hello **Query** menu and click **Include Actual Execution Plan**</span></span>
4. <span data-ttu-id="7bf25-206">Zvýrazněte hello *místa, které jsou aktuálně registrované?* dotazu a stiskněte klávesu **F5**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-206">Highlight hello *Which venues are currently registered?* query, and press **F5**.</span></span>

   <span data-ttu-id="7bf25-207">Hello dotaz vrátí seznamu celý místo hello ilustrující způsob rychlé a snadné je tooquery ve všech klientů a vracená data z každého klienta.</span><span class="sxs-lookup"><span data-stu-id="7bf25-207">hello query returns hello entire venue list, illustrating how quick and easy it is tooquery across all tenants and return data from each tenant.</span></span>

   <span data-ttu-id="7bf25-208">Zkontrolujte hello plán a zjistíte, že náklady hello je hello vzdálený dotaz, protože jsme jednoduše probíhající tooeach klienta databáze a výběrem hello místo informace.</span><span class="sxs-lookup"><span data-stu-id="7bf25-208">Inspect hello plan and see that hello entire cost is hello remote query because we're simply going tooeach tenant database and selecting hello venue information.</span></span>

   ![Vybrat * z dbo. Místa](media/sql-database-saas-tutorial-adhoc-analytics/query1-plan.png)

5. <span data-ttu-id="7bf25-210">Vyberte hello další dotaz a stiskněte klávesu **F5**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-210">Select hello next query, and press **F5**.</span></span>

   <span data-ttu-id="7bf25-211">Tento dotaz připojí data z databáze hello klienta a místní hello *VenueTypes* tabulky (místní počítač, protože je tabulka v hello *adhocanalytics* databáze).</span><span class="sxs-lookup"><span data-stu-id="7bf25-211">This query joins data from hello tenant databases and hello local *VenueTypes* table (local, as its a table in hello *adhocanalytics* database).</span></span>

   <span data-ttu-id="7bf25-212">Zkontrolujte plán hello a najdete v části tohoto hello většina náklady je hello vzdálený dotaz, protože jsme dotaz na informace místo každého klienta (dbo. Místa), a poté proveďte rychlé místní spojení s místní hello *VenueTypes* popisný název tabulky toodisplay hello.</span><span class="sxs-lookup"><span data-stu-id="7bf25-212">Inspect hello plan and see that hello majority of cost is hello remote query because we query each tenant's venue info (dbo.Venues), and then do a quick local join with hello local *VenueTypes* table toodisplay hello friendly name.</span></span>

   ![Připojení k vzdálené a místní data](media/sql-database-saas-tutorial-adhoc-analytics/query2-plan.png)

6. <span data-ttu-id="7bf25-214">Nyní vyberte hello *den, kdy byly hello většina lístků prodaných?* dotazu a stiskněte klávesu **F5**.</span><span class="sxs-lookup"><span data-stu-id="7bf25-214">Now select hello *On which day were hello most tickets sold?* query, and press **F5**.</span></span>

   <span data-ttu-id="7bf25-215">Tento dotaz nemá trochu složitější spojování a agregaci.</span><span class="sxs-lookup"><span data-stu-id="7bf25-215">This query does a bit more complex joining and aggregation.</span></span> <span data-ttu-id="7bf25-216">Co je důležité toonote je, že většina hello zpracování je provést vzdáleně a ještě jednou budeme navrácení pouze řádky hello, potřebujeme, vrácení pouze jeden řádek pro každý místo agregační lístku prodej počet za den.</span><span class="sxs-lookup"><span data-stu-id="7bf25-216">What's important toonote is that most of hello processing is done remotely, and once again, we bring back only hello rows we need, returning just a single row for each venue's aggregate ticket sale count per day.</span></span>

   ![query](media/sql-database-saas-tutorial-adhoc-analytics/query3-plan.png)


## <a name="next-steps"></a><span data-ttu-id="7bf25-218">Další kroky</span><span class="sxs-lookup"><span data-stu-id="7bf25-218">Next steps</span></span>

<span data-ttu-id="7bf25-219">V tomto kurzu jste se naučili:</span><span class="sxs-lookup"><span data-stu-id="7bf25-219">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="7bf25-220">Spouštění distribuovaných dotazů ve všech tenantských databázích</span><span class="sxs-lookup"><span data-stu-id="7bf25-220">Run distributed queries across all tenant databases</span></span>
> * <span data-ttu-id="7bf25-221">Nasazení databáze služby ad-hoc analýzy a přidejte schématu tooit toorun distribuované dotazy.</span><span class="sxs-lookup"><span data-stu-id="7bf25-221">Deploy an ad-hoc analytics database and add schema tooit toorun distributed queries.</span></span>


<span data-ttu-id="7bf25-222">Nyní zkuste hello [klienta Analytics kurzu](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extrahování dat tooa samostatné analytics databáze pro zpracování složitějších analýzy...</span><span class="sxs-lookup"><span data-stu-id="7bf25-222">Now try hello [Tenant Analytics tutorial](sql-database-saas-tutorial-tenant-analytics.md) tooexplore extracting data tooa separate analytics database for more complex analytics processing...</span></span>

## <a name="additional-resources"></a><span data-ttu-id="7bf25-223">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="7bf25-223">Additional resources</span></span>

* <span data-ttu-id="7bf25-224">Další [návodů, které stavějí hello Wingtip SaaS aplikace](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="7bf25-224">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="7bf25-225">Elastic Query</span><span class="sxs-lookup"><span data-stu-id="7bf25-225">Elastic Query</span></span>](sql-database-elastic-query-overview.md)

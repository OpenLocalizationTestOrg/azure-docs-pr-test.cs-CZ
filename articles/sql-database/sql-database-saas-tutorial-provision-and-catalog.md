---
title: "nové klienty aaaProvision ve víceklientské aplikaci, která používá Azure SQL Database | Microsoft Docs"
description: "Zjistěte, jak tooprovision a katalog nové klienty ve hello Wingtip SaaS aplikace"
keywords: kurz k sql database
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/11/2017
ms.author: sstein
ms.openlocfilehash: eb26f523305650c2124e36707d187dfcdad06fcc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="provision-new-tenants-and-register-them-in-hello-catalog"></a><span data-ttu-id="e5e8e-104">Zřídit nové klienty a zaregistrujte je v katalogu hello</span><span class="sxs-lookup"><span data-stu-id="e5e8e-104">Provision new tenants and register them in hello catalog</span></span>

<span data-ttu-id="e5e8e-105">V tomto kurzu můžete další informace o zřizování hello a vzory SaaS katalogu a jak jsou implementované v hello Wingtip SaaS aplikace.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-105">In this tutorial, you learn about hello provision and catalog SaaS patterns, and how they are implemented in hello Wingtip SaaS application.</span></span> <span data-ttu-id="e5e8e-106">Vytvoření a inicializace nové databáze klienta a zaregistrujte je v katalogu aplikací hello klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-106">You create and initialize new tenant databases, and register them in hello application’s tenant catalog.</span></span> <span data-ttu-id="e5e8e-107">katalog Hello je databáze, která udržuje hello mapování mezi aplikace SaaS hello velký počet klientů a jejich data.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-107">hello catalog is a database that maintains hello mapping between hello SaaS application's many tenants and their data.</span></span> <span data-ttu-id="e5e8e-108">katalog Hello hraje důležitou roli odkazovat aplikace požadavky toohello správné databázi.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-108">hello catalog plays an important role directing application requests toohello correct database.</span></span>  

<span data-ttu-id="e5e8e-109">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-109">In this tutorial, you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="e5e8e-110">Zřídit jednoho nového klienta, včetně procházení jak tato možnost je implementovaná</span><span class="sxs-lookup"><span data-stu-id="e5e8e-110">Provision a single new tenant, including stepping through how this is implemented</span></span>
> * <span data-ttu-id="e5e8e-111">Zřídit dávku dalších tenantů.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-111">Provision a batch of additional tenants</span></span>


<span data-ttu-id="e5e8e-112">toocomplete dokončení tohoto kurzu, ujistěte se, hello následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-112">toocomplete this tutorial, make sure hello following prerequisites are completed:</span></span>

* <span data-ttu-id="e5e8e-113">Hello Wingtip SaaS aplikace je nasazená.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-113">hello Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="e5e8e-114">toodeploy za méně než pět minut, najdete v části [nasazení a seznamte se s hello Wingtip SaaS aplikace](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="e5e8e-114">toodeploy in less than five minutes, see [Deploy and explore hello Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="e5e8e-115">Je nainstalované prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-115">Azure PowerShell is installed.</span></span> <span data-ttu-id="e5e8e-116">Podrobnosti najdete v článku [Začínáme s prostředím Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-116">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-toohello-saas-catalog-pattern"></a><span data-ttu-id="e5e8e-117">Úvod toohello vzor katalogu SaaS</span><span class="sxs-lookup"><span data-stu-id="e5e8e-117">Introduction toohello SaaS Catalog pattern</span></span>

<span data-ttu-id="e5e8e-118">V databázi zálohovanou víceklientské aplikaci SaaS je důležité tooknow se uloží informace pro každého klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-118">In a database-backed multi-tenant SaaS application, it's important tooknow where information for each tenant is stored.</span></span> <span data-ttu-id="e5e8e-119">V katalogu vzoru hello SaaS databáze katalogu je použité toohold hello mapování mezi každého klienta a kde jsou uchovávána data.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-119">In hello SaaS catalog pattern, a catalog database is used toohold hello mapping between each tenant and where their data is stored.</span></span> <span data-ttu-id="e5e8e-120">aplikace Wingtip SaaS Hello používá jednoho klienta za architektura databáze, ale základní vzor hello ukládání mapování klienta do databáze v katalogu platí, jestli se používá databázi víceklientské nebo jednoho klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-120">hello Wingtip SaaS app uses a single-tenant per database architecture, but hello basic pattern of storing tenant-to-database mapping in a catalog applies whether a multi-tenant or single-tenant database is used.</span></span>

<span data-ttu-id="e5e8e-121">Každý klient je přiřazen klíč, který označuje je v katalogu hello a který je namapovaný toohello umístění hello příslušné databáze.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-121">Each tenant is assigned a key that identifies them in hello catalog and which is mapped toohello location of hello appropriate database.</span></span> <span data-ttu-id="e5e8e-122">V aplikaci Wingtip SaaS hello hello klíč je vytvořen z hodnota hash název klienta hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-122">In hello Wingtip SaaS app, hello key is formed from a hash of hello tenant’s name.</span></span> <span data-ttu-id="e5e8e-123">Díky tomu, že část názvu klienta hello toobe adresu URL aplikace hello používá klíč tooconstruct hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-123">This allows hello tenant name portion of hello application URL toobe used tooconstruct hello key.</span></span> <span data-ttu-id="e5e8e-124">Může použít jiná schémata klíče klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-124">Other tenant key schemes could be used.</span></span>  

<span data-ttu-id="e5e8e-125">katalog Hello umožňuje hello název nebo umístění hello databáze toobe změnit s minimálním dopadem na aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-125">hello catalog allows hello name or location of hello database toobe changed with minimal impact on hello application.</span></span>  <span data-ttu-id="e5e8e-126">V databázi víceklientského modelu to rovněž umožňuje, 'Přesun' klienta mezi databázemi.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-126">In a multi-tenant database model, this also accommodates ‘moving’ a tenant between databases.</span></span>  <span data-ttu-id="e5e8e-127">katalog Hello může být také použít tooindicate zda klienta nebo databáze je offline z důvodu údržby nebo jiné akce.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-127">hello catalog can also be used tooindicate whether a tenant or database is offline for maintenance or other actions.</span></span> <span data-ttu-id="e5e8e-128">To je prozkoumali v hello [obnovení jednoho klienta kurzu](sql-database-saas-tutorial-restore-single-tenant.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-128">This is explored in hello [restore single tenant tutorial](sql-database-saas-tutorial-restore-single-tenant.md).</span></span>

<span data-ttu-id="e5e8e-129">Kromě toho hello katalogu, který je v platnosti databáze správy pro aplikace SaaS, můžete ukládat další metadata klienta nebo databáze, jako je například hello vrstvy nebo edici databáze, verzi schématu, plán služeb nebo SLA nabízí tootenants a další informace Umožňuje správu aplikací, na zákaznickou podporu nebo devops procesy.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-129">In addition, hello catalog, which is in effect a management database for a SaaS application, can store additional tenant or database metadata, such as hello tier or edition of a database, schema version, service plan, or SLAs offered tootenants, and other info that enables application management, customer support, or devops processes.</span></span>  

<span data-ttu-id="e5e8e-130">Nad rámec hello aplikace SaaS můžete povolit hello katalogu Nástroje databáze.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-130">Beyond hello SaaS application, hello catalog can enable database tools.</span></span>  <span data-ttu-id="e5e8e-131">V ukázce Wingtip SaaS hello hello katalog je použité tooenable mezi klienta dotaz, prozkoumali v hello [ad hoc analytics kurzu](sql-database-saas-tutorial-adhoc-analytics.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-131">In hello Wingtip SaaS sample, hello catalog is used tooenable cross-tenant query, explored in hello [ad hoc analytics tutorial](sql-database-saas-tutorial-adhoc-analytics.md).</span></span> <span data-ttu-id="e5e8e-132">Správa úloh mezidatabázové je prozkoumali v hello [Správa schématu](sql-database-saas-tutorial-schema-management.md) a [klienta analytics](sql-database-saas-tutorial-tenant-analytics.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-132">Cross-database job management is explored in hello [schema management](sql-database-saas-tutorial-schema-management.md) and [tenant analytics](sql-database-saas-tutorial-tenant-analytics.md) tutorials.</span></span> 

<span data-ttu-id="e5e8e-133">V aplikaci Wingtip SaaS hello hello katalogu je implementovaná pomocí funkce pro správu horizontálního oddílu hello hello [elastické databáze klienta knihovny (EDCL)](sql-database-elastic-database-client-library.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-133">In hello Wingtip SaaS app, hello catalog is implemented using hello Shard Management features of hello [Elastic Database Client Library (EDCL)](sql-database-elastic-database-client-library.md).</span></span> <span data-ttu-id="e5e8e-134">Hello EDCL umožňuje toocreate aplikace, spravovat a použít mapování horizontálních databáze zálohována.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-134">hello EDCL enables an application toocreate, manage, and use a database-backed shard map.</span></span> <span data-ttu-id="e5e8e-135">Mapování horizontálních obsahuje seznam horizontálních oddílů (databáze) a hello mapování mezi klíče (klienty) a databázemi.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-135">A shard map contains a list of shards (databases) and hello mapping between keys (tenants) and databases.</span></span>  <span data-ttu-id="e5e8e-136">Funkce EDCL během zřizování toocreate hello položky v mapě horizontálního oddílu hello klienta lze z aplikace nebo skripty prostředí PowerShell a z aplikace tooefficiently připojit toohello správné databázi.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-136">EDCL functions can be used from applications or PowerShell scripts during tenant provisioning toocreate hello entries in hello shard map, and from applications tooefficiently connect toohello correct database.</span></span> <span data-ttu-id="e5e8e-137">EDCL ukládá do mezipaměti databáze katalogu toohello hello připojení informace toominimize provozu a zrychlit aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-137">EDCL caches connection information toominimize hello traffic toohello catalog database and speed up hello application.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="e5e8e-138">Hello mapování dat je přístupný v databázi hello katalogu, ale *nemáte upravit*!</span><span class="sxs-lookup"><span data-stu-id="e5e8e-138">hello mapping data is accessible in hello catalog database, but *don't edit it*!</span></span> <span data-ttu-id="e5e8e-139">K jejich úpravě používejte jen rozhraní API klientské knihovny Elastic Database.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-139">Edit mapping data using Elastic Database Client Library APIs only.</span></span> <span data-ttu-id="e5e8e-140">Přímá manipulace s hello mapování dat rizika poškozování hello katalogu a není podporována.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-140">Directly manipulating hello mapping data risks corrupting hello catalog and is not supported.</span></span>


## <a name="introduction-toohello-saas-provisioning-pattern"></a><span data-ttu-id="e5e8e-141">Vzor SaaS zřizování toohello Úvod</span><span class="sxs-lookup"><span data-stu-id="e5e8e-141">Introduction toohello SaaS Provisioning pattern</span></span>

<span data-ttu-id="e5e8e-142">Při připojování nového klienta v aplikaci SaaS, která používá model databáze jednoho klienta novou databázi klienta musí být zřízená.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-142">When onboarding a new tenant in a SaaS application that uses a single-tenant database model a new tenant database must be provisioned.</span></span>  <span data-ttu-id="e5e8e-143">Musí být vytvořený v příslušné umístění hello a vrstvy služeb, inicializován s odpovídající schématu a referenčních dat a pak zaregistrována v katalogu hello pod klíčem hello odpovídající klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-143">It must be created in hello appropriate location and service tier, initialized with appropriate schema and reference data, and then registered in hello catalog under hello appropriate tenant key.</span></span>  

<span data-ttu-id="e5e8e-144">Různý přístup se dá použít toodatabase zřizování, který by mohl zahrnovat provádění skripty SQL, nasazení souboru bacpac nebo kopírování databáze "zlatá" šablony.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-144">Different approaches can be used toodatabase provisioning, which could include executing SQL scripts, deploying a bacpac, or copying a 'golden' template database.</span></span>  

<span data-ttu-id="e5e8e-145">Hello zřizování přístupů, které používáte musí comprehended v strategie pro správy celkové schéma, které musíte zajistit, že nové databáze zřízený s nejnovější schématu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-145">hello provisioning approach you use must be comprehended in your overall schema management strategy, which must ensure that new databases are provisioned with hello latest schema.</span></span>  <span data-ttu-id="e5e8e-146">To je prozkoumali v hello [schématu správu kurzu](sql-database-saas-tutorial-schema-management.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-146">This is explored in hello [schema management tutorial](sql-database-saas-tutorial-schema-management.md).</span></span>  

<span data-ttu-id="e5e8e-147">Hello Wingtip SaaS aplikace zřizuje nové klienty tak, že zkopírujete zlaté databáze s názvem basetenantdb, nasazeny na server hello katalogu.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-147">hello Wingtip SaaS app provisions new tenants by copying a golden database named basetenantdb, deployed on hello catalog server.</span></span>  <span data-ttu-id="e5e8e-148">Zřizování může být integrovaná do aplikace hello jako součást registrace prostředí, a podporované v režimu offline pomocí skriptů.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-148">Provisioning could be integrated into hello application as part of a sign-up experience, and/or supported offline using scripts.</span></span> <span data-ttu-id="e5e8e-149">V tomto kurzu bude prozkoumejte zřizování pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-149">This tutorial will explore provisioning using PowerShell.</span></span> <span data-ttu-id="e5e8e-150">skripty pro zřizování Hello zkopírujte hello basetenantdb toocreate novou databázi klienta v elastickém fondu, pak provést jeho inicializaci s informacemi o konkrétního klienta a zaregistrovat ji hello katalogu horizontálního oddílu mapy.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-150">hello provisioning scripts copy hello basetenantdb toocreate a new tenant database in an elastic pool, then initialize it with tenant-specific info and register it in hello catalog shard map.</span></span>  <span data-ttu-id="e5e8e-151">V hello ukázkové aplikace, databáze mají názvy na základě názvu hello klienta, ale nejedná se o důležitou součástí hello vzor – hello použití katalogu hello umožňuje všechny databáze toohello toobe přiřazen název. +</span><span class="sxs-lookup"><span data-stu-id="e5e8e-151">In hello sample app, databases are given names based on hello tenant name, but this is not a critical part of hello pattern – hello use of hello catalog allows any name toobe assigned toohello database.+</span></span> 


## <a name="get-hello-wingtip-application-scripts"></a><span data-ttu-id="e5e8e-152">Získat hello Wingtip aplikační skripty</span><span class="sxs-lookup"><span data-stu-id="e5e8e-152">Get hello Wingtip application scripts</span></span>

<span data-ttu-id="e5e8e-153">Hello Wingtip SaaS skripty a zdrojový kód aplikace jsou k dispozici v hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) úložiště github.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-153">hello Wingtip SaaS scripts and application source code are available in hello [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="e5e8e-154">[Kroky toodownload hello Wingtip SaaS skripty](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-154">[Steps toodownload hello Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>


## <a name="provision-and-catalog-detailed-walkthrough"></a><span data-ttu-id="e5e8e-155">Podrobný postup zřizování a přidání tenantů do katalogu</span><span class="sxs-lookup"><span data-stu-id="e5e8e-155">Provision and catalog detailed walkthrough</span></span>

<span data-ttu-id="e5e8e-156">toounderstand jak hello Wingtip aplikace implementuje nového klienta zřizování, přidejte zarážku a krok v postupu hello při zřizování klienta:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-156">toounderstand how hello Wingtip application implements new tenant provisioning, add a breakpoint and step through hello workflow while provisioning a tenant:</span></span>

1. <span data-ttu-id="e5e8e-157">Otevřete... \\Learning moduly\\ProvisionAndCatalog\\_ukázku ProvisionAndCatalog.ps1_ a sadu hello následující parametry:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-157">Open ...\\Learning Modules\\ProvisionAndCatalog\\_Demo-ProvisionAndCatalog.ps1_ and set hello following parameters:</span></span>
   * <span data-ttu-id="e5e8e-158">**$TenantName** = hello název nové místo hello (například *Bushwillow modré*).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-158">**$TenantName** = hello name of hello new venue (for example, *Bushwillow Blues*).</span></span>
   * <span data-ttu-id="e5e8e-159">**$VenueType** = jeden z typů předem definované místo hello: *modré*, classicalmusic, tance, jazz, judo, motorracing víceúčelových, opera, rockmusic, fotbalový.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-159">**$VenueType** = one of hello pre-defined venue types: *blues*, classicalmusic, dance, jazz, judo, motorracing, multipurpose, opera, rockmusic, soccer.</span></span>
   * <span data-ttu-id="e5e8e-160">**$DemoScenario** = **1**, nastavte příliš**1** příliš*zřídit jednoho klienta*.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-160">**$DemoScenario** = **1**, Set too**1** too*Provision a single tenant*.</span></span>

1. <span data-ttu-id="e5e8e-161">Přidejte zarážku kdekoli umístěním kurzor na řádek 48, hello řádku s upozorněním: *nového klienta,*a stiskněte klávesu **F9**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-161">Add a breakpoint by putting your cursor anywhere on line 48, hello line that says: *New-Tenant \`*, and press **F9**.</span></span>

   ![přerušení](media/sql-database-saas-tutorial-provision-and-catalog/breakpoint.png)

1. <span data-ttu-id="e5e8e-163">stiskněte klávesu skriptu hello toorun **F5**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-163">toorun hello script press **F5**.</span></span>

1. <span data-ttu-id="e5e8e-164">Po spuštění skriptu hello zastaví u hello zarážky, stiskněte klávesu **F11** toostep do kódu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-164">After hello script execution stops at hello breakpoint, press **F11** toostep into hello code.</span></span>

   ![přerušení](media/sql-database-saas-tutorial-provision-and-catalog/debug.png)



<span data-ttu-id="e5e8e-166">Trasování provádění skriptu hello pomocí hello **ladění** možnosti nabídky - **F10** a **F11** toostep přes nebo do hello volat funkce.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-166">Trace hello script's execution using hello **Debug** menu options - **F10** and **F11** toostep over or into hello called functions.</span></span> <span data-ttu-id="e5e8e-167">Další informace o ladění skriptů prostředí PowerShell najdete v tématu [tipy k ladění skriptů prostředí PowerShell a práce s](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-167">For more information about debugging PowerShell scripts, see [Tips on working with and debugging PowerShell scripts](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise).</span></span>


<span data-ttu-id="e5e8e-168">Následující Hello nejsou tooexplicitly postupujte podle kroků, ale vysvětlení hello pracovního postupu, které jednotlivé kroky při ladění skriptu hello:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-168">hello following are not steps tooexplicitly follow, but an explanation of hello workflow you step through while debugging hello script:</span></span>

1. <span data-ttu-id="e5e8e-169">**Import hello SubscriptionManagement.psm1** modul, který obsahuje funkce pro přihlášení tooAzure a výběr hello pracujete s předplatným Azure.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-169">**Import hello SubscriptionManagement.psm1** module that contains functions for signing in tooAzure and selecting hello Azure subscription you are working with.</span></span>
1. <span data-ttu-id="e5e8e-170">**Import hello CatalogAndDatabaseManagement.psm1** modul, který nabízí v porovnání hello katalogu a klienta úrovni abstrakce [horizontálního oddílu správu](sql-database-elastic-scale-shard-map-management.md) funkce.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-170">**Import hello CatalogAndDatabaseManagement.psm1** module that provides a catalog and tenant-level abstraction over hello [Shard Management](sql-database-elastic-scale-shard-map-management.md) functions.</span></span> <span data-ttu-id="e5e8e-171">To je důležité modul, který zapouzdřuje většinu vzor hello katalogu a je vhodné využít.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-171">This is an important module that encapsulates much of hello catalog pattern and is worth exploring.</span></span>
1. <span data-ttu-id="e5e8e-172">**Získejte podrobnosti o konfiguraci**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-172">**Get configuration details**.</span></span> <span data-ttu-id="e5e8e-173">Krok do Get-konfigurace (s F11), abyste viděli, jak je zadána konfigurace aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-173">Step into Get-Configuration (with F11) and see how hello app config is specified.</span></span> <span data-ttu-id="e5e8e-174">Názvy prostředků a jiné hodnoty, konkrétní aplikace jsou zde definované, ale neměňte některou z těchto hodnot dokud jste se seznámili s hello skripty.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-174">Resource names and other app-specific values are defined here, but do not change any of these values until you are familiar with hello scripts.</span></span>
1. <span data-ttu-id="e5e8e-175">**Získejte objekt katalogu hello**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-175">**Get hello catalog object**.</span></span> <span data-ttu-id="e5e8e-176">Krok do Get-katalogu, která vytvoří a vrátí objekt katalog, který se používá ve skriptu hello vyšší úrovně.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-176">Step into Get-Catalog which composes and returns a catalog object that is used in hello higher-level script.</span></span>  <span data-ttu-id="e5e8e-177">Tato funkce využívá funkce správy horizontálního oddílu, které jsou importovány z **AzureShardManagement.psm1**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-177">This function uses Shard Management functions that are imported from **AzureShardManagement.psm1**.</span></span> <span data-ttu-id="e5e8e-178">objekt katalogu Hello se skládá z následujících hello:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-178">hello catalog object is composed of hello following:</span></span>
   * <span data-ttu-id="e5e8e-179">$catalogServerFullyQualifiedName je vytvořený pomocí standardní stem hello plus svoje uživatelské jméno: _katalogu -\<uživatele\>. database.windows.net_.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-179">$catalogServerFullyQualifiedName is constructed using hello standard stem plus your User name: _catalog-\<user\>.database.windows.net_.</span></span>
   * <span data-ttu-id="e5e8e-180">$catalogDatabaseName se načítají z konfigurace hello: *tenantcatalog*.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-180">$catalogDatabaseName is retrieved from hello config: *tenantcatalog*.</span></span>
   * <span data-ttu-id="e5e8e-181">objekt $shardMapManager je inicializovat z databáze katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-181">$shardMapManager object is initialized from hello catalog database.</span></span>
   * <span data-ttu-id="e5e8e-182">objekt $shardMap je inicializován ze hello *tenantcatalog* horizontálního oddílu mapy ve databáze katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-182">$shardMap object is initialized from hello *tenantcatalog* shard map in hello catalog database.</span></span>
   <span data-ttu-id="e5e8e-183">Objekt katalogu je sestavit a vrátí a použít ve skriptu hello vyšší úrovně.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-183">A catalog object is composed and returned, and used in hello higher-level script.</span></span>
1. <span data-ttu-id="e5e8e-184">**Vypočítat nový klíč klienta hello**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-184">**Calculate hello new tenant key**.</span></span> <span data-ttu-id="e5e8e-185">Funkce hash je klíč tenanta použít toocreate hello od hello název klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-185">A hash function is used toocreate hello tenant key from hello tenant name.</span></span>
1. <span data-ttu-id="e5e8e-186">**Zkontrolujte, jestli už existuje klíč tenanta hello**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-186">**Check if hello tenant key already exists**.</span></span> <span data-ttu-id="e5e8e-187">Hello katalogu se kontroluje, že je k dispozici tooensure hello klíč.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-187">hello catalog is checked tooensure hello key is available.</span></span>
1. <span data-ttu-id="e5e8e-188">**databáze klienta Hello je opatřen TenantDatabase nový.**</span><span class="sxs-lookup"><span data-stu-id="e5e8e-188">**hello tenant database is provisioned with New-TenantDatabase.**</span></span> <span data-ttu-id="e5e8e-189">Použití **F11** toostep v a v tématu Jak hello databáze je zřízený pomocí [šablony Azure Resource Manageru](../azure-resource-manager/resource-manager-template-walkthrough.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-189">Use **F11** toostep in and see how hello database is provisioned using an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md).</span></span>

<span data-ttu-id="e5e8e-190">Název databáze Hello se vytvářejí na základě hello klienta název toomake ji vymazat které horizontálního oddílu patří toowhich klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-190">hello database name is constructed from hello tenant name toomake it clear which shard belongs toowhich tenant.</span></span> <span data-ttu-id="e5e8e-191">(Další strategie pro pojmenování databáze by mohl snadno použít.) + Šablonu Resource Manager je použité toocreate databázi klienta zkopírováním zlaté databáze (baseTenantDB) na serveru katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-191">(Other strategies for database naming could easily be used.)+ A Resource Manager template is used toocreate a tenant database by copying a golden database (baseTenantDB) on hello catalog server.</span></span> <span data-ttu-id="e5e8e-192">Alternativní způsob může být toocreate prázdnou databázi a poté provést jeho inicializaci importováním souboru bacpac nebo tooexecute inicializaci skriptu z dobře známé umístění.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-192">An alternative approach could be toocreate an empty database and then initialize it by importing a bacpac, or tooexecute an initialization script from a well-known location.</span></span>  

<span data-ttu-id="e5e8e-193">šablony Resource Manageru Hello je ve složce Modules\Common\ ...\Learning hello: *tenantdatabasecopytemplate.json*</span><span class="sxs-lookup"><span data-stu-id="e5e8e-193">hello Resource Manager template is in hello …\Learning Modules\Common\ folder: *tenantdatabasecopytemplate.json*</span></span>

<span data-ttu-id="e5e8e-194">Po vytvoření databáze klienta hello je pak další **inicializovat hello místo (klient) názvem a typem místo hello**.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-194">After hello tenant database is created, it is then further **initialized with hello venue (tenant) name and hello venue type**.</span></span> <span data-ttu-id="e5e8e-195">Zde také můžete provést další inicializaci.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-195">Other initialization could also be done here.</span></span>

<span data-ttu-id="e5e8e-196">Hello **databáze klienta je zaregistrován v katalogu hello** s *přidat TenantDatabaseToCatalog* pomocí klíče tenanta hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-196">hello **tenant database is registered in hello catalog** with *Add-TenantDatabaseToCatalog* using hello tenant key.</span></span> <span data-ttu-id="e5e8e-197">Použití **F11** toostep do hello podrobnosti:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-197">Use **F11** toostep into hello details:</span></span>

* <span data-ttu-id="e5e8e-198">databáze katalogu Hello se přidá toohello horizontálního oddílu mapy (hello seznam známých databází).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-198">hello catalog database is added toohello shard map (hello list of known databases).</span></span>
* <span data-ttu-id="e5e8e-199">mapování tohoto odkazy hello hodnota klíče toohello horizontálních Hello je vytvořen.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-199">hello mapping that links hello key value toohello shard is created.</span></span>
* <span data-ttu-id="e5e8e-200">Další metadata (název místo hello) o hello klienta se přidá toohello klienty tabulky v katalogu hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-200">Additional meta data (hello venue's name) about hello tenant is added toohello Tenants table in hello catalog.</span></span>  <span data-ttu-id="e5e8e-201">Hello klientům tabulky není součástí hello ShardManagement schématu a není nainstalovaná v rámci hello EDCL.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-201">hello Tenants table is not part of hello ShardManagement schema and is not installed by hello EDCL.</span></span>  <span data-ttu-id="e5e8e-202">Tato tabulka ukazuje, jak databáze katalogu hello je možné rozšířit toosupport další data specifické pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-202">This table illustrates how hello Catalog database can be extended toosupport additional application-specific data.</span></span>   


<span data-ttu-id="e5e8e-203">Jakmile bude zřizování dokončeno, provádění vrátí toohello původní *ukázku ProvisionAndCatalog* skript, který otevře hello **události** stránku hello nového klienta v prohlížeči hello:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-203">After provisioning completes, execution returns toohello original *Demo-ProvisionAndCatalog* script, which opens hello **Events** page for hello new tenant in hello browser:</span></span>

   ![stránka events](media/sql-database-saas-tutorial-provision-and-catalog/new-tenant.png)


## <a name="provision-a-batch-of-tenants"></a><span data-ttu-id="e5e8e-205">Zřídit dávky klientů</span><span class="sxs-lookup"><span data-stu-id="e5e8e-205">Provision a batch of tenants</span></span>

<span data-ttu-id="e5e8e-206">Toto cvičení zřídí dávky 17 klientů.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-206">This exercise provisions a batch of 17 tenants.</span></span> <span data-ttu-id="e5e8e-207">Doporučuje se, že zřídit tuto dávku klienty před zahájením dalších kurzech Wingtip SaaS, je více než několik databází toowork s.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-207">It’s recommended you provision this batch of tenants before starting other Wingtip SaaS tutorials, so there's more than just a few databases toowork with.</span></span>

1. <span data-ttu-id="e5e8e-208">Otevřete... \\Learning moduly\\ProvisionAndCatalog\\*ukázku ProvisionAndCatalog.ps1* v hello *prostředí PowerShell ISE* a změňte hello *$ DemoScenario* too3 parametr:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-208">Open ...\\Learning Modules\\ProvisionAndCatalog\\*Demo-ProvisionAndCatalog.ps1* in hello *PowerShell ISE* and change hello *$DemoScenario* parameter too3:</span></span>
   * <span data-ttu-id="e5e8e-209">**$DemoScenario** = **3**, změňte příliš**3** příliš*zřídit dávky klienty*.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-209">**$DemoScenario** = **3**, change too**3** too*Provision a batch of tenants*.</span></span>
1. <span data-ttu-id="e5e8e-210">Stiskněte klávesu **F5** a spusťte skript hello.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-210">Press **F5** and run hello script.</span></span>

<span data-ttu-id="e5e8e-211">skript Hello nasadí dávky další klienty.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-211">hello script deploys a batch of additional tenants.</span></span> <span data-ttu-id="e5e8e-212">Používá [šablony Azure Resource Manageru](../azure-resource-manager/resource-manager-template-walkthrough.md) , řídí hello batch a potom deleguje zřizování každé šabloně propojené tooa databáze.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-212">It uses an [Azure Resource Manager template](../azure-resource-manager/resource-manager-template-walkthrough.md) that controls hello batch and then delegates provisioning of each database tooa linked template.</span></span> <span data-ttu-id="e5e8e-213">Pomocí šablon tímto způsobem umožňuje Azure Resource Manager toobroker hello zřizování vašeho skriptu.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-213">Using templates in this way allows Azure Resource Manager toobroker hello provisioning process for your script.</span></span> <span data-ttu-id="e5e8e-214">Šablony zřídit databáze paralelně, kde můžete a zpracovává opakování v případě potřeby optimalizace hello celkové procesů.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-214">Templates provision databases in parallel where it can, and handles retries if needed, optimizing hello overall process.</span></span> <span data-ttu-id="e5e8e-215">Hello skriptu je idempotent, pokud selže nebo zastaví z jakéhokoli důvodu potom ho spusťte znovu.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-215">hello script is idempotent so if it fails or stops for any reason, run it again.</span></span>

### <a name="verify-hello-batch-of-tenants-successfully-deployed"></a><span data-ttu-id="e5e8e-216">Ověřte dávku hello klientům byla úspěšně zavedena</span><span class="sxs-lookup"><span data-stu-id="e5e8e-216">Verify hello batch of tenants successfully deployed</span></span>

* <span data-ttu-id="e5e8e-217">Otevřete hello *tenants1* serveru procházením tooyour seznamu serverů v hello [portál Azure](https://portal.azure.com), klikněte na tlačítko **databází SQL**a zkontrolujte hello dávku 17 další databáze, jsou nyní v seznamu hello:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-217">Open hello *tenants1* server by browsing tooyour list of servers in hello [Azure portal](https://portal.azure.com), click **SQL databases**, and verify hello batch of 17 additional databases are now in hello list:</span></span>

   ![seznam databází](media/sql-database-saas-tutorial-provision-and-catalog/database-list.png)



## <a name="other-provisioning-patterns"></a><span data-ttu-id="e5e8e-219">Další způsoby zřizování</span><span class="sxs-lookup"><span data-stu-id="e5e8e-219">Other provisioning patterns</span></span>

<span data-ttu-id="e5e8e-220">K dalším způsobům zřizování, které nejsou zahrnuty do tohoto kurzu, patří:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-220">Other provisioning patterns not included in this tutorial include:</span></span>

<span data-ttu-id="e5e8e-221">**Předběžné zřizování databází.**</span><span class="sxs-lookup"><span data-stu-id="e5e8e-221">**Pre-provisioning databases.**</span></span> <span data-ttu-id="e5e8e-222">Hello předem zřizování vzor zneužije hello skutečnost, že databáze v elastickém fondu nepřidávejte zpoplatněné.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-222">hello pre-provisioning pattern exploits hello fact that databases in an elastic pool do not add extra cost.</span></span> <span data-ttu-id="e5e8e-223">Fakturuje se pro elastický fond hello, není hello databází a nečinnosti databáze využívat žádné prostředky.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-223">Billing is for hello elastic pool, not hello databases, and idle databases consume no resources.</span></span> <span data-ttu-id="e5e8e-224">Předem zřizování databází ve fondu a přidělování je podle potřeby, může výrazně snížit čas registrace klienta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-224">By pre-provisioning databases in a pool and allocating them when needed, tenant onboarding time can be reduced significantly.</span></span> <span data-ttu-id="e5e8e-225">Hello počet databází předem zřizovat může upravit podle potřeby tookeep do vyrovnávací paměti, který je vhodný pro hello očekává zřizování rychlost.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-225">hello number of databases pre-provisioned could be adjusted as needed tookeep a buffer suitable for hello anticipated provisioning rate.</span></span>

<span data-ttu-id="e5e8e-226">**Automatické zřizování.**</span><span class="sxs-lookup"><span data-stu-id="e5e8e-226">**Auto-provisioning.**</span></span> <span data-ttu-id="e5e8e-227">Ve vzoru automatické zřizování hello vyhrazené zřizování služby je použité tooprovision servery, fondy a databáze automaticky podle potřeby – včetně předem zřizování databází v elastické fondy, v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-227">In hello auto-provisioning pattern, a dedicated provisioning service is used tooprovision servers, pools, and databases automatically as needed – including pre-provisioning databases in elastic pools if desired.</span></span> <span data-ttu-id="e5e8e-228">A pokud jsou databáze zrušte uvedena do provozu a odstranit, mezery v elastické fondy může být vyplněny hello zřizování služby podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-228">And if databases are de-commissioned and deleted, gaps in elastic pools can be filled by hello provisioning service as desired.</span></span> <span data-ttu-id="e5e8e-229">Tato služba může být jednoduché nebo komplexní – například zpracování zřizování napříč několika zeměpisných oblastí a může nastavit geografická replikace automaticky pokud této strategie se používá pro zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-229">Such a service could be simple or complex – for example, handling provisioning across multiple geographies, and could set up geo-replication automatically if that strategy is being used for disaster recovery.</span></span> <span data-ttu-id="e5e8e-230">Pomocí vzoru hello automatické zřizování klientská aplikace nebo skriptu by odeslání zřizování požadavek tooa fronty toobe zpracovává hello zřizování služby a by pak dotazování hello služby toodetermine dokončení.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-230">With hello auto-provisioning pattern, a client application or script would submit a provisioning request tooa queue toobe processed by hello provisioning service, and would then poll hello service toodetermine completion.</span></span> <span data-ttu-id="e5e8e-231">Pokud se používá předem zřizování, by požadavky zpracovávány službou hello Správa zřizování nahrazení databáze spuštěné v pozadí hello rychle.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-231">If pre-provisioning is used, requests would be handled quickly with hello service managing provisioning of a replacement database running in hello background.</span></span>



## <a name="next-steps"></a><span data-ttu-id="e5e8e-232">Další kroky</span><span class="sxs-lookup"><span data-stu-id="e5e8e-232">Next steps</span></span>

<span data-ttu-id="e5e8e-233">V tomto kurzu jste se naučili:</span><span class="sxs-lookup"><span data-stu-id="e5e8e-233">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="e5e8e-234">Zřídit jednoho nového tenanta.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-234">Provision a single new tenant</span></span>
> * <span data-ttu-id="e5e8e-235">Zřídit dávku dalších tenantů.</span><span class="sxs-lookup"><span data-stu-id="e5e8e-235">Provision a batch of additional tenants</span></span>
> * <span data-ttu-id="e5e8e-236">Krokovat s vnořením hello podrobnosti o zřizování klientů a jejich registrace do katalogu hello</span><span class="sxs-lookup"><span data-stu-id="e5e8e-236">Step into hello details of provisioning tenants, and registering them into hello catalog</span></span>

<span data-ttu-id="e5e8e-237">Zkuste hello [kurzu monitorování výkonu](sql-database-saas-tutorial-performance-monitoring.md).</span><span class="sxs-lookup"><span data-stu-id="e5e8e-237">Try hello [Performance monitoring tutorial](sql-database-saas-tutorial-performance-monitoring.md).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="e5e8e-238">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="e5e8e-238">Additional Resources</span></span>

* <span data-ttu-id="e5e8e-239">Další [návodů, které stavějí hello Wingtip SaaS aplikace](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="e5e8e-239">Additional [tutorials that build upon hello Wingtip SaaS application](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="e5e8e-240">Klientská knihovna Elastic Database</span><span class="sxs-lookup"><span data-stu-id="e5e8e-240">Elastic database client library</span></span>](https://docs.microsoft.com/azure/sql-database/sql-database-elastic-database-client-library)
* [<span data-ttu-id="e5e8e-241">Jak tooDebug skriptů v systému Windows PowerShell ISE</span><span class="sxs-lookup"><span data-stu-id="e5e8e-241">How tooDebug Scripts in Windows PowerShell ISE</span></span>](https://msdn.microsoft.com/powershell/scripting/core-powershell/ise/how-to-debug-scripts-in-windows-powershell-ise)

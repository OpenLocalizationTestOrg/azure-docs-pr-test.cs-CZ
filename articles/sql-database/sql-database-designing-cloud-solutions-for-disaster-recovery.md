---
title: "Návrh službu s vysokou dostupností pomocí Azure SQL Database | Microsoft Docs"
description: "Další informace o návrhu aplikace pro používání Azure SQL Database služeb s vysokou dostupností."
keywords: "cloud zotavení po havárii, řešení zotavení po havárii, zálohování dat aplikace, geografická replikace, obchodní kontinuity plánování"
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: e8a346ac-dd08-41e7-9685-46cebca04582
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 04/21/2017
ms.author: sashan
ms.openlocfilehash: 40fe0ae04eb94322356ed19773512e3bc383639c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="designing-highly-available-services-using-azure-sql-database"></a><span data-ttu-id="c37ac-104">Navrhování služeb s vysokou dostupností pomocí Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="c37ac-104">Designing highly available services using Azure SQL Database</span></span>

<span data-ttu-id="c37ac-105">Při vytváření a nasazování služeb s vysokou dostupností v databázi SQL Azure, je použít [převzetí služeb při selhání skupiny a aktivní geografickou replikací](sql-database-geo-replication-overview.md) k poskytování odolnost proti místní chyby a závažné výpadky a povolení rychlého obnovení sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="c37ac-105">When building and deploying highly available services on Azure SQL Database, you use [failover groups and active geo-replication](sql-database-geo-replication-overview.md) to provide resilience to regional failures and catastrophic outages and enable fast recovery to the secondary databases.</span></span> <span data-ttu-id="c37ac-106">Tento článek se zaměřuje na běžných vzorů aplikace a popisuje výhody a kompromis jednotlivých možností v závislosti na požadavcích nasazení aplikace, smlouvu o úrovni služeb cílíte, provoz latenci a náklady.</span><span class="sxs-lookup"><span data-stu-id="c37ac-106">This article focuses on common application patterns and discusses the benefits and trade-offs of each option depending on the application deployment requirements, the service level agreement you are targeting, traffic latency, and costs.</span></span> <span data-ttu-id="c37ac-107">Informace o aktivní geografickou replikaci s elastické fondy najdete v tématu [strategie zotavení po havárii elastický fond](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="c37ac-107">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

## <a name="design-pattern-1-active-passive-deployment-for-cloud-disaster-recovery-with-a-co-located-database"></a><span data-ttu-id="c37ac-108">Vzor návrhu 1: nasazení aktivní – pasivní pro zotavení po havárii cloudu s společně umístěné databáze</span><span class="sxs-lookup"><span data-stu-id="c37ac-108">Design pattern 1: Active-passive deployment for cloud disaster recovery with a co-located database</span></span>
<span data-ttu-id="c37ac-109">Tato možnost je nejvhodnější pro aplikace s následujícími charakteristikami:</span><span class="sxs-lookup"><span data-stu-id="c37ac-109">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="c37ac-110">Aktivní instance v jedné oblasti Azure</span><span class="sxs-lookup"><span data-stu-id="c37ac-110">Active instance in a single Azure region</span></span>
* <span data-ttu-id="c37ac-111">Silné závislost na čtení a zápis (RW) přístup k datům</span><span class="sxs-lookup"><span data-stu-id="c37ac-111">Strong dependency on read-write (RW) access to data</span></span>
* <span data-ttu-id="c37ac-112">Není platný kvůli náklady na latenci a přenosy dat mezi oblastmi připojení mezi webovou aplikací a databáze</span><span class="sxs-lookup"><span data-stu-id="c37ac-112">Cross-region connectivity between the web application and the database is not acceptable due to latency and traffic cost</span></span>    

<span data-ttu-id="c37ac-113">Topologie nasazení aplikace v tomto případě je optimalizovaná pro zpracování místní havárie, při všechny součásti aplikace dopad musí převzetí služeb při selhání jako jednotku.</span><span class="sxs-lookup"><span data-stu-id="c37ac-113">In this case, the application deployment topology is optimized for handling regional disasters when all application components are impacted and need to failover as a unit.</span></span> <span data-ttu-id="c37ac-114">Geografická redundance aplikační logiku a databáze se replikují do jiné oblasti, ale nejsou použity pro zatížení aplikace za normálních podmínek.</span><span class="sxs-lookup"><span data-stu-id="c37ac-114">For geographic redundancy, the application logic and the database are replicated to another region but they are not used for the application workload under the normal conditions.</span></span> <span data-ttu-id="c37ac-115">Aplikace v sekundární oblasti by měl být nakonfigurována pro použití připojovacího řetězce SQL do sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="c37ac-115">The application in the secondary region should be configured to use a SQL connection string to the secondary database.</span></span> <span data-ttu-id="c37ac-116">Správce provozu je nastavit tak, aby použít [metody směrování převzetí služeb při selhání](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span><span class="sxs-lookup"><span data-stu-id="c37ac-116">Traffic manager is set up to use [failover routing method](../traffic-manager/traffic-manager-configure-failover-routing-method.md).</span></span>  

> [!NOTE]
> <span data-ttu-id="c37ac-117">[Azure traffic Manageru](../traffic-manager/traffic-manager-overview.md) se používá v tomto článku obrázek pouze pro účely.</span><span class="sxs-lookup"><span data-stu-id="c37ac-117">[Azure traffic manager](../traffic-manager/traffic-manager-overview.md) is used throughout this article for illustration purposes only.</span></span> <span data-ttu-id="c37ac-118">Můžete použít jakéhokoli řešení vyrovnávání zatížení, které podporuje metodu směrování převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-118">You can use any load-balancing solution that supports failover routing method.</span></span>    
>

<span data-ttu-id="c37ac-119">Následující diagram znázorňuje tuto konfiguraci před výpadku.</span><span class="sxs-lookup"><span data-stu-id="c37ac-119">The following diagram shows this configuration before an outage.</span></span>

![Konfigurace geografická replikace databáze SQL.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-1.png)

<span data-ttu-id="c37ac-122">Po výpadku v primární oblasti služba SQL Database zjistí, že primární databáze není dostupný a spustit převzetí služeb při selhání pro sekundární databázi založenou na parametrech zásad automatické převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-122">After an outage in the primary region, the SQL Database service detects that the primary database is not accessible and trigger a failover to the secondary database based on the parameters of the automatic failover policy.</span></span> <span data-ttu-id="c37ac-123">V závislosti na vaší smlouvě SLA aplikace můžete rozhodnout nakonfigurovat období odkladu mezi detekce se výpadek a převzetí služeb při selhání, sám sebe.</span><span class="sxs-lookup"><span data-stu-id="c37ac-123">Depending on your application SLA, you can decide to configure a grace period between the detection of the outage and the failover itself.</span></span> <span data-ttu-id="c37ac-124">Konfigurace období odkladu snižuje riziko ztráty dat pro případy, kdy se výpadek je závažné a dostupnosti v oblasti není možné obnovit rychle.</span><span class="sxs-lookup"><span data-stu-id="c37ac-124">Configuring a grace period reduces the risk of data loss to the cases where the outage is catastrophic and availability in the region cannot be quickly restored.</span></span> <span data-ttu-id="c37ac-125">Pokud převzetí služeb při selhání koncový bod je inicializován nástrojem traffic Manageru před převzetí služeb při selhání skupina aktivuje převzetí služeb při selhání databáze, webová aplikace není možné se připojit k databázi.</span><span class="sxs-lookup"><span data-stu-id="c37ac-125">If the endpoint failover is initiated by the traffic manager before the failover group triggers the failover of the database, the web application is not able to reconnect to the database.</span></span> <span data-ttu-id="c37ac-126">Aplikace zopakovat pokus o připojení automaticky úspěšné ihned po dokončení převzetí služeb při selhání databázi.</span><span class="sxs-lookup"><span data-stu-id="c37ac-126">The application’s attempt to reconnect automatically succeeds as soon as the database failover completes.</span></span> 

> [!NOTE]
> <span data-ttu-id="c37ac-127">K dosažení plně koordinované převzetí služeb při selhání aplikace a databáze, doporučujeme navrhnout vlastní metoda monitorování a použít ruční převzetí služeb při selhání koncových bodů webové aplikace a databáze.</span><span class="sxs-lookup"><span data-stu-id="c37ac-127">To achieve fully coordinated failover of the application and the databases, you should devise your own monitoring method and use manual failover of the web application endpoints and the databases.</span></span>
>

<span data-ttu-id="c37ac-128">Po dokončení převzetí služeb při selhání koncových bodů aplikace a databáze, aplikace bude znovu spusťte zpracování žádostí uživatele v oblasti B a zůstane společně umístěné s databází, protože primární databáze je nyní v oblasti B. Tento scénář je znázorněn v následujícím diagramu.</span><span class="sxs-lookup"><span data-stu-id="c37ac-128">After the failover of both the application’s endpoints and the database completes, the application will re-start processing the user requests in the region B and will remain co-located with the database because the primary database is now in region B. This scenario is illustrated in the following diagram.</span></span> <span data-ttu-id="c37ac-129">Ve všech diagramech plné čáry znamenat aktivních připojení, tečkovaná čáry označují pozastavenou připojení a zastavení přihlásí znamenat akce aktivační události.</span><span class="sxs-lookup"><span data-stu-id="c37ac-129">In all diagrams, solid lines indicate active connections, dotted lines indicate suspended connections, and stop signs indicate action triggers.</span></span>

![Geografická replikace: Převzetí služeb při selhání do sekundární databáze.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-2.png)

<span data-ttu-id="c37ac-132">V případě výpadku v sekundární oblasti odkaz replikace mezi primární a sekundární databáze je pozastavená, ale převzetí služeb při selhání není aktivována, protože není ovlivněná primární databáze.</span><span class="sxs-lookup"><span data-stu-id="c37ac-132">If an outage happens in the secondary region, the replication link between the primary and the secondary database is suspended but the failover is not triggered because the primary database is not impacted.</span></span> <span data-ttu-id="c37ac-133">Dostupnost aplikace není v tomto případě změnila, ale aplikace funguje zveřejněné a proto vyšší riziko v případě obou oblastí nezdaří za sebou.</span><span class="sxs-lookup"><span data-stu-id="c37ac-133">The application's availability is not changed in this case, but the application operates exposed and therefore at higher risk in case both regions fail in succession.</span></span>

> [!NOTE]
> <span data-ttu-id="c37ac-134">Pro zotavení po havárii doporučujeme konfigurace nasazení aplikace na omezenou dvou oblastí.</span><span class="sxs-lookup"><span data-stu-id="c37ac-134">For disaster recovery we recommend the configuration with application deployment limited to two regions.</span></span> <span data-ttu-id="c37ac-135">Je to proto, že většina Azure zeměpisných má jenom dvě oblasti.</span><span class="sxs-lookup"><span data-stu-id="c37ac-135">This is because most of the Azure geographies have only two regions.</span></span> <span data-ttu-id="c37ac-136">Tato konfigurace nebude chránit vaše aplikace v případě selhání souběžných závažné obou oblastí.</span><span class="sxs-lookup"><span data-stu-id="c37ac-136">This configuration will not protect your application from a simultaneous catastrophic failure of both regions.</span></span>  <span data-ttu-id="c37ac-137">V nepravděpodobnému takové selhání, můžete obnovit vaše databáze v třetí oblast pomocí [geografické obnovení operace](sql-database-disaster-recovery.md#recover-using-geo-restore).</span><span class="sxs-lookup"><span data-stu-id="c37ac-137">In an unlikely event of such a failure, you can recover your databases in a third region using [geo-restore operation](sql-database-disaster-recovery.md#recover-using-geo-restore).</span></span>
>

<span data-ttu-id="c37ac-138">Jakmile se výpadek zmírnit, sekundární databázi se automaticky znovu synchronizovat s primárním serverem.</span><span class="sxs-lookup"><span data-stu-id="c37ac-138">Once the outage is mitigated, the secondary database will automatically re-synchronize with the primary.</span></span> <span data-ttu-id="c37ac-139">Během synchronizace z hlavních může mít mírně dopad na výkon v závislosti na množství dat, který je potřeba synchronizovat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-139">During synchronization, performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="c37ac-140">Následující diagram znázorňuje výpadku v sekundární oblasti.</span><span class="sxs-lookup"><span data-stu-id="c37ac-140">The following diagram illustrates an outage in the secondary region.</span></span>

![Sekundární databáze synchronizována s primární.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern1-3.png)

<span data-ttu-id="c37ac-143">Klíč **výhody** tohoto vzoru návrhu jsou:</span><span class="sxs-lookup"><span data-stu-id="c37ac-143">The key **advantages** of this design pattern are:</span></span>

* <span data-ttu-id="c37ac-144">Stejné webové aplikace je nasazený na obou oblastí bez jakékoli konfigurace specifické pro oblast a žádná další logiku reagování převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-144">The same web application is deployed to both regions without any region-specific configuration and no additional logic to react to the failover.</span></span> 
* <span data-ttu-id="c37ac-145">Výkon aplikace nebude ovlivněné převzetí služeb při selhání jako webové aplikace a databáze jsou vždy společně umístěné.</span><span class="sxs-lookup"><span data-stu-id="c37ac-145">The application's performance is not impacted by failover as the web application and the database are always co-located.</span></span>

<span data-ttu-id="c37ac-146">Hlavní **kompromis** je, že instance redundantní aplikace v sekundární oblast se používá pouze pro zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="c37ac-146">The main **tradeoff** is that the redundant application instance in the secondary region is only used for disaster recovery.</span></span>

## <a name="design-pattern-2-active-active-deployment-for-application-load-balancing"></a><span data-ttu-id="c37ac-147">Vzor návrhu 2: nasazení aktivní aktivní pro vyrovnávání zatížení aplikace</span><span class="sxs-lookup"><span data-stu-id="c37ac-147">Design pattern 2: Active-active deployment for application load balancing</span></span>
<span data-ttu-id="c37ac-148">Tato možnost obnovení po havárii cloudu je nejvhodnější pro aplikace s následujícími charakteristikami:</span><span class="sxs-lookup"><span data-stu-id="c37ac-148">This cloud disaster recovery option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="c37ac-149">Vysoký poměr čtení databáze na zápisů</span><span class="sxs-lookup"><span data-stu-id="c37ac-149">High ratio of database reads to writes</span></span>
* <span data-ttu-id="c37ac-150">Databáze latence čtení je pro činnost koncového uživatele větší význam než latence zápisu</span><span class="sxs-lookup"><span data-stu-id="c37ac-150">Database read latency is more critical for the end-user experience than the write latency</span></span> 
* <span data-ttu-id="c37ac-151">Jen pro čtení logiky je možné oddělit z logiku pro čtení a zápis pomocí různých připojovací řetězec</span><span class="sxs-lookup"><span data-stu-id="c37ac-151">Read-only logic can be separated from read-write logic by using a different connection string</span></span>
* <span data-ttu-id="c37ac-152">Jen pro čtení logiku nezávisí na plně synchronizován pomocí nejnovější aktualizace dat</span><span class="sxs-lookup"><span data-stu-id="c37ac-152">Read-only logic does not depend on data being fully synchronized with the latest updates</span></span>  

<span data-ttu-id="c37ac-153">Pokud vaše aplikace tyto charakteristiky, Vyrovnávání zatížení připojení koncových uživatelů napříč více instancí aplikace v různých oblastech podstatně zlepšit celkové činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="c37ac-153">If your applications have these characteristics, load balancing the end-user connections across multiple application instances in different regions can substantially improve the overall end-user experience.</span></span> <span data-ttu-id="c37ac-154">Dva z oblastí měl by být vybrán jako dvojice zotavení po Havárii a převzetí služeb při selhání skupiny by měla obsahovat databáze v těchto oblastech.</span><span class="sxs-lookup"><span data-stu-id="c37ac-154">Two of the regions should be selected as the DR pair and the failover group should include the databases in these regions.</span></span> <span data-ttu-id="c37ac-155">Každá oblast implementovat, Vyrovnávání zatížení, musí mít aktivní instance aplikace s logiku pro čtení a zápis (RW) připojení ke koncovému bodu naslouchací proces pro čtení a zápis skupiny převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-155">To implement load-balancing, each region should have an active instance of the application with the read-write (RW) logic connected to the read-write listener endpoint of the failover group.</span></span> <span data-ttu-id="c37ac-156">Bude zaručit, že převzetí služeb při selhání bude automaticky v případě primární databáze je ovlivní případný výpadek.</span><span class="sxs-lookup"><span data-stu-id="c37ac-156">It will guarantee that the failover will be automatically initiated if the primary database is impacted by an outage.</span></span> <span data-ttu-id="c37ac-157">Jen pro čtení logiku (RO) ve webové aplikaci připojovat přímo k databázi v této oblasti.</span><span class="sxs-lookup"><span data-stu-id="c37ac-157">The read-only logic (RO) in the web application should connect directly to the database in that region.</span></span> <span data-ttu-id="c37ac-158">Správce provozu by měly být nastavené používat [směrování výkonu](../traffic-manager/traffic-manager-configure-performance-routing-method.md) s [koncový bod monitorování](../traffic-manager/traffic-manager-monitoring.md) povolená pro každou instanci aplikace.</span><span class="sxs-lookup"><span data-stu-id="c37ac-158">Traffic manager should be set up to use [performance routing](../traffic-manager/traffic-manager-configure-performance-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for each application instance.</span></span>

<span data-ttu-id="c37ac-159">Jako vzor #1 musíte zvážit nasazení podobné monitorování aplikací.</span><span class="sxs-lookup"><span data-stu-id="c37ac-159">As in pattern #1, you should consider deploying a similar monitoring application.</span></span> <span data-ttu-id="c37ac-160">Ale na rozdíl od vzoru #1 monitorování aplikace nebude zodpovědná za aktivaci převzetí služeb při selhání koncový bod.</span><span class="sxs-lookup"><span data-stu-id="c37ac-160">But unlike pattern #1, the monitoring application will not be responsible for triggering the end-point failover.</span></span>

> [!NOTE]
> <span data-ttu-id="c37ac-161">Tento vzor používá více než jedné sekundární databáze, pouze sekundární v oblasti B se použije pro převzetí služeb při selhání a musí být součástí skupiny převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-161">While this pattern uses more than one secondary database, only the secondary in Region B  would be used for failover and should be part of the failover group.</span></span>
>

<span data-ttu-id="c37ac-162">Správce provozu musí být nakonfigurovaný pro výkon směrování pro přímé připojení uživatele do instance aplikace na nejbližší geografické umístění uživatele.</span><span class="sxs-lookup"><span data-stu-id="c37ac-162">Traffic manager should be configured for performance routing to direct the user connections to the application instance closest to the user's geographic location.</span></span> <span data-ttu-id="c37ac-163">Následující obrázek znázorňuje tuto konfiguraci před výpadku.</span><span class="sxs-lookup"><span data-stu-id="c37ac-163">The following diagram illustrates this configuration before an outage.</span></span>

![Žádný výpadek: výkonu směrování nejbližší aplikace.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-1.png)

<span data-ttu-id="c37ac-166">Pokud v oblasti A je zjištěn výpadek databáze, převzetí služeb při selhání skupiny automaticky zahájit převzetí služeb při selhání primární databáze v oblasti A sekundární v oblasti B. Je také automaticky aktualizuje koncový bod naslouchací proces pro čtení a zápis do oblasti B tak připojení pro čtení a zápis ve webové aplikaci nebude mít vliv na.</span><span class="sxs-lookup"><span data-stu-id="c37ac-166">If a database outage is detected in the region A, the failover group will automatically initiate failover of the primary database in region A to the secondary in region B. It will also automatically update the read-write listener endpoint to region B so read-write connections in the web application will not be impacted.</span></span> <span data-ttu-id="c37ac-167">Správce provozu vyloučí offline koncový bod do směrovací tabulky, ale bude pokračovat směrování provozu koncového uživatele na zbývající online instance.</span><span class="sxs-lookup"><span data-stu-id="c37ac-167">The traffic manager will exclude the offline end-point from the routing table but will continue routing the end-user traffic to the remaining online instances.</span></span> <span data-ttu-id="c37ac-168">Připojovací řetězce SQL jen pro čtení nebude mít vliv na jako vždy ukazovaly na databázi ve stejné oblasti.</span><span class="sxs-lookup"><span data-stu-id="c37ac-168">The read-only SQL connection strings will not be impacted as they always point to the database in the same region.</span></span> 

<span data-ttu-id="c37ac-169">Následující diagram znázorňuje novou konfiguraci po převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-169">The following diagram illustrates the new configuration after the failover.</span></span>

![Konfigurace po převzetí služeb při selhání.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-2.png)

<span data-ttu-id="c37ac-172">V případě výpadku v jednom z sekundární oblasti traffic Manageru se automaticky odeberou offline koncový bod v této oblasti ze směrovací tabulky.</span><span class="sxs-lookup"><span data-stu-id="c37ac-172">In case of an outage in one of the secondary regions, the traffic manager will automatically remove the offline end-point in that region from the routing table.</span></span> <span data-ttu-id="c37ac-173">Kanál replikace do sekundární databáze v této oblasti bude pozastaveno.</span><span class="sxs-lookup"><span data-stu-id="c37ac-173">The replication channel to the secondary database in that region will be suspended.</span></span> <span data-ttu-id="c37ac-174">Protože zbývající oblasti získat další uživatelské provoz v tomto scénáři, aplikace bude mít dopad na výkon při se výpadek.</span><span class="sxs-lookup"><span data-stu-id="c37ac-174">Because the remaining regions get additional user traffic in this scenario, the application's performance will be impacted during the outage.</span></span> <span data-ttu-id="c37ac-175">Jakmile se výpadek zmírnit, budou se sekundární databáze v oblasti ovlivněné okamžitě synchronizovat s primární.</span><span class="sxs-lookup"><span data-stu-id="c37ac-175">Once the outage is mitigated, the secondary database in the impacted region will be immediately synchronized with the primary.</span></span> <span data-ttu-id="c37ac-176">Během synchronizace z hlavních může mít mírně dopad na výkon v závislosti na množství dat, který je potřeba synchronizovat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-176">During the synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span> <span data-ttu-id="c37ac-177">Následující diagram znázorňuje výpadku v oblasti B.</span><span class="sxs-lookup"><span data-stu-id="c37ac-177">The following diagram illustrates an outage in region B.</span></span>

![Výpadek v sekundární oblasti.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern2-3.png)

<span data-ttu-id="c37ac-180">Klíč **využít** tohoto návrhu vzor je napříč více sekundární databáze k dosažení koncového uživatele optimální výkon, je možné škálovat zatížení aplikace.</span><span class="sxs-lookup"><span data-stu-id="c37ac-180">The key **advantage** of this design pattern is that you can scale the application workload across multiple secondaries to achieve the optimal end-user performance.</span></span> <span data-ttu-id="c37ac-181">**Kompromisy** této možnosti jsou:</span><span class="sxs-lookup"><span data-stu-id="c37ac-181">The **tradeoffs** of this option are:</span></span>

* <span data-ttu-id="c37ac-182">Čtení a zápis připojení mezi instancemi aplikace a databáze mají různou latenci a náklady</span><span class="sxs-lookup"><span data-stu-id="c37ac-182">Read-write connections between the application instances and database have varying latency and cost</span></span>
* <span data-ttu-id="c37ac-183">Výkon aplikace je ovlivněná během se výpadek</span><span class="sxs-lookup"><span data-stu-id="c37ac-183">Application performance is impacted during the outage</span></span>

> [!NOTE]
> <span data-ttu-id="c37ac-184">Podobný postup lze použít k přesměrování zpracování úloh specializované úlohy, jako je například vytváření sestav úlohy, nástroje business intelligence nebo zálohování.</span><span class="sxs-lookup"><span data-stu-id="c37ac-184">A similar approach can be used to offload specialized workloads such as reporting jobs, business intelligence tools, or backups.</span></span> <span data-ttu-id="c37ac-185">Obvykle se tyto úlohy spotřebovávat prostředky významné databáze proto se doporučuje, že určíte jednu sekundární databáze pro ně s úrovní výkonu a očekávané zatížení.</span><span class="sxs-lookup"><span data-stu-id="c37ac-185">Typically, these workloads consume significant database resources therefore it is recommended that you designate one of the secondary databases for them with the performance level matched to the anticipated workload.</span></span>
>

## <a name="design-pattern-3-active-passive-deployment-for-data-preservation"></a><span data-ttu-id="c37ac-186">Vzor návrhu 3: nasazení aktivní – pasivní pro uchovávání dat</span><span class="sxs-lookup"><span data-stu-id="c37ac-186">Design pattern 3: Active-passive deployment for data preservation</span></span>
<span data-ttu-id="c37ac-187">Tato možnost je nejvhodnější pro aplikace s následujícími charakteristikami:</span><span class="sxs-lookup"><span data-stu-id="c37ac-187">This option is best suited for applications with the following characteristics:</span></span>

* <span data-ttu-id="c37ac-188">Jakoukoli ztrátu dat, je vysoký obchodní riziko.</span><span class="sxs-lookup"><span data-stu-id="c37ac-188">Any data loss is high business risk.</span></span> <span data-ttu-id="c37ac-189">Převzetí služeb při selhání databázi můžete použít jako poslední možnost jen v případě, že je závažné se výpadek.</span><span class="sxs-lookup"><span data-stu-id="c37ac-189">The database failover can only be used as a last resort if the outage is catastrophic.</span></span>
* <span data-ttu-id="c37ac-190">Aplikace podporuje jen pro čtení a čtení a zápis režimy operací a můžou fungovat v "režimu jen pro čtení" pro určitou dobu.</span><span class="sxs-lookup"><span data-stu-id="c37ac-190">The application supports read-only and read-write modes of operations and can operate in "read-only mode" for a period of time.</span></span>

<span data-ttu-id="c37ac-191">V tomto vzoru přepínačů aplikace do režimu jen pro čtení, když dochází k chybám časového limitu připojení pro čtení a zápis.</span><span class="sxs-lookup"><span data-stu-id="c37ac-191">In this pattern, the application switches to read-only mode when the read-write connections start getting time-out errors.</span></span> <span data-ttu-id="c37ac-192">Webová aplikace je nasazen na obou oblastí a jsou připojení ke koncovému bodu naslouchací proces pro čtení a zápis a jiné připojení ke koncovému bodu naslouchací proces jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="c37ac-192">The Web Application is deployed to both regions and include a connection to the read-write listener endpoint and different connection to the read-only listener endpoint.</span></span> <span data-ttu-id="c37ac-193">Traffic manager by měly být nastavené používat [směrování převzetí služeb při selhání](../traffic-manager/traffic-manager-configure-failover-routing-method.md) s [koncový bod monitorování](../traffic-manager/traffic-manager-monitoring.md) povolené pro koncový bod aplikace v každé oblasti.</span><span class="sxs-lookup"><span data-stu-id="c37ac-193">The Traffic manager should be set up to use [failover routing](../traffic-manager/traffic-manager-configure-failover-routing-method.md) with [end-point monitoring](../traffic-manager/traffic-manager-monitoring.md) enabled for the application endpoint in each region.</span></span>

<span data-ttu-id="c37ac-194">Následující obrázek znázorňuje tuto konfiguraci před výpadku.</span><span class="sxs-lookup"><span data-stu-id="c37ac-194">The following diagram illustrates this configuration before an outage.</span></span>

![Aktivní – pasivní nasazení před převzetí služeb při selhání.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-1.png)

<span data-ttu-id="c37ac-197">Když správce provozu zjistí selhání připojení oblasti A, automaticky přepíná provozu generovaného uživateli na instanci aplikace v oblasti B. Pomocí tohoto vzoru je důležité nastavit období odkladu ztráty dat. dostatečně vysokou hodnotu, například 24 hodin.</span><span class="sxs-lookup"><span data-stu-id="c37ac-197">When the traffic manager detects a connectivity failure to region A, it automatically switches user traffic to the application instance in region B. With this pattern, it is important that you set the grace period with data loss to a sufficiently high value, e.g. 24 hours.</span></span> <span data-ttu-id="c37ac-198">Zajistí, aby ztrátě dat se vyloučilo, pokud se výpadek zmírnit v této době.</span><span class="sxs-lookup"><span data-stu-id="c37ac-198">It will ensure that data loss is prevented if the outage is mitigated within that time.</span></span> <span data-ttu-id="c37ac-199">Když je aktivován webové aplikace v oblasti B se spustí operace čtení a zápis selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-199">When the Web application in the region B is activated the read-write operations will start failing.</span></span> <span data-ttu-id="c37ac-200">V tomto okamžiku by měl přepnout do režimu jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="c37ac-200">At that point, it should switch to the read-only mode.</span></span> <span data-ttu-id="c37ac-201">V tomto režimu budou automaticky směrované požadavky na sekundární databázi.</span><span class="sxs-lookup"><span data-stu-id="c37ac-201">In this mode the requests will be automatically routed to the secondary database.</span></span> <span data-ttu-id="c37ac-202">V případě závažného selhání nebude se výpadek omezeny během poskytnuté lhůty a převzetí služeb při selhání skupiny se aktivuje převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="c37ac-202">In the case of a catastrophic failure the outage will not be mitigated within the grace period and the failover group will trigger the failover.</span></span> <span data-ttu-id="c37ac-203">Po který naslouchací proces pro čtení a zápis bude k dispozici a volání k němu zastaví se nedaří.</span><span class="sxs-lookup"><span data-stu-id="c37ac-203">After that the read-write listener will become available and the calls to it will stop failing.</span></span> <span data-ttu-id="c37ac-204">Tento koncept je znázorněn podle následující diagram.</span><span class="sxs-lookup"><span data-stu-id="c37ac-204">This is illustrated by the following diagram.</span></span>

![Výpadek: Aplikace v režimu jen pro čtení.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-2.png)

<span data-ttu-id="c37ac-207">Pokud se výpadek v primární oblasti zmírnit během poskytnuté lhůty, traffic Manageru zjistí obnovení připojení v primární oblasti a přepíná provozu generovaného uživateli zpět do instance aplikace v oblasti A. Tuto instanci aplikace obnoví a funguje v režimu pro čtení a zápis v databázi primární oblasti A.</span><span class="sxs-lookup"><span data-stu-id="c37ac-207">If the outage in the primary region is mitigated within the grace period, traffic manager detects the restoration of connectivity in the primary region and switches user traffic back to the application instance in region A. That application instance resumes and operates in read-write mode using the primary database in region A.</span></span>

<span data-ttu-id="c37ac-208">V případě výpadku v oblasti B traffic Manageru zjistí selhání koncový bod aplikace v oblasti B a převzetí služeb při selhání naslouchací proces skupiny přepínačů jen pro čtení a oblasti A. Tímto výpadkem nemá negativní vliv na prostředí pro koncové uživatele, ale primární databáze se zveřejní během se výpadek.</span><span class="sxs-lookup"><span data-stu-id="c37ac-208">In case of an outage in the region B, the traffic manager detects the failure of the application end-point in region B and the failover group switches the read-only listener to region A. This outage does not impact the end-user experience but the primary database will be exposed during the outage.</span></span> <span data-ttu-id="c37ac-209">Tento koncept je znázorněn podle následující diagram.</span><span class="sxs-lookup"><span data-stu-id="c37ac-209">This is illustrated by the following diagram.</span></span>

![Výpadek: Sekundární databáze.](./media/sql-database-designing-cloud-solutions-for-disaster-recovery/pattern3-3.png)

<span data-ttu-id="c37ac-212">Jakmile se výpadek zmírnit, sekundární databáze je okamžitě synchronizovány s primárním serverem a je jen pro čtení naslouchací proces přepnout zpět do sekundární databáze v oblasti B. Během synchronizace z hlavních může mít mírně dopad na výkon v závislosti na množství dat, který je potřeba synchronizovat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-212">Once the outage is mitigated, the secondary database is immediately synchronized with the primary and the read-only listener is switched back to the secondary database in region B. During synchronization performance of the primary could be slightly impacted depending on the amount of data that needs to be synchronized.</span></span>

<span data-ttu-id="c37ac-213">Tento vzor návrhu má několik **výhody**:</span><span class="sxs-lookup"><span data-stu-id="c37ac-213">This design pattern has several **advantages**:</span></span>

* <span data-ttu-id="c37ac-214">Ní nedochází ke ztrátě dat při dočasných výpadků.</span><span class="sxs-lookup"><span data-stu-id="c37ac-214">It avoids data loss during the temporary outages.</span></span>
* <span data-ttu-id="c37ac-215">Výpadek závisí pouze na tom, jak rychle traffic Manageru zjistí chybu připojení, které je možné konfigurovat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-215">Downtime depends only on how quickly traffic manager detects the connectivity failure, which is configurable.</span></span>

<span data-ttu-id="c37ac-216">**Kompromis** je:</span><span class="sxs-lookup"><span data-stu-id="c37ac-216">The **tradeoff** is:</span></span>

* <span data-ttu-id="c37ac-217">Aplikace musí být schopen fungují v režimu jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="c37ac-217">Application must be able to operate in read-only mode.</span></span>

> [!NOTE]
> <span data-ttu-id="c37ac-218">V případě výpadku trvalé služeb v oblasti ručně aktivovat převzetí služeb při selhání databáze a přijměte ztrátou dat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-218">In case of a permanent service outage in the region, you manually activate database failover and accept the data loss.</span></span> <span data-ttu-id="c37ac-219">Aplikace bude funkční v sekundární oblasti s přístupem pro čtení a zápis do databáze.</span><span class="sxs-lookup"><span data-stu-id="c37ac-219">The application will be functional in the secondary region with read-write access to the database.</span></span>
>

## <a name="business-continuity-planning-choose-an-application-design-for-cloud-disaster-recovery"></a><span data-ttu-id="c37ac-220">Plánování kontinuity obchodních: Zvolte návrh aplikace pro zotavení po havárii cloudu</span><span class="sxs-lookup"><span data-stu-id="c37ac-220">Business continuity planning: Choose an application design for cloud disaster recovery</span></span>
<span data-ttu-id="c37ac-221">Strategie zotavení po havárii konkrétní cloudové můžete kombinovat nebo rozšířit tyto vzory návrhu na nejlépe vyhovovat potřebám vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="c37ac-221">Your specific cloud disaster recovery strategy can combine or extend these design patterns to best meet the needs of your application.</span></span>  <span data-ttu-id="c37ac-222">Jak už bylo zmíněno dříve, strategie, kterou zvolíte je založena na smlouvě SLA můžete chtít nabízet zákazníkům a topologii nasazení aplikace.</span><span class="sxs-lookup"><span data-stu-id="c37ac-222">As mentioned earlier, the strategy you choose is based on the SLA you want to offer to your customers and the application deployment topology.</span></span> <span data-ttu-id="c37ac-223">Seznamů vaše rozhodnutí, následující tabulka porovnává možnosti založené na odhadované únikem nebo obnovení bodu cíl (RPO) a odhadovaná doba obnovení (Vložit).</span><span class="sxs-lookup"><span data-stu-id="c37ac-223">To help guide your decision, the following table compares the choices based on the estimated data loss or recovery point objective (RPO) and estimated recovery time (ERT).</span></span>

| <span data-ttu-id="c37ac-224">vzor</span><span class="sxs-lookup"><span data-stu-id="c37ac-224">Pattern</span></span> | <span data-ttu-id="c37ac-225">PLÁNOVANÝ BOD OBNOVENÍ</span><span class="sxs-lookup"><span data-stu-id="c37ac-225">RPO</span></span> | <span data-ttu-id="c37ac-226">VLOŽIT</span><span class="sxs-lookup"><span data-stu-id="c37ac-226">ERT</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="c37ac-227">Aktivní – pasivní nasazení pro zotavení po havárii s přístupem společně umístěné databáze</span><span class="sxs-lookup"><span data-stu-id="c37ac-227">Active-passive deployment for disaster recovery with co-located database access</span></span> |<span data-ttu-id="c37ac-228">Přístup pro čtení a zápis < 5 s</span><span class="sxs-lookup"><span data-stu-id="c37ac-228">Read-write access < 5 sec</span></span> |<span data-ttu-id="c37ac-229">Čas detekce selhání + TTL pro DNS</span><span class="sxs-lookup"><span data-stu-id="c37ac-229">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="c37ac-230">Aktivní aktivní nasazení pro aplikaci služby Vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="c37ac-230">Active-active deployment for application load balancing</span></span> |<span data-ttu-id="c37ac-231">Přístup pro čtení a zápis < 5 s</span><span class="sxs-lookup"><span data-stu-id="c37ac-231">Read-write access < 5 sec</span></span> |<span data-ttu-id="c37ac-232">Čas detekce selhání + TTL pro DNS</span><span class="sxs-lookup"><span data-stu-id="c37ac-232">Failure detection time + DNS TTL</span></span> |
| <span data-ttu-id="c37ac-233">Aktivní – pasivní nasazení pro uchovávání dat</span><span class="sxs-lookup"><span data-stu-id="c37ac-233">Active-passive deployment for data preservation</span></span> |<span data-ttu-id="c37ac-234">Jen pro čtení. < 5 s</span><span class="sxs-lookup"><span data-stu-id="c37ac-234">Read-only access < 5 sec</span></span> | <span data-ttu-id="c37ac-235">Jen pro čtení = 0</span><span class="sxs-lookup"><span data-stu-id="c37ac-235">Read-only access = 0</span></span> |
||<span data-ttu-id="c37ac-236">Přístup pro čtení a zápis = nula.</span><span class="sxs-lookup"><span data-stu-id="c37ac-236">Read-write access = zero</span></span> | <span data-ttu-id="c37ac-237">Přístup pro čtení a zápis = čas detekce selhání + období odkladu ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="c37ac-237">Read-write access = Failure detection time + grace period with data loss</span></span> |
|||

## <a name="next-steps"></a><span data-ttu-id="c37ac-238">Další kroky</span><span class="sxs-lookup"><span data-stu-id="c37ac-238">Next steps</span></span>
* <span data-ttu-id="c37ac-239">Další informace o Azure SQL Database automatizované zálohování najdete v tématu [automatizované zálohování SQL Database](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="c37ac-239">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="c37ac-240">Přehled kontinuity obchodních a scénářů najdete v tématu [obchodní kontinuity přehled](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="c37ac-240">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="c37ac-241">Další informace o použití automatizované zálohování pro obnovení, najdete v části [obnovit databázi ze zálohy spouštěná služba](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="c37ac-241">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>
* <span data-ttu-id="c37ac-242">Další informace o možnosti rychlejší obnovení najdete v tématu [aktivní geografickou replikaci](sql-database-geo-replication-overview.md)</span><span class="sxs-lookup"><span data-stu-id="c37ac-242">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md)</span></span>  
* <span data-ttu-id="c37ac-243">Další informace o použití automatizované zálohování pro archivaci, najdete v části [kopírování databáze](sql-database-copy.md)</span><span class="sxs-lookup"><span data-stu-id="c37ac-243">To learn about using automated backups for archiving, see [database copy](sql-database-copy.md)</span></span>
* <span data-ttu-id="c37ac-244">Informace o aktivní geografickou replikaci s elastické fondy najdete v tématu [strategie zotavení po havárii elastický fond](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="c37ac-244">For information about active geo-replication with Elastic Pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>

---
title: "Vrácení upgradu aplikace – Azure SQL Database | Microsoft Docs"
description: "Další informace o použití geografická replikace databáze SQL Azure pro podporu online upgrady cloudových aplikací."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 4b59c8aa3dea3e8fba692ab66420295a09210d3b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="1b5ca-103">Správa postupné upgrady cloudových aplikací pomocí SQL Database aktivní geografickou replikaci</span><span class="sxs-lookup"><span data-stu-id="1b5ca-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="1b5ca-104">[Aktivní geografickou replikací](sql-database-geo-replication-overview.md) je nyní k dispozici pro všechny databáze na všech úrovních.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="1b5ca-105">Další informace o použití [geografická replikace](sql-database-geo-replication-overview.md) v databázi SQL za účelem povolení postupné upgrady cloudových aplikací.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-105">Learn how to use [geo-replication](sql-database-geo-replication-overview.md) in SQL Database to enable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="1b5ca-106">Protože upgrade je rušivý operace, je nutné součást vaší firmy kontinuity plánování a návrhu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="1b5ca-107">V tomto článku jsme podívejte se na dvou různých metod Orchestrace procesu upgradu a popisují výhody a kompromis jednotlivých možností.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-107">In this article we look at two different methods of orchestrating the upgrade process, and discuss the benefits and trade-offs of each option.</span></span> <span data-ttu-id="1b5ca-108">Pro účely tohoto článku použijeme jednoduchou aplikaci, která se skládá z webu připojené k jedné databáze jako jeho datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-108">For the purposes of this article we will use a simple application that consists of a web site connected to a single database as its data tier.</span></span> <span data-ttu-id="1b5ca-109">Naším cílem je pro upgrade verze 1 aplikace a verze 2 bez významného dopadu na činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-109">Our goal is to upgrade version 1 of the application to version 2 without any significant impact on the end-user experience.</span></span> 

<span data-ttu-id="1b5ca-110">Při vyhodnocování možnosti upgradu byste měli zvážit následující faktory:</span><span class="sxs-lookup"><span data-stu-id="1b5ca-110">When evaluating the upgrade options you should consider the following factors:</span></span>

* <span data-ttu-id="1b5ca-111">Dopad na dostupnost aplikace během upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="1b5ca-112">Jak dlouho může být funkce aplikací omezené nebo snížený výkon.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-112">How long the application function may be limited or degraded.</span></span>
* <span data-ttu-id="1b5ca-113">Možnost vrácení v případě selhání upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-113">Ability to roll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="1b5ca-114">Chyba zabezpečení aplikace během upgradu dojde k nesouvisejícími závažné chybě.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-114">Vulnerability of the application if an unrelated catastrophic failure occurs during the upgrade.</span></span>
* <span data-ttu-id="1b5ca-115">Celkový počet dolaru náklady.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-115">Total dollar cost.</span></span>  <span data-ttu-id="1b5ca-116">To zahrnuje další redundanci a přírůstkové náklady dočasné komponenty používané stránkami proces upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-116">This includes additional redundancy and incremental costs of the temporary components  used by the upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="1b5ca-117">Upgrade aplikací, které jsou závislé na zálohování databází můžete pro zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="1b5ca-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="1b5ca-118">Pokud vaše aplikace spoléhá na automatické zálohování databází a používá geografické obnovení pro zotavení po havárii, je obvykle nasadit do jedné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed to a single Azure region.</span></span> <span data-ttu-id="1b5ca-119">V takovém případě proces upgradu zahrnuje, vytvoření zálohy nasazení všech součástí aplikace zahrnutých v upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-119">In this case the upgrade process involves creating a backup deployment of all application components involved in the upgrade.</span></span> <span data-ttu-id="1b5ca-120">Chcete-li minimalizovat narušení koncového uživatele využíváte Azure provoz Manager (WATM) s profilem převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-120">To minimize the end-user disruption you will leverage Azure Traffic Manager (WATM) with the failover profile.</span></span>  <span data-ttu-id="1b5ca-121">Následující diagram znázorňuje před upgradem v provozním prostředí.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-121">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="1b5ca-122">Koncový bod <i>contoso-1.azurewebsites.net</i> představuje produkční slot aplikace, která musí být upgradován.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-122">The endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of the application that needs to be upgraded.</span></span> <span data-ttu-id="1b5ca-123">Povolit možnost vrácení upgradu potřebovat vytvoříte slot fáze s plně synchronizované kopie aplikace.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-123">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="1b5ca-124">Následující kroky jsou nezbytné pro Příprava aplikací pro upgrade:</span><span class="sxs-lookup"><span data-stu-id="1b5ca-124">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="1b5ca-125">Vytvořte slot fáze upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-125">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="1b5ca-126">Chcete provést, vytvořte sekundární databázi (1) a nasadit identické webu ve stejné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-126">To do that create a secondary database (1) and deploy an identical web site in the same Azure region.</span></span> <span data-ttu-id="1b5ca-127">Monitorování sekundární chcete zobrazit, pokud proces synchronizace replik indexů je dokončený.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-127">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="1b5ca-128">Vytvoření profilu převzetí služeb při selhání v WATM s <i>contoso-1.azurewebsites.net</i> jako koncový bod online a <i>contoso-2.azurewebsites.net</i> v režimu offline.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="1b5ca-129">Všimněte si, přípravné kroky nebude mít vliv na aplikaci v produkčním slotu a může fungovat v režimu úplný přístup.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-129">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
>  

![Konfigurace replikace přejít databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="1b5ca-132">Po dokončení přípravné kroky aplikace je připravená na skutečném upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-132">Once the preparation steps are completed the application is ready for the actual upgrade.</span></span> <span data-ttu-id="1b5ca-133">Následující diagram znázorňuje kroky v procesu upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-133">The following diagram illustrates the steps involved in the upgrade process.</span></span> 

1. <span data-ttu-id="1b5ca-134">Nastavte primární databázi v produkčním slotu do režimu jen pro čtení (3).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-134">Set the primary database in the production slot to read-only mode (3).</span></span> <span data-ttu-id="1b5ca-135">Tím se zaručí, že instance produkční aplikace (V1) zůstane jen pro čtení během upgradu, takže si odchylkami dat mezi instancemi databáze V1 a V2.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-135">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="1b5ca-136">Odpojte sekundární databáze v režimu plánované ukončení (4).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-136">Disconnect the secondary database using the planned termination mode (4).</span></span> <span data-ttu-id="1b5ca-137">Vytvoří kopii plně synchronizované nezávislé primární databáze.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-137">It will create a fully synchronized independent copy of the primary database.</span></span> <span data-ttu-id="1b5ca-138">Tato databáze budou upgradovány.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="1b5ca-139">Zapnout primární databázi do režimu pro čtení a zápis a spusťte skript pro upgrade ve fázi slotu (5).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-139">Turn the primary database to read-write mode and run the upgrade script in the stage slot  (5).</span></span>     

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="1b5ca-142">Pokud se upgrade úspěšně dokončit nyní jste připraveni přepnutí koncoví uživatelé na dvoufázové instalace kopie aplikace.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-142">If the upgrade completed successfully you are now ready to switch the end users to the staged copy the application.</span></span> <span data-ttu-id="1b5ca-143">Nyní bude aplikace produkční slot.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-143">It will now become the production slot of the application.</span></span>  <span data-ttu-id="1b5ca-144">To zahrnuje několik další kroky, jak je znázorněno na následujícím diagramu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-144">This involves a few more steps as illustrated on the following diagram.</span></span>

1. <span data-ttu-id="1b5ca-145">Přepnout online koncový bod v profilu WATM k <i>contoso-2.azurewebsites.net</i>, která odkazuje na verzi V2 webového serveru (6).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-145">Switch the online endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which points to the V2 version of the web site (6).</span></span> <span data-ttu-id="1b5ca-146">Nyní bude produkční slot s aplikací V2 a provoz koncový uživatel se přesměruje k němu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-146">It now becomes the production slot with the V2 application and the end-user traffic is directed to it.</span></span>  
2. <span data-ttu-id="1b5ca-147">Pokud již nepotřebujete součásti aplikace V1, abyste mohli bezpečně odeberte je (7).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-147">If you no longer need the V1 application components so you can safely remove them (7).</span></span>   

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="1b5ca-150">Pokud neproběhne proces upgradu, například z důvodu chyby ve skriptu pro upgrade, slotu fáze považovat za narušení.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-150">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="1b5ca-151">Vrácení aplikace do stavu před upgradem jednoduše obnovit aplikaci v produkčním slotu úplný přístup.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-151">To roll back the application to the pre-upgrade state you simply revert the application in the production slot to full access.</span></span> <span data-ttu-id="1b5ca-152">Kroky jsou uvedeny další diagram.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-152">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="1b5ca-153">Nastavte kopie databáze do režimu pro čtení a zápis (8).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-153">Set the database copy to read-write mode (8).</span></span> <span data-ttu-id="1b5ca-154">Tato akce obnoví úplné V1 funkčně v produkčním slotu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-154">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="1b5ca-155">Provedení analýzy příčina kořenové a odebrat ohrožené součásti ve fázi slotu (9).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-155">Perform the root cause analysis and remove the compromised components in the stage slot (9).</span></span> 

<span data-ttu-id="1b5ca-156">V tomto okamžiku je plně funkční aplikaci a lze je opakovat jednotlivé kroky upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-156">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="1b5ca-157">Vrácení zpět nevyžaduje změny v profilu WATM jako již odkazuje na <i>contoso-1.azurewebsites.net</i> jako aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-157">The rollback does not require changes in WATM profile as it already points to <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="1b5ca-160">Klíč **využít** této možnosti je, že můžete upgradovat aplikaci v jedné oblasti používáte sadu jednoduchých kroků.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-160">The key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="1b5ca-161">Náklady na dolaru upgradu je relativně nízký.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-161">The dollar cost of the upgrade is relatively low.</span></span> <span data-ttu-id="1b5ca-162">Hlavní **kompromis** je, že pokud při upgradu dojde k závažné chybě, bude zahrnovat obnovení do stavu před upgradem opakované nasazení aplikace v jiné oblasti a obnovit databázi ze zálohy pomocí geografické obnovení.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-162">The main **tradeoff** is that if a catastrophic failure occurs during the upgrade the recovery to the pre-upgrade state will involve re-deployment of the application in a different region and restoring the database from backup using geo-restore.</span></span> <span data-ttu-id="1b5ca-163">Tento proces bude způsobit významné výpadky.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="1b5ca-164">Upgrade aplikací, které jsou závislé na geografické replikace databáze pro zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="1b5ca-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="1b5ca-165">Pokud vaše aplikace využívá geografická replikace pro kontinuitu podnikových procesů, se nasadí do alespoň dva různé oblasti s aktivní nasazení v primární oblasti a pohotovostní nasazení v oblasti zálohování.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-165">If your application leverages geo-replication for business continuity, it is deployed  to at least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="1b5ca-166">Kromě faktory, již bylo zmíněno dříve proces upgradu musí zaručit, že:</span><span class="sxs-lookup"><span data-stu-id="1b5ca-166">In addition to the factors mentioned earlier, the upgrade process must guarantee that:</span></span>

* <span data-ttu-id="1b5ca-167">Aplikace i nadále chráněn před závažné selhání za všech okolností během procesu upgradu</span><span class="sxs-lookup"><span data-stu-id="1b5ca-167">The application remains protected from catastrophic failures at all times during the upgrade process</span></span>
* <span data-ttu-id="1b5ca-168">Geograficky redundantní komponenty aplikace jsou upgradovat paralelně s active součásti</span><span class="sxs-lookup"><span data-stu-id="1b5ca-168">The geo-redundant components of the application are upgraded in parallel with the active components</span></span>

<span data-ttu-id="1b5ca-169">K dosažení těchto cílů využije profil převzetí služeb při selhání pomocí jednu aktivní a tři zálohy koncové body Azure provoz Manager (WATM).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-169">To achieve these goals you will leverage Azure Traffic Manager (WATM) using the failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="1b5ca-170">Následující diagram znázorňuje před upgradem v provozním prostředí.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-170">The following diagram illustrates the operational environment prior to the upgrade process.</span></span> <span data-ttu-id="1b5ca-171">Na webech <i>contoso-1.azurewebsites.net</i> a <i>contoso-dr.azurewebsites.net</i> představují produkční slot aplikace s úplné geografická redundance.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-171">The web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of the application with full geographic redundancy.</span></span> <span data-ttu-id="1b5ca-172">Povolit možnost vrácení upgradu potřebovat vytvoříte slot fáze s plně synchronizované kopie aplikace.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-172">To enable the ability to roll back the upgrade, you need create a stage slot with a fully synchronized copy of the application.</span></span> <span data-ttu-id="1b5ca-173">Vzhledem k tomu, že je potřeba zajistit, že aplikace může rychle obnovit v případě, že během procesu upgradu dojde k závažné chybě, musí být geograficky redundantní také fáze slot.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-173">Because you need to ensure that the application can quickly recover in case a catastrophic failure occurs during the upgrade process, the stage slot needs to be geo-redundant as well.</span></span> <span data-ttu-id="1b5ca-174">Následující kroky jsou nezbytné pro Příprava aplikací pro upgrade:</span><span class="sxs-lookup"><span data-stu-id="1b5ca-174">The following steps are required to prepare the application for the upgrade:</span></span>

1. <span data-ttu-id="1b5ca-175">Vytvořte slot fáze upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-175">Create a stage slot for the upgrade.</span></span> <span data-ttu-id="1b5ca-176">Chcete provést, vytvořte sekundární databázi (1) a nasadit identické kopii webu ve stejné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-176">To do that create a secondary database (1) and deploy an identical copy of the web site in the same Azure region.</span></span> <span data-ttu-id="1b5ca-177">Monitorování sekundární chcete zobrazit, pokud proces synchronizace replik indexů je dokončený.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-177">Monitor the secondary to see if the seeding process is completed.</span></span>
2. <span data-ttu-id="1b5ca-178">Vytvoření geograficky redundantní sekundární databáze ve fázi slotu geografickou replikací sekundární databáze pro zálohování oblast (to se označuje jako "zřetězené geografická replikace").</span><span class="sxs-lookup"><span data-stu-id="1b5ca-178">Create a geo-redundant secondary database in the stage slot by geo-replicating the secondary database to the backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="1b5ca-179">Monitorování sekundární zálohy zjistit, jestli proces synchronizace replik indexů dokončené (3).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-179">Monitor the backup secondary to see if the seeding process is completed (3).</span></span>
3. <span data-ttu-id="1b5ca-180">Vytvořit kopii webu pohotovostní v oblasti zálohování a tu propojit na geograficky redundantní sekundární (4).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-180">Create a standby copy of the web site in the backup region and link it to the geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="1b5ca-181">Přidat další koncové body <i>contoso-2.azurewebsites.net</i> a <i>contoso-3.azurewebsites.net</i> profilu převzetí služeb při selhání v WATM jako offline koncové body (5).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-181">Add the additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> to the failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="1b5ca-182">Všimněte si, přípravné kroky nebude mít vliv na aplikaci v produkčním slotu a může fungovat v režimu úplný přístup.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-182">Note the preparation steps will not impact the application in the production slot and it can function in full access mode.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="1b5ca-185">Po dokončení kroků přípravy slot fáze je připravený na upgrade.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-185">Once the preparation steps are completed, the stage slot is ready for the upgrade.</span></span> <span data-ttu-id="1b5ca-186">Následující diagram znázorňuje jednotlivé kroky upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-186">The following diagram illustrates the upgrade steps.</span></span>

1. <span data-ttu-id="1b5ca-187">Nastavte primární databázi v produkčním slotu do režimu jen pro čtení (6).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-187">Set the primary database in the production slot to read-only mode (6).</span></span> <span data-ttu-id="1b5ca-188">Tím se zaručí, že instance produkční aplikace (V1) zůstane jen pro čtení během upgradu, takže si odchylkami dat mezi instancemi databáze V1 a V2.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-188">This will guarantee that the production instance of the application (V1) will remain read-only during the upgrade thus preventing the data divergence between the V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="1b5ca-189">Odpojte sekundární databázi ve stejné oblasti pomocí plánované ukončení režimu (7).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-189">Disconnect the secondary database in the same region using the planned termination mode (7).</span></span> <span data-ttu-id="1b5ca-190">Vytvoří kopii plně synchronizované nezávislé primární databázi, která se automaticky stane primární po ukončení.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-190">It will create a fully synchronized independent copy of the primary database, which will automatically become a primary after the termination.</span></span> <span data-ttu-id="1b5ca-191">Tato databáze budou upgradovány.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="1b5ca-192">Zapnout primární databáze ve fázi slotu do režimu pro čtení a zápis a spusťte upgrade skriptu (8).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-192">Turn the primary database in the stage slot to read-write mode and run the upgrade script (8).</span></span>    

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="1b5ca-195">Pokud aktualizace byla úspěšně dokončena nyní jste připraveni k přepínači koncoví uživatelé na V2 verzi aplikace.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-195">If the upgrade completed successfully you are now ready to switch the end users to the V2 version of the application.</span></span> <span data-ttu-id="1b5ca-196">Následující diagram znázorňuje kroky.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-196">The following diagram illustrates the steps involved.</span></span>

1. <span data-ttu-id="1b5ca-197">Přepínač aktivní koncový bod v WATM profil, který se <i>contoso-2.azurewebsites.net</i>, které nyní odkazuje na verze V2 webového serveru (9).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-197">Switch the active endpoint in the WATM profile to <i>contoso-2.azurewebsites.net</i>, which now points to the V2 version of the web site (9).</span></span> <span data-ttu-id="1b5ca-198">Nyní bude produkční slot s aplikací V2 a provoz koncový uživatel se přesměruje k němu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-198">It now becomes a production slot with the V2 application and end-user traffic is directed to it.</span></span> 
2. <span data-ttu-id="1b5ca-199">Pokud již nepotřebujete V1 aplikace, abyste mohli bezpečně odeberte ji (10 a 11).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-199">If you no longer need the V1 application so you can safely remove it (10 and 11).</span></span>  

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="1b5ca-202">Pokud neproběhne proces upgradu, například z důvodu chyby ve skriptu pro upgrade, slotu fáze považovat za narušení.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-202">If the upgrade process is unsuccessful, for example due to an error in the upgrade script, the stage slot should be considered compromised.</span></span> <span data-ttu-id="1b5ca-203">Vrácení aplikace do stavu před upgradem jednoduše obnovit pomocí aplikace v produkčním slotu s úplným přístupem.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-203">To roll back the application to the pre-upgrade state you simply revert to using the application in the production slot with full access.</span></span> <span data-ttu-id="1b5ca-204">Kroky jsou uvedeny další diagram.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-204">The steps involved are shown on the next diagram.</span></span>    

1. <span data-ttu-id="1b5ca-205">Nastavte kopie primární databáze v produkčním slotu do režimu pro čtení a zápis (12).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-205">Set the primary database copy in the production slot to read-write mode (12).</span></span> <span data-ttu-id="1b5ca-206">Tato akce obnoví úplné V1 funkčně v produkčním slotu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-206">This will restore the full V1 functionally in the production slot.</span></span>
2. <span data-ttu-id="1b5ca-207">Provedení analýzy příčina kořenové a odebrat ohrožené součásti ve fázi slotu (13 a 14).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-207">Perform the root cause analysis and remove the compromised components in the stage slot (13 and 14).</span></span> 

<span data-ttu-id="1b5ca-208">V tomto okamžiku je plně funkční aplikaci a lze je opakovat jednotlivé kroky upgradu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-208">At this point the application is fully functional and the upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="1b5ca-209">Vrácení zpět nevyžaduje změny v profilu WATM jako již odkazuje na <i>contoso-1.azurewebsites.net</i> jako aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-209">The rollback does not require changes in WATM profile as it already points to  <i>contoso-1.azurewebsites.net</i> as the active endpoint.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="1b5ca-212">Klíč **využít** této možnosti je, aniž by to ohrozilo vaší kontinuity podnikových procesů během upgradu můžete upgradovat aplikaci a její geograficky redundantní kopie paralelně.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-212">The key **advantage** of this option is that you can upgrade both the application and its geo-redundant copy in parallel without compromising your business continuity during the upgrade.</span></span> <span data-ttu-id="1b5ca-213">Hlavní **kompromis** je, že vyžaduje dvojité redundance jednotlivých součástí aplikace a proto způsobuje vyšší dolaru náklady.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-213">The main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="1b5ca-214">Zahrnuje také složitější pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="1b5ca-215">Souhrn</span><span class="sxs-lookup"><span data-stu-id="1b5ca-215">Summary</span></span>
<span data-ttu-id="1b5ca-216">Tyto dvě metody upgradu, které jsou popsané v článku se liší v složitost a dolaru náklady ale oba soustředit na minimalizovat čas, kdy je omezený na jen pro čtení operace koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-216">The two upgrade methods described in the article differ in complexity and the dollar cost but they both focus on minimizing the time when the end user is limited to read-only operations.</span></span> <span data-ttu-id="1b5ca-217">Tento čas je přímo definované doba trvání upgradu skriptu.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-217">That time is directly defined by the duration of the upgrade script.</span></span> <span data-ttu-id="1b5ca-218">Nezávisí na velikost databáze, úroveň služby, které jste zvolili, konfiguraci webu a dalších faktorů, které nelze snadno řídit.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-218">It does not depend on the database size, the service tier you chose, the web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="1b5ca-219">Je to proto, že všechny přípravné kroky jsou odpojené od jednotlivé kroky upgradu a lze provést bez dopadu na produkční aplikaci.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-219">This is because all the preparation steps are decoupled from the upgrade steps and can be done without impacting the production application.</span></span> <span data-ttu-id="1b5ca-220">Efektivitu skriptu pro upgrade je klíčovým faktorem, který určuje činnost koncového uživatele při upgradech.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-220">The efficiency of the upgrade script is the key factor that determines the end-user experience during upgrades.</span></span> <span data-ttu-id="1b5ca-221">Proto je nejlepší způsob je možné zvýšit činnosti spojené se zaměříte na provedení upgradu skriptu co nejúčinnější.</span><span class="sxs-lookup"><span data-stu-id="1b5ca-221">So the best way you can improve it is by focusing your efforts on making the upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="1b5ca-222">Další kroky</span><span class="sxs-lookup"><span data-stu-id="1b5ca-222">Next steps</span></span>
* <span data-ttu-id="1b5ca-223">Přehled kontinuity obchodních a scénářů najdete v tématu [obchodní kontinuity přehled](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="1b5ca-224">Další informace o Azure SQL Database automatizované zálohování najdete v tématu [automatizované zálohování SQL Database](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-224">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="1b5ca-225">Další informace o použití automatizované zálohování pro obnovení, najdete v části [obnovit databázi ze zálohy pro automatické](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-225">To learn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="1b5ca-226">Další informace o možnosti rychlejší obnovení najdete v tématu [aktivní geografickou replikací](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="1b5ca-226">To learn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>



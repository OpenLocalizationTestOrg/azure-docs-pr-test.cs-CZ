---
title: "upgrady aplikací aaaRolling – Azure SQL Database | Microsoft Docs"
description: "Zjistěte, jak toouse geografická replikace databáze SQL Azure toosupport online upgrady cloudové aplikace."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 58f42859-1e37-463c-a3d8-a3ca2e867148
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 07/16/2016
ms.author: sashan
ms.openlocfilehash: 18c56300916d129bff141624cc5c416b500408d4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="managing-rolling-upgrades-of-cloud-applications-using-sql-database-active-geo-replication"></a><span data-ttu-id="98600-103">Správa postupné upgrady cloudových aplikací pomocí SQL Database aktivní geografickou replikaci</span><span class="sxs-lookup"><span data-stu-id="98600-103">Managing rolling upgrades of cloud applications using SQL Database active geo-replication</span></span>
> [!NOTE]
> <span data-ttu-id="98600-104">[Aktivní geografickou replikací](sql-database-geo-replication-overview.md) je nyní k dispozici pro všechny databáze na všech úrovních.</span><span class="sxs-lookup"><span data-stu-id="98600-104">[Active geo-replication](sql-database-geo-replication-overview.md) is now available for all databases in all tiers.</span></span>
> 

<span data-ttu-id="98600-105">Zjistěte, jak toouse [geografická replikace](sql-database-geo-replication-overview.md) v databázi SQL tooenable vrácení upgrady cloudových aplikací.</span><span class="sxs-lookup"><span data-stu-id="98600-105">Learn how toouse [geo-replication](sql-database-geo-replication-overview.md) in SQL Database tooenable rolling upgrades of your cloud application.</span></span> <span data-ttu-id="98600-106">Protože upgrade je rušivý operace, je nutné součást vaší firmy kontinuity plánování a návrhu.</span><span class="sxs-lookup"><span data-stu-id="98600-106">Because upgrade is a disruptive operation, it should be part of your business continuity planning and design.</span></span> <span data-ttu-id="98600-107">V tomto článku, který se podíváme na dvě různé metody Orchestrace hello procesu upgradu a popisují výhody hello a kompromis jednotlivých možností.</span><span class="sxs-lookup"><span data-stu-id="98600-107">In this article we look at two different methods of orchestrating hello upgrade process, and discuss hello benefits and trade-offs of each option.</span></span> <span data-ttu-id="98600-108">Pro účely tohoto článku hello použijeme jednoduchou aplikaci, která se skládá z jedné databáze webu připojené tooa jako jeho datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="98600-108">For hello purposes of this article we will use a simple application that consists of a web site connected tooa single database as its data tier.</span></span> <span data-ttu-id="98600-109">Naším cílem je tooupgrade verze 1 hello aplikace tooversion 2 bez žádný významný dopad na hello činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="98600-109">Our goal is tooupgrade version 1 of hello application tooversion 2 without any significant impact on hello end-user experience.</span></span> 

<span data-ttu-id="98600-110">Při vyhodnocování hello možnosti upgradu je třeba zvážit hello následující faktory:</span><span class="sxs-lookup"><span data-stu-id="98600-110">When evaluating hello upgrade options you should consider hello following factors:</span></span>

* <span data-ttu-id="98600-111">Dopad na dostupnost aplikace během upgradu.</span><span class="sxs-lookup"><span data-stu-id="98600-111">Impact on application availability during upgrades.</span></span> <span data-ttu-id="98600-112">Jak dlouho může být funkce aplikace hello omezené nebo snížení.</span><span class="sxs-lookup"><span data-stu-id="98600-112">How long hello application function may be limited or degraded.</span></span>
* <span data-ttu-id="98600-113">Možnost tooroll zpět v případě selhání upgradu.</span><span class="sxs-lookup"><span data-stu-id="98600-113">Ability tooroll back in case of an upgrade failure.</span></span>
* <span data-ttu-id="98600-114">Chyba zabezpečení aplikace hello během upgradu hello dojde k nesouvisejícími závažné chybě.</span><span class="sxs-lookup"><span data-stu-id="98600-114">Vulnerability of hello application if an unrelated catastrophic failure occurs during hello upgrade.</span></span>
* <span data-ttu-id="98600-115">Celkový počet dolaru náklady.</span><span class="sxs-lookup"><span data-stu-id="98600-115">Total dollar cost.</span></span>  <span data-ttu-id="98600-116">To zahrnuje další redundanci a přírůstkové náklady hello dočasné komponenty používané stránkami hello procesu upgradu.</span><span class="sxs-lookup"><span data-stu-id="98600-116">This includes additional redundancy and incremental costs of hello temporary components  used by hello upgrade process.</span></span> 

## <a name="upgrading-applications-that-rely-on-database-backups-for-disaster-recovery"></a><span data-ttu-id="98600-117">Upgrade aplikací, které jsou závislé na zálohování databází můžete pro zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="98600-117">Upgrading applications that rely on database backups for disaster recovery</span></span>
<span data-ttu-id="98600-118">Pokud vaše aplikace spoléhá na automatické zálohování databází a používá geografické obnovení pro zotavení po havárii, je obvykle nasazené tooa jedné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="98600-118">If your application relies on automatic database backups and uses geo-restore for disaster recovery, it is usually deployed tooa single Azure region.</span></span> <span data-ttu-id="98600-119">V takovém případě procesu upgradu hello zahrnuje, vytvoření účastnící se hello upgrade zálohování nasazení všech součástí aplikace.</span><span class="sxs-lookup"><span data-stu-id="98600-119">In this case hello upgrade process involves creating a backup deployment of all application components involved in hello upgrade.</span></span> <span data-ttu-id="98600-120">toominimize hello přerušení koncového uživatele bude využívat Azure provoz Manager (WATM) s profilem hello převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="98600-120">toominimize hello end-user disruption you will leverage Azure Traffic Manager (WATM) with hello failover profile.</span></span>  <span data-ttu-id="98600-121">Hello následující diagram znázorňuje proces upgradu předchozí toohello hello provozní prostředí.</span><span class="sxs-lookup"><span data-stu-id="98600-121">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="98600-122">Hello koncový bod <i>contoso-1.azurewebsites.net</i> představuje produkční slot hello aplikace vyžadující toobe upgradovat.</span><span class="sxs-lookup"><span data-stu-id="98600-122">hello endpoint <i>contoso-1.azurewebsites.net</i> represents a production slot of hello application that needs toobe upgraded.</span></span> <span data-ttu-id="98600-123">tooenable hello možnost tooroll zpět hello upgrade, musí vytvořit slot fáze s plně synchronizované kopie aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="98600-123">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="98600-124">Hello následující kroky jsou požadované tooprepare hello aplikace hello upgrade:</span><span class="sxs-lookup"><span data-stu-id="98600-124">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="98600-125">Vytvořte pro hello upgrade fáze slot.</span><span class="sxs-lookup"><span data-stu-id="98600-125">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="98600-126">toodo, který vytvořit sekundární databázi (1) a nasadit identické webu v hello stejné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="98600-126">toodo that create a secondary database (1) and deploy an identical web site in hello same Azure region.</span></span> <span data-ttu-id="98600-127">Monitorování sekundární toosee hello, pokud dokončení synchronizace replik indexů proces hello.</span><span class="sxs-lookup"><span data-stu-id="98600-127">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="98600-128">Vytvoření profilu převzetí služeb při selhání v WATM s <i>contoso-1.azurewebsites.net</i> jako koncový bod online a <i>contoso-2.azurewebsites.net</i> v režimu offline.</span><span class="sxs-lookup"><span data-stu-id="98600-128">Create a failover profile in WATM with <i>contoso-1.azurewebsites.net</i> as online endpoint and <i>contoso-2.azurewebsites.net</i> as offline.</span></span> 

> [!NOTE]
> <span data-ttu-id="98600-129">Poznámka: hello přípravné kroky nebude mít vliv hello aplikace hello produkční slot a může fungovat v režimu úplný přístup.</span><span class="sxs-lookup"><span data-stu-id="98600-129">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
>  

![Konfigurace replikace přejít databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-1.png)

<span data-ttu-id="98600-132">Po dokončení hello přípravné kroky hello aplikace je připravena k vlastním upgradem hello.</span><span class="sxs-lookup"><span data-stu-id="98600-132">Once hello preparation steps are completed hello application is ready for hello actual upgrade.</span></span> <span data-ttu-id="98600-133">Hello následující diagram znázorňuje hello kroky v procesu upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-133">hello following diagram illustrates hello steps involved in hello upgrade process.</span></span> 

1. <span data-ttu-id="98600-134">Nastavit primární databáze hello hello produkčním slotu tooread pouze v režimu (3).</span><span class="sxs-lookup"><span data-stu-id="98600-134">Set hello primary database in hello production slot tooread-only mode (3).</span></span> <span data-ttu-id="98600-135">Tím se zaručí, že hello produkční instanci aplikace hello (V1) zůstane jen pro čtení během upgradu hello, takže si hello odchylkami dat mezi hello V1 a V2 instance databáze.</span><span class="sxs-lookup"><span data-stu-id="98600-135">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="98600-136">Odpojte hello sekundární databáze pomocí hello plánované ukončení režimu (4).</span><span class="sxs-lookup"><span data-stu-id="98600-136">Disconnect hello secondary database using hello planned termination mode (4).</span></span> <span data-ttu-id="98600-137">Vytvoří kopii plně synchronizované nezávislé hello primární databáze.</span><span class="sxs-lookup"><span data-stu-id="98600-137">It will create a fully synchronized independent copy of hello primary database.</span></span> <span data-ttu-id="98600-138">Tato databáze budou upgradovány.</span><span class="sxs-lookup"><span data-stu-id="98600-138">This database will be upgraded.</span></span>
3. <span data-ttu-id="98600-139">Zapnutí režimu zápisu tooread hello primární databáze a spusťte skript upgradu hello ve slotu fáze hello (5).</span><span class="sxs-lookup"><span data-stu-id="98600-139">Turn hello primary database tooread-write mode and run hello upgrade script in hello stage slot  (5).</span></span>     

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-2.png)

<span data-ttu-id="98600-142">Pokud hello upgrade úspěšně dokončen jste nyní připraven tooswitch hello koncoví uživatelé toohello připravený kopie hello aplikace.</span><span class="sxs-lookup"><span data-stu-id="98600-142">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello staged copy hello application.</span></span> <span data-ttu-id="98600-143">Nyní se stane hello produkční slot aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="98600-143">It will now become hello production slot of hello application.</span></span>  <span data-ttu-id="98600-144">To zahrnuje několik další kroky, jak je znázorněno na následujícím diagramu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-144">This involves a few more steps as illustrated on hello following diagram.</span></span>

1. <span data-ttu-id="98600-145">Přepnout online koncový bod hello v profilu WATM hello příliš<i>contoso-2.azurewebsites.net</i>, která verze toohello V2 body hello webové stránky (6).</span><span class="sxs-lookup"><span data-stu-id="98600-145">Switch hello online endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which points toohello V2 version of hello web site (6).</span></span> <span data-ttu-id="98600-146">Nyní bude hello produkční slot s hello V2 aplikace a provoz hello koncového uživatele je směrovanou tooit.</span><span class="sxs-lookup"><span data-stu-id="98600-146">It now becomes hello production slot with hello V2 application and hello end-user traffic is directed tooit.</span></span>  
2. <span data-ttu-id="98600-147">Pokud již nepotřebujete součásti aplikace hello V1, abyste mohli bezpečně odeberte je (7).</span><span class="sxs-lookup"><span data-stu-id="98600-147">If you no longer need hello V1 application components so you can safely remove them (7).</span></span>   

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-3.png)

<span data-ttu-id="98600-150">Pokud neproběhne hello upgradu, například z důvodu chyby tooan ve skriptu upgradu hello, hello fáze slotu považovat za ohrožení zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="98600-150">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="98600-151">tooroll zpět hello toohello před upgradem stav aplikace můžete jednoduše vrátit hello aplikace hello produkčním slotu toofull přístup.</span><span class="sxs-lookup"><span data-stu-id="98600-151">tooroll back hello application toohello pre-upgrade state you simply revert hello application in hello production slot toofull access.</span></span> <span data-ttu-id="98600-152">Hello kroky jsou uvedeny v diagramu další hello.</span><span class="sxs-lookup"><span data-stu-id="98600-152">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="98600-153">Nastavit režim tooread zápisu kopírování databáze hello (8).</span><span class="sxs-lookup"><span data-stu-id="98600-153">Set hello database copy tooread-write mode (8).</span></span> <span data-ttu-id="98600-154">Tato akce obnoví hello úplné V1 funkčně v hello produkční slot.</span><span class="sxs-lookup"><span data-stu-id="98600-154">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="98600-155">Proveďte analýza hello hlavní příčiny a odebrat součásti hello ohrožení zabezpečení ve slotu fáze hello (9).</span><span class="sxs-lookup"><span data-stu-id="98600-155">Perform hello root cause analysis and remove hello compromised components in hello stage slot (9).</span></span> 

<span data-ttu-id="98600-156">V tomto okamžiku aplikace hello je plně funkční a lze je opakovat postup upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-156">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="98600-157">Hello vrácení nevyžaduje změny v profilu WATM jako již odkazuje příliš<i>contoso-1.azurewebsites.net</i> jako hello aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="98600-157">hello rollback does not require changes in WATM profile as it already points too<i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option1-4.png)

<span data-ttu-id="98600-160">klíč Hello **využít** této možnosti je, že můžete upgradovat aplikaci v jedné oblasti používáte sadu jednoduchých kroků.</span><span class="sxs-lookup"><span data-stu-id="98600-160">hello key **advantage** of this option is that you can upgrade an application in a single region using a set of simple steps.</span></span> <span data-ttu-id="98600-161">náklady na dolaru Hello hello upgradu je relativně nízký.</span><span class="sxs-lookup"><span data-stu-id="98600-161">hello dollar cost of hello upgrade is relatively low.</span></span> <span data-ttu-id="98600-162">Hello hlavní **kompromis** je, pokud dojde k závažné chybě během hello upgradu hello obnovení toohello před upgradem stavu bude zahrnovat opakované nasazení aplikace hello v jiné oblasti a obnovení databáze hello z zálohování pomocí geografické obnovení.</span><span class="sxs-lookup"><span data-stu-id="98600-162">hello main **tradeoff** is that if a catastrophic failure occurs during hello upgrade hello recovery toohello pre-upgrade state will involve re-deployment of hello application in a different region and restoring hello database from backup using geo-restore.</span></span> <span data-ttu-id="98600-163">Tento proces bude způsobit významné výpadky.</span><span class="sxs-lookup"><span data-stu-id="98600-163">This process will result in significant downtime.</span></span>   

## <a name="upgrading-applications-that-rely-on-database-geo-replication-for-disaster-recovery"></a><span data-ttu-id="98600-164">Upgrade aplikací, které jsou závislé na geografické replikace databáze pro zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="98600-164">Upgrading applications that rely on database geo-replication for disaster recovery</span></span>
<span data-ttu-id="98600-165">Pokud vaše aplikace využívá geografická replikace pro kontinuitu podnikových procesů, je nasazené tooat minimálně dva různé oblasti s aktivní nasazení v primární oblasti a pohotovostní nasazení v oblasti zálohování.</span><span class="sxs-lookup"><span data-stu-id="98600-165">If your application leverages geo-replication for business continuity, it is deployed  tooat least two different regions with an active deployment in Primary region and a standby deployment in Backup region.</span></span> <span data-ttu-id="98600-166">Kromě toho toohello faktory již bylo zmíněno dříve, procesu upgradu hello musí zaručit, že:</span><span class="sxs-lookup"><span data-stu-id="98600-166">In addition toohello factors mentioned earlier, hello upgrade process must guarantee that:</span></span>

* <span data-ttu-id="98600-167">aplikace Hello i nadále chráněn před závažné selhání za všech okolností během procesu upgradu hello</span><span class="sxs-lookup"><span data-stu-id="98600-167">hello application remains protected from catastrophic failures at all times during hello upgrade process</span></span>
* <span data-ttu-id="98600-168">geograficky redundantní komponenty aplikace hello Hello upgradují paralelně s komponentami active hello</span><span class="sxs-lookup"><span data-stu-id="98600-168">hello geo-redundant components of hello application are upgraded in parallel with hello active components</span></span>

<span data-ttu-id="98600-169">tooachieve těchto cílů využije hello převzetí služeb při selhání Azure provoz Manager (WATM) profil s jednu aktivní a tři zálohy koncové body.</span><span class="sxs-lookup"><span data-stu-id="98600-169">tooachieve these goals you will leverage Azure Traffic Manager (WATM) using hello failover profile with one active and three backup endpoints.</span></span>  <span data-ttu-id="98600-170">Hello následující diagram znázorňuje proces upgradu předchozí toohello hello provozní prostředí.</span><span class="sxs-lookup"><span data-stu-id="98600-170">hello following diagram illustrates hello operational environment prior toohello upgrade process.</span></span> <span data-ttu-id="98600-171">Hello weby <i>contoso-1.azurewebsites.net</i> a <i>contoso-dr.azurewebsites.net</i> představují produkční slot hello aplikace s úplné geografická redundance.</span><span class="sxs-lookup"><span data-stu-id="98600-171">hello web sites <i>contoso-1.azurewebsites.net</i> and <i>contoso-dr.azurewebsites.net</i> represent a production slot of hello application with full geographic redundancy.</span></span> <span data-ttu-id="98600-172">tooenable hello možnost tooroll zpět hello upgrade, musí vytvořit slot fáze s plně synchronizované kopie aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="98600-172">tooenable hello ability tooroll back hello upgrade, you need create a stage slot with a fully synchronized copy of hello application.</span></span> <span data-ttu-id="98600-173">Vzhledem k tomu, že budete potřebovat tooensure, hello aplikace můžete rychle obnovit v případě, že během procesu upgradu hello dojde k závažné chybě, hello fáze slotu musí toobe geograficky redundantní také.</span><span class="sxs-lookup"><span data-stu-id="98600-173">Because you need tooensure that hello application can quickly recover in case a catastrophic failure occurs during hello upgrade process, hello stage slot needs toobe geo-redundant as well.</span></span> <span data-ttu-id="98600-174">Hello následující kroky jsou požadované tooprepare hello aplikace hello upgrade:</span><span class="sxs-lookup"><span data-stu-id="98600-174">hello following steps are required tooprepare hello application for hello upgrade:</span></span>

1. <span data-ttu-id="98600-175">Vytvořte pro hello upgrade fáze slot.</span><span class="sxs-lookup"><span data-stu-id="98600-175">Create a stage slot for hello upgrade.</span></span> <span data-ttu-id="98600-176">toodo, který vytvořit sekundární databázi (1) a nasadit identické kopii hello webovou stránku hello stejné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="98600-176">toodo that create a secondary database (1) and deploy an identical copy of hello web site in hello same Azure region.</span></span> <span data-ttu-id="98600-177">Monitorování sekundární toosee hello, pokud dokončení synchronizace replik indexů proces hello.</span><span class="sxs-lookup"><span data-stu-id="98600-177">Monitor hello secondary toosee if hello seeding process is completed.</span></span>
2. <span data-ttu-id="98600-178">Vytvoření geograficky redundantní sekundární databáze ve slotu fáze hello geografickou replikací hello sekundární databáze toohello zálohování oblast (to se označuje jako "zřetězené geografická replikace").</span><span class="sxs-lookup"><span data-stu-id="98600-178">Create a geo-redundant secondary database in hello stage slot by geo-replicating hello secondary database toohello backup region (this is called "chained geo-replication").</span></span> <span data-ttu-id="98600-179">Monitorování zálohování sekundární toosee hello, pokud hello synchronizace replik indexů proces je dokončené (3).</span><span class="sxs-lookup"><span data-stu-id="98600-179">Monitor hello backup secondary toosee if hello seeding process is completed (3).</span></span>
3. <span data-ttu-id="98600-180">Vytvořit kopii pohotovostní hello webové stránky v oblasti zálohování hello a propojit jej toohello geograficky redundantní sekundární (4).</span><span class="sxs-lookup"><span data-stu-id="98600-180">Create a standby copy of hello web site in hello backup region and link it toohello geo-redundant secondary (4).</span></span>  
4. <span data-ttu-id="98600-181">Přidat další koncové body hello <i>contoso-2.azurewebsites.net</i> a <i>contoso-3.azurewebsites.net</i> toohello profil převzetí služeb při selhání v WATM jako offline koncové body (5).</span><span class="sxs-lookup"><span data-stu-id="98600-181">Add hello additional endpoints <i>contoso-2.azurewebsites.net</i> and <i>contoso-3.azurewebsites.net</i> toohello failover profile in WATM as offline endpoints (5).</span></span> 

> [!NOTE]
> <span data-ttu-id="98600-182">Poznámka: hello přípravné kroky nebude mít vliv hello aplikace hello produkční slot a může fungovat v režimu úplný přístup.</span><span class="sxs-lookup"><span data-stu-id="98600-182">Note hello preparation steps will not impact hello application in hello production slot and it can function in full access mode.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-1.png)

<span data-ttu-id="98600-185">Po dokončení kroků přípravy hello slot fáze hello je připraven k upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-185">Once hello preparation steps are completed, hello stage slot is ready for hello upgrade.</span></span> <span data-ttu-id="98600-186">Hello následující diagram znázorňuje postup upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-186">hello following diagram illustrates hello upgrade steps.</span></span>

1. <span data-ttu-id="98600-187">Nastavit primární databáze hello hello produkčním slotu tooread pouze v režimu (6).</span><span class="sxs-lookup"><span data-stu-id="98600-187">Set hello primary database in hello production slot tooread-only mode (6).</span></span> <span data-ttu-id="98600-188">Tím se zaručí, že hello produkční instanci aplikace hello (V1) zůstane jen pro čtení během upgradu hello, takže si hello odchylkami dat mezi hello V1 a V2 instance databáze.</span><span class="sxs-lookup"><span data-stu-id="98600-188">This will guarantee that hello production instance of hello application (V1) will remain read-only during hello upgrade thus preventing hello data divergence between hello V1 and V2 database instances.</span></span>  
2. <span data-ttu-id="98600-189">Odpojit hello sekundární databáze v hello pomocí stejné oblasti hello plánované ukončení režimu (7).</span><span class="sxs-lookup"><span data-stu-id="98600-189">Disconnect hello secondary database in hello same region using hello planned termination mode (7).</span></span> <span data-ttu-id="98600-190">Vytvoří kopii plně synchronizované nezávislé hello primární databázi, která se automaticky stane primární po ukončení hello.</span><span class="sxs-lookup"><span data-stu-id="98600-190">It will create a fully synchronized independent copy of hello primary database, which will automatically become a primary after hello termination.</span></span> <span data-ttu-id="98600-191">Tato databáze budou upgradovány.</span><span class="sxs-lookup"><span data-stu-id="98600-191">This database will be upgraded.</span></span>
3. <span data-ttu-id="98600-192">Zapnout hello primární databázi v režimu zápisu tooread slotu fáze hello a spusťte skript pro upgrade hello (8).</span><span class="sxs-lookup"><span data-stu-id="98600-192">Turn hello primary database in hello stage slot tooread-write mode and run hello upgrade script (8).</span></span>    

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-2.png)

<span data-ttu-id="98600-195">Pokud hello upgrade úspěšně dokončen jste nyní připraven tooswitch hello koncoví uživatelé toohello V2 verze aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="98600-195">If hello upgrade completed successfully you are now ready tooswitch hello end users toohello V2 version of hello application.</span></span> <span data-ttu-id="98600-196">Hello následující diagram znázorňuje hello kroky.</span><span class="sxs-lookup"><span data-stu-id="98600-196">hello following diagram illustrates hello steps involved.</span></span>

1. <span data-ttu-id="98600-197">Přepínač hello aktivní koncový bod v profilu WATM hello příliš<i>contoso-2.azurewebsites.net</i>, které teď body toohello V2 verzi hello webový server (9).</span><span class="sxs-lookup"><span data-stu-id="98600-197">Switch hello active endpoint in hello WATM profile too<i>contoso-2.azurewebsites.net</i>, which now points toohello V2 version of hello web site (9).</span></span> <span data-ttu-id="98600-198">Nyní bude produkční slot s hello V2 aplikace a provoz koncového uživatele je řízené tooit.</span><span class="sxs-lookup"><span data-stu-id="98600-198">It now becomes a production slot with hello V2 application and end-user traffic is directed tooit.</span></span> 
2. <span data-ttu-id="98600-199">Pokud již nepotřebujete hello V1 aplikace, abyste mohli bezpečně odeberte ji (10 a 11).</span><span class="sxs-lookup"><span data-stu-id="98600-199">If you no longer need hello V1 application so you can safely remove it (10 and 11).</span></span>  

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-3.png)

<span data-ttu-id="98600-202">Pokud neproběhne hello upgradu, například z důvodu chyby tooan ve skriptu upgradu hello, hello fáze slotu považovat za ohrožení zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="98600-202">If hello upgrade process is unsuccessful, for example due tooan error in hello upgrade script, hello stage slot should be considered compromised.</span></span> <span data-ttu-id="98600-203">tooroll zpět hello toohello před upgradem stav aplikace můžete jednoduše vrátit aplikace hello toousing v produkční slot hello s úplným přístupem.</span><span class="sxs-lookup"><span data-stu-id="98600-203">tooroll back hello application toohello pre-upgrade state you simply revert toousing hello application in hello production slot with full access.</span></span> <span data-ttu-id="98600-204">Hello kroky jsou uvedeny v diagramu další hello.</span><span class="sxs-lookup"><span data-stu-id="98600-204">hello steps involved are shown on hello next diagram.</span></span>    

1. <span data-ttu-id="98600-205">Sada hello kopie primární databázi v režimu tooread zápis pozici provozního hello (12).</span><span class="sxs-lookup"><span data-stu-id="98600-205">Set hello primary database copy in hello production slot tooread-write mode (12).</span></span> <span data-ttu-id="98600-206">Tato akce obnoví hello úplné V1 funkčně v hello produkční slot.</span><span class="sxs-lookup"><span data-stu-id="98600-206">This will restore hello full V1 functionally in hello production slot.</span></span>
2. <span data-ttu-id="98600-207">Proveďte analýza hello hlavní příčiny a odebrat součásti hello ohrožení zabezpečení ve fázi slotu hello (13 a 14).</span><span class="sxs-lookup"><span data-stu-id="98600-207">Perform hello root cause analysis and remove hello compromised components in hello stage slot (13 and 14).</span></span> 

<span data-ttu-id="98600-208">V tomto okamžiku aplikace hello je plně funkční a lze je opakovat postup upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-208">At this point hello application is fully functional and hello upgrade steps can be repeated.</span></span>

> [!NOTE]
> <span data-ttu-id="98600-209">Hello vrácení nevyžaduje změny v profilu WATM jako již odkazuje příliš <i>contoso-1.azurewebsites.net</i> jako hello aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="98600-209">hello rollback does not require changes in WATM profile as it already points too <i>contoso-1.azurewebsites.net</i> as hello active endpoint.</span></span>
> 
> 

![Konfigurace geografická replikace databáze SQL.](media/sql-database-manage-application-rolling-upgrade/Option2-4.png)

<span data-ttu-id="98600-212">klíč Hello **využít** této možnosti je, aniž by to ohrozilo vaší kontinuity podnikových procesů během upgradu hello můžete upgradovat hello aplikace a její geograficky redundantní kopie paralelně.</span><span class="sxs-lookup"><span data-stu-id="98600-212">hello key **advantage** of this option is that you can upgrade both hello application and its geo-redundant copy in parallel without compromising your business continuity during hello upgrade.</span></span> <span data-ttu-id="98600-213">Hello hlavní **kompromis** je, že vyžaduje dvojité redundance jednotlivých součástí aplikace a proto způsobuje vyšší dolaru náklady.</span><span class="sxs-lookup"><span data-stu-id="98600-213">hello main **tradeoff** is that it requires double redundancy of each application component and therefore incurs higher dollar cost.</span></span> <span data-ttu-id="98600-214">Zahrnuje také složitější pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="98600-214">It also involves a more complicated workflow.</span></span> 

## <a name="summary"></a><span data-ttu-id="98600-215">Souhrn</span><span class="sxs-lookup"><span data-stu-id="98600-215">Summary</span></span>
<span data-ttu-id="98600-216">Hello dva upgradu metody popsané v článku hello se liší v složitost a hello dolaru náklady, ale obě soustředit na minimalizovat hello čas, kdy hello koncového uživatele je omezena pouze tooread operace.</span><span class="sxs-lookup"><span data-stu-id="98600-216">hello two upgrade methods described in hello article differ in complexity and hello dollar cost but they both focus on minimizing hello time when hello end user is limited tooread-only operations.</span></span> <span data-ttu-id="98600-217">Tento čas je přímo definované hello doba trvání upgradu skriptu hello.</span><span class="sxs-lookup"><span data-stu-id="98600-217">That time is directly defined by hello duration of hello upgrade script.</span></span> <span data-ttu-id="98600-218">Nezávisí na velikost databáze hello, vrstvy hello služeb, můžete pokusit, hello konfiguraci webového serveru a dalších faktorů, které nelze snadno řídit.</span><span class="sxs-lookup"><span data-stu-id="98600-218">It does not depend on hello database size, hello service tier you chose, hello web site configuration and other factors that you cannot easily control.</span></span> <span data-ttu-id="98600-219">Je to proto, že všechny hello přípravné kroky jsou odpojené od postup upgradu hello a lze provést bez dopadu na produkční aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="98600-219">This is because all hello preparation steps are decoupled from hello upgrade steps and can be done without impacting hello production application.</span></span> <span data-ttu-id="98600-220">Hello efektivitu upgradovací skript pro hello je hello klíčovým faktorem, který určuje hello činnost koncového uživatele při upgradech.</span><span class="sxs-lookup"><span data-stu-id="98600-220">hello efficiency of hello upgrade script is hello key factor that determines hello end-user experience during upgrades.</span></span> <span data-ttu-id="98600-221">Proto hello nejlepší způsob je možné zvýšit je vaše úsilí se zaměříte na provedení upgradu skriptu hello co nejúčinnější.</span><span class="sxs-lookup"><span data-stu-id="98600-221">So hello best way you can improve it is by focusing your efforts on making hello upgrade script as efficient as possible.</span></span>  

## <a name="next-steps"></a><span data-ttu-id="98600-222">Další kroky</span><span class="sxs-lookup"><span data-stu-id="98600-222">Next steps</span></span>
* <span data-ttu-id="98600-223">Přehled kontinuity obchodních a scénářů najdete v tématu [obchodní kontinuity přehled](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="98600-223">For a business continuity overview and scenarios, see [Business continuity overview](sql-database-business-continuity.md).</span></span>
* <span data-ttu-id="98600-224">toolearn o zálohování Azure SQL Database automatizované, najdete v části [automatizované zálohování SQL Database](sql-database-automated-backups.md).</span><span class="sxs-lookup"><span data-stu-id="98600-224">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md).</span></span>
* <span data-ttu-id="98600-225">toolearn o použití automatizované zálohování pro obnovení, najdete v části [obnovit databázi ze zálohy pro automatické](sql-database-recovery-using-backups.md).</span><span class="sxs-lookup"><span data-stu-id="98600-225">toolearn about using automated backups for recovery, see [restore a database from automated backups](sql-database-recovery-using-backups.md).</span></span>
* <span data-ttu-id="98600-226">toolearn o rychlejší možnosti obnovení, najdete v části [aktivní geografickou replikací](sql-database-geo-replication-overview.md).</span><span class="sxs-lookup"><span data-stu-id="98600-226">toolearn about faster recovery options, see [active geo-replication](sql-database-geo-replication-overview.md).</span></span>



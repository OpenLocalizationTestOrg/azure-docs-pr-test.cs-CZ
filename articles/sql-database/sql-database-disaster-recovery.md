---
title: "aaaSQL zotavení po havárii databáze | Microsoft Docs"
description: "Zjistěte, jak hello toorecover databáze z místního datového centra výpadku nebo chyby s Azure SQL Database aktivní geografickou replikaci a možnosti geografické obnovení."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: bae08485863067748107ec4808e52d8e88e2de0d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="restore-an-azure-sql-database-or-failover-tooa-secondary"></a><span data-ttu-id="23851-103">Obnovení databáze SQL Azure nebo převzetí služeb při selhání tooa sekundární</span><span class="sxs-lookup"><span data-stu-id="23851-103">Restore an Azure SQL Database or failover tooa secondary</span></span>
<span data-ttu-id="23851-104">Azure SQL Database nabízí následující možnosti pro zotavení po výpadku hello:</span><span class="sxs-lookup"><span data-stu-id="23851-104">Azure SQL Database offers hello following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="23851-105">Aktivní geografická replikace</span><span class="sxs-lookup"><span data-stu-id="23851-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="23851-106">Geografické obnovení</span><span class="sxs-lookup"><span data-stu-id="23851-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="23851-107">toolearn o obchodní kontinuity scénáře a hello funkce pro podporu těchto scénářů najdete v části [kontinuity podnikových procesů](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="23851-107">toolearn about business continuity scenarios and hello features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-hello-event-of-an-outage"></a><span data-ttu-id="23851-108">Příprava pro událost hello výpadku</span><span class="sxs-lookup"><span data-stu-id="23851-108">Prepare for hello event of an outage</span></span>
<span data-ttu-id="23851-109">Pro úspěšné dokončení obnovení tooanother datové oblasti pomocí aktivní geografickou replikaci nebo geograficky redundantní zálohy musíte tooprepare na server v jiné data center výpadku toobecome hello novým primárním serverem by měl hello musí nastat a také mít dobře definované kroky zdokumentovaných a otestovaná tooensure smooth obnovení.</span><span class="sxs-lookup"><span data-stu-id="23851-109">For success with recovery tooanother data region using either active geo-replication or geo-redundant backups, you need tooprepare a server in another data center outage toobecome hello new primary server should hello need arise as well as have well-defined steps documented and tested tooensure a smooth recovery.</span></span> <span data-ttu-id="23851-110">Tyto kroky přípravy zahrnují:</span><span class="sxs-lookup"><span data-stu-id="23851-110">These preparation steps include:</span></span>

* <span data-ttu-id="23851-111">Identifikujte hello logický server v jiné oblasti toobecome hello novým primárním serverem.</span><span class="sxs-lookup"><span data-stu-id="23851-111">Identify hello logical server in another region toobecome hello new primary server.</span></span> <span data-ttu-id="23851-112">S aktivní geografickou replikací bude alespoň jeden a případně všechny sekundární servery hello.</span><span class="sxs-lookup"><span data-stu-id="23851-112">With active geo-replication, this will be at least one and perhaps each of hello secondary servers.</span></span> <span data-ttu-id="23851-113">U geografické obnovení, bude obvykle na server v hello [spárované oblast](../best-practices-availability-paired-regions.md) hello oblasti, ve kterém je umístěna databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-113">For geo-restore, this will generally be a server in hello [paired region](../best-practices-availability-paired-regions.md) for hello region in which your database is located.</span></span>
* <span data-ttu-id="23851-114">Identifikovat a volitelně můžete definovat, pravidla brány firewall na úrovni serveru hello potřeby na pro uživatele tooaccess hello nové primární databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-114">Identify, and optionally define, hello server-level firewall rules needed on for users tooaccess hello new primary database.</span></span>
* <span data-ttu-id="23851-115">Zjistěte, jak budete tooredirect uživatelé toohello novým primárním serverem, například změnou připojovací řetězce nebo tak, že změníte záznamy DNS.</span><span class="sxs-lookup"><span data-stu-id="23851-115">Determine how you are going tooredirect users toohello new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="23851-116">Identifikovat a volitelně vytvořit, hello přihlášení, které musí být k dispozici v hlavní databázi hello na hello novým primárním serverem a ujistěte se, že tyto přihlášení má příslušná oprávnění v hlavní databázi hello, pokud existuje.</span><span class="sxs-lookup"><span data-stu-id="23851-116">Identify, and optionally create, hello logins that must be present in hello master database on hello new primary server, and ensure these logins have appropriate permissions in hello master database, if any.</span></span> <span data-ttu-id="23851-117">Další informace najdete v tématu [zabezpečení SQL Database po zotavení po havárii](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="23851-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="23851-118">Určete pravidla výstrah, které bude nutné toobe aktualizované toomap toohello nové primární databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-118">Identify alert rules that will need toobe updated toomap toohello new primary database.</span></span>
* <span data-ttu-id="23851-119">Konfigurace auditování dokumentu hello na aktuální primární databázi hello</span><span class="sxs-lookup"><span data-stu-id="23851-119">Document hello auditing configuration on hello current primary database</span></span>
* <span data-ttu-id="23851-120">Provedení [postupu zotavení po havárii](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="23851-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="23851-121">toosimulate na výpadku pro geografické obnovení, můžete odstranit nebo přejmenovat připojení selhání toocause aplikace hello zdrojové databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-121">toosimulate an outage for geo-restore, you can delete or rename hello source database toocause application connectivity failure.</span></span> <span data-ttu-id="23851-122">toosimulate výpadku pro aktivní geografickou replikaci, můžete zakázat hello webovou aplikaci nebo virtuální počítač připojen toohello databáze nebo převzetí služeb při selhání hello databáze toocause aplikace chyby připojení.</span><span class="sxs-lookup"><span data-stu-id="23851-122">toosimulate an outage for active geo-replication, you can disable hello web application or virtual machine connected toohello database or failover hello database toocause application connectivity failures.</span></span>

## <a name="when-tooinitiate-recovery"></a><span data-ttu-id="23851-123">Při obnovení tooinitiate</span><span class="sxs-lookup"><span data-stu-id="23851-123">When tooinitiate recovery</span></span>
<span data-ttu-id="23851-124">operace obnovení Hello ovlivňuje aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="23851-124">hello recovery operation impacts hello application.</span></span> <span data-ttu-id="23851-125">Je potřeba změnit připojovací řetězec SQL hello nebo přesměrování pomocí DNS a může vést ke ztrátě trvalá data.</span><span class="sxs-lookup"><span data-stu-id="23851-125">It requires changing hello SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="23851-126">Proto je třeba jej provést jenom v případě výpadku hello je pravděpodobně toolast delší než plánovanou dobu obnovení vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="23851-126">Therefore, it should be done only when hello outage is likely toolast longer than your application's recovery time objective.</span></span> <span data-ttu-id="23851-127">Po hello aplikace nasazené tooproduction měli provádět pravidelné sledování stavu aplikací hello a použijte hello následující data, která je oprávněná tooassert body, které hello obnovení:</span><span class="sxs-lookup"><span data-stu-id="23851-127">When hello application is deployed tooproduction you should perform regular monitoring of hello application health and use hello following data points tooassert that hello recovery is warranted:</span></span>

1. <span data-ttu-id="23851-128">Selhání trvalé připojení ze hello aplikační vrstvy toohello databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-128">Permanent connectivity failure from hello application tier toohello database.</span></span>
2. <span data-ttu-id="23851-129">Hello portál Azure zobrazí výstrahu o incidentu v oblasti hello s dopadem na širokou.</span><span class="sxs-lookup"><span data-stu-id="23851-129">hello Azure portal shows an alert about an incident in hello region with broad impact.</span></span>
3. <span data-ttu-id="23851-130">server Azure SQL Database Hello je označen jako degradovaný.</span><span class="sxs-lookup"><span data-stu-id="23851-130">hello Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="23851-131">V závislosti na vaší aplikace tolerance toodowntime a jejich možná obchodní odpovědnosti můžete zvážit následující možnosti obnovení hello.</span><span class="sxs-lookup"><span data-stu-id="23851-131">Depending on your application tolerance toodowntime and possible business liability you can consider hello following recovery options.</span></span>

<span data-ttu-id="23851-132">Použití hello [získat obnovitelné databáze](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) nejnovější bod obnovení geograficky replikované tooget hello.</span><span class="sxs-lookup"><span data-stu-id="23851-132">Use hello [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) tooget hello latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="23851-133">Počkejte obnovení</span><span class="sxs-lookup"><span data-stu-id="23851-133">Wait for service recovery</span></span>
<span data-ttu-id="23851-134">Hello Azure týmy spolupracovat usilovně dostupnost služeb toorestore jak rychle co možná, ale v závislosti na hello příčiny může trvat hodiny nebo dny.</span><span class="sxs-lookup"><span data-stu-id="23851-134">hello Azure teams work diligently toorestore service availability as quickly as possible but depending on hello root cause it can take hours or days.</span></span>  <span data-ttu-id="23851-135">Pokud vaše aplikace může tolerovat významné výpadky je jednoduše vyčkat toocomplete obnovení hello.</span><span class="sxs-lookup"><span data-stu-id="23851-135">If your application can tolerate significant downtime you can simply wait for hello recovery toocomplete.</span></span> <span data-ttu-id="23851-136">V takovém případě není třeba žádné akce z vaší strany.</span><span class="sxs-lookup"><span data-stu-id="23851-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="23851-137">Zobrazí aktuální stav služby hello na našem [řídicím panelu stavu služeb Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="23851-137">You can see hello current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="23851-138">Po obnovení hello hello oblasti se obnoví dostupnosti vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="23851-138">After hello recovery of hello region your application’s availability will be restored.</span></span>

## <a name="fail-over-toogeo-replicated-secondary-database"></a><span data-ttu-id="23851-139">Selhání toogeo replikované sekundární databáze</span><span class="sxs-lookup"><span data-stu-id="23851-139">Fail over toogeo-replicated secondary database</span></span>
<span data-ttu-id="23851-140">Pokud obchodní odpovědnosti může způsobit výpadek vaší aplikace by měla být pomocí geograficky replikované databáze v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="23851-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="23851-141">Povolí dostupnosti obnovení tooquickly hello aplikace v jiné oblasti v případě výpadku.</span><span class="sxs-lookup"><span data-stu-id="23851-141">It will enable hello application tooquickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="23851-142">Zjistěte, jak příliš[konfigurace geografická replikace](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="23851-142">Learn how too[configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="23851-143">dostupnost toorestore hello database(s) budete potřebovat tooinitiate hello sekundární geograficky replikované společnosti převzetí služeb při selhání toohello pomocí jedné z metod hello podporována.</span><span class="sxs-lookup"><span data-stu-id="23851-143">toorestore availability of hello database(s) you need tooinitiate hello failover toohello geo-replicated secondary using one of hello supported methods.</span></span>

<span data-ttu-id="23851-144">Použijte jednu z následujících průvodců toofail přes tooa geograficky replikované sekundární databáze hello:</span><span class="sxs-lookup"><span data-stu-id="23851-144">Use one of hello following guides toofail over tooa geo-replicated secondary database:</span></span>

* [<span data-ttu-id="23851-145">Selhání tooa geograficky replikované sekundární pomocí portálu Azure</span><span class="sxs-lookup"><span data-stu-id="23851-145">Fail over tooa geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="23851-146">Převzetí služeb při selhání tooa geograficky replikované sekundární pomocí prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="23851-146">Fail over tooa geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="23851-147">Selhání tooa geograficky replikované sekundární pomocí T-SQL</span><span class="sxs-lookup"><span data-stu-id="23851-147">Fail over tooa geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="23851-148">Obnovit pomocí geografické obnovení</span><span class="sxs-lookup"><span data-stu-id="23851-148">Recover using geo-restore</span></span>
<span data-ttu-id="23851-149">Pokud aplikace výpadek nevede odpovědnosti firmy můžete použít [geografické obnovení](sql-database-recovery-using-backups.md) jako metoda toorecover databází vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="23851-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method toorecover your application database(s).</span></span> <span data-ttu-id="23851-150">Vytvoří kopii databáze hello z jeho nejnovější geograficky redundantní zálohy.</span><span class="sxs-lookup"><span data-stu-id="23851-150">It creates a copy of hello database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="23851-151">Nakonfigurujte databázi po obnovení</span><span class="sxs-lookup"><span data-stu-id="23851-151">Configure your database after recovery</span></span>
<span data-ttu-id="23851-152">Pokud používáte geografická replikace převzetí služeb při selhání nebo geografické obnovení toorecover výpadku, musí se ujistěte, že hello připojení toohello nové databáze je správně nakonfigurované tak, aby funkce normální aplikace hello lze obnovit.</span><span class="sxs-lookup"><span data-stu-id="23851-152">If you are using either geo-replication failover or geo-restore toorecover from an outage, you must make sure that hello connectivity toohello new databases is properly configured so that hello normal application function can be resumed.</span></span> <span data-ttu-id="23851-153">To je kontrolní seznam úloh tooget připraven provozním obnovené databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-153">This is a checklist of tasks tooget your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="23851-154">Aktualizovat připojovací řetězce</span><span class="sxs-lookup"><span data-stu-id="23851-154">Update connection strings</span></span>
<span data-ttu-id="23851-155">Protože obnovené databáze se bude nacházet v jiném serveru, musíte tooupdate vaší aplikace připojovací řetězec toopoint toothat serveru.</span><span class="sxs-lookup"><span data-stu-id="23851-155">Because your recovered database will reside in a different server, you need tooupdate your application’s connection string toopoint toothat server.</span></span>

<span data-ttu-id="23851-156">Další informace o změně připojovací řetězce, najdete v části hello příslušném vývojovém jazyk pro vaše [knihovnu připojení](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="23851-156">For more information about changing connection strings, see hello appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="23851-157">Konfigurace pravidel brány Firewall</span><span class="sxs-lookup"><span data-stu-id="23851-157">Configure Firewall Rules</span></span>
<span data-ttu-id="23851-158">Je nutné toomake konfigurováno hello pravidla brány firewall na serveru a na shodu databáze hello ty, které byly nakonfigurovány na primární server hello a primární databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-158">You need toomake sure that hello firewall rules configured on server and on hello database match those that were configured on hello primary server and primary database.</span></span> <span data-ttu-id="23851-159">Další informace najdete v tématu [postupy: Konfigurace nastavení brány Firewall (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="23851-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="23851-160">Konfigurace přihlášení a uživatele databáze</span><span class="sxs-lookup"><span data-stu-id="23851-160">Configure logins and database users</span></span>
<span data-ttu-id="23851-161">Je nutné toomake jistotu, že všechny přihlášení hello používá vaše aplikace existuje v hello serveru, který je hostitelem obnovené databáze.</span><span class="sxs-lookup"><span data-stu-id="23851-161">You need toomake sure that all hello logins used by your application exist on hello server which is hosting your recovered database.</span></span> <span data-ttu-id="23851-162">Další informace najdete v tématu [konfigurace zabezpečení pro geografická replikace](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="23851-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="23851-163">Měli konfigurace a otestování vašich pravidlech brány firewall serveru a přihlášení (a jejich oprávnění) během postupu zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="23851-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="23851-164">Tyto objekty na úrovni serveru a jejich konfigurace nemusí být k dispozici při výpadku hello.</span><span class="sxs-lookup"><span data-stu-id="23851-164">These server-level objects and their configuration may not be available during hello outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="23851-165">Instalační program telemetrie výstrahy</span><span class="sxs-lookup"><span data-stu-id="23851-165">Setup telemetry alerts</span></span>
<span data-ttu-id="23851-166">Je nutné toomake se, že nastavení existující pravidlo výstrahy jsou aktualizované toomap toohello obnovené databáze a hello jiný server.</span><span class="sxs-lookup"><span data-stu-id="23851-166">You need toomake sure your existing alert rule settings are updated toomap toohello recovered database and hello different server.</span></span>

<span data-ttu-id="23851-167">Další informace o databázi pravidla výstrah najdete v tématu [přijímat oznámení výstrahy](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) a [sledovat stav služeb](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="23851-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="23851-168">Povolení auditování</span><span class="sxs-lookup"><span data-stu-id="23851-168">Enable auditing</span></span>
<span data-ttu-id="23851-169">Pokud auditování je požadovaná tooaccess vaší databáze, je nutné tooenable auditování po obnovení databáze hello.</span><span class="sxs-lookup"><span data-stu-id="23851-169">If auditing is required tooaccess your database, you need tooenable Auditing after hello database recovery.</span></span> <span data-ttu-id="23851-170">Další informace najdete v tématu [auditování databáze](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="23851-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="23851-171">Další kroky</span><span class="sxs-lookup"><span data-stu-id="23851-171">Next steps</span></span>
* <span data-ttu-id="23851-172">toolearn o zálohování Azure SQL Database automatizované, najdete v části [automatizované zálohování SQL Database](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="23851-172">toolearn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="23851-173">toolearn o kontinuity návrhu a obnovení v organizacích, najdete v části [kontinuity scénáře](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="23851-173">toolearn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="23851-174">toolearn o použití automatizované zálohování pro obnovení, najdete v části [obnovit databázi ze zálohy spouštěná služba hello](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="23851-174">toolearn about using automated backups for recovery, see [restore a database from hello service-initiated backups](sql-database-recovery-using-backups.md)</span></span>


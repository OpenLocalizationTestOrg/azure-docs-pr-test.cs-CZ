---
title: "Zotavení po havárii pro databáze SQL | Microsoft Docs"
description: "Naučte se obnovit databázi z místního datového centra výpadku nebo chyby s Azure SQL Database aktivní geografickou replikaci a možnosti geografické obnovení."
services: sql-database
documentationcenter: 
author: anosov1960
manager: jhubbard
editor: monicar
ms.assetid: 4800960e-3f9d-40ce-9e55-fb7f2784c067
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/14/2017
ms.author: sashan
ms.openlocfilehash: e33f69bf04b32a31aae3c311c41aa44e4da5016a
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="restore-an-azure-sql-database-or-failover-to-a-secondary"></a><span data-ttu-id="05611-103">Obnova databáze SQL Azure nebo převzetí služeb při selhání na sekundární</span><span class="sxs-lookup"><span data-stu-id="05611-103">Restore an Azure SQL Database or failover to a secondary</span></span>
<span data-ttu-id="05611-104">Azure SQL Database nabízí následující možnosti pro zotavení po výpadku:</span><span class="sxs-lookup"><span data-stu-id="05611-104">Azure SQL Database offers the following capabilities for recovering from an outage:</span></span>

* [<span data-ttu-id="05611-105">Aktivní geografická replikace</span><span class="sxs-lookup"><span data-stu-id="05611-105">Active geo-replication</span></span>](sql-database-geo-replication-overview.md)
* [<span data-ttu-id="05611-106">Geografické obnovení</span><span class="sxs-lookup"><span data-stu-id="05611-106">Geo-restore</span></span>](sql-database-recovery-using-backups.md#point-in-time-restore)

<span data-ttu-id="05611-107">Další informace o obchodních scénářů kontinuity a podpora těchto scénářů funkcí najdete v tématu [kontinuity podnikových procesů](sql-database-business-continuity.md).</span><span class="sxs-lookup"><span data-stu-id="05611-107">To learn about business continuity scenarios and the features supporting these scenarios, see [Business continuity](sql-database-business-continuity.md).</span></span>

### <a name="prepare-for-the-event-of-an-outage"></a><span data-ttu-id="05611-108">Příprava pro událost výpadku</span><span class="sxs-lookup"><span data-stu-id="05611-108">Prepare for the event of an outage</span></span>
<span data-ttu-id="05611-109">Pro úspěšné dokončení obnovení na jiné datové oblasti pomocí aktivní geografickou replikaci nebo geograficky redundantní zálohy, je nutné připravit server v jiném datovém centru výpadku stane novým primárním serverem by potřeba nastat a také mít dobře definované kroky zdokumentované a otestovat zajistit bezproblémovou obnovení.</span><span class="sxs-lookup"><span data-stu-id="05611-109">For success with recovery to another data region using either active geo-replication or geo-redundant backups, you need to prepare a server in another data center outage to become the new primary server should the need arise as well as have well-defined steps documented and tested to ensure a smooth recovery.</span></span> <span data-ttu-id="05611-110">Tyto kroky přípravy zahrnují:</span><span class="sxs-lookup"><span data-stu-id="05611-110">These preparation steps include:</span></span>

* <span data-ttu-id="05611-111">Identifikujte logický server v jiné oblasti stane novým primárním serverem.</span><span class="sxs-lookup"><span data-stu-id="05611-111">Identify the logical server in another region to become the new primary server.</span></span> <span data-ttu-id="05611-112">S aktivní geografickou replikací bude alespoň jeden a případně všechny sekundární servery.</span><span class="sxs-lookup"><span data-stu-id="05611-112">With active geo-replication, this will be at least one and perhaps each of the secondary servers.</span></span> <span data-ttu-id="05611-113">U geografické obnovení, bude obvykle na server v [spárované oblast](../best-practices-availability-paired-regions.md) pro oblast, ve kterém je umístěna databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-113">For geo-restore, this will generally be a server in the [paired region](../best-practices-availability-paired-regions.md) for the region in which your database is located.</span></span>
* <span data-ttu-id="05611-114">Identifikovat a volitelně můžete definovat pravidla brány firewall na úrovni serveru, na potřeba uživatelům přístup k nové primární databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-114">Identify, and optionally define, the server-level firewall rules needed on for users to access the new primary database.</span></span>
* <span data-ttu-id="05611-115">Zjistěte, jak chcete přesměrovat uživatele na nový primární server, jako třeba změnou připojovací řetězce nebo tak, že změníte záznamy DNS.</span><span class="sxs-lookup"><span data-stu-id="05611-115">Determine how you are going to redirect users to the new primary server, such as by changing connection strings or by changing DNS entries.</span></span>
* <span data-ttu-id="05611-116">Identifikovat a volitelně vytvořte přihlášení, které musí být k dispozici v hlavní databázi na nový primární server a ujistěte se, že tyto přihlášení má příslušná oprávnění v hlavní databázi, pokud existuje.</span><span class="sxs-lookup"><span data-stu-id="05611-116">Identify, and optionally create, the logins that must be present in the master database on the new primary server, and ensure these logins have appropriate permissions in the master database, if any.</span></span> <span data-ttu-id="05611-117">Další informace najdete v tématu [zabezpečení SQL Database po zotavení po havárii](sql-database-geo-replication-security-config.md)</span><span class="sxs-lookup"><span data-stu-id="05611-117">For more information, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md)</span></span>
* <span data-ttu-id="05611-118">Určete pravidla výstrah, které bude potřeba aktualizovat k mapování na nový primární databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-118">Identify alert rules that will need to be updated to map to the new primary database.</span></span>
* <span data-ttu-id="05611-119">Konfigurace auditování v aktuální primární databázi dokumentů</span><span class="sxs-lookup"><span data-stu-id="05611-119">Document the auditing configuration on the current primary database</span></span>
* <span data-ttu-id="05611-120">Provedení [postupu zotavení po havárii](sql-database-disaster-recovery-drills.md).</span><span class="sxs-lookup"><span data-stu-id="05611-120">Perform a [disaster recovery drill](sql-database-disaster-recovery-drills.md).</span></span> <span data-ttu-id="05611-121">Pro simulaci výpadku pro geografické obnovení, můžete odstranit nebo přejmenovat databázi zdrojové způsobí selhání připojení aplikace.</span><span class="sxs-lookup"><span data-stu-id="05611-121">To simulate an outage for geo-restore, you can delete or rename the source database to cause application connectivity failure.</span></span> <span data-ttu-id="05611-122">Pro simulaci výpadku pro aktivní geografickou replikaci, můžete zakázat webové aplikace nebo virtuálního počítače připojené k databázi nebo databázi převzetí služeb při selhání dojít k chybám připojení aplikace.</span><span class="sxs-lookup"><span data-stu-id="05611-122">To simulate an outage for active geo-replication, you can disable the web application or virtual machine connected to the database or failover the database to cause application connectivity failures.</span></span>

## <a name="when-to-initiate-recovery"></a><span data-ttu-id="05611-123">Když zahájíte obnovení</span><span class="sxs-lookup"><span data-stu-id="05611-123">When to initiate recovery</span></span>
<span data-ttu-id="05611-124">Aplikace má dopad na operaci obnovení.</span><span class="sxs-lookup"><span data-stu-id="05611-124">The recovery operation impacts the application.</span></span> <span data-ttu-id="05611-125">Je potřeba změnit připojovací řetězec SQL nebo přesměrování pomocí DNS a může vést ke ztrátě trvalá data.</span><span class="sxs-lookup"><span data-stu-id="05611-125">It requires changing the SQL connection string or redirection using DNS and could result in permanent data loss.</span></span> <span data-ttu-id="05611-126">Proto by měl v době, kdy se výpadek je pravděpodobně poslední déle, než plánovanou dobu obnovení vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="05611-126">Therefore, it should be done only when the outage is likely to last longer than your application's recovery time objective.</span></span> <span data-ttu-id="05611-127">Při nasazení aplikace do produkčního prostředí doporučujeme provádět pravidelné sledování stavu aplikací a použít k vyhodnocení, zda je oprávněná obnovení těchto datových bodů:</span><span class="sxs-lookup"><span data-stu-id="05611-127">When the application is deployed to production you should perform regular monitoring of the application health and use the following data points to assert that the recovery is warranted:</span></span>

1. <span data-ttu-id="05611-128">Chyba trvalé připojení z aplikační vrstvě do databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-128">Permanent connectivity failure from the application tier to the database.</span></span>
2. <span data-ttu-id="05611-129">Portál Azure zobrazí výstrahu o incidentu v oblasti s dopadem na širokou.</span><span class="sxs-lookup"><span data-stu-id="05611-129">The Azure portal shows an alert about an incident in the region with broad impact.</span></span>
3. <span data-ttu-id="05611-130">Server Azure SQL Database je označen jako degradovaný.</span><span class="sxs-lookup"><span data-stu-id="05611-130">The Azure SQL Database server is marked as degraded.</span></span>

<span data-ttu-id="05611-131">V závislosti na vaší aplikace tolerance k výpadku a jejich možná obchodní odpovědnosti můžete zvážit následující možnosti obnovení.</span><span class="sxs-lookup"><span data-stu-id="05611-131">Depending on your application tolerance to downtime and possible business liability you can consider the following recovery options.</span></span>

<span data-ttu-id="05611-132">Použití [získat obnovitelné databáze](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) Chcete-li získat nejnovější bod obnovení geograficky replikované.</span><span class="sxs-lookup"><span data-stu-id="05611-132">Use the [Get Recoverable Database](https://msdn.microsoft.com/library/dn800985.aspx) (*LastAvailableBackupDate*) to get the latest Geo-replicated restore point.</span></span>

## <a name="wait-for-service-recovery"></a><span data-ttu-id="05611-133">Počkejte obnovení</span><span class="sxs-lookup"><span data-stu-id="05611-133">Wait for service recovery</span></span>
<span data-ttu-id="05611-134">Pracovní týmy Azure usilovně k obnovení dostupnost služby, jak rychle co možná, ale v závislosti na kořenovém způsobit, že může trvat hodiny nebo dny.</span><span class="sxs-lookup"><span data-stu-id="05611-134">The Azure teams work diligently to restore service availability as quickly as possible but depending on the root cause it can take hours or days.</span></span>  <span data-ttu-id="05611-135">Pokud vaše aplikace může tolerovat významné výpadky je jednoduše počkat na dokončení obnovení.</span><span class="sxs-lookup"><span data-stu-id="05611-135">If your application can tolerate significant downtime you can simply wait for the recovery to complete.</span></span> <span data-ttu-id="05611-136">V takovém případě není třeba žádné akce z vaší strany.</span><span class="sxs-lookup"><span data-stu-id="05611-136">In this case, no action on your part is required.</span></span> <span data-ttu-id="05611-137">Zobrazí aktuální stav služby na našem [řídicím panelu stavu služeb Azure](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="05611-137">You can see the current service status on our [Azure Service Health Dashboard](https://azure.microsoft.com/status/).</span></span> <span data-ttu-id="05611-138">Po obnovení oblasti se obnoví dostupnosti vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="05611-138">After the recovery of the region your application’s availability will be restored.</span></span>

## <a name="fail-over-to-geo-replicated-secondary-database"></a><span data-ttu-id="05611-139">Převzetí služeb při selhání do geograficky replikované sekundární databáze</span><span class="sxs-lookup"><span data-stu-id="05611-139">Fail over to geo-replicated secondary database</span></span>
<span data-ttu-id="05611-140">Pokud obchodní odpovědnosti může způsobit výpadek vaší aplikace by měla být pomocí geograficky replikované databáze v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="05611-140">If your application’s downtime can result in business liability you should be using geo-replicated database(s) in your application.</span></span> <span data-ttu-id="05611-141">Umožní aplikaci pro rychlé obnovení dostupnosti v jiné oblasti v případě výpadku.</span><span class="sxs-lookup"><span data-stu-id="05611-141">It will enable the application to quickly restore availability in a different region in case of an outage.</span></span> <span data-ttu-id="05611-142">Zjistěte, jak [konfigurace geografická replikace](sql-database-geo-replication-portal.md).</span><span class="sxs-lookup"><span data-stu-id="05611-142">Learn how to [configure geo-replication](sql-database-geo-replication-portal.md).</span></span>

<span data-ttu-id="05611-143">Chcete-li obnovit dostupnosti databází, které potřebujete k zahájení převzetí služeb při selhání do geograficky replikované sekundární pomocí jedné z podporovaných metod.</span><span class="sxs-lookup"><span data-stu-id="05611-143">To restore availability of the database(s) you need to initiate the failover to the geo-replicated secondary using one of the supported methods.</span></span>

<span data-ttu-id="05611-144">K převzetí služeb při selhání do geograficky replikované sekundární databáze, použijte jednu z následujících příručkách:</span><span class="sxs-lookup"><span data-stu-id="05611-144">Use one of the following guides to fail over to a geo-replicated secondary database:</span></span>

* [<span data-ttu-id="05611-145">Převzetí služeb při selhání do geograficky replikované sekundární pomocí portálu Azure</span><span class="sxs-lookup"><span data-stu-id="05611-145">Fail over to a geo-replicated secondary using Azure Portal</span></span>](sql-database-geo-replication-portal.md)
* [<span data-ttu-id="05611-146">Převzetí služeb při selhání do geograficky replikované sekundární pomocí prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="05611-146">Fail over to a geo-replicated secondary using PowerShell</span></span>](scripts/sql-database-setup-geodr-and-failover-database-powershell.md)
* [<span data-ttu-id="05611-147">Převzetí služeb při selhání do geograficky replikované sekundární pomocí T-SQL</span><span class="sxs-lookup"><span data-stu-id="05611-147">Fail over to a geo-replicated secondary using T-SQL</span></span>](sql-database-geo-replication-transact-sql.md)

## <a name="recover-using-geo-restore"></a><span data-ttu-id="05611-148">Obnovit pomocí geografické obnovení</span><span class="sxs-lookup"><span data-stu-id="05611-148">Recover using geo-restore</span></span>
<span data-ttu-id="05611-149">Pokud aplikace výpadek nevede odpovědnosti firmy můžete použít [geografické obnovení](sql-database-recovery-using-backups.md) jako metodu obnovení databází vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="05611-149">If your application’s downtime does not result in business liability you can use [geo-restore](sql-database-recovery-using-backups.md) as a method to recover your application database(s).</span></span> <span data-ttu-id="05611-150">Vytvoří kopii databáze z jeho nejnovější geograficky redundantní zálohy.</span><span class="sxs-lookup"><span data-stu-id="05611-150">It creates a copy of the database from its latest geo-redundant backup.</span></span>

## <a name="configure-your-database-after-recovery"></a><span data-ttu-id="05611-151">Nakonfigurujte databázi po obnovení</span><span class="sxs-lookup"><span data-stu-id="05611-151">Configure your database after recovery</span></span>
<span data-ttu-id="05611-152">Pokud používáte geografická replikace převzetí služeb při selhání nebo geografické obnovení pro obnovení z výpadek, musí se ujistěte, že připojení k nové databáze je správně nakonfigurované tak, aby funkce normální aplikací lze obnovit.</span><span class="sxs-lookup"><span data-stu-id="05611-152">If you are using either geo-replication failover or geo-restore to recover from an outage, you must make sure that the connectivity to the new databases is properly configured so that the normal application function can be resumed.</span></span> <span data-ttu-id="05611-153">Toto je kontrolní seznam úloh připravit provozním obnovené databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-153">This is a checklist of tasks to get your recovered database production ready.</span></span>

### <a name="update-connection-strings"></a><span data-ttu-id="05611-154">Aktualizovat připojovací řetězce</span><span class="sxs-lookup"><span data-stu-id="05611-154">Update connection strings</span></span>
<span data-ttu-id="05611-155">Protože obnovené databáze se bude nacházet v jiném serveru, je potřeba aktualizovat připojovací řetězec vaší aplikace tak, aby odkazoval na tomto serveru.</span><span class="sxs-lookup"><span data-stu-id="05611-155">Because your recovered database will reside in a different server, you need to update your application’s connection string to point to that server.</span></span>

<span data-ttu-id="05611-156">Další informace o změně připojovací řetězce, najdete v příslušném vývojovém jazyk pro vaše [knihovnu připojení](sql-database-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="05611-156">For more information about changing connection strings, see the appropriate development language for your [connection library](sql-database-libraries.md).</span></span>

### <a name="configure-firewall-rules"></a><span data-ttu-id="05611-157">Konfigurace pravidel brány Firewall</span><span class="sxs-lookup"><span data-stu-id="05611-157">Configure Firewall Rules</span></span>
<span data-ttu-id="05611-158">Budete muset Ujistěte se, jestli pravidla brány firewall nakonfigurované na serveru a v databázi shodují s těmi, které byly nakonfigurované na primární server a primární databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-158">You need to make sure that the firewall rules configured on server and on the database match those that were configured on the primary server and primary database.</span></span> <span data-ttu-id="05611-159">Další informace najdete v tématu [postupy: Konfigurace nastavení brány Firewall (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span><span class="sxs-lookup"><span data-stu-id="05611-159">For more information, see [How to: Configure Firewall Settings (Azure SQL Database)](sql-database-configure-firewall-settings.md).</span></span>

### <a name="configure-logins-and-database-users"></a><span data-ttu-id="05611-160">Konfigurace přihlášení a uživatele databáze</span><span class="sxs-lookup"><span data-stu-id="05611-160">Configure logins and database users</span></span>
<span data-ttu-id="05611-161">Musíte zajistit, že všechny přihlášení, které používá vaše aplikace existuje v serveru, který je hostitelem obnovené databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-161">You need to make sure that all the logins used by your application exist on the server which is hosting your recovered database.</span></span> <span data-ttu-id="05611-162">Další informace najdete v tématu [konfigurace zabezpečení pro geografická replikace](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="05611-162">For more information, see [Security Configuration for geo-replication](sql-database-geo-replication-security-config.md).</span></span>

> [!NOTE]
> <span data-ttu-id="05611-163">Měli konfigurace a otestování vašich pravidlech brány firewall serveru a přihlášení (a jejich oprávnění) během postupu zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="05611-163">You should configure and test your server firewall rules and logins (and their permissions) during a disaster recovery drill.</span></span> <span data-ttu-id="05611-164">Tyto objekty na úrovni serveru a jejich konfigurace nemusí být k dispozici během se výpadek.</span><span class="sxs-lookup"><span data-stu-id="05611-164">These server-level objects and their configuration may not be available during the outage.</span></span>
> 
> 

### <a name="setup-telemetry-alerts"></a><span data-ttu-id="05611-165">Instalační program telemetrie výstrahy</span><span class="sxs-lookup"><span data-stu-id="05611-165">Setup telemetry alerts</span></span>
<span data-ttu-id="05611-166">Budete muset Ujistěte se, že nastavení existující pravidlo výstrahy jsou aktualizovány k mapování na obnovené databáze a jiný server.</span><span class="sxs-lookup"><span data-stu-id="05611-166">You need to make sure your existing alert rule settings are updated to map to the recovered database and the different server.</span></span>

<span data-ttu-id="05611-167">Další informace o databázi pravidla výstrah najdete v tématu [přijímat oznámení výstrahy](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) a [sledovat stav služeb](../monitoring-and-diagnostics/insights-service-health.md).</span><span class="sxs-lookup"><span data-stu-id="05611-167">For more information about database alert rules, see [Receive Alert Notifications](../monitoring-and-diagnostics/insights-receive-alert-notifications.md) and [Track Service Health](../monitoring-and-diagnostics/insights-service-health.md).</span></span>

### <a name="enable-auditing"></a><span data-ttu-id="05611-168">Povolení auditování</span><span class="sxs-lookup"><span data-stu-id="05611-168">Enable auditing</span></span>
<span data-ttu-id="05611-169">Pokud auditování je nutné pro přístup k databázi, budete muset povolit auditování po obnovení databáze.</span><span class="sxs-lookup"><span data-stu-id="05611-169">If auditing is required to access your database, you need to enable Auditing after the database recovery.</span></span> <span data-ttu-id="05611-170">Další informace najdete v tématu [auditování databáze](sql-database-auditing.md).</span><span class="sxs-lookup"><span data-stu-id="05611-170">For more information, see [Database auditing](sql-database-auditing.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="05611-171">Další kroky</span><span class="sxs-lookup"><span data-stu-id="05611-171">Next steps</span></span>
* <span data-ttu-id="05611-172">Další informace o Azure SQL Database automatizované zálohování najdete v tématu [automatizované zálohování SQL Database](sql-database-automated-backups.md)</span><span class="sxs-lookup"><span data-stu-id="05611-172">To learn about Azure SQL Database automated backups, see [SQL Database automated backups](sql-database-automated-backups.md)</span></span>
* <span data-ttu-id="05611-173">Další informace o obchodních scénářů návrhu a obnovení kontinuity najdete v tématu [kontinuity scénáře](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="05611-173">To learn about business continuity design and recovery scenarios, see [Continuity scenarios](sql-database-business-continuity.md)</span></span>
* <span data-ttu-id="05611-174">Další informace o použití automatizované zálohování pro obnovení, najdete v části [obnovit databázi ze zálohy spouštěná služba](sql-database-recovery-using-backups.md)</span><span class="sxs-lookup"><span data-stu-id="05611-174">To learn about using automated backups for recovery, see [restore a database from the service-initiated backups](sql-database-recovery-using-backups.md)</span></span>


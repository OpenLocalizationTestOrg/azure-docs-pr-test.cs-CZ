---
title: "Správa schématu Azure SQL Database v aplikaci s více tenanty | Dokumentace Microsoftu"
description: "Správa schématu pro více tenantů v aplikaci s více tenanty využívající službu Azure SQL Database"
keywords: kurz k sql database
services: sql-database
documentationcenter: 
author: stevestein
manager: jhubbard
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/28/2017
ms.author: billgib; sstein
ms.openlocfilehash: 78d76efb88bf11fa18a416b59e6f881539141232
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="manage-schema-for-multiple-tenants-in-the-wingtip-saas-application"></a><span data-ttu-id="cd1d8-104">Správa schématu pro více klientů v Wingtip SaaS aplikace</span><span class="sxs-lookup"><span data-stu-id="cd1d8-104">Manage schema for multiple tenants in the Wingtip SaaS application</span></span>

<span data-ttu-id="cd1d8-105">[První kurz Wingtip SaaS](sql-database-saas-tutorial.md) ukazuje, jak zřídit databázi klienta a zaregistrovat v katalogu aplikací.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-105">The [first Wingtip SaaS tutorial](sql-database-saas-tutorial.md) shows how the app can provision a tenant database and register it in the catalog.</span></span> <span data-ttu-id="cd1d8-106">Všechny aplikace, jako je aplikace Wingtip SaaS bude v průběhu času vyvíjejí a v některých případech bude vyžadovat změny databáze.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-106">Like any application, the Wingtip SaaS app will evolve over time, and at times will require changes to the database.</span></span> <span data-ttu-id="cd1d8-107">Změny se mohou týkat nového nebo změněného schématu, nových nebo změněných referenčních dat a úloh spojených s pravidelnou údržbou databáze, které zajišťují optimální výkon aplikace.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-107">Changes may include new or changed schema, new or changed reference data, and routine database maintenance tasks to ensure optimal app performance.</span></span> <span data-ttu-id="cd1d8-108">U SaaS aplikace musí být tyto změny nasazeny koordinovaně u potenciálně velkého počtu klientských databází.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-108">With a SaaS application, these changes need to be deployed in a coordinated manner across a potentially massive fleet of tenant databases.</span></span> <span data-ttu-id="cd1d8-109">Pro tyto změny se v budoucnu klienta databáze musí být součástí procesu zřizování.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-109">For these changes to be in future tenant databases, they need to be incorporated into the provisioning process.</span></span>

<span data-ttu-id="cd1d8-110">Tento kurz zkoumá dva scénáře: nasazení aktualizací referenčních dat u všech tenantů a opětovné ladění indexu u tabulky, která obsahuje referenční data.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-110">This tutorial explores two scenarios - deploying reference data updates for all tenants, and retuning an index on the table containing the reference data.</span></span> <span data-ttu-id="cd1d8-111">[Elastické úlohy](sql-database-elastic-jobs-overview.md) funkce se používá k provedení těchto operací napříč všech klientů a *zlaté* klienta databáze, která se používá jako šablonu pro nové databáze.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-111">The [Elastic jobs](sql-database-elastic-jobs-overview.md) feature is used to execute these operations across all tenants, and the *golden* tenant database that is used as a template for new databases.</span></span>

<span data-ttu-id="cd1d8-112">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="cd1d8-112">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="cd1d8-113">Vytvoření účtu úlohy</span><span class="sxs-lookup"><span data-stu-id="cd1d8-113">Create a job account</span></span>
> * <span data-ttu-id="cd1d8-114">Dotazování mezi několik klientů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-114">Query across multiple tenants</span></span>
> * <span data-ttu-id="cd1d8-115">Aktualizovat data ve všech databázích tenantů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-115">Update data in all tenant databases</span></span>
> * <span data-ttu-id="cd1d8-116">Vytvořit index tabulky ve všech databázích tenantů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-116">Create an index on a table in all tenant databases</span></span>


<span data-ttu-id="cd1d8-117">Předpokladem dokončení tohoto kurzu je splnění následujících požadavků:</span><span class="sxs-lookup"><span data-stu-id="cd1d8-117">To complete this tutorial, make sure the following prerequisites are met:</span></span>

* <span data-ttu-id="cd1d8-118">Adresář Wingtip SaaS aplikace je nasazená.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-118">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="cd1d8-119">Nasazení za méně než pět minut najdete v tématu [nasazení a seznamte se s Wingtip SaaS aplikace](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="cd1d8-119">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="cd1d8-120">Je nainstalované prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-120">Azure PowerShell is installed.</span></span> <span data-ttu-id="cd1d8-121">Podrobnosti najdete v článku [Začínáme s prostředím Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="cd1d8-121">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>
* <span data-ttu-id="cd1d8-122">Je nainstalovaná nejnovější verze SQL Server Management Studia (SSMS).</span><span class="sxs-lookup"><span data-stu-id="cd1d8-122">The latest version of SQL Server Management Studio (SSMS) is installed.</span></span> [<span data-ttu-id="cd1d8-123">Stažení a instalace SSMS</span><span class="sxs-lookup"><span data-stu-id="cd1d8-123">Download and Install SSMS</span></span>](https://docs.microsoft.com/sql/ssms/download-sql-server-management-studio-ssms)

<span data-ttu-id="cd1d8-124">*Tento kurz používá funkce služby SQL Database, které fungují ve verzi Limited Preview (úlohy služby Elastic Database). Pokud chcete tento kurz absolvovat, pošlete ID svého předplatného na SaaSFeedback@microsoft.com. Jako předmět uveďte Elastic Jobs Preview. Jakmile dostanete potvrzení o aktivaci vašeho předplatného, [stáhněte a nainstalujte si nejnovější předběžnou verzi rutin úloh](https://github.com/jaredmoo/azure-powershell/releases). Tato předběžná verze je omezená, takže obraťte se na SaaSFeedback@microsoft.com pro dotazy související s ani nepodporuje.*</span><span class="sxs-lookup"><span data-stu-id="cd1d8-124">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>


## <a name="introduction-to-saas-schema-management-patterns"></a><span data-ttu-id="cd1d8-125">Úvod do principu správy schématu SaaS</span><span class="sxs-lookup"><span data-stu-id="cd1d8-125">Introduction to SaaS Schema Management patterns</span></span>

<span data-ttu-id="cd1d8-126">Princip jednoho tenanta na databázi SaaS má řadu výhod, které vyplývají z výsledné izolace dat, ale současně přináší další komplikace spojené s údržbou a správou mnoha databází.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-126">The single tenant per database SaaS pattern benefits in many ways from the data isolation that results, but at the same time introduces the additional complexity of maintaining and managing many databases.</span></span> <span data-ttu-id="cd1d8-127">Služba [Elastic Jobs](sql-database-elastic-jobs-overview.md) usnadňuje správu a řízení datové vrstvy SQL.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-127">[Elastic Jobs](sql-database-elastic-jobs-overview.md) facilitates administration and management of the SQL data tier.</span></span> <span data-ttu-id="cd1d8-128">Úlohy umožňují bezpečně a spolehlivě spouštět na skupině databází úkoly (skripty T-SQL), a to nezávisle na interakci nebo vstupech uživatele.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-128">Jobs enable you to securely and reliably, run tasks (T-SQL scripts) independent of user interaction or input, against a group of databases.</span></span> <span data-ttu-id="cd1d8-129">Tento způsob je možné použít k nasazení schématu a k běžným změnám referenčních dat u všech tenantů v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-129">This method can be used to deploy schema and common reference data changes across all tenants in an application.</span></span> <span data-ttu-id="cd1d8-130">Službu Elastic Jobs můžete použít k údržbě *zlaté* kopie databáze, která slouží k vytváření nových tenantů, aby se vždy použilo nejnovější schéma a nejnovější referenční data.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-130">Elastic Jobs can also be used to maintain a *golden* copy of the database used to create new tenants, ensuring it always has the latest schema and reference data.</span></span>

![obrazovka](media/sql-database-saas-tutorial-schema-management/schema-management.png)


## <a name="elastic-jobs-limited-preview"></a><span data-ttu-id="cd1d8-132">Elastic Jobs verze Limited Preview</span><span class="sxs-lookup"><span data-stu-id="cd1d8-132">Elastic Jobs limited preview</span></span>

<span data-ttu-id="cd1d8-133">K dispozici je nová verze služby Elastic Jobs. Jde o integrovanou funkci Azure SQL Database, která nevyžaduje další služby ani součásti.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-133">There is a new version of Elastic Jobs that is now an integrated feature of Azure SQL Database (that requires no additional services or components).</span></span> <span data-ttu-id="cd1d8-134">Tato nová verze služby Elastic Jobs je v současnosti ve verzi Limited Preview.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-134">This new version of Elastic Jobs is currently in limited preview.</span></span> <span data-ttu-id="cd1d8-135">Verze Limited Preview v současnosti podporuje prostředí PowerShell, které umožňuje vytvářet účty úloh, a příkazy T-SQL, které umožňují vytvářet a spravovat úlohy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-135">This limited preview currently supports PowerShell to create job accounts, and T-SQL to create and manage jobs.</span></span>

> [!NOTE]
> <span data-ttu-id="cd1d8-136">*Tento kurz používá funkce služby SQL Database, které fungují ve verzi Limited Preview (úlohy služby Elastic Database). Pokud chcete tento kurz absolvovat, pošlete ID svého předplatného na SaaSFeedback@microsoft.com. Jako předmět uveďte Elastic Jobs Preview. Jakmile dostanete potvrzení o aktivaci vašeho předplatného, [stáhněte a nainstalujte si nejnovější předběžnou verzi rutin úloh](https://github.com/jaredmoo/azure-powershell/releases). Tato předběžná verze je omezená, takže obraťte se na SaaSFeedback@microsoft.com pro dotazy související s ani nepodporuje.*</span><span class="sxs-lookup"><span data-stu-id="cd1d8-136">*This tutorial uses features of the SQL Database service that are in a limited preview (Elastic Database jobs). If you wish to do this tutorial, provide your subscription id to SaaSFeedback@microsoft.com with subject=Elastic Jobs Preview. After you receive confirmation that your subscription has been enabled, [download and install the latest pre-release jobs cmdlets](https://github.com/jaredmoo/azure-powershell/releases). This preview is limited, so contact SaaSFeedback@microsoft.com for related questions or support.*</span></span>

## <a name="get-the-wingtip-application-scripts"></a><span data-ttu-id="cd1d8-137">Získání skriptů aplikace Wingtip</span><span class="sxs-lookup"><span data-stu-id="cd1d8-137">Get the Wingtip application scripts</span></span>

<span data-ttu-id="cd1d8-138">Adresář Wingtip SaaS skripty a zdrojový kód aplikace, které jsou k dispozici v [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) úložiště github.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-138">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="cd1d8-139">[Postup stažení skripty Wingtip SaaS](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="cd1d8-139">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="create-a-job-account-database-and-new-job-account"></a><span data-ttu-id="cd1d8-140">Vytvoření databáze účtu úlohy a nového účtu úlohy</span><span class="sxs-lookup"><span data-stu-id="cd1d8-140">Create a job account database and new job account</span></span>

<span data-ttu-id="cd1d8-141">Tento kurz vyžaduje, abyste k vytvoření databáze účtu úlohy a účtu úlohy použili PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-141">This tutorial requires you use PowerShell to create the job account database and job account.</span></span> <span data-ttu-id="cd1d8-142">Stejně jako MSDB a SQL Agent i služba Elastic Jobs ukládá definice úloh, stavy úloh a historii do Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-142">Like MSDB and SQL Agent, Elastic Jobs uses an Azure SQL database to store job definitions, job status, and history.</span></span> <span data-ttu-id="cd1d8-143">Jakmile vytvoříte účet úlohy, můžete hned začít vytvářet a monitorovat úlohy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-143">Once the job account is created, you can create and monitor jobs immediately.</span></span>

1. <span data-ttu-id="cd1d8-144">V **integrovaném skriptovacím prostředí (ISE) v prostředí PowerShell** otevřete skript ...\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-144">Open …\\Learning Modules\\Schema Management\\*Demo-SchemaManagement.ps1* in the **PowerShell ISE**.</span></span>
1. <span data-ttu-id="cd1d8-145">Stisknutím klávesy **F5** spusťte skript.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-145">Press **F5** to run the script.</span></span>

<span data-ttu-id="cd1d8-146">Skript *Demo-SchemaManagement.ps1* volá skript *Deploy-SchemaManagement.ps1*, který na serveru katalogu vytvoří databázi *S2* pojmenovanou **jobaccount**.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-146">The *Demo-SchemaManagement.ps1* script calls the *Deploy-SchemaManagement.ps1* script to create an *S2* database named **jobaccount** on the catalog server.</span></span> <span data-ttu-id="cd1d8-147">Tento skript pak vytvoří účet úlohy a předá databázi jobaccount jako parametr volání vytvoření účtu úlohy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-147">It then creates the job account, passing the jobaccount database as a parameter to the job account creation call.</span></span>

## <a name="create-a-job-to-deploy-new-reference-data-to-all-tenants"></a><span data-ttu-id="cd1d8-148">Vytvoření úlohy, která u všech tenantů nasadí nová referenční data</span><span class="sxs-lookup"><span data-stu-id="cd1d8-148">Create a job to deploy new reference data to all tenants</span></span>

<span data-ttu-id="cd1d8-149">Každá databáze tenanta zahrnuje sadu typů míst, které definují druh událostí hostovaných jako místo.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-149">Each tenant database includes a set of venue types that define the kind of events that are hosted at a venue.</span></span> <span data-ttu-id="cd1d8-150">V tomto příkladu nasadíte aktualizaci u všech databází tenantů. Aktualizace přidá dva další typy míst: *Motorcycle Racing* (Motocyklové závody) a *Swimming Club* (Plavecký klub).</span><span class="sxs-lookup"><span data-stu-id="cd1d8-150">In this exercise, you deploy an update to all the tenant databases to add two additional venue types: *Motorcycle Racing* and *Swimming Club*.</span></span> <span data-ttu-id="cd1d8-151">Tyto typy míst odpovídají obrázkům na pozadí zobrazeným v aplikaci událostí tenanta.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-151">These venue types correspond to the background image you see in the tenant events app.</span></span>

<span data-ttu-id="cd1d8-152">Klikněte na rozevírací nabídku Venue Type (Typ místa) a ověřte, že jako typ místa je k dispozici jen 10 možností. Konkrétně ověřte, že v seznamu není „Motorcycle Racing“ ani „Swimming Club“.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-152">Click the Venue Type drop down menu and validate that only 10 venue type options are available, and specifically that ‘Motorcycle Racing’ and ‘Swimming Club’ are not included in the list.</span></span>

<span data-ttu-id="cd1d8-153">Teď vytvoříte úlohu, která aktualizuje tabulku *VenueTypes* ve všech databázích tenantů a přidá do ní nové typy míst.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-153">Now let’s create a job to update the *VenueTypes* table in all the tenant databases and add the new venue types.</span></span>

<span data-ttu-id="cd1d8-154">K vytvoření nové úlohy použijeme sadu uložených systémových procedur úloh vytvořených v databázi jobaccount při vytvoření účtu úlohy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-154">To create a new job, we use a set of jobs system stored procedures created in the jobaccount database when the job account was created.</span></span>

1. <span data-ttu-id="cd1d8-155">Otevřete SSMS a připojte se k serveru katalogu: server catalog-\<uživatel\>.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="cd1d8-155">Open SSMS and connect to the catalog server: catalog-\<user\>.database.windows.net server</span></span>
1. <span data-ttu-id="cd1d8-156">Připojte se také k serveru tenanta: tenants1-\<uživatel\>.database.windows.net</span><span class="sxs-lookup"><span data-stu-id="cd1d8-156">Also connect to the tenant server: tenants1-\<user\>.database.windows.net</span></span>
1. <span data-ttu-id="cd1d8-157">Přejděte k databázi *contosoconcerthall* na serveru *tenants1* a zadejte dotaz do tabulky *VenueTypes*, abyste si potvrdili, že v seznamu výsledků **není** *Motorcycle Racing* ani *Swimming Club*.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-157">Browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are not** in the results list.</span></span>
1. <span data-ttu-id="cd1d8-158">Otevřete soubor …\\Learning Modules\\Schema Management\\DeployReferenceData.sql</span><span class="sxs-lookup"><span data-stu-id="cd1d8-158">Open the file …\\Learning Modules\\Schema Management\\DeployReferenceData.sql</span></span>
1. <span data-ttu-id="cd1d8-159">Upravit příkaz: nastavte @wtpUser = &lt;uživatele&gt; a nahraďte hodnotu uživatele použít při nasazení aplikace Wingtip</span><span class="sxs-lookup"><span data-stu-id="cd1d8-159">Modify the statement: SET @wtpUser = &lt;user&gt; and substitute the User value used when you deployed the Wingtip app</span></span>
1. <span data-ttu-id="cd1d8-160">Zkontrolujte, že jste připojeni k databázi jobaccount, a stisknutím klávesy **F5** spusťte skript.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-160">Ensure you are connected to the jobaccount database and press **F5** to run the script</span></span>

* <span data-ttu-id="cd1d8-161">**sp\_add\_target\_group** vytvoří cílovou skupinu s názvem DemoServerGroup. Teď potřebujeme přidat cílové členy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-161">**sp\_add\_target\_group** creates the target group name DemoServerGroup, now we need to add target members.</span></span>
* <span data-ttu-id="cd1d8-162">**SP\_přidat\_cíl\_skupiny\_člen** přidá *server* cíle typ člena, které považuje za všechny databáze v rámci tohoto serveru (Poznámka: Toto je tenants1-&lt; Uživatel&gt; server obsahující databáze klienta) v čase úlohy spuštění by měl být součástí úlohy, je přidání druhý *databáze* cíle typ člena, konkrétně "zlatá" databáze (basetenantdb) která se nachází v katalogu -&lt;uživatele&gt; serveru a nakonec jiné *databáze* cíle typ člena skupiny zahrnout adhocanalytics databázi, která se používá novější kurzu.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-162">**sp\_add\_target\_group\_member** adds a *server* target member type, which deems all databases within that server (note this is the tenants1-&lt;User&gt; server containing the tenant databases) at time of job execution should be included in the job, the second is adding a *database* target member type, specifically the ‘golden’ database (basetenantdb) that resides on catalog-&lt;User&gt; server, and lastly another *database* target group member type to include the adhocanalytics database that is used in a later tutorial.</span></span>
* <span data-ttu-id="cd1d8-163">**sp\_add\_job** vytvoří úlohu s názvem „Reference Data Deployment“.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-163">**sp\_add\_job** creates a job called “Reference Data Deployment”</span></span>
* <span data-ttu-id="cd1d8-164">**SP\_přidat\_krok úlohy** vytvoří krok úlohy obsahující text příkazů T-SQL aktualizovat na referenční tabulku VenueTypes</span><span class="sxs-lookup"><span data-stu-id="cd1d8-164">**sp\_add\_jobstep** creates the job step containing T-SQL command text to update the reference table, VenueTypes</span></span>
* <span data-ttu-id="cd1d8-165">Zbývající pohledy ve skriptu zobrazují existující objekty a monitorují provádění úlohy.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-165">The remaining views in the script display the existence of the objects and monitor job execution.</span></span> <span data-ttu-id="cd1d8-166">Ke kontrole hodnota stavu v použijte tyto dotazy **životního cyklu** sloupec k určení, kdy úloha úspěšně dokončil všechny databáze klienta a dva další databáze, které obsahují na referenční tabulku.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-166">Use these queries to review the status value in the **lifecycle** column to determine when the job has successfully finished on all tenant databases and the two additional databases containing the reference table.</span></span>

1. <span data-ttu-id="cd1d8-167">V SSMS přejděte k databázi *contosoconcerthall* na serveru *tenants1* a zadejte dotaz do tabulky *VenueTypes*, abyste si potvrdili, že v seznamu výsledků teď **je** *Motorcycle Racing* i *Swimming Club*.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-167">In SSMS, browse to the *contosoconcerthall* database on the *tenants1* server and query the *VenueTypes* table to confirm that *Motorcycle Racing* and *Swimming Club* **are** now in the results list.</span></span>


## <a name="create-a-job-to-manage-the-reference-table-index"></a><span data-ttu-id="cd1d8-168">Vytvoření úlohy pro správu indexu referenční tabulky</span><span class="sxs-lookup"><span data-stu-id="cd1d8-168">Create a job to manage the reference table index</span></span>

<span data-ttu-id="cd1d8-169">Jde o podobné cvičení, jako bylo to předchozí. V tomto cvičení vytvoříme úlohu, která znovu sestaví index primárního klíče referenční tabulky. Jde o typickou operaci při správě databáze, kterou správce většinou provádí po načtení velkého objemu dat do tabulky.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-169">Similar to the previous exercise, this exercise creates a job to rebuild the index on the reference table primary key, a typical database management operation an administrator might perform after a large data load into a table.</span></span>

<span data-ttu-id="cd1d8-170">K vytvoření úlohy použijeme stejné úlohy uložených procedur „system“.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-170">Create a job using the same jobs 'system' stored procedures.</span></span>

1. <span data-ttu-id="cd1d8-171">Otevřete aplikaci SSMS a připojte se k katalogu -&lt;uživatele&gt;. database.windows.net serveru</span><span class="sxs-lookup"><span data-stu-id="cd1d8-171">Open SSMS and connect to the catalog-&lt;User&gt;.database.windows.net server</span></span>
1. <span data-ttu-id="cd1d8-172">Otevřete soubor …\\Learning Modules\\Schema Management\\OnlineReindex.sql.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-172">Open the file …\\Learning Modules\\Schema Management\\OnlineReindex.sql</span></span>
1. <span data-ttu-id="cd1d8-173">Klikněte pravým tlačítkem, vyberte připojení a připojení ke katalogu -&lt;uživatele&gt;. database.windows.net serveru, pokud ještě není připojen.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-173">Right click, select Connection, and connect to the catalog-&lt;User&gt;.database.windows.net server, if not already connected</span></span>
1. <span data-ttu-id="cd1d8-174">Zkontrolujte, že jste připojeni k databázi jobaccount, a stisknutím klávesy F5 spusťte skript.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-174">Ensure you are connected to the jobaccount database and press F5 to run the script</span></span>

* <span data-ttu-id="cd1d8-175">sp\_add\_job vytvoří novou úlohu s názvem „Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885“.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-175">sp\_add\_job creates a new job called “Online Reindex PK\_\_VenueTyp\_\_265E44FD7FD4C885”</span></span>
* <span data-ttu-id="cd1d8-176">sp\_add\_jobstep vytvoří krok úlohy obsahující text příkazu T-SQL, který aktualizuje index.</span><span class="sxs-lookup"><span data-stu-id="cd1d8-176">sp\_add\_jobstep creates the job step containing T-SQL command text to update the index</span></span>




## <a name="next-steps"></a><span data-ttu-id="cd1d8-177">Další kroky</span><span class="sxs-lookup"><span data-stu-id="cd1d8-177">Next steps</span></span>

<span data-ttu-id="cd1d8-178">V tomto kurzu jste se naučili:</span><span class="sxs-lookup"><span data-stu-id="cd1d8-178">In this tutorial you learned how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="cd1d8-179">Vytvořit účet úlohy pro dotazy do více tenantů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-179">Create a job account to query across multiple tenants</span></span>
> * <span data-ttu-id="cd1d8-180">Aktualizovat data ve všech databázích tenantů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-180">Update data in all tenant databases</span></span>
> * <span data-ttu-id="cd1d8-181">Vytvořit index tabulky ve všech databázích tenantů</span><span class="sxs-lookup"><span data-stu-id="cd1d8-181">Create an index on a table in all tenant databases</span></span>

[<span data-ttu-id="cd1d8-182">Kurz náhodné analýzy</span><span class="sxs-lookup"><span data-stu-id="cd1d8-182">Ad-hoc analytics tutorial</span></span>](sql-database-saas-tutorial-adhoc-analytics.md)


## <a name="additional-resources"></a><span data-ttu-id="cd1d8-183">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="cd1d8-183">Additional resources</span></span>

* [<span data-ttu-id="cd1d8-184">Další kurzy, které stavět na adresář Wingtip SaaS nasazení aplikace</span><span class="sxs-lookup"><span data-stu-id="cd1d8-184">Additional tutorials that build upon the Wingtip SaaS application deployment</span></span>](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)
* [<span data-ttu-id="cd1d8-185">Správa cloudových databází s horizontálním navýšením kapacity</span><span class="sxs-lookup"><span data-stu-id="cd1d8-185">Managing scaled-out cloud databases</span></span>](sql-database-elastic-jobs-overview.md)
* [<span data-ttu-id="cd1d8-186">Vytvoření a správa databází s horizontálním navýšením kapacity</span><span class="sxs-lookup"><span data-stu-id="cd1d8-186">Create and manage scaled-out cloud databases</span></span>](sql-database-elastic-jobs-create-and-manage.md)

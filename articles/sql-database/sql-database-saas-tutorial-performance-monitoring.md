---
title: "Sledování výkonu mnoho databází Azure SQL v aplikaci SaaS víceklientské | Microsoft Docs"
description: "Sledování a správa výkonu databáze a fondy aplikací SaaS Wingtip databáze SQL Azure"
keywords: kurz k sql database
services: sql-database
documentationcenter: 
author: stevestein
manager: craigg
editor: 
ms.assetid: 
ms.service: sql-database
ms.custom: scale out apps
ms.workload: data-management
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/26/2017
ms.author: sstein
ms.openlocfilehash: 42f727aa40e744916b1a8adf634c10d55880bef0
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="monitor-performance-of-the-wingtip-saas-application"></a><span data-ttu-id="def72-104">Sledování výkonu Wingtip SaaS aplikace</span><span class="sxs-lookup"><span data-stu-id="def72-104">Monitor performance of the Wingtip SaaS application</span></span>

<span data-ttu-id="def72-105">V tomto kurzu jsou prozkoumali několik klíčových scénářů správy používány aplikací SaaS.</span><span class="sxs-lookup"><span data-stu-id="def72-105">In this tutorial, several key performance management scenarios used in SaaS applications are explored.</span></span> <span data-ttu-id="def72-106">Pomocí generátoru zatížení simulovat aktivity mezi všechny databáze klienta, integrované monitorování a výstrah funkce SQL Database a elastické fondy je ukázán.</span><span class="sxs-lookup"><span data-stu-id="def72-106">Using a load generator to simulate activity across all tenant databases, the built-in monitoring and alerting features of SQL Database and elastic pools are demonstrated.</span></span>

<span data-ttu-id="def72-107">Aplikace Wingtip SaaS používá klienta jeden datový model, kde každý místo (klient) má své vlastní databázi.</span><span class="sxs-lookup"><span data-stu-id="def72-107">The Wingtip SaaS app uses a single-tenant data model, where each venue (tenant) has their own database.</span></span> <span data-ttu-id="def72-108">Stejně jako u většiny aplikací SaaS je předpokládaný vzorek úloh tenanta nepředvídatelný a sporadický.</span><span class="sxs-lookup"><span data-stu-id="def72-108">Like many SaaS applications, the anticipated tenant workload pattern is unpredictable and sporadic.</span></span> <span data-ttu-id="def72-109">Jinými slovy to znamená, že prodej lístků může probíhat kdykoli.</span><span class="sxs-lookup"><span data-stu-id="def72-109">In other words, ticket sales may occur at any time.</span></span> <span data-ttu-id="def72-110">Abyste mohli využít výhod tohoto typického vzoru používání databáze, databáze tenantů se nasazují do elastických databázových fondů.</span><span class="sxs-lookup"><span data-stu-id="def72-110">To take advantage of this typical database usage pattern, tenant databases are deployed into elastic database pools.</span></span> <span data-ttu-id="def72-111">Elastické fondy optimalizují náklady na řešení prostřednictvím sdílení prostředků mezi mnoha databázemi.</span><span class="sxs-lookup"><span data-stu-id="def72-111">Elastic pools optimize the cost of a solution by sharing resources across many databases.</span></span> <span data-ttu-id="def72-112">S tímto typem vzorců je důležité monitorovat využití databáze a prostředků fondu k zajištění, že jsou přiměřeně vyvážená přetížení mezi jednotlivými fondy.</span><span class="sxs-lookup"><span data-stu-id="def72-112">With this type of pattern, it's important to monitor database and pool resource usage to ensure that loads are reasonably balanced across pools.</span></span> <span data-ttu-id="def72-113">Je také potřeba zajistit, že jednotlivé databáze mají adekvátní prostředky a že fondy nedosahují limitů [eDTU](sql-database-what-is-a-dtu.md).</span><span class="sxs-lookup"><span data-stu-id="def72-113">You also need to ensure that individual databases have adequate resources, and that pools are not hitting their [eDTU](sql-database-what-is-a-dtu.md) limits.</span></span> <span data-ttu-id="def72-114">Tento kurz se věnuje způsobům monitorování a správy databází a fondů a uvádí, jak se provádějí nápravné akce v reakci na variace v úloze.</span><span class="sxs-lookup"><span data-stu-id="def72-114">This tutorial explores ways to monitor and manage databases and pools, and how to take corrective action in response to variations in workload.</span></span>

<span data-ttu-id="def72-115">Co se v tomto kurzu naučíte:</span><span class="sxs-lookup"><span data-stu-id="def72-115">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]

> * <span data-ttu-id="def72-116">Simulace použití v databázích tenantů pomocí dodaného generátoru zatížení</span><span class="sxs-lookup"><span data-stu-id="def72-116">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="def72-117">Monitorování databází tenantů při reakci na zvýšení zatížení</span><span class="sxs-lookup"><span data-stu-id="def72-117">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="def72-118">Vertikální navýšení kapacity elastického fondu v reakci na zvýšení zatížení databáze</span><span class="sxs-lookup"><span data-stu-id="def72-118">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="def72-119">Zřízení druhého elastického fondu pro vyrovnání zatížení činnosti databáze</span><span class="sxs-lookup"><span data-stu-id="def72-119">Provision a second Elastic pool to load balance database activity</span></span>


<span data-ttu-id="def72-120">Předpokladem dokončení tohoto kurzu je splnění následujících požadavků:</span><span class="sxs-lookup"><span data-stu-id="def72-120">To complete this tutorial, make sure the following prerequisites are completed:</span></span>

* <span data-ttu-id="def72-121">Adresář Wingtip SaaS aplikace je nasazená.</span><span class="sxs-lookup"><span data-stu-id="def72-121">The Wingtip SaaS app is deployed.</span></span> <span data-ttu-id="def72-122">Nasazení za méně než pět minut najdete v tématu [nasazení a seznamte se s Wingtip SaaS aplikace](sql-database-saas-tutorial.md)</span><span class="sxs-lookup"><span data-stu-id="def72-122">To deploy in less than five minutes, see [Deploy and explore the Wingtip SaaS application](sql-database-saas-tutorial.md)</span></span>
* <span data-ttu-id="def72-123">Je nainstalované prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="def72-123">Azure PowerShell is installed.</span></span> <span data-ttu-id="def72-124">Podrobnosti najdete v článku [Začínáme s prostředím Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps).</span><span class="sxs-lookup"><span data-stu-id="def72-124">For details, see [Getting started with Azure PowerShell](https://docs.microsoft.com/powershell/azure/get-started-azureps)</span></span>

## <a name="introduction-to-saas-performance-management-patterns"></a><span data-ttu-id="def72-125">Úvod k modelům správy výkonu SaaS</span><span class="sxs-lookup"><span data-stu-id="def72-125">Introduction to SaaS performance management patterns</span></span>

<span data-ttu-id="def72-126">Správa výkonu databáze sestává z kompilování a analýz dat výkonu a následného reagování na tato data prostřednictvím úpravy parametrů pro řízení přijatelné doby odezvy na aplikaci.</span><span class="sxs-lookup"><span data-stu-id="def72-126">Managing database performance consists of compiling and analyzing performance data, and then reacting to this data by adjusting parameters to maintain an acceptable response time for your application.</span></span> <span data-ttu-id="def72-127">Při hostování více tenantů představují fondy elastické databáze nenákladný způsob zajištění a správy prostředků pro skupinu databází s nepředvídatelnými úlohami.</span><span class="sxs-lookup"><span data-stu-id="def72-127">When hosting multiple tenants, Elastic database pools are a cost-effective way to provide and manage resources for a group of databases with unpredictable workloads.</span></span> <span data-ttu-id="def72-128">Při určitých vzorcích úloh může být správa ve fondu užitečná pro pouhé dvě databáze S3.</span><span class="sxs-lookup"><span data-stu-id="def72-128">With certain workload patterns, as few as two S3 databases can benefit from being managed in a pool.</span></span>

![média](./media/sql-database-saas-tutorial-performance-monitoring/app-diagram.png)

<span data-ttu-id="def72-130">Fondy a databází ve fondech, je potřeba sledovat zajistit, že zůstanou v rámci přijatelné rozsahů výkonu.</span><span class="sxs-lookup"><span data-stu-id="def72-130">Pools, and the databases in pools, should be monitored to ensure they stay within acceptable ranges of performance.</span></span> <span data-ttu-id="def72-131">Vyladění konfigurace fondu podle potřeb pracovního vytížení agregační všech databází, zajistíte, že Edtu fondu jsou vhodné pro celkové zatížení.</span><span class="sxs-lookup"><span data-stu-id="def72-131">Tune the pool configuration to meet the needs of the aggregate workload of all databases, ensuring that the pool eDTUs are appropriate for the overall workload.</span></span> <span data-ttu-id="def72-132">Upravte maximální a minimální hodnoty eDTU jednotlivých databází na vhodné hodnoty pro vaše konkrétní aplikační požadavky.</span><span class="sxs-lookup"><span data-stu-id="def72-132">Adjust the per-database min and per-database max eDTU values to appropriate values for your specific application requirements.</span></span>

### <a name="performance-management-strategies"></a><span data-ttu-id="def72-133">Strategie výkonu aplikací</span><span class="sxs-lookup"><span data-stu-id="def72-133">Performance management strategies</span></span>

* <span data-ttu-id="def72-134">Abyste se vyhnuli nutnosti ručně sledovat výkon, je nejúčinnější k **nastavit výstrahy, které aktivují, když databáze nebo fondy Stray Zbloudilá mimo normální rozsahy**.</span><span class="sxs-lookup"><span data-stu-id="def72-134">To avoid having to manually monitor performance, it’s most effective to **set alerts that trigger when databases or pools stray out of normal ranges**.</span></span>
* <span data-ttu-id="def72-135">V reakci na krátkodobé kolísání v agregované úrovni výkonu fondu je možné **vertikálně navýšit nebo snížit kapacitu úrovně eDTU fondu**.</span><span class="sxs-lookup"><span data-stu-id="def72-135">To respond to short-term fluctuations in the aggregate performance level of a pool, the **pool eDTU level can be scaled up or down**.</span></span> <span data-ttu-id="def72-136">Pokud k tomuto kolísání dochází pravidelně nebo je předvídatelné, **je možné naplánovat automatické škálování fondu**.</span><span class="sxs-lookup"><span data-stu-id="def72-136">If this fluctuation occurs on a regular or predictable basis, **scaling the pool can be scheduled to occur automatically**.</span></span> <span data-ttu-id="def72-137">Pokud například víte, že je úloha malého rozsahu, třeba přes noc nebo o víkendech, můžete vertikálně snížit kapacitu.</span><span class="sxs-lookup"><span data-stu-id="def72-137">For example, scale down when you know your workload is light, maybe overnight, or during weekends.</span></span>
* <span data-ttu-id="def72-138">Pokud chcete reagovat na dlouhodobější kolísání nebo změny počtu databází, **je možné přesunout jednotlivé databáze do jiných fondů**.</span><span class="sxs-lookup"><span data-stu-id="def72-138">To respond to longer-term fluctuations, or changes in the number of databases, **individual databases can be moved into other pools**.</span></span>
* <span data-ttu-id="def72-139">Reakce na krátkodobou nárůstu *jednotlivých* zatížení databáze **jednotlivé databáze může být převzaté z fondu a přiřazení úroveň výkonu jednotlivých**.</span><span class="sxs-lookup"><span data-stu-id="def72-139">To respond to short term increases in *individual* database load **individual databases can be taken out of a pool and assigned an individual performance level**.</span></span> <span data-ttu-id="def72-140">Po snížení zatížení je možné databázi vrátit do fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-140">Once the load is reduced, the database can then be returned to the pool.</span></span> <span data-ttu-id="def72-141">Když je znám předem, databází můžete přesunout pre-emptively, zajistěte, aby byl vždy prostředky, které potřebuje databázi a vyhnout se dopad na jiné databáze ve fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-141">When this is known in advance, databases can be moved pre-emptively to ensure the database always has the resources it needs, and to avoid impact on other databases in the pool.</span></span> <span data-ttu-id="def72-142">Pokud je tento požadavek předvídatelný, například v místě, kde se předpokládá navýšení prodeje lístků na oblíbenou akci, je možné toto chování správy začlenit do aplikace.</span><span class="sxs-lookup"><span data-stu-id="def72-142">If this requirement is predictable, such as a venue experiencing a rush of ticket sales for a popular event, then this management behavior can be integrated into the application.</span></span>

<span data-ttu-id="def72-143">[Azure Portal](https://portal.azure.com) poskytuje integrované monitorování a upozorňování pro většinu prostředků.</span><span class="sxs-lookup"><span data-stu-id="def72-143">The [Azure portal](https://portal.azure.com) provides built-in monitoring and alerting on most resources.</span></span> <span data-ttu-id="def72-144">Ve službě SQL Database je monitorování a upozorňování k dispozici v databázích a fondech.</span><span class="sxs-lookup"><span data-stu-id="def72-144">For SQL Database, monitoring and alerting is available on databases and pools.</span></span> <span data-ttu-id="def72-145">Toto integrované monitorování a výstrah je konkrétní prostředky, takže je možné použít pro malý počet prostředků, ale není možnost je užitečná při práci s množství prostředků.</span><span class="sxs-lookup"><span data-stu-id="def72-145">This built-in monitoring and alerting is resource-specific, so it's convenient to use for small numbers of resources, but is not very convenient when working with many resources.</span></span>

<span data-ttu-id="def72-146">Pro rozsáhlé scénáře, kde pracujete s mnoha reources [analýzy protokolů (OMS)](sql-database-saas-tutorial-log-analytics.md) lze použít.</span><span class="sxs-lookup"><span data-stu-id="def72-146">For high-volume scenarios where you're working with many reources, [Log Analytics (OMS)](sql-database-saas-tutorial-log-analytics.md) can be used.</span></span> <span data-ttu-id="def72-147">Toto je samostatný služba Azure, která nabízí v porovnání s emitovaného diagnostické protokoly a telemetrie získané v pracovním prostoru analýzy protokolů analýzy.</span><span class="sxs-lookup"><span data-stu-id="def72-147">This is a separate Azure service that provides analytics over emitted diagnostic logs and telemetry gathered in a log analytics workspace.</span></span> <span data-ttu-id="def72-148">Analýzy protokolů můžete shromažďovat telemetrická data z mnoha služeb a použije k dotazování a nastavit výstrahy.</span><span class="sxs-lookup"><span data-stu-id="def72-148">Log Analytics can collect telemetry from many services and be used to query and set alerts.</span></span>

## <a name="get-the-wingtip-application-source-code-and-scripts"></a><span data-ttu-id="def72-149">Zdrojový kód Wingtip aplikace a skripty</span><span class="sxs-lookup"><span data-stu-id="def72-149">Get the Wingtip application source code and scripts</span></span>

<span data-ttu-id="def72-150">Adresář Wingtip SaaS skripty a zdrojový kód aplikace, které jsou k dispozici v [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) úložiště github.</span><span class="sxs-lookup"><span data-stu-id="def72-150">The Wingtip SaaS scripts and application source code are available in the [WingtipSaaS](https://github.com/Microsoft/WingtipSaaS) github repo.</span></span> <span data-ttu-id="def72-151">[Postup stažení skripty Wingtip SaaS](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span><span class="sxs-lookup"><span data-stu-id="def72-151">[Steps to download the Wingtip SaaS scripts](sql-database-wtp-overview.md#download-and-unblock-the-wingtip-saas-scripts).</span></span>

## <a name="provision-additional-tenants"></a><span data-ttu-id="def72-152">Zřízení dalších tenantů</span><span class="sxs-lookup"><span data-stu-id="def72-152">Provision additional tenants</span></span>

<span data-ttu-id="def72-153">I když fondy můžou být nákladově efektivní jenom se dvěma databázemi S3, platí, že čím více databází fond obsahuje, tím efektivnější z hlediska nákladů začne být efekt zprůměrování.</span><span class="sxs-lookup"><span data-stu-id="def72-153">While pools can be cost-effective with just two S3 databases, the more databases that are in the pool the more cost-effective the averaging effect becomes.</span></span> <span data-ttu-id="def72-154">Pro zajištění správného porozumění fungování monitorování a správy výkonu na škále vyžaduje tento kurz, abyste měli nasazených nejméně 20 databází.</span><span class="sxs-lookup"><span data-stu-id="def72-154">For a good understanding of how performance monitoring and management works at scale, this tutorial requires you have at least 20 databases deployed.</span></span>

<span data-ttu-id="def72-155">Pokud dávky klientů, které se už zřízené v předchozí kurzu, pokračujte [simulovat využití na všechny databáze klienta](#simulate-usage-on-all-tenant-databases) části.</span><span class="sxs-lookup"><span data-stu-id="def72-155">If you already provisioned a batch of tenants in a prior tutorial, skip to the [Simulate usage on all tenant databases](#simulate-usage-on-all-tenant-databases) section.</span></span>

1. <span data-ttu-id="def72-156">Otevřete... \\Učení moduly\\sledování výkonu a správy\\*ukázku PerformanceMonitoringAndManagement.ps1* v *prostředí PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="def72-156">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="def72-157">Tento skript nechte otevřený, protože během tohoto kurzu budete spouštět několik scénářů.</span><span class="sxs-lookup"><span data-stu-id="def72-157">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="def72-158">Nastavte **$DemoScenario** = **1**, **Zřízení dávky tenantů**</span><span class="sxs-lookup"><span data-stu-id="def72-158">Set **$DemoScenario** = **1**, **Provision a batch of tenants**</span></span>
1. <span data-ttu-id="def72-159">Stisknutím klávesy **F5** spusťte skript.</span><span class="sxs-lookup"><span data-stu-id="def72-159">Press **F5** to run the script.</span></span>

<span data-ttu-id="def72-160">Skript nasadí 17 tenantů za méně než pět minut.</span><span class="sxs-lookup"><span data-stu-id="def72-160">The script will deploy 17 tenants in less than five minutes.</span></span>

<span data-ttu-id="def72-161">*New-TenantBatch* skript používá sadu vnořené nebo propojené [Resource Manager](../azure-resource-manager/index.md) šablony, které vytvoření dávky klientů, který ve výchozím nastavení zkopíruje databázi **basetenantdb**na serveru katalog pro vytvoření nového klienta databáze, pak zaregistruje v katalogu a nakonec je inicializuje s typem klientovi název a místo.</span><span class="sxs-lookup"><span data-stu-id="def72-161">The *New-TenantBatch* script uses a nested or linked set of [Resource Manager](../azure-resource-manager/index.md) templates that create a batch of tenants, which by default copies the database **basetenantdb** on the catalog server to create the new tenant databases, then registers these in the catalog, and finally initializes them with the tenant name and venue type.</span></span> <span data-ttu-id="def72-162">To je konzistentní s způsob, jakým aplikace zřídí nového klienta.</span><span class="sxs-lookup"><span data-stu-id="def72-162">This is consistent with the way the app provisions a new tenant.</span></span> <span data-ttu-id="def72-163">Některé změny provedené *basetenantdb* se použijí pro žádné nové klienty zřízený po tomto datu.</span><span class="sxs-lookup"><span data-stu-id="def72-163">Any changes made to *basetenantdb* are applied to any new tenants provisioned thereafter.</span></span> <span data-ttu-id="def72-164">Najdete v článku [Správa schématu kurzu](sql-database-saas-tutorial-schema-management.md) chcete zjistit, jak provést změny schématu *existující* klienta databáze (včetně *basetenantdb* databáze).</span><span class="sxs-lookup"><span data-stu-id="def72-164">See the [Schema Management tutorial](sql-database-saas-tutorial-schema-management.md) to see how to make schema changes to *existing* tenant databases (including the *basetenantdb* database).</span></span>

## <a name="simulate-usage-on-all-tenant-databases"></a><span data-ttu-id="def72-165">Simulace využití ve všech databázích tenantů</span><span class="sxs-lookup"><span data-stu-id="def72-165">Simulate usage on all tenant databases</span></span>

<span data-ttu-id="def72-166">*Ukázku PerformanceMonitoringAndManagement.ps1* je skript zadaný, který simuluje zatížení spuštěným pro všechny databáze klienta.</span><span class="sxs-lookup"><span data-stu-id="def72-166">The *Demo-PerformanceMonitoringAndManagement.ps1* script is provided that simulates a workload running against all tenant databases.</span></span> <span data-ttu-id="def72-167">Zatížení je generována pomocí jednoho z dostupných zatížení scénářů:</span><span class="sxs-lookup"><span data-stu-id="def72-167">The load is generated using one of the available load scenarios:</span></span>

| <span data-ttu-id="def72-168">Ukázka</span><span class="sxs-lookup"><span data-stu-id="def72-168">Demo</span></span> | <span data-ttu-id="def72-169">Scénář</span><span class="sxs-lookup"><span data-stu-id="def72-169">Scenario</span></span> |
|:--|:--|
| <span data-ttu-id="def72-170">2</span><span class="sxs-lookup"><span data-stu-id="def72-170">2</span></span> | <span data-ttu-id="def72-171">Generování normální intenzity zatížení (asi 40 DTU)</span><span class="sxs-lookup"><span data-stu-id="def72-171">Generate normal intensity load (approx. 40 DTU)</span></span> |
| <span data-ttu-id="def72-172">3</span><span class="sxs-lookup"><span data-stu-id="def72-172">3</span></span> | <span data-ttu-id="def72-173">Generování zatížení s delšími a častějšími nárůsty zatížení na databázi</span><span class="sxs-lookup"><span data-stu-id="def72-173">Generate load with longer and more frequent bursts per database</span></span>|
| <span data-ttu-id="def72-174">4</span><span class="sxs-lookup"><span data-stu-id="def72-174">4</span></span> | <span data-ttu-id="def72-175">Generování zatížení s vyššími nárůsty DTU na databázi (přibližně 80 DTU)</span><span class="sxs-lookup"><span data-stu-id="def72-175">Generate load with higher DTU bursts per database (approx. 80 DTU)</span></span>|
| <span data-ttu-id="def72-176">5</span><span class="sxs-lookup"><span data-stu-id="def72-176">5</span></span> | <span data-ttu-id="def72-177">Generování normálního a vysokého zatížení v jednom tenantovi (přibližně 95 DTU)</span><span class="sxs-lookup"><span data-stu-id="def72-177">Generate a normal load plus a high load on a single tenant (approx. 95 DTU)</span></span>|
| <span data-ttu-id="def72-178">6</span><span class="sxs-lookup"><span data-stu-id="def72-178">6</span></span> | <span data-ttu-id="def72-179">Generování nevyváženého zatížení mezi více fondy</span><span class="sxs-lookup"><span data-stu-id="def72-179">Generate unbalanced load across multiple pools</span></span>|

<span data-ttu-id="def72-180">Generátor zatížení použije *syntetické* zatížení jenom pro CPU na každé databázi tenantů.</span><span class="sxs-lookup"><span data-stu-id="def72-180">The load generator applies a *synthetic* CPU-only load to every tenant database.</span></span> <span data-ttu-id="def72-181">Generátor spustí úlohu pro každou databázi tenantů, která pravidelně volá uloženou proceduru generující zatížení.</span><span class="sxs-lookup"><span data-stu-id="def72-181">The generator starts a job for each tenant database, which calls a stored procedure periodically that generates the load.</span></span> <span data-ttu-id="def72-182">Úrovně zatížení (v eDTU), doba trvání a intervaly jsou napříč všemi databázemi různé, což simuluje nepředvídanou činnost tenanta.</span><span class="sxs-lookup"><span data-stu-id="def72-182">The load levels (in eDTUs), duration, and intervals are varied across all databases, simulating unpredictable tenant activity.</span></span>

1. <span data-ttu-id="def72-183">Otevřete... \\Učení moduly\\sledování výkonu a správy\\*ukázku PerformanceMonitoringAndManagement.ps1* v *prostředí PowerShell ISE*.</span><span class="sxs-lookup"><span data-stu-id="def72-183">Open …\\Learning Modules\\Performance Monitoring and Management\\*Demo-PerformanceMonitoringAndManagement.ps1* in the *PowerShell ISE*.</span></span> <span data-ttu-id="def72-184">Tento skript nechte otevřený, protože během tohoto kurzu budete spouštět několik scénářů.</span><span class="sxs-lookup"><span data-stu-id="def72-184">Keep this script open as you'll run several scenarios during this tutorial.</span></span>
1. <span data-ttu-id="def72-185">Nastavit **$DemoScenario** = **2**, *generování normální intenzitou zatížení*.</span><span class="sxs-lookup"><span data-stu-id="def72-185">Set **$DemoScenario** = **2**, *Generate normal intensity load*.</span></span>
1. <span data-ttu-id="def72-186">Stisknutím klávesy **F5** použijte zatížení u všech databází tenantů.</span><span class="sxs-lookup"><span data-stu-id="def72-186">Press **F5** to apply a load to all your tenant databases.</span></span>

<span data-ttu-id="def72-187">Adresář Wingtip je aplikace SaaS a skutečné zatížení aplikace SaaS je obvykle ojediněle a nepředvídatelným.</span><span class="sxs-lookup"><span data-stu-id="def72-187">Wingtip is a SaaS app, and the real-world load on a SaaS app is typically sporadic and unpredictable.</span></span> <span data-ttu-id="def72-188">Abychom takovýto scénář nasimulovali, vytváří generátor zatížení náhodné zatížení rozdělené mezi všechny tenanty.</span><span class="sxs-lookup"><span data-stu-id="def72-188">To simulate this, the load generator produces a randomized load distributed across all tenants.</span></span> <span data-ttu-id="def72-189">Několik minut, je potřeba pro vzor zatížení objeví, takže spuštění generátor zatížení po dobu 3 až 5 minut před pokusem o monitorování zatížení v následujících částech.</span><span class="sxs-lookup"><span data-stu-id="def72-189">Several minutes are needed for the load pattern to emerge, so run the load generator for 3-5 minutes before attempting to monitor the load in the following sections.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="def72-190">Generátor zatížení běží jako řada úloh v místní relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="def72-190">The load generator is running as a series of jobs in your local PowerShell session.</span></span> <span data-ttu-id="def72-191">Nechte otevřenou kartu *Demo-PerformanceMonitoringAndManagement.ps1*.</span><span class="sxs-lookup"><span data-stu-id="def72-191">Keep the *Demo-PerformanceMonitoringAndManagement.ps1* tab open!</span></span> <span data-ttu-id="def72-192">Pokud tuto kartu zavřete nebo pozastavíte počítač, generátor zatížení se zastaví.</span><span class="sxs-lookup"><span data-stu-id="def72-192">If you close the tab, or suspend your machine, the load generator stops.</span></span> <span data-ttu-id="def72-193">Generátor zatížení zůstává ve *vyvolání úlohy* stavu, kde vygeneruje zatížení žádné nové klienty, které jsou zřízené po spuštění generátor.</span><span class="sxs-lookup"><span data-stu-id="def72-193">The load generator remains in a *job-invoking* state where it generates load on any new tenants that are provisioned after the generator is started.</span></span> <span data-ttu-id="def72-194">Použití *Ctrl-C* zastavení vyvolání nové úlohy a ukončení skript.</span><span class="sxs-lookup"><span data-stu-id="def72-194">Use *Ctrl-C* to stop invoking new jobs and exit the script.</span></span> <span data-ttu-id="def72-195">Generátor zatížení bude nadále spouštět, ale jenom na stávající klienty.</span><span class="sxs-lookup"><span data-stu-id="def72-195">The load generator will continue to run, but only on existing tenants.</span></span>

## <a name="monitor-resource-usage-using-the-azure-portal"></a><span data-ttu-id="def72-196">Sledování využití prostředků pomocí portálu Azure</span><span class="sxs-lookup"><span data-stu-id="def72-196">Monitor resource usage using the Azure portal</span></span>

<span data-ttu-id="def72-197">Pokud chcete monitorovat využití prostředků, která je výsledkem zatížení, které jsou aplikovány, otevřete portál na fond, který obsahuje databáze klienta:</span><span class="sxs-lookup"><span data-stu-id="def72-197">To monitor the resource usage that results from the load being applied, open the portal to the pool containing the tenant databases:</span></span>

1. <span data-ttu-id="def72-198">Otevřete [portál Azure](https://portal.azure.com) a přejděte do *tenants1 -&lt;uživatele&gt;*  serveru.</span><span class="sxs-lookup"><span data-stu-id="def72-198">Open the [Azure portal](https://portal.azure.com) and browse to the *tenants1-&lt;USER&gt;* server.</span></span>
1. <span data-ttu-id="def72-199">Přejděte dolů na elastické fondy a klikněte na **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="def72-199">Scroll down and locate elastic pools and click **Pool1**.</span></span> <span data-ttu-id="def72-200">Tento fond obsahuje všechny dosud vytvořené databáze tenantů.</span><span class="sxs-lookup"><span data-stu-id="def72-200">This pool contains all the tenant databases created so far.</span></span>

<span data-ttu-id="def72-201">Sledovat **elastického fondu monitorování** a **elastické databáze monitorování** grafy.</span><span class="sxs-lookup"><span data-stu-id="def72-201">Observe the **Elastic pool monitoring** and **Elastic database monitoring** charts.</span></span>

<span data-ttu-id="def72-202">Využití prostředků fondu je agregační databáze využití pro všechny databáze ve fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-202">The pool's resource utilization is the aggregate database utilization for all databases in the pool.</span></span> <span data-ttu-id="def72-203">Databáze graf zobrazuje pět nejprodávanějších databází:</span><span class="sxs-lookup"><span data-stu-id="def72-203">The database chart shows the five hottest databases:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/pool1.png)

<span data-ttu-id="def72-204">Vzhledem k tomu, že existují další databáze ve fondu nad horní pět, využití fondu ukazuje aktivity, která se neodrazí v horní grafu pět databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-204">Because there are additional databases in the pool beyond the top five, the pool utilization shows activity that is not reflected in the top five databases chart.</span></span> <span data-ttu-id="def72-205">Další podrobnosti získáte kliknutím na **využití prostředků databáze**:</span><span class="sxs-lookup"><span data-stu-id="def72-205">For additional details, click **Database Resource Utilization**:</span></span>

![](./media/sql-database-saas-tutorial-performance-monitoring/database-utilization.png)


## <a name="set-performance-alerts-on-the-pool"></a><span data-ttu-id="def72-206">Nastavení výstrah výkonu ve fondu</span><span class="sxs-lookup"><span data-stu-id="def72-206">Set performance alerts on the pool</span></span>

<span data-ttu-id="def72-207">Nastavit výstrahy na fond, který aktivuje na \>75 % využití následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="def72-207">Set an alert on the pool that triggers on \>75% utilization as follows:</span></span>

1. <span data-ttu-id="def72-208">Otevřete *Pool1* (na serveru *tenants1-\<user\>*) na portálu [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="def72-208">Open *Pool1* (on the *tenants1-\<user\>* server) in the [Azure portal](https://portal.azure.com).</span></span>
1. <span data-ttu-id="def72-209">Klikněte na **Pravidla výstrah** a potom na **+ Přidat výstrahu**:</span><span class="sxs-lookup"><span data-stu-id="def72-209">Click **Alert Rules**, and then click **+ Add alert**:</span></span>

   ![přidání výstrahy](media/sql-database-saas-tutorial-performance-monitoring/add-alert.png)

1. <span data-ttu-id="def72-211">Zadejte název, například **High DTU**,</span><span class="sxs-lookup"><span data-stu-id="def72-211">Provide a name, such as **High DTU**,</span></span>
1. <span data-ttu-id="def72-212">Nastavte následující hodnoty:</span><span class="sxs-lookup"><span data-stu-id="def72-212">Set the following values:</span></span>
   * <span data-ttu-id="def72-213">**Metrika = procento eDTU**</span><span class="sxs-lookup"><span data-stu-id="def72-213">**Metric = eDTU percentage**</span></span>
   * <span data-ttu-id="def72-214">**Podmínka = je větší než**.</span><span class="sxs-lookup"><span data-stu-id="def72-214">**Condition = greater than**.</span></span>
   * <span data-ttu-id="def72-215">**Prahová hodnota = 75**.</span><span class="sxs-lookup"><span data-stu-id="def72-215">**Threshold = 75**.</span></span>
   * <span data-ttu-id="def72-216">**Období = více než posledních 30 minut**.</span><span class="sxs-lookup"><span data-stu-id="def72-216">**Period = Over the last 30 minutes**.</span></span>
1. <span data-ttu-id="def72-217">Přidání e-mailovou adresu k *další správce email(s)* pole a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="def72-217">Add an email address to the *Additional administrator email(s)* box and click **OK**.</span></span>

   ![nastavení upozornění](media/sql-database-saas-tutorial-performance-monitoring/alert-rule.png)


## <a name="scale-up-a-busy-pool"></a><span data-ttu-id="def72-219">Vertikální navýšení kapacity zaneprázdněného fondu</span><span class="sxs-lookup"><span data-stu-id="def72-219">Scale up a busy pool</span></span>

<span data-ttu-id="def72-220">Pokud se agregovaná úroveň zatížení ve fondu zvýší na bod, která fond navyšuje na maximální hodnotu a dosáhne 100% využití eDTU, má to vliv na individuální výkon databáze a potenciálně vykazuje pomalejší doby odezvy pro všechny databáze ve fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-220">If the aggregate load level increases on a pool to the point that it maxes out the pool and reaches 100% eDTU usage, then individual database performance is affected, potentially slowing query response times for all databases in the pool.</span></span>

<span data-ttu-id="def72-221">**Krátkodobý**, zvažte vertikálním navýšení kapacity fondu se mají poskytnout další prostředky, nebo odebráním databází z fondu (jejich přesunutí do jiných fondů nebo mimo fondu vrstvu samostatné služby).</span><span class="sxs-lookup"><span data-stu-id="def72-221">**Short term**, consider scaling up the pool to provide additional resources, or removing databases from the pool (moving them to other pools, or out of the pool to a stand-alone service tier).</span></span>

<span data-ttu-id="def72-222">**Dlouhodobější**, zvažte optimalizaci dotazů nebo indexu využití ke zlepšení výkonu databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-222">**Longer term**, consider optimizing queries or index usage to improve database performance.</span></span> <span data-ttu-id="def72-223">Podle toho, jak je aplikace citlivá na problémy s výkonem, se osvědčilo navýšit kapacitu fondu předtím, než dosáhne 100% využití eDTU.</span><span class="sxs-lookup"><span data-stu-id="def72-223">Depending on the application's sensitivity to performance issues its best practice to scale a pool up before it reaches 100% eDTU usage.</span></span> <span data-ttu-id="def72-224">Použijte výstrahu, abyste byli předem upozornění.</span><span class="sxs-lookup"><span data-stu-id="def72-224">Use an alert to warn you in advance.</span></span>

<span data-ttu-id="def72-225">Zaneprázdněný fond můžete simulovat tak, že zvýšíte zatížení vytvořené generátorem.</span><span class="sxs-lookup"><span data-stu-id="def72-225">You can simulate a busy pool by increasing the load produced by the generator.</span></span> <span data-ttu-id="def72-226">Způsobuje databáze, burst častěji a pro zvýšení agregační zatížení ve fondu, aniž byste museli měnit požadavky na jednotlivé databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-226">Causing the databases to burst more frequently, and for longer, increasing the aggregate load on the pool without changing the requirements of the individual databases.</span></span> <span data-ttu-id="def72-227">Škálování fondu se snadno provádí na portálu nebo z prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="def72-227">Scaling up the pool is easily done in the portal or from PowerShell.</span></span> <span data-ttu-id="def72-228">Při tomto cvičení se používá portál.</span><span class="sxs-lookup"><span data-stu-id="def72-228">This exercise uses the portal.</span></span>

1. <span data-ttu-id="def72-229">Nastavte možnost *$DemoScenario* = **3**, _Generování zatížení s delšími a častějšími nárůsty zatížení na databázi_ na zvýšení intenzity agregovaného zatížení ve fondu beze změny vrcholového zatížení požadovaného jednotlivými databázemi.</span><span class="sxs-lookup"><span data-stu-id="def72-229">Set *$DemoScenario* = **3**, _Generate load with longer and more frequent bursts per database_ to increase the intensity of the aggregate load on the pool without changing the peak load required by each database.</span></span>
1. <span data-ttu-id="def72-230">Stisknutím klávesy **F5** použijte zatížení u všech databází tenantů.</span><span class="sxs-lookup"><span data-stu-id="def72-230">Press **F5** to apply a load to all your tenant databases.</span></span>

1. <span data-ttu-id="def72-231">Přejděte na **Pool1** na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="def72-231">Go to **Pool1** in the Azure portal.</span></span>

<span data-ttu-id="def72-232">Sledování využití eDTU vyšší fondu v horní grafu.</span><span class="sxs-lookup"><span data-stu-id="def72-232">Monitor the increased pool eDTU usage on the upper chart.</span></span> <span data-ttu-id="def72-233">Trvá několik minut, než nové vyšší zátěž nové, ale měli byste vidět rychle začít dosáhl maximální využití fondu a jako zatížení steadies do nové vzor, rychle přetížení fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-233">It takes a few minutes for the new higher load to kick in, but you should quickly see the pool start to hit max utilization, and as the load steadies into the new pattern, it rapidly overloads the pool.</span></span>

1. <span data-ttu-id="def72-234">Škálování fondu, klikněte na tlačítko **konfigurace fondu** v horní části **Pool1** stránky.</span><span class="sxs-lookup"><span data-stu-id="def72-234">To scale up the pool, click **Configure pool** at the top of the **Pool1** page.</span></span>
1. <span data-ttu-id="def72-235">Upravit **eDTU fondu** nastavení **100**.</span><span class="sxs-lookup"><span data-stu-id="def72-235">Adjust the **Pool eDTU** setting to **100**.</span></span> <span data-ttu-id="def72-236">Změna eDTU fondu se nemění podle nastavení databáze (což je stále maximálně 50 eDTU na databázi).</span><span class="sxs-lookup"><span data-stu-id="def72-236">Changing the pool eDTU does not change the per-database settings (which is still 50 eDTU max per database).</span></span> <span data-ttu-id="def72-237">Jednotlivé databáze nastavení můžete zobrazit na pravé straně **konfigurace fondu** stránky.</span><span class="sxs-lookup"><span data-stu-id="def72-237">You can see the per-database settings on the right side of the **Configure pool** page.</span></span>
1. <span data-ttu-id="def72-238">Klikněte na tlačítko **Uložit** odeslat žádost o škálování fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-238">Click **Save** to submit the request to scale the pool.</span></span>

<span data-ttu-id="def72-239">Přejděte zpět na **Pool1** > **přehled** zobrazení monitorování grafy.</span><span class="sxs-lookup"><span data-stu-id="def72-239">Go back to **Pool1** > **Overview** to view the monitoring charts.</span></span> <span data-ttu-id="def72-240">Sledování účinku fondu poskytování více prostředků (i když několik databází a náhodnou zatížení není vždy snadno zjistit jednoznačně, dokud nespustíte nějakou dobu).</span><span class="sxs-lookup"><span data-stu-id="def72-240">Monitor the effect of providing the pool with more resources (although with few databases and a randomized load it’s not always easy to see conclusively until you run for some time).</span></span> <span data-ttu-id="def72-241">Při interpretaci grafů mějte na paměti, že 100 % v horním grafu teď reprezentuje 100 eDTU, zatímco v dolním grafu je 100 % vždy 50 eDTU, protože maximum na databázi je 50 eDTU.</span><span class="sxs-lookup"><span data-stu-id="def72-241">While you are looking at the charts bear in mind that 100% on the upper chart now represents 100 eDTUs, while on the lower chart 100% is still 50 eDTUs as the per-database max is still 50 eDTUs.</span></span>

<span data-ttu-id="def72-242">Databáze je v průběhu procesu online a plně dostupná.</span><span class="sxs-lookup"><span data-stu-id="def72-242">Databases remain online and fully available throughout the process.</span></span> <span data-ttu-id="def72-243">A nakonec – protože je každá databáze připravená k aktivaci s eDTU nového fondu, bude každé aktivní propojení přerušeno.</span><span class="sxs-lookup"><span data-stu-id="def72-243">At the last moment as each database is ready to be enabled with the new pool eDTU, any active connections are broken.</span></span> <span data-ttu-id="def72-244">Kód aplikace by měl vždy být zapsán tak, aby se znovu pokoušel obnovit porušené propojení a tím pádem se znovu připojí k databázi ve fondu s navýšenou kapacitou.</span><span class="sxs-lookup"><span data-stu-id="def72-244">Application code should always be written to retry dropped connections, and so will reconnect to the database in the scaled-up pool.</span></span>

## <a name="load-balance-between-pools"></a><span data-ttu-id="def72-245">Vyrovnávání zatížení mezi fondy</span><span class="sxs-lookup"><span data-stu-id="def72-245">Load balance between pools</span></span>

<span data-ttu-id="def72-246">Jako alternativu navýšení kapacity fondu vytvořte druhý fond a přemístěte do něho databáze, aby se vyrovnalo zatížení mezi dvěma fondy.</span><span class="sxs-lookup"><span data-stu-id="def72-246">As an alternative to scaling up the pool, create a second pool and move databases into it to balance the load between the two pools.</span></span> <span data-ttu-id="def72-247">K tomu je potřeba vytvořit tento nový fond na stejném serveru jako první.</span><span class="sxs-lookup"><span data-stu-id="def72-247">To do this the new pool must be created on the same server as the first.</span></span>

1. <span data-ttu-id="def72-248">V [portál Azure](https://portal.azure.com), otevřete **tenants1 -&lt;uživatele&gt;**  serveru.</span><span class="sxs-lookup"><span data-stu-id="def72-248">In the [Azure portal](https://portal.azure.com), open the **tenants1-&lt;USER&gt;** server.</span></span>
1. <span data-ttu-id="def72-249">Klikněte na tlačítko **+ nový fond** vytvoření fondu na aktuálním serveru.</span><span class="sxs-lookup"><span data-stu-id="def72-249">Click **+ New pool** to create a pool on the current server.</span></span>
1. <span data-ttu-id="def72-250">Na **fond elastické databáze** šablony:</span><span class="sxs-lookup"><span data-stu-id="def72-250">On the **Elastic database pool** template:</span></span>

    1. <span data-ttu-id="def72-251">Nastavit **název** k *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="def72-251">Set **Name** to *Pool2*.</span></span>
    1. <span data-ttu-id="def72-252">Cenovou úroveň nechte jako **Fond Standard**.</span><span class="sxs-lookup"><span data-stu-id="def72-252">Leave the pricing tier as **Standard Pool**.</span></span>
    1. <span data-ttu-id="def72-253">Klikněte na **Konfigurovat fond**</span><span class="sxs-lookup"><span data-stu-id="def72-253">Click **Configure pool**,</span></span>
    1. <span data-ttu-id="def72-254">Nastavit **eDTU fondu** k *50 eDTU*.</span><span class="sxs-lookup"><span data-stu-id="def72-254">Set **Pool eDTU** to *50 eDTU*.</span></span>
    1. <span data-ttu-id="def72-255">Klikněte na tlačítko **přidat databáze** zobrazíte seznam databází na serveru, který lze přidat do *Pool2*.</span><span class="sxs-lookup"><span data-stu-id="def72-255">Click **Add databases** to see a list of databases on the server that can be added to *Pool2*.</span></span>
    1. <span data-ttu-id="def72-256">Vyberte všechny 10 databáze přesunout do nového fondu a potom klikněte na **vyberte**.</span><span class="sxs-lookup"><span data-stu-id="def72-256">Select any 10 databases to move these to the new pool, and then click **Select**.</span></span> <span data-ttu-id="def72-257">Pokud jste byla spuštěna generátor zatížení, služba již ví, že váš profil výkonu vyžaduje fond větší než velikost 50 eDTU výchozí a doporučuje od 100 nastavení eDTU.</span><span class="sxs-lookup"><span data-stu-id="def72-257">If you've been running the load generator, the service already knows that your performance profile requires a larger pool than the default 50 eDTU size and recommends starting with a 100 eDTU setting.</span></span>

    ![Doporučení](media/sql-database-saas-tutorial-performance-monitoring/configure-pool.png)

    1. <span data-ttu-id="def72-259">V tomto kurzu ponechte výchozí hodnota 50 Edtu a klikněte na tlačítko **vyberte** znovu.</span><span class="sxs-lookup"><span data-stu-id="def72-259">For this tutorial, leave the default at 50 eDTUs, and click **Select** again.</span></span>
    1. <span data-ttu-id="def72-260">Vyberte **OK** k vytvoření nového fondu a přesunout vybrané databáze do ní.</span><span class="sxs-lookup"><span data-stu-id="def72-260">Select **OK** to create the new pool and to move the selected databases into it.</span></span>

<span data-ttu-id="def72-261">Vytvoření fondu a přesunutí databáze trvá několik minut.</span><span class="sxs-lookup"><span data-stu-id="def72-261">Creating the pool and moving the databases takes a few minutes.</span></span> <span data-ttu-id="def72-262">Jak je, že zůstat online a plně dostupné až do okamžiku, velmi poslední přesunu databází, v tomto okamžiku jsou uzavřeny žádné otevřené připojení.</span><span class="sxs-lookup"><span data-stu-id="def72-262">As databases are moved they remain online and fully accessible until the very last moment, at which point any open connections are closed.</span></span> <span data-ttu-id="def72-263">Tak dlouho, dokud máte některé logika opakovaných pokusů, klienti se potom připojují k databázi v nového fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-263">As long as you have some retry logic, clients will then connect to the database in the new pool.</span></span>

<span data-ttu-id="def72-264">Přejděte do **Pool2** (na *tenants1* serveru) otevřete fondu a sledovat jeho výkon.</span><span class="sxs-lookup"><span data-stu-id="def72-264">Browse to **Pool2** (on the *tenants1* server) to open the pool and monitor its performance.</span></span> <span data-ttu-id="def72-265">Pokud ho nevidíte, počkejte zřizování nového fondu k dokončení.</span><span class="sxs-lookup"><span data-stu-id="def72-265">If you don't see it, wait for provisioning of the new pool to complete.</span></span>

<span data-ttu-id="def72-266">Nyní uvidíte že využití prostředků na *Pool1* klesla a že *Pool2* je nyní podobně načtena.</span><span class="sxs-lookup"><span data-stu-id="def72-266">You now see that resource usage on *Pool1* has dropped and that *Pool2* is now similarly loaded.</span></span>

## <a name="manage-performance-of-a-single-database"></a><span data-ttu-id="def72-267">Správa výkonu služby jedné databáze</span><span class="sxs-lookup"><span data-stu-id="def72-267">Manage performance of a single database</span></span>

<span data-ttu-id="def72-268">Pokud má izolovaná databáze ve fondu stabilně vysoké zatížení, může mít v závislosti na konfiguraci fondu tendenci dominovat prostředkům ve fondu a ovlivňovat ostatní databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-268">If a single database in a pool experiences a sustained high load, depending on the pool configuration, it may tend to dominate the resources in the pool and impact other databases.</span></span> <span data-ttu-id="def72-269">Pokud je aktivita může pokračovat po určitou dobu, můžete databáze dočasně přesunul z fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-269">If the activity is likely to continue for some time, the database can be temporarily moved out of the pool.</span></span> <span data-ttu-id="def72-270">To umožňuje databázi do mají další prostředky potřebuje a izoluje z jiných databází.</span><span class="sxs-lookup"><span data-stu-id="def72-270">This allows the database to have the extra resources it needs, and isolates it from the other databases.</span></span>

<span data-ttu-id="def72-271">Toto cvičení simuluje vliv vysokého zatížení při prodeji lístků na populární koncert v Koncertním sále Contoso.</span><span class="sxs-lookup"><span data-stu-id="def72-271">This exercise simulates the effect of Contoso Concert Hall experiencing a high load when tickets go on sale for a popular concert.</span></span>

1. <span data-ttu-id="def72-272">Otevřete... \\ *Ukázku PerformanceMonitoringAndManagement.ps1* skriptu.</span><span class="sxs-lookup"><span data-stu-id="def72-272">Open the …\\*Demo-PerformanceMonitoringAndManagement.ps1* script.</span></span>
1. <span data-ttu-id="def72-273">Nastavte **$DemoScenario = 5, Generování normálního a vysokého zatížení v jednom tenantovi (přibližně 95 DTU).**</span><span class="sxs-lookup"><span data-stu-id="def72-273">Set **$DemoScenario = 5, Generate a normal load plus a high load on a single tenant (approx. 95 DTU).**</span></span>
1. <span data-ttu-id="def72-274">Nastavte **$SingleTenantDatabaseName = contosoconcerthall**</span><span class="sxs-lookup"><span data-stu-id="def72-274">Set **$SingleTenantDatabaseName = contosoconcerthall**</span></span>
1. <span data-ttu-id="def72-275">Skript proveďte pomocí **F5**.</span><span class="sxs-lookup"><span data-stu-id="def72-275">Execute the script using **F5**.</span></span>


1. <span data-ttu-id="def72-276">V [portál Azure](https://portal.azure.com) otevřete **Pool1**.</span><span class="sxs-lookup"><span data-stu-id="def72-276">In the [Azure portal](https://portal.azure.com) open **Pool1**.</span></span>
1. <span data-ttu-id="def72-277">Zkontrolujte **elastického fondu monitorování** grafu a vyhledejte využití eDTU vyšší fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-277">Inspect the **Elastic pool monitoring** chart and look for the increased pool eDTU usage.</span></span> <span data-ttu-id="def72-278">Po jedné až dvou minutách by mělo začít zvýšené zatížení a měli byste rychle zaznamenat, že fond dosáhl 100% využití.</span><span class="sxs-lookup"><span data-stu-id="def72-278">After a minute or two, the higher load should start to kick in, and you should quickly see that the pool hits 100% utilization.</span></span>
1. <span data-ttu-id="def72-279">Zkontrolujte **elastické databáze monitorování** zobrazení, která zobrazuje nejprodávanějších databáze za poslední hodinu.</span><span class="sxs-lookup"><span data-stu-id="def72-279">Inspect the **Elastic database monitoring** display which shows the hottest databases in the past hour.</span></span> <span data-ttu-id="def72-280">*Contosoconcerthall* databáze by měla brzy zobrazí jako jedna z pěti nejprodávanějších databází.</span><span class="sxs-lookup"><span data-stu-id="def72-280">The *contosoconcerthall* database should soon appear as one of the five hottest databases.</span></span>
1. <span data-ttu-id="def72-281">**Klikněte na monitorování elastické databáze** **grafu** a otevře se **využití prostředků databáze** stránky, kde můžete sledovat některé z databází.</span><span class="sxs-lookup"><span data-stu-id="def72-281">**Click on the Elastic database monitoring** **chart** and it opens the **Database Resource Utilization** page where you can monitor any of the databases.</span></span> <span data-ttu-id="def72-282">Díky tomu si zobrazení pro izolovat *contosoconcerthall* databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-282">This lets you isolate the display for the *contosoconcerthall* database.</span></span>
1. <span data-ttu-id="def72-283">Ze seznamu databází, klikněte na tlačítko **contosoconcerthall**.</span><span class="sxs-lookup"><span data-stu-id="def72-283">From the list of databases, click **contosoconcerthall**.</span></span>
1. <span data-ttu-id="def72-284">Klikněte na tlačítko **cenová úroveň (škálování Dtu)** otevřete **konfigurace výkonu** stránky, kde můžete nastavit úroveň samostatné výkonu databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-284">Click **Pricing Tier (scale DTUs)** to open the **Configure performance** page where you can set a stand-alone performance level for the database.</span></span>
1. <span data-ttu-id="def72-285">Kliknutím na kartu **Standardní** otevřete možnosti škálování ve standardní vrstvě.</span><span class="sxs-lookup"><span data-stu-id="def72-285">Click on the **Standard** tab to open the scale options in the Standard tier.</span></span>
1. <span data-ttu-id="def72-286">Posuňte **DTU posuvníku** vpravo vyberte **100** Dtu.</span><span class="sxs-lookup"><span data-stu-id="def72-286">Slide the **DTU slider** to right to select **100** DTUs.</span></span> <span data-ttu-id="def72-287">Poznámka: odpovídá cíl služby **S3**.</span><span class="sxs-lookup"><span data-stu-id="def72-287">Note this corresponds to the service objective, **S3**.</span></span>
1. <span data-ttu-id="def72-288">Klikněte na tlačítko **použít** přesunout databázi z fondu a změňte ji *úrovně Standard S3* databáze.</span><span class="sxs-lookup"><span data-stu-id="def72-288">Click **Apply** to move the database out of the pool and make it a *Standard S3* database.</span></span>
1. <span data-ttu-id="def72-289">Po dokončení škálování sledujte účinek na databázi contosoconcerthall a Pool1 v elastickém fondu a databáze oknech.</span><span class="sxs-lookup"><span data-stu-id="def72-289">Once scaling is complete, monitor the effect on the contosoconcerthall database and Pool1 on the elastic pool and database blades.</span></span>

<span data-ttu-id="def72-290">Jakmile vysokého zatížení v databázi contosoconcerthall subvence by měl neprodleně vrátí do fondu na snížení nákladů na jeho.</span><span class="sxs-lookup"><span data-stu-id="def72-290">Once the high load on the contosoconcerthall database subsides you should promptly return it to the pool to reduce its cost.</span></span> <span data-ttu-id="def72-291">Pokud je při tom nejasné po který se stane, můžete nastavit upozornění na databázi, se aktivuje při jeho využití v jednotkách DTU klesne pod jednotlivé databáze maximální ve fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-291">If it’s unclear when that will happen you could set an alert on the database that will trigger when its DTU usage drops below the per-database max on the pool.</span></span> <span data-ttu-id="def72-292">Přesunutí databáze do fondu je popsáno v cvičení 5.</span><span class="sxs-lookup"><span data-stu-id="def72-292">Moving a database into a pool is described in exercise 5.</span></span>

## <a name="other-performance-management-patterns"></a><span data-ttu-id="def72-293">Další vzorce správy výkonu</span><span class="sxs-lookup"><span data-stu-id="def72-293">Other Performance Management Patterns</span></span>

<span data-ttu-id="def72-294">**Preemptivní škálování** v cvičení výše kde jste prozkoumali postup škálování izolované databáze, budete vědět, databázi, kterou chcete vyhledat.</span><span class="sxs-lookup"><span data-stu-id="def72-294">**Pre-emptive scaling** In the exercise above where you explored how to scale an isolated database, you knew which database to look for.</span></span> <span data-ttu-id="def72-295">Pokud správu Contoso vzájemné součinnosti Hall měl informován Wingtips brzké prodeje lístků, databázi přesunuta mimo fondu pre-emptively.</span><span class="sxs-lookup"><span data-stu-id="def72-295">If the management of Contoso Concert Hall had informed Wingtips of the impending ticket sale, the database could have been moved out of the pool pre-emptively.</span></span> <span data-ttu-id="def72-296">Jinak by to vyžadovalo výstrahu ve fondu nebo v databázi s cílem zjistit, co se stalo.</span><span class="sxs-lookup"><span data-stu-id="def72-296">Otherwise, it would likely have required an alert on the pool or the database to spot what was happening.</span></span> <span data-ttu-id="def72-297">Pravděpodobně byste to nechtěli zjistit proto, že by si ostatní tenanti ve fondu stěžovali na snížený výkon.</span><span class="sxs-lookup"><span data-stu-id="def72-297">You wouldn’t want to learn about this from the other tenants in the pool complaining of degraded performance.</span></span> <span data-ttu-id="def72-298">A kdyby mohli tenanti předvídat, na jak dlouho by potřebovali další prostředky, můžete nastavit runbook Azure Automation na přesunutí databáze mimo fond a potom zpět podle předem definovaného plánu.</span><span class="sxs-lookup"><span data-stu-id="def72-298">And if the tenant can predict how long they will need additional resources you can set up an Azure Automation runbook to move the database out of the pool and then back in again on a defined schedule.</span></span>

<span data-ttu-id="def72-299">**Samoobslužné škálování tenanta**  Protože škálování je úkol, který se snadno volá prostřednictvím rozhraní API pro škálu, můžete snadno vytvořit možnost škálovat databáze tenantů do aplikace směřující k tenantovi a nabízet ji jako funkci služby SaaS.</span><span class="sxs-lookup"><span data-stu-id="def72-299">**Tenant self-service scaling** Because scaling is a task easily called via the management API, you can easily build the ability to scale tenant databases into your tenant-facing application, and offer it as a feature of your SaaS service.</span></span> <span data-ttu-id="def72-300">Můžete například umožnit tenantům samoobslužné vertikální navýšení a snížení kapacity navázané přímo na fakturaci.</span><span class="sxs-lookup"><span data-stu-id="def72-300">For example, let tenants self-administer scaling up and down, perhaps linked directly to their billing!</span></span>

<span data-ttu-id="def72-301">**Škálování fondu nahoru a dolů na plán tak, aby odpovídaly vzorce používání**</span><span class="sxs-lookup"><span data-stu-id="def72-301">**Scaling a pool up and down on a schedule to match usage patterns**</span></span>

<span data-ttu-id="def72-302">Tam, kde agregované využití tenanta probíhá podle předvídatelných vzorců použití, můžete pomocí Azure Automation podle plánu vertikálně zvyšovat nebo snižovat kapacitu fondu.</span><span class="sxs-lookup"><span data-stu-id="def72-302">Where aggregate tenant usage follows predictable usage patterns, you can use Azure Automation to scale a pool up and down on a schedule.</span></span> <span data-ttu-id="def72-303">Můžete například snížit kapacitu fondu po 6. hodině večer a navýšit před 6. hodinou ráno ve dnech, kdy víte, že existuje pokles požadavků na prostředky.</span><span class="sxs-lookup"><span data-stu-id="def72-303">For example, scale a pool down after 6pm and up again before 6am on weekdays when you know there is a drop in resource requirements.</span></span>



## <a name="next-steps"></a><span data-ttu-id="def72-304">Další kroky</span><span class="sxs-lookup"><span data-stu-id="def72-304">Next steps</span></span>

<span data-ttu-id="def72-305">Co se v tomto kurzu naučíte:</span><span class="sxs-lookup"><span data-stu-id="def72-305">In this tutorial you learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="def72-306">Simulace použití v databázích tenantů pomocí dodaného generátoru zatížení</span><span class="sxs-lookup"><span data-stu-id="def72-306">Simulate usage on the tenant databases by running a provided load generator</span></span>
> * <span data-ttu-id="def72-307">Monitorování databází tenantů při reakci na zvýšení zatížení</span><span class="sxs-lookup"><span data-stu-id="def72-307">Monitor the tenant databases as they respond to the increase in load</span></span>
> * <span data-ttu-id="def72-308">Vertikální navýšení kapacity elastického fondu v reakci na zvýšení zatížení databáze</span><span class="sxs-lookup"><span data-stu-id="def72-308">Scale up the Elastic pool in response to the increased database load</span></span>
> * <span data-ttu-id="def72-309">Zřízení druhého elastického fondu pro vyrovnání zatížení činnosti databáze</span><span class="sxs-lookup"><span data-stu-id="def72-309">Provision a second Elastic pool to load balance the database activity</span></span>

[<span data-ttu-id="def72-310">Kurz Obnovení jednoho tenanta</span><span class="sxs-lookup"><span data-stu-id="def72-310">Restore a single tenant tutorial</span></span>](sql-database-saas-tutorial-restore-single-tenant.md)


## <a name="additional-resources"></a><span data-ttu-id="def72-311">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="def72-311">Additional resources</span></span>

* <span data-ttu-id="def72-312">Další [návodů, které stavět na adresář Wingtip SaaS nasazení aplikace](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span><span class="sxs-lookup"><span data-stu-id="def72-312">Additional [tutorials that build upon the Wingtip SaaS application deployment](sql-database-wtp-overview.md#sql-database-wingtip-saas-tutorials)</span></span>
* [<span data-ttu-id="def72-313">Elastické fondy SQL</span><span class="sxs-lookup"><span data-stu-id="def72-313">SQL Elastic pools</span></span>](sql-database-elastic-pool.md)
* [<span data-ttu-id="def72-314">Azure Automation</span><span class="sxs-lookup"><span data-stu-id="def72-314">Azure automation</span></span>](../automation/automation-intro.md)
* <span data-ttu-id="def72-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) – kurz Nastavení a používání Log Analytics</span><span class="sxs-lookup"><span data-stu-id="def72-315">[Log Analytics](sql-database-saas-tutorial-log-analytics.md) - Setting up and using Log Analytics tutorial</span></span>

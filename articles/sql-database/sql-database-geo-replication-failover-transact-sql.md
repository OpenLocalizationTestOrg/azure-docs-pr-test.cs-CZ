---
title: "TSQL:initiate převzetí služeb při selhání pro Azure SQL Database | Microsoft Docs"
description: "Zahájení plánovaném nebo neplánovaném převzetí služeb při selhání pro Azure SQL Database pomocí jazyka Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 418953e044ba84ce758063d56a371af45d5cdfe1
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="060ce-103">Zahájení plánovaném nebo neplánovaném převzetí služeb při selhání pro Azure SQL Database pomocí jazyka Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="060ce-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="060ce-104">Tento článek ukazuje, jak tooinitiate převzetí služeb při selhání tooa sekundární databáze SQL pomocí jazyka Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="060ce-104">This article shows you how tooinitiate failover tooa secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="060ce-105">tooconfigure geografická replikace, najdete v části [konfigurace geografická replikace pro Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="060ce-105">tooconfigure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="060ce-106">tooinitiate převzetí služeb při selhání, je třeba hello následující:</span><span class="sxs-lookup"><span data-stu-id="060ce-106">tooinitiate failover, you need hello following:</span></span>

* <span data-ttu-id="060ce-107">Přihlašovací jméno, které je DBManager na primární hello</span><span class="sxs-lookup"><span data-stu-id="060ce-107">A login that is DBManager on hello primary</span></span>
* <span data-ttu-id="060ce-108">Mít db_ownership hello místní databáze, které budete geografická replikace</span><span class="sxs-lookup"><span data-stu-id="060ce-108">Have db_ownership of hello local database that you will geo-replicate</span></span>
* <span data-ttu-id="060ce-109">Být DBManager na hello partnerské servery toowhich budete konfigurovat geografická replikace</span><span class="sxs-lookup"><span data-stu-id="060ce-109">Be DBManager on hello partner server(s) toowhich you will configure geo-replication</span></span>
* <span data-ttu-id="060ce-110">Nejnovější verzi systému SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="060ce-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="060ce-111">Se doporučuje hello vždy použít nejnovější verzi tooremain Management Studio synchronizovat se službou aktualizace tooMicrosoft Azure a SQL Database.</span><span class="sxs-lookup"><span data-stu-id="060ce-111">It is recommended that you always use hello latest version of Management Studio tooremain synchronized with updates tooMicrosoft Azure and SQL Database.</span></span> <span data-ttu-id="060ce-112">[Aktualizovat aplikaci SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="060ce-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-toobecome-hello-new-primary"></a><span data-ttu-id="060ce-113">Zahájení plánované převzetí služeb při selhání povýšení nový primární sekundární databáze toobecome hello</span><span class="sxs-lookup"><span data-stu-id="060ce-113">Initiate a planned failover promoting a secondary database toobecome hello new primary</span></span>
<span data-ttu-id="060ce-114">Můžete použít hello **ALTER DATABASE** příkaz toopromote nový primární sekundární databáze toobecome hello databáze plánovaný cyklicky, degradování hello existující primární toobecome sekundární.</span><span class="sxs-lookup"><span data-stu-id="060ce-114">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in a planned fashion, demoting hello existing primary toobecome a secondary.</span></span> <span data-ttu-id="060ce-115">Tento příkaz je proveden v hlavní databázi hello na hello Azure SQL Database logickém serveru, ve které hello geograficky replikované sekundární databáze, která je povyšovaným nachází.</span><span class="sxs-lookup"><span data-stu-id="060ce-115">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="060ce-116">Tato funkce je určená pro plánované převzetí služeb při selhání, například během cvičení hello zotavení po Havárii a vyžaduje, že tuto primární databázi hello být k dispozici.</span><span class="sxs-lookup"><span data-stu-id="060ce-116">This functionality is designed for planned failover, such as during hello DR drills, and requires that hello primary database be available.</span></span>

<span data-ttu-id="060ce-117">příkaz Hello provede hello následující pracovní postup:</span><span class="sxs-lookup"><span data-stu-id="060ce-117">hello command performs hello following workflow:</span></span>

1. <span data-ttu-id="060ce-118">Dočasně toosynchronous režim replikace přepínače, způsobuje všechny zbývající transakce toobe vyprázdněných toohello sekundární a blokování všechny nové transakce;</span><span class="sxs-lookup"><span data-stu-id="060ce-118">Temporarily switches replication toosynchronous mode, causing all outstanding transactions toobe flushed toohello secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="060ce-119">Přepínače hello role hello dvou databází ve spolupráci se geografická replikace hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-119">Switches hello roles of hello two databases in hello geo-replication partnership.</span></span>  

<span data-ttu-id="060ce-120">Toto pořadí zaručuje, že hello dvě databáze nejsou synchronizovány před přepněte hello role, a proto nedošlo ke ztrátě dat dojde.</span><span class="sxs-lookup"><span data-stu-id="060ce-120">This sequence guarantees that hello two databases are synchronized before hello roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="060ce-121">Není k dispozici na krátkou dobu, během které obě databáze jsou k dispozici (v pořadí hello 0 too25 sekund), při přepínání hello role.</span><span class="sxs-lookup"><span data-stu-id="060ce-121">There is a short period during which both databases are unavailable (on hello order of 0 too25 seconds) while hello roles are switched.</span></span> <span data-ttu-id="060ce-122">Pokud hello primární databáze má více sekundární databáze, hello příkaz bude automaticky reconfigure hello nový primární jiných sekundárních tooconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="060ce-122">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>  <span data-ttu-id="060ce-123">Hello celou operaci lze provést méně než minutu toocomplete za normálních okolností.</span><span class="sxs-lookup"><span data-stu-id="060ce-123">hello entire operation should take less than a minute toocomplete under normal circumstances.</span></span> <span data-ttu-id="060ce-124">Další informace najdete v tématu [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) a [úrovně služeb](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="060ce-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="060ce-125">Pomocí následujících kroků tooinitiate plánované převzetí služeb při selhání hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-125">Use hello following steps tooinitiate a planned failover.</span></span>

1. <span data-ttu-id="060ce-126">V aplikaci Management Studio připojte toohello Azure SQL Database logického serveru, ve které je umístěn geograficky replikované sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="060ce-126">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="060ce-127">Otevřete složku databází hello, rozbalte hello **systémové databáze** složku, klikněte pravým tlačítkem na **hlavní**a potom klikněte na **nový dotaz**.</span><span class="sxs-lookup"><span data-stu-id="060ce-127">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="060ce-128">Použijte hello **ALTER DATABASE** příkaz tooswitch hello sekundární databáze toohello primární roli.</span><span class="sxs-lookup"><span data-stu-id="060ce-128">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="060ce-129">Klikněte na tlačítko **Execute** toorun hello dotazu.</span><span class="sxs-lookup"><span data-stu-id="060ce-129">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="060ce-130">Ve výjimečných případech je možné, že hello operaci nelze dokončit a může se zobrazit zablokované.</span><span class="sxs-lookup"><span data-stu-id="060ce-130">In rare cases, it is possible that hello operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="060ce-131">V takovém případě hello a uživatel může provést hello Vynucené převzetí služeb při selhání příkaz přijmout ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="060ce-131">In this case, hello user can execute hello force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-hello-primary-database-toohello-secondary-database"></a><span data-ttu-id="060ce-132">Zahájit neplánované převzetí služeb při selhání z hello primární databáze toohello sekundární databáze</span><span class="sxs-lookup"><span data-stu-id="060ce-132">Initiate an unplanned failover from hello primary database toohello secondary database</span></span>
<span data-ttu-id="060ce-133">Můžete použít hello **ALTER DATABASE** příkaz toopromote nový primární sekundární databáze toobecome hello databáze neplánované způsobem, vynucení hello degradace hello existující primární toobecome sekundární současně při hello primární databáze již není k dispozici.</span><span class="sxs-lookup"><span data-stu-id="060ce-133">You can use hello **ALTER DATABASE** statement toopromote a secondary database toobecome hello new primary database in an unplanned fashion, forcing hello demotion of hello existing primary toobecome a secondary at a time when hello primary database is no longer available.</span></span> <span data-ttu-id="060ce-134">Tento příkaz je proveden v hlavní databázi hello na hello Azure SQL Database logickém serveru, ve které hello geograficky replikované sekundární databáze, která je povyšovaným nachází.</span><span class="sxs-lookup"><span data-stu-id="060ce-134">This statement is executed on hello master database on hello Azure SQL Database logical server in which hello geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="060ce-135">Tato funkce je určená pro zotavení po havárii, při obnovení dostupnost databáze hello je důležité a ztrátu dat je přijatelná.</span><span class="sxs-lookup"><span data-stu-id="060ce-135">This functionality is designed for disaster recovery when restoring availability of hello database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="060ce-136">Po vyvolání Vynucené převzetí služeb při selhání hello zadané sekundární databáze okamžitě stane hello primární databáze a začne přijímat transakce zápisu.</span><span class="sxs-lookup"><span data-stu-id="060ce-136">When forced failover is invoked, hello specified secondary database immediately becomes hello primary database and begins accepting write transactions.</span></span> <span data-ttu-id="060ce-137">Jakmile hello původní primární databáze je možné tooreconnect s novou primární databázi, je přírůstkové zálohy pořízené hello původní primární databáze a hello původní primární databáze se stane do sekundární databáze pro nové primární databáze hello; následně je jenom synchronizace repliky nový primární hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-137">As soon as hello original primary database is able tooreconnect with this new primary database, an incremental backup is taken on hello original primary database and hello old primary database is made into a secondary database for hello new primary database; subsequently, it is merely a synchronizing replica of hello new primary.</span></span>

<span data-ttu-id="060ce-138">Ale protože bod obnovení v době není podporován na hello sekundární databáze, hello uživatele, které toorecover data potvrzené toohello původní primární databázi, která by nebyl replikovat toohello nové primární databáze před hello Vynucené převzetí služeb při selhání došlo k chybě, Hello bude stačit, když uživatel tooengage podporu toorecover to ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="060ce-138">However, because Point In Time Restore is not supported on hello secondary databases, if hello user wishes toorecover data committed toohello old primary database that had not been replicated toohello new primary database before hello forced failover occurred, hello user will need tooengage support toorecover this lost data.</span></span>

<span data-ttu-id="060ce-139">Pokud hello primární databáze má více sekundární databáze, hello příkaz bude automaticky reconfigure hello nový primární jiných sekundárních tooconnect toohello.</span><span class="sxs-lookup"><span data-stu-id="060ce-139">If hello primary database has multiple secondary databases, hello command will automatically reconfigure hello other secondaries tooconnect toohello new primary.</span></span>

<span data-ttu-id="060ce-140">Pomocí následujících kroků tooinitiate neplánované převzetí služeb při selhání hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-140">Use hello following steps tooinitiate an unplanned failover.</span></span>

1. <span data-ttu-id="060ce-141">V aplikaci Management Studio připojte toohello Azure SQL Database logického serveru, ve které je umístěn geograficky replikované sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="060ce-141">In Management Studio, connect toohello Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="060ce-142">Otevřete složku databází hello, rozbalte hello **systémové databáze** složku, klikněte pravým tlačítkem na **hlavní**a potom klikněte na **nový dotaz**.</span><span class="sxs-lookup"><span data-stu-id="060ce-142">Open hello Databases folder, expand hello **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="060ce-143">Použijte hello **ALTER DATABASE** příkaz tooswitch hello sekundární databáze toohello primární roli.</span><span class="sxs-lookup"><span data-stu-id="060ce-143">Use hello following **ALTER DATABASE** statement tooswitch hello secondary database toohello primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="060ce-144">Klikněte na tlačítko **Execute** toorun hello dotazu.</span><span class="sxs-lookup"><span data-stu-id="060ce-144">Click **Execute** toorun hello query.</span></span>

> [!NOTE]
> <span data-ttu-id="060ce-145">Pokud příkaz hello se objeví, pokud je online primární i sekundární hello původního primárního se stane nový sekundární okamžitě, bez synchronizace dat hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-145">If hello command is issued when both primary and secondary are online hello old primary will become hello new secondary immediately without data synchronization.</span></span> <span data-ttu-id="060ce-146">Spouštění transakce při vydání příkazu hello ztrátu dat může dojít, pokud je primární hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-146">If hello primary is committing transactions when hello command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="060ce-147">Další kroky</span><span class="sxs-lookup"><span data-stu-id="060ce-147">Next steps</span></span>
* <span data-ttu-id="060ce-148">Po převzetí služeb při selhání Ujistěte se, že hello požadavky na ověřování pro server a databáze jsou nakonfigurovány na nový primární hello.</span><span class="sxs-lookup"><span data-stu-id="060ce-148">After failover, ensure hello authentication requirements for your server and database are configured on hello new primary.</span></span> <span data-ttu-id="060ce-149">Podrobnosti najdete v tématu [zabezpečení SQL Database po zotavení po havárii](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="060ce-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="060ce-150">toolearn obnovení po havárii pomocí aktivní geografickou replikaci, včetně postupu obnovení před a po obnovení a provedením postupu zotavení po havárii, najdete v části [zotavení po havárii](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="060ce-150">toolearn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="060ce-151">Blogový příspěvek Sasha Nosov o aktivní geografickou replikaci, najdete v části [Spotlight na nové geografická replikace funkce](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="060ce-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="060ce-152">Informace o návrhu cloudové aplikace toouse active geografická replikace najdete v tématu [návrhu cloudové aplikace pro kontinuitu podnikových procesů pomocí geografická replikace](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="060ce-152">For information about designing cloud applications toouse active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="060ce-153">Informace o používání aktivní geografické replikace s elastické fondy najdete v tématu [strategie zotavení po havárii elastický fond](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="060ce-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="060ce-154">Přehled kontinuity podnikových procesů najdete v tématu [obchodní kontinuity přehled](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="060ce-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>


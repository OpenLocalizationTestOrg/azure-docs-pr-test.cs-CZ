---
title: "TSQL:initiate převzetí služeb při selhání pro Azure SQL Database | Microsoft Docs"
description: "Zahájení plánovaném nebo neplánovaném převzetí služeb při selhání pro Azure SQL Database pomocí jazyka Transact-SQL"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: 5eb2d256-025d-4f5a-99d4-17f702b37f14
ms.service: sql-database
ms.custom: business continuity
ms.devlang: NA
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: 459941d2c82e5d4ef62beab4ccf775ab8f5efce4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="initiate-a-planned-or-unplanned-failover-for-azure-sql-database-with-transact-sql"></a><span data-ttu-id="57074-103">Zahájení plánovaném nebo neplánovaném převzetí služeb při selhání pro Azure SQL Database pomocí jazyka Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="57074-103">Initiate a planned or unplanned failover for Azure SQL Database with Transact-SQL</span></span>

<span data-ttu-id="57074-104">Tento článek ukazuje, jak zahájit převzetí služeb při selhání pro sekundární databáze SQL pomocí jazyka Transact-SQL.</span><span class="sxs-lookup"><span data-stu-id="57074-104">This article shows you how to initiate failover to a secondary SQL Database using Transact-SQL.</span></span> <span data-ttu-id="57074-105">Konfigurace geografická replikace najdete v tématu [konfigurace geografická replikace pro Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span><span class="sxs-lookup"><span data-stu-id="57074-105">To configure geo-replication, see [Configure geo-replication for Azure SQL Database](sql-database-geo-replication-transact-sql.md).</span></span>

<span data-ttu-id="57074-106">Chcete-li zahájit převzetí služeb při selhání, budete potřebovat následující:</span><span class="sxs-lookup"><span data-stu-id="57074-106">To initiate failover, you need the following:</span></span>

* <span data-ttu-id="57074-107">Přihlašovací jméno, které je DBManager na primárním</span><span class="sxs-lookup"><span data-stu-id="57074-107">A login that is DBManager on the primary</span></span>
* <span data-ttu-id="57074-108">Mít db_ownership místní databáze, které budete geografická replikace</span><span class="sxs-lookup"><span data-stu-id="57074-108">Have db_ownership of the local database that you will geo-replicate</span></span>
* <span data-ttu-id="57074-109">Být DBManager na partnerské servery, na kterou budete konfigurovat geografická replikace</span><span class="sxs-lookup"><span data-stu-id="57074-109">Be DBManager on the partner server(s) to which you will configure geo-replication</span></span>
* <span data-ttu-id="57074-110">Nejnovější verzi systému SQL Server Management Studio (SSMS)</span><span class="sxs-lookup"><span data-stu-id="57074-110">Newest version of SQL Server Management Studio (SSMS)</span></span>

> [!IMPORTANT]
> <span data-ttu-id="57074-111">Doporučujeme vám vždy používat nejnovější verzi aplikace Management Studio, aby se zajistila synchronizovanost s aktualizacemi Microsoft Azure a SQL Database.</span><span class="sxs-lookup"><span data-stu-id="57074-111">It is recommended that you always use the latest version of Management Studio to remain synchronized with updates to Microsoft Azure and SQL Database.</span></span> <span data-ttu-id="57074-112">[Aktualizovat aplikaci SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span><span class="sxs-lookup"><span data-stu-id="57074-112">[Update SQL Server Management Studio](https://msdn.microsoft.com/library/mt238290.aspx).</span></span>
>  

## <a name="initiate-a-planned-failover-promoting-a-secondary-database-to-become-the-new-primary"></a><span data-ttu-id="57074-113">Zahájení plánované převzetí služeb při selhání povýšení sekundární databáze k nové primární</span><span class="sxs-lookup"><span data-stu-id="57074-113">Initiate a planned failover promoting a secondary database to become the new primary</span></span>
<span data-ttu-id="57074-114">Můžete použít **ALTER DATABASE** příkaz podporovat sekundární databáze k nové primární databáze plánované způsobem, degradování existující primární k sekundární databázi.</span><span class="sxs-lookup"><span data-stu-id="57074-114">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in a planned fashion, demoting the existing primary to become a secondary.</span></span> <span data-ttu-id="57074-115">Tento příkaz je proveden v hlavní databázi na logickém serveru Azure SQL Database, ve které je umístěn geograficky replikované sekundární databáze, která je povyšovaným.</span><span class="sxs-lookup"><span data-stu-id="57074-115">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span> <span data-ttu-id="57074-116">Tato funkce je určená pro plánované převzetí služeb při selhání, například během cvičení zotavení po Havárii a vyžaduje, aby primární databáze k dispozici.</span><span class="sxs-lookup"><span data-stu-id="57074-116">This functionality is designed for planned failover, such as during the DR drills, and requires that the primary database be available.</span></span>

<span data-ttu-id="57074-117">Příkaz provede následující pracovní postup:</span><span class="sxs-lookup"><span data-stu-id="57074-117">The command performs the following workflow:</span></span>

1. <span data-ttu-id="57074-118">Replikace se dočasně přepne do synchronním režimu, způsobuje všechny zbývající transakce zapsány na sekundární a blokování všechny nové transakce;</span><span class="sxs-lookup"><span data-stu-id="57074-118">Temporarily switches replication to synchronous mode, causing all outstanding transactions to be flushed to the secondary and blocking all new transactions;</span></span>
2. <span data-ttu-id="57074-119">Přepínače role ve dvou databázích ve spolupráci se geografická replikace.</span><span class="sxs-lookup"><span data-stu-id="57074-119">Switches the roles of the two databases in the geo-replication partnership.</span></span>  

<span data-ttu-id="57074-120">Toto pořadí zaručuje, že ve dvou databázích jsou synchronizovány před přepněte role, a proto nedošlo ke ztrátě dat dojde.</span><span class="sxs-lookup"><span data-stu-id="57074-120">This sequence guarantees that the two databases are synchronized before the roles switch and therefore no data loss will occur.</span></span> <span data-ttu-id="57074-121">Není k dispozici na krátkou dobu, během které obě databáze jsou k dispozici (v řádu 0 až 25 sekund), při přepínání role.</span><span class="sxs-lookup"><span data-stu-id="57074-121">There is a short period during which both databases are unavailable (on the order of 0 to 25 seconds) while the roles are switched.</span></span> <span data-ttu-id="57074-122">Pokud primární databáze má více sekundárních databází, příkaz se automaticky znovu nakonfigurovat jiné sekundární databáze k připojení k nové primární.</span><span class="sxs-lookup"><span data-stu-id="57074-122">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>  <span data-ttu-id="57074-123">Celou operaci by měl trvat méně než minutu za normálních okolností.</span><span class="sxs-lookup"><span data-stu-id="57074-123">The entire operation should take less than a minute to complete under normal circumstances.</span></span> <span data-ttu-id="57074-124">Další informace najdete v tématu [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) a [úrovně služeb](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="57074-124">For more information, see [ALTER DATABASE (Transact-SQL)](https://msdn.microsoft.com/library/mt574871.aspx) and [Service Tiers](sql-database-service-tiers.md).</span></span>

<span data-ttu-id="57074-125">Pomocí následujících kroků zahájíte plánované převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="57074-125">Use the following steps to initiate a planned failover.</span></span>

1. <span data-ttu-id="57074-126">V Management Studio se připojte k logického serveru Azure SQL Database, ve které je umístěn geograficky replikované sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="57074-126">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="57074-127">Otevřete složku databází, rozbalte **systémové databáze** složku, klikněte pravým tlačítkem na **hlavní**a potom klikněte na **nový dotaz**.</span><span class="sxs-lookup"><span data-stu-id="57074-127">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="57074-128">Použijte následující **ALTER DATABASE** příkaz Přepnout sekundární databázi do primární role.</span><span class="sxs-lookup"><span data-stu-id="57074-128">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB> FAILOVER;
4. <span data-ttu-id="57074-129">Kliknutím na **Spustit** dotaz spustíte.</span><span class="sxs-lookup"><span data-stu-id="57074-129">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="57074-130">Ve výjimečných případech je možné, že operaci nelze dokončit a může se zobrazit zablokované.</span><span class="sxs-lookup"><span data-stu-id="57074-130">In rare cases, it is possible that the operation cannot complete and may appear stuck.</span></span> <span data-ttu-id="57074-131">Uživatel v takovém případě můžete spustit příkaz vynuceného převzetí služeb při selhání a přijmout ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="57074-131">In this case, the user can execute the force failover command and accept data loss.</span></span>
> 
> 

## <a name="initiate-an-unplanned-failover-from-the-primary-database-to-the-secondary-database"></a><span data-ttu-id="57074-132">Zahájit neplánované převzetí služeb při selhání z primární databáze do sekundární databáze</span><span class="sxs-lookup"><span data-stu-id="57074-132">Initiate an unplanned failover from the primary database to the secondary database</span></span>
<span data-ttu-id="57074-133">Můžete použít **ALTER DATABASE** příkaz podporovat sekundární databáze k nové primární databáze neplánované způsobem, vynucení snížení úrovně existující primární k sekundární databázi v době, kdy primární databáze již není k dispozici.</span><span class="sxs-lookup"><span data-stu-id="57074-133">You can use the **ALTER DATABASE** statement to promote a secondary database to become the new primary database in an unplanned fashion, forcing the demotion of the existing primary to become a secondary at a time when the primary database is no longer available.</span></span> <span data-ttu-id="57074-134">Tento příkaz je proveden v hlavní databázi na logickém serveru Azure SQL Database, ve které je umístěn geograficky replikované sekundární databáze, která je povyšovaným.</span><span class="sxs-lookup"><span data-stu-id="57074-134">This statement is executed on the master database on the Azure SQL Database logical server in which the geo-replicated secondary database that is being promoted resides.</span></span>

<span data-ttu-id="57074-135">Tato funkce je určená pro zotavení po havárii, při obnovení databáze dostupnosti je velmi důležité a ztrátu dat je přijatelná.</span><span class="sxs-lookup"><span data-stu-id="57074-135">This functionality is designed for disaster recovery when restoring availability of the database is critical and some data loss is acceptable.</span></span> <span data-ttu-id="57074-136">Po vyvolání Vynucené převzetí služeb při selhání zadaná sekundární databáze okamžitě stane primární databáze a začne přijímat transakce zápisu.</span><span class="sxs-lookup"><span data-stu-id="57074-136">When forced failover is invoked, the specified secondary database immediately becomes the primary database and begins accepting write transactions.</span></span> <span data-ttu-id="57074-137">Jakmile původní primární databáze je možné se připojit s novou primární databázi, přírůstkové zálohování je provést na původní primární databáze a původní primární databáze se stane do sekundární databáze pro nové primární databáze; následně je jenom synchronizace repliky nový primární.</span><span class="sxs-lookup"><span data-stu-id="57074-137">As soon as the original primary database is able to reconnect with this new primary database, an incremental backup is taken on the original primary database and the old primary database is made into a secondary database for the new primary database; subsequently, it is merely a synchronizing replica of the new primary.</span></span>

<span data-ttu-id="57074-138">Ale protože bod obnovení v čas není podporována na sekundární databáze, pokud uživatel, které chcete obnovit data zapsána na původní primární databázi, která byla nereplikoval nové primární databázi před Vynucené převzetí služeb při selhání došlo k chybě, uživatel bude potřebovat používat podporu, aby to ztráty dat obnovit.</span><span class="sxs-lookup"><span data-stu-id="57074-138">However, because Point In Time Restore is not supported on the secondary databases, if the user wishes to recover data committed to the old primary database that had not been replicated to the new primary database before the forced failover occurred, the user will need to engage support to recover this lost data.</span></span>

<span data-ttu-id="57074-139">Pokud primární databáze má více sekundárních databází, příkaz se automaticky znovu nakonfigurovat jiné sekundární databáze k připojení k nové primární.</span><span class="sxs-lookup"><span data-stu-id="57074-139">If the primary database has multiple secondary databases, the command will automatically reconfigure the other secondaries to connect to the new primary.</span></span>

<span data-ttu-id="57074-140">Pomocí následujících kroků zahájíte neplánované převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="57074-140">Use the following steps to initiate an unplanned failover.</span></span>

1. <span data-ttu-id="57074-141">V Management Studio se připojte k logického serveru Azure SQL Database, ve které je umístěn geograficky replikované sekundární databáze.</span><span class="sxs-lookup"><span data-stu-id="57074-141">In Management Studio, connect to the Azure SQL Database logical server in which a geo-replicated secondary database resides.</span></span>
2. <span data-ttu-id="57074-142">Otevřete složku databází, rozbalte **systémové databáze** složku, klikněte pravým tlačítkem na **hlavní**a potom klikněte na **nový dotaz**.</span><span class="sxs-lookup"><span data-stu-id="57074-142">Open the Databases folder, expand the **System Databases** folder, right-click on **master**, and then click **New Query**.</span></span>
3. <span data-ttu-id="57074-143">Použijte následující **ALTER DATABASE** příkaz Přepnout sekundární databázi do primární role.</span><span class="sxs-lookup"><span data-stu-id="57074-143">Use the following **ALTER DATABASE** statement to switch the secondary database to the primary role.</span></span>
   
        ALTER DATABASE <MyDB>   FORCE_FAILOVER_ALLOW_DATA_LOSS;
4. <span data-ttu-id="57074-144">Kliknutím na **Spustit** dotaz spustíte.</span><span class="sxs-lookup"><span data-stu-id="57074-144">Click **Execute** to run the query.</span></span>

> [!NOTE]
> <span data-ttu-id="57074-145">Pokud příkaz se objeví, když primární a sekundární jsou online z původního primárního se stane nový sekundární okamžitě, bez synchronizace dat.</span><span class="sxs-lookup"><span data-stu-id="57074-145">If the command is issued when both primary and secondary are online the old primary will become the new secondary immediately without data synchronization.</span></span> <span data-ttu-id="57074-146">Spouštění transakce při vydání příkazu ke ztrátě dat. může dojít, pokud je primární.</span><span class="sxs-lookup"><span data-stu-id="57074-146">If the primary is committing transactions when the command is issued some data loss may occur.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="57074-147">Další kroky</span><span class="sxs-lookup"><span data-stu-id="57074-147">Next steps</span></span>
* <span data-ttu-id="57074-148">Po převzetí služeb při selhání Ujistěte se, že požadavky na ověřování pro server a databáze jsou nakonfigurovány na nový primární.</span><span class="sxs-lookup"><span data-stu-id="57074-148">After failover, ensure the authentication requirements for your server and database are configured on the new primary.</span></span> <span data-ttu-id="57074-149">Podrobnosti najdete v tématu [zabezpečení SQL Database po zotavení po havárii](sql-database-geo-replication-security-config.md).</span><span class="sxs-lookup"><span data-stu-id="57074-149">For details, see [SQL Database security after disaster recovery](sql-database-geo-replication-security-config.md).</span></span>
* <span data-ttu-id="57074-150">Další obnovení po havárii pomocí aktivní geografickou replikaci, včetně postupu obnovení před a po obnovení a provedením postupu zotavení po havárii, najdete v části [zotavení po havárii](sql-database-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="57074-150">To learn recovering after a disaster using active geo-replication, including pre-recovery and post-recovery steps and performing a disaster recovery drill, see [Disaster Recovery](sql-database-disaster-recovery.md)</span></span>
* <span data-ttu-id="57074-151">Blogový příspěvek Sasha Nosov o aktivní geografickou replikaci, najdete v části [Spotlight na nové geografická replikace funkce](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span><span class="sxs-lookup"><span data-stu-id="57074-151">For a Sasha Nosov blog post about active geo-replication, see [Spotlight on new geo-replication capabilities](https://azure.microsoft.com/blog/spotlight-on-new-capabilities-of-azure-sql-database-geo-replication/)</span></span>
* <span data-ttu-id="57074-152">Informace o návrhu cloudové aplikace na používání aktivní geografické replikace najdete v tématu [návrhu cloudové aplikace pro kontinuitu podnikových procesů pomocí geografická replikace](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span><span class="sxs-lookup"><span data-stu-id="57074-152">For information about designing cloud applications to use active geo-replication, see [Designing cloud applications for business continuity using geo-replication](sql-database-designing-cloud-solutions-for-disaster-recovery.md)</span></span>
* <span data-ttu-id="57074-153">Informace o používání aktivní geografické replikace s elastické fondy najdete v tématu [strategie zotavení po havárii elastický fond](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span><span class="sxs-lookup"><span data-stu-id="57074-153">For information about using active geo-replication with elastic pools, see [Elastic Pool disaster recovery strategies](sql-database-disaster-recovery-strategies-for-applications-with-elastic-pool.md).</span></span>
* <span data-ttu-id="57074-154">Přehled kontinuity podnikových procesů najdete v tématu [obchodní kontinuity přehled](sql-database-business-continuity.md)</span><span class="sxs-lookup"><span data-stu-id="57074-154">For an overview of business continuity, see [Business Continuity Overview](sql-database-business-continuity.md)</span></span>


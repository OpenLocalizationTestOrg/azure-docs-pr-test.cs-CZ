---
title: "Přesun dat mezi instancemi cloudu databáze | Microsoft Docs"
description: "Vysvětluje, jak pracovat s horizontálních oddílů a přesun dat prostřednictvím samoobslužné hostované služby pomocí rozhraní API pro elastické databáze."
services: sql-database
documentationcenter: 
manager: jhubbard
author: ddove
ms.assetid: 204fd902-0397-4185-985a-dea3ed7c7d9f
ms.service: sql-database
ms.custom: scale out apps
ms.workload: sql-database
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 10/24/2016
ms.author: ddove
ms.openlocfilehash: b41b6d6be686168359a97eb7468351a105b748db
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="moving-data-between-scaled-out-cloud-databases"></a><span data-ttu-id="71fed-103">Přesun dat mezi cloudovými databázemi s horizontálním navýšením kapacity</span><span class="sxs-lookup"><span data-stu-id="71fed-103">Moving data between scaled-out cloud databases</span></span>
<span data-ttu-id="71fed-104">Pokud jste Software jako služba developer a najednou aplikace zde nevyskytlo strávíte vyžádání, budete muset zohlednit růst.</span><span class="sxs-lookup"><span data-stu-id="71fed-104">If you are a Software as a Service developer, and suddenly your app undergoes tremendous demand, you need to accommodate the growth.</span></span> <span data-ttu-id="71fed-105">Proto můžete přidat další databáze (horizontálních oddílů).</span><span class="sxs-lookup"><span data-stu-id="71fed-105">So you add more databases (shards).</span></span> <span data-ttu-id="71fed-106">Jak opětovné distribuci dat do nové databáze a to bez přerušení integritu dat?</span><span class="sxs-lookup"><span data-stu-id="71fed-106">How do you redistribute the data to the new databases without disrupting the data integrity?</span></span> <span data-ttu-id="71fed-107">Použití **nástroji pro sloučení rozdělení** pro přesun dat z omezené databází do nové databáze.</span><span class="sxs-lookup"><span data-stu-id="71fed-107">Use the **split-merge tool** to move data from constrained databases to the new databases.</span></span>  

<span data-ttu-id="71fed-108">Nástroj pro rozdělení sloučení běží jako Azure webové služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-108">The split-merge tool runs as an Azure web service.</span></span> <span data-ttu-id="71fed-109">Správce nebo vývojáře používá nástroj pro přesun shardlets (data z horizontálního oddílu) mezi různých databází (horizontálních oddílů).</span><span class="sxs-lookup"><span data-stu-id="71fed-109">An administrator or developer uses the tool to move shardlets (data from a shard) between different databases (shards).</span></span> <span data-ttu-id="71fed-110">Nástroj používá horizontálního oddílu mapy správu zachovat metadata databáze služby, a zajistit konzistentní mapování.</span><span class="sxs-lookup"><span data-stu-id="71fed-110">The tool uses shard map management to maintain the service metadata database, and ensure consistent mappings.</span></span>

![Přehled][1]

## <a name="download"></a><span data-ttu-id="71fed-112">Ke stažení</span><span class="sxs-lookup"><span data-stu-id="71fed-112">Download</span></span>
[<span data-ttu-id="71fed-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span><span class="sxs-lookup"><span data-stu-id="71fed-113">Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge</span></span>](http://www.nuget.org/packages/Microsoft.Azure.SqlDatabase.ElasticScale.Service.SplitMerge/)

## <a name="documentation"></a><span data-ttu-id="71fed-114">Dokumentace</span><span class="sxs-lookup"><span data-stu-id="71fed-114">Documentation</span></span>
1. [<span data-ttu-id="71fed-115">Kurz nástroje elastické databáze rozdělení sloučení</span><span class="sxs-lookup"><span data-stu-id="71fed-115">Elastic database Split-Merge tool tutorial</span></span>](sql-database-elastic-scale-configure-deploy-split-and-merge.md)
2. [<span data-ttu-id="71fed-116">Konfigurace zabezpečení rozdělení sloučení</span><span class="sxs-lookup"><span data-stu-id="71fed-116">Split-Merge security configuration</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
3. [<span data-ttu-id="71fed-117">Aspekty zabezpečení rozdělení sloučení</span><span class="sxs-lookup"><span data-stu-id="71fed-117">Split-merge security considerations</span></span>](sql-database-elastic-scale-split-merge-security-configuration.md)
4. [<span data-ttu-id="71fed-118">Správa mapování horizontálních oddílů</span><span class="sxs-lookup"><span data-stu-id="71fed-118">Shard map management</span></span>](sql-database-elastic-scale-shard-map-management.md)
5. [<span data-ttu-id="71fed-119">Migrace existujících databází pro horizontální navýšení kapacity</span><span class="sxs-lookup"><span data-stu-id="71fed-119">Migrate existing databases to scale-out</span></span>](sql-database-elastic-convert-to-use-elastic-tools.md)
6. [<span data-ttu-id="71fed-120">Nástroje elastické databáze</span><span class="sxs-lookup"><span data-stu-id="71fed-120">Elastic database tools</span></span>](sql-database-elastic-scale-introduction.md)
7. [<span data-ttu-id="71fed-121">Glosář nástroje elastické databáze</span><span class="sxs-lookup"><span data-stu-id="71fed-121">Elastic Database tools glossary</span></span>](sql-database-elastic-scale-glossary.md)

## <a name="why-use-the-split-merge-tool"></a><span data-ttu-id="71fed-122">Proč používat nástroj pro rozdělení sloučení?</span><span class="sxs-lookup"><span data-stu-id="71fed-122">Why use the split-merge tool?</span></span>
<span data-ttu-id="71fed-123">**Flexibilita**</span><span class="sxs-lookup"><span data-stu-id="71fed-123">**Flexibility**</span></span>

<span data-ttu-id="71fed-124">Aplikace potřebují k roztahování flexibilně hranicemi služby jedné databáze Azure SQL DB.</span><span class="sxs-lookup"><span data-stu-id="71fed-124">Applications need to stretch flexibly beyond the limits of a single Azure SQL DB database.</span></span> <span data-ttu-id="71fed-125">Pomocí nástroje pro přesun dat v závislosti na potřebě nové databáze a přitom zachovat integritu.</span><span class="sxs-lookup"><span data-stu-id="71fed-125">Use the tool to move data as needed to new databases while retaining integrity.</span></span>

<span data-ttu-id="71fed-126">**Rozdělení růst**</span><span class="sxs-lookup"><span data-stu-id="71fed-126">**Split to grow**</span></span> 

<span data-ttu-id="71fed-127">Je potřeba zvýšit celkové kapacity pro zpracování výrazný růst.</span><span class="sxs-lookup"><span data-stu-id="71fed-127">You need to increase overall capacity to handle explosive growth.</span></span> <span data-ttu-id="71fed-128">Uděláte to tak vytvořte další kapacitu horizontálního dělení dat a rozděluje mezi přírůstkově více databází, dokud se splnění požadavků na kapacitu.</span><span class="sxs-lookup"><span data-stu-id="71fed-128">To do so, create additional capacity by sharding the data and by distributing it across incrementally more databases until capacity needs are fulfilled.</span></span> <span data-ttu-id="71fed-129">Toto je typickým příkladem 'rozdělení' funkce.</span><span class="sxs-lookup"><span data-stu-id="71fed-129">This is a prime example of the ‘split’ feature.</span></span> 

<span data-ttu-id="71fed-130">**Sloučení zmenšení**</span><span class="sxs-lookup"><span data-stu-id="71fed-130">**Merge to shrink**</span></span>

<span data-ttu-id="71fed-131">Kapacita musí zmenšit z důvodu sezónní povahy firmy.</span><span class="sxs-lookup"><span data-stu-id="71fed-131">Capacity needs shrink due to the seasonal nature of a business.</span></span> <span data-ttu-id="71fed-132">Tento nástroj umožňuje snižovat do menšího počtu jednotek škálování, když obchodní zpomalí.</span><span class="sxs-lookup"><span data-stu-id="71fed-132">The tool lets you scale down to fewer scale units when business slows.</span></span> <span data-ttu-id="71fed-133">Funkce 'sloučení' ve službě rozdělení sloučení elastické škálování popisuje tento požadavek.</span><span class="sxs-lookup"><span data-stu-id="71fed-133">The ‘merge’ feature in the Elastic Scale split-merge Service covers this requirement.</span></span> 

<span data-ttu-id="71fed-134">**Spravovat hotspotům přesunutím shardlets**</span><span class="sxs-lookup"><span data-stu-id="71fed-134">**Manage hotspots by moving shardlets**</span></span>

<span data-ttu-id="71fed-135">S více klienty na databázi přidělení shardlets k horizontálních oddílů může vést k kapacity kritická místa na některé horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="71fed-135">With multiple tenants per database, the allocation of shardlets to shards can lead to capacity bottlenecks on some shards.</span></span> <span data-ttu-id="71fed-136">To vyžaduje znovu přidělování shardlets nebo přesunutím zaneprázdněn shardlets do nové nebo méně využívané horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="71fed-136">This requires re-allocating shardlets or moving busy shardlets to new or less utilized shards.</span></span> 

## <a name="concepts--key-features"></a><span data-ttu-id="71fed-137">Koncepty & klíčové funkce</span><span class="sxs-lookup"><span data-stu-id="71fed-137">Concepts & key features</span></span>
<span data-ttu-id="71fed-138">**Zákazník hostované služby**</span><span class="sxs-lookup"><span data-stu-id="71fed-138">**Customer-hosted services**</span></span>

<span data-ttu-id="71fed-139">Rozdělení sloučení je dodávána jako zákazník hostované služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-139">The split-merge is delivered as a customer-hosted service.</span></span> <span data-ttu-id="71fed-140">Musíte nasadit a hostitelem služby v rámci vašeho předplatného Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="71fed-140">You must deploy and host the service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="71fed-141">Balíček, který si stáhnout z NuGet obsahuje šablonu konfigurace k dokončení s informacemi pro konkrétní nasazení.</span><span class="sxs-lookup"><span data-stu-id="71fed-141">The package you download from NuGet contains a configuration template to complete with the information for your specific deployment.</span></span> <span data-ttu-id="71fed-142">Najdete v článku [rozdělení sloučení kurzu](sql-database-elastic-scale-configure-deploy-split-and-merge.md) podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="71fed-142">See the [split-merge tutorial](sql-database-elastic-scale-configure-deploy-split-and-merge.md) for details.</span></span> <span data-ttu-id="71fed-143">Vzhledem k tomu, že služba bude spuštěna ve vašem předplatném Azure, můžete řídit a nakonfigurovat většinu aspektů zabezpečení služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-143">Since the service runs in your Azure subscription, you can control and configure most security aspects of the service.</span></span> <span data-ttu-id="71fed-144">Výchozí šablona obsahuje možnosti pro konfiguraci protokolu SSL, ověřování na základě certifikátu klienta, šifrování pro uložené přihlašovací údaje, DoS ochrana a omezení IP adres.</span><span class="sxs-lookup"><span data-stu-id="71fed-144">The default template includes the options to configure SSL, certificate-based client authentication, encryption for stored credentials, DoS guarding and IP restrictions.</span></span> <span data-ttu-id="71fed-145">Další informace o aspektech zabezpečení najdete v následujícím dokumentu [konfigurace zabezpečení rozdělení sloučení](sql-database-elastic-scale-split-merge-security-configuration.md).</span><span class="sxs-lookup"><span data-stu-id="71fed-145">You can find more information on the security aspects in the following document [split-merge security configuration](sql-database-elastic-scale-split-merge-security-configuration.md).</span></span>

<span data-ttu-id="71fed-146">Výchozí hodnota nasadit service běží s jeden pracovní proces a jednu webovou roli.</span><span class="sxs-lookup"><span data-stu-id="71fed-146">The default deployed service runs with one worker and one web role.</span></span> <span data-ttu-id="71fed-147">Každý virtuální počítač A1 velikost používá v Azure Cloud Services.</span><span class="sxs-lookup"><span data-stu-id="71fed-147">Each uses the A1 VM size in Azure Cloud Services.</span></span> <span data-ttu-id="71fed-148">Když tato nastavení nelze upravit, při nasazení balíčku, je možné je změnit po úspěšné nasazení v rámci spuštěné cloudové služby (prostřednictvím portálu Azure).</span><span class="sxs-lookup"><span data-stu-id="71fed-148">While you cannot modify these settings when deploying the package, you could change them after a successful deployment in the running cloud service, (through the Azure portal).</span></span> <span data-ttu-id="71fed-149">Všimněte si, že role pracovního procesu musí být nakonfigurované více než jednu instanci technických důvodů.</span><span class="sxs-lookup"><span data-stu-id="71fed-149">Note that the worker role must not be configured for more than a single instance for technical reasons.</span></span> 

<span data-ttu-id="71fed-150">**Mapa integrace horizontálního oddílu**</span><span class="sxs-lookup"><span data-stu-id="71fed-150">**Shard map integration**</span></span>

<span data-ttu-id="71fed-151">Rozdělení sloučení služba komunikuje s mapy horizontálního oddílu aplikace.</span><span class="sxs-lookup"><span data-stu-id="71fed-151">The split-merge service interacts with the shard map of the application.</span></span> <span data-ttu-id="71fed-152">Pokud používáte službu rozdělení sloučení k rozdělení nebo sloučení rozsahy nebo přesunout shardlets mezi horizontálních oddílů, služba automaticky udržuje mapy horizontálního oddílu aktuální.</span><span class="sxs-lookup"><span data-stu-id="71fed-152">When using the split-merge service to split or merge ranges or to move shardlets between shards, the service automatically keeps the shard map up to date.</span></span> <span data-ttu-id="71fed-153">Uděláte to tak, služba připojuje k databázi horizontálního oddílu mapa správce aplikace a udržuje rozsahy a mapování průběh rozdělení nebo sloučení nebo přesunutí požadavky.</span><span class="sxs-lookup"><span data-stu-id="71fed-153">To do so, the service connects to the shard map manager database of the application and maintains ranges and mappings as split/merge/move requests progress.</span></span> <span data-ttu-id="71fed-154">Tím se zajistí, že mapy horizontálního oddílu vždy uvede aktuální zobrazení při operace sloučení rozdělení se děje.</span><span class="sxs-lookup"><span data-stu-id="71fed-154">This ensures that the shard map always presents an up-to-date view when split-merge operations are going on.</span></span> <span data-ttu-id="71fed-155">Rozdělení, sloučení a shardlet přesun operace jsou implementované přesunutím dávky shardlets z horizontálního oddílu zdrojové do cílové horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-155">Split, merge and shardlet movement operations are implemented by moving a batch of shardlets from the source shard to the target shard.</span></span> <span data-ttu-id="71fed-156">Během operace přesunu shardlet shardlets vztahují aktuální dávku jsou označeny jako offline v mapě horizontálního oddílu a nejsou k dispozici pro závislé na data směrování připojení pomocí **OpenConnectionForKey** rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="71fed-156">During the shardlet movement operation the shardlets subject to the current batch are marked as offline in the shard map and are unavailable for data-dependent routing connections using the **OpenConnectionForKey** API.</span></span> 

<span data-ttu-id="71fed-157">**Konzistentní shardlet připojení**</span><span class="sxs-lookup"><span data-stu-id="71fed-157">**Consistent shardlet connections**</span></span>

<span data-ttu-id="71fed-158">Při spuštění přesun dat pro novou dávku shardlets všechny zadané mapování horizontálních závislé na data směrování připojení k horizontálního oddílu ukládání shardlet budou borné a následné připojení z mapování horizontálních rozhraní API pro tyto shardlets blokují přesun dat v průběhu aby se zabránilo nekonzistence.</span><span class="sxs-lookup"><span data-stu-id="71fed-158">When data movement starts for a new batch of shardlets, any shard-map provided data-dependent routing connections to the shard storing the shardlet are killed and subsequent connections from the shard map APIs to the these shardlets are blocked while the data movement is in progress in order to avoid inconsistencies.</span></span> <span data-ttu-id="71fed-159">Připojení k jiné shardlets na stejné ID horizontálního oddílu také získat ukončeny, ale bude úspěšné znovu okamžitě při opakování.</span><span class="sxs-lookup"><span data-stu-id="71fed-159">Connections to other shardlets on the same shard will also get killed, but will succeed again immediately on retry.</span></span> <span data-ttu-id="71fed-160">Po přesunutí dávky shardlets jsou označeny online znovu pro cíl horizontálních a zdrojová data se odebral ze zdroje horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-160">Once the batch is moved, the shardlets are marked online again for the target shard and the source data is removed from the source shard.</span></span> <span data-ttu-id="71fed-161">Služba projde tyto kroky pro každou dávku, dokud všechny shardlets byly přesunuty.</span><span class="sxs-lookup"><span data-stu-id="71fed-161">The service goes through these steps for every batch until all shardlets have been moved.</span></span> <span data-ttu-id="71fed-162">To povede k několik operací kill připojení v průběhu operace dokončit rozdělení nebo sloučení nebo přesunutí.</span><span class="sxs-lookup"><span data-stu-id="71fed-162">This will lead to several connection kill operations during the course of the complete split/merge/move operation.</span></span>  

<span data-ttu-id="71fed-163">**Správa shardlet dostupnosti**</span><span class="sxs-lookup"><span data-stu-id="71fed-163">**Managing shardlet availability**</span></span>

<span data-ttu-id="71fed-164">Omezení připojení ukončení aktuální dávku shardlets, jak je popsáno výše omezuje oboru nedostupnosti na jednu dávku shardlets najednou.</span><span class="sxs-lookup"><span data-stu-id="71fed-164">Limiting the connection killing to the current batch of shardlets as discussed above restricts the scope of unavailability to one batch of shardlets at a time.</span></span> <span data-ttu-id="71fed-165">Toto je upřednostňovaný přes přístup kde dokončení horizontálního oddílu by zůstat offline pro všechny její shardlets v průběhu operace rozdělení nebo sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-165">This is preferred over an approach where the complete shard would remain offline for all its shardlets during the course of a split or merge operation.</span></span> <span data-ttu-id="71fed-166">Velikost dávky, definován jako počet jedinečných shardlets přesunout současně, je parametr konfigurace.</span><span class="sxs-lookup"><span data-stu-id="71fed-166">The size of a batch, defined as the number of distinct shardlets to move at a time, is a configuration parameter.</span></span> <span data-ttu-id="71fed-167">Může být definováno pro každou operaci rozdělení a merge v závislosti na potřebách dostupnost a výkon aplikace.</span><span class="sxs-lookup"><span data-stu-id="71fed-167">It can be defined for each split and merge operation depending on the application’s availability and performance needs.</span></span> <span data-ttu-id="71fed-168">Všimněte si, že rozsah, který se zamykají v mapě horizontálního oddílu může být větší než zadaná velikost dávky.</span><span class="sxs-lookup"><span data-stu-id="71fed-168">Note that the range that is being locked in the shard map may be larger than the batch size specified.</span></span> <span data-ttu-id="71fed-169">To je proto službu vybere velikost rozsah tak, aby skutečný počet horizontálního dělení hodnoty klíče v datech přibližně odpovídá velikost dávky.</span><span class="sxs-lookup"><span data-stu-id="71fed-169">This is because the service picks the range size such that the actual number of sharding key values in the data approximately matches the batch size.</span></span> <span data-ttu-id="71fed-170">To je důležité si pamatovat konkrétně pro klíče řídce vyplněná horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="71fed-170">This is important to remember in particular for sparsely populated sharding keys.</span></span> 

<span data-ttu-id="71fed-171">**Metadata úložiště**</span><span class="sxs-lookup"><span data-stu-id="71fed-171">**Metadata storage**</span></span>

<span data-ttu-id="71fed-172">Služba rozdělení sloučení používá databázi k udržování její stav a udržování protokolů při zpracování požadavku.</span><span class="sxs-lookup"><span data-stu-id="71fed-172">The split-merge service uses a database to maintain its status and to keep logs during request processing.</span></span> <span data-ttu-id="71fed-173">Uživatel vytvoří tato databáze v rámci svého předplatného a poskytuje připojovací řetězec pro ho v konfiguračním souboru pro nasazení služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-173">The user creates this database in their subscription and provides the connection string for it in the configuration file for the service deployment.</span></span> <span data-ttu-id="71fed-174">Správci z organizace uživatele taky můžou připojovat k této databázi můžete zhodnotit průběh žádosti a prozkoumat podrobné informace o potenciální chyby.</span><span class="sxs-lookup"><span data-stu-id="71fed-174">Administrators from the user’s organization can also connect to this database to review request progress and to investigate detailed information regarding potential failures.</span></span>

<span data-ttu-id="71fed-175">**Sledování horizontálního dělení**</span><span class="sxs-lookup"><span data-stu-id="71fed-175">**Sharding-awareness**</span></span>

<span data-ttu-id="71fed-176">Službu rozdělení sloučení rozlišuje (1) horizontálně dělené tabulky, (2) referenční tabulky a (3) normální tabulky.</span><span class="sxs-lookup"><span data-stu-id="71fed-176">The split-merge service differentiates between (1) sharded tables, (2) reference tables, and (3) normal tables.</span></span> <span data-ttu-id="71fed-177">Sémantika rozdělení nebo sloučení nebo přesunutí operace závisí na typu tabulky používá a jsou definovány takto:</span><span class="sxs-lookup"><span data-stu-id="71fed-177">The semantics of a split/merge/move operation depend on the type of the table used and are defined as follows:</span></span> 

* <span data-ttu-id="71fed-178">**Horizontálně dělené tabulky**: operace přesunutí, sloučení a rozdělení přesunout shardlets ze zdrojového do cílového horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-178">**Sharded tables**: Split, merge, and move operations move shardlets from source to target shard.</span></span> <span data-ttu-id="71fed-179">Po úspěšném dokončení celkové požadavku těchto shardlets již neexistují ve zdroji.</span><span class="sxs-lookup"><span data-stu-id="71fed-179">After successful completion of the overall request, those shardlets are no longer present on the source.</span></span> <span data-ttu-id="71fed-180">Všimněte si, že cílové tabulky musí existovat v cílové horizontálního oddílu a nesmí obsahovat data v rozsahu cílového před zpracování operace.</span><span class="sxs-lookup"><span data-stu-id="71fed-180">Note that the target tables need to exist on the target shard and must not contain data in the target range prior to processing of the operation.</span></span> 
* <span data-ttu-id="71fed-181">**Referenční tabulky**: referenční tabulky, rozdělení, sloučení a přesunout operations zkopírovat data ze zdrojové do cílové horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-181">**Reference tables**: For reference tables, the split, merge and move operations copy the data from the source to the target shard.</span></span> <span data-ttu-id="71fed-182">Upozorňujeme však, že žádné změny dojít na horizontálních cíl pro danou tabulku, pokud všechny řádky, se již nachází v této tabulce na cíli.</span><span class="sxs-lookup"><span data-stu-id="71fed-182">Note, however, that no changes occur on the target shard for a given table if any row is already present in this table on the target.</span></span> <span data-ttu-id="71fed-183">V tabulce musí být prázdná pro všechny operace referenční tabulky kopie zpracovat.</span><span class="sxs-lookup"><span data-stu-id="71fed-183">The table has to be empty for any reference table copy operation to get processed.</span></span>
* <span data-ttu-id="71fed-184">**Ostatní tabulky**: ostatní tabulky mohou existovat na buď zdroj nebo cíl operace rozdělení a sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-184">**Other Tables**: Other tables can be present on either the source or the target of a split and merge operation.</span></span> <span data-ttu-id="71fed-185">Službu rozdělení sloučení ignoruje tyto tabulky pro všechny přesuny dat nebo operace kopírování.</span><span class="sxs-lookup"><span data-stu-id="71fed-185">The split-merge service disregards these tables for any data movement or copy operations.</span></span> <span data-ttu-id="71fed-186">Upozorňujeme však, že může narušovat tyto operace v případě omezení.</span><span class="sxs-lookup"><span data-stu-id="71fed-186">Note, however, that they can interfere with these operations in case of constraints.</span></span>

<span data-ttu-id="71fed-187">Informace na odkaz oproti horizontálně dělené tabulky jsou poskytovány **SchemaInfo** rozhraní API na mapě horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-187">The information on reference vs. sharded tables is provided by the **SchemaInfo** APIs on the shard map.</span></span> <span data-ttu-id="71fed-188">Následující příklad ukazuje použití tato rozhraní API na danou horizontálních mapy manager objekt smm:</span><span class="sxs-lookup"><span data-stu-id="71fed-188">The following example illustrates the use of these APIs on a given shard map manager object smm:</span></span> 

    // Create the schema annotations 
    SchemaInfo schemaInfo = new SchemaInfo(); 

    // Reference tables 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "region")); 
    schemaInfo.Add(new ReferenceTableInfo("dbo", "nation")); 

    // Sharded tables 
    schemaInfo.Add(new ShardedTableInfo("dbo", "customer", "C_CUSTKEY")); 
    schemaInfo.Add(new ShardedTableInfo("dbo", "orders", "O_CUSTKEY")); 

    // Publish 
    smm.GetSchemaInfoCollection().Add(Configuration.ShardMapName, schemaInfo); 

<span data-ttu-id="71fed-189">Region' tabulky' a 'výhod, jsou definovány jako referenční tabulky a budou zkopírovány s operacemi rozdělení nebo sloučení nebo přesunutí.</span><span class="sxs-lookup"><span data-stu-id="71fed-189">The tables ‘region’ and ‘nation’ are defined as reference tables and will be copied with split/merge/move operations.</span></span> <span data-ttu-id="71fed-190">"zákazník" a "objednávky, pak jsou definovány jako horizontálně dělené tabulky.</span><span class="sxs-lookup"><span data-stu-id="71fed-190">‘customer’ and ‘orders’ in turn are defined as sharded tables.</span></span> <span data-ttu-id="71fed-191">C_CUSTKEY a O_CUSTKEY slouží jako klíč horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="71fed-191">C_CUSTKEY and O_CUSTKEY serve as the sharding key.</span></span> 

<span data-ttu-id="71fed-192">**Referenční integrita**</span><span class="sxs-lookup"><span data-stu-id="71fed-192">**Referential Integrity**</span></span>

<span data-ttu-id="71fed-193">Službu rozdělení sloučení analyzuje závislosti mezi tabulkami a příprava operací pro přesun referenční tabulky a shardlets pomocí relace cizích klíčů primární klíč.</span><span class="sxs-lookup"><span data-stu-id="71fed-193">The split-merge service analyzes dependencies between tables and uses foreign key-primary key relationships to stage the operations for moving reference tables and shardlets.</span></span> <span data-ttu-id="71fed-194">Obecně platí referenční tabulky se zkopírují první v pořadí závislostí, pak shardlets zkopírují v pořadí podle jejich závislosti v rámci každé dávky.</span><span class="sxs-lookup"><span data-stu-id="71fed-194">In general, reference tables are copied first in dependency order, then shardlets are copied in order of their dependencies within each batch.</span></span> <span data-ttu-id="71fed-195">To je nezbytné, aby Primárníklíč-Cizíklíč omezení na cílové horizontálního oddílu se uplatní jako dorazí nová data.</span><span class="sxs-lookup"><span data-stu-id="71fed-195">This is necessary so that FK-PK constraints on the target shard are honored as the new data arrives.</span></span> 

<span data-ttu-id="71fed-196">**Konzistence mapy horizontálního oddílu a případné dokončení**</span><span class="sxs-lookup"><span data-stu-id="71fed-196">**Shard Map Consistency and Eventual Completion**</span></span>

<span data-ttu-id="71fed-197">V případě selhání službu rozdělení sloučení obnoví operations po všech výpadku a cílem je dokončete všechny v žádostech o průběhu.</span><span class="sxs-lookup"><span data-stu-id="71fed-197">In the presence of failures, the split-merge service resumes operations after any outage and aims to complete any in progress requests.</span></span> <span data-ttu-id="71fed-198">Však může existovat neopravitelné situacích, například horizontálního oddílu cíl je ztrátě nebo zneužití nad rámec opravit.</span><span class="sxs-lookup"><span data-stu-id="71fed-198">However, there may be unrecoverable situations, e.g., when the target shard is lost or compromised beyond repair.</span></span> <span data-ttu-id="71fed-199">Za těchto okolností může stále některé shardlets, který se má přesunout na horizontálních zdroje.</span><span class="sxs-lookup"><span data-stu-id="71fed-199">Under those circumstances, some shardlets that were supposed to be moved may continue to reside on the source shard.</span></span> <span data-ttu-id="71fed-200">Službu zajistí, že shardlet mapování jsou aktualizovány pouze po potřebná data byl úspěšně zkopírován do cílové.</span><span class="sxs-lookup"><span data-stu-id="71fed-200">The service ensures that shardlet mappings are only updated after the necessary data has been successfully copied to the target.</span></span> <span data-ttu-id="71fed-201">Shardlets se odstraní pouze ve zdroji, po všech svých dat byl zkopírován do cílové a odpovídající mapování bylo úspěšně aktualizováno.</span><span class="sxs-lookup"><span data-stu-id="71fed-201">Shardlets are only deleted on the source once all their data has been copied to the target and the corresponding mappings have been updated successfully.</span></span> <span data-ttu-id="71fed-202">Operace odstranění se odehrává na pozadí při rozsahu již v cílové horizontálních online.</span><span class="sxs-lookup"><span data-stu-id="71fed-202">The deletion operation happens in the background while the range is already online on the target shard.</span></span> <span data-ttu-id="71fed-203">Službu rozdělení sloučení vždy zajišťuje správnost mapování uložené v mapě horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-203">The split-merge service always ensures correctness of the mappings stored in the shard map.</span></span>

## <a name="the-split-merge-user-interface"></a><span data-ttu-id="71fed-204">Rozdělení sloučení uživatelského rozhraní</span><span class="sxs-lookup"><span data-stu-id="71fed-204">The split-merge user interface</span></span>
<span data-ttu-id="71fed-205">Balíček služby rozdělení sloučení zahrnuje roli pracovního procesu a webové role.</span><span class="sxs-lookup"><span data-stu-id="71fed-205">The split-merge service package includes a worker role and a web role.</span></span> <span data-ttu-id="71fed-206">Webové role se používá k odesílání žádostí o rozdělení sloučení interaktivní způsobem.</span><span class="sxs-lookup"><span data-stu-id="71fed-206">The web role is used to submit split-merge requests in an interactive way.</span></span> <span data-ttu-id="71fed-207">Hlavní součásti uživatelského rozhraní jsou následující:</span><span class="sxs-lookup"><span data-stu-id="71fed-207">The main components of the user interface are as follows:</span></span>

* <span data-ttu-id="71fed-208">Typ operace: Typ operace je přepínač, který určuje typ operace provést pomocí služby pro tento požadavek.</span><span class="sxs-lookup"><span data-stu-id="71fed-208">Operation Type: The operation type is a radio button that controls the kind of operation performed by the service for this request.</span></span> <span data-ttu-id="71fed-209">Můžete si vybrat mezi rozdělení, sloučení a přesuňte scénáře.</span><span class="sxs-lookup"><span data-stu-id="71fed-209">You can choose between the split, merge and move scenarios.</span></span> <span data-ttu-id="71fed-210">Můžete také zrušit dříve odeslaný operaci.</span><span class="sxs-lookup"><span data-stu-id="71fed-210">You can also cancel a previously submitted operation.</span></span> <span data-ttu-id="71fed-211">Můžete použít rozdělení, sloučení a přesunout požadavky pro rozsah horizontálního oddílu mapy.</span><span class="sxs-lookup"><span data-stu-id="71fed-211">You can use split, merge and move requests for range shard maps.</span></span> <span data-ttu-id="71fed-212">Seznam horizontálních mapuje pouze operace přesunutí podpory.</span><span class="sxs-lookup"><span data-stu-id="71fed-212">List shard maps only support move operations.</span></span>
* <span data-ttu-id="71fed-213">Mapování horizontálních: V další části Parametry žádosti se týkají informací o mapy horizontálního oddílu a hostování mapu horizontálního oddílu databáze.</span><span class="sxs-lookup"><span data-stu-id="71fed-213">Shard Map: The next section of request parameters cover information about the shard map and the database hosting your shard map.</span></span> <span data-ttu-id="71fed-214">Konkrétně je třeba zadat název serveru Azure SQL Database a hostování shardmap, pověření pro připojení k databázi mapy horizontálního oddílu a nakonec název mapování horizontálních databáze.</span><span class="sxs-lookup"><span data-stu-id="71fed-214">In particular, you need to provide the name of the Azure SQL Database server and database hosting the shardmap, credentials to connect to the shard map database, and finally the name of the shard map.</span></span> <span data-ttu-id="71fed-215">Operaci v současné době přijímá pouze jedinou sadu pověření.</span><span class="sxs-lookup"><span data-stu-id="71fed-215">Currently, the operation only accepts a single set of credentials.</span></span> <span data-ttu-id="71fed-216">Tyto přihlašovací údaje musí mít dostatečná oprávnění k provedení změny mapy horizontálního oddílu také tak, aby data uživatele na horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="71fed-216">These credentials need to have sufficient permissions to perform changes to the shard map as well as to the user data on the shards.</span></span>
* <span data-ttu-id="71fed-217">Rozsah zdrojových (rozdělení a sloučení): operace rozdělení a sloučení zpracovává rozsah pomocí klíče vysoké a nízké.</span><span class="sxs-lookup"><span data-stu-id="71fed-217">Source Range (split and merge): A split and merge operation processes a range using its low and high key.</span></span> <span data-ttu-id="71fed-218">Pokud chcete zadat operace s hodnotou klíče bez vazby vysoké, zaškrtnutím políčka "vysoká hodnota klíče je maximální" a vysokou klíčové pole ponechte prázdné.</span><span class="sxs-lookup"><span data-stu-id="71fed-218">To specify an operation with an unbounded high key value, check the “High key is max” check box and leave the high key field empty.</span></span> <span data-ttu-id="71fed-219">Rozsah hodnoty klíče, které zadáte, není potřeba přesně odpovídají mapování a jeho hranice na mapě horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-219">The range key values that you specify do not need to precisely match a mapping and its boundaries in your shard map.</span></span> <span data-ttu-id="71fed-220">Pokud nezadáte vůbec žádné hranice rozsahu službu automaticky odvození nejbližší rozsahu.</span><span class="sxs-lookup"><span data-stu-id="71fed-220">If you do not specify any range boundaries at all the service will infer the closest range for you automatically.</span></span> <span data-ttu-id="71fed-221">Můžete použít skript prostředí PowerShell GetMappings.ps1 načíst aktuální mapování v mapě dané horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-221">You can use the GetMappings.ps1 PowerShell script to retrieve the current mappings in a given shard map.</span></span>
* <span data-ttu-id="71fed-222">Rozdělení zdroj chování (rozdělení): pro rozdělení operace definovat bodem rozdělení zdrojový rozsah.</span><span class="sxs-lookup"><span data-stu-id="71fed-222">Split Source Behavior (split): For split operations, define the point to split the source range.</span></span> <span data-ttu-id="71fed-223">To provedete zadáním horizontálního dělení klíč, kam chcete rozdělit.</span><span class="sxs-lookup"><span data-stu-id="71fed-223">You do this by providing the sharding key where you want the split to occur.</span></span> <span data-ttu-id="71fed-224">Použijte přepínač zadejte, zda chcete dolní části rozsahu (s výjimkou klíče rozdělení) přesunout, nebo jestli chcete horní části přesunout (včetně klíče rozdělení).</span><span class="sxs-lookup"><span data-stu-id="71fed-224">Use the radio button specify whether you want the lower part of the range (excluding the split key) to move, or whether you want the upper part to move (including the split key).</span></span>
* <span data-ttu-id="71fed-225">Zdroj Shardlet (přesunout): přesunout operace se liší od rozdělení nebo sloučení operací, jako nevyžadují rozsahu popisují zdroji.</span><span class="sxs-lookup"><span data-stu-id="71fed-225">Source Shardlet (move): Move operations are different from split or merge operations as they do not require a range to describe the source.</span></span> <span data-ttu-id="71fed-226">Zdroj pro přesun je jednoduše identifikována horizontálního dělení hodnota klíče, který chcete přesunout.</span><span class="sxs-lookup"><span data-stu-id="71fed-226">A source for move is simply identified by the sharding key value that you plan to move.</span></span>
* <span data-ttu-id="71fed-227">Cíl horizontálního oddílu (rozdělení): po zadané informace ve zdroji operaci rozdělení, je třeba definovat, kam chcete data zkopírovat tím, že poskytuje název serveru a databáze Azure SQL Db pro cíl.</span><span class="sxs-lookup"><span data-stu-id="71fed-227">Target Shard (split): Once you have provided the information on the source of your split operation, you need to define where you want the data to be copied to by providing the Azure SQL Db server and database name for the target.</span></span>
* <span data-ttu-id="71fed-228">Cílový rozsah (sloučení): operace sloučení přesunout shardlets do existující horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-228">Target Range (merge): Merge operations move shardlets to an existing shard.</span></span> <span data-ttu-id="71fed-229">Tím, že poskytuje rozsah hranice existující rozsahu, který chcete sloučit s identifikujete existující horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-229">You identify the existing shard by providing the range boundaries of the existing range that you want to merge with.</span></span>
* <span data-ttu-id="71fed-230">Velikost dávky: Velikost dávky řídí počet shardlets, která přejde do režimu offline v době při přesunu dat.</span><span class="sxs-lookup"><span data-stu-id="71fed-230">Batch Size: The batch size controls the number of shardlets that will go offline at a time during the data movement.</span></span> <span data-ttu-id="71fed-231">Toto je celočíselná hodnota, kde můžete použít nižší hodnoty po citlivé dlouhé doby výpadku pro shardlets.</span><span class="sxs-lookup"><span data-stu-id="71fed-231">This is an integer value where you can use smaller values when you are sensitive to long periods of downtime for shardlets.</span></span> <span data-ttu-id="71fed-232">Vyšší hodnoty zvýší čas, který je daný shardlet offline však může zvýšit výkon.</span><span class="sxs-lookup"><span data-stu-id="71fed-232">Larger values will increase the time that a given shardlet is offline but may improve performance.</span></span>
* <span data-ttu-id="71fed-233">Id operace (zrušit): Pokud máte probíhající operace, která již nepotřebujete, můžete tuto operace zrušíte tím, že poskytuje jeho ID operace v tomto poli.</span><span class="sxs-lookup"><span data-stu-id="71fed-233">Operation Id (Cancel): If you have an ongoing operation that is no longer needed, you can cancel the operation by providing its operation ID in this field.</span></span> <span data-ttu-id="71fed-234">ID operace můžete načíst z tabulky stav žádosti (viz oddíl 8.1) nebo z výstupu ve webovém prohlížeči, kde jste odeslali žádost.</span><span class="sxs-lookup"><span data-stu-id="71fed-234">You can retrieve the operation ID from the request status table (see Section 8.1) or from the output in the web browser where you submitted the request.</span></span>

## <a name="requirements-and-limitations"></a><span data-ttu-id="71fed-235">Požadavky a omezení</span><span class="sxs-lookup"><span data-stu-id="71fed-235">Requirements and Limitations</span></span>
<span data-ttu-id="71fed-236">Aktuální implementace služby rozdělení sloučení podléhá následující požadavky a omezení:</span><span class="sxs-lookup"><span data-stu-id="71fed-236">The current implementation of the split-merge service is subject to the following requirements and limitations:</span></span> 

* <span data-ttu-id="71fed-237">Horizontálních oddílů je třeba existovat a být zaregistrovaný v mapě horizontálního oddílu, před provedením operace sloučení rozdělení na těchto horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="71fed-237">The shards need to exist and be registered in the shard map before a split-merge operation on these shards can be performed.</span></span> 
* <span data-ttu-id="71fed-238">Služba nevytváří tabulky a všechny další objekty databáze automaticky v rámci jeho operací.</span><span class="sxs-lookup"><span data-stu-id="71fed-238">The service does not create tables or any other database objects automatically as part of its operations.</span></span> <span data-ttu-id="71fed-239">To znamená, že schéma pro všechny horizontálně dělené tabulky a referenční tabulky musí existovat v cílové horizontálních před všechny operace rozdělení nebo sloučení nebo přesunutí.</span><span class="sxs-lookup"><span data-stu-id="71fed-239">This means that the schema for all sharded tables and reference tables need to exist on the target shard prior to any split/merge/move operation.</span></span> <span data-ttu-id="71fed-240">Horizontálně dělené tabulky konkrétně musí být v rozsahu, kde jsou nové shardlets přidávaného operací rozdělení nebo sloučení nebo přesunutí prázdné.</span><span class="sxs-lookup"><span data-stu-id="71fed-240">Sharded tables in particular are required to be empty in the range where new shardlets are to be added by a split/merge/move operation.</span></span> <span data-ttu-id="71fed-241">Jinak se operace nezdaří Kontrola konzistence počáteční na cílové horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-241">Otherwise, the operation will fail the initial consistency check on the target shard.</span></span> <span data-ttu-id="71fed-242">Všimněte si, že odkaz, který data se zkopírují, pouze pokud odkaz je tabulka prázdná a že nejsou žádné záruky konzistence s ohledem na ostatní souběžných operací zápisu na referenční tabulky.</span><span class="sxs-lookup"><span data-stu-id="71fed-242">Also note that reference data is only copied if the reference table is empty and that there are no consistency guarantees with regard to other concurrent write operations on the reference tables.</span></span> <span data-ttu-id="71fed-243">Doporučujeme toto: při spuštění operace rozdělení nebo sloučení, žádné jiné operace zápisu provést změny referenční tabulky.</span><span class="sxs-lookup"><span data-stu-id="71fed-243">We recommend this: when running split/merge operations, no other write operations make changes to the reference tables.</span></span>
* <span data-ttu-id="71fed-244">Služba závisí na řádek identity vytvořit jedinečný index nebo klíč, který obsahuje klíč horizontálního dělení ke zlepšení výkonu a spolehlivosti pro velké shardlets.</span><span class="sxs-lookup"><span data-stu-id="71fed-244">The service relies on row identity established by a unique index or key that includes the sharding key to improve performance and reliability for large shardlets.</span></span> <span data-ttu-id="71fed-245">To umožňuje služby pro přesun dat na i podrobnější než právě horizontálního dělení hodnota klíče.</span><span class="sxs-lookup"><span data-stu-id="71fed-245">This allows the service to move data at an even finer granularity than just the sharding key value.</span></span> <span data-ttu-id="71fed-246">To pomáhá snížit maximální množství místa protokolu a zámky, které jsou požadovány při operaci.</span><span class="sxs-lookup"><span data-stu-id="71fed-246">This helps to reduce the maximum amount of log space and locks that are required during the operation.</span></span> <span data-ttu-id="71fed-247">Zvažte vytvoření jedinečný index nebo primární klíč, včetně horizontálního dělení klíče v dané tabulce, pokud chcete použít tuto tabulku s žádostmi o rozdělení nebo sloučení nebo přesunutí.</span><span class="sxs-lookup"><span data-stu-id="71fed-247">Consider creating a unique index or a primary key including the sharding key on a given table if you want to use that table with split/merge/move requests.</span></span> <span data-ttu-id="71fed-248">Z důvodů výkonu musí být klíč horizontálního dělení počáteční sloupec v klíč nebo index.</span><span class="sxs-lookup"><span data-stu-id="71fed-248">For performance reasons, the sharding key should be the leading column in the key or the index.</span></span>
* <span data-ttu-id="71fed-249">Během zpracování žádosti může být některá data shardlet existuje zdrojové a cílové horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-249">During the course of request processing, some shardlet data may be present both on the source and the target shard.</span></span> <span data-ttu-id="71fed-250">To je nezbytné k ochraně proti selhání během pohybu shardlet.</span><span class="sxs-lookup"><span data-stu-id="71fed-250">This is necessary to protect against failures during the shardlet movement.</span></span> <span data-ttu-id="71fed-251">Integrace rozdělení sloučení s mapy horizontálního oddílu zajišťuje, že připojení prostřednictvím data závislé směrování rozhraní API **OpenConnectionForKey** metoda na mapě horizontálního oddílu nejsou vidět všechny nekonzistentní zprostředkující stavy.</span><span class="sxs-lookup"><span data-stu-id="71fed-251">The integration of split-merge with the shard map ensures that connections through the data dependent routing APIs using the **OpenConnectionForKey** method on the shard map do not see any inconsistent intermediate states.</span></span> <span data-ttu-id="71fed-252">Ale při připojení ke zdroji nebo horizontálních oddílů cíl bez použití **OpenConnectionForKey** metoda, nekonzistentní zprostředkující stavy může být viditelné, pokud se děje rozdělení nebo sloučení nebo přesunutí požadavky.</span><span class="sxs-lookup"><span data-stu-id="71fed-252">However, when connecting to the source or the target shards without using the **OpenConnectionForKey** method, inconsistent intermediate states might be visible when split/merge/move requests are going on.</span></span> <span data-ttu-id="71fed-253">Tato připojení může zobrazovat částečné nebo duplicitní výsledky v závislosti na načasování nebo komplikovaného skládání architektury základní připojení.</span><span class="sxs-lookup"><span data-stu-id="71fed-253">These connections may show partial or duplicate results depending on the timing or the shard underlying the connection.</span></span> <span data-ttu-id="71fed-254">Toto omezení teď zahrnuje připojení vytvořená elastické škálování Shard více – dotazy.</span><span class="sxs-lookup"><span data-stu-id="71fed-254">This limitation currently includes the connections made by Elastic Scale Multi-Shard-Queries.</span></span>
* <span data-ttu-id="71fed-255">Databázi metadat pro službu rozdělení sloučení nesmí sdílet mezi různé role.</span><span class="sxs-lookup"><span data-stu-id="71fed-255">The metadata database for the split-merge service must not be shared between different roles.</span></span> <span data-ttu-id="71fed-256">Například role rozdělení sloučení služby spuštěné v pracovní musí odkazovat na jiné metadata databáze než roli produkční.</span><span class="sxs-lookup"><span data-stu-id="71fed-256">For example, a role of the split-merge service running in staging needs to point to a different metadata database than the production role.</span></span>

## <a name="billing"></a><span data-ttu-id="71fed-257">Fakturace</span><span class="sxs-lookup"><span data-stu-id="71fed-257">Billing</span></span>
<span data-ttu-id="71fed-258">Službu rozdělení sloučení běží jako cloudová služba v rámci vašeho předplatného Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="71fed-258">The split-merge service runs as a cloud service in your Microsoft Azure subscription.</span></span> <span data-ttu-id="71fed-259">Proto platí poplatky za cloudové služby pro vaše instance služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-259">Therefore charges for cloud services apply to your instance of the service.</span></span> <span data-ttu-id="71fed-260">Pokud provádíte často rozdělení nebo sloučení nebo přesunutí operace, doporučujeme že odstranit rozdělení sloučení cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-260">Unless you frequently perform split/merge/move operations, we recommend you delete your split-merge cloud service.</span></span> <span data-ttu-id="71fed-261">Která šetří náklady pro spuštění nebo nasazena instance služby cloudu.</span><span class="sxs-lookup"><span data-stu-id="71fed-261">That saves costs for running or deployed cloud service instances.</span></span> <span data-ttu-id="71fed-262">Můžete znovu nasadit a spustit konfiguraci snadno spustitelného kdykoli budete potřebovat k provádění operací rozdělení nebo sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-262">You can re-deploy and start your readily runnable configuration whenever you need to perform split or merge operations.</span></span> 

## <a name="monitoring"></a><span data-ttu-id="71fed-263">Monitorování</span><span class="sxs-lookup"><span data-stu-id="71fed-263">Monitoring</span></span>
### <a name="status-tables"></a><span data-ttu-id="71fed-264">Stav tabulky</span><span class="sxs-lookup"><span data-stu-id="71fed-264">Status tables</span></span>
<span data-ttu-id="71fed-265">Poskytuje službu sloučení rozdělení **stavem** tabulky v databázi metadat úložiště pro monitorování dokončené a probíhající požadavků.</span><span class="sxs-lookup"><span data-stu-id="71fed-265">The split-merge Service provides the **RequestStatus** table in the metadata store database for monitoring of completed and ongoing requests.</span></span> <span data-ttu-id="71fed-266">V tabulce jsou uvedeny řádek pro každý požadavek sloučení rozdělení byla odeslána na tuto instanci službu rozdělení sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-266">The table lists a row for each split-merge request that has been submitted to this instance of the split-merge service.</span></span> <span data-ttu-id="71fed-267">Nabízí následující informace pro každý požadavek:</span><span class="sxs-lookup"><span data-stu-id="71fed-267">It gives the following information for each request:</span></span>

* <span data-ttu-id="71fed-268">**Časové razítko**: čas a datum, když požadavek.</span><span class="sxs-lookup"><span data-stu-id="71fed-268">**Timestamp**: The time and date when the request was started.</span></span>
* <span data-ttu-id="71fed-269">**OperationId**: A identifikátor GUID, který jedinečně identifikuje požadavek.</span><span class="sxs-lookup"><span data-stu-id="71fed-269">**OperationId**: A GUID that uniquely identifies the request.</span></span> <span data-ttu-id="71fed-270">Tento požadavek lze také zrušte operaci, i když je stále probíhají.</span><span class="sxs-lookup"><span data-stu-id="71fed-270">This request can also be used to cancel the operation while it is still ongoing.</span></span>
* <span data-ttu-id="71fed-271">**Stav**: aktuální stav žádosti.</span><span class="sxs-lookup"><span data-stu-id="71fed-271">**Status**: The current state of the request.</span></span> <span data-ttu-id="71fed-272">Probíhající požadavky také vypíše aktuální fáze, ve kterém se nachází daná žádost.</span><span class="sxs-lookup"><span data-stu-id="71fed-272">For ongoing requests, it also lists the current phase in which the request is.</span></span>
* <span data-ttu-id="71fed-273">**CancelRequest**: Příznak určující, zda požadavek byl zrušen.</span><span class="sxs-lookup"><span data-stu-id="71fed-273">**CancelRequest**: A flag that indicates whether the request has been cancelled.</span></span>
* <span data-ttu-id="71fed-274">**Průběh**: procento odhad dokončení operace.</span><span class="sxs-lookup"><span data-stu-id="71fed-274">**Progress**: A percentage estimate of completion for the operation.</span></span> <span data-ttu-id="71fed-275">Hodnota 50 značí, že operace je přibližně 50 % dokončení.</span><span class="sxs-lookup"><span data-stu-id="71fed-275">A value of 50 indicates that the operation is approximately 50% complete.</span></span>
* <span data-ttu-id="71fed-276">**Podrobnosti o**: hodnota ve formátu XML, která poskytuje podrobnější sestava průběhu.</span><span class="sxs-lookup"><span data-stu-id="71fed-276">**Details**: An XML value that provides a more detailed progress report.</span></span> <span data-ttu-id="71fed-277">Sestava průběhu jsou pravidelně aktualizovány sady řádků se zkopírují ze zdroje k cíli.</span><span class="sxs-lookup"><span data-stu-id="71fed-277">The progress report is periodically updated as sets of rows are copied from source to target.</span></span> <span data-ttu-id="71fed-278">V případě selhání nebo výjimky tento sloupec také obsahuje podrobnější informace o selhání.</span><span class="sxs-lookup"><span data-stu-id="71fed-278">In case of failures or exceptions, this column also includes more detailed information about the failure.</span></span>

### <a name="azure-diagnostics"></a><span data-ttu-id="71fed-279">Diagnostika Azure</span><span class="sxs-lookup"><span data-stu-id="71fed-279">Azure Diagnostics</span></span>
<span data-ttu-id="71fed-280">Služba rozdělení sloučení používá Azure Diagnostics podle Azure SDK 2.5 pro monitorování a Diagnostika.</span><span class="sxs-lookup"><span data-stu-id="71fed-280">The split-merge service uses Azure Diagnostics based on Azure SDK 2.5 for monitoring and diagnostics.</span></span> <span data-ttu-id="71fed-281">Jak je popsáno v tomto poli se řídit konfigurace diagnostiky: [povolení diagnostiky Azure Cloud Services a virtuálních počítačů](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="71fed-281">You control the diagnostics configuration as explained here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> <span data-ttu-id="71fed-282">Balíček ke stažení obsahuje dvě konfigurace diagnostiky – jeden pro webovou roli a jeden pro roli pracovního procesu.</span><span class="sxs-lookup"><span data-stu-id="71fed-282">The download package includes two diagnostics configurations - one for the web role and one for the worker role.</span></span> <span data-ttu-id="71fed-283">Tyto konfigurace diagnostiky pro službu, postupujte podle pokynů od [základy cloudové služby ve službě Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span><span class="sxs-lookup"><span data-stu-id="71fed-283">These diagnostics configurations for the service follow the guidance from [Cloud Service Fundamentals in Microsoft Azure](https://code.msdn.microsoft.com/windowsazure/Cloud-Service-Fundamentals-4ca72649).</span></span> <span data-ttu-id="71fed-284">Obsahuje definice pro čítače výkonu, protokoly služby IIS, protokoly událostí systému Windows a protokoly událostí aplikace rozdělení sloučení protokolu.</span><span class="sxs-lookup"><span data-stu-id="71fed-284">It includes the definitions to log Performance Counters, IIS logs, Windows Event Logs, and split-merge application event logs.</span></span> 

## <a name="deploy-diagnostics"></a><span data-ttu-id="71fed-285">Nasazení diagnostiky</span><span class="sxs-lookup"><span data-stu-id="71fed-285">Deploy Diagnostics</span></span>
<span data-ttu-id="71fed-286">Chcete-li povolit monitorování a Diagnostika pomocí konfigurace diagnostiky pro webové a pracovní role poskytovaný balíček NuGet, spusťte následující příkazy pomocí Azure PowerShell:</span><span class="sxs-lookup"><span data-stu-id="71fed-286">To enable monitoring and diagnostics using the diagnostic configuration for the web and worker roles provided by the NuGet package, run the following commands using Azure PowerShell:</span></span> 

    $storage_name = "<YourAzureStorageAccount>" 

    $key = "<YourAzureStorageAccountKey" 

    $storageContext = New-AzureStorageContext -StorageAccountName $storage_name -StorageAccountKey $key  


    $config_path = "<YourFilePath>\SplitMergeWebContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWeb" 


    $config_path = "<YourFilePath>\SplitMergeWorkerContent.diagnostics.xml" 

    $service_name = "<YourCloudServiceName>" 

    Set-AzureServiceDiagnosticsExtension -StorageContext $storageContext -DiagnosticsConfigurationPath $config_path -ServiceName $service_name -Slot Production -Role "SplitMergeWorker" 

<span data-ttu-id="71fed-287">Můžete najít další informace o tom, jak nakonfigurovat a nasadit nastavení diagnostiky zde: [povolení diagnostiky Azure Cloud Services a virtuálních počítačů](../cloud-services/cloud-services-dotnet-diagnostics.md).</span><span class="sxs-lookup"><span data-stu-id="71fed-287">You can find more information on how to configure and deploy diagnostics settings here: [Enabling Diagnostics in Azure Cloud Services and Virtual Machines](../cloud-services/cloud-services-dotnet-diagnostics.md).</span></span> 

## <a name="retrieve-diagnostics"></a><span data-ttu-id="71fed-288">Načtení diagnostiky</span><span class="sxs-lookup"><span data-stu-id="71fed-288">Retrieve diagnostics</span></span>
<span data-ttu-id="71fed-289">Z Průzkumníka serveru Visual Studia v Azure části stromu Průzkumníka serveru můžete snadný přístup k vaší diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="71fed-289">You can easily access your diagnostics from the Visual Studio Server Explorer in the Azure part of the Server Explorer tree.</span></span> <span data-ttu-id="71fed-290">Otevřete Visual Studio instance a v řádku nabídek klikněte na zobrazení a Průzkumníka serveru.</span><span class="sxs-lookup"><span data-stu-id="71fed-290">Open a Visual Studio instance, and in the menu bar click View, and Server Explorer.</span></span> <span data-ttu-id="71fed-291">Klikněte na ikonu Azure pro připojení k předplatnému Azure.</span><span class="sxs-lookup"><span data-stu-id="71fed-291">Click the Azure icon to connect to your Azure subscription.</span></span> <span data-ttu-id="71fed-292">Potom přejděte na Azure -> úložiště -> <your storage account> -> WADLogsTable-tabulky >.</span><span class="sxs-lookup"><span data-stu-id="71fed-292">Then navigate to Azure -> Storage -> <your storage account> -> Tables -> WADLogsTable.</span></span> <span data-ttu-id="71fed-293">Další informace najdete v tématu [procházení prostředků úložiště pomocí Průzkumníka serveru](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span><span class="sxs-lookup"><span data-stu-id="71fed-293">For more information, see [Browsing Storage Resources with Server Explorer](http://msdn.microsoft.com/library/azure/ff683677.aspx).</span></span> 

![WADLogsTable][2]

<span data-ttu-id="71fed-295">WADLogsTable zvýrazněných v předchozí obrázek obsahuje podrobné události z protokolu aplikace služby rozdělení sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-295">The WADLogsTable highlighted in the figure above contains the detailed events from the split-merge service’s application log.</span></span> <span data-ttu-id="71fed-296">Všimněte si, že výchozí konfigurace staženého balíčku byla zaměřena produkční nasazení.</span><span class="sxs-lookup"><span data-stu-id="71fed-296">Note that the default configuration of the downloaded package is geared towards a production deployment.</span></span> <span data-ttu-id="71fed-297">Interval, ve kterém jsou vyžádány protokoly a čítače od instance služby je proto velké (5 minut).</span><span class="sxs-lookup"><span data-stu-id="71fed-297">Therefore the interval at which logs and counters are pulled from the service instances is large (5 minutes).</span></span> <span data-ttu-id="71fed-298">Pro testovací a vývojové snižte interval úpravou nastavení diagnostiky webu nebo role pracovního procesu vašim potřebám.</span><span class="sxs-lookup"><span data-stu-id="71fed-298">For test and development, lower the interval by adjusting the diagnostics settings of the web or the worker role to your needs.</span></span> <span data-ttu-id="71fed-299">Klikněte pravým tlačítkem na roli v Průzkumníka serveru Visual Studia (viz výše) a upravte časový interval přenosu v dialogu pro nastavení konfigurace diagnostiky:</span><span class="sxs-lookup"><span data-stu-id="71fed-299">Right-click on the role in the Visual Studio Server Explorer (see above) and then adjust the Transfer Period in the dialog for the Diagnostics configuration settings:</span></span> 

![Konfigurace][3]

## <a name="performance"></a><span data-ttu-id="71fed-301">Výkon</span><span class="sxs-lookup"><span data-stu-id="71fed-301">Performance</span></span>
<span data-ttu-id="71fed-302">Obecně platí je lepší výkon očekávat od tím vyšší další původce úrovně služeb ve službě Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="71fed-302">In general, better performance is to be expected from the higher, more performant service tiers in Azure SQL Database.</span></span> <span data-ttu-id="71fed-303">Vyšší vstupně-výstupní operace, procesoru a paměti přidělení pro vyšší úrovně služeb využívat hromadné kopírování a odstraňte operace, které používá služba rozdělení sloučení.</span><span class="sxs-lookup"><span data-stu-id="71fed-303">Higher IO, CPU and memory allocations for the higher service tiers benefit the bulk copy and delete operations that the split-merge service uses.</span></span> <span data-ttu-id="71fed-304">Z tohoto důvodu zvýšit úroveň služby jen pro tyto databáze definované, omezenou dobu.</span><span class="sxs-lookup"><span data-stu-id="71fed-304">For that reason, increase the service tier just for those databases for a defined, limited period of time.</span></span>

<span data-ttu-id="71fed-305">Služba také provede ověření dotazů v rámci jeho běžných operací.</span><span class="sxs-lookup"><span data-stu-id="71fed-305">The service also performs validation queries as part of its normal operations.</span></span> <span data-ttu-id="71fed-306">Tyto dotazy ověření zkontrolujte neočekávané přítomnosti dat v rozsahu cílového a zajistilo, že všechny operace rozdělení nebo sloučení nebo přesunutí spuštění z konzistentním stavu.</span><span class="sxs-lookup"><span data-stu-id="71fed-306">These validation queries check for unexpected presence of data in the target range and ensure that any split/merge/move operation starts from a consistent state.</span></span> <span data-ttu-id="71fed-307">Všechny tyto dotazy fungovat přes horizontálního dělení rozsahy klíčů definované oboru operace a velikost dávky k dispozici jako součást definice žádosti.</span><span class="sxs-lookup"><span data-stu-id="71fed-307">These queries all work over sharding key ranges defined by the scope of the operation and the batch size provided as part of the request definition.</span></span> <span data-ttu-id="71fed-308">Tyto dotazy se nejlépe provést, pokud indexu je přítomen, který má klíč horizontálního dělení jako počáteční sloupec.</span><span class="sxs-lookup"><span data-stu-id="71fed-308">These queries perform best when an index is present that has the sharding key as the leading column.</span></span> 

<span data-ttu-id="71fed-309">Kromě toho jedinečnosti vlastnost klíčem horizontálního dělení jako počáteční sloupec povolí službu na používání optimalizované přístup, který omezuje spotřeby prostředků z hlediska místa protokolu a paměti.</span><span class="sxs-lookup"><span data-stu-id="71fed-309">In addition, a uniqueness property with the sharding key as the leading column will allow the service to use an optimized approach that limits resource consumption in terms of log space and memory.</span></span> <span data-ttu-id="71fed-310">Tato vlastnost jedinečnosti je potřeba přesunout velikostí velkých objemů dat (obvykle vyšší než 1GB).</span><span class="sxs-lookup"><span data-stu-id="71fed-310">This uniqueness property is required to move large data sizes (typically above 1GB).</span></span> 

## <a name="how-to-upgrade"></a><span data-ttu-id="71fed-311">Postup upgradu</span><span class="sxs-lookup"><span data-stu-id="71fed-311">How to upgrade</span></span>
1. <span data-ttu-id="71fed-312">Postupujte podle kroků v [nasazení služby rozdělení sloučení](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span><span class="sxs-lookup"><span data-stu-id="71fed-312">Follow the steps in [Deploy a split-merge service](sql-database-elastic-scale-configure-deploy-split-and-merge.md).</span></span>
2. <span data-ttu-id="71fed-313">Změňte cloudu konfigurační soubor služby pro nasazení rozdělení sloučení tak, aby odrážely novou parametry konfigurace.</span><span class="sxs-lookup"><span data-stu-id="71fed-313">Change your cloud service configuration file for your split-merge deployment to reflect the new configuration parameters.</span></span> <span data-ttu-id="71fed-314">Nový požadovaný parametr je informace o certifikát použitý k šifrování.</span><span class="sxs-lookup"><span data-stu-id="71fed-314">A new required parameter is the information about the certificate used for encryption.</span></span> <span data-ttu-id="71fed-315">Snadný způsob, jak to udělat, je k porovnání nový soubor šablony konfigurace z stahování proti vaší stávající konfigurace.</span><span class="sxs-lookup"><span data-stu-id="71fed-315">An easy way to do this is to compare the new configuration template file from the download against your existing configuration.</span></span> <span data-ttu-id="71fed-316">Ujistěte se, že přidáte nastavení "DataEncryptionPrimaryCertificateThumbprint" a "DataEncryptionPrimary" pro webové a roli pracovního procesu.</span><span class="sxs-lookup"><span data-stu-id="71fed-316">Make sure you add the settings for “DataEncryptionPrimaryCertificateThumbprint” and “DataEncryptionPrimary” for both the web and the worker role.</span></span>
3. <span data-ttu-id="71fed-317">Před nasazením aktualizace do Azure, ověřte, že všechny operace právě probíhající rozdělení sloučení byl dokončen.</span><span class="sxs-lookup"><span data-stu-id="71fed-317">Before deploying the update to Azure, ensure that all currently running split-merge operations have finished.</span></span> <span data-ttu-id="71fed-318">Snadno to provedete pomocí dotazu na stav žádosti a PendingWorkflows tabulky v databázi metadat sloučení rozdělení pro probíhající požadavky.</span><span class="sxs-lookup"><span data-stu-id="71fed-318">You can easily do this by querying the RequestStatus and PendingWorkflows tables in the split-merge metadata database for ongoing requests.</span></span>
4. <span data-ttu-id="71fed-319">Aktualizujte stávající nasazení cloudové služby pro rozdělení sloučení ve vašem předplatném Azure nový balíček a konfiguračním souboru aktualizované služby.</span><span class="sxs-lookup"><span data-stu-id="71fed-319">Update your existing cloud service deployment for split-merge in your Azure subscription with the new package and your updated service configuration file.</span></span>

<span data-ttu-id="71fed-320">Není nutné zřídit novou databázi metadat pro rozdělení sloučení k upgradu.</span><span class="sxs-lookup"><span data-stu-id="71fed-320">You do not need to provision a new metadata database for split-merge to upgrade.</span></span> <span data-ttu-id="71fed-321">Nové verze automaticky upgraduje vaše stávající databáze metadat na novou verzi.</span><span class="sxs-lookup"><span data-stu-id="71fed-321">The new version will automatically upgrade your existing metadata database to the new version.</span></span> 

## <a name="best-practices--troubleshooting"></a><span data-ttu-id="71fed-322">Osvědčené postupy a řešení potíží</span><span class="sxs-lookup"><span data-stu-id="71fed-322">Best practices & troubleshooting</span></span>
* <span data-ttu-id="71fed-323">Definování testovacím klientem a vykonávat vaše nejdůležitější rozdělení nebo sloučení nebo přesunutí operace s testovacím klientem napříč několika horizontálních oddílů.</span><span class="sxs-lookup"><span data-stu-id="71fed-323">Define a test tenant and exercise your most important split/merge/move operations with the test tenant across several shards.</span></span> <span data-ttu-id="71fed-324">Zkontrolujte, že všechna metadata správně definován v mapě horizontálního oddílu a že operace není v rozporu omezení nebo cizí klíče.</span><span class="sxs-lookup"><span data-stu-id="71fed-324">Ensure that all metadata is defined correctly in your shard map and that the operations do not violate constraints or foreign keys.</span></span>
* <span data-ttu-id="71fed-325">Zachovat testovacím klientem velikost dat nad maximální velikost dat klienta služby největší zajistit nejsou zjištění velikost dat souvisejících s problémy.</span><span class="sxs-lookup"><span data-stu-id="71fed-325">Keep the test tenant data size above the maximum data size of your largest tenant to ensure you are not encountering data size related issues.</span></span> <span data-ttu-id="71fed-326">To vám usnadní vyhodnocení horní hranice v době potřebné k přesunutí jednoho klienta.</span><span class="sxs-lookup"><span data-stu-id="71fed-326">This helps you assess an upper bound on the time it takes to move a single tenant around.</span></span> 
* <span data-ttu-id="71fed-327">Ujistěte se, že schéma umožňuje odstranění.</span><span class="sxs-lookup"><span data-stu-id="71fed-327">Make sure that your schema allows deletions.</span></span> <span data-ttu-id="71fed-328">Rozdělení sloučení služba vyžaduje, aby možnost po dat byl úspěšně zkopírován do cílové odebrání dat ze zdroje horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="71fed-328">The split-merge service requires the ability to remove data from the source shard once the data has been successfully copied to the target.</span></span> <span data-ttu-id="71fed-329">Například **odstranit aktivační události** můžete zabránit odstranění dat na zdroji a může způsobit selhání operací.</span><span class="sxs-lookup"><span data-stu-id="71fed-329">For example, **delete triggers** can prevent the service from deleting the data on the source and may cause operations to fail.</span></span>
* <span data-ttu-id="71fed-330">Klíč horizontálního dělení by měl být počáteční sloupec ve vaší primární klíč nebo jedinečný index definice.</span><span class="sxs-lookup"><span data-stu-id="71fed-330">The sharding key should be the leading column in your primary key or unique index definition.</span></span> <span data-ttu-id="71fed-331">Který zajišťuje nejlepší výkon pro ověření dotazů rozdělení nebo sloučení a skutečná data přesouvání a odstranění operací, které pracují vždy se rozsahy klíčů horizontálního dělení.</span><span class="sxs-lookup"><span data-stu-id="71fed-331">That ensures the best performance for the split or merge validation queries, and for the actual data movement and deletion operations which always operate on sharding key ranges.</span></span>
* <span data-ttu-id="71fed-332">Společně umístit služby rozdělení sloučení v centru oblasti a data, kde jsou umístěny databáze.</span><span class="sxs-lookup"><span data-stu-id="71fed-332">Collocate your split-merge service in the region and data center where your databases reside.</span></span> 

[!INCLUDE [elastic-scale-include](../../includes/elastic-scale-include.md)]

<!--Anchors-->
<!--Image references-->
[1]:./media/sql-database-elastic-scale-overview-split-and-merge/split-merge-overview.png
[2]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics.png
[3]:./media/sql-database-elastic-scale-overview-split-and-merge/diagnostics-config.png


---
title: "Monitorování výkonu databáze ve službě Azure SQL Database | Dokumentace Microsoftu"
description: "Seznamte se s možnostmi monitorování vaší databáze pomocí nástrojů Azure a zobrazení dynamické správy."
keywords: "monitorování databáze, výkon cloudové databáze"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: e11ed3275413b428523eef78a5a89b537f6a4afc
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="061bf-104">Monitorování výkonu databáze ve službě Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="061bf-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="061bf-105">Monitorování výkonu databáze SQL v Azure začíná sledováním využití prostředků relativně ke zvolené úrovni výkonu databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-105">Monitoring the performance of a SQL database in Azure starts with monitoring the resource utilization relative to the level of database performance you choose.</span></span> <span data-ttu-id="061bf-106">Monitorování vám pomůže určit, zda má databáze nadbytečnou kapacitu nebo zda má naopak potíže s vyčerpáním prostředků, a podle toho se můžete rozhodnout, zda je třeba změnit úroveň výkonu nebo [úroveň služeb](sql-database-service-tiers.md) vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time to adjust the performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="061bf-107">Databázi můžete monitorovat pomocí grafických nástrojů na [portálu Azure](https://portal.azure.com) nebo pomocí [zobrazení dynamické správy SQL](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="061bf-107">You can monitor your database using graphical tools in the [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-the-azure-portal"></a><span data-ttu-id="061bf-108">Monitorování databází na portálu Azure</span><span class="sxs-lookup"><span data-stu-id="061bf-108">Monitor databases using the Azure portal</span></span>
<span data-ttu-id="061bf-109">Na [portálu Azure](https://portal.azure.com/) můžete monitorovat využití izolované databáze jednoduše tak, že vyberete databázi a kliknete na graf **Monitorování**.</span><span class="sxs-lookup"><span data-stu-id="061bf-109">In the [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking the **Monitoring** chart.</span></span> <span data-ttu-id="061bf-110">Zobrazí se okno **Metrika**, které můžete upravit kliknutím na **Upravit graf**.</span><span class="sxs-lookup"><span data-stu-id="061bf-110">This brings up a **Metric** window that you can change by clicking the **Edit chart** button.</span></span> <span data-ttu-id="061bf-111">Přidejte následující metriky:</span><span class="sxs-lookup"><span data-stu-id="061bf-111">Add the following metrics:</span></span>

* <span data-ttu-id="061bf-112">Procento CPU</span><span class="sxs-lookup"><span data-stu-id="061bf-112">CPU percentage</span></span>
* <span data-ttu-id="061bf-113">Procento DTU</span><span class="sxs-lookup"><span data-stu-id="061bf-113">DTU percentage</span></span>
* <span data-ttu-id="061bf-114">Procento datových V/V</span><span class="sxs-lookup"><span data-stu-id="061bf-114">Data IO percentage</span></span>
* <span data-ttu-id="061bf-115">Procento velikosti databáze</span><span class="sxs-lookup"><span data-stu-id="061bf-115">Database size percentage</span></span>

<span data-ttu-id="061bf-116">Jakmile přidáte tyto metriky, můžete pokračovat jejich zobrazením v grafu **Monitorování** s dalšími podrobnostmi v okně **Metrika**.</span><span class="sxs-lookup"><span data-stu-id="061bf-116">Once you’ve added these metrics, you can continue to view them in the **Monitoring** chart with more details on the **Metric** window.</span></span> <span data-ttu-id="061bf-117">Tyto čtyři metriky uvádějí průměrné využití v procentech vzhledem k hodnotě **DTU** vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-117">All four metrics show the average utilization percentage relative to the **DTU** of your database.</span></span> <span data-ttu-id="061bf-118">Podrobnosti o jednotkách DTU najdete v článku o [úrovních služeb](sql-database-service-tiers.md).</span><span class="sxs-lookup"><span data-stu-id="061bf-118">See the [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Monitorování výkonu databáze v rámci úrovně služeb](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="061bf-120">Můžete také nastavit upozornění na výkonové metriky.</span><span class="sxs-lookup"><span data-stu-id="061bf-120">You can also configure alerts on the performance metrics.</span></span> <span data-ttu-id="061bf-121">Klikněte na tlačítko **Přidat upozornění** v okně **Metrika**.</span><span class="sxs-lookup"><span data-stu-id="061bf-121">Click the **Add alert** button in the **Metric** window.</span></span> <span data-ttu-id="061bf-122">Nastavte upozornění podle pokynů průvodce.</span><span class="sxs-lookup"><span data-stu-id="061bf-122">Follow the wizard to configure your alert.</span></span> <span data-ttu-id="061bf-123">Můžete určit, zda chcete být upozorněni na překročení zadané prahové hodnoty, nebo naopak když metrika poklesne pod zadanou mez.</span><span class="sxs-lookup"><span data-stu-id="061bf-123">You have the option to alert if the metrics exceed a certain threshold or if the metric falls below a certain threshold.</span></span>

<span data-ttu-id="061bf-124">Například pokud očekáváte nárůst zatížení databáze, můžete nastavit e-mailové upozornění pro případ, že databáze překročí 80 % kterékoli výkonové metriky.</span><span class="sxs-lookup"><span data-stu-id="061bf-124">For example, if you expect the workload on your database to grow, you can choose to configure an email alert whenever your database reaches 80% on any of the performance metrics.</span></span> <span data-ttu-id="061bf-125">Máte tak možnost předběžného varování, aby byl čas rozhodnout, zda nenastal čas přechodu na vyšší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-125">You can use this as an early warning to figure out when you might have to switch to the next higher performance level.</span></span>

<span data-ttu-id="061bf-126">Metrika výkonu vám také pomůže zjistit, zda je možné úroveň výkonu snížit.</span><span class="sxs-lookup"><span data-stu-id="061bf-126">The performance metrics can also help you determine if you are able to downgrade to a lower performance level.</span></span> <span data-ttu-id="061bf-127">Předpokládejme, že používáte databáze S2 v úrovni Standard a všechny metriky ukazují, že databáze v průměru nevyužívá více než 10 % dostupného výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-127">Assume you are using a Standard S2 database and all performance metrics show that the database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="061bf-128">Je pravděpodobné, že databáze bude dobře fungovat i v úrovni Standard S1.</span><span class="sxs-lookup"><span data-stu-id="061bf-128">It is likely that the database will work well in Standard S1.</span></span> <span data-ttu-id="061bf-129">Než se však rozhodnete ke snížení úrovně výkonu, zvažte možnost výskytu špiček nebo náhlého kolísání zátěže.</span><span class="sxs-lookup"><span data-stu-id="061bf-129">However, be aware of workloads that spike or fluctuate before making the decision to move to a lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="061bf-130">Monitorování databází pomocí zobrazení dynamické správy</span><span class="sxs-lookup"><span data-stu-id="061bf-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="061bf-131">Stejné metriky, které jsou přístupné na portálu, můžete zobrazit také prostřednictvím systémových zobrazení: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) v logické **hlavní** databázi vašeho serveru a [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) v uživatelské databázi.</span><span class="sxs-lookup"><span data-stu-id="061bf-131">The same metrics that are exposed in the portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in the logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in the user database.</span></span> <span data-ttu-id="061bf-132">Pomocí zobrazení **sys.resource_stats** můžete sledovat hrubší data v delších časových obdobích.</span><span class="sxs-lookup"><span data-stu-id="061bf-132">Use **sys.resource_stats** if you need to monitor less granular data across a longer period of time.</span></span> <span data-ttu-id="061bf-133">Pomocí zobrazení **sys.dm_db_resource_stats** můžete sledovat data s větším rozlišením a v kratších úsecích.</span><span class="sxs-lookup"><span data-stu-id="061bf-133">Use **sys.dm_db_resource_stats** if you need to monitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="061bf-134">Další informace najdete v tématu [Azure SQL Database – průvodce výkonem](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="061bf-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="061bf-135">**Sys.dm_db_resource_stats** vrací prázdný výsledek při použití pro databáze s úrovněmi Web a Business, které jsou již ukončené.</span><span class="sxs-lookup"><span data-stu-id="061bf-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="061bf-136">Sledování využití prostředků</span><span class="sxs-lookup"><span data-stu-id="061bf-136">Monitor resource use</span></span>

<span data-ttu-id="061bf-137">Můžete monitorovat využití prostředků pomocí [SQL databáze Query Performance Insight](sql-database-query-performance.md) a [úložiště dotazů](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="061bf-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="061bf-138">Můžete také sledovat využití pomocí těchto dvou zobrazení:</span><span class="sxs-lookup"><span data-stu-id="061bf-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="061bf-139">Sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="061bf-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="061bf-140">Sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="061bf-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="061bf-141">Sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="061bf-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="061bf-142">Můžete použít [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) zobrazení v každé databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="061bf-142">You can use the [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="061bf-143">**Sys.dm_db_resource_stats** zobrazení ukazuje poslední data použití prostředků relativně k vrstvě služby.</span><span class="sxs-lookup"><span data-stu-id="061bf-143">The **sys.dm_db_resource_stats** view shows recent resource use data relative to the service tier.</span></span> <span data-ttu-id="061bf-144">Průměrnou procentuální hodnotu pro procesor, vstupů/výstupů dat, protokolu zápisy a paměti se zaznamenávají každých 15 sekund a jsou uchovávány 1 hodina.</span><span class="sxs-lookup"><span data-stu-id="061bf-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="061bf-145">Protože toto zobrazení nabízí podrobnější pohled na využití prostředků, použijte **sys.dm_db_resource_stats** první pro nějakou analýzu aktuální stav nebo řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="061bf-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="061bf-146">Například tento dotaz zobrazí průměrnou a maximální prostředky používané pro aktuální databázi přes poslední hodinu:</span><span class="sxs-lookup"><span data-stu-id="061bf-146">For example, this query shows the average and maximum resource use for the current database over the past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="061bf-147">Pro jiné dotazy, podívejte se na příklady v [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="061bf-147">For other queries, see the examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="061bf-148">Sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="061bf-148">sys.resource_stats</span></span>
<span data-ttu-id="061bf-149">[Sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) zobrazit v **hlavní** databáze obsahuje další informace, které můžete sledovat výkon vaší databázi SQL na úrovni konkrétní službu a výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-149">The [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in the **master** database has additional information that can help you monitor the performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="061bf-150">Data se shromažďují pro každých 5 minut a bude zachována pro účely přibližně 35 dnů.</span><span class="sxs-lookup"><span data-stu-id="061bf-150">The data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="061bf-151">Toto zobrazení je užitečné pro dlouhodobější analýzu historie používání prostředků vaší databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="061bf-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="061bf-152">Následující graf ukazuje procesoru využití prostředků pro databáze Premium P2 úrovní výkonu pro každou hodinu v týdnu.</span><span class="sxs-lookup"><span data-stu-id="061bf-152">The following graph shows the CPU resource use for a Premium database with the P2 performance level for each hour in a week.</span></span> <span data-ttu-id="061bf-153">Tento graf začíná v pondělí, zobrazuje 5 pracovních dní a poté zobrazí víkendu, když se stane mnohem méně na aplikaci.</span><span class="sxs-lookup"><span data-stu-id="061bf-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on the application.</span></span>

![Využití prostředků databáze SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="061bf-155">Z dat, má tato databáze aktuálně zatížení procesoru ve špičce právě víc než 50 % využití procesoru relativně k úroveň výkonu P2 (poledne úterý).</span><span class="sxs-lookup"><span data-stu-id="061bf-155">From the data, this database currently has a peak CPU load of just over 50 percent CPU use relative to the P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="061bf-156">Pokud procesor dominantní hrají roli v profilu aplikace prostředků, může rozhodnout, že P2 je na úroveň výkonu správné zaručit, že zatížení vždy vyhovuje.</span><span class="sxs-lookup"><span data-stu-id="061bf-156">If CPU is the dominant factor in the application’s resource profile, then you might decide that P2 is the right performance level to guarantee that the workload always fits.</span></span> <span data-ttu-id="061bf-157">Pokud očekáváte aplikace v čase, je vhodné mít vyrovnávací paměť navíc prostředků tak, aby aplikace nebude nikdy dosáhne omezení úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-157">If you expect an application to grow over time, it's a good idea to have an extra resource buffer so that the application doesn't ever reach the performance-level limit.</span></span> <span data-ttu-id="061bf-158">Pokud zvýšíte úroveň výkonu, můžete pomoct vyhnout zákazníka viditelné chybách, ke kterým může dojít, když databáze nemá dostatek power zpracovávat požadavky efektivně, zejména v prostředích citlivý na latenci.</span><span class="sxs-lookup"><span data-stu-id="061bf-158">If you increase the performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power to process requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="061bf-159">Příkladem je databáze, která podporuje aplikace, která vybarví webové stránky, na základě výsledků volání databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-159">An example is a database that supports an application that paints webpages based on the results of database calls.</span></span>

<span data-ttu-id="061bf-160">Jinými typy aplikací odlišně může přeložit do stejného grafu.</span><span class="sxs-lookup"><span data-stu-id="061bf-160">Other application types might interpret the same graph differently.</span></span> <span data-ttu-id="061bf-161">Například pokud aplikace pokusí zpracovat data mzdy každý den a má stejné grafu, tento druh modelu "dávkovou úlohu" může provádět bez problémů na úroveň výkonu P1.</span><span class="sxs-lookup"><span data-stu-id="061bf-161">For example, if an application tries to process payroll data each day and has the same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="061bf-162">Úroveň výkonu P1 má 100 Dtu ve srovnání s 200 Dtu na úrovni výkonu P2.</span><span class="sxs-lookup"><span data-stu-id="061bf-162">The P1 performance level has 100 DTUs compared to 200 DTUs at the P2 performance level.</span></span> <span data-ttu-id="061bf-163">Úroveň výkonu P1 poskytuje poloviční výkon P2 úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-163">The P1 performance level provides half the performance of the P2 performance level.</span></span> <span data-ttu-id="061bf-164">Ano 50 procent hodnoty využití procesoru v P2 rovná 100 procent využití procesoru v P1.</span><span class="sxs-lookup"><span data-stu-id="061bf-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="061bf-165">Pokud aplikace nemá vypršení časových limitů, nemusí je důležité, pokud úloha trvá 2 hodiny nebo 2,5 hodin, pokud získá dnes Hotovo.</span><span class="sxs-lookup"><span data-stu-id="061bf-165">If the application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours to finish, if it gets done today.</span></span> <span data-ttu-id="061bf-166">Aplikace v této kategorii pravděpodobně můžete použít úroveň výkonu P1.</span><span class="sxs-lookup"><span data-stu-id="061bf-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="061bf-167">Můžete využít výhod skutečnost, že jsou dobu během dne, kdy je využití prostředků nižší, tak, aby všechny "velký ve špičce" může distribuována do jedné žlaby později v den.</span><span class="sxs-lookup"><span data-stu-id="061bf-167">You can take advantage of the fact that there are periods of time during the day when resource use is lower, so that any "big peak" might spill over into one of the troughs later in the day.</span></span> <span data-ttu-id="061bf-168">Úroveň výkonu P1 může být vhodné pro tento typ aplikace (a uložte peníze), tak dlouho, dokud na čas každý den může dokončení úlohy.</span><span class="sxs-lookup"><span data-stu-id="061bf-168">The P1 performance level might be good for that kind of application (and save money), as long as the jobs can finish on time each day.</span></span>

<span data-ttu-id="061bf-169">Azure SQL Database zpřístupňuje využívat informace o prostředcích pro každou aktivní databáze v **sys.resource_stats** zobrazení **hlavní** databází v každém serveru.</span><span class="sxs-lookup"><span data-stu-id="061bf-169">Azure SQL Database exposes consumed resource information for each active database in the **sys.resource_stats** view of the **master** database in each server.</span></span> <span data-ttu-id="061bf-170">Data v tabulce se shromažďují pro 5 minutách.</span><span class="sxs-lookup"><span data-stu-id="061bf-170">The data in the table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="061bf-171">S úrovně služeb Basic, Standard a Premium dat může trvat déle než 5 minut, než se objeví v tabulce, tak, aby tato data užitečnější pro historické analýzy, nikoli analysis téměř v reálném čase.</span><span class="sxs-lookup"><span data-stu-id="061bf-171">With the Basic, Standard, and Premium service tiers, the data can take more than 5 minutes to appear in the table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="061bf-172">Dotaz **sys.resource_stats** zobrazení zobrazíte nejnovější historii databáze a k ověření, jestli rezervace zvolíte doručit výkonu, které chcete v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="061bf-172">Query the **sys.resource_stats** view to see the recent history of a database and to validate whether the reservation you chose delivered the performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="061bf-173">Musíte být připojeni k **hlavní** databáze logické databáze serveru SQL pro dotaz **sys.resource_stats** v následujících příkladech.</span><span class="sxs-lookup"><span data-stu-id="061bf-173">You must be connected to the **master** database of your logical SQL database server to query **sys.resource_stats** in the following examples.</span></span>
> 
> 

<span data-ttu-id="061bf-174">Tento příklad ukazuje, jak je vystaven data v tomto zobrazení:</span><span class="sxs-lookup"><span data-stu-id="061bf-174">This example shows you how the data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![Zobrazení katalogu sys.resource_stats](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="061bf-176">Další příklad ukazuje, různé způsoby, které můžete použít **sys.resource_stats** katalogu zobrazení a získat informace o používání prostředků vaší databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="061bf-176">The next example shows you different ways that you can use the **sys.resource_stats** catalog view to get information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="061bf-177">Podívat se na minulého týdne prostředků použít pro userdb1 databáze, můžete spustit tento dotaz:</span><span class="sxs-lookup"><span data-stu-id="061bf-177">To look at the past week’s resource use for the database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="061bf-178">Pokud chcete vyhodnotit, jak dobře vaše úlohy vyhovuje úroveň výkonu, je potřeba k podrobnostem každý aspekt metrika prostředků: procesoru, čtení, zápisu, počet pracovních procesů a počet relací.</span><span class="sxs-lookup"><span data-stu-id="061bf-178">To evaluate how well your workload fits the performance level, you need to drill down into each aspect of the resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="061bf-179">Tady je revidované dotazování pomocí **sys.resource_stats** nahlásit průměrný a maximální hodnoty metrik těchto prostředků:</span><span class="sxs-lookup"><span data-stu-id="061bf-179">Here's a revised query using **sys.resource_stats** to report the average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="061bf-180">Tyto informace o průměrnou a maximální hodnoty každého prostředku metriky a můžete vyhodnotit, jak dobře vaše úlohy zapadá do úroveň výkonu, které jste zvolili.</span><span class="sxs-lookup"><span data-stu-id="061bf-180">With this information about the average and maximum values of each resource metric, you can assess how well your workload fits into the performance level you chose.</span></span> <span data-ttu-id="061bf-181">Obvykle, průměrná hodnoty z **sys.resource_stats** poskytují dobrý směrného plánu používat pro cílovou velikost.</span><span class="sxs-lookup"><span data-stu-id="061bf-181">Usually, average values from **sys.resource_stats** give you a good baseline to use against the target size.</span></span> <span data-ttu-id="061bf-182">Mělo by být váš primární měření Flash disk.</span><span class="sxs-lookup"><span data-stu-id="061bf-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="061bf-183">Příklad by mohla využívat vrstvě služby na úrovni Standard S2 úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-183">For an example, you might be using the Standard service tier with S2 performance level.</span></span> <span data-ttu-id="061bf-184">Průměr pomocí procenta pro procesor a vstupně-výstupní operace čtení a zápisů jsou pod 40 procent, průměrný počet pracovních procesů je menší než 50 a průměrný počet relací, které je nižší než 200.</span><span class="sxs-lookup"><span data-stu-id="061bf-184">The average use percentages for CPU and I/O reads and writes are below 40 percent, the average number of workers is below 50, and the average number of sessions is below 200.</span></span> <span data-ttu-id="061bf-185">Vaše zatížení může začlenit do úrovní výkonu S1.</span><span class="sxs-lookup"><span data-stu-id="061bf-185">Your workload might fit into the S1 performance level.</span></span> <span data-ttu-id="061bf-186">Je snadno zjistit, jestli vaše databáze se vejde limity pracovního procesu a relace.</span><span class="sxs-lookup"><span data-stu-id="061bf-186">It's easy to see whether your database fits in the worker and session limits.</span></span> <span data-ttu-id="061bf-187">Pokud chcete zobrazit, zda databáze zapadá do nižší úroveň výkonu s ohledem na využití procesoru, čte a zápisu a dělit počet jednotek DTU na nižší úroveň výkonu podle počtu jednotek DTU vaše aktuální úroveň výkonu a výsledek vynásobit 100:</span><span class="sxs-lookup"><span data-stu-id="061bf-187">To see whether a database fits into a lower performance level with regards to CPU, reads, and writes, divide the DTU number of the lower performance level by the DTU number of your current performance level, and then multiply the result by 100:</span></span>
   
    <span data-ttu-id="061bf-188">**S1 DTU / S2 DTU * 100 = 20 NEBO 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="061bf-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="061bf-189">Výsledkem je relativní výkon rozdíl mezi úrovněmi dvě výkonu v procentech.</span><span class="sxs-lookup"><span data-stu-id="061bf-189">The result is the relative performance difference between the two performance levels in percentage.</span></span> <span data-ttu-id="061bf-190">Pokud vaše využití prostředků nepřekročí toto množství, může vaše úlohy začlenit do nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-190">If your resource use doesn't exceed this amount, your workload might fit into the lower performance level.</span></span> <span data-ttu-id="061bf-191">Však musíte vyhledat všechny rozsahy hodnot použití prostředků a zjistit, v procentech, jak často by se vešla vaše databáze úlohy s nižší úrovní výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-191">However, you need to look at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into the lower performance level.</span></span> <span data-ttu-id="061bf-192">Následující dotaz vypíše shody procento na dimenzi prostředků, podle prahové hodnoty 40 procent vypočtené v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="061bf-192">The following query outputs the fit percentage per resource dimension, based on the threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="061bf-193">Podle vaší databáze cíle na úrovni služby (SLO), můžete rozhodnout, zda vyhovuje vaše úlohy s nižší úrovní výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-193">Based on your database service level objective (SLO), you can decide whether your workload fits into the lower performance level.</span></span> <span data-ttu-id="061bf-194">Pokud vaše databáze úlohy SLO je 99,9 % a předchozí dotaz vrátí hodnoty vyšší než 99,9 % pro všechny tři prostředků dimenze, vaše úlohy pravděpodobně zapadá do nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-194">If your database workload SLO is 99.9 percent and the preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into the lower performance level.</span></span>
   
    <span data-ttu-id="061bf-195">Prohlížení shody procento také získáte přehled o tom, jestli měli byste přejít na další vyšší úroveň výkonu na splňují vaše SLO.</span><span class="sxs-lookup"><span data-stu-id="061bf-195">Looking at the fit percentage also gives you insight into whether you should move to the next higher performance level to meet your SLO.</span></span> <span data-ttu-id="061bf-196">Například userdb1 uvádí následující využití procesoru za uplynulý týden:</span><span class="sxs-lookup"><span data-stu-id="061bf-196">For example, userdb1 shows the following CPU use for the past week:</span></span>
   
   | <span data-ttu-id="061bf-197">Průměrné využití procesoru v procentech</span><span class="sxs-lookup"><span data-stu-id="061bf-197">Average CPU percent</span></span> | <span data-ttu-id="061bf-198">Maximální procento využití procesoru</span><span class="sxs-lookup"><span data-stu-id="061bf-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="061bf-199">24.5</span><span class="sxs-lookup"><span data-stu-id="061bf-199">24.5</span></span> |<span data-ttu-id="061bf-200">100.00</span><span class="sxs-lookup"><span data-stu-id="061bf-200">100.00</span></span> |
   
    <span data-ttu-id="061bf-201">Průměrné využití procesoru je o čtvrtletí omezení úrovně výkonu, které by se vešla do úroveň výkonu databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-201">The average CPU is about a quarter of the limit of the performance level, which would fit well into the performance level of the database.</span></span> <span data-ttu-id="061bf-202">Ale maximální hodnota ukazuje, že databáze dosáhne limitu úrovně výkonu.</span><span class="sxs-lookup"><span data-stu-id="061bf-202">But, the maximum value shows that the database reaches the limit of the performance level.</span></span> <span data-ttu-id="061bf-203">Je třeba přesunout do další vyšší úroveň výkonu?</span><span class="sxs-lookup"><span data-stu-id="061bf-203">Do you need to move to the next higher performance level?</span></span> <span data-ttu-id="061bf-204">Podívejte se na to, jak tolikrát, kolikrát vaše úlohy dosáhnou 100 procent a porovnejte je s vaše databáze úlohy SLO.</span><span class="sxs-lookup"><span data-stu-id="061bf-204">Look at how many times your workload reaches 100 percent, and then compare it to your database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="061bf-205">Pokud tento dotaz vrací hodnotu menší než 99,9 % pro některá z dimenzí tři prostředků, zvažte přechod na další vyšší úroveň výkonu nebo snížení zatížení databáze SQL pomocí techniky optimalizace pro aplikace.</span><span class="sxs-lookup"><span data-stu-id="061bf-205">If this query returns a value less than 99.9 percent for any of the three resource dimensions, consider either moving to the next higher performance level or use application-tuning techniques to reduce the load on the SQL database.</span></span>
4. <span data-ttu-id="061bf-206">Tento postup také zvažuje zvýšení vaší předpokládané úlohy v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="061bf-206">This exercise also considers your projected workload increase in the future.</span></span>

<span data-ttu-id="061bf-207">U elastických fondů můžete monitorovat jednotlivé databáze ve fondu pomocí technik popsaných v této části.</span><span class="sxs-lookup"><span data-stu-id="061bf-207">For elastic pools, you can monitor individual databases in the pool with the techniques described in this section.</span></span> <span data-ttu-id="061bf-208">Můžete ale také monitorovat fond jako celek.</span><span class="sxs-lookup"><span data-stu-id="061bf-208">But you can also monitor the pool as a whole.</span></span> <span data-ttu-id="061bf-209">Další informace najdete v tématu [Monitorování a správa elastického fondu](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="061bf-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="061bf-210">Maximální souběžných požadavků</span><span class="sxs-lookup"><span data-stu-id="061bf-210">Maximum concurrent requests</span></span>
<span data-ttu-id="061bf-211">Pokud chcete zjistit počet souběžných požadavků, spusťte tento dotaz jazyka Transact-SQL ve vaší databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="061bf-211">To see the number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="061bf-212">Chcete-li analyzovat zatížení místní databáze systému SQL Server, upravte tento dotaz pro filtrování v konkrétní databázi, že které chcete analyzovat.</span><span class="sxs-lookup"><span data-stu-id="061bf-212">To analyze the workload of an on-premises SQL Server database, modify this query to filter on the specific database you want to analyze.</span></span> <span data-ttu-id="061bf-213">Například pokud máte místní databázi s názvem databáze, tento dotaz jazyka Transact-SQL vrátí počet souběžných požadavků v databázi:</span><span class="sxs-lookup"><span data-stu-id="061bf-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns the count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="061bf-214">Toto je právě snímku na jednom místě v čase.</span><span class="sxs-lookup"><span data-stu-id="061bf-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="061bf-215">Chcete-li získat lepší pochopení zatížení a požadavky na počtu souběžných požadavků, budete muset shromažďovat mnoha ukázek v čase.</span><span class="sxs-lookup"><span data-stu-id="061bf-215">To get a better understanding of your workload and concurrent request requirements, you'll need to collect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="061bf-216">Maximální souběžných přihlášení</span><span class="sxs-lookup"><span data-stu-id="061bf-216">Maximum concurrent logins</span></span>
<span data-ttu-id="061bf-217">Můžete analyzovat vašim vzorům uživatelů a aplikací, kde získáte představu četnost přihlášení.</span><span class="sxs-lookup"><span data-stu-id="061bf-217">You can analyze your user and application patterns to get an idea of the frequency of logins.</span></span> <span data-ttu-id="061bf-218">Skutečné zatížení taky můžete spustit v testovacím prostředí, abyste měli jistotu, že nejsou stiskne to nebo další omezení, které v tomto článku probereme.</span><span class="sxs-lookup"><span data-stu-id="061bf-218">You also can run real-world loads in a test environment to make sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="061bf-219">Není k dispozici jeden dotaz nebo zobrazení dynamické správy (DMV), která umožňuje zobrazit souběžných, že počty přihlášení nebo historie.</span><span class="sxs-lookup"><span data-stu-id="061bf-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="061bf-220">V případě, že více klientů používat stejný připojovací řetězec, ověří služba každé přihlášení.</span><span class="sxs-lookup"><span data-stu-id="061bf-220">If multiple clients use the same connection string, the service authenticates each login.</span></span> <span data-ttu-id="061bf-221">Pokud 10 uživatelů najednou připojit k databázi pomocí stejné uživatelské jméno a heslo, by 10 souběžných přihlášení.</span><span class="sxs-lookup"><span data-stu-id="061bf-221">If 10 users simultaneously connect to a database by using the same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="061bf-222">Toto omezení se vztahuje pouze na dobu trvání přihlášení a ověřování.</span><span class="sxs-lookup"><span data-stu-id="061bf-222">This limit applies only to the duration of the login and authentication.</span></span> <span data-ttu-id="061bf-223">Pokud stejný 10 uživatelé připojit k databázi postupně, počet souběžných přihlášení by být nikdy větší než 1.</span><span class="sxs-lookup"><span data-stu-id="061bf-223">If the same 10 users connect to the database sequentially, the number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="061bf-224">V současné době toto omezení se nevztahuje k databázím v elastické fondy.</span><span class="sxs-lookup"><span data-stu-id="061bf-224">Currently, this limit does not apply to databases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="061bf-225">Maximální počet relací</span><span class="sxs-lookup"><span data-stu-id="061bf-225">Maximum sessions</span></span>
<span data-ttu-id="061bf-226">Pokud chcete zjistit počet aktuální aktivních relací, spusťte tento dotaz jazyka Transact-SQL ve vaší databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="061bf-226">To see the number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="061bf-227">Pokud při analýze pracovního vytížení místní systém SQL Server, změňte dotaz a zaměřit se na konkrétní databáze.</span><span class="sxs-lookup"><span data-stu-id="061bf-227">If you're analyzing an on-premises SQL Server workload, modify the query to focus on a specific database.</span></span> <span data-ttu-id="061bf-228">Tento dotaz vám pomůže určit, je možné relace pro databázi Pokud uvažujete o ani ji přesunout do Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="061bf-228">This query helps you determine possible session needs for the database if you are considering moving it to Azure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="061bf-229">Tyto dotazy znovu, vrátí počet bodu v čase.</span><span class="sxs-lookup"><span data-stu-id="061bf-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="061bf-230">Pokud shromažďujete více ukázky v čase, budete mít nejlepší Principy relace použít.</span><span class="sxs-lookup"><span data-stu-id="061bf-230">If you collect multiple samples over time, you’ll have the best understanding of your session use.</span></span>

<span data-ttu-id="061bf-231">Pro analýzu databáze SQL, můžete získat historická statistiky u relací pomocí dotazu [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) zobrazení a kontrola **active_session_count** sloupce.</span><span class="sxs-lookup"><span data-stu-id="061bf-231">For SQL Database analysis, you can get historical statistics on sessions by querying the [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing the **active_session_count** column.</span></span> 

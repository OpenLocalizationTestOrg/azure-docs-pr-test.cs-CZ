---
title: "výkon databáze aaaMonitoring ve službě Azure SQL Database | Microsoft Docs"
description: "Informace o možnostech hello monitorování vaší databáze pomocí nástrojů Azure a zobrazení dynamické správy."
keywords: "monitorování databáze, výkon cloudové databáze"
services: sql-database
documentationcenter: 
author: CarlRabeler
manager: jhubbard
editor: 
ms.assetid: a2e47475-c955-4a8d-a65c-cbef9a6d9b9f
ms.service: sql-database
ms.custom: monitor & tune
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-management
ms.date: 01/10/2017
ms.author: carlrab
ms.openlocfilehash: b13771183d4ccf37f58e2fc518b9b14de38212dc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="monitoring-database-performance-in-azure-sql-database"></a><span data-ttu-id="43bfd-104">Monitorování výkonu databáze ve službě Azure SQL Database</span><span class="sxs-lookup"><span data-stu-id="43bfd-104">Monitoring database performance in Azure SQL Database</span></span>
<span data-ttu-id="43bfd-105">Sledování výkonu hello databáze SQL v Azure začíná sledováním využití hello prostředků relativní toohello úroveň výkonu databáze, které zvolíte.</span><span class="sxs-lookup"><span data-stu-id="43bfd-105">Monitoring hello performance of a SQL database in Azure starts with monitoring hello resource utilization relative toohello level of database performance you choose.</span></span> <span data-ttu-id="43bfd-106">Monitorování vám pomůže určit, zda vaše databáze má přebytečnou kapacitou, nebo má potíže s, protože prostředky jsou podle toho, se a pak rozhodnout, zda je úroveň výkonu hello tooadjust čas a [vrstvy služby](sql-database-service-tiers.md) vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-106">Monitoring helps you  determine whether your database has excess capacity or is having trouble because resources are maxed out, and then decide whether it's time tooadjust hello performance level and [service tier](sql-database-service-tiers.md) of your database.</span></span> <span data-ttu-id="43bfd-107">Můžete monitorovat pomocí grafických nástrojů v hello databáze [portál Azure](https://portal.azure.com) nebo pomocí nástroje SQL [zobrazení dynamické správy](https://msdn.microsoft.com/library/ms188754.aspx).</span><span class="sxs-lookup"><span data-stu-id="43bfd-107">You can monitor your database using graphical tools in hello [Azure portal](https://portal.azure.com) or using SQL [dynamic management views](https://msdn.microsoft.com/library/ms188754.aspx).</span></span>

## <a name="monitor-databases-using-hello-azure-portal"></a><span data-ttu-id="43bfd-108">Monitorování databází pomocí hello portálu Azure</span><span class="sxs-lookup"><span data-stu-id="43bfd-108">Monitor databases using hello Azure portal</span></span>
<span data-ttu-id="43bfd-109">V hello [portál Azure](https://portal.azure.com/), můžete monitorovat využití izolované databáze vyberete databázi a kliknutím na hello **monitorování** grafu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-109">In hello [Azure portal](https://portal.azure.com/), you can monitor a single database’s utilization by selecting your database and clicking hello **Monitoring** chart.</span></span> <span data-ttu-id="43bfd-110">Po výběru této možnosti **metrika** okno, které můžete změnit kliknutím hello **upravit graf** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="43bfd-110">This brings up a **Metric** window that you can change by clicking hello **Edit chart** button.</span></span> <span data-ttu-id="43bfd-111">Přidejte následující metriky hello:</span><span class="sxs-lookup"><span data-stu-id="43bfd-111">Add hello following metrics:</span></span>

* <span data-ttu-id="43bfd-112">Procento CPU</span><span class="sxs-lookup"><span data-stu-id="43bfd-112">CPU percentage</span></span>
* <span data-ttu-id="43bfd-113">Procento DTU</span><span class="sxs-lookup"><span data-stu-id="43bfd-113">DTU percentage</span></span>
* <span data-ttu-id="43bfd-114">Procento datových V/V</span><span class="sxs-lookup"><span data-stu-id="43bfd-114">Data IO percentage</span></span>
* <span data-ttu-id="43bfd-115">Procento velikosti databáze</span><span class="sxs-lookup"><span data-stu-id="43bfd-115">Database size percentage</span></span>

<span data-ttu-id="43bfd-116">Jakmile přidáte tyto metriky, můžete pokračovat v tooview je v hello **monitorování** graf s další podrobnosti o hello **metrika** okno.</span><span class="sxs-lookup"><span data-stu-id="43bfd-116">Once you’ve added these metrics, you can continue tooview them in hello **Monitoring** chart with more details on hello **Metric** window.</span></span> <span data-ttu-id="43bfd-117">Všechny čtyři metriky uvádějí hello průměrné využití procento relativní toohello **DTU** vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-117">All four metrics show hello average utilization percentage relative toohello **DTU** of your database.</span></span> <span data-ttu-id="43bfd-118">V tématu hello [úrovních služeb](sql-database-service-tiers.md) podrobnosti o jednotkách Dtu najdete v článku.</span><span class="sxs-lookup"><span data-stu-id="43bfd-118">See hello [service tiers](sql-database-service-tiers.md) article for details about DTUs.</span></span>

![Monitorování výkonu databáze v rámci úrovně služeb](./media/sql-database-service-tiers/sqldb_service_tier_monitoring.png)

<span data-ttu-id="43bfd-120">Výstrahy můžete nakonfigurovat také na metriky výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-120">You can also configure alerts on hello performance metrics.</span></span> <span data-ttu-id="43bfd-121">Klikněte na tlačítko hello **přidat upozornění** tlačítka na hello **metrika** okno.</span><span class="sxs-lookup"><span data-stu-id="43bfd-121">Click hello **Add alert** button in hello **Metric** window.</span></span> <span data-ttu-id="43bfd-122">Postupujte podle průvodce tooconfigure hello upozornění.</span><span class="sxs-lookup"><span data-stu-id="43bfd-122">Follow hello wizard tooconfigure your alert.</span></span> <span data-ttu-id="43bfd-123">Máte možnost tooalert hello, pokud hello překročení zadané prahové hodnoty nebo pokud hello metrika poklesne pod určitou mez.</span><span class="sxs-lookup"><span data-stu-id="43bfd-123">You have hello option tooalert if hello metrics exceed a certain threshold or if hello metric falls below a certain threshold.</span></span>

<span data-ttu-id="43bfd-124">Například pokud očekáváte hello zatížení na toogrow vaší databáze, můžete tooconfigure e-mailové upozornění pokaždé, když vaše databáze překročí 80 % kterékoli hello metrik výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-124">For example, if you expect hello workload on your database toogrow, you can choose tooconfigure an email alert whenever your database reaches 80% on any of hello performance metrics.</span></span> <span data-ttu-id="43bfd-125">Můžete použít jako včasné upozornění toofigure se při může být tooswitch toohello vyšší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-125">You can use this as an early warning toofigure out when you might have tooswitch toohello next higher performance level.</span></span>

<span data-ttu-id="43bfd-126">metriky výkonu Hello také můžete zjistit, zda je možné toodowngrade tooa nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-126">hello performance metrics can also help you determine if you are able toodowngrade tooa lower performance level.</span></span> <span data-ttu-id="43bfd-127">Předpokládají se používá databáze Standard S2 a zobrazit všechny metriky výkonu, který hello databáze v průměru nevyužívá více než 10 % v daném okamžiku.</span><span class="sxs-lookup"><span data-stu-id="43bfd-127">Assume you are using a Standard S2 database and all performance metrics show that hello database on average does not use more than 10% at any given time.</span></span> <span data-ttu-id="43bfd-128">Je pravděpodobné, že hello databáze bude fungovat i v úrovni Standard S1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-128">It is likely that hello database will work well in Standard S1.</span></span> <span data-ttu-id="43bfd-129">Však být vědomi úlohy, které špiček nebo náhlého před provedením hello rozhodnutí toomove tooa nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-129">However, be aware of workloads that spike or fluctuate before making hello decision toomove tooa lower performance level.</span></span>

## <a name="monitor-databases-using-dmvs"></a><span data-ttu-id="43bfd-130">Monitorování databází pomocí zobrazení dynamické správy</span><span class="sxs-lookup"><span data-stu-id="43bfd-130">Monitor databases using DMVs</span></span>
<span data-ttu-id="43bfd-131">Hello stejné metriky, které jsou zveřejněné hello portálu jsou taky dostupné prostřednictvím systémových zobrazení: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) v hello logické **hlavní** databázi vašeho serveru a [sys.dm_db_ resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) v hello uživatelské databáze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-131">hello same metrics that are exposed in hello portal are also available through system views: [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) in hello logical **master** database of your server, and [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) in hello user database.</span></span> <span data-ttu-id="43bfd-132">Použití **sys.resource_stats** Pokud potřebujete toomonitor méně granulární dat napříč delší časové období.</span><span class="sxs-lookup"><span data-stu-id="43bfd-132">Use **sys.resource_stats** if you need toomonitor less granular data across a longer period of time.</span></span> <span data-ttu-id="43bfd-133">Použití **sys.dm_db_resource_stats** Pokud potřebujete toomonitor podrobnější data v kratších úsecích.</span><span class="sxs-lookup"><span data-stu-id="43bfd-133">Use **sys.dm_db_resource_stats** if you need toomonitor more granular data within a smaller time frame.</span></span> <span data-ttu-id="43bfd-134">Další informace najdete v tématu [Azure SQL Database – průvodce výkonem](sql-database-single-database-monitor.md#monitor-resource-use).</span><span class="sxs-lookup"><span data-stu-id="43bfd-134">For more information, see [Azure SQL Database Performance Guidance](sql-database-single-database-monitor.md#monitor-resource-use).</span></span>

> [!NOTE]
> <span data-ttu-id="43bfd-135">**Sys.dm_db_resource_stats** vrací prázdný výsledek při použití pro databáze s úrovněmi Web a Business, které jsou již ukončené.</span><span class="sxs-lookup"><span data-stu-id="43bfd-135">**sys.dm_db_resource_stats** returns an empty result set when used in Web and Business edition databases, which are retired.</span></span>
>
>

### <a name="monitor-resource-use"></a><span data-ttu-id="43bfd-136">Sledování využití prostředků</span><span class="sxs-lookup"><span data-stu-id="43bfd-136">Monitor resource use</span></span>

<span data-ttu-id="43bfd-137">Můžete monitorovat využití prostředků pomocí [SQL databáze Query Performance Insight](sql-database-query-performance.md) a [úložiště dotazů](https://msdn.microsoft.com/library/dn817826.aspx).</span><span class="sxs-lookup"><span data-stu-id="43bfd-137">You can monitor resource usage using [SQL Database Query Performance Insight](sql-database-query-performance.md) and [Query Store](https://msdn.microsoft.com/library/dn817826.aspx).</span></span>

<span data-ttu-id="43bfd-138">Můžete také sledovat využití pomocí těchto dvou zobrazení:</span><span class="sxs-lookup"><span data-stu-id="43bfd-138">You can also monitor usage using these two views:</span></span>

* [<span data-ttu-id="43bfd-139">Sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="43bfd-139">sys.dm_db_resource_stats</span></span>](https://msdn.microsoft.com/library/dn800981.aspx)
* [<span data-ttu-id="43bfd-140">Sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="43bfd-140">sys.resource_stats</span></span>](https://msdn.microsoft.com/library/dn269979.aspx)

#### <a name="sysdmdbresourcestats"></a><span data-ttu-id="43bfd-141">Sys.dm_db_resource_stats</span><span class="sxs-lookup"><span data-stu-id="43bfd-141">sys.dm_db_resource_stats</span></span>
<span data-ttu-id="43bfd-142">Můžete použít hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) zobrazení v každé databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="43bfd-142">You can use hello [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx) view in every SQL database.</span></span> <span data-ttu-id="43bfd-143">Hello **sys.dm_db_resource_stats** zobrazení ukazuje poslední prostředků pomocí datové relativní toohello služby vrstvě.</span><span class="sxs-lookup"><span data-stu-id="43bfd-143">hello **sys.dm_db_resource_stats** view shows recent resource use data relative toohello service tier.</span></span> <span data-ttu-id="43bfd-144">Průměrnou procentuální hodnotu pro procesor, vstupů/výstupů dat, protokolu zápisy a paměti se zaznamenávají každých 15 sekund a jsou uchovávány 1 hodina.</span><span class="sxs-lookup"><span data-stu-id="43bfd-144">Average percentages for CPU, data I/O, log writes, and memory are recorded every 15 seconds and are maintained for 1 hour.</span></span>

<span data-ttu-id="43bfd-145">Protože toto zobrazení nabízí podrobnější pohled na využití prostředků, použijte **sys.dm_db_resource_stats** první pro nějakou analýzu aktuální stav nebo řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="43bfd-145">Because this view provides a more granular look at resource use, use **sys.dm_db_resource_stats** first for any current-state analysis or troubleshooting.</span></span> <span data-ttu-id="43bfd-146">Tento dotaz zobrazí například, že hello průměrný a maximální prostředků používat pro aktuální databázi hello prostřednictvím hello poslední hodiny:</span><span class="sxs-lookup"><span data-stu-id="43bfd-146">For example, this query shows hello average and maximum resource use for hello current database over hello past hour:</span></span>

    SELECT  
        AVG(avg_cpu_percent) AS 'Average CPU use in percent',
        MAX(avg_cpu_percent) AS 'Maximum CPU use in percent',
        AVG(avg_data_io_percent) AS 'Average data I/O in percent',
        MAX(avg_data_io_percent) AS 'Maximum data I/O in percent',
        AVG(avg_log_write_percent) AS 'Average log write use in percent',
        MAX(avg_log_write_percent) AS 'Maximum log write use in percent',
        AVG(avg_memory_usage_percent) AS 'Average memory use in percent',
        MAX(avg_memory_usage_percent) AS 'Maximum memory use in percent'
    FROM sys.dm_db_resource_stats;  

<span data-ttu-id="43bfd-147">Pro jiné dotazy hello příklady naleznete v [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span><span class="sxs-lookup"><span data-stu-id="43bfd-147">For other queries, see hello examples in [sys.dm_db_resource_stats](https://msdn.microsoft.com/library/dn800981.aspx).</span></span>

#### <a name="sysresourcestats"></a><span data-ttu-id="43bfd-148">Sys.resource_stats</span><span class="sxs-lookup"><span data-stu-id="43bfd-148">sys.resource_stats</span></span>
<span data-ttu-id="43bfd-149">Hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) zobrazení v hello **hlavní** databáze obsahuje další informace, které můžete sledovat výkon hello vaší databáze SQL na úrovni konkrétní službu a výkonu .</span><span class="sxs-lookup"><span data-stu-id="43bfd-149">hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view in hello **master** database has additional information that can help you monitor hello performance of your SQL database at its specific service tier and performance level.</span></span> <span data-ttu-id="43bfd-150">Hello data se shromažďují pro každých 5 minut a bude zachována pro účely přibližně 35 dnů.</span><span class="sxs-lookup"><span data-stu-id="43bfd-150">hello data is collected every 5 minutes and is maintained for approximately 35 days.</span></span> <span data-ttu-id="43bfd-151">Toto zobrazení je užitečné pro dlouhodobější analýzu historie používání prostředků vaší databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="43bfd-151">This view is useful for a longer-term historical analysis of how your SQL database uses resources.</span></span>

<span data-ttu-id="43bfd-152">Hello následující graf ukazuje hello využití procesoru prostředků u databáze Premium P2 úroveň výkonu hello pro každou hodinu v týdnu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-152">hello following graph shows hello CPU resource use for a Premium database with hello P2 performance level for each hour in a week.</span></span> <span data-ttu-id="43bfd-153">Tento graf začíná v pondělí, zobrazuje 5 pracovních dní a poté zobrazí víkendu, když se u aplikace hello stane mnohem méně.</span><span class="sxs-lookup"><span data-stu-id="43bfd-153">This graph starts on a Monday, shows 5 work days, and then shows a weekend, when much less happens on hello application.</span></span>

![Využití prostředků databáze SQL](./media/sql-database-performance-guidance/sql_db_resource_utilization.png)

<span data-ttu-id="43bfd-155">Z dat hello tuto databázi aktuálně má zatížení procesoru ve špičce právě více než 50 procent procesoru použít relativní toohello P2 úroveň výkonu (poledne úterý).</span><span class="sxs-lookup"><span data-stu-id="43bfd-155">From hello data, this database currently has a peak CPU load of just over 50 percent CPU use relative toohello P2 performance level (midday on Tuesday).</span></span> <span data-ttu-id="43bfd-156">Pokud procesor hello dominantní faktor v profilu aplikace hello prostředků, může rozhodnout, že P2 je, že vyhovuje tooguarantee úrovni výkonu, který hello zatížení vždy hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-156">If CPU is hello dominant factor in hello application’s resource profile, then you might decide that P2 is hello right performance level tooguarantee that hello workload always fits.</span></span> <span data-ttu-id="43bfd-157">Pokud očekáváte toogrow aplikaci v čase, je vhodné toohave vyrovnávací paměť navíc prostředků tak, aby aplikace hello není někdy dosáhla limitu úroveň výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-157">If you expect an application toogrow over time, it's a good idea toohave an extra resource buffer so that hello application doesn't ever reach hello performance-level limit.</span></span> <span data-ttu-id="43bfd-158">Pokud zvýšíte úroveň výkonu hello, můžete vyhnout zákazníka viditelné chybách, ke kterým může dojít, když databáze nemá dostatek požadavky tooprocess power efektivně, zejména v prostředích citlivý na latenci.</span><span class="sxs-lookup"><span data-stu-id="43bfd-158">If you increase hello performance level, you can help avoid customer-visible errors that might occur when a database doesn't have enough power tooprocess requests effectively, especially in latency-sensitive environments.</span></span> <span data-ttu-id="43bfd-159">Příkladem je databáze, která podporuje aplikace, která vybarví webové stránky, na základě výsledků hello volání databáze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-159">An example is a database that supports an application that paints webpages based on hello results of database calls.</span></span>

<span data-ttu-id="43bfd-160">Jinými typy aplikací může vyhodnotit hello stejné graf jinak.</span><span class="sxs-lookup"><span data-stu-id="43bfd-160">Other application types might interpret hello same graph differently.</span></span> <span data-ttu-id="43bfd-161">Například pokud aplikace pokusí data mzdy tooprocess každý den a má hello stejném grafu, tento druh modelu "dávkovou úlohu" může udělat bez problémů na úroveň výkonu P1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-161">For example, if an application tries tooprocess payroll data each day and has hello same chart, this kind of "batch job" model might do fine at a P1 performance level.</span></span> <span data-ttu-id="43bfd-162">Hello úroveň výkonu P1 má 100 Dtu too200 Dtu porovnání v hello P2 úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-162">hello P1 performance level has 100 DTUs compared too200 DTUs at hello P2 performance level.</span></span> <span data-ttu-id="43bfd-163">Hello úroveň výkonu P1 poskytuje poloviční hello výkon hello P2 úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-163">hello P1 performance level provides half hello performance of hello P2 performance level.</span></span> <span data-ttu-id="43bfd-164">Ano 50 procent hodnoty využití procesoru v P2 rovná 100 procent využití procesoru v P1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-164">So, 50 percent of CPU use in P2 equals 100 percent CPU use in P1.</span></span> <span data-ttu-id="43bfd-165">Pokud aplikace hello nemá vypršení časových limitů, je nemusí důležité, zda úloha trvá 2 hodiny nebo toofinish 2,5 hodiny, pokud získá dnes provést.</span><span class="sxs-lookup"><span data-stu-id="43bfd-165">If hello application does not have timeouts, it might not matter if a job takes 2 hours or 2.5 hours toofinish, if it gets done today.</span></span> <span data-ttu-id="43bfd-166">Aplikace v této kategorii pravděpodobně můžete použít úroveň výkonu P1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-166">An application in this category probably can use a P1 performance level.</span></span> <span data-ttu-id="43bfd-167">Můžete využít výhod hello fakt, že jsou dobu během dne hello, pokud je využití prostředků nižší, tak, aby všechny "velký ve špičce" může distribuována do jedné žlaby hello později v den hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-167">You can take advantage of hello fact that there are periods of time during hello day when resource use is lower, so that any "big peak" might spill over into one of hello troughs later in hello day.</span></span> <span data-ttu-id="43bfd-168">tak dlouho, dokud hello úloh můžete dokončit na čas každý den, může být vhodné pro tento typ aplikace (a uložte peníze) Hello úroveň výkonu P1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-168">hello P1 performance level might be good for that kind of application (and save money), as long as hello jobs can finish on time each day.</span></span>

<span data-ttu-id="43bfd-169">Azure SQL Database zpřístupňuje využívat informace o prostředcích pro každou aktivní databáze v hello **sys.resource_stats** zobrazení hello **hlavní** databází v každém serveru.</span><span class="sxs-lookup"><span data-stu-id="43bfd-169">Azure SQL Database exposes consumed resource information for each active database in hello **sys.resource_stats** view of hello **master** database in each server.</span></span> <span data-ttu-id="43bfd-170">Hello data v tabulce hello se shromažďují pro 5 minutách.</span><span class="sxs-lookup"><span data-stu-id="43bfd-170">hello data in hello table is aggregated for 5-minute intervals.</span></span> <span data-ttu-id="43bfd-171">S hello Basic, Standard a Premium úrovně služeb hello dat může trvat víc než 5 minut tooappear v tabulce hello tak, aby tato data užitečnější pro historické analýzy, nikoli analysis téměř v reálném čase.</span><span class="sxs-lookup"><span data-stu-id="43bfd-171">With hello Basic, Standard, and Premium service tiers, hello data can take more than 5 minutes tooappear in hello table, so this data is more useful for historical analysis rather than near-real-time analysis.</span></span> <span data-ttu-id="43bfd-172">Dotaz hello **sys.resource_stats** zobrazení toosee hello nedávné historii databáze a toovalidate, zda text hello rezervace zvolíte doručit hello výkonu, které chcete v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="43bfd-172">Query hello **sys.resource_stats** view toosee hello recent history of a database and toovalidate whether hello reservation you chose delivered hello performance you want when needed.</span></span>

> [!NOTE]
> <span data-ttu-id="43bfd-173">Musí být připojené toohello **hlavní** databáze vaše logické tooquery databáze serveru SQL **sys.resource_stats** v hello následující příklady.</span><span class="sxs-lookup"><span data-stu-id="43bfd-173">You must be connected toohello **master** database of your logical SQL database server tooquery **sys.resource_stats** in hello following examples.</span></span>
> 
> 

<span data-ttu-id="43bfd-174">Tento příklad ukazuje, jak je vystaven hello data v tomto zobrazení:</span><span class="sxs-lookup"><span data-stu-id="43bfd-174">This example shows you how hello data in this view is exposed:</span></span>

    SELECT TOP 10 *
    FROM sys.resource_stats
    WHERE database_name = 'resource1'
    ORDER BY start_time DESC

![zobrazení katalogu sys.resource_stats Hello](./media/sql-database-performance-guidance/sys_resource_stats.png)

<span data-ttu-id="43bfd-176">Hello další příklad ukazuje, různé způsoby, které můžete použít hello **sys.resource_stats** katalogu zobrazit tooget informace o používání prostředků vaší databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="43bfd-176">hello next example shows you different ways that you can use hello **sys.resource_stats** catalog view tooget information about how your SQL database uses resources:</span></span>

1. <span data-ttu-id="43bfd-177">toolook v hello za týden prostředků použít pro userdb1 hello databáze, můžete spustit tento dotaz:</span><span class="sxs-lookup"><span data-stu-id="43bfd-177">toolook at hello past week’s resource use for hello database userdb1, you can run this query:</span></span>
   
        SELECT *
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND
              start_time > DATEADD(day, -7, GETDATE())
        ORDER BY start_time DESC;
2. <span data-ttu-id="43bfd-178">tooevaluate jak dobře vaše úlohy odpovídá hello úroveň výkonu, je nutné toodrill dolů do každý aspekt metrika prostředků hello: procesoru, čtení, zápisu, počet pracovních procesů a počet relací.</span><span class="sxs-lookup"><span data-stu-id="43bfd-178">tooevaluate how well your workload fits hello performance level, you need toodrill down into each aspect of hello resource metrics: CPU, reads, writes, number of workers, and number of sessions.</span></span> <span data-ttu-id="43bfd-179">Tady je revidované dotazování pomocí **sys.resource_stats** tooreport hello průměrný a maximální hodnoty metrik těchto prostředků:</span><span class="sxs-lookup"><span data-stu-id="43bfd-179">Here's a revised query using **sys.resource_stats** tooreport hello average and maximum values of these resource metrics:</span></span>
   
        SELECT
            avg(avg_cpu_percent) AS 'Average CPU use in percent',
            max(avg_cpu_percent) AS 'Maximum CPU use in percent',
            avg(avg_data_io_percent) AS 'Average physical data I/O use in percent',
            max(avg_data_io_percent) AS 'Maximum physical data I/O use in percent',
            avg(avg_log_write_percent) AS 'Average log write use in percent',
            max(avg_log_write_percent) AS 'Maximum log write use in percent',
            avg(max_session_percent) AS 'Average % of sessions',
            max(max_session_percent) AS 'Maximum % of sessions',
            avg(max_worker_percent) AS 'Average % of workers',
            max(max_worker_percent) AS 'Maximum % of workers'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
3. <span data-ttu-id="43bfd-180">Tyto informace o hello průměrný a maximální hodnoty každého prostředku metriky a můžete vyhodnotit, jak dobře vaše úlohy zapadá do hello úroveň výkonu, které vyberete.</span><span class="sxs-lookup"><span data-stu-id="43bfd-180">With this information about hello average and maximum values of each resource metric, you can assess how well your workload fits into hello performance level you chose.</span></span> <span data-ttu-id="43bfd-181">Obvykle, průměrná hodnoty z **sys.resource_stats** poskytují základní funkční toouse proti hello cílovou velikost.</span><span class="sxs-lookup"><span data-stu-id="43bfd-181">Usually, average values from **sys.resource_stats** give you a good baseline toouse against hello target size.</span></span> <span data-ttu-id="43bfd-182">Mělo by být váš primární měření Flash disk.</span><span class="sxs-lookup"><span data-stu-id="43bfd-182">It should be your primary measurement stick.</span></span> <span data-ttu-id="43bfd-183">Příklad by mohla využívat hello vrstvy služby na úrovni Standard S2 úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-183">For an example, you might be using hello Standard service tier with S2 performance level.</span></span> <span data-ttu-id="43bfd-184">průměr Hello pomocí procenta pro procesor a vstupně-výstupní operace čtení a zápisů jsou pod 40 procent, hello průměrný počet pracovních procesů je menší než 50 a hello průměrný počet relací, které je nižší než 200.</span><span class="sxs-lookup"><span data-stu-id="43bfd-184">hello average use percentages for CPU and I/O reads and writes are below 40 percent, hello average number of workers is below 50, and hello average number of sessions is below 200.</span></span> <span data-ttu-id="43bfd-185">Vaše zatížení může začlenit do hello úrovní výkonu S1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-185">Your workload might fit into hello S1 performance level.</span></span> <span data-ttu-id="43bfd-186">Je snadno toosee zda databáze se vejde hello worker a omezení relací.</span><span class="sxs-lookup"><span data-stu-id="43bfd-186">It's easy toosee whether your database fits in hello worker and session limits.</span></span> <span data-ttu-id="43bfd-187">toosee, zda databáze zapadá do nižší úroveň výkonu s jde o tooCPU, čtení a zápisu, vydělte hello DTU počet nižší úroveň výkonu hello hello DTU počet vaše aktuální úroveň výkonu a výsledek hello vynásobit 100:</span><span class="sxs-lookup"><span data-stu-id="43bfd-187">toosee whether a database fits into a lower performance level with regards tooCPU, reads, and writes, divide hello DTU number of hello lower performance level by hello DTU number of your current performance level, and then multiply hello result by 100:</span></span>
   
    <span data-ttu-id="43bfd-188">**S1 DTU / S2 DTU * 100 = 20 NEBO 50 * 100 = 40**</span><span class="sxs-lookup"><span data-stu-id="43bfd-188">**S1 DTU / S2 DTU * 100 = 20 / 50 * 100 = 40**</span></span>
   
    <span data-ttu-id="43bfd-189">Výsledkem Hello je hello relativní výkon rozdíl mezi hello dvě úrovně výkonu v procentech.</span><span class="sxs-lookup"><span data-stu-id="43bfd-189">hello result is hello relative performance difference between hello two performance levels in percentage.</span></span> <span data-ttu-id="43bfd-190">Pokud vaše využití prostředků nepřekročí toto množství, může vaše úlohy začlenit do hello nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-190">If your resource use doesn't exceed this amount, your workload might fit into hello lower performance level.</span></span> <span data-ttu-id="43bfd-191">Ale potřebovat toolook na všechny rozsahy hodnot použití prostředků a zjistit, v procentech, jak často by vaše databáze úlohy se vešla do hello nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-191">However, you need toolook at all ranges of resource use values, and determine, by percentage, how often your database workload would fit into hello lower performance level.</span></span> <span data-ttu-id="43bfd-192">Hello následující dotaz vypíše, že hello přizpůsobit procento na dimenzi prostředků, podle hello prahovou hodnotu 40 procent vypočtené v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="43bfd-192">hello following query outputs hello fit percentage per resource dimension, based on hello threshold of 40 percent that we calculated in this example:</span></span>
   
        SELECT
            (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log Write Fit Percent'
            ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 40 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical Data IO Fit Percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="43bfd-193">Podle vaší databáze cíle na úrovni služby (SLO), můžete rozhodnout, jestli vaše úlohy zapadá do hello nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-193">Based on your database service level objective (SLO), you can decide whether your workload fits into hello lower performance level.</span></span> <span data-ttu-id="43bfd-194">Pokud vaše databáze úlohy SLO je 99,9 % a hello předchozí dotaz vrátí hodnoty vyšší než 99,9 % pro všechny tři prostředků dimenze, vaše úlohy pravděpodobně zapadá do hello nižší úroveň výkonu.</span><span class="sxs-lookup"><span data-stu-id="43bfd-194">If your database workload SLO is 99.9 percent and hello preceding query returns values greater than 99.9 percent for all three resource dimensions, your workload likely fits into hello lower performance level.</span></span>
   
    <span data-ttu-id="43bfd-195">Prohlížení hello přizpůsobit procento také získáte přehled o tom, jestli je možné přesunout toohello další vyšší výkon úrovně toomeet vaše SLO.</span><span class="sxs-lookup"><span data-stu-id="43bfd-195">Looking at hello fit percentage also gives you insight into whether you should move toohello next higher performance level toomeet your SLO.</span></span> <span data-ttu-id="43bfd-196">Například userdb1 zobrazuje hello následující využití procesoru pro hello uplynulý týden:</span><span class="sxs-lookup"><span data-stu-id="43bfd-196">For example, userdb1 shows hello following CPU use for hello past week:</span></span>
   
   | <span data-ttu-id="43bfd-197">Průměrné využití procesoru v procentech</span><span class="sxs-lookup"><span data-stu-id="43bfd-197">Average CPU percent</span></span> | <span data-ttu-id="43bfd-198">Maximální procento využití procesoru</span><span class="sxs-lookup"><span data-stu-id="43bfd-198">Maximum CPU percent</span></span> |
   | --- | --- |
   | <span data-ttu-id="43bfd-199">24.5</span><span class="sxs-lookup"><span data-stu-id="43bfd-199">24.5</span></span> |<span data-ttu-id="43bfd-200">100.00</span><span class="sxs-lookup"><span data-stu-id="43bfd-200">100.00</span></span> |
   
    <span data-ttu-id="43bfd-201">průměrné využití procesoru Hello je o čtvrtletí hello omezení hello úroveň výkonu, které by se vešla do úroveň výkonu hello hello databáze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-201">hello average CPU is about a quarter of hello limit of hello performance level, which would fit well into hello performance level of hello database.</span></span> <span data-ttu-id="43bfd-202">Ale maximální hodnota hello ukazuje, že hello databáze dosáhne hello limit úroveň výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-202">But, hello maximum value shows that hello database reaches hello limit of hello performance level.</span></span> <span data-ttu-id="43bfd-203">Potřebujete toomove toohello vyšší úroveň výkonu?</span><span class="sxs-lookup"><span data-stu-id="43bfd-203">Do you need toomove toohello next higher performance level?</span></span> <span data-ttu-id="43bfd-204">Podívejte se na to, jak tolikrát, kolikrát vaše úlohy dosáhnou 100 procent a porovnejte je zatížení databáze tooyour SLO.</span><span class="sxs-lookup"><span data-stu-id="43bfd-204">Look at how many times your workload reaches 100 percent, and then compare it tooyour database workload SLO.</span></span>
   
        SELECT
        (COUNT(database_name) - SUM(CASE WHEN avg_cpu_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'CPU fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_log_write_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Log write fit percent'
        ,(COUNT(database_name) - SUM(CASE WHEN avg_data_io_percent >= 100 THEN 1 ELSE 0 END) * 1.0) / COUNT(database_name) AS 'Physical data I/O fit percent'
        FROM sys.resource_stats
        WHERE database_name = 'userdb1' AND start_time > DATEADD(day, -7, GETDATE());
   
    <span data-ttu-id="43bfd-205">Pokud tento dotaz vrací hodnotu menší než 99,9 % pro některá z dimenzí hello tři prostředků, zvažte buď přesunutí toohello vyšší úroveň výkonu nebo použijte optimalizace pro aplikace techniky tooreduce hello zatížení v databázi SQL hello.</span><span class="sxs-lookup"><span data-stu-id="43bfd-205">If this query returns a value less than 99.9 percent for any of hello three resource dimensions, consider either moving toohello next higher performance level or use application-tuning techniques tooreduce hello load on hello SQL database.</span></span>
4. <span data-ttu-id="43bfd-206">Tento postup také zvažuje vaší předpokládané úlohy zvýšení hello budoucí.</span><span class="sxs-lookup"><span data-stu-id="43bfd-206">This exercise also considers your projected workload increase in hello future.</span></span>

<span data-ttu-id="43bfd-207">Pro elastické fondy můžete monitorovat jednotlivé databáze ve fondu hello s hello technik popsaných v této části.</span><span class="sxs-lookup"><span data-stu-id="43bfd-207">For elastic pools, you can monitor individual databases in hello pool with hello techniques described in this section.</span></span> <span data-ttu-id="43bfd-208">Ale můžete také sledovat hello fond jako celek.</span><span class="sxs-lookup"><span data-stu-id="43bfd-208">But you can also monitor hello pool as a whole.</span></span> <span data-ttu-id="43bfd-209">Další informace najdete v tématu [Monitorování a správa elastického fondu](sql-database-elastic-pool-manage-portal.md).</span><span class="sxs-lookup"><span data-stu-id="43bfd-209">For information, see [Monitor and manage an elastic pool](sql-database-elastic-pool-manage-portal.md).</span></span>


### <a name="maximum-concurrent-requests"></a><span data-ttu-id="43bfd-210">Maximální souběžných požadavků</span><span class="sxs-lookup"><span data-stu-id="43bfd-210">Maximum concurrent requests</span></span>
<span data-ttu-id="43bfd-211">toosee hello počet souběžných požadavků, spusťte tento dotaz jazyka Transact-SQL na databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="43bfd-211">toosee hello number of concurrent requests, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R

<span data-ttu-id="43bfd-212">Tento dotaz toofilter upravit zatížení hello tooanalyze místní databáze systému SQL Server, na konkrétní databázi hello chcete tooanalyze.</span><span class="sxs-lookup"><span data-stu-id="43bfd-212">tooanalyze hello workload of an on-premises SQL Server database, modify this query toofilter on hello specific database you want tooanalyze.</span></span> <span data-ttu-id="43bfd-213">Pokud máte místní databázi s názvem databáze, tento dotaz jazyka Transact-SQL vrátí hello počet souběžných požadavků v databázi:</span><span class="sxs-lookup"><span data-stu-id="43bfd-213">For example, if you have an on-premises database named MyDatabase, this Transact-SQL query returns hello count of concurrent requests in that database:</span></span>

    SELECT COUNT(*) AS [Concurrent_Requests]
    FROM sys.dm_exec_requests R
    INNER JOIN sys.databases D ON D.database_id = R.database_id
    AND D.name = 'MyDatabase'

<span data-ttu-id="43bfd-214">Toto je právě snímku na jednom místě v čase.</span><span class="sxs-lookup"><span data-stu-id="43bfd-214">This is just a snapshot at a single point in time.</span></span> <span data-ttu-id="43bfd-215">tooget lépe porozumět zatížení a požadavky na počtu souběžných požadavků, budete potřebovat toocollect mnoha ukázek v čase.</span><span class="sxs-lookup"><span data-stu-id="43bfd-215">tooget a better understanding of your workload and concurrent request requirements, you'll need toocollect many samples over time.</span></span>

### <a name="maximum-concurrent-logins"></a><span data-ttu-id="43bfd-216">Maximální souběžných přihlášení</span><span class="sxs-lookup"><span data-stu-id="43bfd-216">Maximum concurrent logins</span></span>
<span data-ttu-id="43bfd-217">Můžete analyzovat vaše uživatele a aplikace vzory tooget představu o hello frekvenci přihlášení.</span><span class="sxs-lookup"><span data-stu-id="43bfd-217">You can analyze your user and application patterns tooget an idea of hello frequency of logins.</span></span> <span data-ttu-id="43bfd-218">Skutečné zatížení taky můžete spustit v toomake testovací prostředí, zda nejsou stiskne to nebo další omezení, které v tomto článku probereme.</span><span class="sxs-lookup"><span data-stu-id="43bfd-218">You also can run real-world loads in a test environment toomake sure that you're not hitting this or other limits we discuss in this article.</span></span> <span data-ttu-id="43bfd-219">Není k dispozici jeden dotaz nebo zobrazení dynamické správy (DMV), která umožňuje zobrazit souběžných, že počty přihlášení nebo historie.</span><span class="sxs-lookup"><span data-stu-id="43bfd-219">There isn’t a single query or dynamic management view (DMV) that can show you concurrent login counts or history.</span></span>

<span data-ttu-id="43bfd-220">Pokud používat více klientů hello stejný připojovací řetězec, hello služby ověřuje každé přihlášení.</span><span class="sxs-lookup"><span data-stu-id="43bfd-220">If multiple clients use hello same connection string, hello service authenticates each login.</span></span> <span data-ttu-id="43bfd-221">Pokud 10 uživatelů najednou připojit tooa databáze pomocí hello stejné uživatelské jméno a heslo, bude 10 souběžných přihlášení.</span><span class="sxs-lookup"><span data-stu-id="43bfd-221">If 10 users simultaneously connect tooa database by using hello same username and password, there would be 10 concurrent logins.</span></span> <span data-ttu-id="43bfd-222">Toto omezení se vztahuje pouze toohello trvání hello přihlášení a ověřování.</span><span class="sxs-lookup"><span data-stu-id="43bfd-222">This limit applies only toohello duration of hello login and authentication.</span></span> <span data-ttu-id="43bfd-223">Pokud uživatelé hello stejné 10 připojit databázi toohello postupně, by nikdy hello počet souběžných přihlášení být větší než 1.</span><span class="sxs-lookup"><span data-stu-id="43bfd-223">If hello same 10 users connect toohello database sequentially, hello number of concurrent logins would never be greater than 1.</span></span>

> [!NOTE]
> <span data-ttu-id="43bfd-224">V současné době toto omezení neplatí toodatabases v elastické fondy.</span><span class="sxs-lookup"><span data-stu-id="43bfd-224">Currently, this limit does not apply toodatabases in elastic pools.</span></span>
> 
> 

### <a name="maximum-sessions"></a><span data-ttu-id="43bfd-225">Maximální počet relací</span><span class="sxs-lookup"><span data-stu-id="43bfd-225">Maximum sessions</span></span>
<span data-ttu-id="43bfd-226">toosee hello počet aktuální aktivních relací, spusťte tento dotaz jazyka Transact-SQL ve vaší databázi SQL:</span><span class="sxs-lookup"><span data-stu-id="43bfd-226">toosee hello number of current active sessions, run this Transact-SQL query on your SQL database:</span></span>

    SELECT COUNT(*) AS [Sessions]
    FROM sys.dm_exec_connections

<span data-ttu-id="43bfd-227">Pokud při analýze pracovního vytížení místní systém SQL Server, upravte dotaz toofocus hello určitou databázi.</span><span class="sxs-lookup"><span data-stu-id="43bfd-227">If you're analyzing an on-premises SQL Server workload, modify hello query toofocus on a specific database.</span></span> <span data-ttu-id="43bfd-228">Tento dotaz vám pomůže určit možné relace potřeby hello databáze Pokud uvažujete o přesunutím tooAzure databáze SQL.</span><span class="sxs-lookup"><span data-stu-id="43bfd-228">This query helps you determine possible session needs for hello database if you are considering moving it tooAzure SQL Database.</span></span>

    SELECT COUNT(*)  AS [Sessions]
    FROM sys.dm_exec_connections C
    INNER JOIN sys.dm_exec_sessions S ON (S.session_id = C.session_id)
    INNER JOIN sys.databases D ON (D.database_id = S.database_id)
    WHERE D.name = 'MyDatabase'

<span data-ttu-id="43bfd-229">Tyto dotazy znovu, vrátí počet bodu v čase.</span><span class="sxs-lookup"><span data-stu-id="43bfd-229">Again, these queries return a point-in-time count.</span></span> <span data-ttu-id="43bfd-230">Pokud shromažďujete více ukázky v čase, budete mít hello je nejlepší Principy relace použít.</span><span class="sxs-lookup"><span data-stu-id="43bfd-230">If you collect multiple samples over time, you’ll have hello best understanding of your session use.</span></span>

<span data-ttu-id="43bfd-231">Pro analýzu SQL Database, můžete získat historická statistiky u relací dotazováním hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) zobrazení a kontrola hello **active_session_count** sloupce.</span><span class="sxs-lookup"><span data-stu-id="43bfd-231">For SQL Database analysis, you can get historical statistics on sessions by querying hello [sys.resource_stats](https://msdn.microsoft.com/library/dn269979.aspx) view and reviewing hello **active_session_count** column.</span></span> 

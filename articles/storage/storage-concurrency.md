---
title: "Správa souběžnosti v Microsoft Azure Storage"
description: "Jak spravovat souběžnosti pro služby objektů Blob, fronty, tabulky a soubor"
services: storage
documentationcenter: 
author: jasontang501
manager: tadb
editor: tysonn
ms.assetid: cc6429c4-23ee-46e3-b22d-50dd68bd4680
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 05/11/2017
ms.author: jasontang501
ms.openlocfilehash: 8b894af2f15cd22f04701c545d8250e20b99a094
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="managing-concurrency-in-microsoft-azure-storage"></a><span data-ttu-id="7dae5-103">Správa souběžnosti v Microsoft Azure Storage</span><span class="sxs-lookup"><span data-stu-id="7dae5-103">Managing Concurrency in Microsoft Azure Storage</span></span>
## <a name="overview"></a><span data-ttu-id="7dae5-104">Přehled</span><span class="sxs-lookup"><span data-stu-id="7dae5-104">Overview</span></span>
<span data-ttu-id="7dae5-105">Moderní aplikace na základě Internetu obvykle mají více uživatelů, zobrazování a aktualizace dat současně.</span><span class="sxs-lookup"><span data-stu-id="7dae5-105">Modern Internet based applications usually have multiple users viewing and updating data simultaneously.</span></span> <span data-ttu-id="7dae5-106">To vyžaduje vývojáři aplikace k byste pečlivě zvážit, jak zajistit předvídatelný prostředí pro své koncové uživatele, zejména pro scénáře, kde více uživatelů můžete aktualizovat stejná data.</span><span class="sxs-lookup"><span data-stu-id="7dae5-106">This requires application developers to think carefully about how to provide a predictable experience to their end users, particularly for scenarios where multiple users can update the same data.</span></span> <span data-ttu-id="7dae5-107">Existují tři strategie souběžnosti hlavní data, které vývojáři obvykle zvažovat:</span><span class="sxs-lookup"><span data-stu-id="7dae5-107">There are three main data concurrency strategies developers will typically consider:</span></span>  

1. <span data-ttu-id="7dae5-108">Optimistickou metodu souběžného – provádění aplikace, aktualizace bude jako součást jeho aktualizace ověřte, jestli se od aplikace změnil data poslední přečíst data.</span><span class="sxs-lookup"><span data-stu-id="7dae5-108">Optimistic concurrency – An application performing an update will as part of its update verify if the data has changed since the application last read that data.</span></span> <span data-ttu-id="7dae5-109">Například pokud dva uživatelé zobrazení na stránce wikiwebu provádět aktualizace na stejné stránce pak platformou wiki musí zkontrolujte, že druhé aktualizace nepřepíší první aktualizace – a oba uživatele jasné, jestli jejich aktualizace proběhla úspěšně, či nikoli.</span><span class="sxs-lookup"><span data-stu-id="7dae5-109">For example, if two users viewing a wiki page make an update to the same page then the wiki platform must ensure that the second update does not overwrite the first update – and that both users understand whether their update was successful or not.</span></span> <span data-ttu-id="7dae5-110">Tato strategie se nejčastěji používá v webových aplikací.</span><span class="sxs-lookup"><span data-stu-id="7dae5-110">This strategy is most often used in web applications.</span></span>
2. <span data-ttu-id="7dae5-111">Pesimistické souběžnosti – aplikace vyhledávání se k provedení aktualizace bude trvat zámek objektu brání aktualizace dat, dokud se uvolní zámek jiných uživatelů.</span><span class="sxs-lookup"><span data-stu-id="7dae5-111">Pessimistic concurrency – An application looking to perform an update will take a lock on an object preventing other users from updating the data until the lock is released.</span></span> <span data-ttu-id="7dae5-112">Například v případě hlavní nebo podřízený data replikace kde pouze hlavní provede aktualizace je hlavní server bude obvykle obsahovat výhradní zámek po delší dobu času na data a ujistěte se, že nikdo jiný ji aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="7dae5-112">For example, in a master/slave data replication scenario where only the master will perform updates the master will typically hold an exclusive lock for an extended period of time on the data to ensure no one else can update it.</span></span>
3. <span data-ttu-id="7dae5-113">Poslední zapisovače služby wins – přístup, která umožňuje všechny operace aktualizace pokračovat bez ověření, pokud jiná aplikace má aktualizovat data od aplikace nejprve číst data.</span><span class="sxs-lookup"><span data-stu-id="7dae5-113">Last writer wins – An approach that allows any update operations to proceed without verifying if any other application has updated the data since the application first read the data.</span></span> <span data-ttu-id="7dae5-114">Tato strategie (nebo nedostatečná strategie formální) se obvykle používá kde dat rozdělena na oddíly tak, že neexistuje žádná pravděpodobnost, že více uživatelů se přístup ke stejným datům.</span><span class="sxs-lookup"><span data-stu-id="7dae5-114">This strategy (or lack of a formal strategy) is usually used where data is partitioned in such a way that there is no likelihood that multiple users will access the same data.</span></span> <span data-ttu-id="7dae5-115">Může také být užitečné, kde jsou zpracovávány krátkodobou datové proudy.</span><span class="sxs-lookup"><span data-stu-id="7dae5-115">It can also be useful where short-lived data streams are being processed.</span></span>  

<span data-ttu-id="7dae5-116">Tento článek obsahuje přehled jak platformou Azure Storage usnadňuje vývoj díky prvotřídní podporu pro všechny tři strategie tyto souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="7dae5-116">This article provides an overview of how the Azure Storage platform simplifies development by providing first class support for all three of these concurrency strategies.</span></span>  

## <a name="azure-storage--simplifies-cloud-development"></a><span data-ttu-id="7dae5-117">Úložiště Azure – usnadňuje vývoj cloudu</span><span class="sxs-lookup"><span data-stu-id="7dae5-117">Azure Storage – Simplifies Cloud Development</span></span>
<span data-ttu-id="7dae5-118">Služba úložiště Azure podporuje všechny tři strategie, i když je charakteristické v jeho schopnost poskytovat plnou podporu pro pesimistické a optimistickou metodu souběžného zpracování, protože byl navržen zapojení silnou konzistenci model, který zaručuje, že pokud Služba úložiště potvrdí vložení dat nebo operace aktualizace všechny další přistupuje na která data se zobrazí nejnovější aktualizace.</span><span class="sxs-lookup"><span data-stu-id="7dae5-118">The Azure storage service supports all three strategies, although it is distinctive in its ability to provide full support for optimistic and pessimistic concurrency because it was designed to embrace a strong consistency model which guarantees that when the Storage service commits a data insert or update operation all further accesses to that data will see the latest update.</span></span> <span data-ttu-id="7dae5-119">Úložiště platformy, které používají model konzistence typu případné mít prodleva mezi, pokud se provádí zápis, jeden uživatel a aktualizovaná data můžete si je prohlížet ostatní uživatelé proto komplikují vývoj klientských aplikací, aby se zabránilo nekonzistence z dopad na koncové uživatele.</span><span class="sxs-lookup"><span data-stu-id="7dae5-119">Storage platforms that use an eventual consistency model have a lag between when a write is performed by one user and when the updated data can be seen by other users thus complicating development of client applications in order to prevent inconsistencies from affecting end users.</span></span>  

<span data-ttu-id="7dae5-120">Kromě Výběr strategie odpovídající souběžnosti musí být vývojáři taky vědět, jak úložiště platformy izoluje změn – zvlášť změny do stejného objektu napříč transakce.</span><span class="sxs-lookup"><span data-stu-id="7dae5-120">In addition to selecting an appropriate concurrency strategy developers should also be aware of how a storage platform isolates changes – particularly changes to the same object across transactions.</span></span> <span data-ttu-id="7dae5-121">Služba úložiště Azure používá izolaci snímku umožňující operace čtení provést souběžně operace zápisu v rámci jednoho oddílu.</span><span class="sxs-lookup"><span data-stu-id="7dae5-121">The Azure storage service uses snapshot isolation to allow read operations to happen concurrently with write operations within a single partition.</span></span> <span data-ttu-id="7dae5-122">Na rozdíl od jiných úrovních izolace izolaci snímku zaručuje, že všechny operace čtení najdete v části konzistentního snímku dat i když se vyskytnou aktualizace – v podstatě vrácením poslední potvrzené hodnoty při aktualizaci zpracování transakce.</span><span class="sxs-lookup"><span data-stu-id="7dae5-122">Unlike other isolation levels, snapshot isolation guarantees that all reads see a consistent snapshot of the data even while updates are occurring – essentially by returning the last committed values while an update transaction is being processed.</span></span>  

## <a name="managing-concurrency-in-blob-storage"></a><span data-ttu-id="7dae5-123">Správa souběžnosti v úložišti objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-123">Managing Concurrency in Blob storage</span></span>
<span data-ttu-id="7dae5-124">Můžete se rozhodnout používat buď modely pesimistické nebo optimistickou metodu souběžného zpracování můžete spravovat přístup k objektům BLOB a kontejnerů ve službě blob.</span><span class="sxs-lookup"><span data-stu-id="7dae5-124">You can opt to use either optimistic or pessimistic concurrency models to manage access to blobs and containers in the blob service.</span></span> <span data-ttu-id="7dae5-125">Pokud nezadáte explicitně strategie poslední zápisy wins je výchozí.</span><span class="sxs-lookup"><span data-stu-id="7dae5-125">If you do not explicitly specify a strategy last writes wins is the default.</span></span>  

### <a name="optimistic-concurrency-for-blobs-and-containers"></a><span data-ttu-id="7dae5-126">Optimistickou metodu souběžného pro objekty BLOB a kontejnery</span><span class="sxs-lookup"><span data-stu-id="7dae5-126">Optimistic concurrency for blobs and containers</span></span>
<span data-ttu-id="7dae5-127">Služby úložiště přiřadí identifikátor každé objekt uložené.</span><span class="sxs-lookup"><span data-stu-id="7dae5-127">The Storage service assigns an identifier to every object stored.</span></span> <span data-ttu-id="7dae5-128">Tento identifikátor se aktualizuje pokaždé, když se operace aktualizace se provádí na objekt.</span><span class="sxs-lookup"><span data-stu-id="7dae5-128">This identifier is updated every time an update operation is performed on an object.</span></span> <span data-ttu-id="7dae5-129">Identifikátor je vrácen do klienta v rámci metody GET protokolu HTTP odpovědi HTTP pomocí hlavičku ETag (značky entity), který je definován v rámci protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="7dae5-129">The identifier is returned to the client as part of an HTTP GET response using the ETag (entity tag) header that is defined within the HTTP protocol.</span></span> <span data-ttu-id="7dae5-130">Uživatel provedení aktualizace na takový objekt může odesílat v původní značka ETag společně s podmíněným záhlaví zajistit, aby aktualizace dojde pouze pokud byla splněna určitá podmínka – v takovém případě je podmínka vyhodnocena jako hlavičku "If-Match", který vyžaduje, aby služba úložiště  Zkontrolujte, zda hodnota značka ETag zadaná v žádosti o aktualizaci je stejný jako uložené ve službě úložiště.</span><span class="sxs-lookup"><span data-stu-id="7dae5-130">A user performing an update on such an object can send in the original ETag along with a conditional header to ensure that an update will only occur if a certain condition has been met – in this case the condition is an "If-Match" header which requires the Storage Service to ensure the value of the ETag specified in the update request is the same as that stored in the Storage Service.</span></span>  

<span data-ttu-id="7dae5-131">Obrys tento proces je následující:</span><span class="sxs-lookup"><span data-stu-id="7dae5-131">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="7dae5-132">Načtení objektu blob ze služby storage, odpověď obsahuje hodnotu hlavičky protokolu HTTP ETag identifikující aktuální verze objektu ve službě úložiště.</span><span class="sxs-lookup"><span data-stu-id="7dae5-132">Retrieve a blob from the storage service, the response includes an HTTP ETag Header value that identifies the current version of the object in the storage service.</span></span>
2. <span data-ttu-id="7dae5-133">Při aktualizaci objektu blob obsahoval hodnotu značka ETag se vám zobrazila v kroku 1 **If-Match** podmíněného hlavičky požadavku odeslat do služby.</span><span class="sxs-lookup"><span data-stu-id="7dae5-133">When you update the blob, include the ETag value you received in step 1 in the **If-Match** conditional header of the request you send to the service.</span></span>
3. <span data-ttu-id="7dae5-134">Služba porovnává hodnotu ETag v žádosti se aktuální hodnota ETag objektu blob.</span><span class="sxs-lookup"><span data-stu-id="7dae5-134">The service compares the ETag value in the request with the current ETag value of the blob.</span></span>
4. <span data-ttu-id="7dae5-135">Pokud je aktuální hodnota ETag objektu blob jinou verzi než ETag v **If-Match** podmíněného záhlaví v žádosti o službu vrátí chybu 412 klientovi.</span><span class="sxs-lookup"><span data-stu-id="7dae5-135">If the current ETag value of the blob is a different version than the ETag in the **If-Match** conditional header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="7dae5-136">To znamená klientovi, že má jiným procesem od klienta jejím načtení aktualizace objektu blob.</span><span class="sxs-lookup"><span data-stu-id="7dae5-136">This indicates to the client that another process has updated the blob since the client retrieved it.</span></span>
5. <span data-ttu-id="7dae5-137">Pokud je aktuální hodnota ETag objektu blob stejnou verzi jako značka ETag v **If-Match** podmíněného záhlaví v žádosti o službu provede požadovanou operaci a aktualizuje aktuální hodnota ETag objektu blob ukazují, že bylo vytvořeno novou verzi.</span><span class="sxs-lookup"><span data-stu-id="7dae5-137">If the current ETag value of the blob is the same version as the ETag in the **If-Match** conditional header in the request, the service performs the requested operation and updates the current ETag value of the blob to show that it has created a new version.</span></span>  

<span data-ttu-id="7dae5-138">Následující (s použitím knihovny klienta úložiště 4.2.0) fragment kódu jazyka C# ukazuje jednoduchý příklad toho, jak vytvořit **AccessCondition If-Match** založená na hodnotě značka ETag, která je k němu přistupovat z vlastnosti objektu blob, která byla dříve buď Vložit ani načíst.</span><span class="sxs-lookup"><span data-stu-id="7dae5-138">The following C# snippet (using the Client Storage Library 4.2.0) shows a simple example of how to construct an **If-Match AccessCondition** based on the ETag value that is accessed from the properties of a blob that was previously either retrieved or inserted.</span></span> <span data-ttu-id="7dae5-139">Pak použije **AccessCondition** objektu při jeho aktualizaci objektu blob: **AccessCondition** přidá objekt **If-Match** hlavičky k žádosti.</span><span class="sxs-lookup"><span data-stu-id="7dae5-139">It then uses the **AccessCondition** object when it updating the blob: the **AccessCondition** object adds the **If-Match** header to the request.</span></span> <span data-ttu-id="7dae5-140">Pokud objekt blob byl aktualizován jiným procesem, vrátí se služby objektů blob zpráva stav HTTP 412 (nezdařil se předběžnou podmínku).</span><span class="sxs-lookup"><span data-stu-id="7dae5-140">If another process has updated the blob, the blob service returns an HTTP 412 (Precondition Failed) status message.</span></span> <span data-ttu-id="7dae5-141">Si můžete stáhnout úplnou ukázku: [Správa souběžnosti použití služby Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="7dae5-141">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>  

```csharp
// Retrieve the ETag from the newly created blob
// Etag is already populated as UploadText should cause a PUT Blob call
// to storage blob service which returns the etag in response.
string orignalETag = blockBlob.Properties.ETag;

// This code simulates an update by a third party.
string helloText = "Blob updated by a third party.";

// No etag, provided so orignal blob is overwritten (thus generating a new etag)
blockBlob.UploadText(helloText);
Console.WriteLine("Blob updated. Updated ETag = {0}",
blockBlob.Properties.ETag);

// Now try to update the blob using the orignal ETag provided when the blob was created
try
{
    Console.WriteLine("Trying to update blob using orignal etag to generate if-match access condition");
    blockBlob.UploadText(helloText,accessCondition:
    AccessCondition.GenerateIfMatchCondition(orignalETag));
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
    {
        Console.WriteLine("Precondition failure as expected. Blob's orignal etag no longer matches");
        // TODO: client can decide on how it wants to handle the 3rd party updated content.
    }
    else
        throw;
}  
```

<span data-ttu-id="7dae5-142">Služba úložiště, jako také zahrnuje podporu pro další podmíněného záhlaví **If-upravit-Since**, **If-Unmodified-Since** a **If-None-Match** a také jejich kombinace.</span><span class="sxs-lookup"><span data-stu-id="7dae5-142">The Storage Service also includes support for additional conditional headers such as **If-Modified-Since**, **If-Unmodified-Since** and **If-None-Match** as well as combinations thereof.</span></span> <span data-ttu-id="7dae5-143">Další informace najdete v části [zadání podmíněného hlavičky pro operace služby objektů Blob](http://msdn.microsoft.com/library/azure/dd179371.aspx) na webu MSDN.</span><span class="sxs-lookup"><span data-stu-id="7dae5-143">For more information see [Specifying Conditional Headers for Blob Service Operations](http://msdn.microsoft.com/library/azure/dd179371.aspx) on MSDN.</span></span>  

<span data-ttu-id="7dae5-144">Následující tabulka shrnuje kontejneru operace, které podmíněného hlavičky accept, jako **If-Match** v požadavku a že vrátit hodnotu ETag v odpovědi.</span><span class="sxs-lookup"><span data-stu-id="7dae5-144">The following table summarizes the container operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>  

| <span data-ttu-id="7dae5-145">Operace</span><span class="sxs-lookup"><span data-stu-id="7dae5-145">Operation</span></span> | <span data-ttu-id="7dae5-146">Vrátí hodnotu ETag kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-146">Returns Container ETag value</span></span> | <span data-ttu-id="7dae5-147">Přijímá podmíněného hlavičky</span><span class="sxs-lookup"><span data-stu-id="7dae5-147">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="7dae5-148">Vytvoření kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-148">Create Container</span></span> |<span data-ttu-id="7dae5-149">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-149">Yes</span></span> |<span data-ttu-id="7dae5-150">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-150">No</span></span> |
| <span data-ttu-id="7dae5-151">Získat vlastnosti kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-151">Get Container Properties</span></span> |<span data-ttu-id="7dae5-152">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-152">Yes</span></span> |<span data-ttu-id="7dae5-153">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-153">No</span></span> |
| <span data-ttu-id="7dae5-154">Získat Metadata kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-154">Get Container Metadata</span></span> |<span data-ttu-id="7dae5-155">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-155">Yes</span></span> |<span data-ttu-id="7dae5-156">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-156">No</span></span> |
| <span data-ttu-id="7dae5-157">Nastavit Metadata kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-157">Set Container Metadata</span></span> |<span data-ttu-id="7dae5-158">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-158">Yes</span></span> |<span data-ttu-id="7dae5-159">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-159">Yes</span></span> |
| <span data-ttu-id="7dae5-160">Získání kontejneru seznamu ACL</span><span class="sxs-lookup"><span data-stu-id="7dae5-160">Get Container ACL</span></span> |<span data-ttu-id="7dae5-161">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-161">Yes</span></span> |<span data-ttu-id="7dae5-162">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-162">No</span></span> |
| <span data-ttu-id="7dae5-163">Nastavit kontejneru seznamu ACL</span><span class="sxs-lookup"><span data-stu-id="7dae5-163">Set Container ACL</span></span> |<span data-ttu-id="7dae5-164">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-164">Yes</span></span> |<span data-ttu-id="7dae5-165">Ano (*)</span><span class="sxs-lookup"><span data-stu-id="7dae5-165">Yes (*)</span></span> |
| <span data-ttu-id="7dae5-166">Odstranit kontejner</span><span class="sxs-lookup"><span data-stu-id="7dae5-166">Delete Container</span></span> |<span data-ttu-id="7dae5-167">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-167">No</span></span> |<span data-ttu-id="7dae5-168">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-168">Yes</span></span> |
| <span data-ttu-id="7dae5-169">Zapůjčení kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-169">Lease Container</span></span> |<span data-ttu-id="7dae5-170">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-170">Yes</span></span> |<span data-ttu-id="7dae5-171">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-171">Yes</span></span> |
| <span data-ttu-id="7dae5-172">Seznam objektů BLOB</span><span class="sxs-lookup"><span data-stu-id="7dae5-172">List Blobs</span></span> |<span data-ttu-id="7dae5-173">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-173">No</span></span> |<span data-ttu-id="7dae5-174">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-174">No</span></span> |

<span data-ttu-id="7dae5-175">(*) Oprávnění definované SetContainerACL jsou uložené v mezipaměti a aktualizace těchto oprávnění trvat 30 sekund potřebný k šíření během nichž aktualizace nemusí být konzistentní.</span><span class="sxs-lookup"><span data-stu-id="7dae5-175">(*) The permissions defined by SetContainerACL are cached and updates to these permissions take 30 seconds to propagate during which period updates are not guaranteed to be consistent.</span></span>  

<span data-ttu-id="7dae5-176">Následující tabulka shrnuje operace objektů blob, které podmíněného hlavičky accept, jako **If-Match** v požadavku a že vrátit hodnotu ETag v odpovědi.</span><span class="sxs-lookup"><span data-stu-id="7dae5-176">The following table summarizes the blob operations that accept conditional headers such as **If-Match** in the request and that return an ETag value in the response.</span></span>

| <span data-ttu-id="7dae5-177">Operace</span><span class="sxs-lookup"><span data-stu-id="7dae5-177">Operation</span></span> | <span data-ttu-id="7dae5-178">Vrátí hodnotu ETag</span><span class="sxs-lookup"><span data-stu-id="7dae5-178">Returns ETag value</span></span> | <span data-ttu-id="7dae5-179">Přijímá podmíněného hlavičky</span><span class="sxs-lookup"><span data-stu-id="7dae5-179">Accepts conditional headers</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="7dae5-180">Uveďte objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-180">Put Blob</span></span> |<span data-ttu-id="7dae5-181">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-181">Yes</span></span> |<span data-ttu-id="7dae5-182">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-182">Yes</span></span> |
| <span data-ttu-id="7dae5-183">Získání objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-183">Get Blob</span></span> |<span data-ttu-id="7dae5-184">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-184">Yes</span></span> |<span data-ttu-id="7dae5-185">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-185">Yes</span></span> |
| <span data-ttu-id="7dae5-186">Získat vlastnosti objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-186">Get Blob Properties</span></span> |<span data-ttu-id="7dae5-187">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-187">Yes</span></span> |<span data-ttu-id="7dae5-188">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-188">Yes</span></span> |
| <span data-ttu-id="7dae5-189">Nastavit vlastnosti objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-189">Set Blob Properties</span></span> |<span data-ttu-id="7dae5-190">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-190">Yes</span></span> |<span data-ttu-id="7dae5-191">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-191">Yes</span></span> |
| <span data-ttu-id="7dae5-192">Získat Metadata objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-192">Get Blob Metadata</span></span> |<span data-ttu-id="7dae5-193">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-193">Yes</span></span> |<span data-ttu-id="7dae5-194">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-194">Yes</span></span> |
| <span data-ttu-id="7dae5-195">Nastavit Metadata objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-195">Set Blob Metadata</span></span> |<span data-ttu-id="7dae5-196">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-196">Yes</span></span> |<span data-ttu-id="7dae5-197">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-197">Yes</span></span> |
| <span data-ttu-id="7dae5-198">Objekt Blob zapůjčení (*)</span><span class="sxs-lookup"><span data-stu-id="7dae5-198">Lease Blob (*)</span></span> |<span data-ttu-id="7dae5-199">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-199">Yes</span></span> |<span data-ttu-id="7dae5-200">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-200">Yes</span></span> |
| <span data-ttu-id="7dae5-201">Objekt Blob snímku</span><span class="sxs-lookup"><span data-stu-id="7dae5-201">Snapshot Blob</span></span> |<span data-ttu-id="7dae5-202">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-202">Yes</span></span> |<span data-ttu-id="7dae5-203">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-203">Yes</span></span> |
| <span data-ttu-id="7dae5-204">Zkopírování objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-204">Copy Blob</span></span> |<span data-ttu-id="7dae5-205">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-205">Yes</span></span> |<span data-ttu-id="7dae5-206">Ano (pro zdrojový a cílový objekt blob)</span><span class="sxs-lookup"><span data-stu-id="7dae5-206">Yes (for source and destination blob)</span></span> |
| <span data-ttu-id="7dae5-207">Abort – objekt Blob kopie</span><span class="sxs-lookup"><span data-stu-id="7dae5-207">Abort Copy Blob</span></span> |<span data-ttu-id="7dae5-208">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-208">No</span></span> |<span data-ttu-id="7dae5-209">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-209">No</span></span> |
| <span data-ttu-id="7dae5-210">Odstranit objekt Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-210">Delete Blob</span></span> |<span data-ttu-id="7dae5-211">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-211">No</span></span> |<span data-ttu-id="7dae5-212">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-212">Yes</span></span> |
| <span data-ttu-id="7dae5-213">Uveďte bloku</span><span class="sxs-lookup"><span data-stu-id="7dae5-213">Put Block</span></span> |<span data-ttu-id="7dae5-214">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-214">No</span></span> |<span data-ttu-id="7dae5-215">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-215">No</span></span> |
| <span data-ttu-id="7dae5-216">Uveďte seznam blokovaných položek</span><span class="sxs-lookup"><span data-stu-id="7dae5-216">Put Block List</span></span> |<span data-ttu-id="7dae5-217">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-217">Yes</span></span> |<span data-ttu-id="7dae5-218">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-218">Yes</span></span> |
| <span data-ttu-id="7dae5-219">Získat seznam blokovaných položek</span><span class="sxs-lookup"><span data-stu-id="7dae5-219">Get Block List</span></span> |<span data-ttu-id="7dae5-220">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-220">Yes</span></span> |<span data-ttu-id="7dae5-221">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-221">No</span></span> |
| <span data-ttu-id="7dae5-222">Uveďte stránky</span><span class="sxs-lookup"><span data-stu-id="7dae5-222">Put Page</span></span> |<span data-ttu-id="7dae5-223">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-223">Yes</span></span> |<span data-ttu-id="7dae5-224">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-224">Yes</span></span> |
| <span data-ttu-id="7dae5-225">Get rozsahů stránek</span><span class="sxs-lookup"><span data-stu-id="7dae5-225">Get Page Ranges</span></span> |<span data-ttu-id="7dae5-226">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-226">Yes</span></span> |<span data-ttu-id="7dae5-227">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-227">Yes</span></span> |

<span data-ttu-id="7dae5-228">(*) Objekt Blob zapůjčení nezmění značku ETag na objekt blob.</span><span class="sxs-lookup"><span data-stu-id="7dae5-228">(*) Lease Blob does not change the ETag on a blob.</span></span>  

### <a name="pessimistic-concurrency-for-blobs"></a><span data-ttu-id="7dae5-229">Pesimistické souběžnosti pro objekty BLOB</span><span class="sxs-lookup"><span data-stu-id="7dae5-229">Pessimistic concurrency for blobs</span></span>
<span data-ttu-id="7dae5-230">Zamknout objekt blob pro výhradní použití, můžete získat [zapůjčení](http://msdn.microsoft.com/library/azure/ee691972.aspx) na něm.</span><span class="sxs-lookup"><span data-stu-id="7dae5-230">To lock a blob for exclusive use, you can acquire a [lease](http://msdn.microsoft.com/library/azure/ee691972.aspx) on it.</span></span> <span data-ttu-id="7dae5-231">Když získáte zapůjčení, určíte, jak dlouho je nutné zapůjčení: to může být pro mezi 15 až 60 sekund nebo nekonečné která dosáhne výhradní zámek.</span><span class="sxs-lookup"><span data-stu-id="7dae5-231">When you acquire a lease, you specify for how long you need the lease: this can be for between 15 to 60 seconds or infinite which amounts to an exclusive lock.</span></span> <span data-ttu-id="7dae5-232">Můžete obnovit také omezené zapůjčení ji rozšířit, a můžete uvolnit všechny zapůjčení, když jste hotovi s ním.</span><span class="sxs-lookup"><span data-stu-id="7dae5-232">You can renew a finite lease to extend it, and you can release any lease when you are finished with it.</span></span> <span data-ttu-id="7dae5-233">Služba objektů blob automaticky uvolní konečné zapůjčení po vypršení jejich platnosti.</span><span class="sxs-lookup"><span data-stu-id="7dae5-233">The blob service automatically releases finite leases when they expire.</span></span>  

<span data-ttu-id="7dae5-234">Zapůjčení povolit různých synchronizace strategie podporovaná, včetně výhradní zápis / sdílené zápisu pro čtení, výhradní / exkluzivní čtení a zápisu sdílené / číst vylučují.</span><span class="sxs-lookup"><span data-stu-id="7dae5-234">Leases enable different synchronization strategies to be supported, including exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read.</span></span> <span data-ttu-id="7dae5-235">Tam, kde existuje zapůjčení služby úložiště vynucuje výhradní zápisy (put, nastavení a operace odstranění) ale zajistit výhradní právo pro operace čtení vyžaduje vývojáři zajistěte, aby všechny klientské aplikace používají ID zapůjčení, a že pouze jeden klient současně má ID platný zapůjčení.</span><span class="sxs-lookup"><span data-stu-id="7dae5-235">Where a lease exists the storage service enforces exclusive writes (put, set and delete operations) however ensuring exclusivity for read operations requires the developer to ensure that all client applications use a lease ID and that only one client at a time has a valid lease ID.</span></span> <span data-ttu-id="7dae5-236">Operace čtení, které neobsahují výsledku ID zapůjčení sdílené čtení.</span><span class="sxs-lookup"><span data-stu-id="7dae5-236">Read operations that do not include a lease ID result in shared reads.</span></span>  

<span data-ttu-id="7dae5-237">Následující fragment C# ukazuje příklad získávání výhradní zapůjčení pro 30 sekund na objekt blob, aktualizace obsahu objektu blob a potom uvolnění zapůjčení.</span><span class="sxs-lookup"><span data-stu-id="7dae5-237">The following C# snippet shows an example of acquiring an exclusive lease for 30 seconds on a blob, updating the content of the blob, and then releasing the lease.</span></span> <span data-ttu-id="7dae5-238">Pokud je již platná zapůjčení na objekt blob při pokusu o získání nového zapůjčení, služby objektů blob vrátí výsledek stav "Konflikt HTTP (409)".</span><span class="sxs-lookup"><span data-stu-id="7dae5-238">If there is already a valid lease on the blob when you try to acquire a new lease, the blob service returns an "HTTP (409) Conflict" status result.</span></span> <span data-ttu-id="7dae5-239">Fragment kódu níže používá **AccessCondition** objekt, který chcete informace o zapůjčení pro zapouzdření při zadávání požadavku k aktualizaci objektu blob ve službě úložiště.</span><span class="sxs-lookup"><span data-stu-id="7dae5-239">The snippet below uses an **AccessCondition** object to encapsulate the lease information when it makes a request to update the blob in the storage service.</span></span>  <span data-ttu-id="7dae5-240">Si můžete stáhnout úplnou ukázku: [Správa souběžnosti použití služby Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="7dae5-240">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
// Acquire lease for 15 seconds
string lease = blockBlob.AcquireLease(TimeSpan.FromSeconds(15), null);
Console.WriteLine("Blob lease acquired. Lease = {0}", lease);

// Update blob using lease. This operation will succeed
const string helloText = "Blob updated";
var accessCondition = AccessCondition.GenerateLeaseCondition(lease);
blockBlob.UploadText(helloText, accessCondition: accessCondition);
Console.WriteLine("Blob updated using an exclusive lease");

//Simulate third party update to blob without lease
try
{
    // Below operation will fail as no valid lease provided
    Console.WriteLine("Trying to update blob without valid lease");
    blockBlob.UploadText("Update without lease, will fail");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == (int)HttpStatusCode.PreconditionFailed)
        Console.WriteLine("Precondition failure as expected. Blob's lease does not match");
    else
        throw;
}  
```

<span data-ttu-id="7dae5-241">Pokud se pokusíte operaci zápisu na objekt blob zapůjčených bez předávání ID zapůjčení, požadavek selže s 412 chyby.</span><span class="sxs-lookup"><span data-stu-id="7dae5-241">If you attempt a write operation on a leased blob without passing the lease ID, the request fails with a 412 error.</span></span> <span data-ttu-id="7dae5-242">Všimněte si, že pokud zapůjčení vyprší před voláním **UploadText** metoda ale stále předat ID zapůjčení, požadavek se také nezdaří s **412** chyby.</span><span class="sxs-lookup"><span data-stu-id="7dae5-242">Note that if the lease expires before calling the **UploadText** method but you still pass the lease ID, the request also fails with a **412** error.</span></span> <span data-ttu-id="7dae5-243">Další informace o správě identifikátory zapůjčení a časy vypršení platnosti zapůjčení, najdete v článku [zapůjčení Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) dokumentace k REST.</span><span class="sxs-lookup"><span data-stu-id="7dae5-243">For more information about managing lease expiry times and lease ids, see the [Lease Blob](http://msdn.microsoft.com/library/azure/ee691972.aspx) REST documentation.</span></span>  

<span data-ttu-id="7dae5-244">Následující operace objektů blob můžete použít ke správě pesimistické souběžnosti zapůjčení:</span><span class="sxs-lookup"><span data-stu-id="7dae5-244">The following blob operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="7dae5-245">Uveďte objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-245">Put Blob</span></span>
* <span data-ttu-id="7dae5-246">Získání objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-246">Get Blob</span></span>
* <span data-ttu-id="7dae5-247">Získat vlastnosti objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-247">Get Blob Properties</span></span>
* <span data-ttu-id="7dae5-248">Nastavit vlastnosti objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-248">Set Blob Properties</span></span>
* <span data-ttu-id="7dae5-249">Získat Metadata objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-249">Get Blob Metadata</span></span>
* <span data-ttu-id="7dae5-250">Nastavit Metadata objektu Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-250">Set Blob Metadata</span></span>
* <span data-ttu-id="7dae5-251">Odstranit objekt Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-251">Delete Blob</span></span>
* <span data-ttu-id="7dae5-252">Uveďte bloku</span><span class="sxs-lookup"><span data-stu-id="7dae5-252">Put Block</span></span>
* <span data-ttu-id="7dae5-253">Uveďte seznam blokovaných položek</span><span class="sxs-lookup"><span data-stu-id="7dae5-253">Put Block List</span></span>
* <span data-ttu-id="7dae5-254">Získat seznam blokovaných položek</span><span class="sxs-lookup"><span data-stu-id="7dae5-254">Get Block List</span></span>
* <span data-ttu-id="7dae5-255">Uveďte stránky</span><span class="sxs-lookup"><span data-stu-id="7dae5-255">Put Page</span></span>
* <span data-ttu-id="7dae5-256">Get rozsahů stránek</span><span class="sxs-lookup"><span data-stu-id="7dae5-256">Get Page Ranges</span></span>
* <span data-ttu-id="7dae5-257">Objekt Blob snímku - ID zapůjčení nepovinná, pokud existuje zapůjčení</span><span class="sxs-lookup"><span data-stu-id="7dae5-257">Snapshot Blob - lease ID optional if a lease exists</span></span>
* <span data-ttu-id="7dae5-258">Kopírování objektu Blob - ID zapůjčení vyžaduje, pokud existuje zapůjčení na cílový objekt blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-258">Copy Blob - lease ID required if a lease exists on the destination blob</span></span>
* <span data-ttu-id="7dae5-259">Abort – objekt Blob kopírování – zapůjčení ID vyžaduje, pokud existuje nekonečné zapůjčení na cílový objekt blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-259">Abort Copy Blob - lease ID required if an infinite lease exists on the destination blob</span></span>
* <span data-ttu-id="7dae5-260">Objekt Blob zapůjčení</span><span class="sxs-lookup"><span data-stu-id="7dae5-260">Lease Blob</span></span>  

### <a name="pessimistic-concurrency-for-containers"></a><span data-ttu-id="7dae5-261">Pesimistické souběžnosti pro kontejnery</span><span class="sxs-lookup"><span data-stu-id="7dae5-261">Pessimistic concurrency for containers</span></span>
<span data-ttu-id="7dae5-262">Zapůjčení kontejnerům povolit stejné strategie synchronizace podporovaný jako na objekty BLOB (exkluzivní zápisu / sdílené zápisu pro čtení, výhradní / exkluzivní čtení a zápisu sdílené / číst exkluzivní) ale na rozdíl od objektů BLOB služby úložiště pouze vynucuje výhradní právo na operace odstranění.</span><span class="sxs-lookup"><span data-stu-id="7dae5-262">Leases on containers enable the same synchronization strategies to be supported as on blobs (exclusive write / shared read, exclusive write / exclusive read and shared write / exclusive read) however unlike blobs the storage service only enforces exclusivity on delete operations.</span></span> <span data-ttu-id="7dae5-263">Pokud chcete odstranit kontejner s aktivní zapůjčení, klient musí obsahovat ID aktivní zapůjčení s požadavku na odstranění.</span><span class="sxs-lookup"><span data-stu-id="7dae5-263">To delete a container with an active lease, a client must include the active lease ID with the delete request.</span></span> <span data-ttu-id="7dae5-264">Všechny ostatní operace kontejneru proběhnout úspěšně při zapůjčených kontejner bez zahrnutí ID zapůjčení v takovém případě jsou sdílené operace.</span><span class="sxs-lookup"><span data-stu-id="7dae5-264">All other container operations succeed on a leased container without including the lease ID in which case they are shared operations.</span></span> <span data-ttu-id="7dae5-265">Pokud se vyžaduje výhradní právo na aktualizace (put nebo sadu) nebo operací čtení pak vývojáři měli zajistěte, aby že všichni klienti používat ID zapůjčení a že jen jeden klientský současně má platný zapůjčení ID.</span><span class="sxs-lookup"><span data-stu-id="7dae5-265">If exclusivity of update (put or set) or read operations is required then developers should ensure all clients use a lease ID and that only one client at a time has a valid lease ID.</span></span>  

<span data-ttu-id="7dae5-266">Následující operace kontejneru můžete použít ke správě pesimistické souběžnosti zapůjčení:</span><span class="sxs-lookup"><span data-stu-id="7dae5-266">The following container operations can use leases to manage pessimistic concurrency:</span></span>  

* <span data-ttu-id="7dae5-267">Odstranit kontejner</span><span class="sxs-lookup"><span data-stu-id="7dae5-267">Delete Container</span></span>
* <span data-ttu-id="7dae5-268">Získat vlastnosti kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-268">Get Container Properties</span></span>
* <span data-ttu-id="7dae5-269">Získat Metadata kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-269">Get Container Metadata</span></span>
* <span data-ttu-id="7dae5-270">Nastavit Metadata kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-270">Set Container Metadata</span></span>
* <span data-ttu-id="7dae5-271">Získání kontejneru seznamu ACL</span><span class="sxs-lookup"><span data-stu-id="7dae5-271">Get Container ACL</span></span>
* <span data-ttu-id="7dae5-272">Nastavit kontejneru seznamu ACL</span><span class="sxs-lookup"><span data-stu-id="7dae5-272">Set Container ACL</span></span>
* <span data-ttu-id="7dae5-273">Zapůjčení kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-273">Lease Container</span></span>  

<span data-ttu-id="7dae5-274">Další informace najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-274">For more information see:</span></span>  

* [<span data-ttu-id="7dae5-275">Určení podmíněného hlavičky pro operace služby objektů Blob</span><span class="sxs-lookup"><span data-stu-id="7dae5-275">Specifying Conditional Headers for Blob Service Operations</span></span>](http://msdn.microsoft.com/library/azure/dd179371.aspx)
* [<span data-ttu-id="7dae5-276">Zapůjčení kontejneru</span><span class="sxs-lookup"><span data-stu-id="7dae5-276">Lease Container</span></span>](http://msdn.microsoft.com/library/azure/jj159103.aspx)
* [<span data-ttu-id="7dae5-277">Objekt Blob zapůjčení</span><span class="sxs-lookup"><span data-stu-id="7dae5-277">Lease Blob </span></span>](http://msdn.microsoft.com/library/azure/ee691972.aspx)

## <a name="managing-concurrency-in-the-table-service"></a><span data-ttu-id="7dae5-278">Správa souběžnost v služby Table</span><span class="sxs-lookup"><span data-stu-id="7dae5-278">Managing Concurrency in the Table Service</span></span>
<span data-ttu-id="7dae5-279">Služba table používá optimistickou metodu, souběžnosti kontroly jako výchozí chování při práci s entitami, na rozdíl od služby objektů blob, kde je nutné provést kontroly optimistickou metodu souběžného explicitně vybrat.</span><span class="sxs-lookup"><span data-stu-id="7dae5-279">The table service uses optimistic concurrency checks as the default behavior when you are working with entities, unlike the blob service where you must explicitly choose to perform optimistic concurrency checks.</span></span> <span data-ttu-id="7dae5-280">Rozdíl mezi službami tabulky a objektů blob je, že službou objektů blob můžete spravovat souběžnosti kontejnery a objekty BLOB můžete pouze spravovat souběžnosti chování entit.</span><span class="sxs-lookup"><span data-stu-id="7dae5-280">The other difference between the table and blob services is that you can only manage the concurrency behavior of entities whereas with the blob service you can manage the concurrency of both containers and blobs.</span></span>  

<span data-ttu-id="7dae5-281">Chcete-li použít optimistickou metodu souběžného a zkontrolovat, pokud jiný proces upravit entitu vzhledem k tomu, že jste získali z tabulky úložiště služby, můžete hodnota ETag, kterou dostanete při služby table vrátí entity.</span><span class="sxs-lookup"><span data-stu-id="7dae5-281">To use optimistic concurrency and to check if another process modified an entity since you retrieved it from the table storage service, you can use the ETag value you receive when the table service returns an entity.</span></span> <span data-ttu-id="7dae5-282">Obrys tento proces je následující:</span><span class="sxs-lookup"><span data-stu-id="7dae5-282">The outline of this process is as follows:</span></span>  

1. <span data-ttu-id="7dae5-283">Načtení entity ze služby table storage, odpověď obsahuje hodnotu značka ETag, která identifikuje aktuální identifikátor přidružený ke dané entity v úložišti služby.</span><span class="sxs-lookup"><span data-stu-id="7dae5-283">Retrieve an entity from the table storage service, the response includes an ETag value that identifies the current identifier associated with that entity in the storage service.</span></span>
2. <span data-ttu-id="7dae5-284">Při aktualizaci entity obsahoval hodnotu ETag získaný v kroku 1 v povinné **If-Match** hlavičky požadavku odeslat do služby.</span><span class="sxs-lookup"><span data-stu-id="7dae5-284">When you update the entity, include the ETag value you received in step 1 in the mandatory **If-Match** header of the request you send to the service.</span></span>
3. <span data-ttu-id="7dae5-285">Služba porovnává hodnotu ETag v žádosti se aktuální hodnota ETag entity.</span><span class="sxs-lookup"><span data-stu-id="7dae5-285">The service compares the ETag value in the request with the current ETag value of the entity.</span></span>
4. <span data-ttu-id="7dae5-286">Pokud je aktuální hodnota ETag entity se liší od ETag v povinné **If-Match** záhlaví v žádosti o službu vrátí chybu 412 klientovi.</span><span class="sxs-lookup"><span data-stu-id="7dae5-286">If the current ETag value of the entity is different than the ETag in the mandatory **If-Match** header in the request, the service returns a 412 error to the client.</span></span> <span data-ttu-id="7dae5-287">To znamená klientovi, že má jiným procesem od klienta jejím načtení aktualizace entity.</span><span class="sxs-lookup"><span data-stu-id="7dae5-287">This indicates to the client that another process has updated the entity since the client retrieved it.</span></span>
5. <span data-ttu-id="7dae5-288">Pokud je aktuální hodnota ETag entity, která je stejná jako značka ETag v povinné **If-Match** hlavičky v požadavku nebo **If-Match** hlavička obsahuje zástupný znak (*), provede služba požadovanou operaci a aktualizuje aktuální hodnota ETag entity, která má zobrazit, že byla aktualizována.</span><span class="sxs-lookup"><span data-stu-id="7dae5-288">If the current ETag value of the entity is the same as the ETag in the mandatory **If-Match** header in the request or the **If-Match** header contains the wildcard character (*), the service performs the requested operation and updates the current ETag value of the entity to show that it has been updated.</span></span>  

<span data-ttu-id="7dae5-289">Všimněte si, že na rozdíl od služby objektů blob služby table vyžaduje klienta zahrnout **If-Match** záhlaví v žádosti o aktualizaci.</span><span class="sxs-lookup"><span data-stu-id="7dae5-289">Note that unlike the blob service, the table service requires the client to include an **If-Match** header in update requests.</span></span> <span data-ttu-id="7dae5-290">Je však možné vynutit nepodmíněné aktualizovat (poslední zapisovače wins strategie) a obejít kontrolách souběžnosti, pokud se nastaví klienta **If-Match** hlavičky k zástupný znak (*) v žádosti.</span><span class="sxs-lookup"><span data-stu-id="7dae5-290">However, it is possible to force an unconditional update (last writer wins strategy) and bypass concurrency checks if the client sets the **If-Match** header to the wildcard character (*) in the request.</span></span>  

<span data-ttu-id="7dae5-291">Následující fragment C# ukazuje entitu zákazníka, která byla dříve buď vytvořit nebo načíst s e-mailové adresy aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="7dae5-291">The following C# snippet shows a customer entity that was previously either created or retrieved having their email address updated.</span></span> <span data-ttu-id="7dae5-292">Počáteční vložit nebo načtení operace úložiště ETag hodnoty v objektu zákazníka, a protože ukázku používá stejnou instanci objektu, když se provede operaci nahrazení, automaticky odesílá hodnota ETag zpět do služby table, povolení služby Kontrola souběžnosti porušení.</span><span class="sxs-lookup"><span data-stu-id="7dae5-292">The initial insert or retrieve operation stores the ETag value in the customer object, and because the sample uses the same object instance when it executes the replace operation, it automatically sends the ETag value back to the table service, enabling the service to check for concurrency violations.</span></span> <span data-ttu-id="7dae5-293">Pokud jiný proces byl aktualizován entity ve službě table storage, službu vrátí zprávu stav HTTP 412 (nezdařil se předběžnou podmínku).</span><span class="sxs-lookup"><span data-stu-id="7dae5-293">If another process has updated the entity in table storage, the service returns an HTTP 412 (Precondition Failed) status message.</span></span>  <span data-ttu-id="7dae5-294">Si můžete stáhnout úplnou ukázku: [Správa souběžnosti použití služby Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span><span class="sxs-lookup"><span data-stu-id="7dae5-294">You can download the full sample here: [Managing Concurrency using Azure Storage](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114).</span></span>

```csharp
try
{
    customer.Email = "updatedEmail@contoso.org";
    TableOperation replaceCustomer = TableOperation.Replace(customer);
    customerTable.Execute(replaceCustomer);
    Console.WriteLine("Replace operation succeeded.");
}
catch (StorageException ex)
{
    if (ex.RequestInformation.HttpStatusCode == 412)
        Console.WriteLine("Optimistic concurrency violation – entity has changed since it was retrieved.");
    else
        throw;
}  
```

<span data-ttu-id="7dae5-295">Kontrola souběžnosti explicitně zakázat, byste měli nastavit **značka ETag** vlastnost **zaměstnanec** do objektu "*" před spuštěním operaci nahrazení.</span><span class="sxs-lookup"><span data-stu-id="7dae5-295">To explicitly disable the concurrency check, you should set the **ETag** property of the **employee** object to "*" before you execute the replace operation.</span></span>  

```csharp
customer.ETag = "*";  
```

<span data-ttu-id="7dae5-296">Následující tabulka shrnuje, jak používat činnosti tabulka entity ETag hodnoty:</span><span class="sxs-lookup"><span data-stu-id="7dae5-296">The following table summarizes how the table entity operations use ETag values:</span></span>

| <span data-ttu-id="7dae5-297">Operace</span><span class="sxs-lookup"><span data-stu-id="7dae5-297">Operation</span></span> | <span data-ttu-id="7dae5-298">Vrátí hodnotu ETag</span><span class="sxs-lookup"><span data-stu-id="7dae5-298">Returns ETag value</span></span> | <span data-ttu-id="7dae5-299">Vyžaduje hlavička If-Match požadavku</span><span class="sxs-lookup"><span data-stu-id="7dae5-299">Requires If-Match request header</span></span> |
|:--- |:--- |:--- |
| <span data-ttu-id="7dae5-300">Dotaz entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-300">Query Entities</span></span> |<span data-ttu-id="7dae5-301">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-301">Yes</span></span> |<span data-ttu-id="7dae5-302">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-302">No</span></span> |
| <span data-ttu-id="7dae5-303">Vložení Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-303">Insert Entity</span></span> |<span data-ttu-id="7dae5-304">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-304">Yes</span></span> |<span data-ttu-id="7dae5-305">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-305">No</span></span> |
| <span data-ttu-id="7dae5-306">Aktualizace Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-306">Update Entity</span></span> |<span data-ttu-id="7dae5-307">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-307">Yes</span></span> |<span data-ttu-id="7dae5-308">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-308">Yes</span></span> |
| <span data-ttu-id="7dae5-309">Sloučení Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-309">Merge Entity</span></span> |<span data-ttu-id="7dae5-310">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-310">Yes</span></span> |<span data-ttu-id="7dae5-311">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-311">Yes</span></span> |
| <span data-ttu-id="7dae5-312">Odstranění Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-312">Delete Entity</span></span> |<span data-ttu-id="7dae5-313">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-313">No</span></span> |<span data-ttu-id="7dae5-314">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-314">Yes</span></span> |
| <span data-ttu-id="7dae5-315">Vložení nebo nahrazení Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-315">Insert or Replace Entity</span></span> |<span data-ttu-id="7dae5-316">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-316">Yes</span></span> |<span data-ttu-id="7dae5-317">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-317">No</span></span> |
| <span data-ttu-id="7dae5-318">Vložení nebo sloučení Entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-318">Insert or Merge Entity</span></span> |<span data-ttu-id="7dae5-319">Ano</span><span class="sxs-lookup"><span data-stu-id="7dae5-319">Yes</span></span> |<span data-ttu-id="7dae5-320">Ne</span><span class="sxs-lookup"><span data-stu-id="7dae5-320">No</span></span> |

<span data-ttu-id="7dae5-321">Všimněte si, že **vložení nebo nahrazení Entity** a **vložení nebo sloučení Entity** provést operace *není* provést jakékoli kontrolách souběžnosti, protože se neodesílají hodnotu značky ETag do tabulky Služba.</span><span class="sxs-lookup"><span data-stu-id="7dae5-321">Note that the **Insert or Replace Entity** and **Insert or Merge Entity** operations do *not* perform any concurrency checks because they do not send an ETag value to the table service.</span></span>  

<span data-ttu-id="7dae5-322">Obecně vývojáře, kteří používají tabulky se spoléhají na optimistickou metodu souběžného při vývoji škálovatelné aplikace.</span><span class="sxs-lookup"><span data-stu-id="7dae5-322">In general developers using tables should rely on optimistic concurrency when developing scalable applications.</span></span> <span data-ttu-id="7dae5-323">V případě potřeby pesimistické zamykání může trvat jeden ze způsobů vývojáři při přístupu k tabulky je přiřadit určený objekt blob pro každou tabulku a zkuste provést zapůjčení u objektu blob před operační v tabulce.</span><span class="sxs-lookup"><span data-stu-id="7dae5-323">If pessimistic locking is needed, one approach developers can take when accessing Tables is to assign a designated blob for each table and try to take a lease on the blob before operating on the table.</span></span> <span data-ttu-id="7dae5-324">Tento přístup vyžadují, aby se zajistit všechny cesty k datům přístup získat zapůjčení před operační v tabulce.</span><span class="sxs-lookup"><span data-stu-id="7dae5-324">This approach does require the application to ensure all data access paths obtain the lease prior to operating on the table.</span></span> <span data-ttu-id="7dae5-325">Také Upozorňujeme, že doba minimální zapůjčení je 15 sekund, což vyžaduje pečlivě zvážit pro škálovatelnost.</span><span class="sxs-lookup"><span data-stu-id="7dae5-325">You should also note that the minimum lease time is 15 seconds which requires careful consideration for scalability.</span></span>  

<span data-ttu-id="7dae5-326">Další informace najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-326">For more information see:</span></span>  

* [<span data-ttu-id="7dae5-327">Operace na entity</span><span class="sxs-lookup"><span data-stu-id="7dae5-327">Operations on Entities</span></span>](http://msdn.microsoft.com/library/azure/dd179375.aspx)  

## <a name="managing-concurrency-in-the-queue-service"></a><span data-ttu-id="7dae5-328">Správa souběžnost v služby front</span><span class="sxs-lookup"><span data-stu-id="7dae5-328">Managing Concurrency in the Queue Service</span></span>
<span data-ttu-id="7dae5-329">Jeden scénář, ve které souběžnosti je problém v rámci služby Řízení front služby je, kde jsou více klientů načítání zpráv z fronty.</span><span class="sxs-lookup"><span data-stu-id="7dae5-329">One scenario in which concurrency is a concern in the queueing service is where multiple clients are retrieving messages from a queue.</span></span> <span data-ttu-id="7dae5-330">Pokud zpráva se načítají z fronty, odpověď obsahuje zprávu a hodnotu pop přijetí, která je potřeba odstranit zprávy.</span><span class="sxs-lookup"><span data-stu-id="7dae5-330">When a message is retrieved from the queue, the response includes the message and a pop receipt value, which is required to delete the message.</span></span> <span data-ttu-id="7dae5-331">Zpráva není automaticky odstraněn z fronty, ale po byl načteny, se nezobrazuje pro ostatní klienty pro časový interval určený parametrem visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="7dae5-331">The message is not automatically deleted from the queue, but after it has been retrieved, it is not visible to other clients for the time interval specified by the visibilitytimeout parameter.</span></span> <span data-ttu-id="7dae5-332">Očekává se, že klienta, který načte zprávu zprávu odstranit po jeho zpracování a před časem určeného TimeNextVisible element odpovědi, které se počítá na základě hodnoty parametru visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="7dae5-332">The client that retrieves the message is expected to delete the message after it has been processed, and before the time specified by the TimeNextVisible element of the response, which is calculated based on the value of the visibilitytimeout parameter.</span></span> <span data-ttu-id="7dae5-333">Čas načtení zprávy k určení hodnoty TimeNextVisible je přidána hodnota visibilitytimeout.</span><span class="sxs-lookup"><span data-stu-id="7dae5-333">The value of visibilitytimeout is added to the time at which the message is retrieved to determine the value of TimeNextVisible.</span></span>  

<span data-ttu-id="7dae5-334">Služba fronty nemá podpora souběžnosti optimistické nebo pesimistické a pro tento důvod klienti zpracování zpráv z fronty načíst by měl zajistěte, aby způsobem idempotent zpracování zpráv.</span><span class="sxs-lookup"><span data-stu-id="7dae5-334">The queue service does not have support for either optimistic or pessimistic concurrency and for this reason clients processing messages retrieved from a queue should ensure messages are processed in an idempotent manner.</span></span> <span data-ttu-id="7dae5-335">Strategie poslední wins zapisovače se používá pro operace aktualizace, jako je například SetQueueServiceProperties, SetQueueMetaData, SetQueueACL a UpdateMessage.</span><span class="sxs-lookup"><span data-stu-id="7dae5-335">A last writer wins strategy is used for update operations such as SetQueueServiceProperties, SetQueueMetaData, SetQueueACL and UpdateMessage.</span></span>  

<span data-ttu-id="7dae5-336">Další informace najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-336">For more information see:</span></span>  

* [<span data-ttu-id="7dae5-337">Rozhraní API REST služby fronty</span><span class="sxs-lookup"><span data-stu-id="7dae5-337">Queue Service REST API</span></span>](http://msdn.microsoft.com/library/azure/dd179363.aspx)
* [<span data-ttu-id="7dae5-338">Získávání zpráv</span><span class="sxs-lookup"><span data-stu-id="7dae5-338">Get Messages</span></span>](http://msdn.microsoft.com/library/azure/dd179474.aspx)  

## <a name="managing-concurrency-in-the-file-service"></a><span data-ttu-id="7dae5-339">Správa souběžnost v služba souborů</span><span class="sxs-lookup"><span data-stu-id="7dae5-339">Managing Concurrency in the File Service</span></span>
<span data-ttu-id="7dae5-340">Služba souborů je přístupný pomocí dva koncové body jiný protokol – protokolu SMB a REST.</span><span class="sxs-lookup"><span data-stu-id="7dae5-340">The file service can be accessed using two different protocol endpoints – SMB and REST.</span></span> <span data-ttu-id="7dae5-341">Službu REST nemá podporu pro optimistické zamykání nebo pesimistické zamykání a všechny aktualizace bude postupovat podle strategie poslední zapisovače služby wins.</span><span class="sxs-lookup"><span data-stu-id="7dae5-341">The REST service does not have support for either optimistic locking or pessimistic locking and all updates will follow a last writer wins strategy.</span></span> <span data-ttu-id="7dae5-342">Klienti SMB, které připojení sdílené složky můžete využít soubor systému uzamčení mechanismy můžete spravovat přístup ke sdíleným souborům – včetně schopnost provádět pesimistické zamykání.</span><span class="sxs-lookup"><span data-stu-id="7dae5-342">SMB clients that mount file shares can leverage file system locking mechanisms to manage access to shared files – including the ability to perform pessimistic locking.</span></span> <span data-ttu-id="7dae5-343">Když klienti SMB otevře soubor, určuje, jak se přístup k souborům a sdílení režimu.</span><span class="sxs-lookup"><span data-stu-id="7dae5-343">When an SMB client opens a file, it specifies both the file access and share mode.</span></span> <span data-ttu-id="7dae5-344">Nastavení možnosti přístup k souborům "Zápisu" nebo "Pro čtení a zápis" spolu s režimem sdílené složky "Žádný" bude v souboru je uzamčený klienti SMB, dokud soubor zavřený.</span><span class="sxs-lookup"><span data-stu-id="7dae5-344">Setting a File Access option of "Write" or "Read/Write" along with a File Share mode of "None" will result in the file being locked by an SMB client until the file is closed.</span></span> <span data-ttu-id="7dae5-345">Pokud dojde k pokusu o souboru, kde klienti SMB má soubor uzamčen operaci REST ve službě REST vrátí stavový kód 409 (konflikt) s kódem chyby SharingViolation.</span><span class="sxs-lookup"><span data-stu-id="7dae5-345">If REST operation is attempted on a file where an SMB client has the file locked the REST service will return status code 409 (Conflict) with error code SharingViolation.</span></span>  

<span data-ttu-id="7dae5-346">Když klienti SMB otevře soubor pro odstranění, označí soubor jako čekající na vyřízení odstranit, dokud všechny ostatní klienty protokolu SMB jsou uzavřeny otevřenými popisovači v souboru.</span><span class="sxs-lookup"><span data-stu-id="7dae5-346">When an SMB client opens a file for delete, it marks the file as pending delete until all other SMB client open handles on that file are closed.</span></span> <span data-ttu-id="7dae5-347">Když soubor je označen jako čekající na odstranění, všechny operace REST u tohoto souboru vrátí stavový kód 409 (konflikt) s kódem chyby SMBDeletePending.</span><span class="sxs-lookup"><span data-stu-id="7dae5-347">While a file is marked as pending delete, any REST operation on that file will return status code 409 (Conflict) with error code SMBDeletePending.</span></span> <span data-ttu-id="7dae5-348">Stavový kód 404 (není nalezena) nevrátí, protože je to možné, odeberte příznak čeká na odstranění před zavírání souboru klientovi SMB.</span><span class="sxs-lookup"><span data-stu-id="7dae5-348">Status code 404 (Not Found) is not returned since it is possible for the SMB client to remove the pending deletion flag prior to closing the file.</span></span> <span data-ttu-id="7dae5-349">Jinými slovy stavový kód 404 (není nalezena) se očekávají jenom, když soubor byl odebrán.</span><span class="sxs-lookup"><span data-stu-id="7dae5-349">In other words, status code 404 (Not Found) is only expected when the file has been removed.</span></span> <span data-ttu-id="7dae5-350">Všimněte si, že soubor je v protokolu SMB čeká na odstranění stavu, nebude zahrnutý ve výsledcích seznamu souborů. Všimněte si také, že operace REST odstranit soubor a odstraňte adresář REST se potvrdí atomicky a nevedou k odstranění stavu čekání na.</span><span class="sxs-lookup"><span data-stu-id="7dae5-350">Note that while a file is in a SMB pending delete state, it will not be included in the List Files results.Also note that the REST Delete File and REST Delete Directory operations are committed atomically and do not result in pending delete state.</span></span>  

<span data-ttu-id="7dae5-351">Další informace najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-351">For more information see:</span></span>  

* [<span data-ttu-id="7dae5-352">Správa souborů zamkne</span><span class="sxs-lookup"><span data-stu-id="7dae5-352">Managing File Locks</span></span>](http://msdn.microsoft.com/library/azure/dn194265.aspx)  

## <a name="summary-and-next-steps"></a><span data-ttu-id="7dae5-353">Souhrn a další kroky</span><span class="sxs-lookup"><span data-stu-id="7dae5-353">Summary and Next Steps</span></span>
<span data-ttu-id="7dae5-354">Služby Microsoft Azure Storage byly navržené tak, aby vyhovovaly nejsložitější online aplikace bez vynucení vývojářům ohrozit nebo přehodnotit předpoklady klíče návrh například souběžnosti a konzistenci dat, který se má provést pro oprávnění.</span><span class="sxs-lookup"><span data-stu-id="7dae5-354">The Microsoft Azure Storage service has been designed to meet the needs of the most complex online applications without forcing developers to compromise or rethink key design assumptions such as concurrency and data consistency that they have come to take for granted.</span></span>  

<span data-ttu-id="7dae5-355">Pro dokončení ukázkovou aplikaci, kterou se odkazuje v tomto blogu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-355">For the complete sample application referenced in this blog:</span></span>  

* [<span data-ttu-id="7dae5-356">Správa souběžnosti použití služby Azure Storage – ukázková aplikace</span><span class="sxs-lookup"><span data-stu-id="7dae5-356">Managing Concurrency using Azure Storage - Sample Application</span></span>](http://code.msdn.microsoft.com/Managing-Concurrency-using-56018114)  

<span data-ttu-id="7dae5-357">Další informace o Azure Storage najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="7dae5-357">For more information on Azure Storage see:</span></span>  

* [<span data-ttu-id="7dae5-358">Microsoft Azure Storage domovské stránky</span><span class="sxs-lookup"><span data-stu-id="7dae5-358">Microsoft Azure Storage Home Page</span></span>](https://azure.microsoft.com/services/storage/)
* [<span data-ttu-id="7dae5-359">Úvod do Azure Storage</span><span class="sxs-lookup"><span data-stu-id="7dae5-359">Introduction to Azure Storage</span></span>](storage-introduction.md)
* <span data-ttu-id="7dae5-360">Začínáme se Storage [Blob](storage-dotnet-how-to-use-blobs.md), [tabulky](storage-dotnet-how-to-use-tables.md), [fronty](storage-dotnet-how-to-use-queues.md), a [soubory](storage-dotnet-how-to-use-files.md)</span><span class="sxs-lookup"><span data-stu-id="7dae5-360">Storage Getting Started for [Blob](storage-dotnet-how-to-use-blobs.md), [Table](storage-dotnet-how-to-use-tables.md),  [Queues](storage-dotnet-how-to-use-queues.md), and [Files](storage-dotnet-how-to-use-files.md)</span></span>
* <span data-ttu-id="7dae5-361">Architektura úložiště – [Azure Storage: vysoce dostupný Cloudová služba úložiště se silnou konzistenci](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span><span class="sxs-lookup"><span data-stu-id="7dae5-361">Storage Architecture – [Azure Storage : A Highly Available Cloud Storage Service with Strong Consistency](http://blogs.msdn.com/b/windowsazurestorage/archive/2011/11/20/windows-azure-storage-a-highly-available-cloud-storage-service-with-strong-consistency.aspx)</span></span>


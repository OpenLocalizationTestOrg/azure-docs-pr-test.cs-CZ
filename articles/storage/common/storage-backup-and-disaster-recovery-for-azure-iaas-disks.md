---
title: "Zálohování a zotavení po havárii pro disky Azure IaaS | Microsoft Docs"
description: "V tomto článku vysvětlíme, jak naplánovat zálohování a obnovení po havárii (DR) IaaS virtuálních počítačů (VM) a disky v Azure. Tento dokument popisuje spravované i nespravované disky"
services: storage
cloud: Azure
documentationcenter: na
author: luywang
manager: kavithag
ms.assetid: 
ms.service: storage
ms.workload: storage
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/19/2017
ms.author: luywang
ms.openlocfilehash: 03d38bc3383b5fd39eca5ca67c315b34b98f0c39
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="backup-and-disaster-recovery-for-azure-iaas-disks"></a><span data-ttu-id="8f0df-104">Zálohování a zotavení po havárii pro disky Azure IaaS</span><span class="sxs-lookup"><span data-stu-id="8f0df-104">Backup and disaster recovery for Azure IaaS disks</span></span>

<span data-ttu-id="8f0df-105">V tomto článku vysvětlíme, jak naplánovat zálohování a obnovení po havárii (DR) IaaS virtuálních počítačů (VM) a disky v Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0df-105">In this article, we will explain how to plan for Backup and Disaster Recovery (DR) of IaaS virtual machines (VMs) and Disks in Azure.</span></span> <span data-ttu-id="8f0df-106">Tento dokument popisuje spravované i nespravované disky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-106">This document covers both Managed and Unmanaged Disks.</span></span>

<span data-ttu-id="8f0df-107">Nejprve budeme mluvit na předdefinované odolnost proti chybám možnosti platformy Azure které pomáhají chránit proti místní selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-107">We’ll first talk about the built-in fault tolerance capabilities in the Azure platform which help guard against local failures.</span></span> <span data-ttu-id="8f0df-108">Potom probereme scénáře po havárii, není plně předmětem integrované funkce, která je hlavní téma řešený v tomto dokumentu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-108">We’ll then discuss the disaster scenarios not fully covered by the built-in capabilities, which is the main topic addressed by this document.</span></span> <span data-ttu-id="8f0df-109">Ukážeme vám také několik příkladů zatížení scénáře, kde může použít různé aspekty zálohování a zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-109">We’ll also show several examples of workload scenarios where different Backup and DR considerations may apply.</span></span> <span data-ttu-id="8f0df-110">Potom: přečtěte možná řešení pro zotavení po Havárii disků IaaS.</span><span class="sxs-lookup"><span data-stu-id="8f0df-110">We’ll then review possible solutions for DR of IaaS Disks.</span></span> 

## <a name="introduction"></a><span data-ttu-id="8f0df-111">Úvod</span><span class="sxs-lookup"><span data-stu-id="8f0df-111">Introduction</span></span>

<span data-ttu-id="8f0df-112">Platformy Azure využívá k ochraně zákazníků selhání lokalizované hardwaru, které můžou nastat různé metody pro redundanci a odolnost proti chybám.</span><span class="sxs-lookup"><span data-stu-id="8f0df-112">The Azure platform uses various methods for redundancy and fault tolerance to help protect customers from localized hardware failures that can occur.</span></span> <span data-ttu-id="8f0df-113">Místní selhání může zahrnovat problémy s počítačem serveru úložiště Azure, která ukládá část dat pro virtuální disk nebo selhání SSD nebo pevný disk na tomto serveru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-113">Local failures may include problems with an Azure storage server machine that stores part of the data for a virtual disk or failures of an SSD or HDD on that server.</span></span> <span data-ttu-id="8f0df-114">Tyto součásti selhání izolované hardwaru může dojít během normálních operací a platformy je navržený jako odolné vůči selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-114">Such isolated hardware component failures can happen during normal operations and the platform is designed to be resilient to these failures.</span></span> <span data-ttu-id="8f0df-115">Hlavní havárie může způsobit selhání nebo inaccessibility velkého počtu serverů úložiště nebo celého datového centra.</span><span class="sxs-lookup"><span data-stu-id="8f0df-115">Major disasters can result in failures or inaccessibility of a large numbers of storage servers or a whole datacenter.</span></span> <span data-ttu-id="8f0df-116">Při z lokálních selhání jsou obvykle chráněné virtuální počítače a disky, jsou nutné k ochraně vaše úlohy celou oblast závažné selhání (například významnější havárie) ovlivňující virtuálních počítačů a disků další kroky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-116">While your VMs and disks are normally protected from localized failures, additional steps are necessary to protect your workload from region-wide catastrophic failures (such as a major disaster) that can affect your VM and disks.</span></span>

<span data-ttu-id="8f0df-117">Kromě možnosti selhání platformy může dojít k problémům s aplikací zákazníka nebo data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-117">In addition to the possibility of platform failures, problems with the customer application or data can occur.</span></span> <span data-ttu-id="8f0df-118">Nová verze aplikace může být například nechtěně narušující, změňte na data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-118">For example, a new version of your application may inadvertently make a breaking change to the data.</span></span> <span data-ttu-id="8f0df-119">V takovém případě můžete vrátit aplikace a data, která mají na předchozí verzi obsahující poslední známého funkčního stavu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-119">In that case, you may want to revert the application and the data to a prior version containing the last known good state.</span></span> <span data-ttu-id="8f0df-120">To vyžaduje údržbu pravidelných záloh.</span><span class="sxs-lookup"><span data-stu-id="8f0df-120">This requires maintaining regular backups.</span></span>

<span data-ttu-id="8f0df-121">Místní zotavení po havárii musíte zálohovat vaše disky virtuálních počítačů IaaS v jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-121">For regional disaster recovery, you must backup your IaaS VM disks to a different region.</span></span> 

<span data-ttu-id="8f0df-122">Předtím, než se podíváme na možnosti zálohování a zotavení po Havárii, můžeme recap několik metod k dispozici pro zpracování lokálních selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-122">Before we look at Backup and DR options, let’s recap a few methods available for handling localized failures.</span></span>

### <a name="azure-iaas-resiliency"></a><span data-ttu-id="8f0df-123">Odolnost proti chybám Azure IaaS</span><span class="sxs-lookup"><span data-stu-id="8f0df-123">Azure IaaS Resiliency</span></span>

<span data-ttu-id="8f0df-124">*Odolnost proti chybám* odkazuje na tolerance pro běžné chyby, ke kterým došlo v hardwarové součásti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-124">*Resiliency* refers to the tolerance for normal failures that occur in hardware components.</span></span> <span data-ttu-id="8f0df-125">Odolnost proti chybám je možnost obnovení v případě selhání a i nadále fungovat.</span><span class="sxs-lookup"><span data-stu-id="8f0df-125">Resiliency is the ability to recover from failures and continue to function.</span></span> <span data-ttu-id="8f0df-126">Nejedná se o zamezení selhání, ale odpověď na selhání způsobem, který zabraňuje výpadku nebo ztráty dat.</span><span class="sxs-lookup"><span data-stu-id="8f0df-126">It's not about avoiding failures, but responding to failures in a way that avoids downtime or data loss.</span></span> <span data-ttu-id="8f0df-127">Cílem odolnosti je pro návrat aplikace plně funkční stavu selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-127">The goal of resiliency is to return the application to a fully functioning state following a failure.</span></span> <span data-ttu-id="8f0df-128">Azure virtuální počítače a disky jsou navržené jako odolné vůči běžné chyby hardwaru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-128">Azure Virtual Machines and Disks are designed to be resilient to common hardware faults.</span></span> <span data-ttu-id="8f0df-129">Dejte nám podívejte, jak na platformu Azure IaaS poskytuje tuto odolnost proti chybám.</span><span class="sxs-lookup"><span data-stu-id="8f0df-129">Let us look at how the Azure IaaS platform provides this resiliency.</span></span>

<span data-ttu-id="8f0df-130">Virtuální počítač se skládá ze dvou částí především: (1) A výpočetní server a (2) je trvalé disky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-130">A virtual machine consists mainly of two parts: (1) A compute server, and (2) the persistent disks.</span></span> <span data-ttu-id="8f0df-131">Obě ovlivnit odolnost proti chybám virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="8f0df-131">Both affect the fault tolerance of a virtual machine.</span></span>

<span data-ttu-id="8f0df-132">Pokud na serveru hostitele výpočtů Azure, zaštiťující virtuálního počítače dojde k selhání hardwaru (což je taková situace vzácná), Azure je určena pro automatické obnovení virtuálního počítače na jiný server.</span><span class="sxs-lookup"><span data-stu-id="8f0df-132">If the Azure compute host server that houses your VM experiences a hardware failure (which is rare), Azure is designed to automatically restore the VM on another server.</span></span> <span data-ttu-id="8f0df-133">V takovém případě si všimnete restart a virtuální počítač bude zálohovat po určité době.</span><span class="sxs-lookup"><span data-stu-id="8f0df-133">If this happens, you will experience a reboot, and the VM will be back up after some time.</span></span> <span data-ttu-id="8f0df-134">Azure automaticky zjišťuje takové selhání hardwaru a provede obnovení k zajištění, že zákazník virtuálních počítačů bude k dispozici co nejdříve.</span><span class="sxs-lookup"><span data-stu-id="8f0df-134">Azure automatically detects such hardware failures and executes recoveries to help ensure the customer VM will be available as soon as possible.</span></span>

<span data-ttu-id="8f0df-135">O discích IaaS odolnost dat je důležité pro platformu trvalého úložiště.</span><span class="sxs-lookup"><span data-stu-id="8f0df-135">Regarding IaaS disks, durability of data is critical for the persistent storage platform.</span></span> <span data-ttu-id="8f0df-136">Zákazníci, Azure mají důležitých podnikových aplikací běžících na IaaS a jsou závislé na trvalost dat.</span><span class="sxs-lookup"><span data-stu-id="8f0df-136">Azure customers have important business applications running on IaaS and they depend on the persistence of the data.</span></span> <span data-ttu-id="8f0df-137">Ochrana Azure návrhy pro tyto disky IaaS s tři redundantní kopie dat uložených místně, poskytuje vysokou odolnost proti selhání místní.</span><span class="sxs-lookup"><span data-stu-id="8f0df-137">Azure designs protection for these IaaS disks with three redundant copies of data stored locally, providing high durability against local failures.</span></span> <span data-ttu-id="8f0df-138">Pokud jeden z hardwarové součásti, které obsahuje váš disk selže, virtuální počítač není dopad, protože nejsou k dispozici dvě další kopie pro podporu požadavků na disku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-138">If one of the hardware components that holds your disk fails, your VM is not impacted because there are two additional copies to support disk requests.</span></span> <span data-ttu-id="8f0df-139">Funguje bez problémů i v případě selžou dva různé hardwarové komponenty podpora disk ve stejnou dobu (které by bylo velmi výjimečných).</span><span class="sxs-lookup"><span data-stu-id="8f0df-139">It works fine even if two different hardware components supporting a disk fail at the same time (which would be very rare).</span></span> <span data-ttu-id="8f0df-140">K zajištění, že vždy uchováváme tři repliky, nastavení služby Azure Storage automaticky vytvoří novou kopii dat na pozadí, pokud některý z tři kopie nedostupný.</span><span class="sxs-lookup"><span data-stu-id="8f0df-140">To help ensure we always maintain three replicas, the Azure Storage service automatically spawns a new copy of data in the background if one of the three copies becomes unavailable.</span></span> <span data-ttu-id="8f0df-141">Proto by nemělo být potřeba pomocí Azure disky RAID pro odolnost proti chybám.</span><span class="sxs-lookup"><span data-stu-id="8f0df-141">Therefore, it should not be necessary to use RAID with Azure disks for fault tolerance.</span></span> <span data-ttu-id="8f0df-142">Jednoduché RAID 0 konfigurace by mělo být dostatečné pro prokládání disky v případě potřeby vytvořte větší svazky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-142">A simple RAID 0 configuration should be sufficient for striping the disks if necessary to create larger volumes.</span></span>

<span data-ttu-id="8f0df-143">Z důvodu této architektuře **Azure má doručit konzistentně podnikové úrovni odolnost pro IaaS disky s špičkový NULOVÉ % [rozpočítat na roční období míra selhání](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span><span class="sxs-lookup"><span data-stu-id="8f0df-143">Because of this architecture, **Azure has consistently delivered enterprise-grade durability for IaaS disks, with an industry-leading ZERO % [Annualized Failure Rate](https://en.wikipedia.org/wiki/Annualized_failure_rate).**</span></span>

<span data-ttu-id="8f0df-144">Lokalizované hardwaru chyb ve výpočetní hostitele nebo v platformě úložiště můžete někdy výsledek v dočasné nedostupnosti virtuálního počítače, které se vztahuje [smlouva Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) dostupnosti virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="8f0df-144">Localized hardware faults on the compute host or in the storage platform can sometimes result in temporary unavailability for the VM which is covered by the [Azure SLA](https://azure.microsoft.com/support/legal/sla/virtual-machines/) for VM Availability.</span></span> <span data-ttu-id="8f0df-145">Azure poskytuje špičkový SLA pro jedné instance virtuálních počítačů, které použijte disky úložiště Premium.</span><span class="sxs-lookup"><span data-stu-id="8f0df-145">Azure also provides an industry-leading SLA for single VM instances that use Premium Storage disks.</span></span>

<span data-ttu-id="8f0df-146">Aby se předešlo úlohy aplikací z výpadek kvůli dočasné nedostupnosti disk nebo virtuální počítač, můžete využít zákazníci [skupiny dostupnosti](../../virtual-machines/windows/manage-availability.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-146">To safeguard application workloads from downtime due to the temporary unavailability of a disk or VM, customers can leverage [Availability Sets](../../virtual-machines/windows/manage-availability.md).</span></span> <span data-ttu-id="8f0df-147">Dvě nebo více virtuálních počítačů v nastavení dostupnosti poskytuje redundanci pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8f0df-147">Two or more virtual machines in an availability set provides redundancy for the application.</span></span> <span data-ttu-id="8f0df-148">Azure potom vytvoří tyto virtuální počítače a disky v doménách selhání samostatné s různé součásti napájení, sítě a serveru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-148">Azure then creates these VMs and disks in separate fault domains with different power, network, and server components.</span></span> <span data-ttu-id="8f0df-149">Proto selhání lokalizované hardwaru obvykle nemají vliv na víc virtuálních počítačů v sadě ve stejnou dobu, tím vysokou dostupnost pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8f0df-149">Thus, localized hardware failures typically do not affect multiple VMs in the set at the same time, providing high availability for your application.</span></span> <span data-ttu-id="8f0df-150">Má se za vhodné použít skupiny dostupnosti, pokud se vyžaduje vysoká dostupnost.</span><span class="sxs-lookup"><span data-stu-id="8f0df-150">It is considered a good practice to use availability sets when high availability is required.</span></span> <span data-ttu-id="8f0df-151">Další informace najdete v tématu na zotavení po havárii aspekty, které jsou popsané dál.</span><span class="sxs-lookup"><span data-stu-id="8f0df-151">For more information, see the Disaster Recovery aspects detailed below.</span></span>

### <a name="backup-and-disaster-recovery"></a><span data-ttu-id="8f0df-152">Zálohování a zotavení po havárii</span><span class="sxs-lookup"><span data-stu-id="8f0df-152">Backup and Disaster Recovery</span></span>

<span data-ttu-id="8f0df-153">Zotavení po havárii (DR), je schopnost zotavit výjimečných ale hlavní incidenty:-pouze dočasné, celou škálování selhání, jako je například přerušení služby, které ovlivňuje celou oblast.</span><span class="sxs-lookup"><span data-stu-id="8f0df-153">Disaster recovery (DR) is the ability to recover from rare but major incidents: non-transient, wide-scale failures, such as service disruption that affects an entire region.</span></span> <span data-ttu-id="8f0df-154">Zotavení po havárii zahrnuje zálohování dat a archivaci a může zahrnovat ruční zásah, například obnovit databázi ze zálohy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-154">Disaster recovery includes data backup and archiving, and may include manual intervention, such as restoring a database from backup.</span></span>

<span data-ttu-id="8f0df-155">Platformy Azure integrovanou ochranu proti selhání lokalizované nemusí plně chránit virtuální počítače nebo disky v případě hlavní havárie, které může způsobit výpadky ve velkém měřítku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-155">The Azure platform’s built-in protection against localized failures may not fully protect the VMs/disks in the case of major disasters which can cause large-scale outages.</span></span> <span data-ttu-id="8f0df-156">To zahrnuje závažné události, jako je například datové centrum, se setkají hurikán, zemětřesení, ještě efektivněji nebo selhání jednotky hardwaru velkém měřítku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-156">This includes catastrophic events such as a data center being hit by a hurricane, earthquake, fire, or large scale hardware unit failures.</span></span> <span data-ttu-id="8f0df-157">Kromě toho může dojít k chybám způsobeným problémy dat nebo aplikace.</span><span class="sxs-lookup"><span data-stu-id="8f0df-157">In addition, you may encounter failures due to application or data issues.</span></span>

<span data-ttu-id="8f0df-158">K ochraně vašich úloh IaaS z výpadky, měli byste naplánovat redundanci a zálohování za účelem umožnění obnovy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-158">To help protect your IaaS workloads from outages, you should plan for redundancy and backups to enable recovery.</span></span> <span data-ttu-id="8f0df-159">Pro zotavení po havárii měli byste naplánovat redundance a zálohování v jiném geografické umístění směrem od primární lokality.</span><span class="sxs-lookup"><span data-stu-id="8f0df-159">For disaster recovery, you should plan redundancy and backup in a different geographic location away from the primary site.</span></span> <span data-ttu-id="8f0df-160">To pomáhá zajistit, že záloha není ovlivněn stejnou událost, která původně dopad na počítač nebo disků.</span><span class="sxs-lookup"><span data-stu-id="8f0df-160">This helps ensure your backup is not affected by the same event that originally impacted the VM or disks.</span></span> <span data-ttu-id="8f0df-161">Další informace najdete v tématu [zotavení po havárii pro aplikace vytvořené v Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span><span class="sxs-lookup"><span data-stu-id="8f0df-161">For more information, see [Disaster Recovery for Applications built on Azure](https://docs.microsoft.com/azure/architecture/resiliency/disaster-recovery-azure-applications).</span></span>

<span data-ttu-id="8f0df-162">Důležité informace o vaší zotavení po Havárii může zahrnovat následující aspekty:</span><span class="sxs-lookup"><span data-stu-id="8f0df-162">Your DR considerations may include the following aspects:</span></span>

1. <span data-ttu-id="8f0df-163">Vysoké dostupnosti (HA) je schopnost aplikace a pokračovat v činnosti ve stavu v pořádku, bez významné výpadky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-163">High Availability (HA) is the ability of the application to continue running in a healthy state, without significant downtime.</span></span> <span data-ttu-id="8f0df-164">Podle "stavu v pořádku," jsme znamená reaguje aplikace a uživatelé můžou připojit k aplikaci a pracovat s ním.</span><span class="sxs-lookup"><span data-stu-id="8f0df-164">By "healthy state," we mean the application is responsive, and users can connect to the application and interact with it.</span></span> <span data-ttu-id="8f0df-165">Některé důležité aplikace a databáze může být požadované k dispozici vždy, i v případě, že tam jsou chyby samotné platformy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-165">Certain mission-critical applications and databases may be required to be available always, even when there are failures in the platform.</span></span> <span data-ttu-id="8f0df-166">Pro tyto úlohy musíte naplánovat redundance pro aplikace a také data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-166">For these workloads, you may need to plan redundancy for the application as well as the data.</span></span>

2. <span data-ttu-id="8f0df-167">Odolnost data: V některých případech hlavní faktor je zajistit, že data se zachová, i v případě havárie.</span><span class="sxs-lookup"><span data-stu-id="8f0df-167">Data Durability: In some cases, the main consideration is ensuring the data is preserved in the case of a disaster.</span></span> <span data-ttu-id="8f0df-168">Proto může být nutné zálohování dat v jiné lokalitě.</span><span class="sxs-lookup"><span data-stu-id="8f0df-168">Therefore, you may need a backup of your data in a different site.</span></span> <span data-ttu-id="8f0df-169">Pro taková zatížení možná nebudete potřebovat úplné redundance pro aplikace, ale pravidelné zálohy disků.</span><span class="sxs-lookup"><span data-stu-id="8f0df-169">For such workloads, you may not need full redundancy for the application, but a regular backup of the disks.</span></span>

## <a name="backup-and-dr-scenarios"></a><span data-ttu-id="8f0df-170">Zálohování a zotavení po Havárii scénáře</span><span class="sxs-lookup"><span data-stu-id="8f0df-170">Backup and DR Scenarios</span></span>

<span data-ttu-id="8f0df-171">Podívejme se na několik příkladů typické scénáře zatížení aplikací a jaké jsou požadavky týkající se plánování zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-171">Let’s look at a few typical examples of application workload scenarios and the considerations for planning Disaster Recovery.</span></span>

### <a name="scenario-1-major-database-solutions"></a><span data-ttu-id="8f0df-172">Scénář 1: Hlavní databáze řešení</span><span class="sxs-lookup"><span data-stu-id="8f0df-172">Scenario 1: Major Database Solutions</span></span>

<span data-ttu-id="8f0df-173">Vezměte v úvahu produkční databázový server jako SQL Server nebo Oracle, který podporuje vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="8f0df-173">Consider a production database server like SQL Server or Oracle that can support High Availability.</span></span> <span data-ttu-id="8f0df-174">Kritický produkční aplikace a uživatelé závisí na tuto databázi.</span><span class="sxs-lookup"><span data-stu-id="8f0df-174">Critical production applications and users depend on this database.</span></span> <span data-ttu-id="8f0df-175">Plán obnovení po havárii pro tento systém může třeba podporovat následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="8f0df-175">The Disaster Recovery plan for this system may need to support the following requirements:</span></span>

1. <span data-ttu-id="8f0df-176">Data musí být chráněný a obnovitelný.</span><span class="sxs-lookup"><span data-stu-id="8f0df-176">Data must be protected and recoverable.</span></span>
2.  <span data-ttu-id="8f0df-177">Server musí být k dispozici pro použití.</span><span class="sxs-lookup"><span data-stu-id="8f0df-177">Server must be available for use.</span></span>

<span data-ttu-id="8f0df-178">Může to vyžadovat zachování repliky databáze v jiné oblasti jako záložní.</span><span class="sxs-lookup"><span data-stu-id="8f0df-178">This may require maintaining a replica of the database in a different region as a backup.</span></span> <span data-ttu-id="8f0df-179">V závislosti na požadavcích pro dostupnost serveru a obnovení dat může řešení rozsahu od aktivní-aktivní nebo aktivní – pasivní repliky lokality do pravidelné zálohy dat offline.</span><span class="sxs-lookup"><span data-stu-id="8f0df-179">Depending on the requirements for server availability and data recovery, the solution could range from an Active-Active or Active-Passive replica site to periodic offline backups of the data.</span></span> <span data-ttu-id="8f0df-180">Relační databáze jako je například SQL Server a Oracle poskytují různé možnosti pro replikaci.</span><span class="sxs-lookup"><span data-stu-id="8f0df-180">Relational databases such as SQL Server and Oracle provide various options for replication.</span></span> <span data-ttu-id="8f0df-181">Pro systém SQL Server [SQL serveru skupin dostupnosti Always On](https://msdn.microsoft.com/library/hh510230.aspx) lze použít pro vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="8f0df-181">For SQL Server, [SQL Server Always On Availability Groups](https://msdn.microsoft.com/library/hh510230.aspx) can be used for high availability.</span></span>

<span data-ttu-id="8f0df-182">Databáze NoSQL, jako MongoDB také podporují [repliky](https://docs.mongodb.com/manual/replication/) redundanci.</span><span class="sxs-lookup"><span data-stu-id="8f0df-182">NoSQL databases like MongoDB also support [replicas](https://docs.mongodb.com/manual/replication/) for redundancy.</span></span> <span data-ttu-id="8f0df-183">Můžete použít repliky pro vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="8f0df-183">The replicas for high availability can be used.</span></span>

### <a name="scenario-2-a-cluster-of-redundant-vms"></a><span data-ttu-id="8f0df-184">Scénář 2: Cluster redundantní virtuální počítače</span><span class="sxs-lookup"><span data-stu-id="8f0df-184">Scenario 2: A cluster of redundant VMs</span></span>

<span data-ttu-id="8f0df-185">Vezměte v úvahu zatížení zpracovává cluster virtuálních počítačů, které poskytují redundanci a vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-185">Consider a workload handled by a cluster of VMs that provide redundancy and load balancing.</span></span> <span data-ttu-id="8f0df-186">Příkladem může být cluster Cassandra nasazené v oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-186">One example would be a Cassandra cluster deployed in a region.</span></span> <span data-ttu-id="8f0df-187">Tento typ architektury již poskytuje vysokou úroveň redundance v rámci této oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-187">This type of architecture already provides a high level of redundancy within that region.</span></span> <span data-ttu-id="8f0df-188">Chránit úlohy v případě selhání místní úrovni, byste však měli zvážit šíření clusteru v rámci dvou oblastí nebo prováděním pravidelné zálohy jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-188">However, to protect the workload from a regional level failure, you should consider spreading the cluster across two regions or making periodic backups to another region.</span></span>

### <a name="scenario-3-iaas-application-workload"></a><span data-ttu-id="8f0df-189">Scénář 3: IaaS aplikace zatížení</span><span class="sxs-lookup"><span data-stu-id="8f0df-189">Scenario 3: IaaS Application Workload</span></span>

<span data-ttu-id="8f0df-190">To může být typické provozní úlohu spuštěnou na virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0df-190">This could be a typical production workload running on an Azure VM.</span></span> <span data-ttu-id="8f0df-191">Například může být na webovém serveru nebo souborového serveru, která uchovává obsah a dalším prostředkům lokality.</span><span class="sxs-lookup"><span data-stu-id="8f0df-191">For example, it could be a web server or file server holding the content and other resources of a site.</span></span> <span data-ttu-id="8f0df-192">Mohou být také uživatelské obchodní aplikace běžící v virtuální počítač, který uložené prostředky, stav aplikace a jeho data na disky virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="8f0df-192">It could also be a custom-built business application running on a VM that stored its data, resources, and application state on the VM disks.</span></span> <span data-ttu-id="8f0df-193">V takovém případě je důležité se ujistit, že provedete zálohy v pravidelných intervalech.</span><span class="sxs-lookup"><span data-stu-id="8f0df-193">In this case, it is important to make sure you take backups on a regular basis.</span></span> <span data-ttu-id="8f0df-194">Četnost zálohování by měla být založena na povaze zatížení virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="8f0df-194">Backup frequency should be based on the nature of the VM workload.</span></span> <span data-ttu-id="8f0df-195">Například pokud aplikace spouští každý den a mění data, zálohování by měl být bere každou hodinu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-195">For example, if the application runs every day and modifies data, then the backup should be taken every hour.</span></span>

<span data-ttu-id="8f0df-196">Dalším příkladem je server pro sestavy této načítat data z jiných zdrojů a generuje souhrnné sestavy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-196">Another example is a reporting server that pull data from other sources and generates aggregated reports.</span></span> <span data-ttu-id="8f0df-197">Ztrátě tohoto virtuálního počítače nebo disky povede ke ztrátě sestavy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-197">Loss of this VM or disks will lead to the loss of the reports.</span></span> <span data-ttu-id="8f0df-198">Nicméně je možné spusťte proces vytváření sestav a znovu vygenerovat výstup.</span><span class="sxs-lookup"><span data-stu-id="8f0df-198">However, it may be possible to rerun the reporting process and regenerate the output.</span></span> <span data-ttu-id="8f0df-199">V takovém případě nemáte skutečně ztrátu dat i v případě, že server pro sestavy je dosáhl s po havárii, tak může mít vyšší úroveň tolerance pro ztráty část dat na serveru sestav.</span><span class="sxs-lookup"><span data-stu-id="8f0df-199">In that case, you don’t really have a loss of data even if the reporting server is hit with a disaster, so you could have a higher level of tolerance for losing part of the data on the reporting server.</span></span> <span data-ttu-id="8f0df-200">V takovém případě méně časté zálohování je možnost snížit náklady.</span><span class="sxs-lookup"><span data-stu-id="8f0df-200">In that case, less frequent backups is an option to reduce the cost.</span></span>

### <a name="scenario-4-iaas-application-data-issues"></a><span data-ttu-id="8f0df-201">Scénář 4: Aplikace IaaS dat problémy</span><span class="sxs-lookup"><span data-stu-id="8f0df-201">Scenario 4: IaaS Application data issues</span></span>

<span data-ttu-id="8f0df-202">Máte aplikaci, která vypočítá, udržuje a slouží důležitá obchodní data, například informace o cenách.</span><span class="sxs-lookup"><span data-stu-id="8f0df-202">You have an application that computes, maintains, and serves critical commercial data such as pricing information.</span></span> <span data-ttu-id="8f0df-203">Nová verze aplikace měla chyb softwaru, který nesprávně počítaný cenách a poškozený stávající data a obchodu Spojených států obsloužených platformu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-203">A new version of your application had a software bug which incorrectly computed the pricing and corrupted the existing commerce data served by the platform.</span></span> <span data-ttu-id="8f0df-204">Nejlepším řešením zde, je nejprve vrátit na předchozí verzi aplikace a data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-204">Here, the best course of action would be to revert to the earlier version of the application and the data first.</span></span> <span data-ttu-id="8f0df-205">Chcete-li povolit, trvat pravidelné zálohy systému.</span><span class="sxs-lookup"><span data-stu-id="8f0df-205">To enable this, take periodic backups of your system.</span></span>

## <a name="disaster-recovery-solution-azure-backup-service"></a><span data-ttu-id="8f0df-206">Řešení zotavení po havárii: Služba Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-206">Disaster Recovery Solution: Azure Backup Service</span></span>

<span data-ttu-id="8f0df-207">[Služba Azure Backup](https://azure.microsoft.com/services/backup/) je lze použít pro zálohování a zotavení po Havárii a funguje s [spravované disky](../../virtual-machines/windows/managed-disks-overview.md) a také [nespravované disky](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span><span class="sxs-lookup"><span data-stu-id="8f0df-207">[Azure Backup Service](https://azure.microsoft.com/services/backup/) is can be used for Backup and DR, and it works with [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md) as well as [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks).</span></span> <span data-ttu-id="8f0df-208">Můžete vytvořit úlohu zálohování s zálohy založené na čase, snadno obnovení virtuálních počítačů a zásady uchovávání záloh.</span><span class="sxs-lookup"><span data-stu-id="8f0df-208">You can create a backup job with time-based backups, easy VM restoration and backup retention policies.</span></span> 

<span data-ttu-id="8f0df-209">Pokud používáte [disky úložiště Premium](storage-premium-storage.md), [spravované disky](../../virtual-machines/windows/managed-disks-overview.md), nebo jiných typů disku s [místně redundantní úložiště (LRS)](storage-redundancy.md#locally-redundant-storage) možnost, je velmi důležité využít pravidelné zálohy zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-209">If you use [Premium Storage disks](storage-premium-storage.md), [Managed Disks](../../virtual-machines/windows/managed-disks-overview.md), or other disk types with the [locally redundant storage (LRS)](storage-redundancy.md#locally-redundant-storage) option, it is especially important to leverage periodic DR backups.</span></span> <span data-ttu-id="8f0df-210">Zálohování Azure ukládá data do trezoru služeb zotavení pro dlouhodobé uchovávání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-210">Azure Backup stores the data in your Recovery Services vault for long term retention.</span></span> <span data-ttu-id="8f0df-211">Vyberte [geograficky redundantní úložiště (GRS)](storage-redundancy.md#geo-redundant-storage) možnost pro trezor služeb zotavení zálohování.</span><span class="sxs-lookup"><span data-stu-id="8f0df-211">Choose the [Geo-redundant storage (GRS)](storage-redundancy.md#geo-redundant-storage) option for the Backup Recovery Services vault.</span></span> <span data-ttu-id="8f0df-212">Který bude zajištěno, aby zálohování se replikují do jiné oblasti Azure pro zabezpečení z místní havárie.</span><span class="sxs-lookup"><span data-stu-id="8f0df-212">That will ensure backups are replicated to a different Azure region for safeguarding from regional disasters.</span></span>

<span data-ttu-id="8f0df-213">Pro [nespravované disky](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), můžete použít typ úložiště LRS disků IaaS, ale ujistěte se, že Azure Backup je povolena možnost GRS pro trezor služeb zotavení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-213">For [Unmanaged Disks](../../virtual-machines/windows/about-disks-and-vhds.md#unmanaged-disks), you can use the LRS storage type for IaaS disks, but ensure that Azure Backup is enabled with the GRS option for the Recovery Services Vault.</span></span>

<span data-ttu-id="8f0df-214">**Pokud použijete [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) možnost pro nespravovaná disky, je stále nutné snímky konzistentní s aplikacemi pro zálohování a zotavení po Havárii.**</span><span class="sxs-lookup"><span data-stu-id="8f0df-214">**If you use the [GRS](storage-redundancy.md#geo-redundant-storage)/[RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage) option for your Unmanaged Disks, you still need consistent snapshots for Backup and DR.**</span></span> <span data-ttu-id="8f0df-215">Je nutné použít buď [služby zálohování Azure](https://azure.microsoft.com/services/backup/) nebo [snímky konzistentní](#alternative-solution-consistent-snapshots).</span><span class="sxs-lookup"><span data-stu-id="8f0df-215">You must use either [Azure Backup Service](https://azure.microsoft.com/services/backup/) or [consistent snapshots](#alternative-solution-consistent-snapshots).</span></span>

<span data-ttu-id="8f0df-216">Zde je souhrn řešení pro zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-216">The following is a summary of solutions for DR.</span></span>

| <span data-ttu-id="8f0df-217">Scénář</span><span class="sxs-lookup"><span data-stu-id="8f0df-217">Scenario</span></span> | <span data-ttu-id="8f0df-218">Automatické replikace</span><span class="sxs-lookup"><span data-stu-id="8f0df-218">Automatic Replication</span></span> | <span data-ttu-id="8f0df-219">Řešení zotavení po Havárii</span><span class="sxs-lookup"><span data-stu-id="8f0df-219">DR Solution</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8f0df-220">*Disky úložiště Premium*</span><span class="sxs-lookup"><span data-stu-id="8f0df-220">*Premium Storage Disks*</span></span> | <span data-ttu-id="8f0df-221">Místní ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="8f0df-221">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="8f0df-222">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-222">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="8f0df-223">*Managed Disks*</span><span class="sxs-lookup"><span data-stu-id="8f0df-223">*Managed Disks*</span></span> | <span data-ttu-id="8f0df-224">Místní ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="8f0df-224">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="8f0df-225">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-225">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="8f0df-226">*Nespravované LRS disky*</span><span class="sxs-lookup"><span data-stu-id="8f0df-226">*Unmanaged LRS Disks*</span></span> | <span data-ttu-id="8f0df-227">Místní ([LRS](storage-redundancy.md#locally-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="8f0df-227">Local ([LRS](storage-redundancy.md#locally-redundant-storage))</span></span> | [<span data-ttu-id="8f0df-228">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-228">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/) |
| <span data-ttu-id="8f0df-229">*Nespravované GRS disky*</span><span class="sxs-lookup"><span data-stu-id="8f0df-229">*Unmanaged GRS Disks*</span></span> | <span data-ttu-id="8f0df-230">Pro různé oblasti ([GRS](storage-redundancy.md#geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="8f0df-230">Cross region ([GRS](storage-redundancy.md#geo-redundant-storage))</span></span> | [<span data-ttu-id="8f0df-231">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-231">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="8f0df-232">Snímky konzistentní s aplikacemi</span><span class="sxs-lookup"><span data-stu-id="8f0df-232">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |
| <span data-ttu-id="8f0df-233">*Nespravované RA-GRS disky*</span><span class="sxs-lookup"><span data-stu-id="8f0df-233">*Unmanaged RA-GRS Disks*</span></span> | <span data-ttu-id="8f0df-234">Pro různé oblasti ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span><span class="sxs-lookup"><span data-stu-id="8f0df-234">Cross region ([RA-GRS](storage-redundancy.md#read-access-geo-redundant-storage))</span></span> | [<span data-ttu-id="8f0df-235">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-235">Azure Backup</span></span>](https://azure.microsoft.com/services/backup/)<br/>[<span data-ttu-id="8f0df-236">Snímky konzistentní s aplikacemi</span><span class="sxs-lookup"><span data-stu-id="8f0df-236">Consistent snapshots</span></span>](#alternative-solution-consistent-snapshots) |

<span data-ttu-id="8f0df-237">Zajištění vysoké dostupnosti můžete nejlépe pomocí splní prostřednictvím používat spravované disky v skupiny dostupnosti společně s Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="8f0df-237">High availability can best by met through the use of Managed Disks in an Availability Set along with Azure Backup.</span></span> <span data-ttu-id="8f0df-238">Pokud používáte nespravované disky, stále můžete zálohování Azure pro zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-238">If you are using Unmanaged Disks, you can still  use Azure Backup for DR.</span></span> <span data-ttu-id="8f0df-239">Pokud není možné používat Azure Backup, pak trvá [snímky konzistentní](#alternative-solution-consistent-snapshots) jak je popsáno v další části je alternativní řešení pro zálohování a zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-239">If you are unable to use Azure Backup, then taking [consistent snapshots](#alternative-solution-consistent-snapshots) as described in a later section is an alternative solution for Backup and DR.</span></span>

<span data-ttu-id="8f0df-240">Vaše volby pro vysokou dostupnost, zálohování a zotavení po Havárii aplikace nebo infrastruktury úrovni může být reprezentován jako níže:</span><span class="sxs-lookup"><span data-stu-id="8f0df-240">Your choices for high availability, backup and DR at Application or Infrastructure levels can be represented as below:</span></span>

| <span data-ttu-id="8f0df-241">*Úroveň*</span><span class="sxs-lookup"><span data-stu-id="8f0df-241">*Level*</span></span> | <span data-ttu-id="8f0df-242">Vysoká dostupnost</span><span class="sxs-lookup"><span data-stu-id="8f0df-242">High Availability</span></span>   | <span data-ttu-id="8f0df-243">Zálohování nebo zotavení po Havárii</span><span class="sxs-lookup"><span data-stu-id="8f0df-243">Backup / DR</span></span> |
| --- | --- | --- |
| <span data-ttu-id="8f0df-244">*Aplikace*</span><span class="sxs-lookup"><span data-stu-id="8f0df-244">*Application*</span></span> | <span data-ttu-id="8f0df-245">Always On SQL</span><span class="sxs-lookup"><span data-stu-id="8f0df-245">SQL Always On</span></span> | <span data-ttu-id="8f0df-246">Azure Backup</span><span class="sxs-lookup"><span data-stu-id="8f0df-246">Azure Backup</span></span> |
| <span data-ttu-id="8f0df-247">*Infrastruktury*</span><span class="sxs-lookup"><span data-stu-id="8f0df-247">*Infrastructure*</span></span>  | <span data-ttu-id="8f0df-248">Skupina dostupnosti</span><span class="sxs-lookup"><span data-stu-id="8f0df-248">Availability Set</span></span>  | <span data-ttu-id="8f0df-249">GRS s snímky konzistentní s aplikacemi</span><span class="sxs-lookup"><span data-stu-id="8f0df-249">GRS with consistent snapshots</span></span> |

### <a name="using-the-azure-backup-service"></a><span data-ttu-id="8f0df-250">Pomocí služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="8f0df-250">Using the Azure Backup Service</span></span>

<span data-ttu-id="8f0df-251">[Zálohování Azure](../../backup/backup-azure-vms-introduction.md) může zálohovat virtuální počítače s Windows nebo Linuxem do trezoru služeb zotavení Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0df-251">[Azure Backup](../../backup/backup-azure-vms-introduction.md) can backup your VMs running Windows or Linux to the Azure Recovery Services Vault.</span></span> <span data-ttu-id="8f0df-252">Zálohování a obnovení důležitých podnikových dat ztěžuje skutečnost, že důležitých podnikových dat je třeba zálohovat v době spuštění aplikace, které produkují data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-252">Backing up and restoring business-critical data is complicated by the fact that business-critical data must be backed up while the applications that produce the data are running.</span></span> <span data-ttu-id="8f0df-253">Chcete-li vyřešit tím, Azure Backup poskytuje zálohování konzistentní s aplikací pro úlohy Microsoftu pomocí služby Stínová svazku (VSS) k zajištění, že je správně zapisovat data do úložiště.</span><span class="sxs-lookup"><span data-stu-id="8f0df-253">To address this, Azure Backup provides application-consistent backups for Microsoft workloads by using the Volume Shadow Service (VSS) to ensure that data is written correctly to storage.</span></span> <span data-ttu-id="8f0df-254">Pro virtuální počítače s Linuxem je možné, pouze konzistentními soubory zálohy, protože Linux nemá funkce odpovídající VSS.</span><span class="sxs-lookup"><span data-stu-id="8f0df-254">For Linux VMs, only file-consistent backups are possible, since Linux does not have functionality equivalent to VSS.</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-1.png)   

<span data-ttu-id="8f0df-255">Spustí úlohu zálohování Azure Backup v naplánovaném čase spustí rozšíření zálohování nainstalovaná ve virtuálním počítači k pořízení snímku v daném okamžiku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-255">When Azure Backup initiates a backup job at the scheduled time, it triggers the backup extension installed in the VM to take a point-in-time snapshot.</span></span> <span data-ttu-id="8f0df-256">Snímek se provede v koordinaci s VSS získat konzistentního snímku disků ve virtuálním počítači bez nutnosti ho vypnout.</span><span class="sxs-lookup"><span data-stu-id="8f0df-256">A snapshot is taken in coordination with VSS to get a consistent snapshot of the disks in the virtual machine without having to shut it down.</span></span> <span data-ttu-id="8f0df-257">Rozšíření zálohování ve virtuálním počítači vyprázdnění všech zápisů před přepnutím konzistentní snímek všechny disky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-257">The backup extension in the VM flushes all writes before taking the consistent snapshot of all the disks.</span></span> <span data-ttu-id="8f0df-258">Po pořízení snímku, data se přenáší přes Azure Backup do trezoru záloh.</span><span class="sxs-lookup"><span data-stu-id="8f0df-258">After the snapshot is taken, the data is transferred by Azure Backup to the backup vault.</span></span> <span data-ttu-id="8f0df-259">Chcete-li proces zálohování efektivnější, služba identifikuje a přenáší pouze bloky dat, které se změnily od poslední zálohy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-259">To make the backup process more efficient, the service identifies and transfers only the blocks of data that have changed since the last backup.</span></span>


<span data-ttu-id="8f0df-260">Pokud chcete obnovit, můžete zobrazit dostupné zálohy pomocí zálohování Azure a poté zahájit obnovení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-260">To restore, you can view the available backups through Azure Backup and then initiate a restore.</span></span> <span data-ttu-id="8f0df-261">Můžete vytvořit a obnovit zálohování Azure prostřednictvím [portál Azure](https://portal.azure.com/), [pomocí prostředí PowerShell](../../backup/backup-azure-vms-automation.md ), nebo pomocí [rozhraní příkazového řádku Azure](https://docs.microsoft.com/azure/xplat-cli-install).</span><span class="sxs-lookup"><span data-stu-id="8f0df-261">You can create and restore Azure backups through the [Azure portal](https://portal.azure.com/), [using PowerShell](../../backup/backup-azure-vms-automation.md ), or using the [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install).</span></span> <span data-ttu-id="8f0df-262">Další informace najdete v tématu Zálohování Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0df-262">For more information, see Azure Backup.</span></span>

### <a name="steps-to-enable-backup"></a><span data-ttu-id="8f0df-263">Postup povolení zálohování</span><span class="sxs-lookup"><span data-stu-id="8f0df-263">Steps to Enable Backup</span></span>

<span data-ttu-id="8f0df-264">Následující kroky jsou obvykle používány k povolení zálohování virtuálních počítačů pomocí [portálu Azure](https://portal.azure.com/).</span><span class="sxs-lookup"><span data-stu-id="8f0df-264">The following steps are typically used to enable backups of your VMs using the [Azure Portal](https://portal.azure.com/).</span></span> <span data-ttu-id="8f0df-265">Bude existovat několik odchylek v závislosti na přesný scénář.</span><span class="sxs-lookup"><span data-stu-id="8f0df-265">There will be some variations depending on your exact scenario.</span></span> <span data-ttu-id="8f0df-266">Odkazovat [Azure Backup](../../backup/backup-azure-vms-introduction.md) dokumentace pro úplné podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-266">Refer to the [Azure Backup](../../backup/backup-azure-vms-introduction.md) documentation for full details.</span></span> <span data-ttu-id="8f0df-267">Azure také zálohování [podporuje virtuální počítače s spravované disky](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span><span class="sxs-lookup"><span data-stu-id="8f0df-267">Azure Backup also [supports VMs with Managed Disks](https://azure.microsoft.com/blog/azure-managed-disk-backup/).</span></span>

1.  <span data-ttu-id="8f0df-268">Vytvoření trezoru služeb zotavení pro virtuální počítač pomocí následujících kroků:</span><span class="sxs-lookup"><span data-stu-id="8f0df-268">Create a recovery services vault for a VM using the following steps:</span></span>

    <span data-ttu-id="8f0df-269">a.</span><span class="sxs-lookup"><span data-stu-id="8f0df-269">a.</span></span>  <span data-ttu-id="8f0df-270">Pomocí [portál Azure](https://portal.azure.com/), procházet všechny prostředky a vyhledávat "Trezory služeb zotavení".</span><span class="sxs-lookup"><span data-stu-id="8f0df-270">Using the [Azure portal](https://portal.azure.com/), browse all resources and find “Recovery Services vaults”.</span></span>

    <span data-ttu-id="8f0df-271">b.</span><span class="sxs-lookup"><span data-stu-id="8f0df-271">b.</span></span>  <span data-ttu-id="8f0df-272">V nabídce trezory služeb zotavení klikněte na tlačítko Přidat a postupujte podle kroků pro vytvoření nového trezoru ve stejné oblasti jako virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-272">On the Recovery Services vaults menu, click Add and follow the steps to create a new vault in the same region as the VM.</span></span> <span data-ttu-id="8f0df-273">Například pokud vaše virtuální počítač v oblasti západní USA, vyberte západní USA trezoru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-273">For example, if your VM is in West US region, pick West US for the vault.</span></span>

2.  <span data-ttu-id="8f0df-274">Ověření úložiště replikace pro nově vytvořený trezor.</span><span class="sxs-lookup"><span data-stu-id="8f0df-274">Verify the Storage replication for the newly created vault.</span></span> <span data-ttu-id="8f0df-275">K tomu, přístup k úložišti z okna trezory služeb zotavení a přejděte do nastavení nebo zálohu konfigurace.</span><span class="sxs-lookup"><span data-stu-id="8f0df-275">To do this, access the vault from the Recovery Services vaults blade and go to the settings/Backup Configuration.</span></span> <span data-ttu-id="8f0df-276">Zkontrolujte, zda že je vybrána možnost GRS ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-276">Ensure the GRS option is selected by default.</span></span> <span data-ttu-id="8f0df-277">Tím bude zajištěno, že váš trezor je automaticky replikovat do sekundárního datového centra.</span><span class="sxs-lookup"><span data-stu-id="8f0df-277">This will ensure that your vault is automatically replicated to a secondary data center.</span></span> <span data-ttu-id="8f0df-278">Například trezoru v západní USA bude automaticky replikován východní USA.</span><span class="sxs-lookup"><span data-stu-id="8f0df-278">For example, your vault in West US will be automatically replicated to East US.</span></span>

3.  <span data-ttu-id="8f0df-279">Nakonfigurujte zásady zálohování a vyberte virtuální počítač ze stejné uživatelské rozhraní.</span><span class="sxs-lookup"><span data-stu-id="8f0df-279">Configure the backup policy and select the VM from the same UI.</span></span>

4.  <span data-ttu-id="8f0df-280">Zkontrolujte, zda že je nainstalovaný na Virtuálním počítači agenta zálohování.</span><span class="sxs-lookup"><span data-stu-id="8f0df-280">Make sure the Backup Agent is installed on the VM.</span></span> <span data-ttu-id="8f0df-281">Pokud váš virtuální počítač je vytvořen pomocí image Galerie Azure, agenta zálohování již nainstalována.</span><span class="sxs-lookup"><span data-stu-id="8f0df-281">If your VM is created using an Azure gallery image, then the Backup agent is already installed.</span></span> <span data-ttu-id="8f0df-282">Jinak (tj. Pokud používáte vlastní image), použijte pokyny k [nainstalujte agenta virtuálního počítače na virtuálním počítači](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span><span class="sxs-lookup"><span data-stu-id="8f0df-282">Otherwise (that is, if you are using a custom image), use instructions to [Install the VM Agent on the virtual machine](../../backup/backup-azure-arm-vms-prepare.md#install-the-vm-agent-on-the-virtual-machine).</span></span>

5.  <span data-ttu-id="8f0df-283">Ujistěte se, že virtuální počítač umožňuje připojení k síti pro službu zálohování funkce.</span><span class="sxs-lookup"><span data-stu-id="8f0df-283">Make sure that the VM allows network connectivity for the backup service to function.</span></span> <span data-ttu-id="8f0df-284">Postupujte podle těchto pokynů pro [připojení k síti](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span><span class="sxs-lookup"><span data-stu-id="8f0df-284">Follow these instructions for [Network connectivity](../../backup/backup-azure-arm-vms-prepare.md#network-connectivity).</span></span>

6.  <span data-ttu-id="8f0df-285">Po dokončení výše uvedené kroky, zálohování se spustí v pravidelných intervalech podle zásady zálohování.</span><span class="sxs-lookup"><span data-stu-id="8f0df-285">Once the above steps are completed, the backup will run at regular intervals as specified in the backup policy.</span></span> <span data-ttu-id="8f0df-286">V případě potřeby můžete aktivovat první zálohy ručně na řídicím panelu trezoru na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="8f0df-286">If necessary, you can trigger the first backup manually from the vault dashboard on the Azure portal.</span></span>

<span data-ttu-id="8f0df-287">Automatizace Azure Backup pomocí skriptů, naleznete v [rutiny prostředí PowerShell pro zálohování virtuálních počítačů](../../backup/backup-azure-vms-automation.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-287">For automating Azure Backup using scripts, please refer to [PowerShell cmdlets for VM backup](../../backup/backup-azure-vms-automation.md).</span></span>

### <a name="steps-for-recovery"></a><span data-ttu-id="8f0df-288">Kroky pro obnovení</span><span class="sxs-lookup"><span data-stu-id="8f0df-288">Steps for Recovery</span></span>

<span data-ttu-id="8f0df-289">Pokud potřebujete opravit nebo znovu vytvořit virtuální počítač, můžete obnovit virtuální počítač z jakýchkoli bodů obnovení záloh v trezoru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-289">If you need to repair or rebuild a VM, you can restore the VM from any of the backup recovery points in the vault.</span></span> <span data-ttu-id="8f0df-290">Existuje několik různých možností při provedení obnovení:</span><span class="sxs-lookup"><span data-stu-id="8f0df-290">There are a couple of different options for performing the recovery:</span></span>

1.  <span data-ttu-id="8f0df-291">Můžete vytvořit nový virtuální počítač jako reprezentace v okamžiku zálohy virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="8f0df-291">You can create a new VM as a point-in-time representation of your backed-up VM.</span></span>

2.  <span data-ttu-id="8f0df-292">Můžete obnovit disky a potom pomocí této šablony virtuálního počítače upravit a znovu vytvořit obnovený virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-292">You can restore the disks and then use the template for the VM to customize and rebuild the restored VM.</span></span> 

<span data-ttu-id="8f0df-293">Zobrazí pokyny k [portálu Azure použijte k obnovení virtuálních počítačů](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span><span class="sxs-lookup"><span data-stu-id="8f0df-293">See instructions to [Use Azure portal to restore virtual machines](../../backup/backup-azure-arm-restore-vms.md#restoring-a-vm-during-azure-datacenter-disaster).</span></span> <span data-ttu-id="8f0df-294">Dokument taky vysvětluje konkrétní kroky pro obnovení zálohy virtuálních počítačů do spárované datového centra pomocí geograficky redundantní úložiště záloh, v případě havárie v primárním datovém centru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-294">The document also explains the specific steps for restoring backed-up VMs to the paired data center using your geo-redundant backup vault in the case of a disaster at the primary data center.</span></span> <span data-ttu-id="8f0df-295">V takovém případě Azure Backup používá výpočetní služba ze sekundární oblasti k vytvoření obnovený virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-295">In that case, Azure Backup uses the Compute service from the secondary region to create the restored virtual machine.</span></span>

<span data-ttu-id="8f0df-296">Můžete také pomocí prostředí PowerShell pro [obnovení virtuálního počítače](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) nebo [vytváření nového virtuálního počítače z obnovit disky](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span><span class="sxs-lookup"><span data-stu-id="8f0df-296">You can also use PowerShell for [restoring a VM](../../backup/backup-azure-vms-automation.md#restore-an-azure-vm) or for [creating a new VM from restored disks](../../backup/backup-azure-vms-automation.md#create-a-vm-from-restored-disks).</span></span>

## <a name="alternative-solution-consistent-snapshots"></a><span data-ttu-id="8f0df-297">Alternativní řešení: Snímky konzistentní</span><span class="sxs-lookup"><span data-stu-id="8f0df-297">Alternative Solution: Consistent Snapshots</span></span>

<span data-ttu-id="8f0df-298">Pokud není možné pomocí služby zálohování Azure, můžete implementovat vlastní zálohovací mechanismus, pomocí snímků.</span><span class="sxs-lookup"><span data-stu-id="8f0df-298">If you are unable to use the Azure Backup Service, you can implement your own backup mechanism using snapshots.</span></span> <span data-ttu-id="8f0df-299">Je složité vytvořit snímky konzistentní s aplikacemi pro všechny disky používané Virtuálním počítačem a tyto snímky se pak replikují do jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-299">It is complicated to create consistent snapshots for all disks used by a VM and then replicate those snapshots to another region.</span></span> <span data-ttu-id="8f0df-300">Z tohoto důvodu Azure zvažuje využívání služby zálohování vhodnější než vytváření vlastní řešení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-300">For this reason, Azure considers leveraging the Backup Service a better option than building a custom solution.</span></span> <span data-ttu-id="8f0df-301">Pokud používáte RA-GRS nebo GRS úložiště pro disky, snímky jsou automaticky replikovat do sekundárního datového centra.</span><span class="sxs-lookup"><span data-stu-id="8f0df-301">If you use RA-GRS/GRS storage for disks, snapshots are automatically replicated to a secondary data center.</span></span> <span data-ttu-id="8f0df-302">Pokud používáte LRS úložiště pro disky, musíte replikovat data.</span><span class="sxs-lookup"><span data-stu-id="8f0df-302">If you use LRS storage for disks, you will need to replicate the data yourself.</span></span> <span data-ttu-id="8f0df-303">Další informace najdete v tématu [zálohování Azure nespravované disky virtuálních počítačů s přírůstkové snímky](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-303">For more information, see [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

<span data-ttu-id="8f0df-304">Snímek je reprezentace objektu v určitém bodě v čase.</span><span class="sxs-lookup"><span data-stu-id="8f0df-304">A snapshot is a representation of an object at a specific point in time.</span></span> <span data-ttu-id="8f0df-305">Snímek zpoplatněná fakturace pro přírůstkové velikost dat je blokování.</span><span class="sxs-lookup"><span data-stu-id="8f0df-305">A snapshot will incur billing for the incremental size of the data it holds.</span></span> <span data-ttu-id="8f0df-306">Další informace najdete v tématu [vytvoření snímku blob](../blobs/storage-blob-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-306">For more information, see [Create a blob snapshot](../blobs/storage-blob-snapshots.md).</span></span>

### <a name="creating-snapshots-while-the-vm-is-running"></a><span data-ttu-id="8f0df-307">Vytváření snímků spuštěného virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="8f0df-307">Creating snapshots while the VM is running</span></span>

<span data-ttu-id="8f0df-308">Když v každém okamžiku může pořízení snímku, pokud je virtuální počítač spuštěný, je stále data vysílá na discích a snímky může obsahovat částečné operace, které byly v cestě.</span><span class="sxs-lookup"><span data-stu-id="8f0df-308">While you can take a snapshot at any time, if the VM is running, there is still data being streamed to the disks, and the snapshots may contain partial operations that were in flight.</span></span> <span data-ttu-id="8f0df-309">Navíc pokud existují několik disků související se situací, snímky různých disků mohlo dojít v různou dobu, což znamená, že tyto snímky nemusí být koordinované.</span><span class="sxs-lookup"><span data-stu-id="8f0df-309">Also, if there are several disks involved, the snapshots of different disks may have occurred at different times, which means these snapshots may not be coordinated.</span></span> <span data-ttu-id="8f0df-310">To je obzvláště problematické pro prokládané svazky, jejichž souborů může být poškozená, pokud se během zálohování provedeny změny.</span><span class="sxs-lookup"><span data-stu-id="8f0df-310">This is especially problematic for striped volumes whose files can be corrupted if changes were being made during backup.</span></span>

<span data-ttu-id="8f0df-311">Abyste předešli této situaci, proces zálohování musí implementovat následující kroky:</span><span class="sxs-lookup"><span data-stu-id="8f0df-311">To avoid this situation, the backup process must implement the following steps:</span></span>

1.  <span data-ttu-id="8f0df-312">Freeze – všechny disky</span><span class="sxs-lookup"><span data-stu-id="8f0df-312">Freeze all the disks</span></span>

2.  <span data-ttu-id="8f0df-313">Vyprázdnění všech zápisů čekající na vyřízení</span><span class="sxs-lookup"><span data-stu-id="8f0df-313">Flush all the pending writes</span></span>

3.  <span data-ttu-id="8f0df-314">Potom [vytvoření snímku blob](../blobs/storage-blob-snapshots.md) pro všechny disky</span><span class="sxs-lookup"><span data-stu-id="8f0df-314">Then, [create a blob snapshot](../blobs/storage-blob-snapshots.md) for all the disks</span></span>

<span data-ttu-id="8f0df-315">Některé aplikace systému Windows, jako je SQL Server poskytují mechanismus koordinované zálohování pomocí služby Stínová kopie svazku pro vytvoření zálohování konzistentní s aplikací.</span><span class="sxs-lookup"><span data-stu-id="8f0df-315">Some Windows applications like SQL Server provide a coordinated backup mechanism via VSS to create application-consistent backups.</span></span> <span data-ttu-id="8f0df-316">V systému Linux můžete použít nástroje, jako je fsfreeze pro spolupráci disky, které zajistí konzistentními soubory zálohy, ale není snímky konzistentní s aplikacemi.</span><span class="sxs-lookup"><span data-stu-id="8f0df-316">On Linux, you can use a tool like fsfreeze for coordinating the disks, which will provide file-consistent backups, but not application-consistent snapshots.</span></span> <span data-ttu-id="8f0df-317">Tento proces je složitá, takže a měli byste zvážit použití [Azure Backup](../../backup/backup-azure-vms-introduction.md) nebo řešení zálohování jiného výrobce, který už tuto funkci implementovat.</span><span class="sxs-lookup"><span data-stu-id="8f0df-317">This process is complicated, so and you should consider using [Azure Backup](../../backup/backup-azure-vms-introduction.md) or a third-party backup solution which already implement this.</span></span>

<span data-ttu-id="8f0df-318">Proces výše způsobí kolekce koordinované snímků pro všechny disky virtuálních počítačů, představující konkrétní zobrazení v okamžiku virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="8f0df-318">The above process will result in a collection of coordinated snapshots for all the VM disks, representing a specific point-in-time view of the VM.</span></span> <span data-ttu-id="8f0df-319">Toto je bod obnovení zálohy pro virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-319">This is a backup restore point for the VM.</span></span> <span data-ttu-id="8f0df-320">Proces lze opakovat v naplánovaných intervalech k vytvoření pravidelné zálohy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-320">You can repeat the process at scheduled intervals to create periodic backups.</span></span> <span data-ttu-id="8f0df-321">Níže najdete postup [zkopírujte zálohy do jiné oblasti](#copy-the-snapshots-to-another-region) pro zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-321">See below for the steps to [copy the backups to another region](#copy-the-snapshots-to-another-region) for DR.</span></span>

### <a name="creating-snapshots-while-the-vm-is-offline"></a><span data-ttu-id="8f0df-322">Vytváření snímků při offline virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="8f0df-322">Creating snapshots while the VM is offline</span></span>

<span data-ttu-id="8f0df-323">Další možnost vytvářet konzistentní zálohy je vypnutí virtuálního počítače a přepnutím blob snímky každého disku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-323">Another option to create consistent backups is shutting down the VM and taking blob snapshots of each disk.</span></span> <span data-ttu-id="8f0df-324">Toto je jednodušší než koordinující snímky spuštění virtuálního počítače, ale vyžaduje to pár minut nečinnosti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-324">This is easier than coordinating snapshots of a running VM, but it requires a few minutes of downtime.</span></span> <span data-ttu-id="8f0df-325">Pro tento proces postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="8f0df-325">For this process, follow these steps:</span></span>

1. <span data-ttu-id="8f0df-326">Vypněte virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-326">Shut down the VM.</span></span>

2. <span data-ttu-id="8f0df-327">Vytvoření snímku každý objekt blob virtuálního pevného disku, který přebírá jenom pár sekund.</span><span class="sxs-lookup"><span data-stu-id="8f0df-327">Create a snapshot of each VHD blob, which only takes a few seconds.</span></span>

    <span data-ttu-id="8f0df-328">Pro vytvoření snímku, můžete použít [prostředí PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), [Rest API pro Azure Storage](https://msdn.microsoft.com/library/azure/ee691971.aspx), [rozhraní příkazového řádku Azure](https://docs.microsoft.com/azure/xplat-cli-install), nebo jeden z knihovny klienta úložiště Azure, jako [Klientská knihovna pro úložiště pro .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span><span class="sxs-lookup"><span data-stu-id="8f0df-328">To create a snapshot, you can use [PowerShell](storage-powershell-guide-full.md#how-to-manage-azure-blob-snapshots), the [Azure Storage Rest API](https://msdn.microsoft.com/library/azure/ee691971.aspx), [Azure CLI](https://docs.microsoft.com/azure/xplat-cli-install), or one of the Azure Storage Client Libraries such as [the Storage client library for .NET](https://msdn.microsoft.com/library/azure/hh488361.aspx).</span></span>

3. <span data-ttu-id="8f0df-329">Spusťte virtuální počítač, který končí výpadek.</span><span class="sxs-lookup"><span data-stu-id="8f0df-329">Start the VM, which ends the downtime.</span></span> <span data-ttu-id="8f0df-330">Obvykle se celý proces dokončení během několika minut.</span><span class="sxs-lookup"><span data-stu-id="8f0df-330">Typically the entire process completes within a few minutes.</span></span>

<span data-ttu-id="8f0df-331">Tento proces vypočítá kolekce snímky konzistentní s aplikacemi pro všechny disky, poskytuje bod obnovení zálohy pro virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="8f0df-331">This process yields a collection of consistent snapshots for all the disks, providing a backup restore point for the VM.</span></span> <span data-ttu-id="8f0df-332">Níže najdete pokyny pro zkopírování snímky jiné oblasti pro zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-332">See below for the steps to copy the snapshots to another region for DR.</span></span>

### <a name="copy-the-snapshots-to-another-region"></a><span data-ttu-id="8f0df-333">Zkopírujte snímky do jiné oblasti</span><span class="sxs-lookup"><span data-stu-id="8f0df-333">Copy the snapshots to another region</span></span>

<span data-ttu-id="8f0df-334">Vytváření snímků samostatně nemusí dostačovat pro zotavení po Havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-334">Creation of the snapshots alone may not be sufficient for DR.</span></span> <span data-ttu-id="8f0df-335">Zálohy snímků musí také replikovat do jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-335">You must also replicate the snapshot backups to another region.</span></span>

<span data-ttu-id="8f0df-336">Pokud používáte GRS nebo RA-GRS pro disky, snímky jsou replikovat do sekundární oblasti automaticky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-336">If you are using GRS or RA-GRS for your disks, then the snapshots are replicated to the secondary region automatically.</span></span> <span data-ttu-id="8f0df-337">Může být několik minut prodlevy před replikace a pokud primární datové centrum ocitne mimo provoz, než snímky dokončit replikace, nebudete mít přístup k snímky ze sekundárního datového centra.</span><span class="sxs-lookup"><span data-stu-id="8f0df-337">There can be a few minutes of lag before the replication, and if the primary data center goes down before the snapshots finish replicating, you will not be able to access the snapshots from the secondary data center.</span></span> <span data-ttu-id="8f0df-338">Pravděpodobnost, že to je malá.</span><span class="sxs-lookup"><span data-stu-id="8f0df-338">The likelihood of this is small.</span></span>

> [!Note] 
> <span data-ttu-id="8f0df-339">Jenom s disky ve GRS nebo RA-GRS účet nechrání virtuálního počítače z havárie.</span><span class="sxs-lookup"><span data-stu-id="8f0df-339">Only having the disks in a GRS or RA-GRS account does not protect the VM from disasters.</span></span> <span data-ttu-id="8f0df-340">Také musíte vytvořit koordinované snímky nebo používat Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="8f0df-340">You must also create coordinated snapshots or use Azure Backup.</span></span> <span data-ttu-id="8f0df-341">To je potřebné k obnovení virtuálního počítače do konzistentního stavu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-341">This is required to recover a VM to a consistent state.</span></span>

<span data-ttu-id="8f0df-342">Pokud používáte LRS, musíte zkopírovat snímky na jiný účet úložiště ihned po vytvoření snímku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-342">If you are using LRS, you must copy the snapshots to a different storage account immediately after creating the snapshot.</span></span> <span data-ttu-id="8f0df-343">Cíl kopírování může být účet úložiště LRS v jiné oblasti, která výsledkem kopie se ve vzdálené oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-343">The copy target could be an LRS storage account in a different region, resulting in the copy being in a remote region.</span></span> <span data-ttu-id="8f0df-344">Můžete také zkopírovat snímku na účet úložiště RA-GRS ve stejné oblasti.</span><span class="sxs-lookup"><span data-stu-id="8f0df-344">You can also copy the snapshot to an RA-GRS storage account in the same region.</span></span> <span data-ttu-id="8f0df-345">V takovém případě snímku budou líné replikovány vzdálené sekundární oblast.</span><span class="sxs-lookup"><span data-stu-id="8f0df-345">In this case, the snapshot will be lazily replicated to the remote secondary region.</span></span> <span data-ttu-id="8f0df-346">Zálohování je chráněn z havárie v primární lokalitě jednou kopírování a se replikace nedokončí.</span><span class="sxs-lookup"><span data-stu-id="8f0df-346">Your backup is protected from disasters at the primary site once the copying and replication is complete.</span></span>

<span data-ttu-id="8f0df-347">Pokud chcete zkopírovat vaší přírůstkové snímky pro zotavení po Havárii efektivně, zkontrolujte podle pokynů v [zálohování Azure nespravované disky virtuálních počítačů s přírůstkové snímky](../../virtual-machines/windows/incremental-snapshots.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-347">To copy your incremental snapshots for DR efficiently, review the instructions in [Back up Azure unmanaged VM disks with incremental snapshots](../../virtual-machines/windows/incremental-snapshots.md).</span></span>

![](./media/storage-backup-and-disaster-recovery-for-azure-iaas-disks/backup-and-disaster-recovery-for-azure-iaas-disks-2.png)   

### <a name="recovery-from-snapshots"></a><span data-ttu-id="8f0df-348">Obnovení ze snímků</span><span class="sxs-lookup"><span data-stu-id="8f0df-348">Recovery from Snapshots</span></span>

<span data-ttu-id="8f0df-349">Načíst snímek, zkopírujte jej, aby nový objekt blob.</span><span class="sxs-lookup"><span data-stu-id="8f0df-349">To retrieve a snapshot, copy it to make a new blob.</span></span> <span data-ttu-id="8f0df-350">Pokud kopírujete snímek z primární účet, můžete zkopírovat snímku přes na základní objekt blob snímku, proto dynamického disku na snímku; To se označuje jako povýšení snímku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-350">If you are copying the snapshot from the primary account, you can copy the snapshot over to the base blob of the snapshot, thus reverting the disk to the snapshot; this is known as promoting the snapshot.</span></span> <span data-ttu-id="8f0df-351">Pokud kopírujete zálohy snímku pomocí jiného účtu (v případě RA-GRS), se musí zkopírovat primární účet.</span><span class="sxs-lookup"><span data-stu-id="8f0df-351">If you are copying the snapshot backup from a secondary account (in the case of RA-GRS), it must be copied to a primary account.</span></span> <span data-ttu-id="8f0df-352">Můžete zkopírovat snímek [pomocí prostředí PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) nebo pomocí nástroje azcopy.</span><span class="sxs-lookup"><span data-stu-id="8f0df-352">You can copy a snapshot [using PowerShell](storage-powershell-guide-full.md#how-to-copy-a-snapshot-of-a-blob) or using the AzCopy utility.</span></span> <span data-ttu-id="8f0df-353">Další informace najdete v tématu [přenos dat pomocí nástroje příkazového řádku Azcopy](storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-353">For more information, see [Transfer data with the AzCopy Command-Line Utility](storage-use-azcopy.md).</span></span>

<span data-ttu-id="8f0df-354">V případě virtuálních počítačů s více disky musíte zkopírovat všechny snímky, které jsou součástí stejného bodu koordinované obnovení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-354">In the case of VMs with multiple disks, you must copy all the snapshots that are part of the same coordinated restore point.</span></span> <span data-ttu-id="8f0df-355">Po snímky zkopírujete do zapisovatelné BLOB VHD, můžete k opětovnému vytvoření virtuálního počítače pro virtuální počítač pomocí šablony objektů BLOB.</span><span class="sxs-lookup"><span data-stu-id="8f0df-355">Once you copy the snapshots to writable VHD blobs, you can use the blobs to recreate your VM using the template for the VM.</span></span>

## <a name="other-options"></a><span data-ttu-id="8f0df-356">Další možnosti</span><span class="sxs-lookup"><span data-stu-id="8f0df-356">Other options</span></span>

### <a name="sql-server"></a><span data-ttu-id="8f0df-357">SQL Server</span><span class="sxs-lookup"><span data-stu-id="8f0df-357">SQL Server</span></span>

<span data-ttu-id="8f0df-358">SQL Server běžící ve virtuálním počítači má svou vlastní integrované funkce zálohování databáze systému SQL Server do úložiště objektů Blob v Azure nebo sdílené složky.</span><span class="sxs-lookup"><span data-stu-id="8f0df-358">SQL Server running in a VM has its own built-in capabilities to backup your SQL Server database to Azure Blob storage or a file share.</span></span> <span data-ttu-id="8f0df-359">Pokud je účet úložiště GRS nebo RA-GRS, dostanete tyto zálohy v účtu úložiště sekundárního datového centra v případě havárie, s stejná omezení, jak je popsáno dříve.</span><span class="sxs-lookup"><span data-stu-id="8f0df-359">If the storage account is GRS or RA-GRS, you can access those backups in the storage account’s secondary data center in the event of a disaster, with the same restrictions as discussed previously.</span></span> <span data-ttu-id="8f0df-360">Další informace najdete v tématu [zálohování a obnovení pro SQL Server v Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-360">For more information, see [Backup and Restore for SQL Server in Azure Virtual Machines](../../virtual-machines/windows/sql/virtual-machines-windows-sql-backup-recovery.md).</span></span> <span data-ttu-id="8f0df-361">Kromě zálohování a obnovení [SQL serveru skupin dostupnosti Always On](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) můžete udržovat sekundární repliky databází výrazně zkrátit čas obnovení po havárii.</span><span class="sxs-lookup"><span data-stu-id="8f0df-361">In addition to backup and restore, [SQL Server Always On Availability Groups](../../virtual-machines/windows/sql/virtual-machines-windows-sql-high-availability-dr.md) can maintain secondary replicas of databases to greatly reduce the disaster recovery time.</span></span>

## <a name="other-considerations"></a><span data-ttu-id="8f0df-362">Další důležité informace</span><span class="sxs-lookup"><span data-stu-id="8f0df-362">Other considerations</span></span>

<span data-ttu-id="8f0df-363">Tento článek má popsané, jak zálohovat nebo pořizovat snímky virtuálních počítačů a jejich disky k podpoře zotavení po havárii a postup použít k obnovení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-363">This article has discussed how to backup or take snapshots of your VMs and their disks to support disaster recovery, and how to use those to recover.</span></span> <span data-ttu-id="8f0df-364">Spousta lidí s modelem Azure Resource Manager používá šablony v Azure vytvořit jejich virtuální počítače a další infrastrukturou.</span><span class="sxs-lookup"><span data-stu-id="8f0df-364">With the Azure Resource Manager model, many people use templates to create their VMs and other infrastructure in Azure.</span></span> <span data-ttu-id="8f0df-365">Chcete-li vytvořit virtuální počítač, který má stejnou konfiguraci pokaždé, když můžete použít šablonu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-365">You can use a template to create a VM that has the same configuration every time.</span></span> <span data-ttu-id="8f0df-366">Pokud používáte vlastní Image pro vytváření virtuálních počítačů, můžete musí také ujistěte se, že vaše image jsou chráněné pomocí účtu RA-GRS k jejich uložení.</span><span class="sxs-lookup"><span data-stu-id="8f0df-366">If you use custom images for creating your VMs, you must also make sure your images are protected by using an RA-GRS account to store them.</span></span>

<span data-ttu-id="8f0df-367">V důsledku toho procesu zálohování může být kombinací dvě věci:</span><span class="sxs-lookup"><span data-stu-id="8f0df-367">Consequently, your backup process may be a combination of two things:</span></span>

1. <span data-ttu-id="8f0df-368">Zálohování dat (disky)</span><span class="sxs-lookup"><span data-stu-id="8f0df-368">Backup the data (disks)</span></span>
2. <span data-ttu-id="8f0df-369">Zálohování konfigurace (šablony, vlastních bitových kopií)</span><span class="sxs-lookup"><span data-stu-id="8f0df-369">Backup the configuration (templates, custom images)</span></span>

<span data-ttu-id="8f0df-370">V závislosti na možnost zálohování, který zvolíte bude pravděpodobně nutné zpracovat zálohování dat a konfigurace nebo služby zálohování může zpracovávat veškerý který pro vás.</span><span class="sxs-lookup"><span data-stu-id="8f0df-370">Depending on the backup option you choose, you may have to handle the backup of both the data and the configuration, or the backup service may handle all of that for you.</span></span>

## <a name="appendix---understanding-the-impact-of-lrs-grs-and-ra-grs"></a><span data-ttu-id="8f0df-371">Příloha - porozumění vlivu LRS, GRS a RA-GRS</span><span class="sxs-lookup"><span data-stu-id="8f0df-371">Appendix - Understanding the impact of LRS, GRS, and RA-GRS</span></span>

<span data-ttu-id="8f0df-372">Pro účty úložiště v Azure existují tři typy redundanci dat, které byste měli uvažovat o zotavení po havárii – místně redundantní (LRS), geograficky redundantní (GRS), nebo geograficky redundantní s čtení (RA-GRS) přístup.</span><span class="sxs-lookup"><span data-stu-id="8f0df-372">For storage accounts in Azure, there are three types of data redundancy that you should consider regarding disaster recovery – locally redundant (LRS), geo-redundant (GRS), or geo-redundant with read access (RA-GRS).</span></span> 

<span data-ttu-id="8f0df-373">Místně redundantní úložiště (LRS) uchovává tři kopie dat ve stejném datovém centru.</span><span class="sxs-lookup"><span data-stu-id="8f0df-373">Locally Redundant Storage (LRS) retains three copies of the data in the same data center.</span></span> <span data-ttu-id="8f0df-374">Při zápisu dat, jsou aktualizovány všechny tři kopie, před úspěchu je vrácen volajícímu, abyste věděli, že jsou identické.</span><span class="sxs-lookup"><span data-stu-id="8f0df-374">When writing the data, all three copies are updated before success is returned to the caller, so you know they are identical.</span></span> <span data-ttu-id="8f0df-375">Disk je chráněný před místní selhání, protože je to velmi nepravděpodobné, že všechny tři kopie bude mít dopad ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="8f0df-375">Your disk is protected from local failures, since it is extremely unlikely that all three copies would be impacted at the same time.</span></span> <span data-ttu-id="8f0df-376">V případě LRS neexistuje žádný geografická redundance, takže disk není chráněn před závažné chyby, které můžou mít vliv celého datového centra nebo úložiště jednotku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-376">In the case of LRS, there is no geo-redundancy, so the disk is not protected from catastrophic failures that can impact an entire data center or storage unit.</span></span>

<span data-ttu-id="8f0df-377">S GRS a RA-GRS v primární oblasti (vámi zvolené) jsou uchovány tři kopie dat a další tři kopie dat jsou uchovány v odpovídající sekundární oblasti (nastavuje Azure).</span><span class="sxs-lookup"><span data-stu-id="8f0df-377">With GRS and RA-GRS, three copies of your data are retained in the primary region (selected by you), and three more copies of your data are retained in a corresponding secondary region (set by Azure).</span></span> <span data-ttu-id="8f0df-378">Například pokud data uchováváte v západní USA, data se replikují do východní USA.</span><span class="sxs-lookup"><span data-stu-id="8f0df-378">For example, if you store data in West US, the data will be replicated to East US.</span></span> <span data-ttu-id="8f0df-379">To se provádí asynchronně a existuje malé zpoždění mezi aktualizace na primární a sekundární.</span><span class="sxs-lookup"><span data-stu-id="8f0df-379">This is done asynchronously, and there is a small delay between updates to the primary and secondary.</span></span> <span data-ttu-id="8f0df-380">Repliky disků v sekundární lokalitě nejsou konzistentní u jednotlivých disků (s odloženým), ale nemusí být synchronizované repliky více disků active **mezi sebou**.</span><span class="sxs-lookup"><span data-stu-id="8f0df-380">Replicas of the disks on the secondary site are consistent on a per-disk basis (with the delay), but replicas of multiple active disks may not be in sync **with each other**.</span></span> <span data-ttu-id="8f0df-381">Pokud chcete, aby konzistentní repliky na více disků, je potřeba snímky konzistentní.</span><span class="sxs-lookup"><span data-stu-id="8f0df-381">To have consistent replicas across multiple disks, consistent snapshots are needed.</span></span>

<span data-ttu-id="8f0df-382">Hlavní rozdíl mezi GRS a RA-GRS je s RA-GRS, může číst sekundární kopie kdykoli.</span><span class="sxs-lookup"><span data-stu-id="8f0df-382">The main difference between GRS and RA-GRS is that with RA-GRS, you can read the secondary copy at any time.</span></span> <span data-ttu-id="8f0df-383">Pokud dojde k problému, který vykreslí data v primární oblasti nedostupné, tým Azure bude snažit obnovit přístup.</span><span class="sxs-lookup"><span data-stu-id="8f0df-383">If there is a problem that renders the data in the primary region inaccessible, the Azure team will make every effort to restore access.</span></span> <span data-ttu-id="8f0df-384">Zatímco primární je mimo provoz, pokud máte povolené RA-GRS, může přístupu k datům v sekundárního datového centra.</span><span class="sxs-lookup"><span data-stu-id="8f0df-384">While the primary is down, if you have RA-GRS enabled, you can access the data in the secondary data center.</span></span> <span data-ttu-id="8f0df-385">Proto pokud máte v plánu číst z repliky, zatímco primární je nedostupná, pak RA-GRS měli zvážit.</span><span class="sxs-lookup"><span data-stu-id="8f0df-385">Therefore, if you plan to read from the replica while the primary is inaccessible, then RA-GRS should be considered.</span></span>

<span data-ttu-id="8f0df-386">Pokud se jím být významné výpadku, tým Azure může aktivovat selhání geograficky a změňte primární záznamy DNS tak, aby odkazovaly do sekundárního úložiště.</span><span class="sxs-lookup"><span data-stu-id="8f0df-386">If it turns out to be a significant outage, the Azure team may trigger a geo-failover and change the primary DNS entries to point to secondary storage.</span></span> <span data-ttu-id="8f0df-387">Pokud máte buď GRS nebo RA-GRS povolená, můžete v tomto okamžiku přístupu k datům v oblasti, která používá jako sekundární.</span><span class="sxs-lookup"><span data-stu-id="8f0df-387">At this point, if you have either GRS or RA-GRS enabled, you can access the data in the region that used to be the secondary.</span></span> <span data-ttu-id="8f0df-388">Jinými slovy Pokud je váš účet úložiště GRS a došlo k potížím, můžete přistupovat sekundární úložiště jenom v případě, že je geo-převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-388">In other words, if your storage account is GRS and there is a problem, you can access the secondary storage only if there is a geo-failover.</span></span>

<span data-ttu-id="8f0df-389">Další informace najdete v tématu [co dělat, když dojde k výpadku Azure Storage](storage-disaster-recovery-guidance.md).</span><span class="sxs-lookup"><span data-stu-id="8f0df-389">For more information, see [What to do if an Azure Storage outage occurs](storage-disaster-recovery-guidance.md).</span></span> 

<span data-ttu-id="8f0df-390">Všimněte si, že Microsoft řídí, zda dojde k selhání.</span><span class="sxs-lookup"><span data-stu-id="8f0df-390">Note that Microsoft controls whether a failover occurs.</span></span> <span data-ttu-id="8f0df-391">Převzetí služeb při selhání není řízený na účet úložiště, takže ji není rozhodnuto pomocí jednotliví zákazníci.</span><span class="sxs-lookup"><span data-stu-id="8f0df-391">Failover is not controlled per storage account, therefore it is not decided by individual customers.</span></span> <span data-ttu-id="8f0df-392">Implementace zotavení po havárii pro účty konkrétní úložiště nebo disky virtuálního počítače, je nutné použít techniky popsané v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="8f0df-392">To implement Disaster Recovery for specific storage accounts or virtual machine disks, you must use the techniques described previously in this article.</span></span>

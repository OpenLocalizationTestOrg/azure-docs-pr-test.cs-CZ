---
title: "Vlastní testy paměti nástroje pro vyrovnávání zatížení a stav monitorování | Microsoft Docs"
description: "Naučte se používat vlastní testy paměti pro vyrovnávání zatížení Azure k monitorování instancí za službou Vyrovnávání zatížení"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: cab028fed58d544a56f2f6b12b72364c7baf4d86
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="7528b-103">Porozumění testům nástroje pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="7528b-103">Understand load balancer probes</span></span>

<span data-ttu-id="7528b-104">Azure nástroj pro vyrovnávání zatížení poskytuje schopnost sledovat stav instance serveru s použitím sondy.</span><span class="sxs-lookup"><span data-stu-id="7528b-104">Azure Load Balancer offers the capability to monitor the health of server instances by using probes.</span></span> <span data-ttu-id="7528b-105">Když sondu přestane reagovat, nástroj pro vyrovnávání zatížení zastaví odesílání nových připojení k instanci není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="7528b-105">When a probe fails to respond, Load Balancer stops sending new connections to the unhealthy instance.</span></span> <span data-ttu-id="7528b-106">Neovlivní existující připojení a nová připojení se odesílají do pořádku instancí.</span><span class="sxs-lookup"><span data-stu-id="7528b-106">The existing connections are not affected, and new connections are sent to healthy instances.</span></span>

<span data-ttu-id="7528b-107">Cloudové služby rolí (role pracovního procesu a webové role) pomocí agenta hosta pro test monitorování.</span><span class="sxs-lookup"><span data-stu-id="7528b-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="7528b-108">Při použití virtuálních počítačů za službou Vyrovnávání zatížení musí být nakonfigurované TCP nebo HTTP vlastní testy paměti.</span><span class="sxs-lookup"><span data-stu-id="7528b-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="7528b-109">Pochopení počet test a vypršení časového limitu</span><span class="sxs-lookup"><span data-stu-id="7528b-109">Understand probe count and timeout</span></span>

<span data-ttu-id="7528b-110">Postup kontroly závisí na:</span><span class="sxs-lookup"><span data-stu-id="7528b-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="7528b-111">Počet úspěšně sondy, které umožňují instance popisky jako zapnutý.</span><span class="sxs-lookup"><span data-stu-id="7528b-111">The number of successful probes that allow an instance to be labeled as up.</span></span>
* <span data-ttu-id="7528b-112">Počet neúspěšných sondy, které způsobí instance popisky jako dolů.</span><span class="sxs-lookup"><span data-stu-id="7528b-112">The number of failed probes that cause an instance to be labeled as down.</span></span>

<span data-ttu-id="7528b-113">Časový limit a četnost hodnotu nastavenou v SuccessFailCount určit, zda je instance potvrzen spuštěna nebo není spuštěna.</span><span class="sxs-lookup"><span data-stu-id="7528b-113">The timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed to be running or not running.</span></span> <span data-ttu-id="7528b-114">Na portálu Azure časový limit nastavena na dvojnásobek hodnota frekvence.</span><span class="sxs-lookup"><span data-stu-id="7528b-114">In the Azure portal, the timeout is set to two times the value of the frequency.</span></span>

<span data-ttu-id="7528b-115">Test konfigurace všech instancí Vyrovnávání zatížení sítě pro koncový bod (to znamená, Vyrovnávání zatížení sítě sady) musí být stejné.</span><span class="sxs-lookup"><span data-stu-id="7528b-115">The probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be the same.</span></span> <span data-ttu-id="7528b-116">To znamená, že nemůžete jiný test konfigurace pro každou instanci role nebo virtuální počítač v rámci stejné hostované služby pro konkrétní koncový bod kombinaci.</span><span class="sxs-lookup"><span data-stu-id="7528b-116">This means you cannot have a different probe configuration for each role instance or virtual machine in the same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="7528b-117">Například každá instance musí mít identické místní porty a vypršení časových limitů.</span><span class="sxs-lookup"><span data-stu-id="7528b-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="7528b-118">Sondu nástroje pro vyrovnávání zatížení používá IP adresu 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="7528b-118">A Load Balancer probe uses the IP address 168.63.129.16.</span></span> <span data-ttu-id="7528b-119">Tato veřejná IP adresa usnadňuje komunikaci k prostředkům interní platformu pro bring vaše – vlastní-IP adresu Azure virtuální síť.</span><span class="sxs-lookup"><span data-stu-id="7528b-119">This public IP address facilitates communication to internal platform resources for the bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="7528b-120">Virtuální veřejnou IP adresu 168.63.129.16 se používá ve všech oblastech a nedojde ke změně.</span><span class="sxs-lookup"><span data-stu-id="7528b-120">The virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="7528b-121">Doporučujeme povolit tuto IP adresu na všechny zásady místní brány firewall.</span><span class="sxs-lookup"><span data-stu-id="7528b-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="7528b-122">Nemělo by se používat bezpečnostní riziko protože zdrojem může být pouze vnitřní platformy Azure zprávy z této adresy.</span><span class="sxs-lookup"><span data-stu-id="7528b-122">It should not be considered a security risk because only the internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="7528b-123">Pokud není to uděláte, budou existovat neočekávanému chování v různých scénářích, jako jsou konfigurace stejného rozsahu IP adres 168.63.129.16 a s duplicitní IP adresy.</span><span class="sxs-lookup"><span data-stu-id="7528b-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring the same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-the-types-of-probes"></a><span data-ttu-id="7528b-124">Další informace o typech sondy</span><span class="sxs-lookup"><span data-stu-id="7528b-124">Learn about the types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="7528b-125">Test agenta hosta</span><span class="sxs-lookup"><span data-stu-id="7528b-125">Guest agent probe</span></span>

<span data-ttu-id="7528b-126">Tento test je jenom pro cloudové služby Azure k dispozici.</span><span class="sxs-lookup"><span data-stu-id="7528b-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="7528b-127">Nástroj pro vyrovnávání zatížení, využívá agent hosta ve virtuálním počítači a pak naslouchá a odpoví odpověď HTTP 200 OK jenom v případě, že instance je ve stavu připraveno (to znamená, není v jiném stavu například zaneprázdněn recyklace nebo ukončení).</span><span class="sxs-lookup"><span data-stu-id="7528b-127">Load Balancer utilizes the guest agent inside the virtual machine, and then listens and responds with an HTTP 200 OK response only when the instance is in the Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="7528b-128">Další informace najdete v tématu [konfigurace soubor definice služby (csdef) pro sondy stavu](https://msdn.microsoft.com/library/azure/ee758710.aspx) nebo [začínáte s vytvářením Vyrovnávání zatížení straně Internetu pro cloudové služby](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="7528b-128">For more information, see [Configuring the service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="7528b-129">Díky sondu agenta hosta označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="7528b-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="7528b-130">Pokud agenta hosta přestane reagovat s HTTP 200 OK, nástroje pro vyrovnávání zatížení označí instance jako reagovat a zastaví odesílání provozu do této instance.</span><span class="sxs-lookup"><span data-stu-id="7528b-130">If the guest agent fails to respond with HTTP 200 OK, the load balancer marks the instance as unresponsive and stops sending traffic to that instance.</span></span> <span data-ttu-id="7528b-131">Nástroje pro vyrovnávání zatížení bude nadále příkazem ping otestovat instance.</span><span class="sxs-lookup"><span data-stu-id="7528b-131">The load balancer continues to ping the instance.</span></span> <span data-ttu-id="7528b-132">Pokud agenta hosta odpoví HTTP 200, nástroje pro vyrovnávání zatížení odešle provoz do této instance znovu.</span><span class="sxs-lookup"><span data-stu-id="7528b-132">If the guest agent responds with an HTTP 200, the load balancer sends traffic to that instance again.</span></span>

<span data-ttu-id="7528b-133">Pokud používáte webovou roli, kód webu obvykle běží v w3wp.exe, který není monitorován pomocí Azure prostředků infrastruktury nebo hostovaného agenta.</span><span class="sxs-lookup"><span data-stu-id="7528b-133">When you use a web role, the website code typically runs in w3wp.exe, which is not monitored by the Azure fabric or guest agent.</span></span> <span data-ttu-id="7528b-134">To znamená, že selhání v w3wp.exe (například odpovědi HTTP 500), nebudou ohlášena v agentovi hosta a nástroje pro vyrovnávání zatížení nebude tato instance mimo otočení.</span><span class="sxs-lookup"><span data-stu-id="7528b-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported to the guest agent, and the load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="7528b-135">Vlastní test paměti HTTP</span><span class="sxs-lookup"><span data-stu-id="7528b-135">HTTP custom probe</span></span>

<span data-ttu-id="7528b-136">Vlastní test paměti pro vyrovnávání zatížení HTTP přepíše výchozí kontroly agenta hosta, což znamená, že můžete vytvořit vlastní logiky k určení stavu role instance.</span><span class="sxs-lookup"><span data-stu-id="7528b-136">The custom HTTP Load Balancer probe overrides the default guest agent probe, which means that you can create your own custom logic to determine the health of the role instance.</span></span> <span data-ttu-id="7528b-137">Nástroje pro vyrovnávání zatížení sondy váš koncový bod každých 15 sekund, ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="7528b-137">The load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="7528b-138">Instance považován za v otočení nástroje pro vyrovnávání zatížení, pokud ji odpoví HTTP 200 během časového limitu (ve výchozím nastavení je 31 sekund).</span><span class="sxs-lookup"><span data-stu-id="7528b-138">The instance is considered to be in the load balancer rotation if it responds with an HTTP 200 within the timeout period (31 seconds by default).</span></span>

<span data-ttu-id="7528b-139">To může být užitečné, pokud chcete implementovat vlastní logiky k odebrání instance otočení nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="7528b-139">This can be useful if you want to implement your own logic to remove instances from load balancer rotation.</span></span> <span data-ttu-id="7528b-140">Například může rozhodnout odebrat instanci, pokud je vyšší než 90 % využití procesoru a vrátí stav bez 200.</span><span class="sxs-lookup"><span data-stu-id="7528b-140">For example, you could decide to remove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="7528b-141">Pokud máte webové role, které používají w3wp.exe, to také znamená získáte automatické monitorování vašeho webu, protože selhání ve vašem kódu webu vrátí stav bez 200 sondu nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="7528b-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status to the load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="7528b-142">Vlastní test paměti HTTP podporuje pouze protokoly HTTP a relativní cesty.</span><span class="sxs-lookup"><span data-stu-id="7528b-142">The HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="7528b-143">Není podporován protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="7528b-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="7528b-144">Díky HTTP vlastní test paměti označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="7528b-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="7528b-145">HTTP aplikace vrátí kód odpovědi HTTP než 200 (například 403, 404 nebo 500).</span><span class="sxs-lookup"><span data-stu-id="7528b-145">The HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="7528b-146">Toto je kladné potvrzení, která instance aplikace by se dostala mimo službu hned.</span><span class="sxs-lookup"><span data-stu-id="7528b-146">This is a positive acknowledgment that the application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="7528b-147">HTTP server neodpovídá vůbec po uplynutí časového limitu.</span><span class="sxs-lookup"><span data-stu-id="7528b-147">The HTTP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="7528b-148">V závislosti na hodnotu časového limitu, který je nastavený, to může znamenat, že více testu požadavků přejděte nezodpovězená před sondy získá označeno není spuštěna (který je před SuccessFailCount sondy odesílají).</span><span class="sxs-lookup"><span data-stu-id="7528b-148">Depending on the timeout value that is set, this might mean that multiple probe requests go unanswered before the probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="7528b-149">Server uzavře připojení přes TCP resetování.</span><span class="sxs-lookup"><span data-stu-id="7528b-149">The server closes the connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="7528b-150">Vlastní test paměti TCP</span><span class="sxs-lookup"><span data-stu-id="7528b-150">TCP custom probe</span></span>

<span data-ttu-id="7528b-151">Sondy TCP iniciovat připojení k provádění třícestné s definovaný port.</span><span class="sxs-lookup"><span data-stu-id="7528b-151">TCP probes initiate a connection by performing a three-way handshake with the defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="7528b-152">Díky vlastní test paměti TCP označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="7528b-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="7528b-153">Protokolu TCP serveru neodpovídá vůbec po uplynutí časového limitu.</span><span class="sxs-lookup"><span data-stu-id="7528b-153">The TCP server does not respond at all after the timeout period.</span></span> <span data-ttu-id="7528b-154">Tato kontrola, když je označena jako neběží závisí na počtu selhání kontroly požadavků, které jste nakonfigurovali přejděte nezodpovězená před označením testu jako neběží.</span><span class="sxs-lookup"><span data-stu-id="7528b-154">When the probe is marked as not running depends on the number of failed probe requests that were configured to go unanswered before marking the probe as not running.</span></span>
* <span data-ttu-id="7528b-155">Tato kontrola obdrží TCP, obnovit z role instance.</span><span class="sxs-lookup"><span data-stu-id="7528b-155">The probe receives a TCP reset from the role instance.</span></span>

<span data-ttu-id="7528b-156">Další informace o konfiguraci test stavu protokolu HTTP nebo TCP testu najdete v tématu [začít vytvářet ve Správci prostředků pomocí prostředí PowerShell k pro vyrovnávání zatížení internetového](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="7528b-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="7528b-157">Přidání pořádku instancí zpět do otočení nástroje pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="7528b-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="7528b-158">Sondy TCP a protokolu HTTP jsou považovány za v pořádku a označit instanci role jako v pořádku, pokud:</span><span class="sxs-lookup"><span data-stu-id="7528b-158">TCP and HTTP probes are considered healthy and mark the role instance as healthy when:</span></span>

* <span data-ttu-id="7528b-159">Nástroje pro vyrovnávání zatížení získá sondu kladné poprvé spustí virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="7528b-159">The load balancer gets a positive probe the first time the VM boots.</span></span>
* <span data-ttu-id="7528b-160">Číslo SuccessFailCount (popsanou výš) definuje hodnotu úspěšné sondy, které jsou nutné k označení instance role jako v pořádku.</span><span class="sxs-lookup"><span data-stu-id="7528b-160">The number SuccessFailCount (described earlier) defines the value of successful probes that are required to mark the role instance as healthy.</span></span> <span data-ttu-id="7528b-161">Pokud role instance byla odebrána, počet úspěšný, následných sondy musí rovnat nebo překročit hodnotu SuccessFailCount označit jako spuštěná instance role.</span><span class="sxs-lookup"><span data-stu-id="7528b-161">If a role instance was removed, the number of successful, successive probes must equal or exceed the value of SuccessFailCount to mark the role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="7528b-162">Pokud je kolísal stav instanci role, čeká, nástroje pro vyrovnávání zatížení déle než ji předáte role instance zpět do stavu v pořádku.</span><span class="sxs-lookup"><span data-stu-id="7528b-162">If the health of a role instance is fluctuating, the load balancer waits longer before putting the role instance back in the healthy state.</span></span> <span data-ttu-id="7528b-163">To se provádí prostřednictvím zásad k ochraně uživatele a infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="7528b-163">This is done via policy to protect the user and the infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="7528b-164">Pomocí analýzy protokolů pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="7528b-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="7528b-165">Můžete použít [protokolu analýzy nástroje pro vyrovnávání zatížení](load-balancer-monitor-log.md) zkontrolujte na kontrolu stavu a počet testu.</span><span class="sxs-lookup"><span data-stu-id="7528b-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) to check on the probe health status and probe count.</span></span> <span data-ttu-id="7528b-166">Protokolování můžete použít s Power BI nebo statistice provozu Azure poskytnout statistiky o stav nástroj pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="7528b-166">Logging can be used with Power BI or Azure Operational Insights to provide statistics about Load Balancer health status.</span></span>

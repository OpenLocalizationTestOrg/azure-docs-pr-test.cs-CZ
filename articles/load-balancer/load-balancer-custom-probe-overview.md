---
title: "aaaLoad vyrovnávání vlastní testy paměti a stav monitorování | Microsoft Docs"
description: "Zjistěte, jak toouse vlastní testy pro nástroj pro vyrovnávání zatížení Azure toomonitor instance za službou Vyrovnávání zatížení"
services: load-balancer
documentationcenter: na
author: kumudd
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 46b152c5-6a27-4bfc-bea3-05de9ce06a57
ms.service: load-balancer
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 10/24/2016
ms.author: kumud
ms.openlocfilehash: 3dfcfcd2d5cffa58b160cb38d63acffbd997d452
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="understand-load-balancer-probes"></a><span data-ttu-id="6c79d-103">Porozumění testům nástroje pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="6c79d-103">Understand load balancer probes</span></span>

<span data-ttu-id="6c79d-104">Azure nástroj pro vyrovnávání zatížení nabízí hello schopností toomonitor hello stav instance serveru pomocí sondy.</span><span class="sxs-lookup"><span data-stu-id="6c79d-104">Azure Load Balancer offers hello capability toomonitor hello health of server instances by using probes.</span></span> <span data-ttu-id="6c79d-105">Pokud sondu nezdaří toorespond, nástroj pro vyrovnávání zatížení zastaví odesílání novou instanci není v pořádku toohello připojení.</span><span class="sxs-lookup"><span data-stu-id="6c79d-105">When a probe fails toorespond, Load Balancer stops sending new connections toohello unhealthy instance.</span></span> <span data-ttu-id="6c79d-106">ovlivněné nejsou Hello existující připojení a nová připojení posílají toohealthy instance.</span><span class="sxs-lookup"><span data-stu-id="6c79d-106">hello existing connections are not affected, and new connections are sent toohealthy instances.</span></span>

<span data-ttu-id="6c79d-107">Cloudové služby rolí (role pracovního procesu a webové role) pomocí agenta hosta pro test monitorování.</span><span class="sxs-lookup"><span data-stu-id="6c79d-107">Cloud service roles (worker roles and web roles) use a guest agent for probe monitoring.</span></span> <span data-ttu-id="6c79d-108">Při použití virtuálních počítačů za službou Vyrovnávání zatížení musí být nakonfigurované TCP nebo HTTP vlastní testy paměti.</span><span class="sxs-lookup"><span data-stu-id="6c79d-108">TCP or HTTP custom probes must be configured when you use virtual machines behind Load Balancer.</span></span>

## <a name="understand-probe-count-and-timeout"></a><span data-ttu-id="6c79d-109">Pochopení počet test a vypršení časového limitu</span><span class="sxs-lookup"><span data-stu-id="6c79d-109">Understand probe count and timeout</span></span>

<span data-ttu-id="6c79d-110">Postup kontroly závisí na:</span><span class="sxs-lookup"><span data-stu-id="6c79d-110">Probe behavior depends on:</span></span>

* <span data-ttu-id="6c79d-111">Hello počet úspěšné sondy, které umožňují instanci toobe označený jako zapnutý.</span><span class="sxs-lookup"><span data-stu-id="6c79d-111">hello number of successful probes that allow an instance toobe labeled as up.</span></span>
* <span data-ttu-id="6c79d-112">Hello počet neúspěšných sondy, které způsobí instanci toobe označené jako dolů.</span><span class="sxs-lookup"><span data-stu-id="6c79d-112">hello number of failed probes that cause an instance toobe labeled as down.</span></span>

<span data-ttu-id="6c79d-113">Hello časový limit a četnost hodnotu nastavenou v SuccessFailCount určit, zda je instance potvrzené toobe spuštěna nebo není spuštěna.</span><span class="sxs-lookup"><span data-stu-id="6c79d-113">hello timeout and frequency value set in  SuccessFailCount determine whether an instance is confirmed toobe running or not running.</span></span> <span data-ttu-id="6c79d-114">V hello portálu Azure časový limit hello nastaven tootwo časy hello hodnota frekvence hello.</span><span class="sxs-lookup"><span data-stu-id="6c79d-114">In hello Azure portal, hello timeout is set tootwo times hello value of hello frequency.</span></span>

<span data-ttu-id="6c79d-115">Konfigurace testu Hello všech instancí Vyrovnávání zatížení sítě pro koncový bod (to znamená, Vyrovnávání zatížení sítě sady) musí být hello stejné.</span><span class="sxs-lookup"><span data-stu-id="6c79d-115">hello probe configuration of all load-balanced instances for an endpoint (that is, a load-balanced set) must be hello same.</span></span> <span data-ttu-id="6c79d-116">To znamená, že nemůže mít konfiguraci různých testu pro každou instanci role nebo virtuální počítač v hello stejné hostované služby pro konkrétní koncový bod kombinaci.</span><span class="sxs-lookup"><span data-stu-id="6c79d-116">This means you cannot have a different probe configuration for each role instance or virtual machine in hello same hosted service for a particular endpoint combination.</span></span> <span data-ttu-id="6c79d-117">Například každá instance musí mít identické místní porty a vypršení časových limitů.</span><span class="sxs-lookup"><span data-stu-id="6c79d-117">For example, each instance must have identical local ports and timeouts.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="6c79d-118">Sondu nástroje pro vyrovnávání zatížení používá hello IP adresu 168.63.129.16.</span><span class="sxs-lookup"><span data-stu-id="6c79d-118">A Load Balancer probe uses hello IP address 168.63.129.16.</span></span> <span data-ttu-id="6c79d-119">Tato veřejná IP adresa zajišťuje komunikaci toointernal platformy prostředky pro hello přineste vaše vlastníte IP Azure virtuální síť.</span><span class="sxs-lookup"><span data-stu-id="6c79d-119">This public IP address facilitates communication toointernal platform resources for hello bring-your-own-IP Azure Virtual Network scenario.</span></span> <span data-ttu-id="6c79d-120">Hello virtuální veřejnou IP adresu 168.63.129.16 se používá ve všech oblastech a nedojde ke změně.</span><span class="sxs-lookup"><span data-stu-id="6c79d-120">hello virtual public IP address 168.63.129.16 is used in all regions and will not change.</span></span> <span data-ttu-id="6c79d-121">Doporučujeme povolit tuto IP adresu na všechny zásady místní brány firewall.</span><span class="sxs-lookup"><span data-stu-id="6c79d-121">We recommend that you allow this IP address in any local firewall policies.</span></span> <span data-ttu-id="6c79d-122">Nemělo by se používat bezpečnostní riziko protože zdrojem může být pouze hello vnitřní platformy Azure zprávy z této adresy.</span><span class="sxs-lookup"><span data-stu-id="6c79d-122">It should not be considered a security risk because only hello internal Azure platform can source a message from that address.</span></span> <span data-ttu-id="6c79d-123">Pokud není to uděláte, bude neočekávanému chování v různých scénářích, jako jsou konfigurace hello stejného rozsahu IP adres 168.63.129.16 a s duplicitní IP adresy.</span><span class="sxs-lookup"><span data-stu-id="6c79d-123">If you do not do this, there will be unexpected behavior in a variety of scenarios like configuring hello same IP address range of 168.63.129.16 and having duplicated IP addresses.</span></span>

## <a name="learn-about-hello-types-of-probes"></a><span data-ttu-id="6c79d-124">Další informace o typech hello sondy</span><span class="sxs-lookup"><span data-stu-id="6c79d-124">Learn about hello types of probes</span></span>

### <a name="guest-agent-probe"></a><span data-ttu-id="6c79d-125">Test agenta hosta</span><span class="sxs-lookup"><span data-stu-id="6c79d-125">Guest agent probe</span></span>

<span data-ttu-id="6c79d-126">Tento test je jenom pro cloudové služby Azure k dispozici.</span><span class="sxs-lookup"><span data-stu-id="6c79d-126">This probe is available for Azure Cloud Services only.</span></span> <span data-ttu-id="6c79d-127">Nástroj pro vyrovnávání zatížení, využívá agent hosta hello uvnitř hello virtuálního počítače a pak naslouchá a odpoví odpověď HTTP 200 OK jenom v případě hello instance je ve stavu Připraveno hello (to znamená, není v jiném stavu například zaneprázdněn recyklace nebo ukončení).</span><span class="sxs-lookup"><span data-stu-id="6c79d-127">Load Balancer utilizes hello guest agent inside hello virtual machine, and then listens and responds with an HTTP 200 OK response only when hello instance is in hello Ready state (that is, not in another state such as Busy, Recycling, or Stopping).</span></span>

<span data-ttu-id="6c79d-128">Další informace najdete v tématu [konfigurace hello souboru definice služby (csdef) pro sondy stavu](https://msdn.microsoft.com/library/azure/ee758710.aspx) nebo [začínáte s vytvářením Vyrovnávání zatížení straně Internetu pro cloudové služby](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span><span class="sxs-lookup"><span data-stu-id="6c79d-128">For more information, see [Configuring hello service definition file (csdef) for health probes](https://msdn.microsoft.com/library/azure/ee758710.aspx) or [Get started creating an Internet-facing load balancer for cloud services](load-balancer-get-started-internet-classic-cloud.md#check-load-balancer-health-status-for-cloud-services).</span></span>

### <a name="what-makes-a-guest-agent-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="6c79d-129">Díky sondu agenta hosta označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="6c79d-129">What makes a guest agent probe mark an instance as unhealthy?</span></span>

<span data-ttu-id="6c79d-130">V případě selhání toorespond s HTTP 200 OK agenta hosta hello značky nástroje pro vyrovnávání zatížení hello hello instance jako reagovat a zastaví odesílání přenosů toothat instance.</span><span class="sxs-lookup"><span data-stu-id="6c79d-130">If hello guest agent fails toorespond with HTTP 200 OK, hello load balancer marks hello instance as unresponsive and stops sending traffic toothat instance.</span></span> <span data-ttu-id="6c79d-131">Nástroj pro vyrovnávání zatížení Hello pokračuje tooping hello instance.</span><span class="sxs-lookup"><span data-stu-id="6c79d-131">hello load balancer continues tooping hello instance.</span></span> <span data-ttu-id="6c79d-132">Pokud agenta hosta hello odpoví HTTP 200, odešle nástroj pro vyrovnávání zatížení hello provoz toothat instance znovu.</span><span class="sxs-lookup"><span data-stu-id="6c79d-132">If hello guest agent responds with an HTTP 200, hello load balancer sends traffic toothat instance again.</span></span>

<span data-ttu-id="6c79d-133">Pokud používáte webovou roli, kód webu hello obvykle běží v w3wp.exe, který není monitorován pomocí hello prostředků infrastruktury Azure nebo agenta hosta.</span><span class="sxs-lookup"><span data-stu-id="6c79d-133">When you use a web role, hello website code typically runs in w3wp.exe, which is not monitored by hello Azure fabric or guest agent.</span></span> <span data-ttu-id="6c79d-134">To znamená, že selhání v w3wp.exe (například odpovědi HTTP 500) nebude agent hosta hlášené toohello a nástroj pro vyrovnávání zatížení hello nebude tato instance mimo otočení.</span><span class="sxs-lookup"><span data-stu-id="6c79d-134">This means that failures in w3wp.exe (for example, HTTP 500 responses) will not be reported toohello guest agent, and hello load balancer will not take that instance out of rotation.</span></span>

### <a name="http-custom-probe"></a><span data-ttu-id="6c79d-135">Vlastní test paměti HTTP</span><span class="sxs-lookup"><span data-stu-id="6c79d-135">HTTP custom probe</span></span>

<span data-ttu-id="6c79d-136">Hello vlastní test paměti pro vyrovnávání zatížení HTTP přepíše hello výchozí hostovaného agenta kontroly, což znamená, že můžete vytvořit vlastní vlastní logiky toodetermine hello stav hello role instance.</span><span class="sxs-lookup"><span data-stu-id="6c79d-136">hello custom HTTP Load Balancer probe overrides hello default guest agent probe, which means that you can create your own custom logic toodetermine hello health of hello role instance.</span></span> <span data-ttu-id="6c79d-137">Nástroj pro vyrovnávání zatížení Hello sondy váš koncový bod každých 15 sekund, ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="6c79d-137">hello load balancer probes your endpoint every 15 seconds, by default.</span></span> <span data-ttu-id="6c79d-138">Hello instance je považován za toobe v otočení nástroje pro vyrovnávání zatížení hello, pokud ji odpoví HTTP 200 v rámci hello časový limit (ve výchozím nastavení je 31 sekund).</span><span class="sxs-lookup"><span data-stu-id="6c79d-138">hello instance is considered toobe in hello load balancer rotation if it responds with an HTTP 200 within hello timeout period (31 seconds by default).</span></span>

<span data-ttu-id="6c79d-139">To může být užitečné, pokud chcete tooimplement vlastní logiky tooremove instancí z otočení nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="6c79d-139">This can be useful if you want tooimplement your own logic tooremove instances from load balancer rotation.</span></span> <span data-ttu-id="6c79d-140">Může například rozhodnout tooremove instance, pokud je vyšší než 90 % využití procesoru a vrátí stav bez 200.</span><span class="sxs-lookup"><span data-stu-id="6c79d-140">For example, you could decide tooremove an instance if it is above 90% CPU and returns a non-200 status.</span></span> <span data-ttu-id="6c79d-141">Pokud máte webové role, které používají w3wp.exe, to také znamená získáte automatické monitorování vašeho webu, protože selhání ve vašem kódu webu vrátí sondu nástroje pro vyrovnávání zatížení toohello stav bez 200.</span><span class="sxs-lookup"><span data-stu-id="6c79d-141">If you have web roles that use w3wp.exe, this also means you get automatic monitoring of your website, because failures in your website code will return a non-200 status toohello load balancer probe.</span></span>

> [!NOTE]
> <span data-ttu-id="6c79d-142">vlastní test paměti Hello HTTP podporuje pouze protokoly HTTP a relativní cesty.</span><span class="sxs-lookup"><span data-stu-id="6c79d-142">hello HTTP custom probe supports relative paths and HTTP protocol only.</span></span> <span data-ttu-id="6c79d-143">Není podporován protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="6c79d-143">HTTPS is not supported.</span></span>

### <a name="what-makes-an-http-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="6c79d-144">Díky HTTP vlastní test paměti označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="6c79d-144">What makes an HTTP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="6c79d-145">Hello HTTP aplikace vrátí kód odpovědi HTTP než 200 (například 403, 404 nebo 500).</span><span class="sxs-lookup"><span data-stu-id="6c79d-145">hello HTTP application returns an HTTP response code other than 200 (for example, 403, 404, or 500).</span></span> <span data-ttu-id="6c79d-146">Toto je kladné potvrzení, která hello aplikace instance by se dostala mimo službu hned.</span><span class="sxs-lookup"><span data-stu-id="6c79d-146">This is a positive acknowledgment that hello application instance should be taken out of service right away.</span></span>
* <span data-ttu-id="6c79d-147">Hello HTTP server neodpovídá vůbec po hello časový limit.</span><span class="sxs-lookup"><span data-stu-id="6c79d-147">hello HTTP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="6c79d-148">V závislosti na hodnotě hello vypršení časového limitu, který je nastavený, to může znamenat, že více testu požadavků přejděte nezodpovězená před hello testu získá označeno není spuštěna (který je před SuccessFailCount sondy odesílají).</span><span class="sxs-lookup"><span data-stu-id="6c79d-148">Depending on hello timeout value that is set, this might mean that multiple probe requests go unanswered before hello probe gets marked as not running (that is, before SuccessFailCount probes are sent).</span></span>
* <span data-ttu-id="6c79d-149">Hello server zavře hello připojení přes TCP resetování.</span><span class="sxs-lookup"><span data-stu-id="6c79d-149">hello server closes hello connection via a TCP reset.</span></span>

### <a name="tcp-custom-probe"></a><span data-ttu-id="6c79d-150">Vlastní test paměti TCP</span><span class="sxs-lookup"><span data-stu-id="6c79d-150">TCP custom probe</span></span>

<span data-ttu-id="6c79d-151">Sondy TCP iniciovat připojení k provádění třícestné s hello definovaný port.</span><span class="sxs-lookup"><span data-stu-id="6c79d-151">TCP probes initiate a connection by performing a three-way handshake with hello defined port.</span></span>

### <a name="what-makes-a-tcp-custom-probe-mark-an-instance-as-unhealthy"></a><span data-ttu-id="6c79d-152">Díky vlastní test paměti TCP označit instance jako není v pořádku?</span><span class="sxs-lookup"><span data-stu-id="6c79d-152">What makes a TCP custom probe mark an instance as unhealthy?</span></span>

* <span data-ttu-id="6c79d-153">Hello protokolu TCP serveru neodpovídá vůbec po hello časový limit.</span><span class="sxs-lookup"><span data-stu-id="6c79d-153">hello TCP server does not respond at all after hello timeout period.</span></span> <span data-ttu-id="6c79d-154">Hello testu, když je označena jako neběží, závisí na hello počet selhání testu požadavky, které byly nakonfigurované toogo nezodpovězená před označením hello testu jako neběží.</span><span class="sxs-lookup"><span data-stu-id="6c79d-154">When hello probe is marked as not running depends on hello number of failed probe requests that were configured toogo unanswered before marking hello probe as not running.</span></span>
* <span data-ttu-id="6c79d-155">Test Hello obdrží TCP, obnovit z hello role instance.</span><span class="sxs-lookup"><span data-stu-id="6c79d-155">hello probe receives a TCP reset from hello role instance.</span></span>

<span data-ttu-id="6c79d-156">Další informace o konfiguraci test stavu protokolu HTTP nebo TCP testu najdete v tématu [začít vytvářet ve Správci prostředků pomocí prostředí PowerShell k pro vyrovnávání zatížení internetového](load-balancer-get-started-internet-arm-ps.md).</span><span class="sxs-lookup"><span data-stu-id="6c79d-156">For more information about configuring an HTTP health probe or a TCP probe, see [Get started creating an Internet-facing load balancer in Resource Manager using PowerShell](load-balancer-get-started-internet-arm-ps.md).</span></span>

## <a name="add-healthy-instances-back-into-load-balancer-rotation"></a><span data-ttu-id="6c79d-157">Přidání pořádku instancí zpět do otočení nástroje pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="6c79d-157">Add healthy instances back into load balancer rotation</span></span>

<span data-ttu-id="6c79d-158">Sondy TCP a protokolu HTTP jsou považovány za v pořádku a označit instanci role hello za v pořádku, pokud:</span><span class="sxs-lookup"><span data-stu-id="6c79d-158">TCP and HTTP probes are considered healthy and mark hello role instance as healthy when:</span></span>

* <span data-ttu-id="6c79d-159">Nástroj pro vyrovnávání zatížení Hello získá kladné testu hello první čas hello, které se spustí počítač.</span><span class="sxs-lookup"><span data-stu-id="6c79d-159">hello load balancer gets a positive probe hello first time hello VM boots.</span></span>
* <span data-ttu-id="6c79d-160">číslo Hello SuccessFailCount (popsanou výš) definuje hodnotu hello úspěšné sondy, které jsou požadované toomark hello instance role jako v pořádku.</span><span class="sxs-lookup"><span data-stu-id="6c79d-160">hello number SuccessFailCount (described earlier) defines hello value of successful probes that are required toomark hello role instance as healthy.</span></span> <span data-ttu-id="6c79d-161">Pokud role instance byla odebrána, hello počet úspěšný, následných sondy musí rovnat nebo vyšší než hodnota hello SuccessFailCount toomark hello role instance jako spuštěná.</span><span class="sxs-lookup"><span data-stu-id="6c79d-161">If a role instance was removed, hello number of successful, successive probes must equal or exceed hello value of SuccessFailCount toomark hello role instance as running.</span></span>

> [!NOTE]
> <span data-ttu-id="6c79d-162">Pokud je kolísal hello stav instanci role, nástroj pro vyrovnávání zatížení hello již čeká před přepnutím hello role instance zpět ve stavu v pořádku hello.</span><span class="sxs-lookup"><span data-stu-id="6c79d-162">If hello health of a role instance is fluctuating, hello load balancer waits longer before putting hello role instance back in hello healthy state.</span></span> <span data-ttu-id="6c79d-163">To se provádí prostřednictvím hello infrastruktury a zásad tooprotect hello uživatelů.</span><span class="sxs-lookup"><span data-stu-id="6c79d-163">This is done via policy tooprotect hello user and hello infrastructure.</span></span>

## <a name="use-log-analytics-for-load-balancer"></a><span data-ttu-id="6c79d-164">Pomocí analýzy protokolů pro vyrovnávání zatížení</span><span class="sxs-lookup"><span data-stu-id="6c79d-164">Use log analytics for Load Balancer</span></span>

<span data-ttu-id="6c79d-165">Můžete použít [protokolu analýzy nástroje pro vyrovnávání zatížení](load-balancer-monitor-log.md) toocheck na počet hello test stavu stav a kontroly.</span><span class="sxs-lookup"><span data-stu-id="6c79d-165">You can use [log analytics for Load Balancer](load-balancer-monitor-log.md) toocheck on hello probe health status and probe count.</span></span> <span data-ttu-id="6c79d-166">Protokolování můžete použít s Power BI nebo statistice provozu Azure tooprovide statistiky o stav nástroj pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="6c79d-166">Logging can be used with Power BI or Azure Operational Insights tooprovide statistics about Load Balancer health status.</span></span>

---
title: "aaaHow toouse Azure API Management s virtuálními sítěmi"
description: "Zjistěte, jak toosetup tooa připojení virtuální sítě v Azure API Management a přístup web services přes něj."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 426b3974e4fed7daffdb0c3f02381edbc326dc28
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="how-toouse-azure-api-management-with-virtual-networks"></a><span data-ttu-id="a7973-103">Jak toouse Azure API Management s virtuálními sítěmi</span><span class="sxs-lookup"><span data-stu-id="a7973-103">How toouse Azure API Management with virtual networks</span></span>
<span data-ttu-id="a7973-104">Virtuální sítě Azure (virtuální sítě) umožňují tooplace některé z vašich prostředků Azure v Internetu jiných routeable síti, která můžete řídit přístup k.</span><span class="sxs-lookup"><span data-stu-id="a7973-104">Azure Virtual Networks (VNETs) allow you tooplace any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="a7973-105">Tyto sítě pak může být připojené tooyour místními sítěmi pomocí různých technologií sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="a7973-105">These networks can then be connected tooyour on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="a7973-106">informace o virtuálních sítí Azure začínat hello informace v tomto poli toolearn: [Přehled virtuálních sítí Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="a7973-106">toolearn more about Azure Virtual Networks start with hello information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="a7973-107">Azure API Management se dá nasadit ve virtuální síti hello (VNET), má přístup k back-end služby v rámci sítě hello.</span><span class="sxs-lookup"><span data-stu-id="a7973-107">Azure API Management can be deployed inside hello virtual network (VNET), so it can access backend services within hello network.</span></span> <span data-ttu-id="a7973-108">Dobrý den, portál pro vývojáře a Brána rozhraní API, může být nakonfigurované toobe přístupný z Internetu hello nebo pouze v rámci virtuální sítě hello.</span><span class="sxs-lookup"><span data-stu-id="a7973-108">hello developer portal and API gateway, can be configured toobe accessible either from hello Internet or only within hello virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="a7973-109">Azure API Management podporuje classic a Azure Resource Manager virtuálních sítí patřících.</span><span class="sxs-lookup"><span data-stu-id="a7973-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="a7973-110"><a name="enable-vpn"></a>Připojení povolte virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="a7973-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="a7973-111">Připojení k virtuální síti je k dispozici v hello **Premium** a **vývojáře** vrstev.</span><span class="sxs-lookup"><span data-stu-id="a7973-111">VNET connectivity is available in hello **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="a7973-112">tooswitch mezi vrstvami hello otevřete služby API Management v hello portál Azure a pak otevřete hello **škálování a ceny** kartě. V části hello **cenová úroveň** , vyberte úroveň Premium nebo vývojáře hello a klikněte na tlačítko Uložit.</span><span class="sxs-lookup"><span data-stu-id="a7973-112">tooswitch between hello tiers, open your API Management service in hello Azure portal and then open hello **Scale and pricing** tab. Under hello **Pricing tier** section, select hello Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="a7973-113">připojení k virtuální síti tooenable, otevřete služby API Management v hello portál Azure a otevřete hello **virtuální síť** stránky.</span><span class="sxs-lookup"><span data-stu-id="a7973-113">tooenable VNET connectivity, open your API Management service in hello Azure portal and open hello **Virtual network** page.</span></span>

![Virtuální síť nabídky služby API Management][api-management-using-vnet-menu]

<span data-ttu-id="a7973-115">Vyberte typ přístupu hello potřeby:</span><span class="sxs-lookup"><span data-stu-id="a7973-115">Select hello desired access type:</span></span>

* <span data-ttu-id="a7973-116">**Externí**: portál brány a vývojáře hello API Management jsou dostupné z hello veřejný internet prostřednictvím externím vyrovnáváním zatížení.</span><span class="sxs-lookup"><span data-stu-id="a7973-116">**External**: hello API Management gateway and developer portal are accessible from hello public internet via an external load balancer.</span></span> <span data-ttu-id="a7973-117">Hello brány mají přístup k prostředkům v rámci virtuální sítě hello.</span><span class="sxs-lookup"><span data-stu-id="a7973-117">hello gateway can access resources within hello virtual network.</span></span>

![Veřejný partnerský vztah][api-management-vnet-public]

* <span data-ttu-id="a7973-119">**Interní**: portál brány a vývojáře hello API Management jsou k dispozici pouze v rámci virtuální sítě hello prostřednictvím interní nástroj.</span><span class="sxs-lookup"><span data-stu-id="a7973-119">**Internal**: hello API Management gateway and developer portal are accessible only from within hello virtual network via an internal load balancer.</span></span> <span data-ttu-id="a7973-120">Hello brány mají přístup k prostředkům v rámci virtuální sítě hello.</span><span class="sxs-lookup"><span data-stu-id="a7973-120">hello gateway can access resources within hello virtual network.</span></span>

![Soukromý partnerský vztah][api-management-vnet-private]

<span data-ttu-id="a7973-122">Zobrazí seznam všech oblastech, kde je zřízený služby API Management.</span><span class="sxs-lookup"><span data-stu-id="a7973-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="a7973-123">Vyberte virtuální síť a podsíť pro každou oblast.</span><span class="sxs-lookup"><span data-stu-id="a7973-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="a7973-124">Hello seznam se naplní se classic i Resource Manager virtuální sítě k dispozici v rámci vašich předplatných Azure, které jsou nastavení v oblasti hello, který konfigurujete.</span><span class="sxs-lookup"><span data-stu-id="a7973-124">hello list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in hello region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="a7973-125">**Koncový bod služby** v hello výše diagram zahrnuje brány nebo Proxy, portál vydavatele, portál pro vývojáře, GIT a hello přímé koncový bod správy.</span><span class="sxs-lookup"><span data-stu-id="a7973-125">**Service Endpoint** in hello above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and hello Direct Management Endpoint.</span></span>
> <span data-ttu-id="a7973-126">**Koncový bod správy** v hello výše diagramu je koncový bod hello hostované v konfiguraci toomanage hello služby prostřednictvím portálu Azure a prostředí Powershell.</span><span class="sxs-lookup"><span data-stu-id="a7973-126">**Management Endpoint** in hello above diagram is hello endpoint hosted on hello service toomanage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="a7973-127">Mějte také na paměti, že přestože hello diagram znázorňuje IP adresy pro své různé koncové body služby API Management **pouze** odpoví na své nakonfigurované názvy hostitelů.</span><span class="sxs-lookup"><span data-stu-id="a7973-127">Also, note, that, even though, hello diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7973-128">Při nasazení Azure API Management instance tooa virtuální sítě Resource Manageru, hello služba musí být v vyhrazené podsíť, která obsahuje žádné další prostředky s výjimkou instance Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="a7973-128">When deploying an Azure API Management instance tooa Resource Manager VNET, hello service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="a7973-129">Pokud je proveden pokus o toodeploy tooa instance Azure API Management podsíť virtuální sítě Resource Manageru, který obsahuje jiné prostředky, hello nasazení se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="a7973-129">If an attempt is made toodeploy an Azure API Management instance tooa Resource Manager VNET subnet that contains other resources, hello deployment will fail.</span></span>
>
>

![Vyberte síť VPN][api-management-setup-vpn-select]

<span data-ttu-id="a7973-131">Klikněte na tlačítko **Uložit** hello horní části úvodní obrazovka.</span><span class="sxs-lookup"><span data-stu-id="a7973-131">Click **Save** at hello top of hello screen.</span></span>

> [!NOTE]
> <span data-ttu-id="a7973-132">Hello adresy VIP instance služby API Management hello se změní pokaždé, když virtuální sítě je povolený nebo zakázaný.</span><span class="sxs-lookup"><span data-stu-id="a7973-132">hello VIP address of hello API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="a7973-133">Hello adresa VIP změní také při API Management se přesune ze **externí** příliš**interní** nebo naopak</span><span class="sxs-lookup"><span data-stu-id="a7973-133">hello VIP address will also change when API Management is moved from **External** too**Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="a7973-134">Když odeberete API Management z virtuální sítě nebo změnit hello jeden, který je nasazen v, hello použitých virtuální sítě může zůstat uzamčen, pro too4 hodin.</span><span class="sxs-lookup"><span data-stu-id="a7973-134">If you remove API Management from a VNET or change hello one it is deployed in, hello previously used VNET can remain locked for up too4 hours.</span></span> <span data-ttu-id="a7973-135">Během této doby nebude být možné toodelete hello virtuální síť nebo nasazení nové tooit prostředků.</span><span class="sxs-lookup"><span data-stu-id="a7973-135">During this period it will not be possible toodelete hello VNET or deploy a new resource tooit.</span></span>

## <span data-ttu-id="a7973-136"><a name="enable-vnet-powershell"></a>Připojení VNET povolit pomocí rutin prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="a7973-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="a7973-137">Můžete také povolit připojení virtuální sítě pomocí rutin prostředí PowerShell hello</span><span class="sxs-lookup"><span data-stu-id="a7973-137">You can also enable VNET connectivity using hello PowerShell cmdlets</span></span>

* <span data-ttu-id="a7973-138">**Vytvoření služby API Management uvnitř virtuální sítě**: použijte rutinu hello [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate služby Azure API Management uvnitř virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="a7973-138">**Create an API Management service inside a VNET**: Use hello cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) toocreate an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="a7973-139">**Nasazení služby API Management existující uvnitř virtuální sítě**: použijte rutinu hello [aktualizace AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove existující službu Azure API Management uvnitř virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="a7973-139">**Deploy an existing API Management service inside a VNET**: Use hello cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) toomove an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="a7973-140"><a name="connect-vnet"></a>Připojit tooa webovou službu hostovanou v rámci virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="a7973-140"><a name="connect-vnet"> </a>Connect tooa web service hosted within a virtual Network</span></span>
<span data-ttu-id="a7973-141">Po služby API Management je toohello připojené virtuální sítě, je přístup ke službám back-end v něm nejsou jiné než přístup ke službám veřejné.</span><span class="sxs-lookup"><span data-stu-id="a7973-141">After your API Management service is connected toohello VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="a7973-142">Jednoduše zadejte hello místní IP adresu nebo hello název hostitele (Pokud je DNS server nakonfigurovaný pro hello virtuální sítě) webové služby do hello **adresu URL webové služby** pole při vytváření nové rozhraní API nebo úpravou existující.</span><span class="sxs-lookup"><span data-stu-id="a7973-142">Just type in hello local IP address or hello host name (if a DNS server is configured for hello VNET) of your web service into hello **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Přidání rozhraní API z sítě VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="a7973-144"><a name="network-configuration-issues"></a>Běžné problémy s konfigurací sítě</span><span class="sxs-lookup"><span data-stu-id="a7973-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="a7973-145">Následuje seznam běžných problémů chybné konfigurace, které se mohou vyskytnout při nasazení služby API Management do virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="a7973-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="a7973-146">**Vlastní instalace serveru DNS**: hello služba API Management závisí na několik služeb Azure.</span><span class="sxs-lookup"><span data-stu-id="a7973-146">**Custom DNS server setup**: hello API Management service depends on several Azure services.</span></span> <span data-ttu-id="a7973-147">Je-li API Management je umístěn ve virtuální síti s vlastního serveru DNS, musí být názvy hostitelů hello tooresolve těchto služeb Azure.</span><span class="sxs-lookup"><span data-stu-id="a7973-147">When API Management is hosted in a VNET with a custom DNS server, it needs tooresolve hello hostnames of those Azure services.</span></span> <span data-ttu-id="a7973-148">Postupujte podle [to](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) pokyny na vlastní instalační program DNS.</span><span class="sxs-lookup"><span data-stu-id="a7973-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="a7973-149">Zobrazit hello porty tabulce a další požadavky sítě pro referenci.</span><span class="sxs-lookup"><span data-stu-id="a7973-149">See hello ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a7973-150">Doporučuje se, že pokud používáte vlastní servery DNS pro hello virtuální síť, můžete nastavit, **před** nasazení služby API Management do ní.</span><span class="sxs-lookup"><span data-stu-id="a7973-150">It is recommended that, if you are using a Custom DNS Server(s) for hello VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="a7973-151">V opačném případě je nutné příliš aktualizovat služba API Management hello při každé změně servery DNS hello (s) spuštěním hello [použít operace konfigurace sítě](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="a7973-151">Otherwise you need too update hello API Management service each time you change hello DNS Servers(s) by running hello [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="a7973-152">**Porty vyžadované pro API Management**: příchozí a odchozí přenosy do hello podsíť, ve kterém je nasazený API Management se dá řídit pomocí [skupinu zabezpečení sítě][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="a7973-152">**Ports required for API Management**: Inbound and Outbound traffic into hello Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="a7973-153">Pokud některá z těchto portů není k dispozici, API Management nemusí pracovat správně a může být nedostupný.</span><span class="sxs-lookup"><span data-stu-id="a7973-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="a7973-154">Nejméně jeden z těchto portů blokované je jiné běžné chybné konfigurace problém při použití služby API Management s virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="a7973-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="a7973-155">Pokud instanci služby API Management je umístěn ve virtuální síti, se použijí hello porty hello následující tabulka.</span><span class="sxs-lookup"><span data-stu-id="a7973-155">When an API Management service instance is hosted in a VNET, hello ports in hello following table are used.</span></span>

| <span data-ttu-id="a7973-156">Zdrojové nebo cílové porty</span><span class="sxs-lookup"><span data-stu-id="a7973-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="a7973-157">Směr</span><span class="sxs-lookup"><span data-stu-id="a7973-157">Direction</span></span> | <span data-ttu-id="a7973-158">Přenosový protokol</span><span class="sxs-lookup"><span data-stu-id="a7973-158">Transport protocol</span></span> | <span data-ttu-id="a7973-159">Účel</span><span class="sxs-lookup"><span data-stu-id="a7973-159">Purpose</span></span> | <span data-ttu-id="a7973-160">Zdroj / cíl</span><span class="sxs-lookup"><span data-stu-id="a7973-160">Source / Destination</span></span> | <span data-ttu-id="a7973-161">Typ přístupu</span><span class="sxs-lookup"><span data-stu-id="a7973-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="a7973-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="a7973-162">* / 80, 443</span></span> |<span data-ttu-id="a7973-163">Příchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-163">Inbound</span></span> |<span data-ttu-id="a7973-164">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-164">TCP</span></span> |<span data-ttu-id="a7973-165">TooAPI komunikace klienta správy</span><span class="sxs-lookup"><span data-stu-id="a7973-165">Client communication tooAPI Management</span></span> |<span data-ttu-id="a7973-166">INTERNET NEBO VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a7973-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a7973-167">Externí</span><span class="sxs-lookup"><span data-stu-id="a7973-167">External</span></span> |
| <span data-ttu-id="a7973-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="a7973-168">* / 3443</span></span> |<span data-ttu-id="a7973-169">Příchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-169">Inbound</span></span> |<span data-ttu-id="a7973-170">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-170">TCP</span></span> |<span data-ttu-id="a7973-171">Koncový bod správy pro portál Azure a prostředí Powershell</span><span class="sxs-lookup"><span data-stu-id="a7973-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="a7973-172">INTERNET NEBO VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a7973-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a7973-173">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-173">External & Internal</span></span> |
| <span data-ttu-id="a7973-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="a7973-174">* / 80, 443</span></span> |<span data-ttu-id="a7973-175">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-175">Outbound</span></span> |<span data-ttu-id="a7973-176">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-176">TCP</span></span> |<span data-ttu-id="a7973-177">Závislost na úložiště Azure a Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="a7973-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="a7973-178">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-179">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-179">External & Internal</span></span> |
| <span data-ttu-id="a7973-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="a7973-180">* / 1433</span></span> |<span data-ttu-id="a7973-181">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-181">Outbound</span></span> |<span data-ttu-id="a7973-182">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-182">TCP</span></span> |<span data-ttu-id="a7973-183">Závislost na Azure SQL</span><span class="sxs-lookup"><span data-stu-id="a7973-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="a7973-184">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-185">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-185">External & Internal</span></span> |
| <span data-ttu-id="a7973-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="a7973-186">* / 11000 - 11999</span></span> |<span data-ttu-id="a7973-187">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-187">Outbound</span></span> |<span data-ttu-id="a7973-188">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-188">TCP</span></span> |<span data-ttu-id="a7973-189">Závislost na Azure SQL verze 12</span><span class="sxs-lookup"><span data-stu-id="a7973-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="a7973-190">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-191">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-191">External & Internal</span></span> |
| <span data-ttu-id="a7973-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="a7973-192">* / 14000 - 14999</span></span> |<span data-ttu-id="a7973-193">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-193">Outbound</span></span> |<span data-ttu-id="a7973-194">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-194">TCP</span></span> |<span data-ttu-id="a7973-195">Závislost na Azure SQL verze 12</span><span class="sxs-lookup"><span data-stu-id="a7973-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="a7973-196">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-197">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-197">External & Internal</span></span> |
| <span data-ttu-id="a7973-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="a7973-198">* / 5671</span></span> |<span data-ttu-id="a7973-199">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-199">Outbound</span></span> |<span data-ttu-id="a7973-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="a7973-200">AMQP</span></span> |<span data-ttu-id="a7973-201">Závislost pro zásady rozbočovače tooEvent protokolu a agent monitorování</span><span class="sxs-lookup"><span data-stu-id="a7973-201">Dependency for Log tooEvent Hub policy and monitoring agent</span></span> |<span data-ttu-id="a7973-202">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-203">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-203">External & Internal</span></span> |
| <span data-ttu-id="a7973-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="a7973-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="a7973-205">Příchozí a odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-205">Inbound & Outbound</span></span> |<span data-ttu-id="a7973-206">UDP</span><span class="sxs-lookup"><span data-stu-id="a7973-206">UDP</span></span> |<span data-ttu-id="a7973-207">Závislost na mezipaměti Redis</span><span class="sxs-lookup"><span data-stu-id="a7973-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="a7973-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a7973-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a7973-209">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-209">External & Internal</span></span> |-
| <span data-ttu-id="a7973-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="a7973-210">* / 445</span></span> |<span data-ttu-id="a7973-211">Odchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-211">Outbound</span></span> |<span data-ttu-id="a7973-212">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-212">TCP</span></span> |<span data-ttu-id="a7973-213">Závislost na sdílenou složku Azure pro GIT</span><span class="sxs-lookup"><span data-stu-id="a7973-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="a7973-214">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="a7973-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="a7973-215">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-215">External & Internal</span></span> |
| <span data-ttu-id="a7973-216">* / *</span><span class="sxs-lookup"><span data-stu-id="a7973-216">* / *</span></span> | <span data-ttu-id="a7973-217">Příchozí</span><span class="sxs-lookup"><span data-stu-id="a7973-217">Inbound</span></span> |<span data-ttu-id="a7973-218">TCP</span><span class="sxs-lookup"><span data-stu-id="a7973-218">TCP</span></span> |<span data-ttu-id="a7973-219">Nástroj pro vyrovnávání zatížení infrastruktury Azure</span><span class="sxs-lookup"><span data-stu-id="a7973-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="a7973-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="a7973-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="a7973-221">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="a7973-221">External & Internal</span></span> |

* <span data-ttu-id="a7973-222">**Funkce SSL**: tooenable certifikát SSL musí služba API Management hello řetězec pro vytváření a ověřování tooocsp.msocsp.com odchozí síťové připojení, mscrl.microsoft.com a crl.microsoft.com. Tuto závislost není vyžadována, pokud některý z certifikátů, že nahrajete tooAPI správu obsahovat kořenové toohello certifikační Autority úplný řetěz hello.</span><span class="sxs-lookup"><span data-stu-id="a7973-222">**SSL functionality**: tooenable SSL certificate chain building and validation hello API Management service needs Outbound network connectivity tooocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload tooAPI Management contain hello full chain toohello CA root.</span></span>

* <span data-ttu-id="a7973-223">**DNS přístup**: odchozí přístup na port 53 se vyžaduje pro komunikaci se servery DNS.</span><span class="sxs-lookup"><span data-stu-id="a7973-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="a7973-224">Pokud existuje vlastního serveru DNS na hello druhém konci brána sítě VPN, musí být dostupný z podsítě hello hostování API Management hello DNS server.</span><span class="sxs-lookup"><span data-stu-id="a7973-224">If a custom DNS server exists on hello other end of a VPN gateway, hello DNS server must be reachable from hello subnet hosting API Management.</span></span>

* <span data-ttu-id="a7973-225">**Monitorování stavu a metrik**: odchozí připojení tooAzure sledování koncových bodů sítě, které řešení v části hello následující domény: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="a7973-225">**Metrics and Health Monitoring**: Outbound network connectivity tooAzure Monitoring endpoints, which resolve under hello following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="a7973-226">**Expresní instalace trasy**: obvyklé konfigurace zákazníka je toodefine vlastní výchozí trasa (0.0.0.0/0), který vynutí odchozí internetové přenosy tooinstead toku místně.</span><span class="sxs-lookup"><span data-stu-id="a7973-226">**Express Route Setup**: A common customer configuration is toodefine their own default route (0.0.0.0/0) which forces outbound Internet traffic tooinstead flow on-premises.</span></span> <span data-ttu-id="a7973-227">Tento tok provozu vždy dělí připojení ke službě Azure API Management, protože odchozí přenosy hello je blokované místně nebo NAT'd tooan nerozpoznatelný sadu adresy, které přestane fungovat v různých koncové body Azure.</span><span class="sxs-lookup"><span data-stu-id="a7973-227">This traffic flow invariably breaks connectivity with Azure API Management because hello outbound traffic is either blocked on-premises, or NAT'd tooan unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="a7973-228">Hello řešení je trasy definované uživatelem toodefine jeden (nebo více) ([udr][UDRs]) v podsíti hello, který obsahuje hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="a7973-228">hello solution is toodefine one (or more) user-defined routes ([UDRs][UDRs]) on hello subnet that contains hello Azure API Management.</span></span> <span data-ttu-id="a7973-229">UDR definuje tras konkrétní podsítě, které bude dodržení místo hello výchozí trasu.</span><span class="sxs-lookup"><span data-stu-id="a7973-229">A UDR defines subnet-specific routes that will be honored instead of hello default route.</span></span>
  <span data-ttu-id="a7973-230">Pokud je to možné doporučujeme toouse hello následující konfigurace:</span><span class="sxs-lookup"><span data-stu-id="a7973-230">If possible, it is recommended toouse hello following configuration:</span></span>
 * <span data-ttu-id="a7973-231">Konfigurace ExpressRoute Hello inzeruje 0.0.0.0/0 a ve výchozím nastavení vynucené tunelových propojení všechny odchozí přenosy na místě.</span><span class="sxs-lookup"><span data-stu-id="a7973-231">hello ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="a7973-232">Hello UDR použít toohello podsíť obsahující hello Azure API Management definuje 0.0.0.0/0 s typ dalšího segmentu z Internetu.</span><span class="sxs-lookup"><span data-stu-id="a7973-232">hello UDR applied toohello subnet containing hello Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="a7973-233">Hello celkové požadavky tyto kroky je úrovni podsítě hello UDR má přednost před hello ExpressRoute vynuceného tunelování, čímž zajišťuje odchozí přístup k Internetu z hello Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="a7973-233">hello combined effect of these steps is that hello subnet level UDR takes precedence over hello ExpressRoute forced tunneling, thus ensuring outbound Internet access from hello Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="a7973-234">Azure API Management není podporovaný s konfigurací ExpressRoute, **nesprávně Inzerovat trasy z hello cesty veřejného partnerského vztahu cesta toohello soukromého partnerského vztahu mezi**.</span><span class="sxs-lookup"><span data-stu-id="a7973-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from hello public peering path toohello private peering path**.</span></span> <span data-ttu-id="a7973-235">Konfigurace ExpressRoute, které mají veřejné partnerské vztahy nakonfigurované, obdrží inzerování trasy od společnosti Microsoft pro velké sady rozsahů adres Microsoft Azure IP.</span><span class="sxs-lookup"><span data-stu-id="a7973-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="a7973-236">Pokud tyto rozsahy adres nesprávně ohlášené mezi na hello cestou soukromého partnerského vztahu, hello konečný výsledek je, že všechny odchozí síťových paketů z instance Azure API Management hello podsítě jsou nesprávně tunelovým propojením force tooa zákazníka do místní sítě infrastruktura.</span><span class="sxs-lookup"><span data-stu-id="a7973-236">If these address ranges are incorrectly cross-advertised on hello private peering path, hello end result is that all outbound network packets from hello Azure API Management instance's subnet are incorrectly force-tunneled tooa customer's on-premises network infrastructure.</span></span> <span data-ttu-id="a7973-237">Tento tok sítě dělí Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="a7973-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="a7973-238">je ale problém toothis řešení Hello směrování mezi – reklamu toostop z hello cesty veřejného partnerského vztahu cesta toohello soukromého partnerského vztahu.</span><span class="sxs-lookup"><span data-stu-id="a7973-238">hello solution toothis problem is toostop cross-advertising routes from hello public peering path toohello private peering path.</span></span>


## <span data-ttu-id="a7973-239"><a name="troubleshooting"></a>Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="a7973-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="a7973-240">Při provádění změn tooyour sítě, naleznete v příliš[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate Pokud hello služba API Management ještě ztratili přístup tooany Dobrý den důležité prostředky, které je závislá na.</span><span class="sxs-lookup"><span data-stu-id="a7973-240">When making changes tooyour network, refer too[NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), toovalidate if hello API Management service has not lost access tooany of hello critical resources which it depends upon.</span></span> <span data-ttu-id="a7973-241">stavu připojení Hello by měl být aktualizováno každých 15 minut.</span><span class="sxs-lookup"><span data-stu-id="a7973-241">hello connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="a7973-242"><a name="limitations"></a>Omezení</span><span class="sxs-lookup"><span data-stu-id="a7973-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="a7973-243">Podsíť obsahující instance API Management nemůže obsahovat u jiných typů prostředků Azure.</span><span class="sxs-lookup"><span data-stu-id="a7973-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="a7973-244">Hello podsíť a hello API Management service musí být v hello stejného předplatného.</span><span class="sxs-lookup"><span data-stu-id="a7973-244">hello subnet and hello API Management service must be in hello same subscription.</span></span>
* <span data-ttu-id="a7973-245">Nelze přesunout podsíť obsahující instance API Management napříč odběry.</span><span class="sxs-lookup"><span data-stu-id="a7973-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="a7973-246">Při použití interní virtuální sítě, pouze pro interní IP adresu, bude k dispozici z rozsahu hello uvádí [RFC 1918](https://tools.ietf.org/html/rfc1918), nejde zadat veřejnou IP adresu.</span><span class="sxs-lookup"><span data-stu-id="a7973-246">When using an internal virtual network, only an internal IP address will be available from hello range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="a7973-247">Pro více oblast API Management nasazení s interní virtuální sítě nakonfigurovaný, uživatelé jsou zodpovědní za správu vlastní rozložení zátěže jako vlastní hello DNS.</span><span class="sxs-lookup"><span data-stu-id="a7973-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own hello DNS.</span></span>


## <span data-ttu-id="a7973-248"><a name="related-content"></a>Související obsah</span><span class="sxs-lookup"><span data-stu-id="a7973-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="a7973-249">Připojení virtuální síti toobackend použitím brány Vpn</span><span class="sxs-lookup"><span data-stu-id="a7973-249">Connecting a Virtual Network toobackend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="a7973-250">Propojení virtuální sítě z různé modely nasazení</span><span class="sxs-lookup"><span data-stu-id="a7973-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="a7973-251">Jakým způsobem volá toouse hello tootrace Inspector rozhraní API v Azure API Management</span><span class="sxs-lookup"><span data-stu-id="a7973-251">How toouse hello API Inspector tootrace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect tooa web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md

---
title: "Jak používat Azure API Management s virtuálními sítěmi"
description: "Zjistěte, jak nastavit připojení k virtuální síti ve webové služby Azure API Management a přístup přes něj."
services: api-management
documentationcenter: 
author: antonba
manager: erikre
editor: 
ms.assetid: 64b58f7b-ca22-47dc-89c0-f6bb0af27a48
ms.service: api-management
ms.workload: mobile
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 12/15/2016
ms.author: apimpm
ms.openlocfilehash: 268cee739188d81feffc36ac07fcdfa18ff95a4d
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-use-azure-api-management-with-virtual-networks"></a><span data-ttu-id="9bc35-103">Jak používat Azure API Management s virtuálními sítěmi</span><span class="sxs-lookup"><span data-stu-id="9bc35-103">How to use Azure API Management with virtual networks</span></span>
<span data-ttu-id="9bc35-104">Virtuální sítě Azure (virtuální sítě) umožňují některé z vašich prostředků Azure umístění v síti routeable Internetu jiných výrobců, která můžete řídit přístup ke.</span><span class="sxs-lookup"><span data-stu-id="9bc35-104">Azure Virtual Networks (VNETs) allow you to place any of your Azure resources in a non-internet routeable network that you control access to.</span></span> <span data-ttu-id="9bc35-105">Tyto sítě můžete pak připojené k vaší místní sítě pomocí různých technologií sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="9bc35-105">These networks can then be connected to your on-premises networks using various VPN technologies.</span></span> <span data-ttu-id="9bc35-106">Další informace o virtuálních sítí Azure začínat zde uvedené informace: [Přehled virtuálních sítí Azure](../virtual-network/virtual-networks-overview.md).</span><span class="sxs-lookup"><span data-stu-id="9bc35-106">To learn more about Azure Virtual Networks start with the information here: [Azure Virtual Network Overview](../virtual-network/virtual-networks-overview.md).</span></span>

<span data-ttu-id="9bc35-107">Azure API Management se dá nasadit ve virtuální síti (VNET), takže má přístup k back-end služby v rámci sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-107">Azure API Management can be deployed inside the virtual network (VNET), so it can access backend services within the network.</span></span> <span data-ttu-id="9bc35-108">Portál pro vývojáře a Brána rozhraní API, lze nakonfigurovat byla přístupná z Internetu nebo pouze v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-108">The developer portal and API gateway, can be configured to be accessible either from the Internet or only within the virtual network.</span></span>

> [!NOTE]
> <span data-ttu-id="9bc35-109">Azure API Management podporuje classic a Azure Resource Manager virtuálních sítí patřících.</span><span class="sxs-lookup"><span data-stu-id="9bc35-109">Azure API Management supports both classic and Azure Resource Manager VNets.</span></span>
>
>

## <span data-ttu-id="9bc35-110"><a name="enable-vpn"></a>Připojení povolte virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="9bc35-110"><a name="enable-vpn"> </a>Enable VNET connection</span></span>
> [!NOTE]
> <span data-ttu-id="9bc35-111">Připojení k virtuální síti je k dispozici v **Premium** a **vývojáře** vrstev.</span><span class="sxs-lookup"><span data-stu-id="9bc35-111">VNET connectivity is available in the **Premium** and **Developer** tiers.</span></span> <span data-ttu-id="9bc35-112">Chcete-li přepnout mezi vrstvami, otevřete služby API Management na portálu Azure a pak otevřete **škálování a ceny** kartě. V části **cenová úroveň** , vyberte úroveň Premium nebo Developer a klikněte na tlačítko Uložit.</span><span class="sxs-lookup"><span data-stu-id="9bc35-112">To switch between the tiers, open your API Management service in the Azure portal and then open the **Scale and pricing** tab. Under the **Pricing tier** section, select the Premium or Developer tier and click Save.</span></span>
>

<span data-ttu-id="9bc35-113">Pokud chcete povolit připojení virtuální sítě, otevřete služby API Management ve službě Azure portálu a otevřete **virtuální síť** stránky.</span><span class="sxs-lookup"><span data-stu-id="9bc35-113">To enable VNET connectivity, open your API Management service in the Azure portal and open the **Virtual network** page.</span></span>

![Virtuální síť nabídky služby API Management][api-management-using-vnet-menu]

<span data-ttu-id="9bc35-115">Vyberte typ požadovaný přístup:</span><span class="sxs-lookup"><span data-stu-id="9bc35-115">Select the desired access type:</span></span>

* <span data-ttu-id="9bc35-116">**Externí**: portál brány a vývojáře služby API Management jsou přístupné z veřejného Internetu prostřednictvím externím vyrovnáváním zatížení.</span><span class="sxs-lookup"><span data-stu-id="9bc35-116">**External**: the API Management gateway and developer portal are accessible from the public internet via an external load balancer.</span></span> <span data-ttu-id="9bc35-117">Brány mají přístup k prostředkům v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-117">The gateway can access resources within the virtual network.</span></span>

![Veřejný partnerský vztah][api-management-vnet-public]

* <span data-ttu-id="9bc35-119">**Interní**: rozhraní API brány a vývojáře portálu pro správu jsou k dispozici pouze v rámci virtuální sítě prostřednictvím interní nástroj.</span><span class="sxs-lookup"><span data-stu-id="9bc35-119">**Internal**: the API Management gateway and developer portal are accessible only from within the virtual network via an internal load balancer.</span></span> <span data-ttu-id="9bc35-120">Brány mají přístup k prostředkům v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-120">The gateway can access resources within the virtual network.</span></span>

![Soukromý partnerský vztah][api-management-vnet-private]

<span data-ttu-id="9bc35-122">Zobrazí seznam všech oblastech, kde je zřízený služby API Management.</span><span class="sxs-lookup"><span data-stu-id="9bc35-122">You will now see a list of all regions where your API Management service is provisioned.</span></span> <span data-ttu-id="9bc35-123">Vyberte virtuální síť a podsíť pro každou oblast.</span><span class="sxs-lookup"><span data-stu-id="9bc35-123">Select a VNET and subnet for every region.</span></span> <span data-ttu-id="9bc35-124">Naplnění seznamu se classic i Resource Manager virtuální sítě k dispozici v rámci vašich předplatných Azure, které jsou nastavení v oblasti, který konfigurujete.</span><span class="sxs-lookup"><span data-stu-id="9bc35-124">The list is populated with both classic and Resource Manager virtual networks available in your Azure subscriptions that are setup in the region you are configuring.</span></span>

> [!NOTE]
> <span data-ttu-id="9bc35-125">**Koncový bod služby** v diagramu zahrnuje brány nebo Proxy, portál vydavatele, portál pro vývojáře, GIT a přímé koncový bod správy.</span><span class="sxs-lookup"><span data-stu-id="9bc35-125">**Service Endpoint** in the above diagram includes Gateway/Proxy, Publisher Portal, Developer Portal, GIT, and the Direct Management Endpoint.</span></span>
> <span data-ttu-id="9bc35-126">**Koncový bod správy** v diagramu je koncový bod hostované na službu, kterou chcete spravovat konfiguraci prostřednictvím portálu Azure a prostředí Powershell.</span><span class="sxs-lookup"><span data-stu-id="9bc35-126">**Management Endpoint** in the above diagram is the endpoint hosted on the service to manage configuration via Azure portal and Powershell.</span></span>
> <span data-ttu-id="9bc35-127">Mějte také na paměti, že přestože diagram znázorňuje IP adresy pro své různé koncové body služby API Management **pouze** odpoví na své nakonfigurované názvy hostitelů.</span><span class="sxs-lookup"><span data-stu-id="9bc35-127">Also, note, that, even though, the diagram shows IP Addresses for its various endpoints, API Management service **only** responds on its configured Hostnames.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9bc35-128">Pokud nasazujete instanci Azure API Management k virtuální síti Resource Manager, služba musí být ve vyhrazené podsíť, která obsahuje žádné další prostředky s výjimkou instance Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="9bc35-128">When deploying an Azure API Management instance to a Resource Manager VNET, the service must be in a dedicated subnet that contains no other resources except for Azure API Management instances.</span></span> <span data-ttu-id="9bc35-129">Pokud je proveden pokus o nasazení instance služby Azure API Management na podsíť virtuální sítě Resource Manageru obsahující další prostředky, instalace se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="9bc35-129">If an attempt is made to deploy an Azure API Management instance to a Resource Manager VNET subnet that contains other resources, the deployment will fail.</span></span>
>
>

![Vyberte síť VPN][api-management-setup-vpn-select]

<span data-ttu-id="9bc35-131">Klikněte na tlačítko **Uložit** v horní části obrazovky.</span><span class="sxs-lookup"><span data-stu-id="9bc35-131">Click **Save** at the top of the screen.</span></span>

> [!NOTE]
> <span data-ttu-id="9bc35-132">Adresa VIP instanci služby API Management se změní pokaždé, když virtuální sítě je povolený nebo zakázaný.</span><span class="sxs-lookup"><span data-stu-id="9bc35-132">The VIP address of the API Management instance will change each time VNET is enabled or disabled.</span></span>  
> <span data-ttu-id="9bc35-133">Adresa VIP změní také při API Management se přesune ze **externí** k **interní** nebo naopak</span><span class="sxs-lookup"><span data-stu-id="9bc35-133">The VIP address will also change when API Management is moved from **External** to **Internal** or vice-versa</span></span>
>


> [!IMPORTANT]
> <span data-ttu-id="9bc35-134">Když odeberete API Management z virtuální sítě nebo změnit, které je nasazena v, může zůstat použitých VNET uzamčeném až 4 hodiny.</span><span class="sxs-lookup"><span data-stu-id="9bc35-134">If you remove API Management from a VNET or change the one it is deployed in, the previously used VNET can remain locked for up to 4 hours.</span></span> <span data-ttu-id="9bc35-135">Během této doby nebude možné odstranit virtuální sítě nebo nasazení nového prostředku do ní.</span><span class="sxs-lookup"><span data-stu-id="9bc35-135">During this period it will not be possible to delete the VNET or deploy a new resource to it.</span></span>

## <span data-ttu-id="9bc35-136"><a name="enable-vnet-powershell"></a>Připojení VNET povolit pomocí rutin prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="9bc35-136"><a name="enable-vnet-powershell"> </a>Enable VNET connection using PowerShell cmdlets</span></span>
<span data-ttu-id="9bc35-137">Můžete také povolit připojení virtuální sítě pomocí rutin prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="9bc35-137">You can also enable VNET connectivity using the PowerShell cmdlets</span></span>

* <span data-ttu-id="9bc35-138">**Vytvoření služby API Management uvnitř virtuální sítě**: použijte rutinu [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) k vytvoření služby Azure API Management uvnitř virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-138">**Create an API Management service inside a VNET**: Use the cmdlet [New-AzureRmApiManagement](/powershell/module/azurerm.apimanagement/new-azurermapimanagement) to create an Azure API Management service inside a VNET.</span></span>

* <span data-ttu-id="9bc35-139">**Nasazení služby API Management existující uvnitř virtuální sítě**: použijte rutinu [aktualizace AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) přesunout existující službu Azure API Management uvnitř virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-139">**Deploy an existing API Management service inside a VNET**: Use the cmdlet [Update-AzureRmApiManagementDeployment](/powershell/module/azurerm.apimanagement/update-azurermapimanagementdeployment) to move an existing Azure API Management service inside a Virtual Network.</span></span>

## <span data-ttu-id="9bc35-140"><a name="connect-vnet"></a>Připojení k webové službě hostované v rámci virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="9bc35-140"><a name="connect-vnet"> </a>Connect to a web service hosted within a virtual Network</span></span>
<span data-ttu-id="9bc35-141">Po služby API Management je připojen k virtuální síti, je přístup ke službám back-end v něm nejsou jiné než přístup ke službám veřejné.</span><span class="sxs-lookup"><span data-stu-id="9bc35-141">After your API Management service is connected to the VNET, accessing backend services within it is no different than accessing public services.</span></span> <span data-ttu-id="9bc35-142">Jednoduše zadejte místní IP adresu nebo název hostitele (Pokud je nakonfigurovaný DNS server pro virtuální sítě) do webové služby **adresu URL webové služby** pole při vytváření nové rozhraní API nebo úpravou existující.</span><span class="sxs-lookup"><span data-stu-id="9bc35-142">Just type in the local IP address or the host name (if a DNS server is configured for the VNET) of your web service into the **Web service URL** field when creating a new API or editing an existing one.</span></span>

![Přidání rozhraní API z sítě VPN][api-management-setup-vpn-add-api]

## <span data-ttu-id="9bc35-144"><a name="network-configuration-issues"></a>Běžné problémy s konfigurací sítě</span><span class="sxs-lookup"><span data-stu-id="9bc35-144"><a name="network-configuration-issues"> </a>Common Network Configuration Issues</span></span>
<span data-ttu-id="9bc35-145">Následuje seznam běžných problémů chybné konfigurace, které se mohou vyskytnout při nasazení služby API Management do virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-145">Following is a list of common misconfiguration issues that can occur while deploying API Management service into a Virtual Network.</span></span>

* <span data-ttu-id="9bc35-146">**Vlastní instalace serveru DNS**: rozhraní API správy služby závisí na několik služeb Azure.</span><span class="sxs-lookup"><span data-stu-id="9bc35-146">**Custom DNS server setup**: The API Management service depends on several Azure services.</span></span> <span data-ttu-id="9bc35-147">Při API Management je umístěn ve virtuální síti s vlastního serveru DNS, je nutné přeložit názvy hostitelů těchto služeb Azure.</span><span class="sxs-lookup"><span data-stu-id="9bc35-147">When API Management is hosted in a VNET with a custom DNS server, it needs to resolve the hostnames of those Azure services.</span></span> <span data-ttu-id="9bc35-148">Postupujte podle [to](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) pokyny na vlastní instalační program DNS.</span><span class="sxs-lookup"><span data-stu-id="9bc35-148">Please follow [this](../virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances.md#name-resolution-using-your-own-dns-server) guidance on custom DNS setup.</span></span> <span data-ttu-id="9bc35-149">Zobrazit následující porty tabulce a další požadavky sítě pro referenci.</span><span class="sxs-lookup"><span data-stu-id="9bc35-149">See the ports table below and other network requirements for reference.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9bc35-150">Doporučuje se, že pokud používáte vlastní servery DNS pro virtuální sítě, můžete nastavit, **před** nasazení služby API Management do ní.</span><span class="sxs-lookup"><span data-stu-id="9bc35-150">It is recommended that, if you are using a Custom DNS Server(s) for the VNET, you set that up **before** deploying an API Management service into it.</span></span> <span data-ttu-id="9bc35-151">V opačném případě je potřeba aktualizovat služba API Management pokaždé, když změníte servery DNS (s) spuštěním [použít operace konfigurace sítě](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span><span class="sxs-lookup"><span data-stu-id="9bc35-151">Otherwise you need to update the API Management service each time you change the DNS Servers(s) by running the [Apply Network Configuration Operation](https://docs.microsoft.com/en-us/rest/api/apimanagement/apimanagementservice#ApiManagementService_ApplyNetworkConfigurationUpdates)</span></span>

* <span data-ttu-id="9bc35-152">**Porty vyžadované pro API Management**: příchozí a odchozí přenosy do podsítě, ve kterém je nasazený API Management se dá řídit pomocí [skupinu zabezpečení sítě][Network Security Group].</span><span class="sxs-lookup"><span data-stu-id="9bc35-152">**Ports required for API Management**: Inbound and Outbound traffic into the Subnet in which API Management is deployed can be controlled using [Network Security Group][Network Security Group].</span></span> <span data-ttu-id="9bc35-153">Pokud některá z těchto portů není k dispozici, API Management nemusí pracovat správně a může být nedostupný.</span><span class="sxs-lookup"><span data-stu-id="9bc35-153">If any of these ports are unavailable, API Management may not operate properly and may become inaccessible.</span></span> <span data-ttu-id="9bc35-154">Nejméně jeden z těchto portů blokované je jiné běžné chybné konfigurace problém při použití služby API Management s virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-154">Having one or more of these ports blocked is another common misconfiguration issue when using API Management with a VNET.</span></span>

<span data-ttu-id="9bc35-155">Pokud je instance služby API Management je hostováno ve virtuální síti, se používají porty v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="9bc35-155">When an API Management service instance is hosted in a VNET, the ports in the following table are used.</span></span>

| <span data-ttu-id="9bc35-156">Zdrojové nebo cílové porty</span><span class="sxs-lookup"><span data-stu-id="9bc35-156">Source / Destination Port(s)</span></span> | <span data-ttu-id="9bc35-157">Směr</span><span class="sxs-lookup"><span data-stu-id="9bc35-157">Direction</span></span> | <span data-ttu-id="9bc35-158">Přenosový protokol</span><span class="sxs-lookup"><span data-stu-id="9bc35-158">Transport protocol</span></span> | <span data-ttu-id="9bc35-159">Účel</span><span class="sxs-lookup"><span data-stu-id="9bc35-159">Purpose</span></span> | <span data-ttu-id="9bc35-160">Zdroj / cíl</span><span class="sxs-lookup"><span data-stu-id="9bc35-160">Source / Destination</span></span> | <span data-ttu-id="9bc35-161">Typ přístupu</span><span class="sxs-lookup"><span data-stu-id="9bc35-161">Access type</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="9bc35-162">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="9bc35-162">* / 80, 443</span></span> |<span data-ttu-id="9bc35-163">Příchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-163">Inbound</span></span> |<span data-ttu-id="9bc35-164">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-164">TCP</span></span> |<span data-ttu-id="9bc35-165">Komunikaci klientů API Management</span><span class="sxs-lookup"><span data-stu-id="9bc35-165">Client communication to API Management</span></span> |<span data-ttu-id="9bc35-166">INTERNET NEBO VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="9bc35-166">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="9bc35-167">Externí</span><span class="sxs-lookup"><span data-stu-id="9bc35-167">External</span></span> |
| <span data-ttu-id="9bc35-168">* / 3443</span><span class="sxs-lookup"><span data-stu-id="9bc35-168">* / 3443</span></span> |<span data-ttu-id="9bc35-169">Příchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-169">Inbound</span></span> |<span data-ttu-id="9bc35-170">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-170">TCP</span></span> |<span data-ttu-id="9bc35-171">Koncový bod správy pro portál Azure a prostředí Powershell</span><span class="sxs-lookup"><span data-stu-id="9bc35-171">Management endpoint for Azure portal and Powershell</span></span> |<span data-ttu-id="9bc35-172">INTERNET NEBO VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="9bc35-172">INTERNET / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="9bc35-173">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-173">External & Internal</span></span> |
| <span data-ttu-id="9bc35-174">* / 80, 443</span><span class="sxs-lookup"><span data-stu-id="9bc35-174">* / 80, 443</span></span> |<span data-ttu-id="9bc35-175">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-175">Outbound</span></span> |<span data-ttu-id="9bc35-176">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-176">TCP</span></span> |<span data-ttu-id="9bc35-177">Závislost na úložiště Azure a Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="9bc35-177">Dependency on Azure Storage and Azure Service Bus</span></span> |<span data-ttu-id="9bc35-178">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-178">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-179">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-179">External & Internal</span></span> |
| <span data-ttu-id="9bc35-180">* / 1433</span><span class="sxs-lookup"><span data-stu-id="9bc35-180">* / 1433</span></span> |<span data-ttu-id="9bc35-181">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-181">Outbound</span></span> |<span data-ttu-id="9bc35-182">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-182">TCP</span></span> |<span data-ttu-id="9bc35-183">Závislost na Azure SQL</span><span class="sxs-lookup"><span data-stu-id="9bc35-183">Dependency on Azure SQL</span></span> |<span data-ttu-id="9bc35-184">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-184">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-185">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-185">External & Internal</span></span> |
| <span data-ttu-id="9bc35-186">* / 11000 - 11999</span><span class="sxs-lookup"><span data-stu-id="9bc35-186">* / 11000 - 11999</span></span> |<span data-ttu-id="9bc35-187">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-187">Outbound</span></span> |<span data-ttu-id="9bc35-188">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-188">TCP</span></span> |<span data-ttu-id="9bc35-189">Závislost na Azure SQL verze 12</span><span class="sxs-lookup"><span data-stu-id="9bc35-189">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="9bc35-190">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-190">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-191">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-191">External & Internal</span></span> |
| <span data-ttu-id="9bc35-192">* / 14000 - 14999</span><span class="sxs-lookup"><span data-stu-id="9bc35-192">* / 14000 - 14999</span></span> |<span data-ttu-id="9bc35-193">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-193">Outbound</span></span> |<span data-ttu-id="9bc35-194">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-194">TCP</span></span> |<span data-ttu-id="9bc35-195">Závislost na Azure SQL verze 12</span><span class="sxs-lookup"><span data-stu-id="9bc35-195">Dependency on Azure SQL V12</span></span> |<span data-ttu-id="9bc35-196">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-196">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-197">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-197">External & Internal</span></span> |
| <span data-ttu-id="9bc35-198">* / 5671</span><span class="sxs-lookup"><span data-stu-id="9bc35-198">* / 5671</span></span> |<span data-ttu-id="9bc35-199">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-199">Outbound</span></span> |<span data-ttu-id="9bc35-200">AMQP</span><span class="sxs-lookup"><span data-stu-id="9bc35-200">AMQP</span></span> |<span data-ttu-id="9bc35-201">Závislosti pro protokol do centra událostí zásadu a agent monitorování</span><span class="sxs-lookup"><span data-stu-id="9bc35-201">Dependency for Log to Event Hub policy and monitoring agent</span></span> |<span data-ttu-id="9bc35-202">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-202">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-203">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-203">External & Internal</span></span> |
| <span data-ttu-id="9bc35-204">6381 - 6383 / 6381 - 6383</span><span class="sxs-lookup"><span data-stu-id="9bc35-204">6381 - 6383 / 6381 - 6383</span></span> |<span data-ttu-id="9bc35-205">Příchozí a odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-205">Inbound & Outbound</span></span> |<span data-ttu-id="9bc35-206">UDP</span><span class="sxs-lookup"><span data-stu-id="9bc35-206">UDP</span></span> |<span data-ttu-id="9bc35-207">Závislost na mezipaměti Redis</span><span class="sxs-lookup"><span data-stu-id="9bc35-207">Dependency on Redis Cache</span></span> |<span data-ttu-id="9bc35-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="9bc35-208">VIRTUAL_NETWORK / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="9bc35-209">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-209">External & Internal</span></span> |-
| <span data-ttu-id="9bc35-210">* / 445</span><span class="sxs-lookup"><span data-stu-id="9bc35-210">* / 445</span></span> |<span data-ttu-id="9bc35-211">Odchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-211">Outbound</span></span> |<span data-ttu-id="9bc35-212">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-212">TCP</span></span> |<span data-ttu-id="9bc35-213">Závislost na sdílenou složku Azure pro GIT</span><span class="sxs-lookup"><span data-stu-id="9bc35-213">Dependency on Azure File Share for GIT</span></span> |<span data-ttu-id="9bc35-214">VIRTUAL_NETWORK NEBO INTERNET</span><span class="sxs-lookup"><span data-stu-id="9bc35-214">VIRTUAL_NETWORK / INTERNET</span></span> |<span data-ttu-id="9bc35-215">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-215">External & Internal</span></span> |
| <span data-ttu-id="9bc35-216">* / *</span><span class="sxs-lookup"><span data-stu-id="9bc35-216">* / *</span></span> | <span data-ttu-id="9bc35-217">Příchozí</span><span class="sxs-lookup"><span data-stu-id="9bc35-217">Inbound</span></span> |<span data-ttu-id="9bc35-218">TCP</span><span class="sxs-lookup"><span data-stu-id="9bc35-218">TCP</span></span> |<span data-ttu-id="9bc35-219">Nástroj pro vyrovnávání zatížení infrastruktury Azure</span><span class="sxs-lookup"><span data-stu-id="9bc35-219">Azure Infrastructure Load Balancer</span></span> | <span data-ttu-id="9bc35-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span><span class="sxs-lookup"><span data-stu-id="9bc35-220">AZURE_LOAD_BALANCER / VIRTUAL_NETWORK</span></span> |<span data-ttu-id="9bc35-221">Externí & interní</span><span class="sxs-lookup"><span data-stu-id="9bc35-221">External & Internal</span></span> |

* <span data-ttu-id="9bc35-222">**Funkce SSL**: Chcete-li povolit vytváření řetězu certifikátů SSL a ověření API Management service potřebuje odchozí síťové připojení k ocsp.msocsp.com, mscrl.microsoft.com a crl.microsoft.com. Tuto závislost není vyžadována, pokud některý z certifikátů, který nahrajete do služby API Management obsahovat úplný řetěz do kořenové certifikační Autority.</span><span class="sxs-lookup"><span data-stu-id="9bc35-222">**SSL functionality**: To enable SSL certificate chain building and validation the API Management service needs Outbound network connectivity to ocsp.msocsp.com, mscrl.microsoft.com and crl.microsoft.com. This dependency is not required, if any certificate you upload to API Management contain the full chain to the CA root.</span></span>

* <span data-ttu-id="9bc35-223">**DNS přístup**: odchozí přístup na port 53 se vyžaduje pro komunikaci se servery DNS.</span><span class="sxs-lookup"><span data-stu-id="9bc35-223">**DNS Access**: Outbound access on port 53 is required for communication with DNS servers.</span></span> <span data-ttu-id="9bc35-224">Pokud existuje vlastního serveru DNS na druhém konci brána sítě VPN, musí být dostupný z podsítě hostování API Management DNS server.</span><span class="sxs-lookup"><span data-stu-id="9bc35-224">If a custom DNS server exists on the other end of a VPN gateway, the DNS server must be reachable from the subnet hosting API Management.</span></span>

* <span data-ttu-id="9bc35-225">**Monitorování stavu a metrik**: odchozí síťové připojení k Azure Monitoring koncových bodů, které řešení pod následující domény: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="9bc35-225">**Metrics and Health Monitoring**: Outbound network connectivity to Azure Monitoring endpoints, which resolve under the following domains: global.metrics.nsatc.net, shoebox2.metrics.nsatc.net, prod3.metrics.nsatc.net.</span></span>

* <span data-ttu-id="9bc35-226">**Expresní instalace trasy**: obvyklé konfigurace zákazníka je definovat vlastní výchozí trasa (0.0.0.0/0), který vynutí odchozí přenosy z Internetu do místo toku místní.</span><span class="sxs-lookup"><span data-stu-id="9bc35-226">**Express Route Setup**: A common customer configuration is to define their own default route (0.0.0.0/0) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="9bc35-227">Tento tok provozu vždy dělí připojení ke službě Azure API Management, protože odchozí provoz je blokované místně nebo NAT by nerozpoznatelný sadu adresy, které přestane fungovat v různých koncové body Azure.</span><span class="sxs-lookup"><span data-stu-id="9bc35-227">This traffic flow invariably breaks connectivity with Azure API Management because the outbound traffic is either blocked on-premises, or NAT'd to an unrecognizable set of addresses that no longer work with various Azure endpoints.</span></span> <span data-ttu-id="9bc35-228">Řešení je definovat jeden (nebo více) trasy definované uživatelem ([udr][UDRs]) v podsíti, který obsahuje Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="9bc35-228">The solution is to define one (or more) user-defined routes ([UDRs][UDRs]) on the subnet that contains the Azure API Management.</span></span> <span data-ttu-id="9bc35-229">UDR definuje tras konkrétní podsítě, které bude dodržení místo výchozí trasu.</span><span class="sxs-lookup"><span data-stu-id="9bc35-229">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>
  <span data-ttu-id="9bc35-230">Pokud je to možné doporučujeme použít následující konfigurace:</span><span class="sxs-lookup"><span data-stu-id="9bc35-230">If possible, it is recommended to use the following configuration:</span></span>
 * <span data-ttu-id="9bc35-231">Konfigurace ExpressRoute inzeruje 0.0.0.0/0 a ve výchozím nastavení vynucené tunelových propojení všechny odchozí přenosy na místě.</span><span class="sxs-lookup"><span data-stu-id="9bc35-231">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
 * <span data-ttu-id="9bc35-232">UDR použije na podsíť obsahující Azure API Management definuje 0.0.0.0/0 s typ dalšího segmentu z Internetu.</span><span class="sxs-lookup"><span data-stu-id="9bc35-232">The UDR applied to the subnet containing the Azure API Management defines 0.0.0.0/0 with a next hop type of Internet.</span></span>
 <span data-ttu-id="9bc35-233">Celkové požadavky tyto kroky je, že na úrovni podsítě UDR má přednost před ExpressRoute vynucené tunelování, čímž zajišťuje odchozí přístup k Internetu z Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="9bc35-233">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure API Management.</span></span>

>[!WARNING]  
><span data-ttu-id="9bc35-234">Azure API Management není podporovaný s konfigurací ExpressRoute, **nesprávně Inzerovat trasy z cesty veřejného partnerského vztahu k cestou soukromého partnerského vztahu mezi**.</span><span class="sxs-lookup"><span data-stu-id="9bc35-234">Azure API Management is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="9bc35-235">Konfigurace ExpressRoute, které mají veřejné partnerské vztahy nakonfigurované, obdrží inzerování trasy od společnosti Microsoft pro velké sady rozsahů adres Microsoft Azure IP.</span><span class="sxs-lookup"><span data-stu-id="9bc35-235">ExpressRoute configurations that have public peering configured, will receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="9bc35-236">Pokud tyto rozsahy adres nesprávně ohlášené mezi na cestou soukromého partnerského vztahu, konečným výsledkem je, že všechny odchozí síťových paketů z podsítě instance Azure API Management jsou nesprávně force tunelovým propojením zákazníka místní síťové infrastruktuře.</span><span class="sxs-lookup"><span data-stu-id="9bc35-236">If these address ranges are incorrectly cross-advertised on the private peering path, the end result is that all outbound network packets from the Azure API Management instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="9bc35-237">Tento tok sítě dělí Azure API Management.</span><span class="sxs-lookup"><span data-stu-id="9bc35-237">This network flow breaks Azure API Management.</span></span> <span data-ttu-id="9bc35-238">Řešení tohoto problému je zastavit směrování mezi – reklamu z cesty veřejného partnerského vztahu cestou soukromého partnerského vztahu.</span><span class="sxs-lookup"><span data-stu-id="9bc35-238">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


## <span data-ttu-id="9bc35-239"><a name="troubleshooting"></a>Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="9bc35-239"><a name="troubleshooting"> </a>Troubleshooting</span></span>
<span data-ttu-id="9bc35-240">Při provádění změn k síti, najdete [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), ověřte, jestli služba API Management ještě ztráty přístupu k některému z důležitých prostředků, které je závislá na.</span><span class="sxs-lookup"><span data-stu-id="9bc35-240">When making changes to your network, refer to [NetworkStatus API](https://docs.microsoft.com/en-us/rest/api/apimanagement/networkstatus), to validate if the API Management service has not lost access to any of the critical resources which it depends upon.</span></span> <span data-ttu-id="9bc35-241">Stav připojení musí být aktualizováno každých 15 minut.</span><span class="sxs-lookup"><span data-stu-id="9bc35-241">The connectivity status should be updated every 15 minutes.</span></span>

## <span data-ttu-id="9bc35-242"><a name="limitations"></a>Omezení</span><span class="sxs-lookup"><span data-stu-id="9bc35-242"><a name="limitations"> </a>Limitations</span></span>
* <span data-ttu-id="9bc35-243">Podsíť obsahující instance API Management nemůže obsahovat u jiných typů prostředků Azure.</span><span class="sxs-lookup"><span data-stu-id="9bc35-243">A subnet containing API Management instances cannot contain any other Azure resource types.</span></span>
* <span data-ttu-id="9bc35-244">Podsíť a služba API Management musí být ve stejném předplatném.</span><span class="sxs-lookup"><span data-stu-id="9bc35-244">The subnet and the API Management service must be in the same subscription.</span></span>
* <span data-ttu-id="9bc35-245">Nelze přesunout podsíť obsahující instance API Management napříč odběry.</span><span class="sxs-lookup"><span data-stu-id="9bc35-245">A subnet containing API Management instances cannot be moved across subscriptions.</span></span>
* <span data-ttu-id="9bc35-246">Při použití interní virtuální sítě, pouze interní IP adresu budou k dispozici z rozsahu uvádí [RFC 1918](https://tools.ietf.org/html/rfc1918), nejde zadat veřejnou IP adresu.</span><span class="sxs-lookup"><span data-stu-id="9bc35-246">When using an internal virtual network, only an internal IP address will be available from the range stated in [RFC 1918](https://tools.ietf.org/html/rfc1918), a public IP address cannot be provided.</span></span>
* <span data-ttu-id="9bc35-247">Pro více oblast API Management nasazení s interní virtuální sítě nakonfigurovaný, uživatelé jsou zodpovědní za správu vlastní rozložení zátěže jako vlastní DNS.</span><span class="sxs-lookup"><span data-stu-id="9bc35-247">For multi-region API Management deployments, with Internal virtual networks configured, users are responsible for managing their own load balancing as they own the DNS.</span></span>


## <span data-ttu-id="9bc35-248"><a name="related-content"></a>Související obsah</span><span class="sxs-lookup"><span data-stu-id="9bc35-248"><a name="related-content"> </a>Related content</span></span>
* [<span data-ttu-id="9bc35-249">Propojení virtuální sítě s back-end pomocí brány sítě Vpn</span><span class="sxs-lookup"><span data-stu-id="9bc35-249">Connecting a Virtual Network to backend using Vpn Gateway</span></span>](../vpn-gateway/vpn-gateway-about-vpngateways.md#s2smulti)
* [<span data-ttu-id="9bc35-250">Propojení virtuální sítě z různé modely nasazení</span><span class="sxs-lookup"><span data-stu-id="9bc35-250">Connecting a Virtual Network from different deployment models</span></span>](../vpn-gateway/vpn-gateway-connect-different-deployment-models-powershell.md)
* [<span data-ttu-id="9bc35-251">Jak používat nástroj Inspector rozhraní API pro trasování volání v Azure API Management</span><span class="sxs-lookup"><span data-stu-id="9bc35-251">How to use the API Inspector to trace calls in Azure API Management</span></span>](api-management-howto-api-inspector.md)

[api-management-using-vnet-menu]: ./media/api-management-using-with-vnet/api-management-menu-vnet.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-type.png
[api-management-setup-vpn-select]: ./media/api-management-using-with-vnet/api-management-using-vnet-select.png
[api-management-setup-vpn-add-api]: ./media/api-management-using-with-vnet/api-management-using-vnet-add-api.png
[api-management-vnet-private]: ./media/api-management-using-with-vnet/api-management-vnet-private.png
[api-management-vnet-public]: ./media/api-management-using-with-vnet/api-management-vnet-public.png

[Enable VPN connections]: #enable-vpn
[Connect to a web service behind VPN]: #connect-vpn
[Related content]: #related-content

[UDRs]: ../virtual-network/virtual-networks-udr-overview.md
[Network Security Group]: ../virtual-network/virtual-networks-nsg.md

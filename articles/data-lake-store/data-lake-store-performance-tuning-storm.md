---
title: "Ladění pravidla výkonu Storm Azure Data Lake Store | Microsoft Docs"
description: "Ladění pravidla výkonu Storm Azure Data Lake Store"
services: data-lake-store
documentationcenter: 
author: stewu
manager: amitkul
editor: stewu
ms.assetid: ebde7b9f-2e51-4d43-b7ab-566417221335
ms.service: data-lake-store
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: big-data
ms.date: 12/19/2016
ms.author: stewu
ms.openlocfilehash: 1dfa93643f45a96ded3fd022aa8b1c71d487acb4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="performance-tuning-guidance-for-storm-on-hdinsight-and-azure-data-lake-store"></a><span data-ttu-id="02afb-103">Pokyny pro Storm v HDInsight a Azure Data Lake Store optimalizace výkonu</span><span class="sxs-lookup"><span data-stu-id="02afb-103">Performance tuning guidance for Storm on HDInsight and Azure Data Lake Store</span></span>

<span data-ttu-id="02afb-104">Pochopení faktory, které je potřeba zvážit při optimalizaci výkonu topologie Azure Storm.</span><span class="sxs-lookup"><span data-stu-id="02afb-104">Understand the factors that should be considered when you tune the performance of an Azure Storm topology.</span></span> <span data-ttu-id="02afb-105">Například je důležité si uvědomit, charakteristiky práci funkcích spouts a funkce bolts (jestli práce je vstupně-výstupních operací nebo náročná na paměť).</span><span class="sxs-lookup"><span data-stu-id="02afb-105">For example, it's important to understand the characteristics of the work done by the spouts and the bolts (whether the work is I/O or memory intensive).</span></span> <span data-ttu-id="02afb-106">Tento článek se zabývá řadu pokyny, včetně řešení běžných potíží optimalizace výkonu.</span><span class="sxs-lookup"><span data-stu-id="02afb-106">This article covers a range of performance tuning guidelines, including troubleshooting common issues.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="02afb-107">Požadavky</span><span class="sxs-lookup"><span data-stu-id="02afb-107">Prerequisites</span></span>

* <span data-ttu-id="02afb-108">**Předplatné Azure**.</span><span class="sxs-lookup"><span data-stu-id="02afb-108">**An Azure subscription**.</span></span> <span data-ttu-id="02afb-109">Viz [Získání bezplatné zkušební verze Azure](https://azure.microsoft.com/pricing/free-trial/).</span><span class="sxs-lookup"><span data-stu-id="02afb-109">See [Get Azure free trial](https://azure.microsoft.com/pricing/free-trial/).</span></span>
* <span data-ttu-id="02afb-110">**Účet Azure Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="02afb-110">**An Azure Data Lake Store account**.</span></span> <span data-ttu-id="02afb-111">Pokyny o tom, jak vytvořit najdete v tématu [Začínáme s Azure Data Lake Store](data-lake-store-get-started-portal.md).</span><span class="sxs-lookup"><span data-stu-id="02afb-111">For instructions on how to create one, see [Get started with Azure Data Lake Store](data-lake-store-get-started-portal.md).</span></span>
* <span data-ttu-id="02afb-112">**Cluster Azure HDInsight** s přístupem k účtu Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="02afb-112">**An Azure HDInsight cluster** with access to a Data Lake Store account.</span></span> <span data-ttu-id="02afb-113">V tématu [vytvoření clusteru HDInsight s Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span><span class="sxs-lookup"><span data-stu-id="02afb-113">See [Create an HDInsight cluster with Data Lake Store](data-lake-store-hdinsight-hadoop-use-portal.md).</span></span> <span data-ttu-id="02afb-114">Ujistěte se, že povolení vzdálené plochy pro cluster.</span><span class="sxs-lookup"><span data-stu-id="02afb-114">Make sure you enable Remote Desktop for the cluster.</span></span>
* <span data-ttu-id="02afb-115">**Spuštění clusteru Storm v Data Lake Store**.</span><span class="sxs-lookup"><span data-stu-id="02afb-115">**Running a Storm cluster on Data Lake Store**.</span></span> <span data-ttu-id="02afb-116">Další informace najdete v tématu [Storm v HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span><span class="sxs-lookup"><span data-stu-id="02afb-116">For more information, see [Storm on HDInsight](https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-storm-overview).</span></span>
* <span data-ttu-id="02afb-117">**Pokyny v Data Lake Store ladění výkonu**.</span><span class="sxs-lookup"><span data-stu-id="02afb-117">**Performance tuning guidelines on Data Lake Store**.</span></span>  <span data-ttu-id="02afb-118">Obecný výkon koncepty, najdete v části [Data Lake Store výkonu ladění pokyny](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span><span class="sxs-lookup"><span data-stu-id="02afb-118">For general performance concepts, see [Data Lake Store Performance Tuning Guidance](https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-performance-tuning-guidance).</span></span>  

## <a name="tune-the-parallelism-of-the-topology"></a><span data-ttu-id="02afb-119">Vyladění paralelismu topologie</span><span class="sxs-lookup"><span data-stu-id="02afb-119">Tune the parallelism of the topology</span></span>

<span data-ttu-id="02afb-120">Je možné ke zlepšení výkonu zvýšením souběžnosti vstupně-výstupních operací do a z Data Lake Store.</span><span class="sxs-lookup"><span data-stu-id="02afb-120">You might be able to improve performance by increasing the concurrency of the I/O to and from Data Lake Store.</span></span> <span data-ttu-id="02afb-121">Topologie Storm má nastavení konfigurace, které určují paralelismus:</span><span class="sxs-lookup"><span data-stu-id="02afb-121">A Storm topology has a set of configurations that determine the parallelism:</span></span>
* <span data-ttu-id="02afb-122">Počet pracovních procesů (maximální pracovních procesů jsou rovnoměrně rozdělené mezi virtuálními počítači).</span><span class="sxs-lookup"><span data-stu-id="02afb-122">Number of worker processes (the workers are evenly distributed across the VMs).</span></span>
* <span data-ttu-id="02afb-123">Počet instancí vykonavatele funkcí spout.</span><span class="sxs-lookup"><span data-stu-id="02afb-123">Number of spout executor instances.</span></span>
* <span data-ttu-id="02afb-124">Počet instancí vykonavatele funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-124">Number of bolt executor instances.</span></span>
* <span data-ttu-id="02afb-125">Počet funkcí spout úlohy.</span><span class="sxs-lookup"><span data-stu-id="02afb-125">Number of spout tasks.</span></span>
* <span data-ttu-id="02afb-126">Počet úloh funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-126">Number of bolt tasks.</span></span>

<span data-ttu-id="02afb-127">Například v clusteru s 4 virtuální počítače a 4 pracovních procesů, vykonavatelů 32 spout a 32 funkcí spout úkoly a 256 bolt vykonavatelů a 512 bolt úlohy, zvažte následující:</span><span class="sxs-lookup"><span data-stu-id="02afb-127">For example, on a cluster with 4 VMs and 4 worker processes, 32 spout executors and 32 spout tasks, and 256 bolt executors and 512 bolt tasks, consider the following:</span></span>

<span data-ttu-id="02afb-128">Každý nadřízeného, což je pracovního uzlu, má jednoho pracovního procesu Java virtual machine (JVM).</span><span class="sxs-lookup"><span data-stu-id="02afb-128">Each supervisor, which is a worker node, has a single worker Java virtual machine (JVM) process.</span></span> <span data-ttu-id="02afb-129">Tento proces JVM spravuje 4 spout vláken a 64 bolt vláken.</span><span class="sxs-lookup"><span data-stu-id="02afb-129">This JVM process manages 4 spout threads and 64 bolt threads.</span></span> <span data-ttu-id="02afb-130">V rámci každé vlákno se úkoly spouštějí postupně.</span><span class="sxs-lookup"><span data-stu-id="02afb-130">Within each thread, tasks are run sequentially.</span></span> <span data-ttu-id="02afb-131">V předchozí konfiguraci každou funkcí spout vlákno je 1 úkol a každé vlákno bolt má 2 úlohy.</span><span class="sxs-lookup"><span data-stu-id="02afb-131">With the preceding configuration, each spout thread has 1 task, and each bolt thread has 2 tasks.</span></span>

<span data-ttu-id="02afb-132">Tady jsou různé součásti související se situací Storm, a jejich vliv na úroveň stupně paralelního zpracování, které máte:</span><span class="sxs-lookup"><span data-stu-id="02afb-132">In Storm, here are the various components involved, and how they affect the level of parallelism you have:</span></span>
* <span data-ttu-id="02afb-133">Z hlavního uzlu (nazývané Nimbus v Storm) se používá k odeslání a správou úloh.</span><span class="sxs-lookup"><span data-stu-id="02afb-133">The head node (called Nimbus in Storm) is used to submit and manage jobs.</span></span> <span data-ttu-id="02afb-134">Tyto uzly nemají žádný vliv na stupně paralelního zpracování.</span><span class="sxs-lookup"><span data-stu-id="02afb-134">These nodes have no impact on the degree of parallelism.</span></span>
* <span data-ttu-id="02afb-135">Uzly nadřízeného.</span><span class="sxs-lookup"><span data-stu-id="02afb-135">The supervisor nodes.</span></span> <span data-ttu-id="02afb-136">V prostředí HDInsight odpovídá do pracovního uzlu virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="02afb-136">In HDInsight, this corresponds to a worker node Azure VM.</span></span>
* <span data-ttu-id="02afb-137">Úlohy pracovního procesu jsou Storm procesů spuštěných ve virtuálních počítačích.</span><span class="sxs-lookup"><span data-stu-id="02afb-137">The worker tasks are Storm processes running in the VMs.</span></span> <span data-ttu-id="02afb-138">Každý úkol pracovní odpovídá JVM instance.</span><span class="sxs-lookup"><span data-stu-id="02afb-138">Each worker task corresponds to a JVM instance.</span></span> <span data-ttu-id="02afb-139">Storm distribuuje počet pracovních procesů, které určíte jako rovnoměrně k pracovním uzlům.</span><span class="sxs-lookup"><span data-stu-id="02afb-139">Storm distributes the number of worker processes you specify to the worker nodes as evenly as possible.</span></span>
* <span data-ttu-id="02afb-140">Spout a funkce bolt vykonavatele instancí.</span><span class="sxs-lookup"><span data-stu-id="02afb-140">Spout and bolt executor instances.</span></span> <span data-ttu-id="02afb-141">Každá instance vykonavatele odpovídá na vlákno běžící v rámci pracovních procesů (JVMs).</span><span class="sxs-lookup"><span data-stu-id="02afb-141">Each executor instance corresponds to a thread running within the workers (JVMs).</span></span>
* <span data-ttu-id="02afb-142">Storm úlohy.</span><span class="sxs-lookup"><span data-stu-id="02afb-142">Storm tasks.</span></span> <span data-ttu-id="02afb-143">Toto jsou logické úlohy, aby každá z těchto vláken spustit.</span><span class="sxs-lookup"><span data-stu-id="02afb-143">These are logical tasks that each of these threads run.</span></span> <span data-ttu-id="02afb-144">Tím nezmění úroveň paralelismu, takže byste měli zvážit, pokud potřebujete více úkolů na prováděcího modulu, nebo ne.</span><span class="sxs-lookup"><span data-stu-id="02afb-144">This does not change the level of parallelism, so you should evaluate if you need multiple tasks per executor or not.</span></span>

### <a name="get-the-best-performance-from-data-lake-store"></a><span data-ttu-id="02afb-145">Získání nejlepší výkon z Data Lake Store</span><span class="sxs-lookup"><span data-stu-id="02afb-145">Get the best performance from Data Lake Store</span></span>

<span data-ttu-id="02afb-146">Při práci se službou Data Lake Store, získáte nejlepší výkon, pokud byste udělat následující:</span><span class="sxs-lookup"><span data-stu-id="02afb-146">When working with Data Lake Store, you get the best performance if you do the following:</span></span>
* <span data-ttu-id="02afb-147">Sloučení malou připojí do větší velikosti (v ideálním případě 4 MB).</span><span class="sxs-lookup"><span data-stu-id="02afb-147">Coalesce your small appends into larger sizes (ideally 4 MB).</span></span>
* <span data-ttu-id="02afb-148">Počet souběžných požadavků, jak můžete proveďte.</span><span class="sxs-lookup"><span data-stu-id="02afb-148">Do as many concurrent requests as you can.</span></span> <span data-ttu-id="02afb-149">Protože každý podproces bolt provádí blokování čtení, budete chtít mít někde v rozsahu 8-12 vláken na jádra.</span><span class="sxs-lookup"><span data-stu-id="02afb-149">Because each bolt thread is doing blocking reads, you want to have somewhere in the range of 8-12 threads per core.</span></span> <span data-ttu-id="02afb-150">Díky tomu, že síťový adaptér a dobře využito procesoru.</span><span class="sxs-lookup"><span data-stu-id="02afb-150">This keeps the NIC and the CPU well utilized.</span></span> <span data-ttu-id="02afb-151">Větší virtuální počítač umožňuje více souběžných požadavků.</span><span class="sxs-lookup"><span data-stu-id="02afb-151">A larger VM enables more concurrent requests.</span></span>  

### <a name="example-topology"></a><span data-ttu-id="02afb-152">Příklad topologie</span><span class="sxs-lookup"><span data-stu-id="02afb-152">Example topology</span></span>

<span data-ttu-id="02afb-153">Předpokládejme, že máte cluster 8 pracovní uzel s D13v2 virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="02afb-153">Let’s assume you have an 8 worker node cluster with a D13v2 Azure VM.</span></span> <span data-ttu-id="02afb-154">Tento virtuální počítač nemá 8 jader, takže mezi 8 pracovní uzly, budete mít 64 celkový počet jader.</span><span class="sxs-lookup"><span data-stu-id="02afb-154">This VM has 8 cores, so among the 8 worker nodes, you have 64 total cores.</span></span>

<span data-ttu-id="02afb-155">Řekněme, že provedeme 8 vláken bolt na jádra.</span><span class="sxs-lookup"><span data-stu-id="02afb-155">Let’s say we do 8 bolt threads per core.</span></span> <span data-ttu-id="02afb-156">Zadaný 64 jader, která znamená, že chceme 512 celkový bolt vykonavatele instancí (vlákna).</span><span class="sxs-lookup"><span data-stu-id="02afb-156">Given 64 cores, that means we want 512 total bolt executor instances (that is, threads).</span></span> <span data-ttu-id="02afb-157">V takovém případě Řekněme, že jsme začínat jeden JVM na virtuální počítač a používají převážně souběžnosti vláken v rámci systém JVM k dosažení souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="02afb-157">In this case, let’s say we start with one JVM per VM, and mainly use the thread concurrency within the JVM to achieve concurrency.</span></span> <span data-ttu-id="02afb-158">To znamená, že potřebujeme 8 úlohy pracovního procesu (jeden na každý virtuální počítač Azure) a 512 vykonavatelů funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-158">That means we need 8 worker tasks (one per Azure VM), and 512 bolt executors.</span></span> <span data-ttu-id="02afb-159">V této konfiguraci Storm se pokusí distribuovat pracovníci rovnoměrně mezi uzly pracovního procesu (také označované jako nadřízeného uzlů), která poskytuje každý pracovní uzel 1 JVM.</span><span class="sxs-lookup"><span data-stu-id="02afb-159">Given this configuration, Storm tries to distribute the workers evenly across worker nodes (also known as supervisor nodes), giving each worker node 1 JVM.</span></span> <span data-ttu-id="02afb-160">Teď v rámci vedoucí, se pokusí distribuovat vykonavatelů rovnoměrně mezi vedoucí Storm, udělíte každý nadřízeného (JVM) 8 vláken každý.</span><span class="sxs-lookup"><span data-stu-id="02afb-160">Now within the supervisors, Storm tries to distribute the executors evenly between supervisors, giving each supervisor (that is, JVM) 8 threads each.</span></span>

## <a name="tune-additional-parameters"></a><span data-ttu-id="02afb-161">Vyladění dalších parametrů</span><span class="sxs-lookup"><span data-stu-id="02afb-161">Tune additional parameters</span></span>
<span data-ttu-id="02afb-162">Až budete mít základní topologie, můžete zvážit, jestli chcete upravit některý z parametrů:</span><span class="sxs-lookup"><span data-stu-id="02afb-162">After you have the basic topology, you can consider whether you want to tweak any of the parameters:</span></span>
* <span data-ttu-id="02afb-163">**Počet JVMs za pracovního uzlu.**</span><span class="sxs-lookup"><span data-stu-id="02afb-163">**Number of JVMs per worker node.**</span></span> <span data-ttu-id="02afb-164">Pokud máte velké datové struktury (například vyhledávací tabulky) vyžaduje, aby je hostitel v paměti, každý JVM samostatná kopie.</span><span class="sxs-lookup"><span data-stu-id="02afb-164">If you have a large data structure (for example, a lookup table) that you host in memory, each JVM requires a separate copy.</span></span> <span data-ttu-id="02afb-165">Alternativně můžete použít datovou strukturu napříč velký počet vláken, pokud máte méně JVMs.</span><span class="sxs-lookup"><span data-stu-id="02afb-165">Alternatively, you can use the data structure across many threads if you have fewer JVMs.</span></span> <span data-ttu-id="02afb-166">Pro vstupně-výstupních operací bolt počet JVMs neprovede tolik rozdíl jako počet vláken přidat mezi tyto JVMs.</span><span class="sxs-lookup"><span data-stu-id="02afb-166">For the bolt’s I/O, the number of JVMs does not make as much of a difference as the number of threads added across those JVMs.</span></span> <span data-ttu-id="02afb-167">Pro jednoduchost je vhodné mít jeden JVM za pracovního procesu.</span><span class="sxs-lookup"><span data-stu-id="02afb-167">For simplicity, it's a good idea to have one JVM per worker.</span></span> <span data-ttu-id="02afb-168">V závislosti na akci vaše bolt, nebo jaké aplikace je zpracování vyžadují, když budete muset změnit toto číslo.</span><span class="sxs-lookup"><span data-stu-id="02afb-168">Depending on what your bolt is doing or what application processing you require, though, you may need to change this number.</span></span>
* <span data-ttu-id="02afb-169">**Počet vykonavatelů funkcí spout.**</span><span class="sxs-lookup"><span data-stu-id="02afb-169">**Number of spout executors.**</span></span> <span data-ttu-id="02afb-170">Vzhledem k tomu, že v předchozím příkladu používá funkce bolts pro zápis do Data Lake Store, počet funkcích spouts není přímo relevantní pro výkon funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-170">Because the preceding example uses bolts for writing to Data Lake Store, the number of spouts is not directly relevant to the bolt performance.</span></span> <span data-ttu-id="02afb-171">V závislosti na množství zpracování nebo děje v spout vstupně-výstupních operací, je však vhodné pro optimalizaci funkcích spouts pro nejlepší výkon.</span><span class="sxs-lookup"><span data-stu-id="02afb-171">However, depending on the amount of processing or I/O happening in the spout, it's a good idea to tune the spouts for best performance.</span></span> <span data-ttu-id="02afb-172">Ujistěte se, že máte dostatek funkcích spouts, abyste mohli udržovat funkce bolts zaneprázdněný.</span><span class="sxs-lookup"><span data-stu-id="02afb-172">Ensure that you have enough spouts to be able to keep the bolts busy.</span></span> <span data-ttu-id="02afb-173">Výstup míry funkcích spouts by měl odpovídat propustnost funkce bolts.</span><span class="sxs-lookup"><span data-stu-id="02afb-173">The output rates of the spouts should match the throughput of the bolts.</span></span> <span data-ttu-id="02afb-174">Skutečné konfigurace závisí na funkcí spout.</span><span class="sxs-lookup"><span data-stu-id="02afb-174">The actual configuration depends on the spout.</span></span>
* <span data-ttu-id="02afb-175">**Počet úloh.**</span><span class="sxs-lookup"><span data-stu-id="02afb-175">**Number of tasks.**</span></span> <span data-ttu-id="02afb-176">Každý bolt spouští jako jedno vlákno.</span><span class="sxs-lookup"><span data-stu-id="02afb-176">Each bolt runs as a single thread.</span></span> <span data-ttu-id="02afb-177">Další úlohy za bolt neposkytují žádné další souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="02afb-177">Additional tasks per bolt don't provide any additional concurrency.</span></span> <span data-ttu-id="02afb-178">Jenom jednou, které jsou benefitu je, pokud má váš proces to v úvahu řazenou kolekci členů velká část doby provádění funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-178">The only time they are of benefit is if your process of acknowledging the tuple takes a large proportion of your bolt execution time.</span></span> <span data-ttu-id="02afb-179">Je vhodné do skupiny, že mnoho řazených kolekcí členů do větší připojit před odesláním potvrzení z bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-179">It's a good idea to group many tuples into a larger append before you send an acknowledgement from the bolt.</span></span> <span data-ttu-id="02afb-180">Ano ve většině případů poskytují více úkolů žádné další výhody.</span><span class="sxs-lookup"><span data-stu-id="02afb-180">So, in most cases, multiple tasks provide no additional benefit.</span></span>
* <span data-ttu-id="02afb-181">**Místní nebo náhodně seskupení.**</span><span class="sxs-lookup"><span data-stu-id="02afb-181">**Local or shuffle grouping.**</span></span> <span data-ttu-id="02afb-182">Pokud je toto nastavení povoleno, řazené kolekce členů se odesílají do funkcí bolts v rámci stejné pracovní proces.</span><span class="sxs-lookup"><span data-stu-id="02afb-182">When this setting is enabled, tuples are sent to bolts within the same worker process.</span></span> <span data-ttu-id="02afb-183">Tím se snižuje volání mezi procesy komunikace a sítě.</span><span class="sxs-lookup"><span data-stu-id="02afb-183">This reduces inter-process communication and network calls.</span></span> <span data-ttu-id="02afb-184">Toto nastavení se doporučuje pro většinu topologií.</span><span class="sxs-lookup"><span data-stu-id="02afb-184">This is recommended for most topologies.</span></span>

<span data-ttu-id="02afb-185">Tento základní scénář je to dobrý výchozí bod.</span><span class="sxs-lookup"><span data-stu-id="02afb-185">This basic scenario is a good starting point.</span></span> <span data-ttu-id="02afb-186">Testování s vlastními daty upravit předchozí parametry, které chcete dosáhnout optimálního výkonu.</span><span class="sxs-lookup"><span data-stu-id="02afb-186">Test with your own data to tweak the preceding parameters to achieve optimal performance.</span></span>

## <a name="tune-the-spout"></a><span data-ttu-id="02afb-187">Vyladění spout</span><span class="sxs-lookup"><span data-stu-id="02afb-187">Tune the spout</span></span>

<span data-ttu-id="02afb-188">Můžete upravit následující nastavení a vylaďte funkcí spout.</span><span class="sxs-lookup"><span data-stu-id="02afb-188">You can modify the following settings to tune the spout.</span></span>

- <span data-ttu-id="02afb-189">**Časový limit řazené kolekce členů: topology.message.timeout.secs**.</span><span class="sxs-lookup"><span data-stu-id="02afb-189">**Tuple timeout: topology.message.timeout.secs**.</span></span> <span data-ttu-id="02afb-190">Toto nastavení určuje dobu zprávu potřebný k dokončení a přijímat potvrzení, považuje se nezdařilo.</span><span class="sxs-lookup"><span data-stu-id="02afb-190">This setting determines the amount of time a message takes to complete, and receive acknowledgement, before it is considered failed.</span></span>

- <span data-ttu-id="02afb-191">**Maximální paměť na pracovní proces: worker.childopts**.</span><span class="sxs-lookup"><span data-stu-id="02afb-191">**Max memory per worker process: worker.childopts**.</span></span> <span data-ttu-id="02afb-192">Toto nastavení umožňuje určit další parametry příkazového řádku pracovníkům Java.</span><span class="sxs-lookup"><span data-stu-id="02afb-192">This setting lets you specify additional command-line parameters to the Java workers.</span></span> <span data-ttu-id="02afb-193">Nejčastěji používaná nastavení tady je XmX, která určuje maximální velikost paměti přidělené JVM haldě.</span><span class="sxs-lookup"><span data-stu-id="02afb-193">The most commonly used setting here is XmX, which determines the maximum memory allocated to a JVM’s heap.</span></span>

- <span data-ttu-id="02afb-194">**Maximální počet funkcí spout čekající na vyřízení: topology.max.spout.pending**.</span><span class="sxs-lookup"><span data-stu-id="02afb-194">**Max spout pending: topology.max.spout.pending**.</span></span> <span data-ttu-id="02afb-195">Toto nastavení určuje počet řazených kolekcí členů, která může být v cestě (ještě nebyla potvrzena na všechny uzly v topologii) na vlákno spout kdykoli.</span><span class="sxs-lookup"><span data-stu-id="02afb-195">This setting determines the number of tuples that can in be flight (not yet acknowledged at all nodes in the topology) per spout thread at any time.</span></span>

 <span data-ttu-id="02afb-196">Dobrý výpočtu udělat, je odhad velikosti jednotlivých vaší řazené kolekce členů.</span><span class="sxs-lookup"><span data-stu-id="02afb-196">A good calculation to do is to estimate the size of each of your tuples.</span></span> <span data-ttu-id="02afb-197">Potom rozmyslete si, kolik paměti jeden spout vlákno má.</span><span class="sxs-lookup"><span data-stu-id="02afb-197">Then figure out how much memory one spout thread has.</span></span> <span data-ttu-id="02afb-198">Celkové paměti přidělené na vlákno, dělený tato hodnota by měla poskytují horní mez pro maximální spout čekající na vyřízení parametr.</span><span class="sxs-lookup"><span data-stu-id="02afb-198">The total memory allocated to a thread, divided by this value, should give you the upper bound for the max spout pending parameter.</span></span>

## <a name="tune-the-bolt"></a><span data-ttu-id="02afb-199">Vyladění bolt</span><span class="sxs-lookup"><span data-stu-id="02afb-199">Tune the bolt</span></span>
<span data-ttu-id="02afb-200">Pokud píšete do Data Lake Store, nastavte zásady synchronizace velikost (vyrovnávací paměti na straně klienta) na 4 MB.</span><span class="sxs-lookup"><span data-stu-id="02afb-200">When you're writing to Data Lake Store, set a size sync policy (buffer on the client side) to 4 MB.</span></span> <span data-ttu-id="02afb-201">Abyste vyprázdnili nebo hsync() pak provádí jenom v případě, že je velikost vyrovnávací paměti v této hodnotě.</span><span class="sxs-lookup"><span data-stu-id="02afb-201">A flushing or hsync() is then performed only when the buffer size is the at this value.</span></span> <span data-ttu-id="02afb-202">Data Lake Store ovladač v pracovním procesu virtuálního počítače automaticky nemá tato ukládání do vyrovnávací paměti, pokud provádíte explicitně hsync().</span><span class="sxs-lookup"><span data-stu-id="02afb-202">The Data Lake Store driver on the worker VM automatically does this buffering, unless you explicitly perform an hsync().</span></span>

<span data-ttu-id="02afb-203">Data Lake Store Storm bolt výchozí obsahuje parametr zásady synchronizace velikost (fileBufferSize), můžete použít k vyladění tento parametr.</span><span class="sxs-lookup"><span data-stu-id="02afb-203">The default Data Lake Store Storm bolt has a size sync policy parameter (fileBufferSize) that can be used to tune this parameter.</span></span>

<span data-ttu-id="02afb-204">V I náročnými topologie je vhodné tak, aby měl každý podproces bolt zapisovat do vlastního souboru a nastavit zásadu otočení souboru (fileRotationSize).</span><span class="sxs-lookup"><span data-stu-id="02afb-204">In I/O-intensive topologies, it's a good idea to have each bolt thread write to its own file, and to set a file rotation policy (fileRotationSize).</span></span> <span data-ttu-id="02afb-205">Pokud soubor dosáhne určité velikosti, automaticky vyprázdní datového proudu a je zapsaný do nového souboru.</span><span class="sxs-lookup"><span data-stu-id="02afb-205">When the file reaches a certain size, the stream is automatically flushed and a new file is written to.</span></span> <span data-ttu-id="02afb-206">Velikost souboru doporučené pro otočení je 1 GB.</span><span class="sxs-lookup"><span data-stu-id="02afb-206">The recommended file size for rotation is 1 GB.</span></span>

### <a name="handle-tuple-data"></a><span data-ttu-id="02afb-207">Zpracování dat řazené kolekce členů</span><span class="sxs-lookup"><span data-stu-id="02afb-207">Handle tuple data</span></span>

<span data-ttu-id="02afb-208">V Storm funkcích spout obsahuje pro řazené kolekce členů dokud je explicitně potvrzené funkcí bolt.</span><span class="sxs-lookup"><span data-stu-id="02afb-208">In Storm, a spout holds on to a tuple until it is explicitly acknowledged by the bolt.</span></span> <span data-ttu-id="02afb-209">Pokud byl načten funkcí bolt řazené kolekce členů, ale nebyl dosud potvrzeny, nemusí mít spout jako trvalý, do Data Lake Store back-end.</span><span class="sxs-lookup"><span data-stu-id="02afb-209">If a tuple has been read by the bolt but has not been acknowledged yet, the spout might not have persisted into Data Lake Store back end.</span></span> <span data-ttu-id="02afb-210">Po řazené kolekce členů potvrzen, spout můžete záruku stálosti funkcí bolt a můžete pak odstraňte zdrojová data z jakéhokoli zdroje je čtení z.</span><span class="sxs-lookup"><span data-stu-id="02afb-210">After a tuple is acknowledged, the spout can be guaranteed persistence by the bolt, and can then delete the source data from whatever source it is reading from.</span></span>  

<span data-ttu-id="02afb-211">Chcete-li dosáhnout optimálního výkonu v Data Lake Store, máte bolt vyrovnávací paměti 4 MB dat řazené kolekce členů.</span><span class="sxs-lookup"><span data-stu-id="02afb-211">For best performance on Data Lake Store, have the bolt buffer 4 MB of tuple data.</span></span> <span data-ttu-id="02afb-212">Zapište do Data Lake Store zpět end jeden zápis 4 MB.</span><span class="sxs-lookup"><span data-stu-id="02afb-212">Then write to the Data Lake Store back end as one 4-MB write.</span></span> <span data-ttu-id="02afb-213">Po data byla úspěšně zapsána do úložiště (ve volání hflush()) bolt můžete potvrdit data zpět spout.</span><span class="sxs-lookup"><span data-stu-id="02afb-213">After the data has been successfully written to the store (by calling hflush()), the bolt can acknowledge the data back to the spout.</span></span> <span data-ttu-id="02afb-214">Toto je, jaké jsou zde zadané bolt příklad.</span><span class="sxs-lookup"><span data-stu-id="02afb-214">This is what the example bolt supplied here does.</span></span> <span data-ttu-id="02afb-215">Je také přijatelné pro uložení větší počet řazených kolekcí členů, než Přišla žádost hflush() a potvrzené řazené kolekce členů.</span><span class="sxs-lookup"><span data-stu-id="02afb-215">It is also acceptable to hold a larger number of tuples before the hflush() call is made and the tuples acknowledged.</span></span> <span data-ttu-id="02afb-216">Nicméně tím se zvyšuje počet řazených kolekcí členů v cestě spout musí obsahovat, a proto zvyšuje velikost paměti požadované pro prostředí Java Virtual Machine.</span><span class="sxs-lookup"><span data-stu-id="02afb-216">However, this increases the number of tuples in flight that the spout needs to hold, and therefore increases the amount of memory required per JVM.</span></span>

> [!NOTE]
<span data-ttu-id="02afb-217">Aplikace může být potřeba řazených kolekcí členů častěji (na velikosti dat menší než 4 MB) na vědomí z jiných důvodů bez výkonu.</span><span class="sxs-lookup"><span data-stu-id="02afb-217">Applications might have a requirement to acknowledge tuples more frequently (at data sizes less than 4 MB) for other non-performance reasons.</span></span> <span data-ttu-id="02afb-218">Ale, která může ovlivnit propustnost vstupu/výstupu k back-endu úložiště.</span><span class="sxs-lookup"><span data-stu-id="02afb-218">However, that might affect the I/O throughput to the storage back end.</span></span> <span data-ttu-id="02afb-219">Pečlivě zvažte tato kompromis proti bolt vstupně-výstupní výkon.</span><span class="sxs-lookup"><span data-stu-id="02afb-219">Carefully weigh this tradeoff against the bolt’s I/O performance.</span></span>

<span data-ttu-id="02afb-220">Pokud není vysoký počet příchozích řazené kolekce členů, takže vyrovnávací paměti 4 MB trvá dlouhou dobu k vyplnění, zvažte zmírnění tím, že:</span><span class="sxs-lookup"><span data-stu-id="02afb-220">If the incoming rate of tuples is not high, so the 4-MB buffer takes a long time to fill, consider mitigating this by:</span></span>
* <span data-ttu-id="02afb-221">Snížení počtu funkce bolts, takže jsou méně vyrovnávací paměti k vyplnění.</span><span class="sxs-lookup"><span data-stu-id="02afb-221">Reducing the number of bolts, so there are fewer buffers to fill.</span></span>
* <span data-ttu-id="02afb-222">S založené na čase nebo na základě počtu zásad, kde je hflush() spustí každých x vyprázdnění nebo každých milisekundách y a řazené kolekce členů nashromáždila, pokud jsou potvrzené zpět.</span><span class="sxs-lookup"><span data-stu-id="02afb-222">Having a time-based or count-based policy, where an hflush() is triggered every x flushes or every y milliseconds, and the tuples accumulated so far are acknowledged back.</span></span>

<span data-ttu-id="02afb-223">Všimněte si, že propustnost v tomto případě je nižší, ale s pomalým rychlost událostí, maximální propustnost není největších cíl přesto.</span><span class="sxs-lookup"><span data-stu-id="02afb-223">Note that the throughput in this case is lower, but with a slow rate of events, maximum throughput is not the biggest objective anyway.</span></span> <span data-ttu-id="02afb-224">Tyto způsoby zmírnění můžete snížit celkovou dobu, která je potřebná pro řazené kolekce členů mají být předány prostřednictvím úložišti.</span><span class="sxs-lookup"><span data-stu-id="02afb-224">These mitigations help you reduce the total time that it takes for a tuple to flow through to the store.</span></span> <span data-ttu-id="02afb-225">To může být důležité, zda chcete, aby kanál v reálném čase i pomocí rychlost nízkou událostí.</span><span class="sxs-lookup"><span data-stu-id="02afb-225">This might matter if you want a real-time pipeline even with a low event rate.</span></span> <span data-ttu-id="02afb-226">Všimněte si, že pokud vaše míra příchozích řazené kolekce členů je nízké, byste měli upravit parametr topology.message.timeout_secs tak řazené kolekce členů není vypršení časového limitu při jejich načítání do vyrovnávací paměti nebo zpracovat.</span><span class="sxs-lookup"><span data-stu-id="02afb-226">Also note that if your incoming tuple rate is low, you should adjust the topology.message.timeout_secs parameter, so the tuples don’t time out while they are getting buffered or processed.</span></span>

## <a name="monitor-your-topology-in-storm"></a><span data-ttu-id="02afb-227">Monitorování topologie v Storm</span><span class="sxs-lookup"><span data-stu-id="02afb-227">Monitor your topology in Storm</span></span>  
<span data-ttu-id="02afb-228">Je spuštěn topologii, můžete ji sledovat v uživatelském rozhraní Storm.</span><span class="sxs-lookup"><span data-stu-id="02afb-228">While your topology is running, you can monitor it in the Storm user interface.</span></span> <span data-ttu-id="02afb-229">Zde jsou hlavní parametry, které chcete podívejte se na:</span><span class="sxs-lookup"><span data-stu-id="02afb-229">Here are the main parameters to look at:</span></span>

* <span data-ttu-id="02afb-230">**Celkový proces spuštění latence.**</span><span class="sxs-lookup"><span data-stu-id="02afb-230">**Total process execution latency.**</span></span> <span data-ttu-id="02afb-231">Toto je průměrná doba, jakou jeden záznam trvat vysílaných spout, zpracování funkcí bolt a potvrzené.</span><span class="sxs-lookup"><span data-stu-id="02afb-231">This is the average time one tuple takes to be emitted by the spout, processed by the bolt, and acknowledged.</span></span>

* <span data-ttu-id="02afb-232">**Celkový počet bolt proces latence.**</span><span class="sxs-lookup"><span data-stu-id="02afb-232">**Total bolt process latency.**</span></span> <span data-ttu-id="02afb-233">Toto je průměrný čas spotřebovaného řazené kolekce členů v bolt, dokud neobdrží potvrzení.</span><span class="sxs-lookup"><span data-stu-id="02afb-233">This is the average time spent by the tuple at the bolt until it receives an acknowledgement.</span></span>

* <span data-ttu-id="02afb-234">**Celkový počet bolt spustit latence.**</span><span class="sxs-lookup"><span data-stu-id="02afb-234">**Total bolt execute latency.**</span></span> <span data-ttu-id="02afb-235">Toto je průměrný čas strávený funkcí bolt v metoda execute.</span><span class="sxs-lookup"><span data-stu-id="02afb-235">This is the average time spent by the bolt in the execute method.</span></span>

* <span data-ttu-id="02afb-236">**Počet chyb.**</span><span class="sxs-lookup"><span data-stu-id="02afb-236">**Number of failures.**</span></span> <span data-ttu-id="02afb-237">Označuje počet řazených kolekcí členů, které se nepodařilo plně zpracovány před vypršením časového limitu.</span><span class="sxs-lookup"><span data-stu-id="02afb-237">This refers to the number of tuples that failed to be fully processed before they timed out.</span></span>

* <span data-ttu-id="02afb-238">**Kapacity.**</span><span class="sxs-lookup"><span data-stu-id="02afb-238">**Capacity.**</span></span> <span data-ttu-id="02afb-239">Toto je míra je zatížení systému.</span><span class="sxs-lookup"><span data-stu-id="02afb-239">This is a measure of how busy your system is.</span></span> <span data-ttu-id="02afb-240">Pokud tento počet je 1, fungují tak rychle, jak mohou vaše funkce bolts.</span><span class="sxs-lookup"><span data-stu-id="02afb-240">If this number is 1, your bolts are working as fast as they can.</span></span> <span data-ttu-id="02afb-241">Pokud je menší než 1, zvýšit paralelismu.</span><span class="sxs-lookup"><span data-stu-id="02afb-241">If it is less than 1, increase the parallelism.</span></span> <span data-ttu-id="02afb-242">Pokud je větší než 1, snížit paralelismu.</span><span class="sxs-lookup"><span data-stu-id="02afb-242">If it is greater than 1, reduce the parallelism.</span></span>

## <a name="troubleshoot-common-problems"></a><span data-ttu-id="02afb-243">Řešení běžných potíží</span><span class="sxs-lookup"><span data-stu-id="02afb-243">Troubleshoot common problems</span></span>
<span data-ttu-id="02afb-244">Tady jsou několik běžných scénářů řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="02afb-244">Here are a few common troubleshooting scenarios.</span></span>
* <span data-ttu-id="02afb-245">**Mnoho řazených kolekcí členů jsou vypršení časového limitu.**</span><span class="sxs-lookup"><span data-stu-id="02afb-245">**Many tuples are timing out.**</span></span> <span data-ttu-id="02afb-246">Podívejte se na každém uzlu v topologii k určení, kde je kritická místa.</span><span class="sxs-lookup"><span data-stu-id="02afb-246">Look at each node in the topology to determine where the bottleneck is.</span></span> <span data-ttu-id="02afb-247">Nejběžnějším důvodem je, že funkce bolts nejsou schopné udržovat tempo s funkcích spouts.</span><span class="sxs-lookup"><span data-stu-id="02afb-247">The most common reason for this is that the bolts are not able to keep up with the spouts.</span></span> <span data-ttu-id="02afb-248">To vede k zablokování vnitřní vyrovnávací paměti při čekání na zpracování řazené kolekce členů.</span><span class="sxs-lookup"><span data-stu-id="02afb-248">This leads to tuples clogging the internal buffers while waiting to be processed.</span></span> <span data-ttu-id="02afb-249">Zvažte možnost zvýšení hodnoty časového limitu nebo snížení maximální spout čekající na vyřízení.</span><span class="sxs-lookup"><span data-stu-id="02afb-249">Consider increasing the timeout value or decreasing the max spout pending.</span></span>

* <span data-ttu-id="02afb-250">**Je latence vysoké celkový proces spouštění, ale proces latence nízkou bolt.**</span><span class="sxs-lookup"><span data-stu-id="02afb-250">**There is a high total process execution latency, but a low bolt process latency.**</span></span> <span data-ttu-id="02afb-251">V takovém případě je možné, že řazené kolekce členů nejsou potvrzování dostatečně fast.</span><span class="sxs-lookup"><span data-stu-id="02afb-251">In this case, it is possible that the tuples are not being acknowledged fast enough.</span></span> <span data-ttu-id="02afb-252">Zkontrolujte, zda jsou k dispozici dostatečný počet acknowledgers.</span><span class="sxs-lookup"><span data-stu-id="02afb-252">Check that there are a sufficient number of acknowledgers.</span></span> <span data-ttu-id="02afb-253">Další možností je, že při předtím, než funkce bolts spustit, je zpracování čekají ve frontě příliš dlouho.</span><span class="sxs-lookup"><span data-stu-id="02afb-253">Another possibility is that they are waiting in the queue for too long before the bolts start processing them.</span></span> <span data-ttu-id="02afb-254">Snížit maximálního počtu spout čekající na vyřízení.</span><span class="sxs-lookup"><span data-stu-id="02afb-254">Decrease the max spout pending.</span></span>

* <span data-ttu-id="02afb-255">**Je vysoká bolt provést latence.**</span><span class="sxs-lookup"><span data-stu-id="02afb-255">**There is a high bolt execute latency.**</span></span> <span data-ttu-id="02afb-256">To znamená, že metodě execute() vaše bolt trvá příliš dlouho.</span><span class="sxs-lookup"><span data-stu-id="02afb-256">This means that the execute() method of your bolt is taking too long.</span></span> <span data-ttu-id="02afb-257">Optimalizace kódu, nebo podívejte se na velikosti zápisu a vyprázdnit chování.</span><span class="sxs-lookup"><span data-stu-id="02afb-257">Optimize the code, or look at write sizes and flush behavior.</span></span>

### <a name="data-lake-store-throttling"></a><span data-ttu-id="02afb-258">Omezení data Lake Store</span><span class="sxs-lookup"><span data-stu-id="02afb-258">Data Lake Store throttling</span></span>
<span data-ttu-id="02afb-259">Jestli jste nedosáhli omezení šířky pásma poskytuje Data Lake Store, může se zobrazit selhání úkolů.</span><span class="sxs-lookup"><span data-stu-id="02afb-259">If you hit the limits of bandwidth provided by Data Lake Store, you might see task failures.</span></span> <span data-ttu-id="02afb-260">Omezení chyby v protokolech úloh.</span><span class="sxs-lookup"><span data-stu-id="02afb-260">Check task logs for throttling errors.</span></span> <span data-ttu-id="02afb-261">Paralelismus může snížit zvýšením velikosti kontejneru.</span><span class="sxs-lookup"><span data-stu-id="02afb-261">You can decrease the parallelism by increasing container size.</span></span>    

<span data-ttu-id="02afb-262">Pokud chcete zkontrolovat, pokud jste jsou získávání omezené, povolte ladění na straně klienta protokolování:</span><span class="sxs-lookup"><span data-stu-id="02afb-262">To check if you are getting throttled, enable the debug logging on the client side:</span></span>

1. <span data-ttu-id="02afb-263">V **Ambari** > **Storm** > **konfigurace** > **Advanced storm-worker-log4j**, změnit  **&lt;kořenový úroveň = "informace"&gt;**  k  **&lt;kořenový úroveň = "ladění"&gt;**.</span><span class="sxs-lookup"><span data-stu-id="02afb-263">In **Ambari** > **Storm** > **Config** > **Advanced storm-worker-log4j**, change **&lt;root level="info"&gt;** to **&lt;root level=”debug”&gt;**.</span></span> <span data-ttu-id="02afb-264">Restartujte všechny uzly nebo služby pro danou konfiguraci vstoupily v platnost.</span><span class="sxs-lookup"><span data-stu-id="02afb-264">Restart all the nodes/service for the configuration to take effect.</span></span>
2. <span data-ttu-id="02afb-265">Monitorování topologie Storm přihlásí uzlů pracovního procesu (v části /var/log/storm/worker-artifacts /&lt;TopologyName&gt;/&lt;port&gt;/worker.log) pro Data Lake Store omezení výjimky.</span><span class="sxs-lookup"><span data-stu-id="02afb-265">Monitor the Storm topology logs on worker nodes (under /var/log/storm/worker-artifacts/&lt;TopologyName&gt;/&lt;port&gt;/worker.log) for Data Lake Store throttling exceptions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="02afb-266">Další kroky</span><span class="sxs-lookup"><span data-stu-id="02afb-266">Next steps</span></span>
<span data-ttu-id="02afb-267">Optimalizace další výkonu pro Storm může být odkazováno v [tomto blogu](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span><span class="sxs-lookup"><span data-stu-id="02afb-267">Additional performance tuning for Storm can be referenced in [this blog](https://blogs.msdn.microsoft.com/shanyu/2015/05/14/performance-tuning-for-hdinsight-storm-and-microsoft-azure-eventhubs/).</span></span>

<span data-ttu-id="02afb-268">Další příklad ke spuštění, naleznete v části [následujícímu na Githubu](https://github.com/hdinsight/storm-performance-automation).</span><span class="sxs-lookup"><span data-stu-id="02afb-268">For an additional example to run, see [this one on GitHub](https://github.com/hdinsight/storm-performance-automation).</span></span>

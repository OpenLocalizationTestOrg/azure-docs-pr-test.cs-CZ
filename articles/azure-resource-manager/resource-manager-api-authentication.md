---
title: "aaaAzure služby Active Directory ověřování a Resource Manager | Microsoft Docs"
description: "Pro vývojáře průvodce tooauthentication s hello rozhraní API Správce prostředků Azure a Azure Active Directory pro integraci aplikace s jiných předplatných Azure."
services: azure-resource-manager,active-directory
documentationcenter: na
author: dushyantgill
manager: timlt
editor: tysonn
ms.assetid: 17b2b40d-bf42-4c7d-9a88-9938409c5088
ms.service: azure-resource-manager
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.date: 12/27/2016
ms.author: dugill;tomfitz
ms.openlocfilehash: 757e45fdb28488b45de70647746461888bf35a56
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="use-resource-manager-authentication-api-tooaccess-subscriptions"></a><span data-ttu-id="aa8a4-103">Pomocí Správce prostředků ověřování rozhraní API tooaccess odběrů</span><span class="sxs-lookup"><span data-stu-id="aa8a4-103">Use Resource Manager authentication API tooaccess subscriptions</span></span>
## <a name="introduction"></a><span data-ttu-id="aa8a4-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="aa8a4-104">Introduction</span></span>
<span data-ttu-id="aa8a4-105">Pokud jste vývojář softwaru, který potřebuje toocreate aplikaci, která spravuje prostředky Azure zákazníka, v tomto tématu se dozvíte, jak tooauthenticate s hello rozhraní API Správce Azure Resource Manager a získání přístupu tooresources v jiných předplatných.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-105">If you are a software developer who needs toocreate an app that manages customer's Azure resources, this topic shows you how tooauthenticate with hello Azure Resource Manager APIs and gain access tooresources in other subscriptions.</span></span>

<span data-ttu-id="aa8a4-106">Aplikace se můžete dostat hello rozhraní API Resource Manager v několika způsoby:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-106">Your app can access hello Resource Manager APIs in couple of ways:</span></span>

1. <span data-ttu-id="aa8a4-107">**Uživatel + přístup k aplikaci**: pro aplikace, která přistupují k prostředkům jménem přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-107">**User + app access**: for apps that access resources on behalf of a signed-in user.</span></span> <span data-ttu-id="aa8a4-108">Tento postup funguje pro aplikace, jako třeba webové aplikace a nástroje příkazového řádku, které pracují s pouze "interaktivní Správa" prostředků Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-108">This approach works for apps, such as web apps and command-line tools, that deal with only "interactive management" of Azure resources.</span></span>
2. <span data-ttu-id="aa8a4-109">**Přístup jen aplikace**: pro aplikace, které běží démon služeb a naplánované úlohy.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-109">**App-only access**: for apps that run daemon services and scheduled jobs.</span></span> <span data-ttu-id="aa8a4-110">identity aplikace Hello se poskytuje přímý přístup k prostředkům toohello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-110">hello app's identity is granted direct access toohello resources.</span></span> <span data-ttu-id="aa8a4-111">Tento postup funguje pro aplikace, které potřebují dlouhodobé tooAzure bezobslužných (bezobslužná instalace) přístup.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-111">This approach works for apps that need long-term headless (unattended) access tooAzure.</span></span>

<span data-ttu-id="aa8a4-112">Toto téma obsahuje podrobné pokyny toocreate aplikaci, která aktivuje obě tyto metody ověřování.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-112">This topic provides step-by-step instructions toocreate an app that employs both these authorization methods.</span></span> <span data-ttu-id="aa8a4-113">Ukazuje, jak tooperform každý krok REST API nebo C#.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-113">It shows how tooperform each step with REST API or C#.</span></span> <span data-ttu-id="aa8a4-114">Kompletní aplikace ASP.NET MVC Hello je k dispozici na [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-114">hello complete ASP.NET MVC application is available at [https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense](https://github.com/dushyantgill/VipSwapper/tree/master/CloudSense).</span></span>

## <a name="what-hello-web-app-does"></a><span data-ttu-id="aa8a4-115">Nemá jaké hello webové aplikace</span><span class="sxs-lookup"><span data-stu-id="aa8a4-115">What hello web app does</span></span>
<span data-ttu-id="aa8a4-116">Hello webové aplikace:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-116">hello web app:</span></span>

1. <span data-ttu-id="aa8a4-117">Přihlásí uživatele služby Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-117">Signs-in an Azure user.</span></span>
2. <span data-ttu-id="aa8a4-118">Požádá uživatele toogrant hello webové aplikace přístup tooResource správce.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-118">Asks user toogrant hello web app access tooResource Manager.</span></span>
3. <span data-ttu-id="aa8a4-119">Získá uživatele + přístupový token aplikace pro přístup k Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-119">Gets user + app access token for accessing Resource Manager.</span></span>
4. <span data-ttu-id="aa8a4-120">Používá tokenu (z kroku 3) toocall Resource Manager a aplikace hello přiřazení role hlavní tooa služby v rámci předplatného hello, která umožňuje hello aplikace dlouhodobé přístup toohello předplatné.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-120">Uses token (from step 3) toocall Resource Manager and assign hello app's service principal tooa role in hello subscription, which gives hello app long-term access toohello subscription.</span></span>
5. <span data-ttu-id="aa8a4-121">Získá jen aplikace přístupový token.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-121">Gets app-only access token.</span></span>
6. <span data-ttu-id="aa8a4-122">Používá tokenu (z kroku 5) toomanage prostředků v předplatném hello prostřednictvím Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-122">Uses token (from step 5) toomanage resources in hello subscription through Resource Manager.</span></span>

<span data-ttu-id="aa8a4-123">Zde je hello začátku do konce toku hello webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-123">Here's hello end-to-end flow of hello web application.</span></span>

![Tok ověření správce prostředků](./media/resource-manager-api-authentication/Auth-Swim-Lane.png)

<span data-ttu-id="aa8a4-125">Jako uživatel, zadejte id předplatného hello pro předplatné hello chcete toouse:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-125">As a user, you provide hello subscription id for hello subscription you want toouse:</span></span>

![Zadejte id předplatného](./media/resource-manager-api-authentication/sample-ux-1.png)

<span data-ttu-id="aa8a4-127">Vyberte hello toouse účet pro přihlášení.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-127">Select hello account toouse for logging in.</span></span>

![Vyberte účet](./media/resource-manager-api-authentication/sample-ux-2.png)

<span data-ttu-id="aa8a4-129">Zadejte svoje přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-129">Provide your credentials.</span></span>

![Zadejte přihlašovací údaje](./media/resource-manager-api-authentication/sample-ux-3.png)

<span data-ttu-id="aa8a4-131">Udělte tooyour přístupu aplikace hello předplatná Azure:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-131">Grant hello app access tooyour Azure subscriptions:</span></span>

![Udělení přístupu](./media/resource-manager-api-authentication/sample-ux-4.png)

<span data-ttu-id="aa8a4-133">Správa odběrů připojené:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-133">Manage your connected subscriptions:</span></span>

![Připojení odběru](./media/resource-manager-api-authentication/sample-ux-7.png)

## <a name="register-application"></a><span data-ttu-id="aa8a4-135">Registrace aplikace</span><span class="sxs-lookup"><span data-stu-id="aa8a4-135">Register application</span></span>
<span data-ttu-id="aa8a4-136">Než začnete, kódování, zaregistrujte vaší webové aplikace s Azure Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-136">Before you start coding, register your web app with Azure Active Directory (AD).</span></span> <span data-ttu-id="aa8a4-137">registrace aplikace Hello vytvoří centrální identitu pro vaši aplikaci ve službě Azure AD.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-137">hello app registration creates a central identity for your app in Azure AD.</span></span> <span data-ttu-id="aa8a4-138">Že obsahuje základní informace o vaší aplikaci jako ID klienta OAuth, adresy URL odpovědí a pověření, kterou vaše aplikace používá tooauthenticate a přístup k rozhraní API Správce Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-138">It holds basic information about your application like OAuth Client ID, Reply URLs, and credentials that your application uses tooauthenticate and access Azure Resource Manager APIs.</span></span> <span data-ttu-id="aa8a4-139">registrace aplikace Hello taky zaznamenává hello různé delegovaná oprávnění, které aplikace potřebuje při přístupu k Microsoft APIs jménem uživatele hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-139">hello app registration also records hello various delegated permissions that your application needs when accessing Microsoft APIs on behalf of hello user.</span></span>

<span data-ttu-id="aa8a4-140">Vzhledem k tomu, že vaše aplikace přístup k jiné předplatné, musíte ho nakonfigurovat jako víceklientské aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-140">Because your app accesses other subscription, you must configure it as a multi-tenant application.</span></span> <span data-ttu-id="aa8a4-141">ověření toopass, poskytovat domény přidružené k vaší služby Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-141">toopass validation, provide a domain associated with your Azure Active Directory.</span></span> <span data-ttu-id="aa8a4-142">toosee hello domény přidružené k Azure Active Directory, přihlášení toohello [portálu classic](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-142">toosee hello domains associated with your Azure Active Directory, log in toohello [classic portal](https://manage.windowsazure.com).</span></span> <span data-ttu-id="aa8a4-143">Vyberte služby Azure Active Directory a pak vyberte **domény**.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-143">Select your Azure Active Directory and then select **Domains**.</span></span>

<span data-ttu-id="aa8a4-144">Hello následující příklad ukazuje, jak tooregister hello aplikace pomocí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-144">hello following example shows how tooregister hello app by using Azure PowerShell.</span></span> <span data-ttu-id="aa8a4-145">Musíte mít hello nejnovější verzi (srpna 2016) prostředí Azure PowerShell pro tento příkaz toowork.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-145">You must have hello latest version (August 2016) of Azure PowerShell for this command toowork.</span></span>

    $app = New-AzureRmADApplication -DisplayName "{app name}" -HomePage "https://{your domain}/{app name}" -IdentifierUris "https://{your domain}/{app name}" -Password "{your password}" -AvailableToOtherTenants $true

<span data-ttu-id="aa8a4-146">toolog v jako hello AD aplikace, musíte hello aplikace id a heslo.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-146">toolog in as hello AD application, you need hello application id and password.</span></span> <span data-ttu-id="aa8a4-147">id aplikace hello toosee vrácená hello předchozí příkaz, použijte:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-147">toosee hello application id that is returned from hello previous command, use:</span></span>

    $app.ApplicationId

<span data-ttu-id="aa8a4-148">Hello následující příklad ukazuje, jak tooregister hello aplikace pomocí rozhraní příkazového řádku Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-148">hello following example shows how tooregister hello app by using Azure CLI.</span></span>

    azure ad app create --name {app name} --home-page https://{your domain}/{app name} --identifier-uris https://{your domain}/{app name} --password {your password} --available true

<span data-ttu-id="aa8a4-149">Hello výsledky obsahovat hello AppId, který je třeba při ověřování jako aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-149">hello results include hello AppId, which you need when authenticating as hello application.</span></span>

### <a name="optional-configuration---certificate-credential"></a><span data-ttu-id="aa8a4-150">Volitelné konfigurace – certifikát přihlašovacích údajů</span><span class="sxs-lookup"><span data-stu-id="aa8a4-150">Optional configuration - certificate credential</span></span>
<span data-ttu-id="aa8a4-151">Azure AD podporuje přihlašovací údaje certifikátu pro aplikace: vytvoření certifikátu podepsaného svým držitelem, zachovat hello privátní klíč a přidejte registrace aplikace hello veřejného klíče tooyour Azure AD.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-151">Azure AD also supports certificate credentials for applications: you create a self-signed cert, keep hello private key, and add hello public key tooyour Azure AD application registration.</span></span> <span data-ttu-id="aa8a4-152">Pro ověřování vaše aplikace odešle malé datové části tooAzure AD podepsaná pomocí soukromého klíče a Azure AD ověří podpis hello pomocí hello veřejného klíče, který je zaregistrovaný.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-152">For authentication, your application sends a small payload tooAzure AD signed using your private key, and Azure AD validates hello signature using hello public key that you registered.</span></span>

<span data-ttu-id="aa8a4-153">Informace o vytvoření aplikace AD pomocí certifikátu najdete v tématu [toocreate použití Azure PowerShell objekt služby prostředků tooaccess](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) nebo [použití Azure CLI toocreate objekt služby tooaccess prostředky](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-153">For information about creating an AD app with a certificate, see [Use Azure PowerShell toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal.md#create-service-principal-with-certificate-from-certificate-authority) or [Use Azure CLI toocreate a service principal tooaccess resources](resource-group-authenticate-service-principal-cli.md#create-service-principal-with-certificate).</span></span>

## <a name="get-tenant-id-from-subscription-id"></a><span data-ttu-id="aa8a4-154">Získání id klienta z id předplatného</span><span class="sxs-lookup"><span data-stu-id="aa8a4-154">Get tenant id from subscription id</span></span>
<span data-ttu-id="aa8a4-155">toorequest token, který lze použít toocall Resource Manager, aplikace musí ID klienta hello tooknow klienta hello Azure AD, který je hostitelem hello předplatného Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-155">toorequest a token that can be used toocall Resource Manager, your application needs tooknow hello tenant ID of hello Azure AD tenant that hosts hello Azure subscription.</span></span> <span data-ttu-id="aa8a4-156">S největší pravděpodobností vaši uživatelé věděli, jejich ID předplatného, ale nemusí věděli, jejich klienta ID pro Azure Active Directory.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-156">Most likely, your users know their subscription ids, but they might not know their tenant ids for Azure Active Directory.</span></span> <span data-ttu-id="aa8a4-157">tooget hello id uživatele klienta, požádejte uživatele hello pro id předplatného hello. Při odesílání žádosti o předplatném hello, zadejte toto id předplatného:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-157">tooget hello user's tenant id, ask hello user for hello subscription id. Provide that subscription id when sending a request about hello subscription:</span></span>

    https://management.azure.com/subscriptions/{subscription-id}?api-version=2015-01-01

<span data-ttu-id="aa8a4-158">Hello požadavek selže, protože hello uživatel nebyl ještě přihlášen, ale můžete načíst id klienta hello z hello odpovědi.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-158">hello request fails because hello user has not logged in yet, but you can retrieve hello tenant id from hello response.</span></span> <span data-ttu-id="aa8a4-159">V této výjimky načíst id klienta hello z hello hodnotu hlavičky odpovědi pro **WWW-Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-159">In that exception, retrieve hello tenant id from hello response header value for **WWW-Authenticate**.</span></span> <span data-ttu-id="aa8a4-160">Zobrazí tuto implementaci v hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) metoda.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-160">You see this implementation in hello [GetDirectoryForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L20) method.</span></span>

## <a name="get-user--app-access-token"></a><span data-ttu-id="aa8a4-161">Získat uživatele + přístupový token aplikace</span><span class="sxs-lookup"><span data-stu-id="aa8a4-161">Get user + app access token</span></span>
<span data-ttu-id="aa8a4-162">Vaše aplikace přesměruje tooAzure hello uživatele AD s OAuth 2.0 autorizace požadavku - přihlašovacích údajů tooauthenticate hello uživatele a získat zpátky autorizační kód.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-162">Your application redirects hello user tooAzure AD with an OAuth 2.0 Authorize Request - tooauthenticate hello user's credentials and get back an authorization code.</span></span> <span data-ttu-id="aa8a4-163">Vaše aplikace používá hello autorizační kód tooget přístupový token pro Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-163">Your application uses hello authorization code tooget an access token for Resource Manager.</span></span> <span data-ttu-id="aa8a4-164">Hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) metoda vytvoří žádost o ověření hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-164">hello [ConnectSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/Controllers/HomeController.cs#L42) method creates hello authorization request.</span></span>

<span data-ttu-id="aa8a4-165">Toto téma ukazuje hello REST API požadavky tooauthenticate hello uživatele.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-165">This topic shows hello REST API requests tooauthenticate hello user.</span></span> <span data-ttu-id="aa8a4-166">Můžete také pomocné knihovny tooperform ověřování ve vašem kódu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-166">You can also use helper libraries tooperform authentication in your code.</span></span> <span data-ttu-id="aa8a4-167">Další informace o tyto knihovny najdete v tématu [knihovny Azure Active Directory Authentication](../active-directory/active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-167">For more information about these libraries, see [Azure Active Directory Authentication Libraries](../active-directory/active-directory-authentication-libraries.md).</span></span> <span data-ttu-id="aa8a4-168">Pokyny k integraci správy identit v aplikaci najdete v tématu [Příručka pro vývojáře Azure Active Directory](../active-directory/active-directory-developers-guide.md).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-168">For guidance on integrating identity management in an application, see [Azure Active Directory developer's guide](../active-directory/active-directory-developers-guide.md).</span></span>

### <a name="auth-request-oauth-20"></a><span data-ttu-id="aa8a4-169">Žádost o ověření (OAuth 2.0)</span><span class="sxs-lookup"><span data-stu-id="aa8a4-169">Auth request (OAuth 2.0)</span></span>
<span data-ttu-id="aa8a4-170">Vydejte koncový Open ID Connect/OAuth2.0 autorizace požadavku Authorize toohello Azure AD:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-170">Issue an Open ID Connect/OAuth2.0 Authorize Request toohello Azure AD Authorize endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize

<span data-ttu-id="aa8a4-171">Hello parametrů řetězce dotazu, které jsou k dispozici pro tento požadavek, jsou popsané v hello [autorizační kód požadavku](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) tématu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-171">hello query string parameters that are available for this request are described in hello [request an authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#request-an-authorization-code) topic.</span></span>

<span data-ttu-id="aa8a4-172">Následující příklad ukazuje, jak Hello toorequest OAuth2.0 autorizace:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-172">hello following example shows how toorequest OAuth2.0 authorization:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=query&response_type=code&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&domain_hint=live.com

<span data-ttu-id="aa8a4-173">Azure AD ověřuje uživatele hello a v případě potřeby požádá hello uživatele toogrant oprávnění toohello aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-173">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="aa8a4-174">Vrátí hello autorizační kód toohello adresa URL odpovědi vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-174">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="aa8a4-175">V závislosti na hello požadovaný response_mode, Azure AD buď odesílají zpět hello data v řetězci dotazu nebo jako post data.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-175">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

    code=AAABAAAAiL****FDMZBUwZ8eCAA&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="auth-request-open-id-connect"></a><span data-ttu-id="aa8a4-176">Žádost o ověření (Open ID Connect)</span><span class="sxs-lookup"><span data-stu-id="aa8a4-176">Auth request (Open ID Connect)</span></span>
<span data-ttu-id="aa8a4-177">Pokud nejen chcete tooaccess Azure Resource Manager jménem uživatele hello, ale také povolit hello uživatele toosign v tooyour aplikaci pomocí svého účtu Azure AD, vydejte Open ID připojení autorizaci požadavků.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-177">If you not only wish tooaccess Azure Resource Manager on behalf of hello user, but also allow hello user toosign in tooyour application using their Azure AD account, issue an Open ID Connect Authorize Request.</span></span> <span data-ttu-id="aa8a4-178">Aplikace s Open ID Connect také přijímá požadavku id_token z Azure AD, vaše aplikace můžete použít toosign v hello uživatele.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-178">With Open ID Connect, your application also receives an id_token from Azure AD that your app can use toosign in hello user.</span></span>

<span data-ttu-id="aa8a4-179">Hello parametrů řetězce dotazu, které jsou k dispozici pro tento požadavek, jsou popsané v hello [hello přihlašovací požadavek na odeslání](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) tématu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-179">hello query string parameters that are available for this request are described in hello [Send hello sign-in request](../active-directory/develop/active-directory-protocols-openid-connect-code.md#send-the-sign-in-request) topic.</span></span>

<span data-ttu-id="aa8a4-180">Jedná se o příklad Open ID Connect žádost:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-180">An example Open ID Connect request is:</span></span>

     https://login.microsoftonline.com/{tenant-id}/OAuth2/Authorize?client_id=a0448380-c346-4f9f-b897-c18733de9394&response_mode=form_post&response_type=code+id_token&redirect_uri=http%3a%2f%2fwww.vipswapper.com%2fcloudsense%2fAccount%2fSignIn&resource=https%3a%2f%2fgraph.windows.net%2f&scope=openid+profile&nonce=63567Dc4MDAw&domain_hint=live.com&state=M_12tMyKaM8

<span data-ttu-id="aa8a4-181">Azure AD ověřuje uživatele hello a v případě potřeby požádá hello uživatele toogrant oprávnění toohello aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-181">Azure AD authenticates hello user, and, if necessary, asks hello user toogrant permission toohello app.</span></span> <span data-ttu-id="aa8a4-182">Vrátí hello autorizační kód toohello adresa URL odpovědi vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-182">It returns hello authorization code toohello Reply URL of your application.</span></span> <span data-ttu-id="aa8a4-183">V závislosti na hello požadovaný response_mode, Azure AD buď odesílají zpět hello data v řetězci dotazu nebo jako post data.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-183">Depending on hello requested response_mode, Azure AD either sends back hello data in query string or as post data.</span></span>

<span data-ttu-id="aa8a4-184">Příklad Open ID Connect odpověď je:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-184">An example Open ID Connect response is:</span></span>

    code=AAABAAAAiL*****I4rDWd7zXsH6WUjlkIEQxIAA&id_token=eyJ0eXAiOiJKV1Q*****T3GrzzSFxg&state=M_12tMyKaM8&session_state=2d16bbce-d5d1-443f-acdf-75f6b0ce8850

### <a name="token-request-oauth20-code-grant-flow"></a><span data-ttu-id="aa8a4-185">Žádosti o token (OAuth2.0 kód Grant toku)</span><span class="sxs-lookup"><span data-stu-id="aa8a4-185">Token request (OAuth2.0 Code Grant Flow)</span></span>
<span data-ttu-id="aa8a4-186">Teď, když vaše aplikace přijal hello autorizační kód z Azure AD, je čas tooget hello přístupový token pro Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-186">Now that your application has received hello authorization code from Azure AD, it is time tooget hello access token for Azure Resource Manager.</span></span>  <span data-ttu-id="aa8a4-187">POST OAuth2.0 kód Grant tokenu žádosti o toohello Azure AD tokenu koncový bod:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-187">Post an OAuth2.0 Code Grant Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="aa8a4-188">Hello parametrů řetězce dotazu, které jsou k dispozici pro tento požadavek, jsou popsané v hello [použít hello autorizační kód](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) tématu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-188">hello query string parameters that are available for this request are described in hello [use hello authorization code](../active-directory/develop/active-directory-protocols-oauth-code.md#use-the-authorization-code-to-request-an-access-token) topic.</span></span>

<span data-ttu-id="aa8a4-189">Hello následující příklad ukazuje žádost o token grant kód s pověřením heslo:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-189">hello following example shows a request for code grant token with password credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="aa8a4-190">Při práci s přihlašovací údaje certifikátu, vytvořte Token pro webové JSON (JWT) a přihlašovací (RSA SHA256) pomocí hello privátní klíč certifikátu pověření vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-190">When working with certificate credentials, create a JSON Web Token (JWT) and sign (RSA SHA256) using hello private key of your application's certificate credential.</span></span> <span data-ttu-id="aa8a4-191">Hello typy deklarací identity pro hello token se zobrazují v [deklarace tokenů JWT](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-191">hello claim types for hello token are shown in [JWT token claims](../active-directory/develop/active-directory-protocols-oauth-code.md#jwt-token-claims).</span></span> <span data-ttu-id="aa8a4-192">Odkaz, najdete v části hello [knihovna ověřování Active Directory (.NET) kód](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign klienta Assertion Kompaktních tokenů jwt.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-192">For reference, see hello [Active Directory Auth Library (.NET) code](https://github.com/AzureAD/azure-activedirectory-library-for-dotnet/blob/dev/src/ADAL.PCL.Desktop/CryptographyHelper.cs) toosign Client Assertion JWT tokens.</span></span>

<span data-ttu-id="aa8a4-193">V tématu hello [Open ID Connect specifikace](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) podrobnosti o ověření klienta.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-193">See hello [Open ID Connect spec](http://openid.net/specs/openid-connect-core-1_0.html#ClientAuthentication) for details on client authentication.</span></span>

<span data-ttu-id="aa8a4-194">Hello následující příklad ukazuje žádost o token grant kód s certifikát přihlašovacích údajů:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-194">hello following example shows a request for code grant token with certificate credential:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=authorization_code&code=AAABAAAAiL9Kn2Z*****L1nVMH3Z5ESiAA&redirect_uri=http%3A%2F%2Flocalhost%3A62080%2FAccount%2FSignIn&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_assertion_type=urn%3Aietf%3Aparams%3Aoauth%3Aclient-assertion-type%3Ajwt-bearer&client_assertion=eyJhbG*****Y9cYo8nEjMyA

<span data-ttu-id="aa8a4-195">Odpověď příklad pro kód udělit token:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-195">An example response for code grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039858","not_before":"1432035958","resource":"https://management.core.windows.net/","access_token":"eyJ0eXAiOiJKV1Q****M7Cw6JWtfY2lGc5A","refresh_token":"AAABAAAAiL9Kn2Z****55j-sjnyYgAA","scope":"user_impersonation","id_token":"eyJ0eXAiOiJKV*****-drP1J3P-HnHi9Rr46kGZnukEBH4dsg"}

#### <a name="handle-code-grant-token-response"></a><span data-ttu-id="aa8a4-196">Zpracování odpovědi tokenu grant kódu</span><span class="sxs-lookup"><span data-stu-id="aa8a4-196">Handle code grant token response</span></span>
<span data-ttu-id="aa8a4-197">Úspěšné odpovědi tokenu obsahuje přístupový token hello (uživatele + aplikace) pro Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-197">A successful token response contains hello (user + app) access token for Azure Resource Manager.</span></span> <span data-ttu-id="aa8a4-198">Vaše aplikace používá tento přístup tokenu tooaccess Resource Manager jménem uživatele hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-198">Your application uses this access token tooaccess Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="aa8a4-199">Doba platnosti Hello přístupové tokeny vydané službou Azure AD je jedna hodina.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-199">hello lifetime of access tokens issued by Azure AD is one hour.</span></span> <span data-ttu-id="aa8a4-200">Není pravděpodobné, že vaše webová aplikace musí toorenew hello (uživatele + aplikace) přístupový token.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-200">It is unlikely that your web application needs toorenew hello (user + app) access token.</span></span> <span data-ttu-id="aa8a4-201">Pokud je toorenew hello přístupový token, použijte hello token obnovení, které aplikace přijímá v odpovědi tokenu hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-201">If it needs toorenew hello access token, use hello refresh token that your application receives in hello token response.</span></span> <span data-ttu-id="aa8a4-202">Vystavení tokenu požadavku OAuth2.0 toohello Azure AD tokenu koncový bod:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-202">Post an OAuth2.0 Token Request toohello Azure AD Token endpoint:</span></span>

    https://login.microsoftonline.com/{tenant-id}/OAuth2/Token

<span data-ttu-id="aa8a4-203">Hello toouse parametry s požadavek refresh hello jsou popsány v [aktualizace hello přístupový token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-203">hello parameters toouse with hello refresh request are described in [refreshing hello access token](../active-directory/develop/active-directory-protocols-oauth-code.md#refreshing-the-access-tokens).</span></span>

<span data-ttu-id="aa8a4-204">Hello následující příklad ukazuje, jak toouse hello aktualizovat token:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-204">hello following example shows how toouse hello refresh token:</span></span>

    POST https://login.microsoftonline.com/7fe877e6-a150-4992-bbfe-f517e304dfa0/oauth2/token HTTP/1.1

    Content-Type: application/x-www-form-urlencoded
    Content-Length: 1012

    grant_type=refresh_token&refresh_token=AAABAAAAiL9Kn2Z****55j-sjnyYgAA&client_id=a0448380-c346-4f9f-b897-c18733de9394&client_secret=olna84E8*****goScOg%3D

<span data-ttu-id="aa8a4-205">I když tokeny obnovení může být použité tooget nové přístupové tokeny pro Azure Resource Manager, nejsou vhodné pro offline přístup k vaší aplikací.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-205">Although refresh tokens can be used tooget new access tokens for Azure Resource Manager, they are not suitable for offline access by your application.</span></span> <span data-ttu-id="aa8a4-206">Doba platnosti tokenů aktualizace Hello je omezený a obnovovacích tokenů jsou vázané toohello uživatele.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-206">hello refresh tokens lifetime is limited, and refresh tokens are bound toohello user.</span></span> <span data-ttu-id="aa8a4-207">Pokud uživatel hello opustí organizaci hello, ztrátě hello aplikace pomocí hello obnovovací token přístupu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-207">If hello user leaves hello organization, hello application using hello refresh token loses access.</span></span> <span data-ttu-id="aa8a4-208">Tento přístup není vhodný pro aplikace, které jsou používané týmy toomanage svých prostředků Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-208">This approach isn't suitable for applications that are used by teams toomanage their Azure resources.</span></span>

## <a name="check-if-user-can-assign-access-toosubscription"></a><span data-ttu-id="aa8a4-209">Zkontrolujte, pokud uživatele lze přiřadit toosubscription přístup</span><span class="sxs-lookup"><span data-stu-id="aa8a4-209">Check if user can assign access toosubscription</span></span>
<span data-ttu-id="aa8a4-210">Aplikace nyní obsahuje token tooaccess Azure Resource Manager jménem uživatele hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-210">Your application now has a token tooaccess Azure Resource Manager on behalf of hello user.</span></span> <span data-ttu-id="aa8a4-211">dalším krokem Hello je tooconnect předplatné toohello aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-211">hello next step is tooconnect your app toohello subscription.</span></span> <span data-ttu-id="aa8a4-212">Po připojení, vaše aplikace může spravovat tyto odběry i v případě, že hello uživatel není přítomen (dlouhodobé offline přístup).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-212">After connecting, your app can manage those subscriptions even when hello user isn't present (long-term offline access).</span></span>

<span data-ttu-id="aa8a4-213">Pro každé předplatné tooconnect volání hello [seznamu oprávnění správce prostředků](https://docs.microsoft.com/rest/api/authorization/permissions) rozhraní API toodetermine jestli hello uživatel nemá přístupová práva správy pro předplatné hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-213">For each subscription tooconnect, call hello [Resource Manager list permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API toodetermine whether hello user has access management rights for hello subscription.</span></span>

<span data-ttu-id="aa8a4-214">Hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) metoda hello ukázkovou aplikaci ASP.NET MVC implementuje toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-214">hello [UserCanManagerAccessForSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L44) method of hello ASP.NET MVC sample app implements this call.</span></span>

<span data-ttu-id="aa8a4-215">Následující příklad ukazuje, jak Hello toorequest oprávnění uživatele na předplatném.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-215">hello following example shows how toorequest a user's permissions on a subscription.</span></span> <span data-ttu-id="aa8a4-216">83cfe939-2402-4581-b761-4f59b0a041e4 je hello id předplatného hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-216">83cfe939-2402-4581-b761-4f59b0a041e4 is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/83cfe939-2402-4581-b761-4f59b0a041e4/providers/microsoft.authorization/permissions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiLC***lwO1mM7Cw6JWtfY2lGc5A

<span data-ttu-id="aa8a4-217">Příkladem hello odpovědi tooget oprávnění uživatele na základě předplatného je:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-217">An example of hello response tooget user's permissions on subscription is:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"actions":["*"],"notActions":["Microsoft.Authorization/*/Write","Microsoft.Authorization/*/Delete"]},{"actions":["*/read"],"notActions":[]}]}

<span data-ttu-id="aa8a4-218">oprávnění Hello rozhraní API vrátí více oprávnění.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-218">hello permissions API returns multiple permissions.</span></span> <span data-ttu-id="aa8a4-219">Každé oprávnění se skládá z povolených akcí (akce) a zakázané akce (notactions).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-219">Each permission consists of allowed actions (actions) and disallowed actions (notactions).</span></span> <span data-ttu-id="aa8a4-220">Pokud je součástí hello povolené akce seznam všech oprávnění a není přítomný v seznamu notactions hello tohoto oprávnění, hello uživatele je povoleno tooperform této akce.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-220">If an action is present in hello allowed actions list of any permission and not present in hello notactions list of that permission, hello user is allowed tooperform that action.</span></span> <span data-ttu-id="aa8a4-221">**Microsoft.Authorization/RoleAssignments/Write** je hello akce, který uděluje přístup práva pro správu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-221">**microsoft.authorization/roleassignments/write** is hello action that that grants access management rights.</span></span> <span data-ttu-id="aa8a4-222">Aplikace musí analyzovat hello oprávnění výsledek toolook regex shodu se tento řetězec akce v hello akce a notactions jednotlivých oprávnění.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-222">Your application must parse hello permissions result toolook for a regex match on this action string in hello actions and notactions of each permission.</span></span>

## <a name="get-app-only-access-token"></a><span data-ttu-id="aa8a4-223">Získání tokenu přístupu jen aplikace</span><span class="sxs-lookup"><span data-stu-id="aa8a4-223">Get app-only access token</span></span>
<span data-ttu-id="aa8a4-224">Teď víte-li hello uživatele můžete přiřadit přístup toohello předplatného Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-224">Now, you know if hello user can assign access toohello Azure subscription.</span></span> <span data-ttu-id="aa8a4-225">Další kroky Hello jsou:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-225">hello next steps are:</span></span>

1. <span data-ttu-id="aa8a4-226">Přiřaďte hello odpovídající RBAC role tooyour identitu aplikace v předplatném hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-226">Assign hello appropriate RBAC role tooyour application's identity on hello subscription.</span></span>
2. <span data-ttu-id="aa8a4-227">Ověření přiřazení přístupu hello pomocí dotazů na oprávnění hello aplikace v předplatném hello nebo přímým přístupem Resource Manager pomocí tokenu jen aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-227">Validate hello access assignment by querying for hello Application's permission on hello subscription or by accessing Resource Manager using app-only token.</span></span>
3. <span data-ttu-id="aa8a4-228">Záznamů hello připojení ve struktuře vaší aplikace "připojené odběry" data - uložením hello id předplatného hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-228">Record hello connection in your applications "connected subscriptions" data structure - persisting hello id of hello subscription.</span></span>

<span data-ttu-id="aa8a4-229">Podíváme blíže v prvním kroku hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-229">Let's look closer at hello first step.</span></span> <span data-ttu-id="aa8a4-230">tooassign hello odpovídající RBAC role toohello identitu aplikace, je třeba určit:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-230">tooassign hello appropriate RBAC role toohello application's identity, you must determine:</span></span>

* <span data-ttu-id="aa8a4-231">id objektu Hello identity aplikace v hello uživatele Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="aa8a4-231">hello object id of your application's identity in hello user's Azure Active Directory</span></span>
* <span data-ttu-id="aa8a4-232">identifikátor Hello role RBAC hello, který vaše aplikace vyžaduje v předplatném hello</span><span class="sxs-lookup"><span data-stu-id="aa8a4-232">hello identifier of hello RBAC role that your application requires on hello subscription</span></span>

<span data-ttu-id="aa8a4-233">Když se aplikace ověřuje uživatele z Azure AD, vytvoří objekt služby zabezpečení pro vaši aplikaci v této službě Azure AD.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-233">When your application authenticates a user from an Azure AD, it creates a service principal object for your application in that Azure AD.</span></span> <span data-ttu-id="aa8a4-234">Azure umožňuje toobe role RBAC přiřazené objekty zabezpečení tooservice toogrant přímý přístup toocorresponding aplikací na prostředky Azure.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-234">Azure allows RBAC roles toobe assigned tooservice principals toogrant direct access toocorresponding applications on Azure resources.</span></span> <span data-ttu-id="aa8a4-235">Tato akce je přesně co jsme chcete toodo.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-235">This action is exactly what we wish toodo.</span></span> <span data-ttu-id="aa8a4-236">Dotaz hello Azure AD Graph API toodetermine hello identifikátor objektu služby hello vaší aplikace v hello přihlášeného uživatele je Azure AD.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-236">Query hello Azure AD Graph API toodetermine hello identifier of hello service principal of your application in hello signed-in user's Azure AD.</span></span>

<span data-ttu-id="aa8a4-237">Můžete mít pouze přístupový token pro Azure Resource Manager – budete potřebovat nové hello tokenu toocall přístup k Azure AD Graph API.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-237">You only have an access token for Azure Resource Manager - you need a new access token toocall hello Azure AD Graph API.</span></span> <span data-ttu-id="aa8a4-238">Každá aplikace ve službě Azure AD má oprávnění tooquery vlastní objekt zabezpečení služby, stačí jen aplikace přístupový token.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-238">Every application in Azure AD has permission tooquery its own service principal object, so an app-only access token is sufficient.</span></span>

<a id="app-azure-ad-graph" />

### <a name="get-app-only-access-token-for-azure-ad-graph-api"></a><span data-ttu-id="aa8a4-239">Získání tokenu přístupu jen pro aplikace pro Azure AD Graph API</span><span class="sxs-lookup"><span data-stu-id="aa8a4-239">Get app-only access token for Azure AD Graph API</span></span>
<span data-ttu-id="aa8a4-240">tooauthenticate vaší aplikace a získání tokenu tooAzure AD Graph API, vydávání OAuth2.0 udělení pověření klienta tok požadavku na token tooAzure AD koncový bod tokenu (**https://login.microsoftonline.com/ {directory_domain_name} / OAuth2/Token**).</span><span class="sxs-lookup"><span data-stu-id="aa8a4-240">tooauthenticate your app and get a token tooAzure AD Graph API, issue a Client Credential Grant OAuth2.0 flow token request tooAzure AD token endpoint (**https://login.microsoftonline.com/{directory_domain_name}/OAuth2/Token**).</span></span>

<span data-ttu-id="aa8a4-241">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) metoda hello ukázkovou aplikaci ASP.net MVC získá token pro používání rozhraní Graph API přístup jen aplikace hello Active Directory Authentication Library pro .NET.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-241">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs) method of hello ASP.net MVC sample application gets an app-only access token for Graph API using hello Active Directory Authentication Library for .NET.</span></span>

<span data-ttu-id="aa8a4-242">Hello parametrů řetězce dotazu, které jsou k dispozici pro tento požadavek, jsou popsané v hello [žádosti Token přístupu](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) tématu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-242">hello query string parameters that are available for this request are described in hello [Request an Access Token](../active-directory/develop/active-directory-protocols-oauth-service-to-service.md#request-an-access-token) topic.</span></span>

<span data-ttu-id="aa8a4-243">Požadavek příklad token udělení pověření klienta:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-243">An example request for client credential grant token:</span></span>

    POST https://login.microsoftonline.com/62e173e9-301e-423e-bcd4-29121ec1aa24/oauth2/token HTTP/1.1
    Content-Type: application/x-www-form-urlencoded
    Content-Length: 187</pre>
    <pre>grant_type=client_credentials&client_id=a0448380-c346-4f9f-b897-c18733de9394&resource=https%3A%2F%2Fgraph.windows.net%2F &client_secret=olna8C*****Og%3D

<span data-ttu-id="aa8a4-244">Odpověď příklad token udělení pověření klienta:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-244">An example response for client credential grant token:</span></span>

    HTTP/1.1 200 OK

    {"token_type":"Bearer","expires_in":"3599","expires_on":"1432039862","not_before":"1432035962","resource":"https://graph.windows.net/","access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9.eyJhdWQiOiJodHRwczovL2dyYXBoLndpbmRv****G5gUTV-kKorR-pg"}

### <a name="get-objectid-of-application-service-principal-in-user-azure-ad"></a><span data-ttu-id="aa8a4-245">Získejte ObjectId aplikace instanční objekt v uživatele Azure AD</span><span class="sxs-lookup"><span data-stu-id="aa8a4-245">Get ObjectId of application service principal in user Azure AD</span></span>
<span data-ttu-id="aa8a4-246">Nyní pomocí hello tokenu tooquery přístup jen aplikace hello [objekty služby Azure AD Graph](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) hello toodetermine rozhraní API Id objektu aplikace hello instančního objektu v adresáři hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-246">Now, use hello app-only access token tooquery hello [Azure AD Graph Service Principals](https://msdn.microsoft.com/Library/Azure/Ad/Graph/api/entity-and-complex-type-reference#serviceprincipal-entity) API toodetermine hello Object Id of hello application's service principal in hello directory.</span></span>

<span data-ttu-id="aa8a4-247">Hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) metoda hello ukázkovou aplikaci ASP.net MVC implementuje toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-247">hello [GetObjectIdOfServicePrincipalInOrganization](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureADGraphAPIUtil.cs#) method of hello ASP.net MVC sample application implements this call.</span></span>

<span data-ttu-id="aa8a4-248">Následující příklad ukazuje, jak Hello toorequest aplikace instanční objekt.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-248">hello following example shows how toorequest an application's service principal.</span></span> <span data-ttu-id="aa8a4-249">a0448380-c346-4f9f-b897-c18733de9394 je hello id klienta aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-249">a0448380-c346-4f9f-b897-c18733de9394 is hello client id of hello application.</span></span>

    GET https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/servicePrincipals?api-version=1.5&$filter=appId%20eq%20'a0448380-c346-4f9f-b897-c18733de9394' HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJK*****-kKorR-pg

<span data-ttu-id="aa8a4-250">Hello následující příklad ukazuje žádost toohello odpovědi pro službu aplikace hlavní</span><span class="sxs-lookup"><span data-stu-id="aa8a4-250">hello following example shows a response toohello request for an application's service principal</span></span>

    HTTP/1.1 200 OK

    {"odata.metadata":"https://graph.windows.net/62e173e9-301e-423e-bcd4-29121ec1aa24/$metadata#directoryObjects/Microsoft.DirectoryServices.ServicePrincipal","value":[{"odata.type":"Microsoft.DirectoryServices.ServicePrincipal","objectType":"ServicePrincipal","objectId":"9b5018d4-6951-42ed-8a92-f11ec283ccec","deletionTimestamp":null,"accountEnabled":true,"appDisplayName":"CloudSense","appId":"a0448380-c346-4f9f-b897-c18733de9394","appOwnerTenantId":"62e173e9-301e-423e-bcd4-29121ec1aa24","appRoleAssignmentRequired":false,"appRoles":[],"displayName":"CloudSense","errorUrl":null,"homepage":"http://www.vipswapper.com/cloudsense","keyCredentials":[],"logoutUrl":null,"oauth2Permissions":[{"adminConsentDescription":"Allow hello application tooaccess CloudSense on behalf of hello signed-in user.","adminConsentDisplayName":"Access CloudSense","id":"b7b7338e-683a-4796-b95e-60c10380de1c","isEnabled":true,"type":"User","userConsentDescription":"Allow hello application tooaccess CloudSense on your behalf.","userConsentDisplayName":"Access CloudSense","value":"user_impersonation"}],"passwordCredentials":[],"preferredTokenSigningKeyThumbprint":null,"publisherName":"vipswapper"quot;,"replyUrls":["http://www.vipswapper.com/cloudsense","http://www.vipswapper.com","http://vipswapper.com","http://vipswapper.azurewebsites.net","http://localhost:62080"],"samlMetadataUrl":null,"servicePrincipalNames":["http://www.vipswapper.com/cloudsense","a0448380-c346-4f9f-b897-c18733de9394"],"tags":["WindowsAzureActiveDirectoryIntegratedApp"]}]}

### <a name="get-azure-rbac-role-identifier"></a><span data-ttu-id="aa8a4-251">Získat identifikátor role Azure RBAC</span><span class="sxs-lookup"><span data-stu-id="aa8a4-251">Get Azure RBAC role identifier</span></span>
<span data-ttu-id="aa8a4-252">tooassign hello odpovídající RBAC role tooyour instančního objektu, musíte určit hello identifikátor role Azure RBAC hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-252">tooassign hello appropriate RBAC role tooyour service principal, you must determine hello identifier of hello Azure RBAC role.</span></span>

<span data-ttu-id="aa8a4-253">Dobrý den správné role RBAC pro aplikaci:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-253">hello right RBAC role for your application:</span></span>

* <span data-ttu-id="aa8a4-254">Pokud vaše aplikace sleduje pouze hello předplatného, beze změn, vyžaduje pouze oprávnění čtečky u předplatného hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-254">If your application only monitors hello subscription, without making any changes, it requires only reader permissions on hello subscription.</span></span> <span data-ttu-id="aa8a4-255">Přiřadit hello **čtečky** role.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-255">Assign hello **Reader** role.</span></span>
* <span data-ttu-id="aa8a4-256">Pokud vaše aplikace spravuje předplatného Azure hello, vytváření, úpravy nebo odstranění entity, vyžaduje jednu z oprávnění přispěvatele hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-256">If your application manages Azure hello subscription, creating/modifying/deleting entities, it requires one of hello contributor permissions.</span></span>
  * <span data-ttu-id="aa8a4-257">toomanage konkrétní typ prostředku, přiřazení role Přispěvatel konkrétní prostředky hello (Přispěvatel virtuálních počítačů, Přispěvatel sítě, Přispěvatel účet úložiště, atd.)</span><span class="sxs-lookup"><span data-stu-id="aa8a4-257">toomanage a particular type of resource, assign hello resource-specific contributor roles (Virtual Machine Contributor, Virtual Network Contributor, Storage Account Contributor, etc.)</span></span>
  * <span data-ttu-id="aa8a4-258">toomanage libovolný typ prostředku, přiřaďte hello **Přispěvatel** role.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-258">toomanage any resource type, assign hello **Contributor** role.</span></span>

<span data-ttu-id="aa8a4-259">Hello přiřazení role pro vaši aplikaci je viditelné toousers, takže vyberte hello nejmenší vyžaduje oprávnění.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-259">hello role assignment for your application is visible toousers, so select hello least-required privilege.</span></span>

<span data-ttu-id="aa8a4-260">Volání hello [definice role správce prostředků rozhraní API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist všechny role Azure RBAC a hledání pak iterace hello výsledek toofind hello potřeby definice role podle názvu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-260">Call hello [Resource Manager role definition API](https://docs.microsoft.com/rest/api/authorization/roledefinitions) toolist all Azure RBAC roles and search then iterate over hello result toofind hello desired role definition by name.</span></span>

<span data-ttu-id="aa8a4-261">Hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) metoda hello ukázkovou aplikaci ASP.net MVC implementuje toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-261">hello [GetRoleId](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L246) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="aa8a4-262">Následující Hello požadavku příklad ukazuje, jak tooget identifikátor role Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-262">hello following request example shows how tooget Azure RBAC role identifier.</span></span> <span data-ttu-id="aa8a4-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb je hello id předplatného hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-263">09cbd307-aa71-4aca-b346-5f253e6e3ebb is hello id of hello subscription.</span></span>

    GET https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV*****fY2lGc5

<span data-ttu-id="aa8a4-264">odpověď Hello je ve formátu hello:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-264">hello response is in hello following format:</span></span>

    HTTP/1.1 200 OK

    {"value":[{"properties":{"roleName":"API Management Service Contributor","type":"BuiltInRole","description":"Lets you manage API Management services, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.ApiManagement/Services/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/312a565d-c81f-4fd8-895a-4e21e48d571c","type":"Microsoft.Authorization/roleDefinitions","name":"312a565d-c81f-4fd8-895a-4e21e48d571c"},{"properties":{"roleName":"Application Insights Component Contributor","type":"BuiltInRole","description":"Lets you manage Application Insights components, but not access toothem.","scope":"/","permissions":[{"actions":["Microsoft.Insights/components/*","Microsoft.Insights/webtests/*","Microsoft.Authorization/*/read","Microsoft.Resources/subscriptions/resources/read","Microsoft.Resources/subscriptions/resourceGroups/read","Microsoft.Resources/subscriptions/resourceGroups/resources/read","Microsoft.Resources/subscriptions/resourceGroups/deployments/*","Microsoft.Insights/alertRules/*","Microsoft.Support/*"],"notActions":[]}]},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/ae349356-3a1b-4a5e-921d-050484c6347e","type":"Microsoft.Authorization/roleDefinitions","name":"ae349356-3a1b-4a5e-921d-050484c6347e"}]}

<span data-ttu-id="aa8a4-265">Není nutné toocall toto rozhraní API průběžně.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-265">You do not need toocall this API on an ongoing basis.</span></span> <span data-ttu-id="aa8a4-266">Jakmile jste zjistili, dobře známé GUID definice role hello Dobrý den, můžete vytvořit id definice role hello jako:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-266">Once you've determined hello well-known GUID of hello role definition, you can construct hello role definition id as:</span></span>

    /subscriptions/{subscription_id}/providers/Microsoft.Authorization/roleDefinitions/{well-known-role-guid}

<span data-ttu-id="aa8a4-267">Toto jsou známé identifikátory GUID hello běžně používané předdefinovaných rolí:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-267">Here are hello well-known guids of commonly used built-in roles:</span></span>

| <span data-ttu-id="aa8a4-268">Role</span><span class="sxs-lookup"><span data-stu-id="aa8a4-268">Role</span></span> | <span data-ttu-id="aa8a4-269">Identifikátor GUID</span><span class="sxs-lookup"><span data-stu-id="aa8a4-269">Guid</span></span> |
| --- | --- |
| <span data-ttu-id="aa8a4-270">Čtenář</span><span class="sxs-lookup"><span data-stu-id="aa8a4-270">Reader</span></span> |<span data-ttu-id="aa8a4-271">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="aa8a4-271">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |
| <span data-ttu-id="aa8a4-272">Přispěvatel</span><span class="sxs-lookup"><span data-stu-id="aa8a4-272">Contributor</span></span> |<span data-ttu-id="aa8a4-273">b24988ac-6180-42A0-ab88-20f7382dd24c</span><span class="sxs-lookup"><span data-stu-id="aa8a4-273">b24988ac-6180-42a0-ab88-20f7382dd24c</span></span> |
| <span data-ttu-id="aa8a4-274">Přispěvatel virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="aa8a4-274">Virtual Machine Contributor</span></span> |<span data-ttu-id="aa8a4-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span><span class="sxs-lookup"><span data-stu-id="aa8a4-275">d73bb868-a0df-4d4d-bd69-98a00b01fccb</span></span> |
| <span data-ttu-id="aa8a4-276">Přispěvatel virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="aa8a4-276">Virtual Network Contributor</span></span> |<span data-ttu-id="aa8a4-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span><span class="sxs-lookup"><span data-stu-id="aa8a4-277">b34d265f-36f7-4a0d-a4d4-e158ca92e90f</span></span> |
| <span data-ttu-id="aa8a4-278">Přispěvatel účtu úložiště</span><span class="sxs-lookup"><span data-stu-id="aa8a4-278">Storage Account Contributor</span></span> |<span data-ttu-id="aa8a4-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span><span class="sxs-lookup"><span data-stu-id="aa8a4-279">86e8f5dc-a6e9-4c67-9d15-de283e8eac25</span></span> |
| <span data-ttu-id="aa8a4-280">Přispěvatel webu</span><span class="sxs-lookup"><span data-stu-id="aa8a4-280">Website Contributor</span></span> |<span data-ttu-id="aa8a4-281">de139f84-1756-47ae-9be6-808fbbe84772</span><span class="sxs-lookup"><span data-stu-id="aa8a4-281">de139f84-1756-47ae-9be6-808fbbe84772</span></span> |
| <span data-ttu-id="aa8a4-282">Plán přispěvatelů webu</span><span class="sxs-lookup"><span data-stu-id="aa8a4-282">Web Plan Contributor</span></span> |<span data-ttu-id="aa8a4-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span><span class="sxs-lookup"><span data-stu-id="aa8a4-283">2cc479cb-7b4d-49a8-b449-8c00fd0f0a4b</span></span> |
| <span data-ttu-id="aa8a4-284">Přispěvatel serveru SQL</span><span class="sxs-lookup"><span data-stu-id="aa8a4-284">SQL Server Contributor</span></span> |<span data-ttu-id="aa8a4-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span><span class="sxs-lookup"><span data-stu-id="aa8a4-285">6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437</span></span> |
| <span data-ttu-id="aa8a4-286">Přispěvatel databází SQL</span><span class="sxs-lookup"><span data-stu-id="aa8a4-286">SQL DB Contributor</span></span> |<span data-ttu-id="aa8a4-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span><span class="sxs-lookup"><span data-stu-id="aa8a4-287">9b7fa17d-e63e-47b0-bb0a-15c516ac86ec</span></span> |

### <a name="assign-rbac-role-tooapplication"></a><span data-ttu-id="aa8a4-288">Přiřadit RBAC role tooapplication</span><span class="sxs-lookup"><span data-stu-id="aa8a4-288">Assign RBAC role tooapplication</span></span>
<span data-ttu-id="aa8a4-289">Máte všechno, co potřebujete tooassign hello odpovídající RBAC role tooyour instanční objekt pomocí hello [Resource Manager vytvořit přiřazení role](https://docs.microsoft.com/rest/api/authorization/roleassignments) rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-289">You have everything you need tooassign hello appropriate RBAC role tooyour service principal by using hello [Resource Manager create role assignment](https://docs.microsoft.com/rest/api/authorization/roleassignments) API.</span></span>

<span data-ttu-id="aa8a4-290">Hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) metoda hello ukázkovou aplikaci ASP.net MVC implementuje toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-290">hello [GrantRoleToServicePrincipalOnSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L170) method of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="aa8a4-291">Na příkladu požadavek tooassign RBAC role tooapplication:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-291">An example request tooassign RBAC role tooapplication:</span></span>

    PUT https://management.azure.com/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/microsoft.authorization/roleassignments/4f87261d-2816-465d-8311-70a27558df4c?api-version=2015-07-01 HTTP/1.1

    Authorization: Bearer eyJ0eXAiOiJKV1QiL*****FlwO1mM7Cw6JWtfY2lGc5
    Content-Type: application/json
    Content-Length: 230

    {"properties": {"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2"}}

<span data-ttu-id="aa8a4-292">V žádosti o hello se používají hello následující hodnoty:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-292">In hello request, hello following values are used:</span></span>

| <span data-ttu-id="aa8a4-293">Identifikátor GUID</span><span class="sxs-lookup"><span data-stu-id="aa8a4-293">Guid</span></span> | <span data-ttu-id="aa8a4-294">Popis</span><span class="sxs-lookup"><span data-stu-id="aa8a4-294">Description</span></span> |
| --- | --- |
| <span data-ttu-id="aa8a4-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span><span class="sxs-lookup"><span data-stu-id="aa8a4-295">09cbd307-aa71-4aca-b346-5f253e6e3ebb</span></span> |<span data-ttu-id="aa8a4-296">Hello id předplatného hello</span><span class="sxs-lookup"><span data-stu-id="aa8a4-296">hello id of hello subscription</span></span> |
| <span data-ttu-id="aa8a4-297">c3097b31-7309-4C59-b4e3-770f8406bad2</span><span class="sxs-lookup"><span data-stu-id="aa8a4-297">c3097b31-7309-4c59-b4e3-770f8406bad2</span></span> |<span data-ttu-id="aa8a4-298">id objektu Hello hello instanční objekt aplikace hello</span><span class="sxs-lookup"><span data-stu-id="aa8a4-298">hello object id of hello service principal of hello application</span></span> |
| <span data-ttu-id="aa8a4-299">acdd72a7-3385-48EF-bd42-f606fba81ae7</span><span class="sxs-lookup"><span data-stu-id="aa8a4-299">acdd72a7-3385-48ef-bd42-f606fba81ae7</span></span> |<span data-ttu-id="aa8a4-300">Hello id role Čtenář hello</span><span class="sxs-lookup"><span data-stu-id="aa8a4-300">hello id of hello reader role</span></span> |
| <span data-ttu-id="aa8a4-301">4f87261d-2816-465D-8311-70a27558df4c</span><span class="sxs-lookup"><span data-stu-id="aa8a4-301">4f87261d-2816-465d-8311-70a27558df4c</span></span> |<span data-ttu-id="aa8a4-302">nový identifikátor guid pro nové přiřazení role hello vytvořit</span><span class="sxs-lookup"><span data-stu-id="aa8a4-302">a new guid created for hello new role assignment</span></span> |

<span data-ttu-id="aa8a4-303">odpověď Hello je ve formátu hello:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-303">hello response is in hello following format:</span></span>

    HTTP/1.1 201 Created

    {"properties":{"roleDefinitionId":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7","principalId":"c3097b31-7309-4c59-b4e3-770f8406bad2","scope":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb"},"id":"/subscriptions/09cbd307-aa71-4aca-b346-5f253e6e3ebb/providers/Microsoft.Authorization/roleAssignments/4f87261d-2816-465d-8311-70a27558df4c","type":"Microsoft.Authorization/roleAssignments","name":"4f87261d-2816-465d-8311-70a27558df4c"}

### <a name="get-app-only-access-token-for-azure-resource-manager"></a><span data-ttu-id="aa8a4-304">Získání jen aplikace tokenu přístupu pro Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="aa8a4-304">Get app-only access token for Azure Resource Manager</span></span>
<span data-ttu-id="aa8a4-305">toovalidate aplikaci má hello požadovaného přístup na základě předplatného hello, provést úlohu test na hello předplatného pomocí tokenu jen aplikace.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-305">toovalidate that app has hello desired access on hello subscription, perform a test task on hello subscription using an app-only token.</span></span>

<span data-ttu-id="aa8a4-306">tooget jen aplikace přístupový token, postupujte podle pokynů z oddílu [získání tokenu přístupu jen pro aplikace pro Azure AD Graph API](#app-azure-ad-graph), s jinou hodnotu pro parametr prostředku hello:</span><span class="sxs-lookup"><span data-stu-id="aa8a4-306">tooget an app-only access token, follow instructions from section [Get app-only access token for Azure AD Graph API](#app-azure-ad-graph), with a different value for hello resource parameter:</span></span>

    https://management.core.windows.net/

<span data-ttu-id="aa8a4-307">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) metoda hello ukázkovou aplikaci ASP.NET MVC získá token pro používání Azure Resource Manager přístup jen aplikace hello Active Directory Authentication Library pro .net.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-307">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample application gets an app-only access token for Azure Resource Manager using hello Active Directory Authentication Library for .net.</span></span>

#### <a name="get-applications-permissions-on-subscription"></a><span data-ttu-id="aa8a4-308">Získat oprávnění aplikace v předplatném</span><span class="sxs-lookup"><span data-stu-id="aa8a4-308">Get Application's Permissions on Subscription</span></span>
<span data-ttu-id="aa8a4-309">toocheck, který má aplikace hello požadovaného přístupu na základě předplatného služby Azure, můžete také zavolat hello [oprávnění správce prostředků](https://docs.microsoft.com/rest/api/authorization/permissions) rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-309">toocheck that your application has hello desired access on an Azure subscription, you may also call hello [Resource Manager Permissions](https://docs.microsoft.com/rest/api/authorization/permissions) API.</span></span> <span data-ttu-id="aa8a4-310">Tento přístup je podobné toohow můžete určit, zda má uživatel hello práva pro správu přístupu pro předplatné hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-310">This approach is similar toohow you determined whether hello user has Access Management rights for hello subscription.</span></span> <span data-ttu-id="aa8a4-311">Tentokrát však volejte hello oprávnění rozhraní API pomocí hello jen aplikace přístupový token, který jste obdrželi v předchozím kroku hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-311">However, this time, call hello permissions API with hello app-only access token that you received in hello previous step.</span></span>

<span data-ttu-id="aa8a4-312">Hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) metoda hello ukázkovou aplikaci ASP.NET MVC implementuje toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-312">hello [ServicePrincipalHasReadAccessToSubscription](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L110) method of hello ASP.NET MVC sample app implements this call.</span></span>

## <a name="manage-connected-subscriptions"></a><span data-ttu-id="aa8a4-313">Správa připojené odběrů</span><span class="sxs-lookup"><span data-stu-id="aa8a4-313">Manage connected subscriptions</span></span>
<span data-ttu-id="aa8a4-314">Jakmile příslušné role RBAC hello je přiřazena instanční objekt tooyour aplikace v předplatném hello, vaše aplikace můžete zachovat monitorování nebo správa pomocí jen aplikace přístupových tokenů pro Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-314">When hello appropriate RBAC role is assigned tooyour application's service principal on hello subscription, your application can keep monitoring/managing it using app-only access tokens for Azure Resource Manager.</span></span>

<span data-ttu-id="aa8a4-315">Pokud vlastník předplatného Odebere přiřazení role vaší aplikace pomocí portálu classic hello nebo nástroje příkazového řádku, vaše aplikace je již nebude možné tooaccess toto předplatné.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-315">If a subscription owner removes your application's role assignment using hello classic portal or command-line tools, your application is no longer able tooaccess that subscription.</span></span> <span data-ttu-id="aa8a4-316">V takovém případě by měl upozornit hello uživatele, aby bylo porušeno hello připojení s předplatným hello z mimo aplikace hello a udělit jim možnost příliš "Opravit" hello připojení.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-316">In that case, you should notify hello user that hello connection with hello subscription was severed from outside hello application and give them an option too"repair" hello connection.</span></span> <span data-ttu-id="aa8a4-317">"Opravit" by jednoduše znovu vytvořit přiřazení role hello, který byl odstraněn do offline režimu.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-317">"Repair" would simply re-create hello role assignment that was deleted offline.</span></span>

<span data-ttu-id="aa8a4-318">Stejně jako jste povolili hello uživatelská tooconnect odběry tooyour aplikace, musíte povolit hello uživatele toodisconnect odběry příliš.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-318">Just as you enabled hello user tooconnect subscriptions tooyour application, you must allow hello user toodisconnect subscriptions too.</span></span> <span data-ttu-id="aa8a4-319">Z přístup správu hlediska odpojte znamená odebrání přiřazení role hello, který má aplikace hello instanční objekt na předplatné hello.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-319">From an access management point of view, disconnect means removing hello role assignment that hello application's service principal has on hello subscription.</span></span> <span data-ttu-id="aa8a4-320">Volitelně může být jakýkoli stav v hello aplikaci pro předplatné hello odstraněna příliš.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-320">Optionally, any state in hello application for hello subscription might be removed too.</span></span>
<span data-ttu-id="aa8a4-321">Pouze uživatelé s oprávněním správy přístupu na základě předplatného hello jsou možné toodisconnect hello předplatného.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-321">Only users with access management permission on hello subscription are able toodisconnect hello subscription.</span></span>

<span data-ttu-id="aa8a4-322">Hello [RevokeRoleFromServicePrincipalOnSubscription metoda](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) z hello ASP.net MVC implementuje ukázkovou aplikaci toto volání.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-322">hello [RevokeRoleFromServicePrincipalOnSubscription method](https://github.com/dushyantgill/VipSwapper/blob/master/CloudSense/CloudSense/AzureResourceManagerUtil.cs#L200) of hello ASP.net MVC sample app implements this call.</span></span>

<span data-ttu-id="aa8a4-323">Je to – uživatelé teď můžete snadno připojit a spravovat svá předplatná Azure s vaší aplikací.</span><span class="sxs-lookup"><span data-stu-id="aa8a4-323">That's it - users can now easily connect and manage their Azure subscriptions with your application.</span></span>

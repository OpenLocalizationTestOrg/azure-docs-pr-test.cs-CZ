---
title: "Objekt zabezpečení ověřování služby pro aplikace API v Azure App Service | Microsoft Docs"
description: "Zjistěte, jak do aplikace API v Azure App Service pro scénáře service-to-service jsou chráněny."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 95653287546bbe358111ed16af0c30a53caff2b5
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="b2b0c-103">Objekt zabezpečení ověřování služby pro aplikace API v Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b2b0c-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="b2b0c-104">Přehled</span><span class="sxs-lookup"><span data-stu-id="b2b0c-104">Overview</span></span>
<span data-ttu-id="b2b0c-105">Tento článek vysvětluje, jak používat ověřování služby App Service pro *interní* přístup k aplikacím API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-105">This article explains how to use App Service authentication for *internal* access to API apps.</span></span> <span data-ttu-id="b2b0c-106">Vnitřní scénář je, kdy máte aplikaci API, která mají být použití pouze vlastního kódu aplikace.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-106">An internal scenario is where you have an API app that you want to be consumable only by your own application code.</span></span> <span data-ttu-id="b2b0c-107">Doporučeným způsobem, jak implementovat tento scénář ve službě App Service je používat k ochraně názvem aplikace API Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-107">The recommended way to implement this scenario in App Service is to use Azure AD to protect the called API app.</span></span> <span data-ttu-id="b2b0c-108">Volání chráněné aplikace API s token nosiče, který můžete získat z Azure AD tím, že poskytuje identitu aplikace (instanční objekt) přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-108">You call the protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="b2b0c-109">Alternativy k používání služby Azure AD, najdete v článku **Service-to-service ověřování** části [Přehled ověřování služby Azure App Service](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-109">For alternatives to using Azure AD, see the **Service-to-service authentication** section of the [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="b2b0c-110">V tomto článku se dozvíte:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="b2b0c-111">Jak používat Azure Active Directory (Azure AD) pro aplikace API jsou chráněny před neověřeným přístupem.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-111">How to use Azure Active Directory (Azure AD) to protect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="b2b0c-112">Jak používat chráněné aplikace API z aplikace API, webovou aplikaci nebo mobilní aplikace přes přihlašovací údaje Azure AD služba objektu zabezpečení (identita aplikace).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-112">How to consume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="b2b0c-113">Informace o tom, jak využívat z aplikace logiky najdete v tématu [používání vlastního rozhraní API hostovaného v App Service pomocí aplikací logiky](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-113">For information about how to consume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="b2b0c-114">Jak zajistit, že chráněné aplikace API nelze volat z prohlížeče pomocí přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-114">How to make sure that the protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="b2b0c-115">Jak zajistit, že chráněné aplikace API, lze volat pouze konkrétní Azure AD služba objektu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-115">How to make sure that the protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="b2b0c-116">Článek obsahuje dvě části:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-116">The article contains two sections:</span></span>

* <span data-ttu-id="b2b0c-117">[Postup konfigurace ověřování hlavní služby ve službě Azure App Service](#authconfig) část popisuje obecně konfiguraci ověřování pro všechny aplikace API a jak využívat chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-117">The [How to configure service principal authentication in Azure App Service](#authconfig) section explains in general how to configure authentication for any API app, and how to consume the protected API app.</span></span> <span data-ttu-id="b2b0c-118">Tato část se vztahuje stejnou měrou na všech rozhraní podporovaných službou App Service, včetně .NET, Node.js a Java.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-118">This section applies equally to all frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="b2b0c-119">Od verze [pokračování úvodních kurzů k .NET](#tutorialstart) části kurzu vás provede konfiguraci "interní přístup" scénáře pro ukázkové aplikace .NET spuštěna ve službě App Service.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-119">Starting with the [Continuing the .NET getting-started tutorials](#tutorialstart) section, the tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="b2b0c-120"><a id="authconfig"></a>Postup konfigurace ověřování hlavní služby ve službě Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b2b0c-120"><a id="authconfig"></a> How to configure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="b2b0c-121">Tato část obsahuje obecné pokyny, které platí pro všechny aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-121">This section provides general instructions that apply to any API app.</span></span> <span data-ttu-id="b2b0c-122">Konkrétní kroky pro ukázkovou aplikaci udělat rozhraní seznamu .NET přejděte na [pokračováním řady kurz .NET API Apps](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-122">For steps specific to the To Do List .NET sample application, go to [Continuing the .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="b2b0c-123">V [portál Azure](https://portal.azure.com/), přejděte na **nastavení** okno aplikace API, který chcete chránit a pak vyhledejte **funkce** části a klikněte na tlačítko  **Ověřování / autorizace**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-123">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you want to protect, and then find the **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Ověřování/autorizace služby na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="b2b0c-125">V **ověřování / autorizace** okně klikněte na tlačítko **na**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-125">In the **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="b2b0c-126">V **akci provést, když požadavek nebude ověřený** rozevíracího seznamu vyberte **přihlásit se přes Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="b2b0c-126">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="b2b0c-127">V části **zprostředkovatele ověřování**, vyberte **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Ověřování/autorizace okno na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="b2b0c-129">Konfigurace **nastavení Azure Active Directory** okno a vytvořte novou aplikaci Azure AD, nebo použijte existující aplikaci Azure AD Pokud již účet máte, kterou chcete použít.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-129">Configure the **Azure Active Directory Settings** blade to create a new Azure AD application, or use an existing Azure AD application if you already have one that you want to use.</span></span>
   
    <span data-ttu-id="b2b0c-130">Interní scénáře jsou obvykle aplikace API volání aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="b2b0c-131">Můžete použít samostatné Azure AD aplikací pro každou aplikaci API nebo pouze jednu aplikaci Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="b2b0c-132">Podrobné pokyny v tomto okně najdete v tématu [postup konfigurace aplikace služby App Service pomocí přihlášení Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-132">For detailed instructions on this blade, see [How to configure your App Service application to use Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="b2b0c-133">Když jste hotovi s okno Konfigurace zprostředkovatele ověřování, klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-133">When you're done with the authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="b2b0c-134">V **ověřování / autorizace** okně klikněte na tlačítko **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-134">In the **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="b2b0c-136">Když to uděláte, služby App Service umožňuje pouze požadavky z volající v konfigurovaného klienta Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-136">When this is done, App Service only allows requests from callers in the configured Azure AD tenant.</span></span> <span data-ttu-id="b2b0c-137">Bez ověřování nebo autorizace kódu se vyžaduje v chráněném aplikaci API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-137">No authentication or authorization code is required in the protected API app.</span></span> <span data-ttu-id="b2b0c-138">Token nosiče je předán do aplikace API společně s běžně používané deklarací identity v hlavičkách protokolu HTTP, a můžete si přečíst tyto informace v kódu k ověření, že žádosti jsou z konkrétní volající, jako je například hlavní název služby.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-138">The bearer token is passed to the API app along with commonly used claims in HTTP headers, and you can read that information in code to validate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="b2b0c-139">Tato funkce ověřování funguje stejným způsobem jako pro všechny jazyky, které podporuje služby App service, včetně .NET, Node.js a Java.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-139">This authentication functionality works the same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-to-consume-the-protected-api-app"></a><span data-ttu-id="b2b0c-140">Jak používat chráněné aplikace API</span><span class="sxs-lookup"><span data-stu-id="b2b0c-140">How to consume the protected API app</span></span>
<span data-ttu-id="b2b0c-141">Volající musí poskytnout volání rozhraní API tokenu nosiče Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-141">The caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="b2b0c-142">Chcete-li získat token nosiče pomocí přihlašovacích údajů hlavní služby, volající používá služby Active Directory Authentication Library (ADAL pro [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), nebo [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-142">To get a bearer token using service principal credentials, the caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="b2b0c-143">Chcete-li získat token, obsahuje kód, který volá ADAL adal následující informace:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-143">To get a token, the code that calls ADAL provides to ADAL the following information:</span></span>

* <span data-ttu-id="b2b0c-144">Název vašeho klienta Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-144">The name of your Azure AD tenant.</span></span>
* <span data-ttu-id="b2b0c-145">ID klienta a tajný klíč klienta (klíč aplikace) aplikace Azure AD, které jsou spojené s volajícím.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-145">The client ID and client secret (app key) of the Azure AD app associated with the caller.</span></span>
* <span data-ttu-id="b2b0c-146">ID klienta aplikace Azure AD přidružené k chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-146">The client ID of the Azure AD application associated with the protected API app.</span></span> <span data-ttu-id="b2b0c-147">(Pokud se používá pouze jednu aplikaci Azure AD, jedná se stejným ID klienta jako pro volající.)</span><span class="sxs-lookup"><span data-stu-id="b2b0c-147">(If just one Azure AD application is used, this is the same client ID as the one for the caller.)</span></span>

<span data-ttu-id="b2b0c-148">Tyto hodnoty jsou k dispozici na stránkách Azure AD [portál Azure classic](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-148">These values are available in the Azure AD pages of the [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="b2b0c-149">Jakmile získal token volající ji obsahuje u žádostí protokolu HTTP v hlavičce autorizace.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-149">Once the token has been acquired, the caller includes it with HTTP requests in the Authorization header.</span></span>  <span data-ttu-id="b2b0c-150">Služba App Service ověří token a umožňuje žádosti, které chcete dosáhnout chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-150">App Service validates the token and allows the requests to reach the protected API app.</span></span>

#### <a name="how-to-protect-the-api-app-from-access-by-users-in-the-same-tenant"></a><span data-ttu-id="b2b0c-151">Jak chránit aplikace API z přístup uživatelů ve stejném klientovi</span><span class="sxs-lookup"><span data-stu-id="b2b0c-151">How to protect the API app from access by users in the same tenant</span></span>
<span data-ttu-id="b2b0c-152">Nosné tokeny pro uživatele ve stejném klientovi jsou považovány za platné pro chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-152">Bearer tokens for users in the same tenant are considered valid for the protected API app.</span></span>  <span data-ttu-id="b2b0c-153">Pokud chcete zajistit, že pouze objekt služby můžete volat chráněné aplikace API, přidejte kód v chráněné aplikace API pro ověření následující deklarací z tokenu:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-153">If you want to ensure that only a service principal can call the protected API app, add code in the protected API app to validate the following claims from the token:</span></span>

* <span data-ttu-id="b2b0c-154">`appid`ID klienta aplikace Azure AD, která souvisí s volající by měl být.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-154">`appid` should be the client ID of the Azure AD application that is associated with the caller.</span></span> 
* <span data-ttu-id="b2b0c-155">`oid`(`objectidentifier`) by měla být ID objektu zabezpečení služby volajícího.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-155">`oid` (`objectidentifier`) should be the service principal ID of the caller.</span></span> 

<span data-ttu-id="b2b0c-156">Služba App Service také poskytuje `objectidentifier` deklarací identity v záhlaví X-MS-CLIENT-hlavní-ID.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-156">App Service also provides the `objectidentifier` claim in the X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-to-protect-the-api-app-from-browser-access"></a><span data-ttu-id="b2b0c-157">Jak chránit aplikace API z přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b2b0c-157">How to protect the API app from browser access</span></span>
<span data-ttu-id="b2b0c-158">Pokud nemáte ověřit deklarace identity v kódu v chráněném aplikace API, a pokud používáte samostatnou aplikaci Azure AD pro chráněné aplikace API, ujistěte se, že adresa URL odpovědi aplikace Azure AD není stejný jako základní adresu URL aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-158">If you don't validate claims in code in the protected API app, and if you use a separate Azure AD application for the protected API app, make sure that the Azure AD application's Reply URL is not the same as the API app's base URL.</span></span> <span data-ttu-id="b2b0c-159">Pokud adresa URL odpovědi odkazuje přímo na chráněném aplikace API, uživatel ve stejném klientovi Azure AD přejděte do aplikace API, přihlaste se a úspěšně volat rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-159">If the Reply URL points directly to the protected API app, a user in the same Azure AD tenant could browse to the API app, log on, and successfully call the API.</span></span>

## <span data-ttu-id="b2b0c-160"><a id="tutorialstart"></a>Pokračováním řady kurz .NET API Apps</span><span class="sxs-lookup"><span data-stu-id="b2b0c-160"><a id="tutorialstart"></a> Continuing the .NET API Apps tutorial series</span></span>
<span data-ttu-id="b2b0c-161">Pokud postupujete podle Node.js nebo Java kurz řady pro aplikace API, pokračujte [další kroky](#next-steps) části.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-161">If you are following the Node.js or Java tutorial series for API apps, skip to the [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="b2b0c-162">Zbývající část tohoto článku pokračuje řady kurz .NET API Apps a předpokládá, že jste dokončili [kurzu ověřování uživatele](app-service-api-dotnet-user-principal-auth.md) a ukázkové aplikace běžící v Azure s ověřováním uživatele povolena.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-162">The remainder of this article continues the .NET API Apps tutorial series and assumes that you have completed the [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have the sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="b2b0c-163">Nastavení ověřování v Azure</span><span class="sxs-lookup"><span data-stu-id="b2b0c-163">Set up authentication in Azure</span></span>
<span data-ttu-id="b2b0c-164">V této části můžete nakonfigurovat App Service tak, aby pouze požadavky HTTP umožňuje připojit aplikaci API datové vrstvy jsou ty, které mají platný Azure AD nosné tokeny.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-164">In this section you configure App Service so that the only HTTP requests it allows to reach the data tier API app are the ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="b2b0c-165">V následující části můžete nakonfigurovat aplikaci API střední vrstvy odeslat přihlašovací údaje aplikací do Azure AD, získáte zpět token nosiče, a odeslat token nosiče aplikaci API datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-165">In the following section, you configure the middle tier API app to send application credentials to Azure AD, get back a bearer token, and send the bearer token to the data tier API app.</span></span> <span data-ttu-id="b2b0c-166">Tento proces je znázorněn v diagramu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-166">This process is illustrated in the diagram.</span></span>

![Diagram ověřování služby](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="b2b0c-168">Pokud narazíte na problémy při následujícím kurzu pokynů, najdete v článku [Poradce při potížích s](#troubleshooting) části na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-168">If you run into problems while following the tutorial directions, see the [Troubleshooting](#troubleshooting) section at the end of the tutorial.</span></span> 

1. <span data-ttu-id="b2b0c-169">V [portál Azure](https://portal.azure.com/), přejděte na **nastavení** okno aplikace API, který jste vytvořili pro aplikaci API ToDoListDataAPI (datové vrstvy) a pak klikněte na tlačítko **nastavení**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-169">In the [Azure portal](https://portal.azure.com/), navigate to the **Settings** blade of the API app that you created for the ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="b2b0c-170">V **nastavení** okně Najít **funkce** části a potom klikněte na **ověřování / autorizace**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-170">In the **Settings** blade, find the **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Ověřování/autorizace služby na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="b2b0c-172">V **ověřování / autorizace** okně klikněte na tlačítko **na**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-172">In the **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="b2b0c-173">V **akci provést, když požadavek nebude ověřený** rozevíracího seznamu vyberte **přihlásit se přes Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-173">In the **Action to take when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="b2b0c-174">Toto je nastavení, která způsobí, že služby App Service k zajištění, pouze ověření reach požadavky aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-174">This is the setting that causes App Service to ensure that only authenticated requests reach the API app.</span></span> <span data-ttu-id="b2b0c-175">Služby App Service pro požadavky, které mají platný nosné tokeny, předá tokeny podél do aplikace API a naplní hlavičky protokolu HTTP s běžně používané deklarace identity, aby tyto informace snadno dostupné pro váš kód.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-175">For requests that have valid bearer tokens, App Service passes the tokens along to the API app and populates HTTP headers with commonly used claims to make that information more easily available to your code.</span></span>
5. <span data-ttu-id="b2b0c-176">V části **zprostředkovatele ověřování**, klikněte na tlačítko **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Ověřování/autorizace okno na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="b2b0c-178">V **nastavení Azure Active Directory** okně klikněte na tlačítko **Express**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-178">In the **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="b2b0c-179">Pomocí **Express** možnost Azure můžete automaticky vytvořit aplikaci AAD ve službě Azure AD [klienta](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-179">With the **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="b2b0c-180">Nemusíte vytvořit klienta, protože každý účet Azure automaticky jeden má.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-180">You don't have to create a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="b2b0c-181">V části **režim správy**, klikněte na tlačítko **vytvořit novou aplikaci AD** Pokud již není vybrána.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="b2b0c-182">Připojí na portál **vytvořit aplikaci** vstupní pole výchozí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-182">The portal plugs the **Create App** input box with a default value.</span></span> <span data-ttu-id="b2b0c-183">Ve výchozím nastavení, aplikace Azure AD se stejným názvem jako aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-183">By default, the Azure AD application is named the same as the API app.</span></span> <span data-ttu-id="b2b0c-184">Pokud dáváte přednost, můžete zadat jiný název.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-184">If you prefer, you can enter a different name.</span></span>
   
    ![Nastavení služby Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="b2b0c-186">**Poznámka:**: jako alternativu, můžete použít jednu Azure AD pro volání rozhraní API app a chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-186">**Note**: As an alternative, you could use a single Azure AD application for both the calling API app and the protected API app.</span></span> <span data-ttu-id="b2b0c-187">Pokud jste vybrali tento alternativa, nebude potřeba **vytvořit novou aplikaci AD** možnost zde, protože jste již vytvořili aplikaci Azure AD v tomto kurzu ověřování uživatele.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-187">If you chose that alternative, you would not need the **Create New AD App** option here because you already created an Azure AD application earlier in the user authentication tutorial.</span></span> <span data-ttu-id="b2b0c-188">V tomto kurzu budete používat samostatné aplikace Azure AD pro volání rozhraní API app a chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-188">For this tutorial, you'll use separate Azure AD applications for the calling API app and the protected API app.</span></span>
8. <span data-ttu-id="b2b0c-189">Poznamenejte si hodnotu, která je v **vytvořit aplikaci** vstupní pole; budete vyhledání této AAD aplikace na portálu Azure classic později.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-189">Make a note of the value that is in the **Create App** input box; you'll look up this AAD application in the Azure classic portal later.</span></span>
9. <span data-ttu-id="b2b0c-190">Klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-190">Click **OK**.</span></span>
10. <span data-ttu-id="b2b0c-191">V **ověřování / autorizace** okně klikněte na tlačítko **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-191">In the **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="b2b0c-193">Služby App Service vytvoří aplikaci služby Azure Active Directory s **přihlašovací adresa URL** a **adresa URL odpovědi** automaticky nastaví na adresu URL aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set to the URL of your API app.</span></span> <span data-ttu-id="b2b0c-194">Tato hodnota umožňuje uživatelům ve vašem tenantovi AAD se přihlaste a přístup k aplikaci API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-194">The latter value enables users in your AAD tenant to log in and access the API app.</span></span>

### <a name="verify-that-the-api-app-is-protected"></a><span data-ttu-id="b2b0c-195">Ověřte, jestli chráněný aplikace API</span><span class="sxs-lookup"><span data-stu-id="b2b0c-195">Verify that the API app is protected</span></span>
1. <span data-ttu-id="b2b0c-196">V prohlížeči přejděte na adresu URL aplikace API: v **aplikace API** okno na portálu Azure klikněte na odkaz v části **URL**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-196">In a browser go to the URL of the API app: in the **API app** blade in the Azure portal, click the link under **URL**.</span></span> 
   
    <span data-ttu-id="b2b0c-197">Budete přesměrováni na přihlašovací obrazovku, protože neověřené požadavky nejsou povoleny dosáhne aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-197">You are redirected to a login screen because unauthenticated requests are not allowed to reach the API app.</span></span> 
   
    <span data-ttu-id="b2b0c-198">Pokud váš prohlížeč, přejít na uživatelské rozhraní Swagger, prohlížeč mohou již být zaznamenány na – v takovém případě otevřete okno InPrivate nebo Incognito, přejděte na adresu URL uživatelského rozhraní Swagger.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-198">If your browser does go to the Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go to the Swagger UI URL.</span></span>
2. <span data-ttu-id="b2b0c-199">Přihlaste se pomocí přihlašovacích údajů uživatele ve vašem tenantovi AAD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="b2b0c-200">Pokud jste přihlášeni, "úspěšně vytvořil" stránka se zobrazí v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-200">When you're logged on, the "successfully created" page appears in the browser.</span></span>

## <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="b2b0c-201">Konfigurace projektu ToDoListAPI k získání a odeslání tokenu Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-201">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="b2b0c-202">V této části můžete provést následující úkoly:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-202">In this section you do the following tasks:</span></span>

* <span data-ttu-id="b2b0c-203">Přidání kódu v aplikaci API střední vrstvy, která používá přihlašovací údaje Azure AD aplikace k získání tokenu a jeho odeslání u žádostí protokolu HTTP pro aplikaci API datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-203">Add code in the middle tier API app that uses Azure AD application credentials to acquire a token and send it with HTTP requests to the data tier API app.</span></span>
* <span data-ttu-id="b2b0c-204">Přihlašovací údaje, které potřebujete získáte z Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-204">Get the credentials you need from Azure AD.</span></span>
* <span data-ttu-id="b2b0c-205">Zadejte přihlašovací údaje do nastavení prostředí runtime Azure App Service v aplikaci API střední vrstvy.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-205">Enter the credentials into Azure App Service runtime environment settings in the middle tier API app.</span></span> 

### <a name="configure-the-todolistapi-project-to-acquire-and-send-the-azure-ad-token"></a><span data-ttu-id="b2b0c-206">Konfigurace projektu ToDoListAPI k získání a odeslání tokenu Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-206">Configure the ToDoListAPI project to acquire and send the Azure AD token</span></span>
<span data-ttu-id="b2b0c-207">Proveďte následující změny v projektu ToDoListAPI v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-207">Make the following changes in the ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="b2b0c-208">Zrušením komentáře u všech kód *ServicePrincipal.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-208">Uncomment all of the code in the *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="b2b0c-209">Toto je kód, který využívá ADAL pro .NET k získání tokenu nosiče Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-209">This is the code that uses ADAL for .NET to acquire the Azure AD bearer token.</span></span>  <span data-ttu-id="b2b0c-210">Používá několik hodnoty konfigurace, která je budete později nastavit v Azure běhové prostředí.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-210">It uses several configuration values that you'll set in the Azure runtime environment later.</span></span> <span data-ttu-id="b2b0c-211">Zde je kód:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-211">Here's the code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="b2b0c-212">**Poznámka:** tento kód vyžaduje knihovnu ADAL pro balíček NuGet pro rozhraní .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), který je již nainstalován v projektu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-212">**Note:** This code requires the ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in the project.</span></span> <span data-ttu-id="b2b0c-213">Při vytváření tohoto projektu od začátku, museli byste instalaci tohoto balíčku.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-213">If you were creating this project from scratch, you would have to install this package.</span></span> <span data-ttu-id="b2b0c-214">Tento balíček není automaticky instalován nový projekt šablony aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-214">This package is not automatically installed by the API app new-project template.</span></span>
2. <span data-ttu-id="b2b0c-215">V *řadiče nebo ToDoListController*, zrušte komentář kódu v `NewDataAPIClient` metoda, která přidává token do HTTP požadavky v hlavičce autorizace.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-215">In *Controllers/ToDoListController*, uncomment the code in the `NewDataAPIClient` method that adds the token to HTTP requests in the authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="b2b0c-216">Nasaďte projekt ToDoListAPI.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-216">Deploy the ToDoListAPI project.</span></span> <span data-ttu-id="b2b0c-217">(Klikněte pravým tlačítkem na projekt a pak klikněte na **publikovat > Publikovat**.)</span><span class="sxs-lookup"><span data-stu-id="b2b0c-217">(Right-click the project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="b2b0c-218">Visual Studio nasadí projekt a otevře prohlížeč na základní adresu URL webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-218">Visual Studio deploys the project and opens a browser to the web app's base URL.</span></span> <span data-ttu-id="b2b0c-219">Zobrazí 403 chybovou stránku, což je normální pro pokus o přechod z prohlížeče do webového rozhraní API základní adresu URL.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-219">This will show a 403 error page, which is normal for an attempt to go to a Web API base URL from a browser.</span></span>
4. <span data-ttu-id="b2b0c-220">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-220">Close the browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="b2b0c-221">Získat hodnoty konfigurace Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="b2b0c-222">V [portál Azure classic](https://manage.windowsazure.com/), přejděte na **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-222">In the [Azure classic portal](https://manage.windowsazure.com/), go to **Azure Active Directory**.</span></span>
2. <span data-ttu-id="b2b0c-223">Na **Directory** , klikněte na vašem tenantovi AAD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-223">On the **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="b2b0c-224">Klikněte na tlačítko **aplikace > Moje společnost vlastní aplikace**a klikněte na symbol zaškrtnutí.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-224">Click **Applications > Applications my company owns**, and then click the check mark.</span></span>
4. <span data-ttu-id="b2b0c-225">V seznamu aplikací klikněte na název ten, který vytvořil Azure za vás, pokud jste povolili ověřování pro aplikaci API ToDoListDataAPI (datové vrstvy).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-225">In the list of applications, click the name of the one that Azure created for you when you enabled authentication for the ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="b2b0c-226">Klikněte na kartu **KONFIGUROVAT**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-226">Click the **Configure** tab.</span></span>
6. <span data-ttu-id="b2b0c-227">Kopírování **ID klienta** hodnotu a uložte ho někde můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-227">Copy the **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="b2b0c-228">V Azure classic portálu přejděte zpět do seznamu **aplikace Moje společnost vlastní**a klikněte na aplikaci AAD, kterou jste vytvořili pro (ten, který jste vytvořili v předchozí kurzu, nikoli k tomu, které jste vytvořili aplikaci ToDoListAPI API střední vrstvy v tomto kurzu).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-228">In the Azure classic portal go back to the list of **Applications my company owns**, and click the AAD application that you created for the middle tier ToDoListAPI API app (the one you created in the previous tutorial, not the one you created in this tutorial).</span></span>
8. <span data-ttu-id="b2b0c-229">Klikněte na kartu **KONFIGUROVAT**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-229">Click the **Configure** tab.</span></span>
9. <span data-ttu-id="b2b0c-230">Kopírování **ID klienta** hodnotu a uložte ho někde můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-230">Copy the **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="b2b0c-231">V části **klíče**, vyberte **1 rok** z **vyberte dobu trvání** rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-231">Under **keys**, select **1 year** from the **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="b2b0c-232">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-232">Click **Save**.</span></span>
    
     ![Vygenerování klíče aplikace](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="b2b0c-234">Zkopírujte hodnotu klíče a uložte někde, které můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-234">Copy the key value and save it someplace you can get it from later.</span></span>
    
     ![Zkopírujte nový klíč aplikace](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-the-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="b2b0c-236">Konfigurace nastavení služby Azure AD v aplikaci API střední vrstvy běhového prostředí</span><span class="sxs-lookup"><span data-stu-id="b2b0c-236">Configure Azure AD settings in the middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="b2b0c-237">Přejděte na [portál Azure](https://portal.azure.com/)a potom přejděte na **aplikace API** okno pro aplikaci API, který je hostitelem projektu TodoListAPI (střední úroveň).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-237">Go to the [Azure portal](https://portal.azure.com/), and then navigate to the **API App** blade for the API app that hosts the TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="b2b0c-238">Klikněte na **Nastavení > Nastavení aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="b2b0c-239">V **nastavení aplikace** přidejte následující klíče a hodnoty:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-239">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="b2b0c-240">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-240">**Key**</span></span> | <span data-ttu-id="b2b0c-241">IDA: autority</span><span class="sxs-lookup"><span data-stu-id="b2b0c-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-242">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-242">**Value**</span></span> |<span data-ttu-id="b2b0c-243">https://Login.microsoftonline.com/ {název klienta Azure AD}</span><span class="sxs-lookup"><span data-stu-id="b2b0c-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="b2b0c-244">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-244">**Example**</span></span> |<span data-ttu-id="b2b0c-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="b2b0c-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="b2b0c-246">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-246">**Key**</span></span> | <span data-ttu-id="b2b0c-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="b2b0c-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-248">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-248">**Value**</span></span> |<span data-ttu-id="b2b0c-249">ID klienta je volající aplikace (střední úroveň - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b2b0c-249">Client ID of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b2b0c-250">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-250">**Example**</span></span> |<span data-ttu-id="b2b0c-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="b2b0c-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="b2b0c-252">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-252">**Key**</span></span> | <span data-ttu-id="b2b0c-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="b2b0c-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-254">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-254">**Value**</span></span> |<span data-ttu-id="b2b0c-255">Klíč aplikace z volající aplikace (střední úroveň - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b2b0c-255">App key of the calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b2b0c-256">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-256">**Example**</span></span> |<span data-ttu-id="b2b0c-257">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="b2b0c-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="b2b0c-258">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-258">**Key**</span></span> | <span data-ttu-id="b2b0c-259">IDA: prostředků</span><span class="sxs-lookup"><span data-stu-id="b2b0c-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-260">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-260">**Value**</span></span> |<span data-ttu-id="b2b0c-261">ID klienta názvem aplikace (datovou vrstvu - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="b2b0c-261">Client ID of the called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="b2b0c-262">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-262">**Example**</span></span> |<span data-ttu-id="b2b0c-263">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="b2b0c-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="b2b0c-264">**Poznámka:**: pro `ida:Resource`, nezapomeňte použít názvem aplikace **ID klienta** a ne její **identifikátor ID URI aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-264">**Note**: For `ida:Resource`, make sure you use the called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="b2b0c-265">`ida:ClientId`a `ida:Resource` jsou různé hodnoty pro tento kurz vzhledem k tomu, že používáte samostatné applicaations Azure AD pro střední vrstvy a datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for the middle tier and data tier.</span></span> <span data-ttu-id="b2b0c-266">Pokud jste používali jedné aplikaci Azure AD pro volání rozhraní API app a chráněné aplikace API, použijete stejnou hodnotu v obou `ida:ClientId` a `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-266">If you were using a single Azure AD application for the calling API app and the protected API app, you would use the same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="b2b0c-267">Kód používá ConfigurationManager k získání těchto hodnot, tak může být uložený v souboru Web.config projektu nebo v Azure běhové prostředí.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-267">The code uses ConfigurationManager to get these values, so they could be stored in the project's Web.config file or in the Azure runtime environment.</span></span> <span data-ttu-id="b2b0c-268">Při spuštěné aplikaci ASP.NET ve službě Azure App Service přepsat nastavení prostředí automaticky nastavení ze souboru Web.config.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config.</span></span> <span data-ttu-id="b2b0c-269">Nastavení prostředí jsou obecně [víc zabezpečit uložit citlivé informace, které jsou ve srovnání se souborem Web.config](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-269">Environment settings are generally a [more secure way to store sensitive information compared to a Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="b2b0c-270">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-270">Click **Save**.</span></span>
   
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-the-application"></a><span data-ttu-id="b2b0c-272">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="b2b0c-272">Test the application</span></span>
1. <span data-ttu-id="b2b0c-273">V prohlížeči přejděte na adresu URL HTTPS webové aplikace front-endu AngularJS.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-273">In a browser go to the HTTPS URL of the AngularJS front end web app.</span></span>
2. <span data-ttu-id="b2b0c-274">Klikněte **seznam úkolů** kartě a přihlaste se pomocí pověření pro uživatele v klientovi služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-274">Click the **To Do List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="b2b0c-275">Přidání položek seznamu úkolů pro ověřte, zda aplikace funguje.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-275">Add to-do items to verify that the application is working.</span></span>
   
    ![Seznam úkolů stránky](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="b2b0c-277">Pokud aplikace nebude fungovat podle očekávání, zkontrolujte všechna nastavení, které jste zadali v portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-277">If the application doesn't work as expected, double-check all of the settings you entered in the Azure portal.</span></span> <span data-ttu-id="b2b0c-278">Pokud všechna nastavení zdají být správná, přečtěte si téma [Poradce při potížích s](#troubleshooting) později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-278">If all of the settings appear to be correct, see the [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-the-api-app-from-browser-access"></a><span data-ttu-id="b2b0c-279">Aplikace API jsou chráněny před přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b2b0c-279">Protect the API app from browser access</span></span>
<span data-ttu-id="b2b0c-280">V tomto kurzu jste vytvořili samostatné aplikaci Azure AD pro aplikaci API ToDoListDataAPI (datové vrstvy).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-280">For this tutorial you created a separate Azure AD application for the ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b2b0c-281">Jak jste se seznámili, když služby App Service vytvoří aplikaci AAD, nakonfiguruje aplikaci AAD způsobem, který umožňuje uživatelům přejít na adresu URL aplikace API v prohlížeči a přihlaste se.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-281">As you've seen, when App Service creates an AAD application, it configures the AAD application in a way that enables a user to go to the API app's URL in a browser and log on.</span></span> <span data-ttu-id="b2b0c-282">To znamená, že je možné pro koncového uživatele v klientovi Azure AD, ne jenom instančního objektu, pro přístup k rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-282">That means it's possible for an end user in your Azure AD tenant, not just a service principal, to access the API.</span></span> 

<span data-ttu-id="b2b0c-283">Pokud chcete, aby se zabránilo přístup z prohlížeče bez psaní kódu v chráněném aplikaci API, můžete změnit **adresa URL odpovědi** v aplikaci AAD, aby se liší od aplikace API základní adresu URL.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-283">If you want to prevent browser access without writing any code in the protected API app, you can change the **Reply URL** in the AAD application so that it's different from the API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="b2b0c-284">Zakázat přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b2b0c-284">Disable browser access</span></span>
1. <span data-ttu-id="b2b0c-285">Na portálu classic **konfigurace** kartě pro AAD aplikace, které bylo vytvořeno za TodoListService, změňte hodnotu v **adresa URL odpovědi** pole tak, aby se platná adresa URL, ale není adresa URL aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-285">In the classic portal's **Configure** tab for the AAD application that was created for the TodoListService, change the value in the **Reply URL** field so that it is a valid URL but not the API app's URL.</span></span>
2. <span data-ttu-id="b2b0c-286">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-286">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="b2b0c-287">Ověřte, že přístup z prohlížeče přestane fungovat.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-287">Verify browser access no longer works</span></span>
<span data-ttu-id="b2b0c-288">Dříve jste ověřili, že můžete přejít na adresu URL aplikace API z prohlížeče pomocí přihlášení s přihlašovacími údaji pro jednotlivé uživatele.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-288">Earlier you verified that you can go to the API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="b2b0c-289">V této části ověřte, že to není možné.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-289">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="b2b0c-290">V nové okno prohlížeče přejděte na adresu URL aplikace API znovu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-290">In a new browser window, go to the URL of the API app again.</span></span>
2. <span data-ttu-id="b2b0c-291">Přihlaste se při výzvě.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-291">Log in when prompted to do so.</span></span>
3. <span data-ttu-id="b2b0c-292">Přihlášení úspěšné, ale vede k chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-292">Login succeeds but leads to an error page.</span></span>
   
    <span data-ttu-id="b2b0c-293">Aplikace AAD jste nakonfigurovali tak, aby uživatelé v tenantovi AAD nemůže přihlásit a přístup k rozhraní API z prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-293">You've configured the AAD app so that users in the AAD tenant cannot log in and access the API from a browser.</span></span> <span data-ttu-id="b2b0c-294">Aplikace API můžete stále přístup pomocí tokenu hlavní služby, které můžete ověřit tak, že přejdete na adresu URL webové aplikace a přidání více položkami seznamu úkolů.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-294">You can still access the API app by using a service principal token, which you can verify by going to the web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-to-a-particular-service-principal"></a><span data-ttu-id="b2b0c-295">Omezení přístupu k objektu konkrétní služby</span><span class="sxs-lookup"><span data-stu-id="b2b0c-295">Restrict access to a particular service principal</span></span>
<span data-ttu-id="b2b0c-296">Teď, všechny volající, který můžete získat token pro uživatele nebo instančního objektu v klientovi služby Azure AD můžete volat aplikaci API TodoListDataAPI (datové vrstvy).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-296">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call the TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b2b0c-297">Můžete chtít Ujistěte se, že aplikaci API datové vrstvy přijímá pouze volání z aplikace API TodoListAPI (střední úroveň) a pouze z konkrétní instanční objekt.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-297">You might want to make sure that the data tier API app only accepts calls from the TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="b2b0c-298">Můžete přidat tato omezení přidání kódu k ověření `appid` a `objectidentifier` deklarace identity na příchozí volání.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-298">You can add these restrictions by adding code to validate the `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="b2b0c-299">Pro účely tohoto kurzu umístíte kód, který ověří ID aplikace a ID objektu zabezpečení služby přímo v vaše akce kontroleru.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-299">For this tutorial you put the code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="b2b0c-300">Alternativy se mají použít vlastní `Authorize` atribut, nebo pokud chcete provést toto ověření v po spuštění pořadí (např. middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-300">Alternatives are to use a custom `Authorize` attribute or to do this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="b2b0c-301">Příklad k tomu, najdete v části [této ukázkové aplikaci](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-301">For an example of the latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="b2b0c-302">Proveďte následující změny na projekt TodoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-302">Make the following changes to the TodoListDataAPI project.</span></span>

1. <span data-ttu-id="b2b0c-303">Otevřete *Controllers/TodoListController.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-303">Open the *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="b2b0c-304">Zrušením komentáře u řádků, které nastavit `trustedCallerClientId` a `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-304">Uncomment the lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="b2b0c-305">Zrušením komentáře u kód v metodě CheckCallerId.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-305">Uncomment the code in the CheckCallerId method.</span></span> <span data-ttu-id="b2b0c-306">Tato metoda je volána na začátku každou metodu akce v kontroleru.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-306">This method is called at the start of every action method in the controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "The appID or service principal ID is not the expected value." });
            }
        }
4. <span data-ttu-id="b2b0c-307">Znovu nasaďte projekt ToDoListDataAPI do služby Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-307">Redeploy the ToDoListDataAPI project to Azure App Service.</span></span>
5. <span data-ttu-id="b2b0c-308">V prohlížeči přejděte na adresu URL HTTPS AngularJS front-endu webové aplikace a na domovské stránce klikněte **seznam úkolů** kartě.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-308">In your browser, go to the AngularJS front end web app's HTTPS URL, and in the home page click the **To Do List** tab.</span></span>
   
    <span data-ttu-id="b2b0c-309">Aplikace nebude fungovat, protože selhávají volání back-end.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-309">The application doesn't work because calls to the back end are failing.</span></span> <span data-ttu-id="b2b0c-310">Nový kód je kontrola skutečné appid a které, ale ještě nemá správné hodnoty zkontrolovat je proti.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-310">The new code is checking actual appid and objectidentifier but it doesn't yet have the correct values to check them against.</span></span> <span data-ttu-id="b2b0c-311">V prohlížeči konzolu nástroje pro vývojáře hlásí, že server vrací chybu HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-311">The browser Developer Tools Console reports that the server is returning an HTTP 401 error.</span></span>
   
    ![Došlo k chybě v vývojáře nástrojů konzoly](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="b2b0c-313">V následujících krocích nakonfigurujete očekávaných hodnot.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-313">In the following steps you configure the expected values.</span></span>
6. <span data-ttu-id="b2b0c-314">Pomocí Azure AD PowerShell, získáte hodnotu objektu služby pro aplikaci Azure AD, kterou jste vytvořili pro projekt TodoListWebApp.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-314">Using Azure AD PowerShell, get the value of the service principal for the Azure AD application that you created for the TodoListWebApp project.</span></span>
   
    <span data-ttu-id="b2b0c-315">a.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-315">a.</span></span> <span data-ttu-id="b2b0c-316">Pokyny o tom, jak nainstalovat Azure PowerShell a připojte se k předplatnému najdete v tématu [použití Azure Powershellu s Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-316">For instructions on how to install Azure PowerShell and connect to your subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="b2b0c-317">b.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-317">b.</span></span> <span data-ttu-id="b2b0c-318">Pokud chcete získat seznam objekty služby, spusťte `Login-AzureRmAccount` příkaz a potom `Get-AzureRmADServicePrincipal` příkaz.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-318">To get a list of service principals, execute the `Login-AzureRmAccount` command and then the `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="b2b0c-319">c.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-319">c.</span></span> <span data-ttu-id="b2b0c-320">Najít objectid pro objekt služby TodoListAPI aplikace a uložit ho do umístění, které můžete zkopírovat z později.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-320">Find the objectid for the service principal of the TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="b2b0c-321">Na portálu Azure přejděte do okna aplikace API pro aplikaci API, které jste nasadili projekt ToDoListDataAPI.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-321">In the Azure portal, navigate to the API app blade for the API app that you deployed the ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="b2b0c-322">Klikněte na tlačítko **Nastavení > Nastavení aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-322">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="b2b0c-323">V **nastavení aplikace** přidejte následující klíče a hodnoty:</span><span class="sxs-lookup"><span data-stu-id="b2b0c-323">In the **App settings** section, add the following keys and values:</span></span>
   
   | <span data-ttu-id="b2b0c-324">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-324">**Key**</span></span> | <span data-ttu-id="b2b0c-325">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="b2b0c-325">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-326">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-326">**Value**</span></span> |<span data-ttu-id="b2b0c-327">Id objektu zabezpečení služby volání aplikace</span><span class="sxs-lookup"><span data-stu-id="b2b0c-327">Service principal id of calling application</span></span> |
   | <span data-ttu-id="b2b0c-328">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-328">**Example**</span></span> |<span data-ttu-id="b2b0c-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="b2b0c-329">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="b2b0c-330">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-330">**Key**</span></span> | <span data-ttu-id="b2b0c-331">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="b2b0c-331">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b2b0c-332">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-332">**Value**</span></span> |<span data-ttu-id="b2b0c-333">ID klienta volání aplikace – zkopírovaných z aplikace TodoListAPI Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-333">Client ID of calling application - copied from the TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="b2b0c-334">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b2b0c-334">**Example**</span></span> |<span data-ttu-id="b2b0c-335">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="b2b0c-335">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="b2b0c-336">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-336">Click **Save**.</span></span>
    
     ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="b2b0c-338">V prohlížeči, vraťte se na adresu URL webové aplikace a na domovské stránce klikněte **seznam úkolů** kartě.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-338">In your browser, return to the web app's URL, and in the home page click the **To Do List** tab.</span></span>
    
     <span data-ttu-id="b2b0c-339">Tentokrát aplikace funguje podle očekávání, protože aplikace důvěryhodné volající ID a ID objektu zabezpečení služby jsou očekávaných hodnot.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-339">This time the application works as expected because the trusted caller app ID and service principal ID are the expected values.</span></span>
    
     ![Seznam úkolů stránky](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-the-projects-from-scratch"></a><span data-ttu-id="b2b0c-341">Sestavení projektů od začátku</span><span class="sxs-lookup"><span data-stu-id="b2b0c-341">Building the projects from scratch</span></span>
<span data-ttu-id="b2b0c-342">Dva projekty webového rozhraní API, které byly vytvořeny pomocí **aplikace API Azure** šablony a nahrazení řadiče hodnoty výchozí řadič seznamu úkolů projektu.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-342">The two Web API projects were created by using the **Azure API App** project template and replacing the default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="b2b0c-343">Pro získání hlavní tokeny služby Azure AD v projektu ToDoListAPI [Active Directory Authentication Library (ADAL) pro rozhraní .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) byl nainstalován balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-343">For acquiring Azure AD service principal tokens in the ToDoListAPI project, the [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="b2b0c-344">Informace o tom, jak vytvořit jednostránková aplikace AngularJS s webového rozhraní API back-end, jako je ToDoListAngular najdete v tématu [rukou na testovacím: sestavení jedné stránce aplikace (SPA) pomocí rozhraní ASP.NET Web API a Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-344">For information about how to  create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="b2b0c-345">Informace o tom, jak přidat kód pro ověřování Azure AD najdete v tématu [zabezpečení AngularJS jedné stránky aplikací s Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-345">For information about how to add Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b2b0c-346">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="b2b0c-346">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="b2b0c-347">Ujistěte se, že jste Nepleťte ToDoListAPI (střední úroveň) a ToDoListDataAPI (datové vrstvy).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-347">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="b2b0c-348">Například v tomto kurzu přidáte ověřování pro aplikaci API datové vrstvy, **klíč aplikace musí pocházet z aplikace Azure AD, kterou jste vytvořili pro aplikaci API střední vrstvy, ale**.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-348">For example, in this tutorial you add authentication to the data tier API app, **but the app key must come from the Azure AD application that you created for the middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b2b0c-349">Další kroky</span><span class="sxs-lookup"><span data-stu-id="b2b0c-349">Next steps</span></span>
<span data-ttu-id="b2b0c-350">Toto je poslední kurz v řadě aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-350">This is the last tutorial in the API Apps series.</span></span> 

<span data-ttu-id="b2b0c-351">Další informace o službě Azure Active Directory najdete v následujících materiálech.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-351">For more information about Azure Active Directory, see the following resources.</span></span>

* [<span data-ttu-id="b2b0c-352">Průvodce Azure AD vývojářům</span><span class="sxs-lookup"><span data-stu-id="b2b0c-352">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="b2b0c-353">Scénáře služby Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-353">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="b2b0c-354">Ukázek Azure AD</span><span class="sxs-lookup"><span data-stu-id="b2b0c-354">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="b2b0c-355">[WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) ukázka je podobná informace zobrazené v tomto kurzu, ale bez použití ověřování služby App Service.</span><span class="sxs-lookup"><span data-stu-id="b2b0c-355">The [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar to what is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="b2b0c-356">Informace o jiných způsobech nasazení projektů sady Visual Studio do aplikace API, pomocí sady Visual Studio nebo [automatizace nasazení](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) z [systému správy zdrojů](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), najdete v části [nasazení Azure Aplikační služby](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="b2b0c-356">For information about other ways to deploy Visual Studio projects to API apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How to deploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>


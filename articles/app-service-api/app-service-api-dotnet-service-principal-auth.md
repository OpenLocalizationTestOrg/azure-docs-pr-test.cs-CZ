---
title: "ověření objektu aaaService pro API Apps v Azure App Service | Microsoft Docs"
description: "Zjistěte, jak aplikace tooprotect rozhraní API v Azure App Service pro scénáře service-to-service."
services: app-service\api
documentationcenter: .net
author: alexkarcher-msft
manager: erikre
editor: 
ms.assetid: 7ca0bab2-1d29-4d51-b779-dce0edd34f8b
ms.service: app-service-api
ms.workload: na
ms.tgt_pltfrm: dotnet
ms.devlang: na
ms.topic: article
ms.date: 06/30/2016
ms.author: alkarche
ms.openlocfilehash: 94d9ee11f38293df4a2fd815ef02c59cc6defed4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="service-principal-authentication-for-api-apps-in-azure-app-service"></a><span data-ttu-id="b1784-103">Objekt zabezpečení ověřování služby pro aplikace API v Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b1784-103">Service principal authentication for API Apps in Azure App Service</span></span>
## <a name="overview"></a><span data-ttu-id="b1784-104">Přehled</span><span class="sxs-lookup"><span data-stu-id="b1784-104">Overview</span></span>
<span data-ttu-id="b1784-105">Tento článek vysvětluje, jak toouse ověřování služby App Service pro *interní* přístup k aplikacím tooAPI.</span><span class="sxs-lookup"><span data-stu-id="b1784-105">This article explains how toouse App Service authentication for *internal* access tooAPI apps.</span></span> <span data-ttu-id="b1784-106">Vnitřní scénář je, kdy máte aplikaci API, že chcete toobe použití pouze podle kódu aplikace.</span><span class="sxs-lookup"><span data-stu-id="b1784-106">An internal scenario is where you have an API app that you want toobe consumable only by your own application code.</span></span> <span data-ttu-id="b1784-107">Hello doporučená tooimplement způsob, jak tento scénář ve službě App Service je toouse Azure AD tooprotect hello volá aplikaci API.</span><span class="sxs-lookup"><span data-stu-id="b1784-107">hello recommended way tooimplement this scenario in App Service is toouse Azure AD tooprotect hello called API app.</span></span> <span data-ttu-id="b1784-108">Volání rozhraní API aplikace hello chráněné pomocí token nosiče, který můžete získat z Azure AD tím, že poskytuje identitu aplikace (instanční objekt) přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="b1784-108">You call hello protected API app with a bearer token that you get from Azure AD by providing application identity (service principal) credentials.</span></span> <span data-ttu-id="b1784-109">Alternativy toousing Azure AD, najdete v části hello **Service-to-service ověřování** části hello [Přehled ověřování služby Azure App Service](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span><span class="sxs-lookup"><span data-stu-id="b1784-109">For alternatives toousing Azure AD, see hello **Service-to-service authentication** section of hello [Azure App Service authentication overview](../app-service/app-service-authentication-overview.md#service-to-service-authentication).</span></span>

<span data-ttu-id="b1784-110">V tomto článku se dozvíte:</span><span class="sxs-lookup"><span data-stu-id="b1784-110">In this article, you'll learn:</span></span>

* <span data-ttu-id="b1784-111">Jak aplikace tooprotect rozhraní API služby Azure Active Directory (Azure AD) toouse z neověřené přístup.</span><span class="sxs-lookup"><span data-stu-id="b1784-111">How toouse Azure Active Directory (Azure AD) tooprotect an API app from unauthenticated access.</span></span>
* <span data-ttu-id="b1784-112">Jak aplikace tooconsume chráněné rozhraní API z aplikace API, webovou aplikaci nebo mobilní aplikace pomocí pověření hlavní (identita aplikace) služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-112">How tooconsume a protected API app from an API app, web app, or mobile app by using Azure AD service principal (app identity) credentials.</span></span> <span data-ttu-id="b1784-113">Informace o tom najdete v části tooconsume z aplikace logiky, [používání vlastního rozhraní API hostovaného v App Service pomocí aplikací logiky](../logic-apps/logic-apps-custom-hosted-api.md).</span><span class="sxs-lookup"><span data-stu-id="b1784-113">For information about how tooconsume from a logic app, see [Using your custom API hosted on App Service with Logic apps](../logic-apps/logic-apps-custom-hosted-api.md).</span></span>
* <span data-ttu-id="b1784-114">Jak se, že tento hello chráněné aplikace API toomake nelze volat z prohlížeče pomocí přihlášených uživatelů.</span><span class="sxs-lookup"><span data-stu-id="b1784-114">How toomake sure that hello protected API app can't be called from a browser by logged on users.</span></span>
* <span data-ttu-id="b1784-115">Jak pouze toomake jisti, že hello chráněn aplikace API je možné volat v konkrétní objekt služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-115">How toomake sure that hello protected API app can only be called by a specific Azure AD service principal.</span></span>

<span data-ttu-id="b1784-116">Hello článek obsahuje dvě části:</span><span class="sxs-lookup"><span data-stu-id="b1784-116">hello article contains two sections:</span></span>

* <span data-ttu-id="b1784-117">Hello [jak tooconfigure služby ověření objektu ve službě Azure App Service](#authconfig) část vysvětluje v obecné postupy tooconfigure ověřování pro všechny aplikace API a jak tooconsume hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-117">hello [How tooconfigure service principal authentication in Azure App Service](#authconfig) section explains in general how tooconfigure authentication for any API app, and how tooconsume hello protected API app.</span></span> <span data-ttu-id="b1784-118">Tato část se vztahuje stejnou měrou tooall rozhraní podporované službou App Service, včetně .NET, Node.js a Java.</span><span class="sxs-lookup"><span data-stu-id="b1784-118">This section applies equally tooall frameworks supported by App Service, including .NET, Node.js, and Java.</span></span>
* <span data-ttu-id="b1784-119">Počínaje hello [pokračování úvodních kurzů .NET hello](#tutorialstart) části hello kurz vás provede konfiguraci "interní přístup" scénáře pro ukázkové aplikace .NET spuštěna ve službě App Service.</span><span class="sxs-lookup"><span data-stu-id="b1784-119">Starting with hello [Continuing hello .NET getting-started tutorials](#tutorialstart) section, hello tutorial guides you through configuring an "internal access" scenario for a .NET sample application running in App Service.</span></span> 

## <span data-ttu-id="b1784-120"><a id="authconfig"></a>Jak tooconfigure služby ověření objektu ve službě Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b1784-120"><a id="authconfig"></a> How tooconfigure service principal authentication in Azure App Service</span></span>
<span data-ttu-id="b1784-121">Tato část obsahuje obecné pokyny, které se vztahují tooany aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-121">This section provides general instructions that apply tooany API app.</span></span> <span data-ttu-id="b1784-122">Pro konkrétní toohello tooDo kroky seznamu .NET ukázkovou aplikaci, přejděte příliš[pokračováním řady kurz .NET API Apps hello](#tutorialstart).</span><span class="sxs-lookup"><span data-stu-id="b1784-122">For steps specific toohello tooDo List .NET sample application, go too[Continuing hello .NET API Apps tutorial series](#tutorialstart).</span></span>

1. <span data-ttu-id="b1784-123">V hello [portál Azure](https://portal.azure.com/), přejděte toohello **nastavení** okno aplikace hello rozhraní API, které chcete tooprotect a pak vyhledejte hello **funkce** části a klikněte na tlačítko **Ověřování / autorizace**.</span><span class="sxs-lookup"><span data-stu-id="b1784-123">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you want tooprotect, and then find hello **Features** section and click **Authentication/ Authorization**.</span></span>
   
    ![Ověřování/autorizace služby na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
2. <span data-ttu-id="b1784-125">V hello **ověřování / autorizace** okně klikněte na tlačítko **na**.</span><span class="sxs-lookup"><span data-stu-id="b1784-125">In hello **Authentication / Authorization** blade, click **On**.</span></span>
3. <span data-ttu-id="b1784-126">V hello **tootake akce, když požadavek nebude ověřený** rozevíracího seznamu vyberte **přihlásit se přes Azure Active Directory** .</span><span class="sxs-lookup"><span data-stu-id="b1784-126">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory** .</span></span>
4. <span data-ttu-id="b1784-127">V části **zprostředkovatele ověřování**, vyberte **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b1784-127">Under **Authentication Providers**, select **Azure Active Directory**.</span></span>
   
    ![Ověřování/autorizace okno na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
5. <span data-ttu-id="b1784-129">Konfigurace hello **nastavení Azure Active Directory** toocreate okno Nový Azure AD aplikace, nebo použijte existující aplikaci Azure AD Pokud již účet máte, které chcete toouse.</span><span class="sxs-lookup"><span data-stu-id="b1784-129">Configure hello **Azure Active Directory Settings** blade toocreate a new Azure AD application, or use an existing Azure AD application if you already have one that you want toouse.</span></span>
   
    <span data-ttu-id="b1784-130">Interní scénáře jsou obvykle aplikace API volání aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-130">Internal scenarios typically involve an API app calling an API app.</span></span> <span data-ttu-id="b1784-131">Můžete použít samostatné Azure AD aplikací pro každou aplikaci API nebo pouze jednu aplikaci Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-131">You can use separate Azure AD applications for each API app or just one Azure AD application.</span></span>
   
    <span data-ttu-id="b1784-132">Podrobné pokyny v tomto okně najdete v tématu [jak tooconfigure přihlášení vaší služby App Service toouse aplikace Azure Active Directory](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="b1784-132">For detailed instructions on this blade, see [How tooconfigure your App Service application toouse Azure Active Directory login](../app-service-mobile/app-service-mobile-how-to-configure-active-directory-authentication.md).</span></span>
6. <span data-ttu-id="b1784-133">Když jste hotovi s hello ověřování zprostředkovatele konfigurace okna, klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b1784-133">When you're done with hello authentication provider configuration blade, click **OK**.</span></span>
7. <span data-ttu-id="b1784-134">V hello **ověřování / autorizace** okně klikněte na tlačítko **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-134">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
   
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/authsave.png)

<span data-ttu-id="b1784-136">Když to uděláte, služby App Service umožňuje požadavků pouze z volající v klientovi Azure AD hello nakonfigurované.</span><span class="sxs-lookup"><span data-stu-id="b1784-136">When this is done, App Service only allows requests from callers in hello configured Azure AD tenant.</span></span> <span data-ttu-id="b1784-137">V aplikaci API hello chráněné je vyžadován žádný kód ověřování nebo autorizace.</span><span class="sxs-lookup"><span data-stu-id="b1784-137">No authentication or authorization code is required in hello protected API app.</span></span> <span data-ttu-id="b1784-138">Hello tokenu nosiče je předán toohello rozhraní API aplikace společně se běžně používané deklarací identity v hlavičkách protokolu HTTP, a můžete si přečíst tyto informace v toovalidate kódu, které požadavky jsou z konkrétní volající, jako je například hlavní název služby.</span><span class="sxs-lookup"><span data-stu-id="b1784-138">hello bearer token is passed toohello API app along with commonly used claims in HTTP headers, and you can read that information in code toovalidate that requests are from a particular caller, such as a service principal.</span></span>

<span data-ttu-id="b1784-139">Tato funkce ověřování funguje hello stejným způsobem jako pro všechny jazyky, podporuje aplikace služby, včetně .NET, Node.js a Java.</span><span class="sxs-lookup"><span data-stu-id="b1784-139">This authentication functionality works hello same way for all languages that App service supports, including .NET, Node.js, and Java.</span></span> 

#### <a name="how-tooconsume-hello-protected-api-app"></a><span data-ttu-id="b1784-140">Tom, jak tooconsume hello chráněný aplikace API</span><span class="sxs-lookup"><span data-stu-id="b1784-140">How tooconsume hello protected API app</span></span>
<span data-ttu-id="b1784-141">Hello volající musí poskytnout volání rozhraní API tokenu nosiče Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-141">hello caller must provide an Azure AD bearer token with API calls.</span></span> <span data-ttu-id="b1784-142">tooget nosný token pomocí přihlašovacích údajů hlavní služby, volající hello používá služby Active Directory Authentication Library (ADAL pro [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), nebo [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span><span class="sxs-lookup"><span data-stu-id="b1784-142">tooget a bearer token using service principal credentials, hello caller uses Active Directory Authentication Library (ADAL for [.NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory), [Node.js](https://github.com/AzureAD/azure-activedirectory-library-for-nodejs), or [Java](https://github.com/AzureAD/azure-activedirectory-library-for-java)).</span></span> <span data-ttu-id="b1784-143">tooget token hello kód, který volá ADAL poskytuje tooADAL hello následující informace:</span><span class="sxs-lookup"><span data-stu-id="b1784-143">tooget a token, hello code that calls ADAL provides tooADAL hello following information:</span></span>

* <span data-ttu-id="b1784-144">Hello název klienta služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-144">hello name of your Azure AD tenant.</span></span>
* <span data-ttu-id="b1784-145">Hello ID a klienta tajný klíč klienta (klíč aplikace) přidružené k hello volající aplikace hello Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-145">hello client ID and client secret (app key) of hello Azure AD app associated with hello caller.</span></span>
* <span data-ttu-id="b1784-146">ID klienta Hello hello aplikace Azure AD, které jsou spojené s hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-146">hello client ID of hello Azure AD application associated with hello protected API app.</span></span> <span data-ttu-id="b1784-147">(Pokud se používá pouze jednu aplikaci Azure AD, to je hello stejné ID klienta jako text hello, jeden pro volající hello.)</span><span class="sxs-lookup"><span data-stu-id="b1784-147">(If just one Azure AD application is used, this is hello same client ID as hello one for hello caller.)</span></span>

<span data-ttu-id="b1784-148">Tyto hodnoty jsou k dispozici hello Azure AD stránkách hello [portál Azure classic](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="b1784-148">These values are available in hello Azure AD pages of hello [Azure classic portal](https://manage.windowsazure.com/).</span></span>

<span data-ttu-id="b1784-149">Jakmile získal hello token hello volající ji obsahuje u žádostí protokolu HTTP v hlavičce autorizace hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-149">Once hello token has been acquired, hello caller includes it with HTTP requests in hello Authorization header.</span></span>  <span data-ttu-id="b1784-150">Služba App Service ověří hello token a umožňuje hello požadavky tooreach hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-150">App Service validates hello token and allows hello requests tooreach hello protected API app.</span></span>

#### <a name="how-tooprotect-hello-api-app-from-access-by-users-in-hello-same-tenant"></a><span data-ttu-id="b1784-151">Jak se aplikace hello rozhraní API tooprotect z přístup uživatelům v hello stejné klienta</span><span class="sxs-lookup"><span data-stu-id="b1784-151">How tooprotect hello API app from access by users in hello same tenant</span></span>
<span data-ttu-id="b1784-152">Nosné tokeny pro uživatele ve stejné klienta jsou považovány za platné pro hello hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-152">Bearer tokens for users in hello same tenant are considered valid for hello protected API app.</span></span>  <span data-ttu-id="b1784-153">Pokud chcete tooensure, které lze volat pouze objekt služby hello chráněné aplikace API, přidat kód v hello chráněné rozhraní API aplikace toovalidate hello následující deklarací z tokenu hello:</span><span class="sxs-lookup"><span data-stu-id="b1784-153">If you want tooensure that only a service principal can call hello protected API app, add code in hello protected API app toovalidate hello following claims from hello token:</span></span>

* <span data-ttu-id="b1784-154">`appid`hello ID klienta aplikace Azure AD hello, který je přidružen hello volající by měl být.</span><span class="sxs-lookup"><span data-stu-id="b1784-154">`appid` should be hello client ID of hello Azure AD application that is associated with hello caller.</span></span> 
* <span data-ttu-id="b1784-155">`oid`(`objectidentifier`) by měla být hello ID objektu zabezpečení služby hello volajícího.</span><span class="sxs-lookup"><span data-stu-id="b1784-155">`oid` (`objectidentifier`) should be hello service principal ID of hello caller.</span></span> 

<span data-ttu-id="b1784-156">App Service navíc poskytuje hello `objectidentifier` deklarace identity v záhlaví hello X-MS-CLIENT-hlavní-ID.</span><span class="sxs-lookup"><span data-stu-id="b1784-156">App Service also provides hello `objectidentifier` claim in hello X-MS-CLIENT-PRINCIPAL-ID header.</span></span>

### <a name="how-tooprotect-hello-api-app-from-browser-access"></a><span data-ttu-id="b1784-157">Jak tooprotect hello aplikace API z přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b1784-157">How tooprotect hello API app from browser access</span></span>
<span data-ttu-id="b1784-158">Pokud nemáte ověřit deklarace identity v kódu v aplikaci API hello chráněný, a pokud používáte samostatnou aplikaci Azure AD hello chráněné aplikace API, ujistěte se, že hello je adresa URL odpovědi aplikaci Azure AD není hello stejná hodnota jako hello základní adresu URL aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-158">If you don't validate claims in code in hello protected API app, and if you use a separate Azure AD application for hello protected API app, make sure that hello Azure AD application's Reply URL is not hello same as hello API app's base URL.</span></span> <span data-ttu-id="b1784-159">Pokud adresa URL odpovědi hello odkazuje přímo toohello chráněné aplikace API, uživatel v klientovi hello stejnou službou Azure AD procházet toohello aplikace API, přihlaste se a úspěšně volat rozhraní API hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-159">If hello Reply URL points directly toohello protected API app, a user in hello same Azure AD tenant could browse toohello API app, log on, and successfully call hello API.</span></span>

## <span data-ttu-id="b1784-160"><a id="tutorialstart"></a>Pokračováním řady kurz .NET API Apps hello</span><span class="sxs-lookup"><span data-stu-id="b1784-160"><a id="tutorialstart"></a> Continuing hello .NET API Apps tutorial series</span></span>
<span data-ttu-id="b1784-161">Pokud postupujete podle hello Node.js nebo Java kurz řady pro aplikace API, přeskočte toohello [další kroky](#next-steps) části.</span><span class="sxs-lookup"><span data-stu-id="b1784-161">If you are following hello Node.js or Java tutorial series for API apps, skip toohello [Next steps](#next-steps) section.</span></span> 

<span data-ttu-id="b1784-162">Hello zbývající část tohoto článku pokračuje kurz řady hello .NET API Apps a předpokládá, že jste dokončili hello [kurzu ověřování uživatele](app-service-api-dotnet-user-principal-auth.md) a mít hello ukázková aplikace běžící v Azure s ověřováním uživatele Povolit.</span><span class="sxs-lookup"><span data-stu-id="b1784-162">hello remainder of this article continues hello .NET API Apps tutorial series and assumes that you have completed hello [user authentication tutorial](app-service-api-dotnet-user-principal-auth.md) and have hello sample application running in Azure with user authentication enabled.</span></span>

## <a name="set-up-authentication-in-azure"></a><span data-ttu-id="b1784-163">Nastavení ověřování v Azure</span><span class="sxs-lookup"><span data-stu-id="b1784-163">Set up authentication in Azure</span></span>
<span data-ttu-id="b1784-164">V této části můžete nakonfigurovat App Service, že hello jen protokol HTTP požadavků, umožňuje aplikaci API datové vrstvy v tooreach hello jsou hello ty, které se platný Azure AD nosné tokeny.</span><span class="sxs-lookup"><span data-stu-id="b1784-164">In this section you configure App Service so that hello only HTTP requests it allows tooreach hello data tier API app are hello ones that have valid Azure AD bearer tokens.</span></span> 

<span data-ttu-id="b1784-165">V následující části hello nakonfigurujte toosend aplikaci API střední vrstvy hello aplikace tooAzure pověření AD, získáte zpět token nosiče a odeslat aplikaci API datové vrstvy toohello tokenu nosiče hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-165">In hello following section, you configure hello middle tier API app toosend application credentials tooAzure AD, get back a bearer token, and send hello bearer token toohello data tier API app.</span></span> <span data-ttu-id="b1784-166">Tento proces je znázorněn v diagramu hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-166">This process is illustrated in hello diagram.</span></span>

![Diagram ověřování služby](./media/app-service-api-dotnet-service-principal-auth/appdiagram.png)

<span data-ttu-id="b1784-168">Pokud narazíte na problémy při následující hello kurz pokynů, najdete v části hello [Poradce při potížích s](#troubleshooting) části na konci hello tohoto kurzu hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-168">If you run into problems while following hello tutorial directions, see hello [Troubleshooting](#troubleshooting) section at hello end of hello tutorial.</span></span> 

1. <span data-ttu-id="b1784-169">V hello [portál Azure](https://portal.azure.com/), přejděte toohello **nastavení** okno aplikace hello rozhraní API, který jste vytvořili pro aplikaci API (datové vrstvy) hello ToDoListDataAPI a potom klikněte na **nastavení**.</span><span class="sxs-lookup"><span data-stu-id="b1784-169">In hello [Azure portal](https://portal.azure.com/), navigate toohello **Settings** blade of hello API app that you created for hello ToDoListDataAPI (data tier) API app, and then click **Settings**.</span></span>
2. <span data-ttu-id="b1784-170">V hello **nastavení** okno, najít hello **funkce** části a potom klikněte na **ověřování / autorizace**.</span><span class="sxs-lookup"><span data-stu-id="b1784-170">In hello **Settings** blade, find hello **Features** section, and then click **Authentication / Authorization**.</span></span>
   
    ![Ověřování/autorizace služby na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/features.png)
3. <span data-ttu-id="b1784-172">V hello **ověřování / autorizace** okně klikněte na tlačítko **na**.</span><span class="sxs-lookup"><span data-stu-id="b1784-172">In hello **Authentication / Authorization** blade, click **On**.</span></span>
4. <span data-ttu-id="b1784-173">V hello **tootake akce, když požadavek nebude ověřený** rozevíracího seznamu vyberte **přihlásit se přes Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b1784-173">In hello **Action tootake when request is not authenticated** drop-down list, select **Log in with Azure Active Directory**.</span></span>
   
    <span data-ttu-id="b1784-174">Toto je hello nastavení, které způsobí, že služby App Service tooensure, pouze k ověření aplikace API hello reach požadavky.</span><span class="sxs-lookup"><span data-stu-id="b1784-174">This is hello setting that causes App Service tooensure that only authenticated requests reach hello API app.</span></span> <span data-ttu-id="b1784-175">Pro požadavky, které mají platný nosné tokeny, služby App Service předá hello tokeny podél toohello rozhraní API app a naplní hlavičky protokolu HTTP s běžně používanými deklarací toomake tyto informace snadno dostupné tooyour kódu.</span><span class="sxs-lookup"><span data-stu-id="b1784-175">For requests that have valid bearer tokens, App Service passes hello tokens along toohello API app and populates HTTP headers with commonly used claims toomake that information more easily available tooyour code.</span></span>
5. <span data-ttu-id="b1784-176">V části **zprostředkovatele ověřování**, klikněte na tlačítko **Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b1784-176">Under **Authentication Providers**, click **Azure Active Directory**.</span></span>
   
    ![Ověřování/autorizace okno na portálu Azure](./media/app-service-api-dotnet-user-principal-auth/authblade.png)
6. <span data-ttu-id="b1784-178">V hello **nastavení Azure Active Directory** okně klikněte na tlačítko **Express**.</span><span class="sxs-lookup"><span data-stu-id="b1784-178">In hello **Azure Active Directory Settings** blade, click **Express**.</span></span>
   
    <span data-ttu-id="b1784-179">S hello **Express** možnost Azure můžete automaticky vytvořit aplikaci AAD ve službě Azure AD [klienta](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span><span class="sxs-lookup"><span data-stu-id="b1784-179">With hello **Express** option Azure can automatically create an AAD application in your Azure AD [tenant](https://msdn.microsoft.com/en-us/library/azure/jj573650.aspx#BKMK_WhatIsAnAzureADTenant).</span></span> 
   
    <span data-ttu-id="b1784-180">Nemáte toocreate klienta, protože každý účet Azure automaticky jeden má.</span><span class="sxs-lookup"><span data-stu-id="b1784-180">You don't have toocreate a tenant, because every Azure account automatically has one.</span></span>
7. <span data-ttu-id="b1784-181">V části **režim správy**, klikněte na tlačítko **vytvořit novou aplikaci AD** Pokud již není vybrána.</span><span class="sxs-lookup"><span data-stu-id="b1784-181">Under **Management mode**, click **Create New AD App** if it isn't already selected.</span></span>
   
    <span data-ttu-id="b1784-182">Hello portál připojuje hello **vytvořit aplikaci** vstupní pole výchozí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="b1784-182">hello portal plugs hello **Create App** input box with a default value.</span></span> <span data-ttu-id="b1784-183">Ve výchozím nastavení, je hello aplikaci Azure AD s názvem hello stejné jako aplikace hello rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b1784-183">By default, hello Azure AD application is named hello same as hello API app.</span></span> <span data-ttu-id="b1784-184">Pokud dáváte přednost, můžete zadat jiný název.</span><span class="sxs-lookup"><span data-stu-id="b1784-184">If you prefer, you can enter a different name.</span></span>
   
    ![Nastavení služby Azure AD](./media/app-service-api-dotnet-service-principal-auth/aadsettings.png)
   
    <span data-ttu-id="b1784-186">**Poznámka:**: jako alternativu, můžete použít jednu Azure AD aplikace pro obě hello volání aplikace API a hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-186">**Note**: As an alternative, you could use a single Azure AD application for both hello calling API app and hello protected API app.</span></span> <span data-ttu-id="b1784-187">Pokud jste vybrali tento alternativa, nebude potřeba hello **vytvořit novou aplikaci AD** možnost zde, protože jste již vytvořili aplikaci Azure AD v kurzu ověřování uživatele hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-187">If you chose that alternative, you would not need hello **Create New AD App** option here because you already created an Azure AD application earlier in hello user authentication tutorial.</span></span> <span data-ttu-id="b1784-188">V tomto kurzu budete používat aplikace Azure AD oddělte hello volání aplikace API a hello chráněné aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-188">For this tutorial, you'll use separate Azure AD applications for hello calling API app and hello protected API app.</span></span>
8. <span data-ttu-id="b1784-189">Poznamenejte si hodnotu hello v hello **vytvořit aplikaci** vstupní pole; budete vyhledávání tuto aplikaci AAD v hello portál Azure classic později.</span><span class="sxs-lookup"><span data-stu-id="b1784-189">Make a note of hello value that is in hello **Create App** input box; you'll look up this AAD application in hello Azure classic portal later.</span></span>
9. <span data-ttu-id="b1784-190">Klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="b1784-190">Click **OK**.</span></span>
10. <span data-ttu-id="b1784-191">V hello **ověřování / autorizace** okně klikněte na tlačítko **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-191">In hello **Authentication / Authorization** blade, click **Save**.</span></span>
    
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/saveauth.png)
    
    <span data-ttu-id="b1784-193">Služby App Service vytvoří aplikaci služby Azure Active Directory s **přihlašovací adresa URL** a **adresa URL odpovědi** automaticky nastaví toohello adresu URL aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-193">App Service creates an Azure Active Directory application with **Sign-on URL** and **Reply URL** automatically set toohello URL of your API app.</span></span> <span data-ttu-id="b1784-194">Hodnota pozdější Hello umožňuje uživatelům ve vaší toolog klienta AAD v a aplikace API hello přístup.</span><span class="sxs-lookup"><span data-stu-id="b1784-194">hello latter value enables users in your AAD tenant toolog in and access hello API app.</span></span>

### <a name="verify-that-hello-api-app-is-protected"></a><span data-ttu-id="b1784-195">Ověřte, zda že je chráněný aplikaci hello rozhraní API</span><span class="sxs-lookup"><span data-stu-id="b1784-195">Verify that hello API app is protected</span></span>
1. <span data-ttu-id="b1784-196">Přejděte v prohlížeči adresu URL toohello aplikace hello rozhraní API: v hello **aplikace API** v hello portál Azure, klikněte na odkaz hello pod **URL**.</span><span class="sxs-lookup"><span data-stu-id="b1784-196">In a browser go toohello URL of hello API app: in hello **API app** blade in hello Azure portal, click hello link under **URL**.</span></span> 
   
    <span data-ttu-id="b1784-197">Protože neověřené požadavky nejsou povoleny aplikace API hello tooreach jste přesměrovaného tooa přihlašovací obrazovku.</span><span class="sxs-lookup"><span data-stu-id="b1784-197">You are redirected tooa login screen because unauthenticated requests are not allowed tooreach hello API app.</span></span> 
   
    <span data-ttu-id="b1784-198">Pokud váš prohlížeč přejděte toohello uživatelské rozhraní Swagger, váš prohlížeč pravděpodobně již přihlášeni – v takovém případě otevřete okno InPrivate nebo Incognito a přejděte toohello adresa URL Swaggeru uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="b1784-198">If your browser does go toohello Swagger UI, your browser might already be logged on -- in that case, open an InPrivate or Incognito window and go toohello Swagger UI URL.</span></span>
2. <span data-ttu-id="b1784-199">Přihlaste se pomocí přihlašovacích údajů uživatele ve vašem tenantovi AAD.</span><span class="sxs-lookup"><span data-stu-id="b1784-199">Log in with credentials of a user in your AAD tenant.</span></span>
   
   <span data-ttu-id="b1784-200">Pokud jste přihlášeni, zobrazí se stránka "úspěšně vytvořen" hello v prohlížeči hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-200">When you're logged on, hello "successfully created" page appears in hello browser.</span></span>

## <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="b1784-201">Nakonfigurujte tooacquire projekt ToDoListAPI hello a odeslání tokenu Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="b1784-201">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="b1784-202">V této části hello následující úlohy:</span><span class="sxs-lookup"><span data-stu-id="b1784-202">In this section you do hello following tasks:</span></span>

* <span data-ttu-id="b1784-203">Přidejte kód v aplikaci API střední vrstvy hello, která používá Azure AD application pověření tooacquire token a odeslat ho s protokolem HTTP požadavky aplikaci API datové vrstvy toohello.</span><span class="sxs-lookup"><span data-stu-id="b1784-203">Add code in hello middle tier API app that uses Azure AD application credentials tooacquire a token and send it with HTTP requests toohello data tier API app.</span></span>
* <span data-ttu-id="b1784-204">Hello přihlašovací údaje, které potřebujete získáte z Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-204">Get hello credentials you need from Azure AD.</span></span>
* <span data-ttu-id="b1784-205">Zadejte přihlašovací údaje hello do nastavení prostředí runtime Azure App Service v aplikaci API střední vrstvy hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-205">Enter hello credentials into Azure App Service runtime environment settings in hello middle tier API app.</span></span> 

### <a name="configure-hello-todolistapi-project-tooacquire-and-send-hello-azure-ad-token"></a><span data-ttu-id="b1784-206">Nakonfigurujte tooacquire projekt ToDoListAPI hello a odeslání tokenu Azure AD hello</span><span class="sxs-lookup"><span data-stu-id="b1784-206">Configure hello ToDoListAPI project tooacquire and send hello Azure AD token</span></span>
<span data-ttu-id="b1784-207">Proveďte následující změny v projektu ToDoListAPI hello v sadě Visual Studio hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-207">Make hello following changes in hello ToDoListAPI project in Visual Studio.</span></span>

1. <span data-ttu-id="b1784-208">Zrušením komentáře u všech hello kódu hello *ServicePrincipal.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="b1784-208">Uncomment all of hello code in hello *ServicePrincipal.cs* file.</span></span>
   
    <span data-ttu-id="b1784-209">Toto je hello kód, který využívá ADAL pro .NET tooacquire hello Azure AD nosný token.</span><span class="sxs-lookup"><span data-stu-id="b1784-209">This is hello code that uses ADAL for .NET tooacquire hello Azure AD bearer token.</span></span>  <span data-ttu-id="b1784-210">Používá několik hodnoty konfigurace, které budete nastaveny v prostředí Azure runtime hello později.</span><span class="sxs-lookup"><span data-stu-id="b1784-210">It uses several configuration values that you'll set in hello Azure runtime environment later.</span></span> <span data-ttu-id="b1784-211">Tady je kód hello:</span><span class="sxs-lookup"><span data-stu-id="b1784-211">Here's hello code:</span></span> 
   
        public static class ServicePrincipal
        {
            static string authority = ConfigurationManager.AppSettings["ida:Authority"];
            static string clientId = ConfigurationManager.AppSettings["ida:ClientId"];
            static string clientSecret = ConfigurationManager.AppSettings["ida:ClientSecret"];
            static string resource = ConfigurationManager.AppSettings["ida:Resource"];
   
            public static AuthenticationResult GetS2SAccessTokenForProdMSA()
            {
                return GetS2SAccessToken(authority, resource, clientId, clientSecret);
            }
   
            static AuthenticationResult GetS2SAccessToken(string authority, string resource, string clientId, string clientSecret)
            {
                var clientCredential = new ClientCredential(clientId, clientSecret);
                AuthenticationContext context = new AuthenticationContext(authority, false);
                AuthenticationResult authenticationResult = context.AcquireToken(
                    resource,
                    clientCredential);
                return authenticationResult;
            }
        }
   
    <span data-ttu-id="b1784-212">**Poznámka:** tento kód vyžaduje hello ADAL pro balíček NuGet pro rozhraní .NET (Microsoft.IdentityModel.Clients.ActiveDirectory), který je již nainstalován v projektu hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-212">**Note:** This code requires hello ADAL for .NET NuGet package (Microsoft.IdentityModel.Clients.ActiveDirectory), which is already installed in hello project.</span></span> <span data-ttu-id="b1784-213">Pokud tento projekt bylo vytváření od začátku, by měl tooinstall tento balíček.</span><span class="sxs-lookup"><span data-stu-id="b1784-213">If you were creating this project from scratch, you would have tooinstall this package.</span></span> <span data-ttu-id="b1784-214">Tento balíček není automaticky instalován šablonou nový projekt aplikace API hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-214">This package is not automatically installed by hello API app new-project template.</span></span>
2. <span data-ttu-id="b1784-215">V *řadiče nebo ToDoListController*, zrušte komentář u hello kód v hello `NewDataAPIClient` metoda, která přidává hello tokenu tooHTTP požadavky v hlavičce autorizace hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-215">In *Controllers/ToDoListController*, uncomment hello code in hello `NewDataAPIClient` method that adds hello token tooHTTP requests in hello authorization header.</span></span>
   
        client.HttpClient.DefaultRequestHeaders.Authorization =
            new AuthenticationHeaderValue("Bearer", ServicePrincipal.GetS2SAccessTokenForProdMSA().AccessToken);
3. <span data-ttu-id="b1784-216">Nasazení projektu ToDoListAPI hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-216">Deploy hello ToDoListAPI project.</span></span> <span data-ttu-id="b1784-217">(Klikněte pravým tlačítkem na projekt hello a pak klikněte na **publikovat > Publikovat**.)</span><span class="sxs-lookup"><span data-stu-id="b1784-217">(Right-click hello project, then click **Publish > Publish**.)</span></span>
   
    <span data-ttu-id="b1784-218">Visual Studio nasadí projekt hello a otevře základní adresu URL prohlížeče toohello webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="b1784-218">Visual Studio deploys hello project and opens a browser toohello web app's base URL.</span></span> <span data-ttu-id="b1784-219">Zobrazí 403 chybovou stránku, což je normální pokus o toogo tooa webového rozhraní API základní adresy URL v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="b1784-219">This will show a 403 error page, which is normal for an attempt toogo tooa Web API base URL from a browser.</span></span>
4. <span data-ttu-id="b1784-220">Prohlížeč zavřít hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-220">Close hello browser.</span></span>

### <a name="get-azure-ad-configuration-values"></a><span data-ttu-id="b1784-221">Získat hodnoty konfigurace Azure AD</span><span class="sxs-lookup"><span data-stu-id="b1784-221">Get Azure AD configuration values</span></span>
1. <span data-ttu-id="b1784-222">V hello [portál Azure classic](https://manage.windowsazure.com/), přejděte příliš**Azure Active Directory**.</span><span class="sxs-lookup"><span data-stu-id="b1784-222">In hello [Azure classic portal](https://manage.windowsazure.com/), go too**Azure Active Directory**.</span></span>
2. <span data-ttu-id="b1784-223">Na hello **Directory** , klikněte na vašem tenantovi AAD.</span><span class="sxs-lookup"><span data-stu-id="b1784-223">On hello **Directory** tab, click your AAD tenant.</span></span>
3. <span data-ttu-id="b1784-224">Klikněte na tlačítko **aplikace > Moje společnost vlastní aplikace**a pak klikněte na tlačítko zaškrtnutí hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-224">Click **Applications > Applications my company owns**, and then click hello check mark.</span></span>
4. <span data-ttu-id="b1784-225">V hello seznam aplikací klikněte na název hello hello ten, který Azure vytvořené pro vás při povolení ověřování pro aplikaci API (datové vrstvy) ToDoListDataAPI hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-225">In hello list of applications, click hello name of hello one that Azure created for you when you enabled authentication for hello ToDoListDataAPI (data tier) API app.</span></span>
5. <span data-ttu-id="b1784-226">Klikněte na tlačítko hello **konfigurace** kartě.</span><span class="sxs-lookup"><span data-stu-id="b1784-226">Click hello **Configure** tab.</span></span>
6. <span data-ttu-id="b1784-227">Kopírování hello **ID klienta** hodnotu a uložte ho někde můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b1784-227">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span> 
7. <span data-ttu-id="b1784-228">V hello portál Azure classic přejděte zpět toohello seznam **aplikace Moje společnost vlastní**a klikněte na tlačítko hello AAD aplikace, kterou jste vytvořili pro aplikaci ToDoListAPI API střední vrstvy hello (hello není vytvořené v předchozí kurzu hello Hello, jednu, kterou jste vytvořili v tomto kurzu).</span><span class="sxs-lookup"><span data-stu-id="b1784-228">In hello Azure classic portal go back toohello list of **Applications my company owns**, and click hello AAD application that you created for hello middle tier ToDoListAPI API app (hello one you created in hello previous tutorial, not hello one you created in this tutorial).</span></span>
8. <span data-ttu-id="b1784-229">Klikněte na tlačítko hello **konfigurace** kartě.</span><span class="sxs-lookup"><span data-stu-id="b1784-229">Click hello **Configure** tab.</span></span>
9. <span data-ttu-id="b1784-230">Kopírování hello **ID klienta** hodnotu a uložte ho někde můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b1784-230">Copy hello **Client ID** value and save it someplace you can get it from later.</span></span>
10. <span data-ttu-id="b1784-231">V části **klíče**, vyberte **1 rok** z hello **vyberte dobu trvání** rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="b1784-231">Under **keys**, select **1 year** from hello **Select duration** drop-down list.</span></span>
11. <span data-ttu-id="b1784-232">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-232">Click **Save**.</span></span>
    
     ![Vygenerování klíče aplikace](./media/app-service-api-dotnet-service-principal-auth/genkey.png)
12. <span data-ttu-id="b1784-234">Zkopírujte hodnotu klíče hello a uložte někde, které můžete získat z později.</span><span class="sxs-lookup"><span data-stu-id="b1784-234">Copy hello key value and save it someplace you can get it from later.</span></span>
    
     ![Zkopírujte nový klíč aplikace](./media/app-service-api-dotnet-service-principal-auth/genkeycopy.png)

### <a name="configure-azure-ad-settings-in-hello-middle-tier-api-apps-runtime-environment"></a><span data-ttu-id="b1784-236">Konfigurace nastavení služby Azure AD v aplikaci API střední vrstvy hello běhového prostředí</span><span class="sxs-lookup"><span data-stu-id="b1784-236">Configure Azure AD settings in hello middle tier API app's runtime environment</span></span>
1. <span data-ttu-id="b1784-237">Přejděte toohello [portál Azure](https://portal.azure.com/)a potom přejděte toohello **aplikace API** aplikace hello rozhraní API, který je hostitelem hello projekt TodoListAPI (střední úroveň).</span><span class="sxs-lookup"><span data-stu-id="b1784-237">Go toohello [Azure portal](https://portal.azure.com/), and then navigate toohello **API App** blade for hello API app that hosts hello TodoListAPI (middle tier) project.</span></span>
2. <span data-ttu-id="b1784-238">Klikněte na **Nastavení > Nastavení aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b1784-238">Click **Settings > Application Settings**.</span></span>
3. <span data-ttu-id="b1784-239">V hello **nastavení aplikace** přidejte hello následující klíče a hodnoty:</span><span class="sxs-lookup"><span data-stu-id="b1784-239">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="b1784-240">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-240">**Key**</span></span> | <span data-ttu-id="b1784-241">IDA: autority</span><span class="sxs-lookup"><span data-stu-id="b1784-241">ida:Authority</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-242">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-242">**Value**</span></span> |<span data-ttu-id="b1784-243">https://Login.microsoftonline.com/ {název klienta Azure AD}</span><span class="sxs-lookup"><span data-stu-id="b1784-243">https://login.microsoftonline.com/{your Azure AD tenant name}</span></span> |
   | <span data-ttu-id="b1784-244">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-244">**Example**</span></span> |<span data-ttu-id="b1784-245">https://Login.microsoftonline.com/contoso.onmicrosoft.com</span><span class="sxs-lookup"><span data-stu-id="b1784-245">https://login.microsoftonline.com/contoso.onmicrosoft.com</span></span> |
   
   | <span data-ttu-id="b1784-246">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-246">**Key**</span></span> | <span data-ttu-id="b1784-247">IDA: ClientId</span><span class="sxs-lookup"><span data-stu-id="b1784-247">ida:ClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-248">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-248">**Value**</span></span> |<span data-ttu-id="b1784-249">ID klienta hello volání aplikace (střední úroveň - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b1784-249">Client ID of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b1784-250">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-250">**Example**</span></span> |<span data-ttu-id="b1784-251">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="b1784-251">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
   
   | <span data-ttu-id="b1784-252">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-252">**Key**</span></span> | <span data-ttu-id="b1784-253">IDA: ClientSecret</span><span class="sxs-lookup"><span data-stu-id="b1784-253">ida:ClientSecret</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-254">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-254">**Value**</span></span> |<span data-ttu-id="b1784-255">Klíč aplikace hello volání aplikace (střední úroveň - ToDoListAPI)</span><span class="sxs-lookup"><span data-stu-id="b1784-255">App key of hello calling application (middle tier - ToDoListAPI)</span></span> |
   | <span data-ttu-id="b1784-256">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-256">**Example**</span></span> |<span data-ttu-id="b1784-257">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="b1784-257">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
   | <span data-ttu-id="b1784-258">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-258">**Key**</span></span> | <span data-ttu-id="b1784-259">IDA: prostředků</span><span class="sxs-lookup"><span data-stu-id="b1784-259">ida:Resource</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-260">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-260">**Value**</span></span> |<span data-ttu-id="b1784-261">ID klienta hello se nazývá aplikace (datovou vrstvu - ToDoListDataAPI)</span><span class="sxs-lookup"><span data-stu-id="b1784-261">Client ID of hello called application (data tier - ToDoListDataAPI)</span></span> |
   | <span data-ttu-id="b1784-262">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-262">**Example**</span></span> |<span data-ttu-id="b1784-263">e65e8fc9-5f6b-48E8-e65e8fc9-5f6b-48E8</span><span class="sxs-lookup"><span data-stu-id="b1784-263">e65e8fc9-5f6b-48e8-e65e8fc9-5f6b-48e8</span></span> |
   
    <span data-ttu-id="b1784-264">**Poznámka:**: pro `ida:Resource`, nezapomeňte použít hello názvem aplikace **ID klienta** a ne její **identifikátor ID URI aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b1784-264">**Note**: For `ida:Resource`, make sure you use hello called application's **client ID** and not its **App ID URI**.</span></span>
   
    <span data-ttu-id="b1784-265">`ida:ClientId`a `ida:Resource` jsou různé hodnoty pro tento kurz vzhledem k tomu, že používáte samostatné applicaations Azure AD pro hello střední vrstvy a datové vrstvy.</span><span class="sxs-lookup"><span data-stu-id="b1784-265">`ida:ClientId` and `ida:Resource` are different values for this tutorial because you're using separate Azure AD applicaations for hello middle tier and data tier.</span></span> <span data-ttu-id="b1784-266">Pokud jste používali jedné aplikaci Azure AD pro volání rozhraní API app a hello hello chráněné aplikace API, využije hello stejnou hodnotu v obou `ida:ClientId` a `ida:Resource`.</span><span class="sxs-lookup"><span data-stu-id="b1784-266">If you were using a single Azure AD application for hello calling API app and hello protected API app, you would use hello same value in both `ida:ClientId` and `ida:Resource`.</span></span>
   
    <span data-ttu-id="b1784-267">Kód Hello používá ConfigurationManager tooget tak může být uložený v souboru Web.config hello projektu nebo v prostředí Azure runtime hello tyto hodnoty.</span><span class="sxs-lookup"><span data-stu-id="b1784-267">hello code uses ConfigurationManager tooget these values, so they could be stored in hello project's Web.config file or in hello Azure runtime environment.</span></span> <span data-ttu-id="b1784-268">Při spuštěné aplikaci ASP.NET ve službě Azure App Service přepsat nastavení prostředí automaticky nastavení ze souboru Web.config. Nastavení prostředí jsou obecně [bezpečnější způsob toostore citlivé informace porovnání souboru Web.config tooa](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span><span class="sxs-lookup"><span data-stu-id="b1784-268">While an ASP.NET application is running in Azure App Service, environment settings automatically override settings from Web.config. Environment settings are generally a [more secure way toostore sensitive information compared tooa Web.config file](http://www.asp.net/identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure).</span></span>
4. <span data-ttu-id="b1784-269">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-269">Click **Save**.</span></span>
   
    ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/appsettings.png)

### <a name="test-hello-application"></a><span data-ttu-id="b1784-271">Testování aplikace hello</span><span class="sxs-lookup"><span data-stu-id="b1784-271">Test hello application</span></span>
1. <span data-ttu-id="b1784-272">Přejděte v prohlížeči toohello adresy URL HTTPS hello AngularJS front-endu webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="b1784-272">In a browser go toohello HTTPS URL of hello AngularJS front end web app.</span></span>
2. <span data-ttu-id="b1784-273">Klikněte na tlačítko hello **tooDo seznamu** kartě a přihlaste se pomocí pověření pro uživatele v klientovi služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b1784-273">Click hello **tooDo List** tab and log in with credentials for a user in your Azure AD tenant.</span></span> 
3. <span data-ttu-id="b1784-274">Přidáte položky tooverify úkolů, které aplikace hello funguje.</span><span class="sxs-lookup"><span data-stu-id="b1784-274">Add to-do items tooverify that hello application is working.</span></span>
   
    ![Stránka seznamu tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)
   
    <span data-ttu-id="b1784-276">Pokud aplikace hello nebude fungovat podle očekávání, zkontrolujte všechny hello nastavení, které jste zadali do hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="b1784-276">If hello application doesn't work as expected, double-check all of hello settings you entered in hello Azure portal.</span></span> <span data-ttu-id="b1784-277">Pokud se zobrazí všechny hello nastavení toobe správný, najdete v části hello [Poradce při potížích s](#troubleshooting) později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="b1784-277">If all of hello settings appear toobe correct, see hello [Troubleshooting](#troubleshooting) section later in this tutorial.</span></span>

## <a name="protect-hello-api-app-from-browser-access"></a><span data-ttu-id="b1784-278">Hello aplikace API jsou chráněny před přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b1784-278">Protect hello API app from browser access</span></span>
<span data-ttu-id="b1784-279">V tomto kurzu jste vytvořili samostatné aplikaci Azure AD pro aplikaci hello ToDoListDataAPI (datové vrstvy) rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b1784-279">For this tutorial you created a separate Azure AD application for hello ToDoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b1784-280">Jak jsme viděli, a když služby App Service vytvoří aplikaci AAD nakonfiguruje hello AAD aplikace způsobem, který umožňuje na adresu URL uživatel toogo toohello aplikace API v prohlížeči a protokolu.</span><span class="sxs-lookup"><span data-stu-id="b1784-280">As you've seen, when App Service creates an AAD application, it configures hello AAD application in a way that enables a user toogo toohello API app's URL in a browser and log on.</span></span> <span data-ttu-id="b1784-281">To znamená, že je možné pro koncového uživatele v klientovi služby Azure AD, ne jenom instančního objektu, tooaccess hello rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b1784-281">That means it's possible for an end user in your Azure AD tenant, not just a service principal, tooaccess hello API.</span></span> 

<span data-ttu-id="b1784-282">Pokud chcete přístup z prohlížeče tooprevent bez psaní kódu v hello chráněné aplikace API, můžete změnit hello **adresa URL odpovědi** v hello AAD aplikace tak, aby se liší od aplikace hello rozhraní API základní adresu URL.</span><span class="sxs-lookup"><span data-stu-id="b1784-282">If you want tooprevent browser access without writing any code in hello protected API app, you can change hello **Reply URL** in hello AAD application so that it's different from hello API app's base URL.</span></span> 

### <a name="disable-browser-access"></a><span data-ttu-id="b1784-283">Zakázat přístup z prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b1784-283">Disable browser access</span></span>
1. <span data-ttu-id="b1784-284">V hello portálu classic **konfigurace** kartě hello AAD aplikace, která byla vytvořena pro hello TodoListService, změňte hodnotu hello v hello **adresa URL odpovědi** pole tak, aby se platná adresa URL, ale není hello rozhraní API aplikace ADRESA URL.</span><span class="sxs-lookup"><span data-stu-id="b1784-284">In hello classic portal's **Configure** tab for hello AAD application that was created for hello TodoListService, change hello value in hello **Reply URL** field so that it is a valid URL but not hello API app's URL.</span></span>
2. <span data-ttu-id="b1784-285">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-285">Click **Save**.</span></span>

### <a name="verify-browser-access-no-longer-works"></a><span data-ttu-id="b1784-286">Ověřte, že přístup z prohlížeče přestane fungovat.</span><span class="sxs-lookup"><span data-stu-id="b1784-286">Verify browser access no longer works</span></span>
<span data-ttu-id="b1784-287">Dříve jste ověřili, že můžete přejít toohello adresu URL aplikace API z prohlížeče pomocí přihlášení s přihlašovacími údaji pro jednotlivé uživatele.</span><span class="sxs-lookup"><span data-stu-id="b1784-287">Earlier you verified that you can go toohello API app URL from a browser by logging on with an individual user's credentials.</span></span> <span data-ttu-id="b1784-288">V této části ověřte, že to není možné.</span><span class="sxs-lookup"><span data-stu-id="b1784-288">In this section, you verify that this is no longer possible.</span></span> 

1. <span data-ttu-id="b1784-289">V nové okno prohlížeče přejděte znovu toohello adresu URL aplikace API hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-289">In a new browser window, go toohello URL of hello API app again.</span></span>
2. <span data-ttu-id="b1784-290">Při přihlášení zobrazí výzva toodo tak.</span><span class="sxs-lookup"><span data-stu-id="b1784-290">Log in when prompted toodo so.</span></span>
3. <span data-ttu-id="b1784-291">Přihlášení úspěšné, ale vede tooan chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="b1784-291">Login succeeds but leads tooan error page.</span></span>
   
    <span data-ttu-id="b1784-292">AAD aplikace hello jste nakonfigurovali tak, aby uživatelé v tenantovi AAD hello nemůže přihlásit a přístup k rozhraní API hello z prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b1784-292">You've configured hello AAD app so that users in hello AAD tenant cannot log in and access hello API from a browser.</span></span> <span data-ttu-id="b1784-293">Můžete pořád přístup k aplikaci API hello pomocí tokenu hlavní služby, které můžete ověřit, přejdete na adresu URL toohello webové aplikace a přidáním další položkami seznamu úkolů.</span><span class="sxs-lookup"><span data-stu-id="b1784-293">You can still access hello API app by using a service principal token, which you can verify by going toohello web app's URL and adding more to-do items.</span></span>

## <a name="restrict-access-tooa-particular-service-principal"></a><span data-ttu-id="b1784-294">Omezit přístup tooa konkrétní instančního objektu</span><span class="sxs-lookup"><span data-stu-id="b1784-294">Restrict access tooa particular service principal</span></span>
<span data-ttu-id="b1784-295">Teď, všechny volající, který můžete získat token pro uživatele nebo instančního objektu v klientovi služby Azure AD můžete volat aplikace hello TodoListDataAPI (datové vrstvy) rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="b1784-295">Right now, any caller that can get a token for a user or service principal in your Azure AD tenant can call hello TodoListDataAPI (data tier) API app.</span></span> <span data-ttu-id="b1784-296">Můžete chtít toomake se, že tuto aplikaci API hello datové vrstvy přijímá pouze volání z aplikace API TodoListAPI (střední vrstvy) hello a pouze z konkrétní instanční objekt.</span><span class="sxs-lookup"><span data-stu-id="b1784-296">You might want toomake sure that hello data tier API app only accepts calls from hello TodoListAPI (middle tier) API app, and only from a particular service principal.</span></span> 

<span data-ttu-id="b1784-297">Tato omezení můžete přidat tak, že přidáte kód toovalidate hello `appid` a `objectidentifier` deklarace identity na příchozí volání.</span><span class="sxs-lookup"><span data-stu-id="b1784-297">You can add these restrictions by adding code toovalidate hello `appid` and `objectidentifier` claims on incoming calls.</span></span>

<span data-ttu-id="b1784-298">Pro účely tohoto kurzu umístíte hello kód, který ověří ID aplikace a ID objektu zabezpečení služby přímo v vaše akce kontroleru.</span><span class="sxs-lookup"><span data-stu-id="b1784-298">For this tutorial you put hello code that validates app ID and service principal ID directly in your controller actions.</span></span>  <span data-ttu-id="b1784-299">Alternativy jsou toouse vlastní `Authorize` atribut nebo toodo toto ověření v pořadí spuštění (např. middleware OWIN).</span><span class="sxs-lookup"><span data-stu-id="b1784-299">Alternatives are toouse a custom `Authorize` attribute or toodo this validation in your startup sequences (e.g. OWIN middleware).</span></span> <span data-ttu-id="b1784-300">Příklad hello druhé, naleznete v části [této ukázkové aplikaci](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span><span class="sxs-lookup"><span data-stu-id="b1784-300">For an example of hello latter, see [this sample application](https://github.com/mohitsriv/EasyAuthMultiTierSample/blob/master/MyDashDataAPI/Startup.cs).</span></span> 

<span data-ttu-id="b1784-301">Proveďte následující změny projekt TodoListDataAPI toohello hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-301">Make hello following changes toohello TodoListDataAPI project.</span></span>

1. <span data-ttu-id="b1784-302">Otevřete hello *Controllers/TodoListController.cs* souboru.</span><span class="sxs-lookup"><span data-stu-id="b1784-302">Open hello *Controllers/TodoListController.cs* file.</span></span>
2. <span data-ttu-id="b1784-303">Zrušením komentáře u hello řádku, které nastavit `trustedCallerClientId` a `trustedCallerServicePrincipalId`.</span><span class="sxs-lookup"><span data-stu-id="b1784-303">Uncomment hello lines that set `trustedCallerClientId` and `trustedCallerServicePrincipalId`.</span></span>
   
        private static string trustedCallerClientId = ConfigurationManager.AppSettings["todo:TrustedCallerClientId"];
        private static string trustedCallerServicePrincipalId = ConfigurationManager.AppSettings["todo:TrustedCallerServicePrincipalId"];
3. <span data-ttu-id="b1784-304">Zrušením komentáře u hello kód v hello CheckCallerId metoda.</span><span class="sxs-lookup"><span data-stu-id="b1784-304">Uncomment hello code in hello CheckCallerId method.</span></span> <span data-ttu-id="b1784-305">Tato metoda je volána při spuštění hello každou metodu akce v kontroleru hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-305">This method is called at hello start of every action method in hello controller.</span></span> 
   
        private static void CheckCallerId()
        {
            string currentCallerClientId = ClaimsPrincipal.Current.FindFirst("appid").Value;
            string currentCallerServicePrincipalId = ClaimsPrincipal.Current.FindFirst("http://schemas.microsoft.com/identity/claims/objectidentifier").Value;
            if (currentCallerClientId != trustedCallerClientId || currentCallerServicePrincipalId != trustedCallerServicePrincipalId)
            {
                throw new HttpResponseException(new HttpResponseMessage { StatusCode = HttpStatusCode.Unauthorized, ReasonPhrase = "hello appID or service principal ID is not hello expected value." });
            }
        }
4. <span data-ttu-id="b1784-306">Znovu nasaďte tooAzure projekt ToDoListDataAPI hello služby App Service.</span><span class="sxs-lookup"><span data-stu-id="b1784-306">Redeploy hello ToDoListDataAPI project tooAzure App Service.</span></span>
5. <span data-ttu-id="b1784-307">Přejděte v prohlížeči adresu URL HTTPS toohello AngularJS front-endu webové aplikace a hello domovské stránce klikněte na tlačítko hello **tooDo seznamu** kartě.</span><span class="sxs-lookup"><span data-stu-id="b1784-307">In your browser, go toohello AngularJS front end web app's HTTPS URL, and in hello home page click hello **tooDo List** tab.</span></span>
   
    <span data-ttu-id="b1784-308">aplikace Hello nefunguje, protože selhávají volání ukončení toohello zpět.</span><span class="sxs-lookup"><span data-stu-id="b1784-308">hello application doesn't work because calls toohello back end are failing.</span></span> <span data-ttu-id="b1784-309">nový kód Hello kontroluje skutečné appid a které, ale ještě nemá správné hodnoty toocheck hello je proti.</span><span class="sxs-lookup"><span data-stu-id="b1784-309">hello new code is checking actual appid and objectidentifier but it doesn't yet have hello correct values toocheck them against.</span></span> <span data-ttu-id="b1784-310">Prohlížeč Hello konzoly vývojářských nástrojů hlásí, že tento server hello je vrátila chybu HTTP 401.</span><span class="sxs-lookup"><span data-stu-id="b1784-310">hello browser Developer Tools Console reports that hello server is returning an HTTP 401 error.</span></span>
   
    ![Došlo k chybě v vývojáře nástrojů konzoly](./media/app-service-api-dotnet-service-principal-auth/webapperror.png)
   
    <span data-ttu-id="b1784-312">V hello následujících kroků můžete nakonfigurovat hello očekávaných hodnot.</span><span class="sxs-lookup"><span data-stu-id="b1784-312">In hello following steps you configure hello expected values.</span></span>
6. <span data-ttu-id="b1784-313">Pomocí Azure AD PowerShell, získáte hello hodnotu služby hello hlavní hello aplikaci Azure AD, kterou jste vytvořili pro projekt TodoListWebApp hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-313">Using Azure AD PowerShell, get hello value of hello service principal for hello Azure AD application that you created for hello TodoListWebApp project.</span></span>
   
    <span data-ttu-id="b1784-314">a.</span><span class="sxs-lookup"><span data-stu-id="b1784-314">a.</span></span> <span data-ttu-id="b1784-315">Návod, jak tooinstall prostředí Azure PowerShell a připojení tooyour odběru naleznete v tématu [použití Azure Powershellu s Azure Resource Manager](../powershell-azure-resource-manager.md).</span><span class="sxs-lookup"><span data-stu-id="b1784-315">For instructions on how tooinstall Azure PowerShell and connect tooyour subscription, see [Using Azure PowerShell with Azure Resource Manager](../powershell-azure-resource-manager.md).</span></span>
   
    <span data-ttu-id="b1784-316">b.</span><span class="sxs-lookup"><span data-stu-id="b1784-316">b.</span></span> <span data-ttu-id="b1784-317">tooget seznam objekty služby, provést hello `Login-AzureRmAccount` příkaz a potom hello `Get-AzureRmADServicePrincipal` příkaz.</span><span class="sxs-lookup"><span data-stu-id="b1784-317">tooget a list of service principals, execute hello `Login-AzureRmAccount` command and then hello `Get-AzureRmADServicePrincipal` command.</span></span>
   
    <span data-ttu-id="b1784-318">c.</span><span class="sxs-lookup"><span data-stu-id="b1784-318">c.</span></span> <span data-ttu-id="b1784-319">Najít hello objectid pro hello instanční objekt hello TodoListAPI aplikace a uložit ho do umístění, které můžete zkopírovat z později.</span><span class="sxs-lookup"><span data-stu-id="b1784-319">Find hello objectid for hello service principal of hello TodoListAPI application, and save it in a location you can copy from later.</span></span>
7. <span data-ttu-id="b1784-320">V hello portálu Azure přejděte toohello okně aplikace API pro aplikaci API hello, který jste nasadili projekt ToDoListDataAPI hello.</span><span class="sxs-lookup"><span data-stu-id="b1784-320">In hello Azure portal, navigate toohello API app blade for hello API app that you deployed hello ToDoListDataAPI project to.</span></span>
8. <span data-ttu-id="b1784-321">Klikněte na tlačítko **Nastavení > Nastavení aplikace**.</span><span class="sxs-lookup"><span data-stu-id="b1784-321">Click **Settings > Application settings**.</span></span>
9. <span data-ttu-id="b1784-322">V hello **nastavení aplikace** přidejte hello následující klíče a hodnoty:</span><span class="sxs-lookup"><span data-stu-id="b1784-322">In hello **App settings** section, add hello following keys and values:</span></span>
   
   | <span data-ttu-id="b1784-323">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-323">**Key**</span></span> | <span data-ttu-id="b1784-324">TODO:TrustedCallerServicePrincipalId</span><span class="sxs-lookup"><span data-stu-id="b1784-324">todo:TrustedCallerServicePrincipalId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-325">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-325">**Value**</span></span> |<span data-ttu-id="b1784-326">Id objektu zabezpečení služby volání aplikace</span><span class="sxs-lookup"><span data-stu-id="b1784-326">Service principal id of calling application</span></span> |
   | <span data-ttu-id="b1784-327">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-327">**Example**</span></span> |<span data-ttu-id="b1784-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span><span class="sxs-lookup"><span data-stu-id="b1784-328">4f4a94a4-6f0d-4072-4f4a94a4-6f0d-4072</span></span> |
   
   | <span data-ttu-id="b1784-329">**Klíč**</span><span class="sxs-lookup"><span data-stu-id="b1784-329">**Key**</span></span> | <span data-ttu-id="b1784-330">TODO:TrustedCallerClientId</span><span class="sxs-lookup"><span data-stu-id="b1784-330">todo:TrustedCallerClientId</span></span> |
   | --- | --- |
   | <span data-ttu-id="b1784-331">**Hodnota**</span><span class="sxs-lookup"><span data-stu-id="b1784-331">**Value**</span></span> |<span data-ttu-id="b1784-332">ID klienta volání aplikace – zkopírovat z aplikace hello TodoListAPI Azure AD</span><span class="sxs-lookup"><span data-stu-id="b1784-332">Client ID of calling application - copied from hello TodoListAPI Azure AD application</span></span> |
   | <span data-ttu-id="b1784-333">**Příklad**</span><span class="sxs-lookup"><span data-stu-id="b1784-333">**Example**</span></span> |<span data-ttu-id="b1784-334">960adec2-b74a-484A-960adec2-b74a-484A</span><span class="sxs-lookup"><span data-stu-id="b1784-334">960adec2-b74a-484a-960adec2-b74a-484a</span></span> |
10. <span data-ttu-id="b1784-335">Klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="b1784-335">Click **Save**.</span></span>
    
     ![Kliknutí na Uložit](./media/app-service-api-dotnet-service-principal-auth/trustedcaller.png)
11. <span data-ttu-id="b1784-337">V prohlížeči návratovou adresu URL toohello webové aplikace a hello domovské stránce klikněte na tlačítko hello **tooDo seznamu** kartě.</span><span class="sxs-lookup"><span data-stu-id="b1784-337">In your browser, return toohello web app's URL, and in hello home page click hello **tooDo List** tab.</span></span>
    
     <span data-ttu-id="b1784-338">Tato aplikace hello čas funguje podle očekávání, protože hello důvěryhodné volající aplikace ID a ID objektu zabezpečení služby jsou hello očekávaných hodnot.</span><span class="sxs-lookup"><span data-stu-id="b1784-338">This time hello application works as expected because hello trusted caller app ID and service principal ID are hello expected values.</span></span>
    
     ![Stránka seznamu tooDo](./media/app-service-api-dotnet-service-principal-auth/mvchome.png)

## <a name="building-hello-projects-from-scratch"></a><span data-ttu-id="b1784-340">Sestavení projektů hello od začátku</span><span class="sxs-lookup"><span data-stu-id="b1784-340">Building hello projects from scratch</span></span>
<span data-ttu-id="b1784-341">Hello dva projekty webového rozhraní API, které byly vytvořeny pomocí hello **aplikace API Azure** šablony a nahraďte hello výchozí hodnoty řadiče s řadičem seznamu úkolů projektu.</span><span class="sxs-lookup"><span data-stu-id="b1784-341">hello two Web API projects were created by using hello **Azure API App** project template and replacing hello default Values controller with a ToDoList controller.</span></span> <span data-ttu-id="b1784-342">Pro získání hlavní tokeny služby Azure AD v projektu ToDoListAPI hello, hello [Active Directory Authentication Library (ADAL) pro rozhraní .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) byl nainstalován balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="b1784-342">For acquiring Azure AD service principal tokens in hello ToDoListAPI project, hello [Active Directory Authentication Library (ADAL) for .NET](https://www.nuget.org/packages/Microsoft.IdentityModel.Clients.ActiveDirectory/) NuGet package was installed.</span></span>

<span data-ttu-id="b1784-343">Informace o tom, příliš vytvořit jednostránková aplikace AngularJS pomocí webového rozhraní API back-end, jako je ToDoListAngular, naleznete v tématu [rukou na testovacím: sestavení jedné stránce aplikace (SPA) pomocí rozhraní ASP.NET Web API a Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span><span class="sxs-lookup"><span data-stu-id="b1784-343">For information about how too create an AngularJS single-page application with a Web API back end like ToDoListAngular, see  [Hands On Lab: Build a Single Page Application (SPA) with ASP.NET Web API and Angular.js](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api/build-a-single-page-application-spa-with-aspnet-web-api-and-angularjs).</span></span> <span data-ttu-id="b1784-344">Informace o tooadd ověřovacího kódu Azure AD, najdete v části [zabezpečení AngularJS jedné stránky aplikací s Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span><span class="sxs-lookup"><span data-stu-id="b1784-344">For information about how tooadd Azure AD authentication code, see [Securing AngularJS Single Page Apps with Azure AD](../active-directory/active-directory-devquickstarts-angular.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b1784-345">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="b1784-345">Troubleshooting</span></span>
[!INCLUDE [troubleshooting](../../includes/app-service-api-auth-troubleshooting.md)]

* <span data-ttu-id="b1784-346">Ujistěte se, že jste Nepleťte ToDoListAPI (střední úroveň) a ToDoListDataAPI (datové vrstvy).</span><span class="sxs-lookup"><span data-stu-id="b1784-346">Make sure that you don't confuse ToDoListAPI (middle tier) and ToDoListDataAPI (data tier).</span></span> <span data-ttu-id="b1784-347">Například v tomto kurzu, můžete přidat aplikaci pro rozhraní API ověřování toohello datové vrstvy, **ale klíč aplikace hello musí pocházet ze hello aplikaci Azure AD, kterou jste vytvořili pro aplikaci API střední vrstvy hello**.</span><span class="sxs-lookup"><span data-stu-id="b1784-347">For example, in this tutorial you add authentication toohello data tier API app, **but hello app key must come from hello Azure AD application that you created for hello middle tier API app**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="b1784-348">Další kroky</span><span class="sxs-lookup"><span data-stu-id="b1784-348">Next steps</span></span>
<span data-ttu-id="b1784-349">Toto je poslední kurz hello v hello řady aplikace API.</span><span class="sxs-lookup"><span data-stu-id="b1784-349">This is hello last tutorial in hello API Apps series.</span></span> 

<span data-ttu-id="b1784-350">Další informace o službě Azure Active Directory najdete v tématu hello následující prostředky.</span><span class="sxs-lookup"><span data-stu-id="b1784-350">For more information about Azure Active Directory, see hello following resources.</span></span>

* [<span data-ttu-id="b1784-351">Průvodce Azure AD vývojářům</span><span class="sxs-lookup"><span data-stu-id="b1784-351">Azure AD developers' guide</span></span>](http://aka.ms/aaddev)
* [<span data-ttu-id="b1784-352">Scénáře služby Azure AD</span><span class="sxs-lookup"><span data-stu-id="b1784-352">Azure AD scenarios</span></span>](http://aka.ms/aadscenarios)
* [<span data-ttu-id="b1784-353">Ukázek Azure AD</span><span class="sxs-lookup"><span data-stu-id="b1784-353">Azure AD samples</span></span>](http://aka.ms/aadsamples)
  
    <span data-ttu-id="b1784-354">Hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) ukázka je podobné toowhat se zobrazí v tomto kurzu, ale bez použití ověřování služby App Service.</span><span class="sxs-lookup"><span data-stu-id="b1784-354">hello [WebApp-WebAPI-OAuth2-AppIdentity-DotNet](http://github.com/AzureADSamples/WebApp-WebAPI-OAuth2-AppIdentity-DotNet) sample is similar toowhat is shown in this tutorial, but without using App Service authentication.</span></span>

<span data-ttu-id="b1784-355">Informace o jiných způsobech toodeploy Visual Studio projekty tooAPI aplikace pomocí sady Visual Studio nebo [automatizace nasazení](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) z [systému správy zdrojů](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), najdete v části [jak toodeploy Aplikační služby Azure](../app-service-web/web-sites-deploy.md).</span><span class="sxs-lookup"><span data-stu-id="b1784-355">For information about other ways toodeploy Visual Studio projects tooAPI apps, by using Visual Studio or by [automating deployment](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) from a [source control system](http://www.asp.net/aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control), see [How toodeploy an Azure App Service app](../app-service-web/web-sites-deploy.md).</span></span>


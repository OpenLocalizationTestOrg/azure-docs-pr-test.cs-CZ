---
title: "Konfigurace virtuální sítě pro mezipaměť Azure Redis Cache Premium | Microsoft Docs"
description: "Naučte se vytvářet a spravovat podpory služby Virtual Network pro vaše instance služby Azure Redis Cache úrovně Premium"
services: redis-cache
documentationcenter: 
author: steved0x
manager: douge
editor: 
ms.assetid: 8b1e43a0-a70e-41e6-8994-0ac246d8bf7f
ms.service: cache
ms.workload: tbd
ms.tgt_pltfrm: cache-redis
ms.devlang: na
ms.topic: article
ms.date: 05/15/2017
ms.author: sdanie
ms.openlocfilehash: 59d46990e02c0719d2b4df01e216a97fd649c509
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="how-to-configure-virtual-network-support-for-a-premium-azure-redis-cache"></a><span data-ttu-id="2b289-103">Postup konfigurace podpory služby Virtual Network pro mezipaměť Azure Redis Cache Premium</span><span class="sxs-lookup"><span data-stu-id="2b289-103">How to configure Virtual Network Support for a Premium Azure Redis Cache</span></span>
<span data-ttu-id="2b289-104">Azure Redis Cache má jiný mezipaměti nabídky, které poskytují flexibilitu při výběru velikost mezipaměti a funkce, včetně funkce úrovně Premium, jako je clustering, trvalosti a podpory služby virtual network.</span><span class="sxs-lookup"><span data-stu-id="2b289-104">Azure Redis Cache has different cache offerings, which provide flexibility in the choice of cache size and features, including Premium tier features such as clustering, persistence, and virtual network support.</span></span> <span data-ttu-id="2b289-105">Virtuální síť je privátní síť v cloudu.</span><span class="sxs-lookup"><span data-stu-id="2b289-105">A VNet is a private network in the cloud.</span></span> <span data-ttu-id="2b289-106">Pokud instanci služby Azure Redis Cache je konfigurován s virtuální síť, není veřejně adresovatelné a můžete přistupovat pouze z virtuálních počítačů a aplikací v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="2b289-106">When an Azure Redis Cache instance is configured with a VNet, it is not publicly addressable and can only be accessed from virtual machines and applications within the VNet.</span></span> <span data-ttu-id="2b289-107">Tento článek popisuje postup konfigurace podpory služby virtual network pro instanci služby Azure Redis Cache premium.</span><span class="sxs-lookup"><span data-stu-id="2b289-107">This article describes how to configure virtual network support for a premium Azure Redis Cache instance.</span></span>

> [!NOTE]
> <span data-ttu-id="2b289-108">Azure Redis Cache podporuje obě classic a Resource Manager virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="2b289-108">Azure Redis Cache supports both classic and Resource Manager VNets.</span></span>
> 
> 

<span data-ttu-id="2b289-109">Informace o dalších funkcí mezipaměti premium najdete v tématu [Úvod do Azure Redis Cache Premium vrstvy](cache-premium-tier-intro.md).</span><span class="sxs-lookup"><span data-stu-id="2b289-109">For information on other premium cache features, see [Introduction to the Azure Redis Cache Premium tier](cache-premium-tier-intro.md).</span></span>

## <a name="why-vnet"></a><span data-ttu-id="2b289-110">Proč virtuální síť?</span><span class="sxs-lookup"><span data-stu-id="2b289-110">Why VNet?</span></span>
<span data-ttu-id="2b289-111">[Virtuální síť Azure (VNet)](https://azure.microsoft.com/services/virtual-network/) nasazení poskytuje lepší zabezpečení a izolaci pro vaši Azure Redis Cache, stejně jako podsítě, zásady řízení přístupu a další funkce k dalšímu omezení přístupu.</span><span class="sxs-lookup"><span data-stu-id="2b289-111">[Azure Virtual Network (VNet)](https://azure.microsoft.com/services/virtual-network/) deployment provides enhanced security and isolation for your Azure Redis Cache, as well as subnets, access control policies, and other features to further restrict access.</span></span>

## <a name="virtual-network-support"></a><span data-ttu-id="2b289-112">Podpora virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="2b289-112">Virtual network support</span></span>
<span data-ttu-id="2b289-113">Podpora služby Virtual Network (VNet) je nakonfigurovaná na **nová mezipaměť Redis** okno při vytvoření mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-113">Virtual Network (VNet) support is configured on the **New Redis Cache** blade during cache creation.</span></span> 

[!INCLUDE [redis-cache-create](../../includes/redis-cache-premium-create.md)]

<span data-ttu-id="2b289-114">Jakmile vyberete cenová úroveň premium, můžete nakonfigurovat integraci Redis virtuální sítě tak, že vyberete virtuální síť, která je ve stejném předplatném a umístění jako mezipaměť.</span><span class="sxs-lookup"><span data-stu-id="2b289-114">Once you have selected a premium pricing tier, you can configure Redis VNet integration by selecting a VNet that is in the same subscription and location as your cache.</span></span> <span data-ttu-id="2b289-115">Pokud chcete použít novou virtuální síť, je nejprve vytvořte podle kroků v [vytvoření virtuální sítě pomocí portálu Azure](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) nebo [vytvoření virtuální sítě (klasické) pomocí portálu Azure](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) a pak se vraťte **Nová mezipaměť Redis** okno vytvořit a nakonfigurovat mezipaměť premium.</span><span class="sxs-lookup"><span data-stu-id="2b289-115">To use a new VNet, create it first by following the steps in [Create a virtual network using the Azure portal](../virtual-network/virtual-networks-create-vnet-arm-pportal.md) or [Create a virtual network (classic) by using the Azure portal](../virtual-network/virtual-networks-create-vnet-classic-pportal.md) and then return to the **New Redis Cache** blade to create and configure your premium cache.</span></span>

<span data-ttu-id="2b289-116">Chcete-li nakonfigurovat virtuální síť pro nové mezipaměti, klikněte na tlačítko **virtuální sítě** na **nová mezipaměť Redis** a vyberte požadované virtuální sítě z rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="2b289-116">To configure the VNet for your new cache, click **Virtual Network** on the **New Redis Cache** blade, and select the desired VNet from the drop-down list.</span></span>

![Virtuální síť][redis-cache-vnet]

<span data-ttu-id="2b289-118">Vyberte požadovanou podsíť z **podsíť** rozevíracího seznamu a zadejte požadované **statická IP adresa**.</span><span class="sxs-lookup"><span data-stu-id="2b289-118">Select the desired subnet from the **Subnet** drop-down list, and specify the desired **Static IP address**.</span></span> <span data-ttu-id="2b289-119">Pokud používáte klasické virtuální sítě **statická IP adresa** pole je volitelné, a pokud není zadaný žádný, jedna je vybrána z vybrané podsítě.</span><span class="sxs-lookup"><span data-stu-id="2b289-119">If you are using a classic VNet the **Static IP address** field is optional, and if none is specified, one is chosen from the selected subnet.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="2b289-120">Při nasazení virtuální sítě Resource Manageru v Azure Redis Cache, mezipaměti musí být ve vyhrazené podsíť, která obsahuje žádné další prostředky s výjimkou instance služby Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-120">When deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resources except for Azure Redis Cache instances.</span></span> <span data-ttu-id="2b289-121">Pokud je proveden pokus o nasazení Azure Redis Cache do virtuální sítě Resource Manageru k podsíti obsahující další prostředky, nasazení se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="2b289-121">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet to a subnet that contains other resources, the deployment fails.</span></span>
> 
> 

![Virtuální síť][redis-cache-vnet-ip]

> [!IMPORTANT]
> <span data-ttu-id="2b289-123">Azure si vyhrazuje některé IP adresy v rámci každé podsítě a tyto adresy nelze použít.</span><span class="sxs-lookup"><span data-stu-id="2b289-123">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="2b289-124">První a poslední IP adresy podsítě jsou vyhrazené pro protokol shoda, společně s tři další adresy používané pro služby Azure.</span><span class="sxs-lookup"><span data-stu-id="2b289-124">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="2b289-125">Další informace najdete v tématu [existují nějaká omezení na pomocí IP adresy v rámci těchto podsítí?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="2b289-125">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>
> 
> <span data-ttu-id="2b289-126">Kromě IP adresy používané při infrastruktury virtuální sítě Azure každý Redis instance v podsíti používá dvě IP adresy na horizontální oddíl a jednu IP adresu další nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="2b289-126">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="2b289-127">Mezipaměť neclusterované považuje tak, aby měl jeden horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="2b289-127">A non-clustered cache is considered to have one shard.</span></span>
> 
> 

<span data-ttu-id="2b289-128">Po vytvoření mezipaměti konfiguraci sítě vnet můžete zobrazit kliknutím na **virtuální sítě** z **prostředků nabídky**.</span><span class="sxs-lookup"><span data-stu-id="2b289-128">After the cache is created, you can view the configuration for the VNet by clicking **Virtual Network** from the **Resource menu**.</span></span>

![Virtuální síť][redis-cache-vnet-info]

<span data-ttu-id="2b289-130">Připojit k vaší instanci služby Azure Redis cache pomocí virtuální sítě, zadejte název hostitele vašeho mezipaměti v připojovacím řetězci, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="2b289-130">To connect to your Azure Redis cache instance when using a VNet, specify the host name of your cache in the connection string as shown in the following example:</span></span>

    private static Lazy<ConnectionMultiplexer> lazyConnection = new Lazy<ConnectionMultiplexer>(() =>
    {
        return ConnectionMultiplexer.Connect("contoso5premium.redis.cache.windows.net,abortConnect=false,ssl=true,password=password");
    });

    public static ConnectionMultiplexer Connection
    {
        get
        {
            return lazyConnection.Value;
        }
    }

## <a name="azure-redis-cache-vnet-faq"></a><span data-ttu-id="2b289-131">VNet Azure Redis Cache – nejčastější dotazy</span><span class="sxs-lookup"><span data-stu-id="2b289-131">Azure Redis Cache VNet FAQ</span></span>
<span data-ttu-id="2b289-132">Následující seznam obsahuje odpovědi na nejčastější dotazy o škálování Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-132">The following list contains answers to commonly asked questions about the Azure Redis Cache scaling.</span></span>

* [<span data-ttu-id="2b289-133">Jaké jsou některé běžné chybné konfigurace problémy s Azure Redis Cache a virtuální sítě?</span><span class="sxs-lookup"><span data-stu-id="2b289-133">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>](#what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets)
* [<span data-ttu-id="2b289-134">Jak můžete ověřit, že moje mezipaměti funguje ve virtuální síti?</span><span class="sxs-lookup"><span data-stu-id="2b289-134">How can I verify that my cache is working in a VNET?</span></span>](#how-can-i-verify-that-my-cache-is-working-in-a-vnet)
* [<span data-ttu-id="2b289-135">Můžete použít virtuální sítě s standardní nebo základní mezipaměti?</span><span class="sxs-lookup"><span data-stu-id="2b289-135">Can I use VNets with a standard or basic cache?</span></span>](#can-i-use-vnets-with-a-standard-or-basic-cache)
* [<span data-ttu-id="2b289-136">Proč vytvoření mezipaměti Redis selhání v některé podsítě a jiné ne?</span><span class="sxs-lookup"><span data-stu-id="2b289-136">Why does creating a Redis cache fail in some subnets but not others?</span></span>](#why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others)
* [<span data-ttu-id="2b289-137">Jaké jsou požadavky na místo adres podsítě?</span><span class="sxs-lookup"><span data-stu-id="2b289-137">What are the subnet address space requirements?</span></span>](#what-are-the-subnet-address-space-requirements)
* [<span data-ttu-id="2b289-138">Fungují všechny funkce mezipaměti při hostování mezipaměti ve virtuální síti?</span><span class="sxs-lookup"><span data-stu-id="2b289-138">Do all cache features work when hosting a cache in a VNET?</span></span>](#do-all-cache-features-work-when-hosting-a-cache-in-a-vnet)

## <a name="what-are-some-common-misconfiguration-issues-with-azure-redis-cache-and-vnets"></a><span data-ttu-id="2b289-139">Jaké jsou některé běžné chybné konfigurace problémy s Azure Redis Cache a virtuální sítě?</span><span class="sxs-lookup"><span data-stu-id="2b289-139">What are some common misconfiguration issues with Azure Redis Cache and VNets?</span></span>
<span data-ttu-id="2b289-140">Pokud Azure Redis Cache je hostovaná ve virtuální síti, se použijí porty v následujících tabulkách.</span><span class="sxs-lookup"><span data-stu-id="2b289-140">When Azure Redis Cache is hosted in a VNet, the ports in the following tables are used.</span></span> 

>[!IMPORTANT]
><span data-ttu-id="2b289-141">Pokud porty v následujících tabulkách jsou zablokované, mezipaměti nemusí správně fungovat.</span><span class="sxs-lookup"><span data-stu-id="2b289-141">If the ports in the following tables are blocked, the cache may not function correctly.</span></span> <span data-ttu-id="2b289-142">Má minimálně jeden z těchto portů, zablokuje se Nejběžnější problém chybné konfigurace, při použití Azure Redis Cache ve virtuální síti.</span><span class="sxs-lookup"><span data-stu-id="2b289-142">Having one or more of these ports blocked is the most common misconfiguration issue when using Azure Redis Cache in a VNet.</span></span>
> 
> 

- [<span data-ttu-id="2b289-143">Požadavky na odchozí port</span><span class="sxs-lookup"><span data-stu-id="2b289-143">Outbound port requirements</span></span>](#outbound-port-requirements)
- [<span data-ttu-id="2b289-144">Požadavky na portu pro příchozí spojení</span><span class="sxs-lookup"><span data-stu-id="2b289-144">Inbound port requirements</span></span>](#inbound-port-requirements)

### <a name="outbound-port-requirements"></a><span data-ttu-id="2b289-145">Požadavky na odchozí port</span><span class="sxs-lookup"><span data-stu-id="2b289-145">Outbound port requirements</span></span>

<span data-ttu-id="2b289-146">Existuj sedm požadavků odchozí port.</span><span class="sxs-lookup"><span data-stu-id="2b289-146">There are seven outbound port requirements.</span></span>

- <span data-ttu-id="2b289-147">Pokud požadovaný, všechny odchozí připojení k Internetu může být provedeny prostřednictvím klienta místní auditování zařízení.</span><span class="sxs-lookup"><span data-stu-id="2b289-147">If desired, all outbound connections to the internet can be made through a client's on-premises auditing device.</span></span>
- <span data-ttu-id="2b289-148">Tři porty směrovat provoz koncové body Azure údržby Azure Storage a Azure DNS.</span><span class="sxs-lookup"><span data-stu-id="2b289-148">Three of the ports route traffic to Azure endpoints servicing Azure Storage and Azure DNS.</span></span>
- <span data-ttu-id="2b289-149">Zbývající rozsahy portů a pro interní komunikaci podsítě Redis.</span><span class="sxs-lookup"><span data-stu-id="2b289-149">The remaining port ranges and for internal Redis subnet communications.</span></span> <span data-ttu-id="2b289-150">Pravidla NSG žádné podsítě jsou požadovány pro interní komunikaci podsítě Redis.</span><span class="sxs-lookup"><span data-stu-id="2b289-150">No subnet NSG rules are required for internal Redis subnet communications.</span></span>

| <span data-ttu-id="2b289-151">Port(y) pro</span><span class="sxs-lookup"><span data-stu-id="2b289-151">Port(s)</span></span> | <span data-ttu-id="2b289-152">Směr</span><span class="sxs-lookup"><span data-stu-id="2b289-152">Direction</span></span> | <span data-ttu-id="2b289-153">Přenosový protokol</span><span class="sxs-lookup"><span data-stu-id="2b289-153">Transport Protocol</span></span> | <span data-ttu-id="2b289-154">Účel</span><span class="sxs-lookup"><span data-stu-id="2b289-154">Purpose</span></span> | <span data-ttu-id="2b289-155">Místní IP</span><span class="sxs-lookup"><span data-stu-id="2b289-155">Local IP</span></span> | <span data-ttu-id="2b289-156">Vzdálené IP</span><span class="sxs-lookup"><span data-stu-id="2b289-156">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2b289-157">80, 443</span><span class="sxs-lookup"><span data-stu-id="2b289-157">80, 443</span></span> |<span data-ttu-id="2b289-158">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-158">Outbound</span></span> |<span data-ttu-id="2b289-159">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-159">TCP</span></span> |<span data-ttu-id="2b289-160">Redis závislosti na Azure Storage nebo infrastruktury veřejných KLÍČŮ (Internet)</span><span class="sxs-lookup"><span data-stu-id="2b289-160">Redis dependencies on Azure Storage/PKI (Internet)</span></span> | <span data-ttu-id="2b289-161">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-161">(Redis subnet)</span></span> |* |
| <span data-ttu-id="2b289-162">53</span><span class="sxs-lookup"><span data-stu-id="2b289-162">53</span></span> |<span data-ttu-id="2b289-163">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-163">Outbound</span></span> |<span data-ttu-id="2b289-164">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="2b289-164">TCP/UDP</span></span> |<span data-ttu-id="2b289-165">Redis závislosti ve službě DNS (Internet nebo VNet)</span><span class="sxs-lookup"><span data-stu-id="2b289-165">Redis dependencies on DNS (Internet/VNet)</span></span> | <span data-ttu-id="2b289-166">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-166">(Redis subnet)</span></span> |* |
| <span data-ttu-id="2b289-167">8443</span><span class="sxs-lookup"><span data-stu-id="2b289-167">8443</span></span> |<span data-ttu-id="2b289-168">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-168">Outbound</span></span> |<span data-ttu-id="2b289-169">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-169">TCP</span></span> |<span data-ttu-id="2b289-170">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-170">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-171">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-171">(Redis subnet)</span></span> | <span data-ttu-id="2b289-172">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-172">(Redis subnet)</span></span> |
| <span data-ttu-id="2b289-173">10221-10231</span><span class="sxs-lookup"><span data-stu-id="2b289-173">10221-10231</span></span> |<span data-ttu-id="2b289-174">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-174">Outbound</span></span> |<span data-ttu-id="2b289-175">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-175">TCP</span></span> |<span data-ttu-id="2b289-176">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-176">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-177">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-177">(Redis subnet)</span></span> | <span data-ttu-id="2b289-178">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-178">(Redis subnet)</span></span> |
| <span data-ttu-id="2b289-179">20226</span><span class="sxs-lookup"><span data-stu-id="2b289-179">20226</span></span> |<span data-ttu-id="2b289-180">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-180">Outbound</span></span> |<span data-ttu-id="2b289-181">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-181">TCP</span></span> |<span data-ttu-id="2b289-182">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-182">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-183">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-183">(Redis subnet)</span></span> |<span data-ttu-id="2b289-184">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-184">(Redis subnet)</span></span> |
| <span data-ttu-id="2b289-185">13000-13999</span><span class="sxs-lookup"><span data-stu-id="2b289-185">13000-13999</span></span> |<span data-ttu-id="2b289-186">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-186">Outbound</span></span> |<span data-ttu-id="2b289-187">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-187">TCP</span></span> |<span data-ttu-id="2b289-188">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-188">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-189">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-189">(Redis subnet)</span></span> |<span data-ttu-id="2b289-190">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-190">(Redis subnet)</span></span> |
| <span data-ttu-id="2b289-191">15000-15999</span><span class="sxs-lookup"><span data-stu-id="2b289-191">15000-15999</span></span> |<span data-ttu-id="2b289-192">Odchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-192">Outbound</span></span> |<span data-ttu-id="2b289-193">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-193">TCP</span></span> |<span data-ttu-id="2b289-194">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-194">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-195">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-195">(Redis subnet)</span></span> |<span data-ttu-id="2b289-196">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-196">(Redis subnet)</span></span> |


### <a name="inbound-port-requirements"></a><span data-ttu-id="2b289-197">Požadavky na portu pro příchozí spojení</span><span class="sxs-lookup"><span data-stu-id="2b289-197">Inbound port requirements</span></span>

<span data-ttu-id="2b289-198">Nejsou osm požadavky rozsah portu pro příchozí spojení.</span><span class="sxs-lookup"><span data-stu-id="2b289-198">There are eight inbound port range requirements.</span></span> <span data-ttu-id="2b289-199">Příchozí požadavky do tohoto rozsahu jsou příchozí z jiné služby hostované ve stejné virtuální síti nebo interní komunikaci podsítě Redis.</span><span class="sxs-lookup"><span data-stu-id="2b289-199">Inbound requests in these ranges are either inbound from other services hosted in the same VNET or internal to the Redis subnet communications.</span></span>

| <span data-ttu-id="2b289-200">Port(y) pro</span><span class="sxs-lookup"><span data-stu-id="2b289-200">Port(s)</span></span> | <span data-ttu-id="2b289-201">Směr</span><span class="sxs-lookup"><span data-stu-id="2b289-201">Direction</span></span> | <span data-ttu-id="2b289-202">Přenosový protokol</span><span class="sxs-lookup"><span data-stu-id="2b289-202">Transport Protocol</span></span> | <span data-ttu-id="2b289-203">Účel</span><span class="sxs-lookup"><span data-stu-id="2b289-203">Purpose</span></span> | <span data-ttu-id="2b289-204">Místní IP</span><span class="sxs-lookup"><span data-stu-id="2b289-204">Local IP</span></span> | <span data-ttu-id="2b289-205">Vzdálené IP</span><span class="sxs-lookup"><span data-stu-id="2b289-205">Remote IP</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="2b289-206">6379, 6380</span><span class="sxs-lookup"><span data-stu-id="2b289-206">6379, 6380</span></span> |<span data-ttu-id="2b289-207">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-207">Inbound</span></span> |<span data-ttu-id="2b289-208">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-208">TCP</span></span> |<span data-ttu-id="2b289-209">Komunikaci klientů Redis, Vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-209">Client communication to Redis, Azure load balancing</span></span> | <span data-ttu-id="2b289-210">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-210">(Redis subnet)</span></span> |<span data-ttu-id="2b289-211">Virtuální síť, nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-211">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-212">8443</span><span class="sxs-lookup"><span data-stu-id="2b289-212">8443</span></span> |<span data-ttu-id="2b289-213">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-213">Inbound</span></span> |<span data-ttu-id="2b289-214">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-214">TCP</span></span> |<span data-ttu-id="2b289-215">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-215">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-216">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-216">(Redis subnet)</span></span> |<span data-ttu-id="2b289-217">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-217">(Redis subnet)</span></span> |
| <span data-ttu-id="2b289-218">8500</span><span class="sxs-lookup"><span data-stu-id="2b289-218">8500</span></span> |<span data-ttu-id="2b289-219">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-219">Inbound</span></span> |<span data-ttu-id="2b289-220">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="2b289-220">TCP/UDP</span></span> |<span data-ttu-id="2b289-221">Vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-221">Azure load balancing</span></span> | <span data-ttu-id="2b289-222">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-222">(Redis subnet)</span></span> |<span data-ttu-id="2b289-223">Nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-223">Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-224">10221-10231</span><span class="sxs-lookup"><span data-stu-id="2b289-224">10221-10231</span></span> |<span data-ttu-id="2b289-225">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-225">Inbound</span></span> |<span data-ttu-id="2b289-226">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-226">TCP</span></span> |<span data-ttu-id="2b289-227">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-227">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-228">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-228">(Redis subnet)</span></span> |<span data-ttu-id="2b289-229">(Redis podsíť), nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-229">(Redis subnet), Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-230">13000-13999</span><span class="sxs-lookup"><span data-stu-id="2b289-230">13000-13999</span></span> |<span data-ttu-id="2b289-231">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-231">Inbound</span></span> |<span data-ttu-id="2b289-232">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-232">TCP</span></span> |<span data-ttu-id="2b289-233">Komunikaci klientů Redis clustery Vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-233">Client communication to Redis Clusters, Azure load balancing</span></span> | <span data-ttu-id="2b289-234">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-234">(Redis subnet)</span></span> |<span data-ttu-id="2b289-235">Virtuální síť, nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-235">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-236">15000-15999</span><span class="sxs-lookup"><span data-stu-id="2b289-236">15000-15999</span></span> |<span data-ttu-id="2b289-237">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-237">Inbound</span></span> |<span data-ttu-id="2b289-238">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-238">TCP</span></span> |<span data-ttu-id="2b289-239">Komunikaci klientů Redis clustery, Azure načíst vyrovnávání</span><span class="sxs-lookup"><span data-stu-id="2b289-239">Client communication to Redis Clusters, Azure load Balancing</span></span> | <span data-ttu-id="2b289-240">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-240">(Redis subnet)</span></span> |<span data-ttu-id="2b289-241">Virtuální síť, nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-241">Virtual Network, Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-242">16001</span><span class="sxs-lookup"><span data-stu-id="2b289-242">16001</span></span> |<span data-ttu-id="2b289-243">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-243">Inbound</span></span> |<span data-ttu-id="2b289-244">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="2b289-244">TCP/UDP</span></span> |<span data-ttu-id="2b289-245">Vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-245">Azure load balancing</span></span> | <span data-ttu-id="2b289-246">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-246">(Redis subnet)</span></span> |<span data-ttu-id="2b289-247">Nástroj pro vyrovnávání zatížení Azure</span><span class="sxs-lookup"><span data-stu-id="2b289-247">Azure Load Balancer</span></span> |
| <span data-ttu-id="2b289-248">20226</span><span class="sxs-lookup"><span data-stu-id="2b289-248">20226</span></span> |<span data-ttu-id="2b289-249">Příchozí</span><span class="sxs-lookup"><span data-stu-id="2b289-249">Inbound</span></span> |<span data-ttu-id="2b289-250">TCP</span><span class="sxs-lookup"><span data-stu-id="2b289-250">TCP</span></span> |<span data-ttu-id="2b289-251">Interní komunikaci pro Redis</span><span class="sxs-lookup"><span data-stu-id="2b289-251">Internal communications for Redis</span></span> | <span data-ttu-id="2b289-252">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-252">(Redis subnet)</span></span> |<span data-ttu-id="2b289-253">(Redis podsíť)</span><span class="sxs-lookup"><span data-stu-id="2b289-253">(Redis subnet)</span></span> |

### <a name="additional-vnet-network-connectivity-requirements"></a><span data-ttu-id="2b289-254">Další požadavky na připojení sítě VNET</span><span class="sxs-lookup"><span data-stu-id="2b289-254">Additional VNET network connectivity requirements</span></span>

<span data-ttu-id="2b289-255">Existují požadavky na síťové připojení pro Azure Redis Cache, nemusí být splněny původně ve virtuální síti.</span><span class="sxs-lookup"><span data-stu-id="2b289-255">There are network connectivity requirements for Azure Redis Cache that may not be initially met in a virtual network.</span></span> <span data-ttu-id="2b289-256">Azure Redis Cache vyžaduje všechny následující položky fungovat správně při použití v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="2b289-256">Azure Redis Cache requires all the following items to function properly when used within a virtual network.</span></span>

* <span data-ttu-id="2b289-257">Odchozí síťové připojení k Azure Storage koncových bodů po celém světě.</span><span class="sxs-lookup"><span data-stu-id="2b289-257">Outbound network connectivity to Azure Storage endpoints worldwide.</span></span> <span data-ttu-id="2b289-258">To zahrnuje koncové body umístěné ve stejné oblasti jako instanci služby Azure Redis Cache, stejně jako koncové body úložiště, které jsou umístěné v **jiných** oblastech Azure.</span><span class="sxs-lookup"><span data-stu-id="2b289-258">This includes endpoints located in the same region as the Azure Redis Cache instance, as well as storage endpoints located in **other** Azure regions.</span></span> <span data-ttu-id="2b289-259">Koncové body Azure úložiště vyřešit v rámci z následujících domén DNS: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*a *file.core.windows.net*.</span><span class="sxs-lookup"><span data-stu-id="2b289-259">Azure Storage endpoints resolve under the following DNS domains: *table.core.windows.net*, *blob.core.windows.net*, *queue.core.windows.net*, and *file.core.windows.net*.</span></span> 
* <span data-ttu-id="2b289-260">Odchozí síťové připojení k *ocsp.msocsp.com*, *mscrl.microsoft.com*, a *crl.microsoft.com*. Toto připojení je potřeba k podpoře funkce SSL.</span><span class="sxs-lookup"><span data-stu-id="2b289-260">Outbound network connectivity to *ocsp.msocsp.com*, *mscrl.microsoft.com*, and *crl.microsoft.com*. This connectivity is needed to support SSL functionality.</span></span>
* <span data-ttu-id="2b289-261">Konfiguraci DNS pro virtuální síť musí být schopen překladu všechny koncové body a domény uvedený v dřívějších bodů.</span><span class="sxs-lookup"><span data-stu-id="2b289-261">The DNS configuration for the virtual network must be capable of resolving all of the endpoints and domains mentioned in the earlier points.</span></span> <span data-ttu-id="2b289-262">Zajištěním platný infrastruktura DNS je nakonfigurován a udržovat virtuální sítě můžete splnit tyto požadavky na DNS.</span><span class="sxs-lookup"><span data-stu-id="2b289-262">These DNS requirements can be met by ensuring a valid DNS infrastructure is configured and maintained for the virtual network.</span></span>
* <span data-ttu-id="2b289-263">Odchozí síťové připojení k vytvoření následujících Azure Monitoring koncových bodů, které vyřešit v rámci z následujících domén DNS: Severní prod2.prod2.metrics.nsatc.net shoebox2-black.shoebox2.metrics.nsatc.net azglobal-black.azglobal.metrics.nsatc.net , shoebox2-red.shoebox2.metrics.nsatc.net prod2.prod2.metrics.nsatc.net – východ, azglobal-red.azglobal.metrics.nsatc.net.</span><span class="sxs-lookup"><span data-stu-id="2b289-263">Outbound network connectivity to the following Azure Monitoring endpoints, which resolve under the following DNS domains: shoebox2-black.shoebox2.metrics.nsatc.net, north-prod2.prod2.metrics.nsatc.net, azglobal-black.azglobal.metrics.nsatc.net, shoebox2-red.shoebox2.metrics.nsatc.net, east-prod2.prod2.metrics.nsatc.net, azglobal-red.azglobal.metrics.nsatc.net.</span></span>

### <a name="how-can-i-verify-that-my-cache-is-working-in-a-vnet"></a><span data-ttu-id="2b289-264">Jak můžete ověřit, že moje mezipaměti funguje ve virtuální síti?</span><span class="sxs-lookup"><span data-stu-id="2b289-264">How can I verify that my cache is working in a VNET?</span></span>

>[!IMPORTANT]
><span data-ttu-id="2b289-265">Při připojování k instanci služby Azure Redis Cache, který je hostován ve virtuální síti, vaši klienti mezipaměti musí být ve stejné virtuální síti, včetně všech testovací aplikace a diagnostické nástroje příkaz ping.</span><span class="sxs-lookup"><span data-stu-id="2b289-265">When connecting to an Azure Redis Cache instance that is hosted in a VNET, your cache clients must be in the same VNET, including any test applications or diagnostic pinging tools.</span></span>
>
>

<span data-ttu-id="2b289-266">Po nakonfigurování port požadavky popsané v předchozí části, můžete ověřit, že mezipaměti funguje tak, že provedete následující kroky.</span><span class="sxs-lookup"><span data-stu-id="2b289-266">Once the port requirements are configured as described in the previous section, you can verify that your cache is working by performing the following steps.</span></span>

- <span data-ttu-id="2b289-267">[Restartovat](cache-administration.md#reboot) všechny uzly mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-267">[Reboot](cache-administration.md#reboot) all of the cache nodes.</span></span> <span data-ttu-id="2b289-268">Pokud všechny závislosti požadované mezipaměti, není dosažitelná (jak je uvedeno v [příchozí požadavky na porty](cache-how-to-premium-vnet.md#inbound-port-requirements) a [odchozí port požadavky](cache-how-to-premium-vnet.md#outbound-port-requirements)), do mezipaměti, nebude možné úspěšně znovu.</span><span class="sxs-lookup"><span data-stu-id="2b289-268">If all of the required cache dependencies can't be reached (as documented in [Inbound port requirements](cache-how-to-premium-vnet.md#inbound-port-requirements) and [Outbound port requirements](cache-how-to-premium-vnet.md#outbound-port-requirements)), the cache won't be able to restart successfully.</span></span>
- <span data-ttu-id="2b289-269">Po restartování uzly mezipaměti (vykazované mezipaměti stav na portálu Azure), můžete provést následující testy:</span><span class="sxs-lookup"><span data-stu-id="2b289-269">Once the cache nodes have restarted (as reported by the cache status in the Azure portal), you can perform the following tests:</span></span>
  - <span data-ttu-id="2b289-270">příkaz ping koncový bod mezipaměti (pomocí portu 6380) z počítače, který je v rámci stejné virtuální síti jako do mezipaměti pomocí [tcping](https://www.elifulkerson.com/projects/tcping.php).</span><span class="sxs-lookup"><span data-stu-id="2b289-270">ping the cache endpoint (using port 6380) from a machine that is within the same VNET as the cache, using [tcping](https://www.elifulkerson.com/projects/tcping.php).</span></span> <span data-ttu-id="2b289-271">Například:</span><span class="sxs-lookup"><span data-stu-id="2b289-271">For example:</span></span>
    
    `tcping.exe contosocache.redis.cache.windows.net 6380`
    
    <span data-ttu-id="2b289-272">Pokud `tcping` nástroj hlásí, že port je otevřený, mezipaměti je k dispozici pro připojení z klientů ve virtuální síti.</span><span class="sxs-lookup"><span data-stu-id="2b289-272">If the `tcping` tool reports that the port is open, the cache is available for connection from clients in the VNET.</span></span>

  - <span data-ttu-id="2b289-273">Jiný způsob, jak otestovat je vytvoření testovacího mezipaměti klienta (které by mohly být jednoduchou konzolovou aplikaci pomocí StackExchange.Redis), se připojí k mezipaměti a přidá a načte některé položky z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-273">Another way to test is to create a test cache client (which could be a simple console application using StackExchange.Redis) that connects to the cache and adds and retrieves some items from the cache.</span></span> <span data-ttu-id="2b289-274">Nainstalujte ukázkovou aplikaci klienta na virtuální počítač, který je ve stejné virtuální síti jako mezipaměť a spusťte jej k ověření připojení k mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-274">Install the sample client application onto a VM that is in the same VNET as the cache and run it to verify connectivity to the cache.</span></span>


### <a name="can-i-use-vnets-with-a-standard-or-basic-cache"></a><span data-ttu-id="2b289-275">Můžete použít virtuální sítě s standardní nebo základní mezipaměti?</span><span class="sxs-lookup"><span data-stu-id="2b289-275">Can I use VNets with a standard or basic cache?</span></span>
<span data-ttu-id="2b289-276">Virtuální sítě můžete použít pouze u prémiových mezipamětí.</span><span class="sxs-lookup"><span data-stu-id="2b289-276">VNets can only be used with premium caches.</span></span>

### <a name="why-does-creating-a-redis-cache-fail-in-some-subnets-but-not-others"></a><span data-ttu-id="2b289-277">Proč vytvoření mezipaměti Redis selhání v některé podsítě a jiné ne?</span><span class="sxs-lookup"><span data-stu-id="2b289-277">Why does creating a Redis cache fail in some subnets but not others?</span></span>
<span data-ttu-id="2b289-278">Pokud nasazujete Azure Redis Cache do virtuální sítě Resource Manageru, mezipaměti musí být ve vyhrazené podsíť, která obsahuje jiný typ prostředku.</span><span class="sxs-lookup"><span data-stu-id="2b289-278">If you are deploying an Azure Redis Cache to a Resource Manager VNet, the cache must be in a dedicated subnet that contains no other resource type.</span></span> <span data-ttu-id="2b289-279">Pokud je proveden pokus o nasazení Azure Redis Cache k podsíti virtuální sítě Resource Manageru obsahující další prostředky, nasazení se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="2b289-279">If an attempt is made to deploy an Azure Redis Cache to a Resource Manager VNet subnet that contains other resources, the deployment fails.</span></span> <span data-ttu-id="2b289-280">Před vytvořením nové mezipaměti Redis, je nutné odstranit existující prostředků v podsíti.</span><span class="sxs-lookup"><span data-stu-id="2b289-280">You must delete the existing resources inside the subnet before you can create a new Redis cache.</span></span>

<span data-ttu-id="2b289-281">Více typů prostředků, můžete nasadit na klasické virtuální sítě, dokud máte dost IP adres, které jsou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="2b289-281">You can deploy multiple types of resources to a classic VNet as long as you have enough IP addresses available.</span></span>

### <a name="what-are-the-subnet-address-space-requirements"></a><span data-ttu-id="2b289-282">Jaké jsou požadavky na místo adres podsítě?</span><span class="sxs-lookup"><span data-stu-id="2b289-282">What are the subnet address space requirements?</span></span>
<span data-ttu-id="2b289-283">Azure si vyhrazuje některé IP adresy v rámci každé podsítě a tyto adresy nelze použít.</span><span class="sxs-lookup"><span data-stu-id="2b289-283">Azure reserves some IP addresses within each subnet, and these addresses can't be used.</span></span> <span data-ttu-id="2b289-284">První a poslední IP adresy podsítě jsou vyhrazené pro protokol shoda, společně s tři další adresy používané pro služby Azure.</span><span class="sxs-lookup"><span data-stu-id="2b289-284">The first and last IP addresses of the subnets are reserved for protocol conformance, along with three more addresses used for Azure services.</span></span> <span data-ttu-id="2b289-285">Další informace najdete v tématu [existují nějaká omezení na pomocí IP adresy v rámci těchto podsítí?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span><span class="sxs-lookup"><span data-stu-id="2b289-285">For more information, see [Are there any restrictions on using IP addresses within these subnets?](../virtual-network/virtual-networks-faq.md#are-there-any-restrictions-on-using-ip-addresses-within-these-subnets)</span></span>

<span data-ttu-id="2b289-286">Kromě IP adresy používané při infrastruktury virtuální sítě Azure každý Redis instance v podsíti používá dvě IP adresy na horizontální oddíl a jednu IP adresu další nástroje pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="2b289-286">In addition to the IP addresses used by the Azure VNET infrastructure, each Redis instance in the subnet uses two IP addresses per shard and one additional IP address for the load balancer.</span></span> <span data-ttu-id="2b289-287">Mezipaměť neclusterované považuje tak, aby měl jeden horizontálního oddílu.</span><span class="sxs-lookup"><span data-stu-id="2b289-287">A non-clustered cache is considered to have one shard.</span></span>

### <a name="do-all-cache-features-work-when-hosting-a-cache-in-a-vnet"></a><span data-ttu-id="2b289-288">Fungují všechny funkce mezipaměti při hostování mezipaměti ve virtuální síti?</span><span class="sxs-lookup"><span data-stu-id="2b289-288">Do all cache features work when hosting a cache in a VNET?</span></span>
<span data-ttu-id="2b289-289">Pokud vaše mezipaměť je součástí virtuální sítě, jenom pro klienty ve virtuální síti přístup do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-289">When your cache is part of a VNET, only clients in the VNET can access the cache.</span></span> <span data-ttu-id="2b289-290">V tuto chvíli se v důsledku toho nepodporují následující funkce správy mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-290">As a result, the following cache management features don't work at this time.</span></span>

* <span data-ttu-id="2b289-291">Konzola redis – protože se spouští konzola Redis v prohlížeči místní, což je mimo síť VNET, se nemůže připojit ke své mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="2b289-291">Redis Console - Because Redis Console runs in your local browser, which is outside the VNET, it can't connect to your cache.</span></span>

## <a name="use-expressroute-with-azure-redis-cache"></a><span data-ttu-id="2b289-292">Pomocí ExpressRoute s Azure Redis Cache</span><span class="sxs-lookup"><span data-stu-id="2b289-292">Use ExpressRoute with Azure Redis Cache</span></span>
<span data-ttu-id="2b289-293">Zákazníci mohou připojit [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) okruhu jejich infrastruktury virtuální sítě, tak rozšířit jejich místní sítě do Azure.</span><span class="sxs-lookup"><span data-stu-id="2b289-293">Customers can connect an [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) circuit to their virtual network infrastructure, thus extending their on-premises network to Azure.</span></span> 

<span data-ttu-id="2b289-294">Ve výchozím nastavení, nově vytvořený okruh ExpressRoute neprovádí vynucené tunelování (inzerování výchozí trasy, 0.0.0.0/0) na virtuální síť.</span><span class="sxs-lookup"><span data-stu-id="2b289-294">By default, a newly created ExpressRoute circuit does not perform forced tunneling (advertisement of a default route, 0.0.0.0/0) on a VNET.</span></span> <span data-ttu-id="2b289-295">V důsledku toho odchozí připojení k Internetu je povoleno přímo z virtuální sítě a klientských aplikací se může připojit k jiné koncové body Azure, včetně Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-295">As a result, outbound Internet connectivity is allowed directly from the VNET and client applications are able to connect to other Azure endpoints including Azure Redis Cache.</span></span>

<span data-ttu-id="2b289-296">Ale obvyklé konfigurace zákazníka je použití vynuceného tunelování (Inzerovat výchozí trasu) který vynutí odchozí přenosy z Internetu do místo toku místní.</span><span class="sxs-lookup"><span data-stu-id="2b289-296">However a common customer configuration is to use forced tunneling (advertise a default route) which forces outbound Internet traffic to instead flow on-premises.</span></span> <span data-ttu-id="2b289-297">Tento tok provozu dělí připojení s Azure Redis Cache, pokud je přenos odchozí potom blokovaný místně, tak, aby instanci služby Azure Redis Cache není schopna komunikovat s jeho závislé součásti.</span><span class="sxs-lookup"><span data-stu-id="2b289-297">This traffic flow breaks connectivity with Azure Redis Cache if the outbound traffic is then blocked on-premises such that the Azure Redis Cache instance is not able to communicate with its dependencies.</span></span>

<span data-ttu-id="2b289-298">Řešení je definovat jeden (nebo více) trasy definované uživatelem (udr) v podsíti, který obsahuje Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-298">The solution is to define one (or more) user-defined routes (UDRs) on the subnet that contains the Azure Redis Cache.</span></span> <span data-ttu-id="2b289-299">UDR definuje tras konkrétní podsítě, které bude dodržení místo výchozí trasu.</span><span class="sxs-lookup"><span data-stu-id="2b289-299">A UDR defines subnet-specific routes that will be honored instead of the default route.</span></span>

<span data-ttu-id="2b289-300">Pokud je to možné doporučujeme použít následující konfigurace:</span><span class="sxs-lookup"><span data-stu-id="2b289-300">If possible, it is recommended to use the following configuration:</span></span>

* <span data-ttu-id="2b289-301">Konfigurace ExpressRoute inzeruje 0.0.0.0/0 a ve výchozím nastavení vynucené tunelových propojení všechny odchozí přenosy na místě.</span><span class="sxs-lookup"><span data-stu-id="2b289-301">The ExpressRoute configuration advertises 0.0.0.0/0 and by default force tunnels all outbound traffic on-premises.</span></span>
* <span data-ttu-id="2b289-302">UDR použije na podsíť obsahující Azure Redis Cache definuje 0.0.0.0/0 s pracovní postup pro provoz protokolu TCP/IP do veřejného Internetu; například pomocí nastavení typ dalšího přechodu "Internet".</span><span class="sxs-lookup"><span data-stu-id="2b289-302">The UDR applied to the subnet containing the Azure Redis Cache defines 0.0.0.0/0 with a working route for TCP/IP traffic to the public internet; for example by setting the next hop type to 'Internet'.</span></span>

<span data-ttu-id="2b289-303">Celkové požadavky tyto kroky je, že na úrovni podsítě UDR má přednost před ExpressRoute vynucené tunelování, čímž zajišťuje odchozí přístup k Internetu z Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-303">The combined effect of these steps is that the subnet level UDR takes precedence over the ExpressRoute forced tunneling, thus ensuring outbound Internet access from the Azure Redis Cache.</span></span>

<span data-ttu-id="2b289-304">Připojení k instanci služby Azure Redis Cache z místní aplikace pomocí ExpressRoute není scénáři typické použití z důvodů výkonu (pro nejlepší výkon Azure Redis Cache klientů musí být ve stejné oblasti jako Azure Redis Cache).</span><span class="sxs-lookup"><span data-stu-id="2b289-304">Connecting to an Azure Redis Cache instance from an on-premises application using ExpressRoute is not a typical usage scenario due to performance reasons (for best performance Azure Redis Cache clients should be in the same region as the Azure Redis Cache).</span></span>

>[!IMPORTANT] 
><span data-ttu-id="2b289-305">Trasy definované v UDR **musí** být dost konkrétní, aby mají přednost před všechny trasy inzerované konfigurace ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="2b289-305">The routes defined in a UDR **must** be specific enough to take precedence over any routes advertised by the ExpressRoute configuration.</span></span> <span data-ttu-id="2b289-306">Následující příklad používá rozsah adres široký 0.0.0.0/0 a jako takový se dá potenciálně omylem přepsat inzerování tras pomocí podrobnější rozsahy adres.</span><span class="sxs-lookup"><span data-stu-id="2b289-306">The following example uses the broad 0.0.0.0/0 address range, and as such can potentially be accidentally overridden by route advertisements using more specific address ranges.</span></span>

>[!WARNING]  
><span data-ttu-id="2b289-307">Azure Redis Cache není podporován s konfigurací ExpressRoute, **nesprávně Inzerovat trasy z cesty veřejného partnerského vztahu k cestou soukromého partnerského vztahu mezi**.</span><span class="sxs-lookup"><span data-stu-id="2b289-307">Azure Redis Cache is not supported with ExpressRoute configurations that **incorrectly cross-advertise routes from the public peering path to the private peering path**.</span></span> <span data-ttu-id="2b289-308">Konfigurace ExpressRoute, které mají veřejné partnerské vztahy nakonfigurované, obdrží inzerování trasy od společnosti Microsoft pro velké sady rozsahů adres Microsoft Azure IP.</span><span class="sxs-lookup"><span data-stu-id="2b289-308">ExpressRoute configurations that have public peering configured, receive route advertisements from Microsoft for a large set of Microsoft Azure IP address ranges.</span></span> <span data-ttu-id="2b289-309">Pokud tyto rozsahy adres nesprávně ohlášené mezi na cestou soukromého partnerského vztahu, výsledkem je, že jsou všechny odchozí síťových paketů z podsítě instanci Azure Redis Cache nesprávně force tunelovým propojením zákazníka místní síťové infrastruktuře .</span><span class="sxs-lookup"><span data-stu-id="2b289-309">If these address ranges are incorrectly cross-advertised on the private peering path, the result is that all outbound network packets from the Azure Redis Cache instance's subnet are incorrectly force-tunneled to a customer's on-premises network infrastructure.</span></span> <span data-ttu-id="2b289-310">Tento tok sítě dělí Azure Redis Cache.</span><span class="sxs-lookup"><span data-stu-id="2b289-310">This network flow breaks Azure Redis Cache.</span></span> <span data-ttu-id="2b289-311">Řešení tohoto problému je zastavit směrování mezi – reklamu z cesty veřejného partnerského vztahu cestou soukromého partnerského vztahu.</span><span class="sxs-lookup"><span data-stu-id="2b289-311">The solution to this problem is to stop cross-advertising routes from the public peering path to the private peering path.</span></span>


<span data-ttu-id="2b289-312">Základní informace o trasy definované uživatelem je k dispozici v tomto [přehled](../virtual-network/virtual-networks-udr-overview.md).</span><span class="sxs-lookup"><span data-stu-id="2b289-312">Background information on user-defined routes is available in this [overview](../virtual-network/virtual-networks-udr-overview.md).</span></span>

<span data-ttu-id="2b289-313">Další informace o ExpressRoute najdete v tématu [technický přehled ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="2b289-313">For more information about ExpressRoute, see [ExpressRoute technical overview](../expressroute/expressroute-introduction.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="2b289-314">Další kroky</span><span class="sxs-lookup"><span data-stu-id="2b289-314">Next steps</span></span>
<span data-ttu-id="2b289-315">Naučte se používat další funkce mezipaměti premium.</span><span class="sxs-lookup"><span data-stu-id="2b289-315">Learn how to use more premium cache features.</span></span>

* [<span data-ttu-id="2b289-316">Úvod do Azure Redis Cache na úrovni Premium</span><span class="sxs-lookup"><span data-stu-id="2b289-316">Introduction to the Azure Redis Cache Premium tier</span></span>](cache-premium-tier-intro.md)

<!-- IMAGES -->

[redis-cache-vnet]: ./media/cache-how-to-premium-vnet/redis-cache-vnet.png

[redis-cache-vnet-ip]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-ip.png

[redis-cache-vnet-info]: ./media/cache-how-to-premium-vnet/redis-cache-vnet-info.png


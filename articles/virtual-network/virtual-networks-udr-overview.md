---
title: "trasy definované uživatelem aaaUser a předávání IP v Azure | Microsoft Docs"
description: "Zjistěte, jak tooconfigure trasy definované uživatelem (UDR) a předávání IP adres tooforward provozu toonetwork virtuálních zařízení v Azure."
services: virtual-network
documentationcenter: na
author: jimdial
manager: timlt
editor: tysonn
ms.assetid: c39076c4-11b7-4b46-a904-817503c4b486
ms.service: virtual-network
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 03/15/2016
ms.author: jdial
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f1f1d46166d5a7c776f472b7ade1354d943ece10
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="user-defined-routes-and-ip-forwarding"></a><span data-ttu-id="9ca39-103">Uživatelem definované trasy a předávání IP</span><span class="sxs-lookup"><span data-stu-id="9ca39-103">User-defined routes and IP forwarding</span></span>

<span data-ttu-id="9ca39-104">Když přidáte virtuální počítače (VM) tooa virtuální síť (VNet) v Azure, si všimnete hello virtuální počítače automaticky se možné toocommunicate mezi sebou přes síť hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-104">When you add virtual machines (VMs) tooa virtual network (VNet) in Azure, you will notice that hello VMs are able toocommunicate with each other over hello network, automatically.</span></span> <span data-ttu-id="9ca39-105">Není nutné toospecify bránu, i když hello virtuální počítače jsou v různých podsítích.</span><span class="sxs-lookup"><span data-stu-id="9ca39-105">You do not need toospecify a gateway, even though hello VMs are in different subnets.</span></span> <span data-ttu-id="9ca39-106">Hello totéž platí pro komunikaci z virtuálních počítačů toohello hello veřejného Internetu a dokonce tooyour do místní sítě při hybridní připojení z Azure tooyour vlastní datacenter je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="9ca39-106">hello same is true for communication from hello VMs toohello public Internet, and even tooyour on-premises network when a hybrid connection from Azure tooyour own datacenter is present.</span></span>

<span data-ttu-id="9ca39-107">Tento tok komunikace je možné, protože Azure pomocí řady systémových tras toodefine toky provozu IP.</span><span class="sxs-lookup"><span data-stu-id="9ca39-107">This flow of communication is possible because Azure uses a series of system routes toodefine how IP traffic flows.</span></span> <span data-ttu-id="9ca39-108">Systémové trasy řídí tok hello komunikace v hello následující scénáře:</span><span class="sxs-lookup"><span data-stu-id="9ca39-108">System routes control hello flow of communication in hello following scenarios:</span></span>

* <span data-ttu-id="9ca39-109">V nástroji hello stejné podsíti.</span><span class="sxs-lookup"><span data-stu-id="9ca39-109">From within hello same subnet.</span></span>
* <span data-ttu-id="9ca39-110">Z podsítě tooanother v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9ca39-110">From a subnet tooanother within a VNet.</span></span>
* <span data-ttu-id="9ca39-111">Z virtuálních počítačů toohello Internetu.</span><span class="sxs-lookup"><span data-stu-id="9ca39-111">From VMs toohello Internet.</span></span>
* <span data-ttu-id="9ca39-112">Z virtuální síť tooanother virtuální sítě prostřednictvím brány sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="9ca39-112">From a VNet tooanother VNet through a VPN gateway.</span></span>
* <span data-ttu-id="9ca39-113">Z virtuální sítě tooanother virtuální sítě prostřednictvím sítě VNet partnerského vztahu (řetězení služby).</span><span class="sxs-lookup"><span data-stu-id="9ca39-113">From a VNet tooanother VNet through VNet Peering (Service Chaining).</span></span>
* <span data-ttu-id="9ca39-114">Z virtuální sítě tooyour místní sítě prostřednictvím brány sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="9ca39-114">From a VNet tooyour on-premises network through a VPN gateway.</span></span>

<span data-ttu-id="9ca39-115">Hello obrázek níže znázorňuje jednoduché uspořádání s virtuální síť a dvě podsítě, několika virtuálními počítači, společně s hello systémové trasy, které umožňují tooflow provozu IP.</span><span class="sxs-lookup"><span data-stu-id="9ca39-115">hello figure below shows a simple setup with a VNet, two subnets, and a few VMs, along with hello system routes that allow IP traffic tooflow.</span></span>

![Systémové trasy v Azure](./media/virtual-networks-udr-overview/Figure1.png)

<span data-ttu-id="9ca39-117">Ačkoli použití systémových tras hello automaticky usnadňuje provoz vašeho nasazení, existují případy, ve kterých chcete toocontrol hello směrování paketů prostřednictvím virtuálního zařízení.</span><span class="sxs-lookup"><span data-stu-id="9ca39-117">Although hello use of system routes facilitates traffic automatically for your deployment, there are cases in which you want toocontrol hello routing of packets through a virtual appliance.</span></span> <span data-ttu-id="9ca39-118">Můžete tak tak, že vytvoříte trasy definované uživatelem, který zadáte hello další segment směrování paketů místo předávaných tooa určité podsíti toogo tooyour virtuální zařízení a povolení IP předávání hello virtuálnímu počítači spuštěnému jako virtuální zařízení hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-118">You can do so by creating user defined routes that specify hello next hop for packets flowing tooa specific subnet toogo tooyour virtual appliance instead, and enabling IP forwarding for hello VM running as hello virtual appliance.</span></span>

<span data-ttu-id="9ca39-119">Hello obrázek níže znázorňuje příklad tras definovaných uživatelem a předávání paketů tooforce IP odeslány tooone podsíť z jiné toogo procházet virtuálním zařízením ve třetí podsíti.</span><span class="sxs-lookup"><span data-stu-id="9ca39-119">hello figure below shows an example of user defined routes and IP forwarding tooforce packets sent tooone subnet from another toogo through a virtual appliance on a third subnet.</span></span>

![Systémové trasy v Azure](./media/virtual-networks-udr-overview/Figure2.png)

> [!IMPORTANT]
> <span data-ttu-id="9ca39-121">Trasy definované uživatelem jsou použité tootraffic z podsítě z libovolného zdroje (například síťových rozhraní připojených tooVMs) v podsíti hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-121">User-defined routes are applied tootraffic leaving a subnet from any resource (such as network interfaces attached tooVMs) in hello subnet.</span></span> <span data-ttu-id="9ca39-122">Nelze vytvořit trasy toospecify jak provoz zadá podsíť z Internetu, hello pro instanci.</span><span class="sxs-lookup"><span data-stu-id="9ca39-122">You cannot create routes toospecify how traffic enters a subnet from hello Internet, for instance.</span></span> <span data-ttu-id="9ca39-123">Hello zařízení jsou dál provoz toocannot být v hello stejné podsíti, kde hello provoz pochází.</span><span class="sxs-lookup"><span data-stu-id="9ca39-123">hello appliance you are forwarding traffic toocannot be in hello same subnet where hello traffic originates.</span></span> <span data-ttu-id="9ca39-124">Pro svoje zařízení vždycky vytvořte samostatnou podsíť.</span><span class="sxs-lookup"><span data-stu-id="9ca39-124">Always create a separate subnet for your appliances.</span></span> 
> 
> 

## <a name="route-resource"></a><span data-ttu-id="9ca39-125">Prostředek trasy</span><span class="sxs-lookup"><span data-stu-id="9ca39-125">Route resource</span></span>
<span data-ttu-id="9ca39-126">Se pakety směrují přes síť TCP/IP podle směrovací tabulky definované v každém uzlu ve fyzické síti hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-126">Packets are routed over a TCP/IP network based on a route table defined at each node on hello physical network.</span></span> <span data-ttu-id="9ca39-127">Směrovací tabulka je že kolekce jednotlivých tras používá toodecide, kde tooforward pakety na základě hello cílové IP adresy.</span><span class="sxs-lookup"><span data-stu-id="9ca39-127">A route table is a collection of individual routes used toodecide where tooforward packets based on hello destination IP address.</span></span> <span data-ttu-id="9ca39-128">Trasa se skládá z následujících hello:</span><span class="sxs-lookup"><span data-stu-id="9ca39-128">A route consists of hello following:</span></span>

| <span data-ttu-id="9ca39-129">Vlastnost</span><span class="sxs-lookup"><span data-stu-id="9ca39-129">Property</span></span> | <span data-ttu-id="9ca39-130">Popis</span><span class="sxs-lookup"><span data-stu-id="9ca39-130">Description</span></span> | <span data-ttu-id="9ca39-131">Omezení</span><span class="sxs-lookup"><span data-stu-id="9ca39-131">Constraints</span></span> | <span data-ttu-id="9ca39-132">Požadavky</span><span class="sxs-lookup"><span data-stu-id="9ca39-132">Considerations</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="9ca39-133">Předpona adresy</span><span class="sxs-lookup"><span data-stu-id="9ca39-133">Address Prefix</span></span> |<span data-ttu-id="9ca39-134">Hello cílové CIDR toowhich hello trasa vztahuje, například 10.1.0.0/16.</span><span class="sxs-lookup"><span data-stu-id="9ca39-134">hello destination CIDR toowhich hello route applies, such as 10.1.0.0/16.</span></span> |<span data-ttu-id="9ca39-135">Musí být platný rozsah CIDR, který reprezentuje adresy ve hello veřejný Internet, virtuální síť Azure nebo místního datového centra.</span><span class="sxs-lookup"><span data-stu-id="9ca39-135">Must be a valid CIDR range representing addresses on hello public Internet, Azure virtual network, or on-premises datacenter.</span></span> |<span data-ttu-id="9ca39-136">Ujistěte se, zda text hello **předpona adresy** neobsahuje adresu hello hello **adresa dalšího směrování**, jinak se pakety dostanou do smyčky z hello zdroj toohello další segment nikdy nedorazí Cílový Hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-136">Make sure hello **Address prefix** does not contain hello address for hello **Next hop address**, otherwise your packets will enter in a loop going from hello source toohello next hop without ever reaching hello destination.</span></span> |
| <span data-ttu-id="9ca39-137">Typ dalšího segmentu</span><span class="sxs-lookup"><span data-stu-id="9ca39-137">Next hop type</span></span> |<span data-ttu-id="9ca39-138">Hello typ směrování Azure hello paketu by měly být odeslány na.</span><span class="sxs-lookup"><span data-stu-id="9ca39-138">hello type of Azure hop hello packet should be sent to.</span></span> |<span data-ttu-id="9ca39-139">Musí být jedna z hello následující hodnoty:</span><span class="sxs-lookup"><span data-stu-id="9ca39-139">Must be one of hello following values:</span></span> <br/> <span data-ttu-id="9ca39-140">**Virtuální síť**.</span><span class="sxs-lookup"><span data-stu-id="9ca39-140">**Virtual Network**.</span></span> <span data-ttu-id="9ca39-141">Představuje místní virtuální síť hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-141">Represents hello local virtual network.</span></span> <span data-ttu-id="9ca39-142">Například pokud máte dvě podsítě, 10.1.0.0/16 a 10.2.0.0/16 v hello stejné virtuální síti, hello trasa každé podsítě ve směrovací tabulce hello bude mít hodnotu dalšího segmentu z *virtuální sítě*.</span><span class="sxs-lookup"><span data-stu-id="9ca39-142">For instance, if you have two subnets, 10.1.0.0/16 and 10.2.0.0/16 in hello same virtual network, hello route for each subnet in hello route table will have a next hop value of *Virtual Network*.</span></span> <br/> <span data-ttu-id="9ca39-143">**Brána virtuální sítě**.</span><span class="sxs-lookup"><span data-stu-id="9ca39-143">**Virtual Network Gateway**.</span></span> <span data-ttu-id="9ca39-144">Představuje bránu Azure S2S VPN Gateway.</span><span class="sxs-lookup"><span data-stu-id="9ca39-144">Represents an Azure S2S VPN Gateway.</span></span> <br/> <span data-ttu-id="9ca39-145">**Internet.**</span><span class="sxs-lookup"><span data-stu-id="9ca39-145">**Internet**.</span></span> <span data-ttu-id="9ca39-146">Představuje hello výchozí internetovou bránu poskytovanou podle hello infrastruktury Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-146">Represents hello default Internet gateway provided by hello Azure Infrastructure.</span></span> <br/> <span data-ttu-id="9ca39-147">**Virtuální zařízení.**</span><span class="sxs-lookup"><span data-stu-id="9ca39-147">**Virtual Appliance**.</span></span> <span data-ttu-id="9ca39-148">Představuje virtuální zařízení jste přidali tooyour virtuální síť Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-148">Represents a virtual appliance you added tooyour Azure virtual network.</span></span> <br/> <span data-ttu-id="9ca39-149">**Žádný**.</span><span class="sxs-lookup"><span data-stu-id="9ca39-149">**None**.</span></span> <span data-ttu-id="9ca39-150">Představuje černou díru.</span><span class="sxs-lookup"><span data-stu-id="9ca39-150">Represents a black hole.</span></span> <span data-ttu-id="9ca39-151">Pakety předávané tooa černá díra nebudou předávat vůbec.</span><span class="sxs-lookup"><span data-stu-id="9ca39-151">Packets forwarded tooa black hole will not be forwarded at all.</span></span> |<span data-ttu-id="9ca39-152">Zvažte použití **virtuální zařízení** toodirect provozu tooa virtuálního počítače nebo služby Vyrovnávání zatížení Azure interní IP adresu.</span><span class="sxs-lookup"><span data-stu-id="9ca39-152">Consider using **Virtual Appliance** toodirect traffic tooa VM or Azure Load Balancer internal IP address.</span></span>  <span data-ttu-id="9ca39-153">Tento typ umožňuje specifikaci hello adresy IP, jak je popsáno níže.</span><span class="sxs-lookup"><span data-stu-id="9ca39-153">This type allows hello specification of an IP address as described below.</span></span> <span data-ttu-id="9ca39-154">Zvažte použití **žádné** zadejte toostop pakety z průchodu tooa zadané cílové.</span><span class="sxs-lookup"><span data-stu-id="9ca39-154">Consider using a **None** type toostop packets from flowing tooa given destination.</span></span> |
| <span data-ttu-id="9ca39-155">Adresa dalšího segmentu</span><span class="sxs-lookup"><span data-stu-id="9ca39-155">Next hop address</span></span> |<span data-ttu-id="9ca39-156">Adresa dalšího směrování Hello obsahuje hello IP adresu, kterou mají předávat pakety.</span><span class="sxs-lookup"><span data-stu-id="9ca39-156">hello next hop address contains hello IP address packets should be forwarded to.</span></span> <span data-ttu-id="9ca39-157">Hodnoty dalšího směrování jsou povolené jenom v trasách, kde je typ dalšího přechodu hello *virtuální zařízení*.</span><span class="sxs-lookup"><span data-stu-id="9ca39-157">Next hop values are only allowed in routes where hello next hop type is *Virtual Appliance*.</span></span> |<span data-ttu-id="9ca39-158">Musí být IP adresa, která je dostupná v rámci hello virtuální sítě, kdy se používá hello trasy definované uživatelem, aniž by bylo nutné **brány virtuální sítě**.</span><span class="sxs-lookup"><span data-stu-id="9ca39-158">Must be an IP address that is reachable within hello Virtual Network where hello User Defined Route is applied, without going through a **Virtual Network Gateway**.</span></span> <span data-ttu-id="9ca39-159">Hello IP adresa má toobe na hello stejné virtuální sítě v případě, že je použito, nebo na peered virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9ca39-159">hello IP address has toobe on hello same Virtual Network where it is applied, or on a peered Virtual Network.</span></span> |<span data-ttu-id="9ca39-160">Pokud hello IP adresa představuje virtuální počítač, ujistěte se, povolíte [předávání IP](#IP-forwarding) v Azure hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="9ca39-160">If hello IP address represents a VM, make sure you enable [IP forwarding](#IP-forwarding) in Azure for hello VM.</span></span> <span data-ttu-id="9ca39-161">Pokud hello IP adresa představuje hello interní IP adresy Vyrovnávání zatížení Azure, ujistěte se, že máte odpovídající pravidlo pro každý port Vyrovnávání zatížení chcete vyrovnávat tooload.</span><span class="sxs-lookup"><span data-stu-id="9ca39-161">If hello IP address represents hello internal IP address of Azure Load Balancer, make sure you have a matching load balancing rule for each port you wish tooload balance.</span></span>|

<span data-ttu-id="9ca39-162">V prostředí Azure PowerShell některé hodnoty "NextHopType" hello mají odlišné názvy:</span><span class="sxs-lookup"><span data-stu-id="9ca39-162">In Azure PowerShell some of hello "NextHopType" values have different names:</span></span>

* <span data-ttu-id="9ca39-163">Virtuální síť je VnetLocal</span><span class="sxs-lookup"><span data-stu-id="9ca39-163">Virtual Network is VnetLocal</span></span>
* <span data-ttu-id="9ca39-164">Brána virtuální sítě je VirtualNetworkGateway</span><span class="sxs-lookup"><span data-stu-id="9ca39-164">Virtual Network Gateway is VirtualNetworkGateway</span></span>
* <span data-ttu-id="9ca39-165">Virtuální zařízení je VirtualAppliance</span><span class="sxs-lookup"><span data-stu-id="9ca39-165">Virtual Appliance is VirtualAppliance</span></span>
* <span data-ttu-id="9ca39-166">Internet je Internet</span><span class="sxs-lookup"><span data-stu-id="9ca39-166">Internet is Internet</span></span>
* <span data-ttu-id="9ca39-167">Žádný je žádný</span><span class="sxs-lookup"><span data-stu-id="9ca39-167">None is None</span></span>

### <a name="system-routes"></a><span data-ttu-id="9ca39-168">Systémové trasy</span><span class="sxs-lookup"><span data-stu-id="9ca39-168">System routes</span></span>
<span data-ttu-id="9ca39-169">Každá podsíť vytvořená ve virtuální síti se automaticky přidruží k směrovací tabulce, která obsahuje hello následující pravidla systémových tras:</span><span class="sxs-lookup"><span data-stu-id="9ca39-169">Every subnet created in a virtual network is automatically associated with a route table that contains hello following system route rules:</span></span>

* <span data-ttu-id="9ca39-170">**Pravidlo místní virtuální sítě:** Toto pravidlo se automaticky vytvoří pro každou podsíť ve virtuální síti.</span><span class="sxs-lookup"><span data-stu-id="9ca39-170">**Local Vnet Rule**: This rule is automatically created for every subnet in a virtual network.</span></span> <span data-ttu-id="9ca39-171">Určuje, že je přímé propojení mezi virtuálními počítači hello v hello virtuální sítě a neexistuje žádný zprostředkující další segment.</span><span class="sxs-lookup"><span data-stu-id="9ca39-171">It specifies that there is a direct link between hello VMs in hello VNet and there is no intermediate next hop.</span></span>
* <span data-ttu-id="9ca39-172">**Místní pravidlo**: Toto pravidlo platí tooall přenosy určené toohello rozsah adres pro místní a jako cíl dalšího segmentu hello používá bránu sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="9ca39-172">**On-premises Rule**: This rule applies tooall traffic destined toohello on-premises address range and uses VPN gateway as hello next hop destination.</span></span>
* <span data-ttu-id="9ca39-173">**Internetové pravidlo**: Toto pravidlo zpracovává všechny přenosy určené toohello veřejného Internetu (0.0.0.0/0 předpony adres) a internetovou bránu infrastruktury používá hello jako hello dalšího směrování pro všechny přenosy určené toohello Internetu.</span><span class="sxs-lookup"><span data-stu-id="9ca39-173">**Internet Rule**: This rule handles all traffic destined toohello public Internet (address prefix 0.0.0.0/0) and uses hello infrastructure internet gateway as hello next hop for all traffic destined toohello Internet.</span></span>

### <a name="user-defined-routes"></a><span data-ttu-id="9ca39-174">Trasy definované uživatelem</span><span class="sxs-lookup"><span data-stu-id="9ca39-174">User-defined routes</span></span>
<span data-ttu-id="9ca39-175">Pro většinu prostředí potřebujete jenom systémové trasy hello už v Azure definované.</span><span class="sxs-lookup"><span data-stu-id="9ca39-175">For most environments you will only need hello system routes already defined by Azure.</span></span> <span data-ttu-id="9ca39-176">Můžete však nutné toocreate směrovací tabulku a přidejte jeden nebo více trasy v určitých případech, například:</span><span class="sxs-lookup"><span data-stu-id="9ca39-176">However, you may need toocreate a route table and add one or more routes in specific cases, such as:</span></span>

* <span data-ttu-id="9ca39-177">Vynucené tunelování toohello Internetu prostřednictvím místní sítě.</span><span class="sxs-lookup"><span data-stu-id="9ca39-177">Force tunneling toohello Internet via your on-premises network.</span></span>
* <span data-ttu-id="9ca39-178">Použití virtuálních zařízení v prostředí Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-178">Use of virtual appliances in your Azure environment.</span></span>

<span data-ttu-id="9ca39-179">Ve scénářích hello výše bude mít toocreate směrovací tabulku a přidat tooit trasy definované uživatelem.</span><span class="sxs-lookup"><span data-stu-id="9ca39-179">In hello scenarios above, you will have toocreate a route table and add user defined routes tooit.</span></span> <span data-ttu-id="9ca39-180">Můžete mít víc směrovacích tabulek a hello stejná směrovací tabulka může být přidružené tooone nebo další podsítě.</span><span class="sxs-lookup"><span data-stu-id="9ca39-180">You can have multiple route tables, and hello same route table can be associated tooone or more subnets.</span></span> <span data-ttu-id="9ca39-181">A každou podsíť může být přidružené tooa jedné směrovací tabulce.</span><span class="sxs-lookup"><span data-stu-id="9ca39-181">And each subnet can only be associated tooa single route table.</span></span> <span data-ttu-id="9ca39-182">Všechny virtuální počítače a cloudové služby v podsíti, použijte hello trasy tabulku asociovanou toothat podsíť.</span><span class="sxs-lookup"><span data-stu-id="9ca39-182">All VMs and cloud services in a subnet use hello route table associated toothat subnet.</span></span>

<span data-ttu-id="9ca39-183">Podsítě spoléhají na systémové trasy, dokud směrovací tabulka je přidružené toohello podsítě.</span><span class="sxs-lookup"><span data-stu-id="9ca39-183">Subnets rely on system routes until a route table is associated toohello subnet.</span></span> <span data-ttu-id="9ca39-184">Jakmile existuje přidružení, směrování se provádí na základě nejdelší shody předpony (LPM) jak mezi trasami definovanými uživateli, tak mezi systémovými trasami.</span><span class="sxs-lookup"><span data-stu-id="9ca39-184">Once an association exists, routing is done based on Longest Prefix Match (LPM) among both user defined routes and system routes.</span></span> <span data-ttu-id="9ca39-185">Pokud existuje víc tras s hello stejné LPM odpovídat pak trasa se vybere na základě původu v hello následující pořadí:</span><span class="sxs-lookup"><span data-stu-id="9ca39-185">If there is more than one route with hello same LPM match then a route is selected based on its origin in hello following order:</span></span>

1. <span data-ttu-id="9ca39-186">Trasa definovaná uživatelem</span><span class="sxs-lookup"><span data-stu-id="9ca39-186">User defined route</span></span>
2. <span data-ttu-id="9ca39-187">Trasa protokolu BGP (pokud se používá služba ExpressRoute)</span><span class="sxs-lookup"><span data-stu-id="9ca39-187">BGP route (when ExpressRoute is used)</span></span>
3. <span data-ttu-id="9ca39-188">Systémová trasa</span><span class="sxs-lookup"><span data-stu-id="9ca39-188">System route</span></span>

<span data-ttu-id="9ca39-189">toolearn způsobu toocreate uživatelem definované trasy, najdete v [jak tooCreate tras a povolení předávání IP v Azure](virtual-network-create-udr-arm-template.md).</span><span class="sxs-lookup"><span data-stu-id="9ca39-189">toolearn how toocreate user defined routes, see [How tooCreate Routes and Enable IP Forwarding in Azure](virtual-network-create-udr-arm-template.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9ca39-190">Trasy definované uživatelem jsou pouze použité tooAzure virtuální počítače a cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="9ca39-190">User defined routes are only applied tooAzure VMs and cloud services.</span></span> <span data-ttu-id="9ca39-191">Například pokud chcete, aby tooadd virtuální zařízení brány firewall mezi místní sítí a Azure, budete mít toocreate trasu definovanou uživatelem pro směrovací tabulky Azure, který předává veškerý provoz směřující toohello místní adresu místa toohello virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="9ca39-191">For instance, if you want tooadd a firewall virtual appliance between your on-premises network and Azure, you will have toocreate a user defined route for your Azure route tables that forwards all traffic going toohello on-premises address space toohello virtual appliance.</span></span> <span data-ttu-id="9ca39-192">Můžete také přidat, že uživatel definované trasy (UDR) toohello GatewaySubnet tooforward veškerý provoz z místní tooAzure prostřednictvím hello virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="9ca39-192">You can also add a user defined route (UDR) toohello GatewaySubnet tooforward all traffic from on-premises tooAzure through hello virtual appliance.</span></span> <span data-ttu-id="9ca39-193">Toto je nedávný dodatek.</span><span class="sxs-lookup"><span data-stu-id="9ca39-193">This is a recent addition.</span></span>
> 
> 

### <a name="bgp-routes"></a><span data-ttu-id="9ca39-194">Trasy protokolu BGP</span><span class="sxs-lookup"><span data-stu-id="9ca39-194">BGP routes</span></span>
<span data-ttu-id="9ca39-195">Pokud máte spojení ExpressRoute mezi místní sítí a Azure, můžete povolit toopropagate trasy protokolu BGP z vaší místní síti tooAzure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-195">If you have an ExpressRoute connection between your on-premises network and Azure, you can enable BGP toopropagate routes from your on-premises network tooAzure.</span></span> <span data-ttu-id="9ca39-196">Tyto trasy protokolu BGP se používají v hello stejným způsobem jako systémové trasy a uživatel trasy definované v jednotlivých podsítích Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-196">These BGP routes are used in hello same way as system routes and user defined routes in each Azure subnet.</span></span> <span data-ttu-id="9ca39-197">Další informace najdete v tématu [Úvod do služby ExpressRoute](../expressroute/expressroute-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="9ca39-197">For more information see [ExpressRoute Introduction](../expressroute/expressroute-introduction.md).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="9ca39-198">Můžete nakonfigurovat vaše prostředí Azure toouse vynucené tunelování prostřednictvím místní sítě tak, že vytvoříte trasu definovanou uživatelem pro podsíť 0.0.0.0/0, který používá bránu sítě VPN hello jako další segment hello.</span><span class="sxs-lookup"><span data-stu-id="9ca39-198">You can configure your Azure environment toouse force tunneling through your on-premises network by creating a user defined route for subnet 0.0.0.0/0 that uses hello VPN gateway as hello next hop.</span></span> <span data-ttu-id="9ca39-199">To ale funguje jenom v případě, že používáte bránu sítě VPN, nikoli službu ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="9ca39-199">However, this only works if you are using a VPN gateway, not ExpressRoute.</span></span> <span data-ttu-id="9ca39-200">U služby ExpressRoute se vynucené tunelování konfiguruje prostřednictvím BGP.</span><span class="sxs-lookup"><span data-stu-id="9ca39-200">For ExpressRoute, forced tunneling is configured through BGP.</span></span>
> 
> 

## <a name="ip-forwarding"></a><span data-ttu-id="9ca39-201">Předávání IP</span><span class="sxs-lookup"><span data-stu-id="9ca39-201">IP forwarding</span></span>
<span data-ttu-id="9ca39-202">Jak je popsáno výše, jedním z hlavních důvodů toocreate hello trasu definovanou uživatelem je tooforward provoz tooa virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="9ca39-202">As described above, one of hello main reasons toocreate a user defined route is tooforward traffic tooa virtual appliance.</span></span> <span data-ttu-id="9ca39-203">Virtuální zařízení není nic jiného než virtuální počítač, který běží aplikace používá toohandle síťový provoz nějakým způsobem, jako je například Brána firewall nebo zařízením NAT.</span><span class="sxs-lookup"><span data-stu-id="9ca39-203">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="9ca39-204">Tato virtuální zařízení, virtuálních počítačů musí být schopný tooreceive příchozí provoz, který nebyly upraveny tooitself.</span><span class="sxs-lookup"><span data-stu-id="9ca39-204">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="9ca39-205">tooallow přenosy virtuálních počítačů tooreceive řešit tooother cíle, je nutné povolit předávání IP adres pro hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="9ca39-205">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="9ca39-206">Toto je nastavení, nikoli nastavení hello hostovaného operačního systému Azure.</span><span class="sxs-lookup"><span data-stu-id="9ca39-206">This is an Azure setting, not a setting in hello guest operating system.</span></span>

## <a name="next-steps"></a><span data-ttu-id="9ca39-207">Další kroky</span><span class="sxs-lookup"><span data-stu-id="9ca39-207">Next steps</span></span>
* <span data-ttu-id="9ca39-208">Zjistěte, jak příliš[vytvářet trasy v modelu nasazení Resource Manager hello](virtual-network-create-udr-arm-template.md) a přidružovat je toosubnets.</span><span class="sxs-lookup"><span data-stu-id="9ca39-208">Learn how too[create routes in hello Resource Manager deployment model](virtual-network-create-udr-arm-template.md) and associate them toosubnets.</span></span> 
* <span data-ttu-id="9ca39-209">Zjistěte, jak příliš[vytvářet trasy v modelu nasazení classic hello](virtual-network-create-udr-classic-ps.md) a přidružovat je toosubnets.</span><span class="sxs-lookup"><span data-stu-id="9ca39-209">Learn how too[create routes in hello classic deployment model](virtual-network-create-udr-classic-ps.md) and associate them toosubnets.</span></span>


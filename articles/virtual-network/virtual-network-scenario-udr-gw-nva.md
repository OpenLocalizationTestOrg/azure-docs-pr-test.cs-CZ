---
title: "aaaHybrid připojení k aplikaci na vrstvě 2 | Microsoft Docs"
description: "Zjistěte, jak toodeploy virtuální zařízení a UDR toocreate prostředí vícevrstvé aplikace v Azure"
services: virtual-network
documentationcenter: na
author: jimdial
manager: carmonm
editor: tysonn
ms.assetid: 1f509bec-bdd1-470d-8aa4-3cf2bb7f6134
ms.service: virtual-network
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 05/05/2016
ms.author: jdial
ms.openlocfilehash: 53599862289dbf9c6ab3289b0cb8dda6430f20f7
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="virtual-appliance-scenario"></a><span data-ttu-id="eb077-103">Scénář virtuální zařízení</span><span class="sxs-lookup"><span data-stu-id="eb077-103">Virtual appliance scenario</span></span>
<span data-ttu-id="eb077-104">Běžný scénář mezi větší Azure zákazníků je nutné tooprovide hello Dvojúrovňová aplikaci vystavenou toohello Internetu, současně back úroveň přístupu můžete toohello z překážek místní datacentra.</span><span class="sxs-lookup"><span data-stu-id="eb077-104">A common scenario among larger Azure customer is hello need tooprovide a two-tiered application exposed toohello Internet, while allowing access toohello back tier from an on-premises datacenter.</span></span> <span data-ttu-id="eb077-105">Tento dokument vás provede procesem scénář používající uživatele definované trasy (UDR), brána sítě VPN a toodeploy virtuální zařízení sítě dvouvrstvé prostředí, které splňuje hello následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="eb077-105">This document will walk you through a scenario using User Defined Routes (UDR), a VPN Gateway, and network virtual appliances toodeploy a two-tier environment that meets hello following requirements:</span></span>

* <span data-ttu-id="eb077-106">Webové aplikace musí být dostupný z hello pouze veřejného Internetu.</span><span class="sxs-lookup"><span data-stu-id="eb077-106">Web application must be accessible from hello public Internet only.</span></span>
* <span data-ttu-id="eb077-107">Webové aplikace hello hostitelský server musí být schopný tooaccess aplikační server back-end.</span><span class="sxs-lookup"><span data-stu-id="eb077-107">Web server hosting hello application must be able tooaccess a backend application server.</span></span>
* <span data-ttu-id="eb077-108">Všechny přenosy z Internetu toohello webové aplikace hello musí projít virtuální zařízení brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-108">All traffic from hello Internet toohello web application must go through a firewall virtual appliance.</span></span> <span data-ttu-id="eb077-109">Tato virtuální zařízení se použije pro jenom přenosy z Internetu.</span><span class="sxs-lookup"><span data-stu-id="eb077-109">This virtual appliance will be used for Internet traffic only.</span></span>
* <span data-ttu-id="eb077-110">Veškerý provoz směřující toohello aplikační server musí projít virtuální zařízení brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-110">All traffic going toohello application server must go through a firewall virtual appliance.</span></span> <span data-ttu-id="eb077-111">Tato virtuální zařízení se použije pro přístup toohello back-end end serverů a přístup brzo z hello do místní sítě prostřednictvím brány VPN.</span><span class="sxs-lookup"><span data-stu-id="eb077-111">This virtual appliance will be used for access toohello backend end server, and access coming in from hello on-premises network via a VPN Gateway.</span></span>
* <span data-ttu-id="eb077-112">Správci musí být schopný toomanage hello brány firewall virtuální zařízení ze své místní počítače, pomocí brány firewall třetí virtuální zařízení používané výhradně pro účely správy.</span><span class="sxs-lookup"><span data-stu-id="eb077-112">Administrators must be able toomanage hello firewall virtual appliances from their on-premises computers, by using a third firewall virtual appliance used exclusively for management purposes.</span></span>

<span data-ttu-id="eb077-113">Toto je standardní scénář DMZ s DMZ a chráněné síti.</span><span class="sxs-lookup"><span data-stu-id="eb077-113">This is a standard DMZ scenario with a DMZ and a protected network.</span></span> <span data-ttu-id="eb077-114">Takový scénář lze sestavit v Azure pomocí skupin Nsg, virtuální zařízení brány firewall nebo jejich kombinaci.</span><span class="sxs-lookup"><span data-stu-id="eb077-114">Such scenario can be constructed in Azure by using NSGs, firewall virtual appliances, or a combination of both.</span></span> <span data-ttu-id="eb077-115">Hello tabulce jsou uvedeny některé hello výhody a nevýhody mezi skupiny Nsg a virtuální zařízení brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-115">hello table below shows some of hello pros and cons between NSGs and firewall virtual appliances.</span></span>

|  | <span data-ttu-id="eb077-116">Odborníci na</span><span class="sxs-lookup"><span data-stu-id="eb077-116">Pros</span></span> | <span data-ttu-id="eb077-117">Nevýhody</span><span class="sxs-lookup"><span data-stu-id="eb077-117">Cons</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-118">SKUPINA NSG</span><span class="sxs-lookup"><span data-stu-id="eb077-118">NSG</span></span> |<span data-ttu-id="eb077-119">Bez nákladů.</span><span class="sxs-lookup"><span data-stu-id="eb077-119">No cost.</span></span> <br/><span data-ttu-id="eb077-120">Integrovaná do Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="eb077-120">Integrated into Azure RBAC.</span></span> <br/><span data-ttu-id="eb077-121">Pravidla je možné vytvořit v šablony ARM.</span><span class="sxs-lookup"><span data-stu-id="eb077-121">Rules can be created in ARM templates.</span></span> |<span data-ttu-id="eb077-122">Složitost může lišit v prostředích větší.</span><span class="sxs-lookup"><span data-stu-id="eb077-122">Complexity could vary in larger environments.</span></span> |
| <span data-ttu-id="eb077-123">Brána firewall</span><span class="sxs-lookup"><span data-stu-id="eb077-123">Firewall</span></span> |<span data-ttu-id="eb077-124">Plnou kontrolu nad rovinu data.</span><span class="sxs-lookup"><span data-stu-id="eb077-124">Full control over data plane.</span></span> <br/><span data-ttu-id="eb077-125">Centrální správa prostřednictvím konzoly brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-125">Central management through firewall console.</span></span> |<span data-ttu-id="eb077-126">Náklady na zařízení brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-126">Cost of firewall appliance.</span></span> <br/><span data-ttu-id="eb077-127">Není integrované s Azure RBAC.</span><span class="sxs-lookup"><span data-stu-id="eb077-127">Not integrated with Azure RBAC.</span></span> |

<span data-ttu-id="eb077-128">řešení Hello níže používá tooimplement virtuální zařízení brány firewall scénáři hraniční sítě nebo chráněné sítě.</span><span class="sxs-lookup"><span data-stu-id="eb077-128">hello solution below uses firewall virtual appliances tooimplement a DMZ/protected network scenario.</span></span>

## <a name="considerations"></a><span data-ttu-id="eb077-129">Požadavky</span><span class="sxs-lookup"><span data-stu-id="eb077-129">Considerations</span></span>
<span data-ttu-id="eb077-130">Můžete nasadit hello prostředí popsané výše v Azure pomocí různých funkcí, které jsou k dispozici dnes, a to takto.</span><span class="sxs-lookup"><span data-stu-id="eb077-130">You can deploy hello environment explained above in Azure using different features available today, as follows.</span></span>

* <span data-ttu-id="eb077-131">**Virtuální síť (VNet)**.</span><span class="sxs-lookup"><span data-stu-id="eb077-131">**Virtual network (VNet)**.</span></span> <span data-ttu-id="eb077-132">O virtuální síť Azure funguje v podobným způsobem tooan do místní sítě a mohou být segmentovány na jeden nebo více podsítí izolace provozu tooprovide a oddělené oblasti zájmu.</span><span class="sxs-lookup"><span data-stu-id="eb077-132">An Azure VNet acts in similar fashion tooan on-premises network, and can be segmented into one or more subnets tooprovide traffic isolation, and separation of concerns.</span></span>
* <span data-ttu-id="eb077-133">**Virtuální zařízení**.</span><span class="sxs-lookup"><span data-stu-id="eb077-133">**Virtual appliance**.</span></span> <span data-ttu-id="eb077-134">Několik partneři poskytovat virtuálních zařízení v Azure Marketplace, které je možné pro tři výše popsané brány firewall v hello hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-134">Several partners provide virtual appliances in hello Azure Marketplace that can be used for hello three firewalls described above.</span></span> 
* <span data-ttu-id="eb077-135">**Uživatelem definované trasy (UDR)**.</span><span class="sxs-lookup"><span data-stu-id="eb077-135">**User Defined Routes (UDR)**.</span></span> <span data-ttu-id="eb077-136">Směrovací tabulky mohou obsahovat udr používá Azure sítě toocontrol hello toku paketů v rámci virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="eb077-136">Route tables can contain UDRs used by Azure networking toocontrol hello flow of packets within a VNet.</span></span> <span data-ttu-id="eb077-137">Tyto směrovací tabulky může být použité toosubnets.</span><span class="sxs-lookup"><span data-stu-id="eb077-137">These route tables can be applied toosubnets.</span></span> <span data-ttu-id="eb077-138">Jedna z funkcí nejnovější hello v Azure je hello možnost tooapply toohello tabulky trasy GatewaySubnet, poskytuje možnost tooforward hello veškerý provoz přicházející do hello virtuální síť Azure ze virtuální zařízení tooa hybridní připojení.</span><span class="sxs-lookup"><span data-stu-id="eb077-138">One of hello newest features in Azure is hello ability tooapply a route table toohello GatewaySubnet, providing hello ability tooforward all traffic coming into hello Azure VNet from a hybrid connection tooa virtual appliance.</span></span>
* <span data-ttu-id="eb077-139">**Předávání IP**.</span><span class="sxs-lookup"><span data-stu-id="eb077-139">**IP Forwarding**.</span></span> <span data-ttu-id="eb077-140">Ve výchozím nastavení hello Azure sítě modul předávání paketů toovirtual karty síťového rozhraní (NIC) pouze v případě, že hello paketu cílová IP adresa odpovídá hello seskupování IP adresu.</span><span class="sxs-lookup"><span data-stu-id="eb077-140">By default, hello Azure networking engine forward packets toovirtual network interface cards (NICs) only if hello packet destination IP address matches hello NIC IP address.</span></span> <span data-ttu-id="eb077-141">Proto pokud UDR definuje, musí se poslat paket tooa zadané virtuální zařízení, hello Azure sítě modul by vyřadit paketu.</span><span class="sxs-lookup"><span data-stu-id="eb077-141">Therefore, if a UDR defines that a packet must be sent tooa given virtual appliance, hello Azure networking engine would drop that packet.</span></span> <span data-ttu-id="eb077-142">paket hello tooensure se doručí tooa virtuálního počítače (v tomto případě virtuální zařízení), který není hello skutečné cíl pro hello paketů, musíte tooenable předávání IP adres pro virtuální zařízení hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-142">tooensure hello packet is delivered tooa VM (in this case a virtual appliance) that is not hello actual destination for hello packet, you need tooenable IP Forwarding for hello virtual appliance.</span></span>
* <span data-ttu-id="eb077-143">**Skupin zabezpečení (Nsg) sítě**.</span><span class="sxs-lookup"><span data-stu-id="eb077-143">**Network Security Groups (NSGs)**.</span></span> <span data-ttu-id="eb077-144">Následující příklad Hello není nutné používat skupiny Nsg, ale můžete použít skupiny Nsg použije toohello podsítí a síťových karet v toto řešení toofurther filtrovat hello provoz do/z těchto podsítí a síťových karet.</span><span class="sxs-lookup"><span data-stu-id="eb077-144">hello example below does not make use of NSGs, but you could use NSGs applied toohello subnets and/or NICs in this solution toofurther filter hello traffic in and out of those subnets and NICs.</span></span>

![Připojení pomocí protokolu IPv6](./media/virtual-network-scenario-udr-gw-nva/figure01.png)

<span data-ttu-id="eb077-146">V tomto příkladu je předplatné, které obsahuje hello následující:</span><span class="sxs-lookup"><span data-stu-id="eb077-146">In this example there is a subscription that contains hello following:</span></span>

* <span data-ttu-id="eb077-147">2 skupin prostředků, není vidět v diagramu hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-147">2 resource groups, not shown in hello diagram.</span></span> 
  * <span data-ttu-id="eb077-148">**ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="eb077-148">**ONPREMRG**.</span></span> <span data-ttu-id="eb077-149">Obsahuje všechny prostředky potřebné toosimulate do místní sítě.</span><span class="sxs-lookup"><span data-stu-id="eb077-149">Contains all resources necessary toosimulate an on-premises network.</span></span>
  * <span data-ttu-id="eb077-150">**AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="eb077-150">**AZURERG**.</span></span> <span data-ttu-id="eb077-151">Obsahuje všechny prostředky potřebné pro prostředí hello virtuální síť Azure.</span><span class="sxs-lookup"><span data-stu-id="eb077-151">Contains all resources necessary for hello Azure virtual network environment.</span></span> 
* <span data-ttu-id="eb077-152">Virtuální síť s názvem **onpremvnet** používá toomimic datacentrum místní segmentované, jak je uvedeno dále.</span><span class="sxs-lookup"><span data-stu-id="eb077-152">A VNet named **onpremvnet** used toomimic an on-premises datacenter segmented as listed below.</span></span>
  * <span data-ttu-id="eb077-153">**onpremsn1**.</span><span class="sxs-lookup"><span data-stu-id="eb077-153">**onpremsn1**.</span></span> <span data-ttu-id="eb077-154">Podsíť obsahující virtuálního počítače (VM) se systémem Ubuntu toomimic na místním serveru.</span><span class="sxs-lookup"><span data-stu-id="eb077-154">Subnet containing a virtual machine (VM) running Ubuntu toomimic an on-premises server.</span></span>
  * <span data-ttu-id="eb077-155">**onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-155">**onpremsn2**.</span></span> <span data-ttu-id="eb077-156">Podsíť obsahující virtuálního počítače s Ubuntu toomimic místním počítači použít správce.</span><span class="sxs-lookup"><span data-stu-id="eb077-156">Subnet containing a VM running Ubuntu toomimic an on-premises computer used by an administrator.</span></span>
* <span data-ttu-id="eb077-157">Neexistuje jeden virtuální zařízení brány firewall s názvem **OPFW** na **onpremvnet** toomaintain tunel používá příliš**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="eb077-157">There is one firewall virtual appliance named **OPFW** on **onpremvnet** used toomaintain a tunnel too**azurevnet**.</span></span>
* <span data-ttu-id="eb077-158">Virtuální síť s názvem **azurevnet** segmentované, jak je uvedeno dále.</span><span class="sxs-lookup"><span data-stu-id="eb077-158">A VNet named **azurevnet** segmented as listed below.</span></span>
  * <span data-ttu-id="eb077-159">**azsn1**.</span><span class="sxs-lookup"><span data-stu-id="eb077-159">**azsn1**.</span></span> <span data-ttu-id="eb077-160">Externí brány firewall podsítě používané výhradně pro externí brány firewall hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-160">External firewall subnet used exclusively for hello external firewall.</span></span> <span data-ttu-id="eb077-161">Všechny přenosy z Internetu se mají prostřednictvím této podsíti.</span><span class="sxs-lookup"><span data-stu-id="eb077-161">All Internet traffic will come in through this subnet.</span></span> <span data-ttu-id="eb077-162">Tato podsíť obsahuje jenom síťový adaptér propojené toohello externí brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-162">This subnet only contains a NIC linked toohello external firewall.</span></span>
  * <span data-ttu-id="eb077-163">**azsn2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-163">**azsn2**.</span></span> <span data-ttu-id="eb077-164">Virtuální počítač spuštěn jako webový server, který bude přístupná z Internetu hello hostování podsítě front end.</span><span class="sxs-lookup"><span data-stu-id="eb077-164">Front end subnet hosting a VM running as a web server that will be accessed from hello Internet.</span></span>
  * <span data-ttu-id="eb077-165">**azsn3**.</span><span class="sxs-lookup"><span data-stu-id="eb077-165">**azsn3**.</span></span> <span data-ttu-id="eb077-166">Back-end podsítě, který je hostitelem virtuálního počítače s back-end serveru aplikace, kterou budou přistupovat hello front-end webový server.</span><span class="sxs-lookup"><span data-stu-id="eb077-166">Backend subnet hosting a VM running a backend application server that will be accessed by hello front end web server.</span></span>
  * <span data-ttu-id="eb077-167">**azsn4**.</span><span class="sxs-lookup"><span data-stu-id="eb077-167">**azsn4**.</span></span> <span data-ttu-id="eb077-168">Používá správu podsíť výhradně tooprovide správy přístupu tooall brány firewall virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="eb077-168">Management subnet used exclusively tooprovide management access tooall firewall virtual appliances.</span></span> <span data-ttu-id="eb077-169">Tato podsíť obsahuje jenom síťovou kartu pro každý virtuální zařízení brány firewall použité v řešení hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-169">This subnet only contains a NIC for each firewall virtual appliance used in hello solution.</span></span>
  * <span data-ttu-id="eb077-170">**GatewaySubnet**.</span><span class="sxs-lookup"><span data-stu-id="eb077-170">**GatewaySubnet**.</span></span> <span data-ttu-id="eb077-171">Azure hybridní připojení podsíť požadované pro ExpressRoute a VPN Gateway tooprovide připojení mezi virtuálními sítěmi Azure a další sítě.</span><span class="sxs-lookup"><span data-stu-id="eb077-171">Azure hybrid connection subnet required for ExpressRoute and VPN Gateway tooprovide connectivity between Azure VNets and other networks.</span></span> 
* <span data-ttu-id="eb077-172">Existují 3 virtuálních zařízení brány firewall v hello **azurevnet** sítě.</span><span class="sxs-lookup"><span data-stu-id="eb077-172">There are 3 firewall virtual appliances in hello **azurevnet** network.</span></span> 
  * <span data-ttu-id="eb077-173">**AZF1**.</span><span class="sxs-lookup"><span data-stu-id="eb077-173">**AZF1**.</span></span> <span data-ttu-id="eb077-174">Externí brány firewall zveřejněné toohello veřejného Internetu pomocí prostředek veřejné IP adresy v Azure.</span><span class="sxs-lookup"><span data-stu-id="eb077-174">External firewall exposed toohello public Internet by using a public IP address resource in Azure.</span></span> <span data-ttu-id="eb077-175">Je nutné tooensure máte šablonu z hello Marketplace nebo přímo ze svého zařízení dodavatele, že zřizuje o 3-NIC virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="eb077-175">You need tooensure you have a template from hello Marketplace, or directly from your appliance vendor, that provisions a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="eb077-176">**AZF2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-176">**AZF2**.</span></span> <span data-ttu-id="eb077-177">Vnitřní brána firewall používá toocontrol provoz mezi **azsn2** a **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="eb077-177">Internal firewall used toocontrol traffic between **azsn2** and **azsn3**.</span></span> <span data-ttu-id="eb077-178">Toto je také 3-NIC virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="eb077-178">This is also a 3-NIC virtual appliance.</span></span>
  * <span data-ttu-id="eb077-179">**AZF3**.</span><span class="sxs-lookup"><span data-stu-id="eb077-179">**AZF3**.</span></span> <span data-ttu-id="eb077-180">Správa brány firewall přístupný tooadministrators z hello místního datového centra a používá podsíť správu připojené tooa toomanage všech zařízení brány firewall.</span><span class="sxs-lookup"><span data-stu-id="eb077-180">Management firewall accessible tooadministrators from hello on-premises datacenter, and connected tooa management subnet used toomanage all firewall appliances.</span></span> <span data-ttu-id="eb077-181">Můžete najít 2-NIC šablony virtuální zařízení v hello Marketplace, nebo požádejte jeden přímo od dodavatele zařízení.</span><span class="sxs-lookup"><span data-stu-id="eb077-181">You can find 2-NIC virtual appliance templates in hello Marketplace, or request one directly from your appliance vendor.</span></span>

## <a name="user-defined-routing-udr"></a><span data-ttu-id="eb077-182">Uživatelem definované směrování (UDR)</span><span class="sxs-lookup"><span data-stu-id="eb077-182">User Defined Routing (UDR)</span></span>
<span data-ttu-id="eb077-183">Každá podsíť v Azure může být propojené tooa UDR tabulka použitá toodefine, jak se směruje provoz v této podsíti inicioval.</span><span class="sxs-lookup"><span data-stu-id="eb077-183">Each subnet in Azure can be linked tooa UDR table used toodefine how traffic initiated in that subnet is routed.</span></span> <span data-ttu-id="eb077-184">Pokud jsou definovány žádné udr, Azure používá výchozí trasy tooallow provoz tooflow z jedné podsítě tooanother.</span><span class="sxs-lookup"><span data-stu-id="eb077-184">If no UDRs are defined, Azure uses default routes tooallow traffic tooflow from one subnet tooanother.</span></span> <span data-ttu-id="eb077-185">toobetter pochopit udr, navštivte [co jsou trasy definované uživatelem a předávání IP](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="eb077-185">toobetter understand UDRs, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="eb077-186">tooensure komunikace probíhá prostřednictvím zařízení brány firewall správné hello, založené na hello poslední požadavek výše, budete potřebovat následující hello toocreate směrovací tabulka obsahující udr v **azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="eb077-186">tooensure communication is done through hello right firewall appliance, based on hello last requirement above, you need toocreate hello following route table containing UDRs in **azurevnet**.</span></span>

### <a name="azgwudr"></a><span data-ttu-id="eb077-187">azgwudr</span><span class="sxs-lookup"><span data-stu-id="eb077-187">azgwudr</span></span>
<span data-ttu-id="eb077-188">V tomto scénáři hello provoz z místní tooAzure se brány firewall hello použité toomanage připojením příliš pouze**AZF3**, a že komunikace musí procházet přes hello interní brány firewall, **AZF2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-188">In this scenario, hello only traffic flowing from on-premises tooAzure will be used toomanage hello firewalls by connecting too**AZF3**, and that traffic must go through hello internal firewall, **AZF2**.</span></span> <span data-ttu-id="eb077-189">Proto je nutné v hello pouze jeden postup **GatewaySubnet** jak je uvedeno níže.</span><span class="sxs-lookup"><span data-stu-id="eb077-189">Therefore, only one route is necessary in hello **GatewaySubnet** as shown below.</span></span>

| <span data-ttu-id="eb077-190">Cíl</span><span class="sxs-lookup"><span data-stu-id="eb077-190">Destination</span></span> | <span data-ttu-id="eb077-191">Další směrování</span><span class="sxs-lookup"><span data-stu-id="eb077-191">Next hop</span></span> | <span data-ttu-id="eb077-192">Vysvětlení</span><span class="sxs-lookup"><span data-stu-id="eb077-192">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-193">10.0.4.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-193">10.0.4.0/24</span></span> |<span data-ttu-id="eb077-194">10.0.3.11</span><span class="sxs-lookup"><span data-stu-id="eb077-194">10.0.3.11</span></span> |<span data-ttu-id="eb077-195">Umožňuje místní brány firewall správy tooreach provoz **AZF3**</span><span class="sxs-lookup"><span data-stu-id="eb077-195">Allows on-premises traffic tooreach management firewall **AZF3**</span></span> |

### <a name="azsn2udr"></a><span data-ttu-id="eb077-196">azsn2udr</span><span class="sxs-lookup"><span data-stu-id="eb077-196">azsn2udr</span></span>
| <span data-ttu-id="eb077-197">Cíl</span><span class="sxs-lookup"><span data-stu-id="eb077-197">Destination</span></span> | <span data-ttu-id="eb077-198">Další směrování</span><span class="sxs-lookup"><span data-stu-id="eb077-198">Next hop</span></span> | <span data-ttu-id="eb077-199">Vysvětlení</span><span class="sxs-lookup"><span data-stu-id="eb077-199">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-200">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-200">10.0.3.0/24</span></span> |<span data-ttu-id="eb077-201">10.0.2.11</span><span class="sxs-lookup"><span data-stu-id="eb077-201">10.0.2.11</span></span> |<span data-ttu-id="eb077-202">Umožňuje podsíť back-end toohello provozu hostování hello aplikační server prostřednictvím **AZF2**</span><span class="sxs-lookup"><span data-stu-id="eb077-202">Allows traffic toohello backend subnet hosting hello application server through **AZF2**</span></span> |
| <span data-ttu-id="eb077-203">0.0.0.0/0</span><span class="sxs-lookup"><span data-stu-id="eb077-203">0.0.0.0/0</span></span> |<span data-ttu-id="eb077-204">10.0.2.10</span><span class="sxs-lookup"><span data-stu-id="eb077-204">10.0.2.10</span></span> |<span data-ttu-id="eb077-205">Umožňuje všechny toobe provoz směrován přes **AZF1**</span><span class="sxs-lookup"><span data-stu-id="eb077-205">Allows all other traffic toobe routed through **AZF1**</span></span> |

### <a name="azsn3udr"></a><span data-ttu-id="eb077-206">azsn3udr</span><span class="sxs-lookup"><span data-stu-id="eb077-206">azsn3udr</span></span>
| <span data-ttu-id="eb077-207">Cíl</span><span class="sxs-lookup"><span data-stu-id="eb077-207">Destination</span></span> | <span data-ttu-id="eb077-208">Další směrování</span><span class="sxs-lookup"><span data-stu-id="eb077-208">Next hop</span></span> | <span data-ttu-id="eb077-209">Vysvětlení</span><span class="sxs-lookup"><span data-stu-id="eb077-209">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-210">10.0.2.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-210">10.0.2.0/24</span></span> |<span data-ttu-id="eb077-211">10.0.3.10</span><span class="sxs-lookup"><span data-stu-id="eb077-211">10.0.3.10</span></span> |<span data-ttu-id="eb077-212">Umožňuje přenos příliš**azsn2** tooflow z aplikace server toohello webový server prostřednictvím **AZF2**</span><span class="sxs-lookup"><span data-stu-id="eb077-212">Allows traffic too**azsn2** tooflow from app server toohello webserver through **AZF2**</span></span> |

<span data-ttu-id="eb077-213">Musíte taky toocreate směrovací tabulky pro podsítě hello **onpremvnet** toomimic hello místního datového centra.</span><span class="sxs-lookup"><span data-stu-id="eb077-213">You also need toocreate route tables for hello subnets in **onpremvnet** toomimic hello on-premises datacenter.</span></span>

### <a name="onpremsn1udr"></a><span data-ttu-id="eb077-214">onpremsn1udr</span><span class="sxs-lookup"><span data-stu-id="eb077-214">onpremsn1udr</span></span>
| <span data-ttu-id="eb077-215">Cíl</span><span class="sxs-lookup"><span data-stu-id="eb077-215">Destination</span></span> | <span data-ttu-id="eb077-216">Další směrování</span><span class="sxs-lookup"><span data-stu-id="eb077-216">Next hop</span></span> | <span data-ttu-id="eb077-217">Vysvětlení</span><span class="sxs-lookup"><span data-stu-id="eb077-217">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-218">192.168.2.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-218">192.168.2.0/24</span></span> |<span data-ttu-id="eb077-219">192.168.1.4</span><span class="sxs-lookup"><span data-stu-id="eb077-219">192.168.1.4</span></span> |<span data-ttu-id="eb077-220">Umožňuje přenos příliš**onpremsn2** prostřednictvím **OPFW**</span><span class="sxs-lookup"><span data-stu-id="eb077-220">Allows traffic too**onpremsn2** through **OPFW**</span></span> |

### <a name="onpremsn2udr"></a><span data-ttu-id="eb077-221">onpremsn2udr</span><span class="sxs-lookup"><span data-stu-id="eb077-221">onpremsn2udr</span></span>
| <span data-ttu-id="eb077-222">Cíl</span><span class="sxs-lookup"><span data-stu-id="eb077-222">Destination</span></span> | <span data-ttu-id="eb077-223">Další směrování</span><span class="sxs-lookup"><span data-stu-id="eb077-223">Next hop</span></span> | <span data-ttu-id="eb077-224">Vysvětlení</span><span class="sxs-lookup"><span data-stu-id="eb077-224">Explanation</span></span> |
| --- | --- | --- |
| <span data-ttu-id="eb077-225">10.0.3.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-225">10.0.3.0/24</span></span> |<span data-ttu-id="eb077-226">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="eb077-226">192.168.2.4</span></span> |<span data-ttu-id="eb077-227">Umožňuje podsíť toohello zálohovaný provozu v Azure prostřednictvím **OPFW**</span><span class="sxs-lookup"><span data-stu-id="eb077-227">Allows traffic toohello backed subnet in Azure through **OPFW**</span></span> |
| <span data-ttu-id="eb077-228">192.168.1.0/24</span><span class="sxs-lookup"><span data-stu-id="eb077-228">192.168.1.0/24</span></span> |<span data-ttu-id="eb077-229">192.168.2.4</span><span class="sxs-lookup"><span data-stu-id="eb077-229">192.168.2.4</span></span> |<span data-ttu-id="eb077-230">Umožňuje přenos příliš**onpremsn1** prostřednictvím **OPFW**</span><span class="sxs-lookup"><span data-stu-id="eb077-230">Allows traffic too**onpremsn1** through **OPFW**</span></span> |

## <a name="ip-forwarding"></a><span data-ttu-id="eb077-231">Předávání IP</span><span class="sxs-lookup"><span data-stu-id="eb077-231">IP Forwarding</span></span>
<span data-ttu-id="eb077-232">UDR a předávání IP adres jsou funkce, které můžete použít v kombinaci tooallow virtuální zařízení toobe používá toocontrol přenosového toku ve službě Azure VNet.</span><span class="sxs-lookup"><span data-stu-id="eb077-232">UDR and IP Forwarding are features that you can use in combination tooallow virtual appliances toobe used toocontrol traffic flow in an Azure VNet.</span></span>  <span data-ttu-id="eb077-233">Virtuální zařízení není nic jiného než virtuální počítač, který běží aplikace používá toohandle síťový provoz nějakým způsobem, jako je například Brána firewall nebo zařízením NAT.</span><span class="sxs-lookup"><span data-stu-id="eb077-233">A virtual appliance is nothing more than a VM that runs an application used toohandle network traffic in some way, such as a firewall or a NAT device.</span></span>

<span data-ttu-id="eb077-234">Tato virtuální zařízení, virtuálních počítačů musí být schopný tooreceive příchozí provoz, který nebyly upraveny tooitself.</span><span class="sxs-lookup"><span data-stu-id="eb077-234">This virtual appliance VM must be able tooreceive incoming traffic that is not addressed tooitself.</span></span> <span data-ttu-id="eb077-235">tooallow přenosy virtuálních počítačů tooreceive řešit tooother cíle, je nutné povolit předávání IP adres pro hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="eb077-235">tooallow a VM tooreceive traffic addressed tooother destinations, you must enable IP Forwarding for hello VM.</span></span> <span data-ttu-id="eb077-236">Toto je nastavení, nikoli nastavení hello hostovaného operačního systému Azure.</span><span class="sxs-lookup"><span data-stu-id="eb077-236">This is an Azure setting, not a setting in hello guest operating system.</span></span> <span data-ttu-id="eb077-237">Vaše virtuální zařízení stále potřebám toorun některé typ toohandle aplikace hello příchozí provoz a přesměrovávala je správně.</span><span class="sxs-lookup"><span data-stu-id="eb077-237">Your virtual appliance still needs toorun some type of application toohandle hello incoming traffic, and route it appropriately.</span></span>

<span data-ttu-id="eb077-238">toolearn Další informace o předávání IP adres, navštivte [co jsou trasy definované uživatelem a předávání IP](virtual-networks-udr-overview.md#ip-forwarding).</span><span class="sxs-lookup"><span data-stu-id="eb077-238">toolearn more about IP Forwarding, visit [What are User Defined Routes and IP Forwarding](virtual-networks-udr-overview.md#ip-forwarding).</span></span>

<span data-ttu-id="eb077-239">Jako příklad Představte si, že máte hello po instalaci v Azure virtuální sítě:</span><span class="sxs-lookup"><span data-stu-id="eb077-239">As an example, imagine you have hello following setup in an Azure vnet:</span></span>

* <span data-ttu-id="eb077-240">Podsíť **onpremsn1** obsahuje virtuální počítač s názvem **onpremvm1**.</span><span class="sxs-lookup"><span data-stu-id="eb077-240">Subnet **onpremsn1** contains a VM named **onpremvm1**.</span></span>
* <span data-ttu-id="eb077-241">Podsíť **onpremsn2** obsahuje virtuální počítač s názvem **onpremvm2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-241">Subnet **onpremsn2** contains a VM named **onpremvm2**.</span></span>
* <span data-ttu-id="eb077-242">Virtuální zařízení s názvem **OPFW** je připojeno příliš**onpremsn1** a **onpremsn2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-242">A virtual appliance named **OPFW** is connected too**onpremsn1** and **onpremsn2**.</span></span>
* <span data-ttu-id="eb077-243">Trasy definované uživatelem propojené příliš**onpremsn1** Určuje, že všechny přenosy příliš**onpremsn2** , musí se poslat příliš**OPFW**.</span><span class="sxs-lookup"><span data-stu-id="eb077-243">A user defined route linked too**onpremsn1** specifies that all traffic too**onpremsn2** must be sent too**OPFW**.</span></span>

<span data-ttu-id="eb077-244">Na tento příkaz, pokud **onpremvm1** pokusí tooestablish připojení s **onpremvm2**, hello UDR se použije, a provoz se budou odesílat příliš**OPFW** jako další segment hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-244">At this point, if **onpremvm1** tries tooestablish a connection with **onpremvm2**, hello UDR will be used and traffic will be sent too**OPFW** as hello next hop.</span></span> <span data-ttu-id="eb077-245">Mějte na paměti, která hello skutečných paketech cílové nedojde ke změně, stále zobrazuje **onpremvm2** je cílový hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-245">Keep in mind that hello actual packet destination is not being changed, it still says **onpremvm2** is hello destination.</span></span> 

<span data-ttu-id="eb077-246">Bez povoleno pro předávání IP **OPFW**, hello Azure logic virtuální sítě budou vyřadit pakety hello, jelikož umožňuje pouze tooa toobe odeslat pakety virtuálních počítačů, pokud hello IP adresu Virtuálního počítače je hello cíl pro paket hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-246">Without IP Forwarding enabled for **OPFW**, hello Azure virtual networking logic will drop hello packets, since it only allows packets toobe sent tooa VM if hello VM’s IP address is hello destination for hello packet.</span></span>

<span data-ttu-id="eb077-247">S předávání IP adres předá hello virtuální síť Azure logic tooOPFW pakety hello, aniž byste museli měnit jeho původní cílovou adresu.</span><span class="sxs-lookup"><span data-stu-id="eb077-247">With IP Forwarding, hello Azure virtual network logic will forward hello packets tooOPFW, without changing its original destination address.</span></span> <span data-ttu-id="eb077-248">**OPFW** musí zpracování pakety hello a určit, jaké toodo s nimi.</span><span class="sxs-lookup"><span data-stu-id="eb077-248">**OPFW** must handle hello packets and determine what toodo with them.</span></span>

<span data-ttu-id="eb077-249">Pro scénář hello výše toowork, je nutné povolit předávání IP adres na hello síťových adaptérů pro **OPFW**, **AZF1**, **AZF2**, a **AZF3** , který se používá pro směrování (všechny síťové adaptéry s výjimkou hello ty, které jsou propojené toohello správu podsíť).</span><span class="sxs-lookup"><span data-stu-id="eb077-249">For hello scenario above toowork, you must enable IP Forwarding on hello NICs for **OPFW**, **AZF1**, **AZF2**, and **AZF3** that are used for routing (all NICs except hello ones linked toohello management subnet).</span></span> 

## <a name="firewall-rules"></a><span data-ttu-id="eb077-250">Pravidla brány firewall</span><span class="sxs-lookup"><span data-stu-id="eb077-250">Firewall Rules</span></span>
<span data-ttu-id="eb077-251">Jak je popsáno výše, předávání IP adres pouze zajistí, že jsou pakety odesílány toohello virtuální zařízení.</span><span class="sxs-lookup"><span data-stu-id="eb077-251">As described above, IP Forwarding only ensures packets are sent toohello virtual appliances.</span></span> <span data-ttu-id="eb077-252">Vaše zařízení pořád potřebuje toodecide co toodo se tyto pakety.</span><span class="sxs-lookup"><span data-stu-id="eb077-252">Your appliance still needs toodecide what toodo with those packets.</span></span> <span data-ttu-id="eb077-253">Ve scénáři hello výše budete potřebovat toocreate hello následující pravidla v svoje zařízení:</span><span class="sxs-lookup"><span data-stu-id="eb077-253">In hello scenario above, you will need toocreate hello following rules in your appliances:</span></span>

### <a name="opfw"></a><span data-ttu-id="eb077-254">OPFW</span><span class="sxs-lookup"><span data-stu-id="eb077-254">OPFW</span></span>
<span data-ttu-id="eb077-255">OPFW představuje místní zařízení se systémem obsahující hello následující pravidla:</span><span class="sxs-lookup"><span data-stu-id="eb077-255">OPFW represents an on-premises device containing hello following rules:</span></span>

* <span data-ttu-id="eb077-256">**Trasy**: všechny přenosy too10.0.0.0/16 (**azurevnet**) prostřednictvím tunelu, musí se poslat **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="eb077-256">**Route**: All traffic too10.0.0.0/16 (**azurevnet**) must be sent through tunnel **ONPREMAZURE**.</span></span>
* <span data-ttu-id="eb077-257">**Zásady**: Povolí všechny obousměrnou komunikaci mezi **port2** a **ONPREMAZURE**.</span><span class="sxs-lookup"><span data-stu-id="eb077-257">**Policy**: Allow all bidirectional traffic between **port2** and **ONPREMAZURE**.</span></span>

### <a name="azf1"></a><span data-ttu-id="eb077-258">AZF1</span><span class="sxs-lookup"><span data-stu-id="eb077-258">AZF1</span></span>
<span data-ttu-id="eb077-259">AZF1 představuje Azure virtuální zařízení obsahující hello následující pravidla:</span><span class="sxs-lookup"><span data-stu-id="eb077-259">AZF1 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="eb077-260">**Zásady**: Povolí všechny obousměrnou komunikaci mezi **port1** a **port2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-260">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

### <a name="azf2"></a><span data-ttu-id="eb077-261">AZF2</span><span class="sxs-lookup"><span data-stu-id="eb077-261">AZF2</span></span>
<span data-ttu-id="eb077-262">AZF2 představuje Azure virtuální zařízení obsahující hello následující pravidla:</span><span class="sxs-lookup"><span data-stu-id="eb077-262">AZF2 represents an Azure virtual appliance containing hello following rules:</span></span>

* <span data-ttu-id="eb077-263">**Trasy**: všechny přenosy too10.0.0.0/16 (**onpremvnet**), musí se poslat toohello služba Azure gateway IP adresa (např. 10.0.0.1) prostřednictvím **port1**.</span><span class="sxs-lookup"><span data-stu-id="eb077-263">**Route**: All traffic too10.0.0.0/16 (**onpremvnet**) must be sent toohello Azure gateway IP address (i.e. 10.0.0.1) through **port1**.</span></span>
* <span data-ttu-id="eb077-264">**Zásady**: Povolí všechny obousměrnou komunikaci mezi **port1** a **port2**.</span><span class="sxs-lookup"><span data-stu-id="eb077-264">**Policy**: Allow all bidirectional traffic between **port1** and **port2**.</span></span>

## <a name="network-security-groups-nsgs"></a><span data-ttu-id="eb077-265">Skupiny zabezpečení sítě (Nsg)</span><span class="sxs-lookup"><span data-stu-id="eb077-265">Network Security Groups (NSGs)</span></span>
<span data-ttu-id="eb077-266">V tomto scénáři nejsou používány skupiny Nsg.</span><span class="sxs-lookup"><span data-stu-id="eb077-266">In this scenario, NSGs are not being used.</span></span> <span data-ttu-id="eb077-267">Můžete však použít skupiny Nsg tooeach podsíť toorestrict příchozí a odchozí provoz.</span><span class="sxs-lookup"><span data-stu-id="eb077-267">However, you could apply NSGs tooeach subnet toorestrict incoming and outgoing traffic.</span></span> <span data-ttu-id="eb077-268">Může například použít následující pravidla NSG toohello externí FW podsíť hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-268">For instance, you could apply hello following NSG rules toohello external FW subnet.</span></span>

<span data-ttu-id="eb077-269">**Příchozí**</span><span class="sxs-lookup"><span data-stu-id="eb077-269">**Incoming**</span></span>

* <span data-ttu-id="eb077-270">Povolit všechny přenosy TCP z hello Internet tooport 80 na žádné virtuální počítače v podsíti hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-270">Allow all TCP traffic from hello Internet tooport 80 on any VM in hello subnet.</span></span>
* <span data-ttu-id="eb077-271">Odepřít všechny ostatní přenosy z Internetu hello.</span><span class="sxs-lookup"><span data-stu-id="eb077-271">Deny all other traffic from hello Internet.</span></span>

<span data-ttu-id="eb077-272">**Odchozí**</span><span class="sxs-lookup"><span data-stu-id="eb077-272">**Outgoing**</span></span>

* <span data-ttu-id="eb077-273">Odepřete všechny přenosy toohello Internetu.</span><span class="sxs-lookup"><span data-stu-id="eb077-273">Deny all traffic toohello Internet.</span></span>

## <a name="high-level-steps"></a><span data-ttu-id="eb077-274">Kroky vysoké úrovně</span><span class="sxs-lookup"><span data-stu-id="eb077-274">High level steps</span></span>
<span data-ttu-id="eb077-275">toodeploy tento scénář, pomocí následujících hello vysoké úrovně kroků.</span><span class="sxs-lookup"><span data-stu-id="eb077-275">toodeploy this scenario, follow hello high level steps below.</span></span>

1. <span data-ttu-id="eb077-276">Přihlášení tooyour předplatné Azure.</span><span class="sxs-lookup"><span data-stu-id="eb077-276">Login tooyour Azure Subscription.</span></span>
2. <span data-ttu-id="eb077-277">Pokud chcete toodeploy virtuální síť toomimic hello místní sítě, zřízení hello prostředků, které jsou součástí **ONPREMRG**.</span><span class="sxs-lookup"><span data-stu-id="eb077-277">If you want toodeploy a VNet toomimic hello on-premises network, provision hello resources that are part of **ONPREMRG**.</span></span>
3. <span data-ttu-id="eb077-278">Zřízení hello prostředků, které jsou součástí **AZURERG**.</span><span class="sxs-lookup"><span data-stu-id="eb077-278">Provision hello resources that are part of **AZURERG**.</span></span>
4. <span data-ttu-id="eb077-279">Tunelové propojení hello zřídit z **onpremvnet** příliš**azurevnet**.</span><span class="sxs-lookup"><span data-stu-id="eb077-279">Provision hello tunnel from **onpremvnet** too**azurevnet**.</span></span>
5. <span data-ttu-id="eb077-280">Po zřízení jsou všechny prostředky, přihlaste se příliš**onpremvm2** ping 10.0.3.101 tootest připojení mezi **onpremsn2** a **azsn3**.</span><span class="sxs-lookup"><span data-stu-id="eb077-280">Once all resources are provisioned, log on too**onpremvm2** and ping 10.0.3.101 tootest connectivity between **onpremsn2** and **azsn3**.</span></span>


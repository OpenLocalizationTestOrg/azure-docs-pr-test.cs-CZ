---
title: "aaaSQL dotazu metriky pro rozhraní API služby Azure Cosmos databáze DocumentDB | Microsoft Docs"
description: "Informace o způsobu tooinstrument a ladění hello výkon dotazů SQL Azure Cosmos DB požadavků."
keywords: "syntaxe SQL, dotaz sql, sql dotazy, json dotazovací jazyk, databázových koncepcí a sql, agregační funkce"
services: cosmos-db
documentationcenter: 
author: arramac
manager: jhubbard
editor: monicar
ms.assetid: b2fa8e8f-7291-45a3-9bd1-7284ed9077f8
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/15/2017
ms.author: arramac
ms.openlocfilehash: 2fee3786b7d48d254162699471943e316764b003
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="tuning-query-performance-with-azure-cosmos-db"></a><span data-ttu-id="770f2-104">Ladění výkonu dotazů s Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="770f2-104">Tuning query performance with Azure Cosmos DB</span></span>
<span data-ttu-id="770f2-105">Poskytuje Azure Cosmos DB [SQL rozhraní API pro dotazování na data](documentdb-sql-query.md), aniž byste museli schématu nebo sekundární indexy.</span><span class="sxs-lookup"><span data-stu-id="770f2-105">Azure Cosmos DB provides a [SQL API for querying data](documentdb-sql-query.md), without requiring schema or secondary indexes.</span></span> <span data-ttu-id="770f2-106">Tento článek obsahuje následující informace pro vývojáře hello:</span><span class="sxs-lookup"><span data-stu-id="770f2-106">This article provides hello following information for developers:</span></span>

* <span data-ttu-id="770f2-107">Nejdůležitější podrobnosti o způsobu fungování spuštění dotazu SQL Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="770f2-107">High-level details on how Azure Cosmos DB's SQL query execution works</span></span>
* <span data-ttu-id="770f2-108">Informace o hlavičkách žádostí a odpovědí dotazu a možnosti klienta SDK</span><span class="sxs-lookup"><span data-stu-id="770f2-108">Details on query request and response headers, and client SDK options</span></span>
* <span data-ttu-id="770f2-109">Tipy a osvědčené postupy pro výkon dotazů</span><span class="sxs-lookup"><span data-stu-id="770f2-109">Tips and best practices for query performance</span></span>
* <span data-ttu-id="770f2-110">Příklady, jak tooutilize SQL provádění statistiky toodebug dotazování výkonu</span><span class="sxs-lookup"><span data-stu-id="770f2-110">Examples of how tooutilize SQL execution statistics toodebug query performance</span></span>

## <a name="about-sql-query-execution"></a><span data-ttu-id="770f2-111">O spuštění dotazu SQL</span><span class="sxs-lookup"><span data-stu-id="770f2-111">About SQL query execution</span></span>

<span data-ttu-id="770f2-112">V Azure Cosmos DB, ukládat data do kontejnerů, které můžou růst tooany [velikost nebo žádostí o propustnost úložiště](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-112">In Azure Cosmos DB, you store data in containers, which can grow tooany [storage size or request throughput](partition-data.md).</span></span> <span data-ttu-id="770f2-113">Azure Cosmos DB bezproblémově škáluje data mezi fyzické oddíly pod nárůst dat toohandle zahrnuje hello nebo zvýšení zřízené propustnosti.</span><span class="sxs-lookup"><span data-stu-id="770f2-113">Azure Cosmos DB seamlessly scales data across physical partitions under hello covers toohandle data growth or increase in provisioned throughput.</span></span> <span data-ttu-id="770f2-114">Můžete vydat kontejneru tooany dotazy SQL pomocí hello REST API nebo jeden z hello podporované [DocumentDB SDK](documentdb-sdk-dotnet.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-114">You can issue SQL queries tooany container using hello REST API or one of hello supported [DocumentDB SDKs](documentdb-sdk-dotnet.md).</span></span>

<span data-ttu-id="770f2-115">Stručný přehled vytváření oddílů: definování klíč oddílu, jako je "city", která určuje, jak je rozdělit data do fyzického oddíly.</span><span class="sxs-lookup"><span data-stu-id="770f2-115">A brief overview of partitioning: you define a partition key like "city", which determines how data is split across physical partitions.</span></span> <span data-ttu-id="770f2-116">Data patřící tooa jednoho oddílu klíč (například "city" == "Seattle") je uložen v rámci fyzické oddílu, ale obvykle jednoho oddílu fyzického má více klíčů oddílů.</span><span class="sxs-lookup"><span data-stu-id="770f2-116">Data belonging tooa single partition key (for example, "city" == "Seattle") is stored within a physical partition, but typically a single physical partition has multiple partition keys.</span></span> <span data-ttu-id="770f2-117">V případě oddíl dosáhne velikosti úložiště, hello služba bezproblémově rozdělí hello oddílu na dva nové oddíly a rovnoměrně rozděluje klíč oddílu hello mezi tyto oddíly.</span><span class="sxs-lookup"><span data-stu-id="770f2-117">When a partition reaches its storage size, hello service seamlessly splits hello partition into two new partitions, and divides hello partition key evenly across these partitions.</span></span> <span data-ttu-id="770f2-118">Vzhledem k tomu, že oddíly jsou přechodné, hello rozhraní API pomocí abstrakci "oddílu klíče rozsahu", který označuje hello rozsahy hodnoty hash klíče oddílu.</span><span class="sxs-lookup"><span data-stu-id="770f2-118">Since partitions are transient, hello APIs use an abstraction of a "partition key range", which denotes hello ranges of partition key hashes.</span></span> 

<span data-ttu-id="770f2-119">Pokud vydáte dotazu tooAzure Cosmos DB, hello SDK provádí tyto logických kroků:</span><span class="sxs-lookup"><span data-stu-id="770f2-119">When you issue a query tooAzure Cosmos DB, hello SDK performs these logical steps:</span></span>

* <span data-ttu-id="770f2-120">Analyzovat plán spuštění dotazu toodetermine hello SQL dotaz hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-120">Parse hello SQL query toodetermine hello query execution plan.</span></span> 
* <span data-ttu-id="770f2-121">Pokud dotaz hello obsahuje filtr proti hello klíč oddílu, jako například `SELECT * FROM c WHERE c.city = "Seattle"`, jedná směrované tooa jeden oddíl.</span><span class="sxs-lookup"><span data-stu-id="770f2-121">If hello query includes a filter against hello partition key, like `SELECT * FROM c WHERE c.city = "Seattle"`, it is routed tooa single partition.</span></span> <span data-ttu-id="770f2-122">Pokud dotaz hello nemá filtr na klíč oddílu, pak se spouštějí v všechny oddíly a výsledky sloučení na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="770f2-122">If hello query does not have a filter on partition key, then it is executed in all partitions, and results are merged client side.</span></span>
* <span data-ttu-id="770f2-123">Hello dotazu je provést v rámci každý oddíl v řadě nebo paralelní, v závislosti na konfiguraci klienta.</span><span class="sxs-lookup"><span data-stu-id="770f2-123">hello query is executed within each partition in series or parallel, based on client configuration.</span></span> <span data-ttu-id="770f2-124">V rámci každý oddíl hello dotaz může si ho nebo další zpátečních cest v závislosti na složitosti hello dotazu, nakonfigurovaná velikost stránky a zřízené propustnosti hello kolekce.</span><span class="sxs-lookup"><span data-stu-id="770f2-124">Within each partition, hello query might make one or more round trips depending on hello query complexity, configured page size, and provisioned throughput of hello collection.</span></span> <span data-ttu-id="770f2-125">Každé spuštění vrátí počet hello [požadované jednotky](request-units.md) spotřebované spuštění dotazu a volitelně statistik provádění dotazů.</span><span class="sxs-lookup"><span data-stu-id="770f2-125">Each execution returns hello number of [request units](request-units.md) consumed by query execution, and optionally, query execution statistics.</span></span> 
* <span data-ttu-id="770f2-126">Hello SDK provede shrnutí výsledků dotazu hello napříč oddíly.</span><span class="sxs-lookup"><span data-stu-id="770f2-126">hello SDK performs a summarization of hello query results across partitions.</span></span> <span data-ttu-id="770f2-127">Například pokud dotaz hello zahrnuje ORDER BY napříč oddíly, pak výsledky z jednotlivých oddílů jsou výsledky seřadit sloučení tooreturn globálně seřazená.</span><span class="sxs-lookup"><span data-stu-id="770f2-127">For example, if hello query involves an ORDER BY across partitions, then results from individual partitions are merge-sorted tooreturn results in globally sorted order.</span></span> <span data-ttu-id="770f2-128">Pokud se dotaz hello agregace jako `COUNT`, počty hello z jednotlivých oddílů se sečtené tooproduce hello celkový počet.</span><span class="sxs-lookup"><span data-stu-id="770f2-128">If hello query is an aggregation like `COUNT`, hello counts from individual partitions are summed tooproduce hello overall count.</span></span>

<span data-ttu-id="770f2-129">Hello sady SDK poskytují různé možnosti pro spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-129">hello SDKs provide various options for query execution.</span></span> <span data-ttu-id="770f2-130">Například v rozhraní .NET tyto možnosti jsou dostupné v hello `FeedOptions` třídy.</span><span class="sxs-lookup"><span data-stu-id="770f2-130">For example, in .NET these options are available in hello `FeedOptions` class.</span></span> <span data-ttu-id="770f2-131">Hello následující tabulka popisuje tyto možnosti a jak budou mít vliv doba provádění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-131">hello following table describes these options and how they impact query execution time.</span></span> 

| <span data-ttu-id="770f2-132">Možnost</span><span class="sxs-lookup"><span data-stu-id="770f2-132">Option</span></span> | <span data-ttu-id="770f2-133">Popis</span><span class="sxs-lookup"><span data-stu-id="770f2-133">Description</span></span> |
| ------ | ----------- |
| `EnableCrossPartitionQuery` | <span data-ttu-id="770f2-134">Musí být nastavena tootrue pro jakýkoli dotaz, který vyžaduje toobe provést napříč více než jeden oddíl.</span><span class="sxs-lookup"><span data-stu-id="770f2-134">Must be set tootrue for any query that requires toobe executed across more than one partition.</span></span> <span data-ttu-id="770f2-135">Jedná se explicitní příznak tooenable jste toomake kompromisy vědomá toho výkonu během doby vývoje.</span><span class="sxs-lookup"><span data-stu-id="770f2-135">This is an explicit flag tooenable you toomake conscious performance tradeoffs during development time.</span></span> |
| `EnableScanInQuery` | <span data-ttu-id="770f2-136">Musí být nastavena tootrue, pokud Nesouhlasili jste s indexování, ale přesto chcete dotaz hello toorun prostřednictvím kontrolu.</span><span class="sxs-lookup"><span data-stu-id="770f2-136">Must be set tootrue if you have opted out of indexing, but want toorun hello query via a scan anyway.</span></span> <span data-ttu-id="770f2-137">Pouze použito pouze v případě indexování pro hello požadovaného filtru cesta je zakázána.</span><span class="sxs-lookup"><span data-stu-id="770f2-137">Only applicable if indexing for hello requested filter path is disabled.</span></span> | 
| `MaxItemCount` | <span data-ttu-id="770f2-138">Hello maximální počet položek tooreturn na server toohello odezvy.</span><span class="sxs-lookup"><span data-stu-id="770f2-138">hello maximum number of items tooreturn per round trip toohello server.</span></span> <span data-ttu-id="770f2-139">Nastavením příliš-1, můžete je nechat server hello spravovat hello počet položek.</span><span class="sxs-lookup"><span data-stu-id="770f2-139">By setting too-1, you can let hello server manage hello number of items.</span></span> <span data-ttu-id="770f2-140">Nebo můžete snížit tooretrieve tato hodnota pouze malý počet položek na dobu odezvy.</span><span class="sxs-lookup"><span data-stu-id="770f2-140">Or, you can lower this value tooretrieve only a small number of items per round trip.</span></span> 
| `MaxBufferedItemCount` | <span data-ttu-id="770f2-141">Toto je možnost na straně klienta a použít spotřebu paměti hello toolimit při provádění cross-partition ORDER BY.</span><span class="sxs-lookup"><span data-stu-id="770f2-141">This is a client-side option, and used toolimit hello memory consumption when performing cross-partition ORDER BY.</span></span> <span data-ttu-id="770f2-142">Vyšší hodnota pomáhá snižovat latenci hello řazení mezi oddílu.</span><span class="sxs-lookup"><span data-stu-id="770f2-142">A higher value helps reduce hello latency of cross-partition sorting.</span></span> |
| `MaxDegreeOfParallelism` | <span data-ttu-id="770f2-143">Získá nebo nastaví hello počet souběžných operací spustit na straně klienta během provádění paralelního dotazu v hello databáze služby Azure DocumentDB.</span><span class="sxs-lookup"><span data-stu-id="770f2-143">Gets or sets hello number of concurrent operations run client side during parallel query execution in hello Azure DocumentDB database service.</span></span> <span data-ttu-id="770f2-144">Hodnotu vlastnosti kladné omezí hello počet souběžných operací toohello nastavte hodnotu.</span><span class="sxs-lookup"><span data-stu-id="770f2-144">A positive property value limits hello number of concurrent operations toohello set value.</span></span> <span data-ttu-id="770f2-145">Pokud je nastaveno tooless než 0, hello systému automaticky rozhoduje hello počet souběžných operací toorun.</span><span class="sxs-lookup"><span data-stu-id="770f2-145">If it is set tooless than 0, hello system automatically decides hello number of concurrent operations toorun.</span></span> |
| `PopulateQueryMetrics` | <span data-ttu-id="770f2-146">Doba načítání umožní podrobné protokolování statistiky času stráveného v různých fázích provádění dotazu jako čas kompilace, index smyčky čas a dokumentu.</span><span class="sxs-lookup"><span data-stu-id="770f2-146">Enables detailed logging of statistics of time spent in various phases of query execution like compilation time, index loop time, and document load time.</span></span> <span data-ttu-id="770f2-147">Výstup z Statistika dotazu můžete sdílet s problémy s výkonem dotazu toodiagnose podporu Azure.</span><span class="sxs-lookup"><span data-stu-id="770f2-147">You can share output from query statistics with Azure Support toodiagnose query performance issues.</span></span> |
| `RequestContinuation` | <span data-ttu-id="770f2-148">Provádění dotazů můžete obnovit předáním v token neprůhledného pokračování hello vrácený jakýkoli dotaz.</span><span class="sxs-lookup"><span data-stu-id="770f2-148">You can resume query execution by passing in hello opaque continuation token returned by any query.</span></span> <span data-ttu-id="770f2-149">token pro pokračování Hello zapouzdří všechny stavy, které jsou potřebné pro spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-149">hello continuation token encapsulates all state required for query execution.</span></span> |
| `ResponseContinuationTokenLimitInKb` | <span data-ttu-id="770f2-150">Můžete omezit hello maximální velikost token pokračování hello vrácená serverem hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-150">You can limit hello maximum size of hello continuation token returned by hello server.</span></span> <span data-ttu-id="770f2-151">Může tuto funkci potřebujete tooset Pokud hostitele vaší aplikace má omezení velikosti hlavičky odpovědi.</span><span class="sxs-lookup"><span data-stu-id="770f2-151">You might need tooset this if your application host has limits on response header size.</span></span> <span data-ttu-id="770f2-152">Toto nastavení může zvýšit hello celkové doby trvání a RUs využité pro hello dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-152">Setting this may increase hello overall duration and RUs consumed for hello query.</span></span>  |

<span data-ttu-id="770f2-153">Například příklad dotazu podívejme na požadovanou na kolekci s klíčem oddílu `/city` jako hello oddíl klíče a s propustností 100 000 RU/s přiděleným.</span><span class="sxs-lookup"><span data-stu-id="770f2-153">For example, let's take an example query on partition key requested on a collection with `/city` as hello partition key and provisioned with 100,000 RU/s of throughput.</span></span> <span data-ttu-id="770f2-154">Požádáte o dotaz pomocí `CreateDocumentQuery<T>` v rozhraní .NET jako hello následující:</span><span class="sxs-lookup"><span data-stu-id="770f2-154">You request this query using `CreateDocumentQuery<T>` in .NET like hello following:</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
        MaxItemCount = -1, 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();
```

<span data-ttu-id="770f2-155">Dobrý den výše uvedeném fragmentu sady SDK, odpovídá toohello následující požadavku REST API:</span><span class="sxs-lookup"><span data-stu-id="770f2-155">hello SDK snippet shown above, corresponds toohello following REST API request:</span></span>

```
POST https://arramacquerymetrics-westus.documents.azure.com/dbs/db/colls/sample/docs HTTP/1.1
x-ms-continuation: 
x-ms-documentdb-isquery: True
x-ms-max-item-count: -1
x-ms-documentdb-query-enablecrosspartition: True
x-ms-documentdb-query-parallelizecrosspartitionquery: True
x-ms-documentdb-query-iscontinuationexpected: True
x-ms-documentdb-populatequerymetrics: True
x-ms-date: Tue, 27 Jun 2017 21:52:18 GMT
authorization: type%3dmaster%26ver%3d1.0%26sig%3drp1Hi83Y8aVV5V6LzZ6xhtQVXRAMz0WNMnUuvriUv%2b4%3d
x-ms-session-token: 7:8,6:2008,5:8,4:2008,3:8,2:2008,1:8,0:8,9:8,8:4008
Cache-Control: no-cache
x-ms-consistency-level: Session
User-Agent: documentdb-dotnet-sdk/1.14.1 Host/32-bit MicrosoftWindowsNT/6.2.9200.0
x-ms-version: 2017-02-22
Accept: application/json
Content-Type: application/query+json
Host: arramacquerymetrics-westus.documents.azure.com
Content-Length: 52
Expect: 100-continue

{"query":"SELECT * FROM c WHERE c.city = 'Seattle'"}
```

<span data-ttu-id="770f2-156">Každé stránce provádění dotazu odpovídá tooa REST API `POST` s hello `Accept: application/query+json` záhlaví a hello dotazu SQL v textu hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-156">Each query execution page corresponds tooa REST API `POST` with hello `Accept: application/query+json` header, and hello SQL query in hello body.</span></span> <span data-ttu-id="770f2-157">Každý dotaz je jeden nebo více zaokrouhlit služebních cest toohello server s hello `x-ms-continuation` token opakována mezi tooresume provádění hello klienta a serveru.</span><span class="sxs-lookup"><span data-stu-id="770f2-157">Each query makes one or more round trips toohello server with hello `x-ms-continuation` token echoed between hello client and server tooresume execution.</span></span> <span data-ttu-id="770f2-158">Možnosti konfigurace Hello v FeedOptions jsou předávány serveru toohello v podobě hello hlaviček požadavku.</span><span class="sxs-lookup"><span data-stu-id="770f2-158">hello configuration options in FeedOptions are passed toohello server in hello form of request headers.</span></span> <span data-ttu-id="770f2-159">Například `MaxItemCount` odpovídá příliš`x-ms-max-item-count`.</span><span class="sxs-lookup"><span data-stu-id="770f2-159">For example, `MaxItemCount` corresponds too`x-ms-max-item-count`.</span></span> 

<span data-ttu-id="770f2-160">Hello požadavku vrátí následující hello (zkrácená čitelnější) odpovědi:</span><span class="sxs-lookup"><span data-stu-id="770f2-160">hello request returns hello following (truncated for readability) response:</span></span>

```
HTTP/1.1 200 Ok
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Server: Microsoft-HTTPAPI/2.0
Strict-Transport-Security: max-age=31536000
x-ms-last-state-change-utc: Tue, 27 Jun 2017 21:01:57.561 GMT
x-ms-resource-quota: documentSize=10240;documentsSize=10485760;documentsCount=-1;collectionSize=10485760;
x-ms-resource-usage: documentSize=1;documentsSize=884;documentsCount=2000;collectionSize=1408;
x-ms-item-count: 2000
x-ms-schemaversion: 1.3
x-ms-alt-content-path: dbs/db/colls/sample
x-ms-content-path: +9kEANVq0wA=
x-ms-xp-role: 1
x-ms-documentdb-query-metrics: totalExecutionTimeInMs=33.67;queryCompileTimeInMs=0.06;queryLogicalPlanBuildTimeInMs=0.02;queryPhysicalPlanBuildTimeInMs=0.10;queryOptimizationTimeInMs=0.00;VMExecutionTimeInMs=32.56;indexLookupTimeInMs=0.36;documentLoadTimeInMs=9.58;systemFunctionExecuteTimeInMs=0.00;userFunctionExecuteTimeInMs=0.00;retrievedDocumentCount=2000;retrievedDocumentSize=1125600;outputDocumentCount=2000;writeOutputTimeInMs=18.10;indexUtilizationRatio=1.00
x-ms-request-charge: 604.42
x-ms-serviceversion: version=1.14.34.4
x-ms-activity-id: 0df8b5f6-83b9-4493-abda-cce6d0f91486
x-ms-session-token: 2:2008
x-ms-gatewayversion: version=1.14.33.2
Date: Tue, 27 Jun 2017 21:59:49 GMT
```

<span data-ttu-id="770f2-161">hlavičky klíče odpovědi Hello vrácená z dotazu hello zahrnout hello následující:</span><span class="sxs-lookup"><span data-stu-id="770f2-161">hello key response headers returned from hello query include hello following:</span></span>

| <span data-ttu-id="770f2-162">Možnost</span><span class="sxs-lookup"><span data-stu-id="770f2-162">Option</span></span> | <span data-ttu-id="770f2-163">Popis</span><span class="sxs-lookup"><span data-stu-id="770f2-163">Description</span></span> |
| ------ | ----------- |
| `x-ms-item-count` | <span data-ttu-id="770f2-164">Hello počet položek, vrátí se v reakci hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-164">hello number of items returned in hello response.</span></span> <span data-ttu-id="770f2-165">Toto je závislá na hello zadaný `x-ms-max-item-count`, hello počet položek, které můžete přizpůsobit velikost datové části hello maximální odpovědi, hello zřízené propustnosti a doba provádění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-165">This is dependent on hello supplied `x-ms-max-item-count`, hello number of items that can be fit within hello maximum response payload size, hello provisioned throughput, and query execution time.</span></span> |  
| `x-ms-continuation:` | <span data-ttu-id="770f2-166">Hello pokračování tokenu tooresume spuštění dotazu hello, pokud jsou k dispozici další výsledky.</span><span class="sxs-lookup"><span data-stu-id="770f2-166">hello continuation token tooresume execution of hello query, if additional results are available.</span></span> | 
| `x-ms-documentdb-query-metrics` | <span data-ttu-id="770f2-167">Hello Statistika dotazu pro provedení hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-167">hello query statistics for hello execution.</span></span> <span data-ttu-id="770f2-168">Toto je oddělený řetězec obsahující statistiky čas věnovaný hello fáze spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-168">This is a delimited string containing statistics of time spent in hello various phases of query execution.</span></span> <span data-ttu-id="770f2-169">Vrácené v případě `x-ms-documentdb-populatequerymetrics` je nastaven příliš`True`.</span><span class="sxs-lookup"><span data-stu-id="770f2-169">Returned if `x-ms-documentdb-populatequerymetrics` is set too`True`.</span></span> | 
| `x-ms-request-charge` | <span data-ttu-id="770f2-170">Hello počet [požadované jednotky](request-units.md) spotřebovávají hello dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-170">hello number of [request units](request-units.md) consumed by hello query.</span></span> | 

<span data-ttu-id="770f2-171">Podrobnosti o hello hlavičky požadavku REST API a možnosti najdete v tématu [dotaz na prostředky pomocí hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span><span class="sxs-lookup"><span data-stu-id="770f2-171">For details on hello REST API request headers and options, see [Querying resources using hello DocumentDB REST API](https://docs.microsoft.com/rest/api/documentdb/querying-documentdb-resources-using-the-rest-api).</span></span>

## <a name="best-practices-for-query-performance"></a><span data-ttu-id="770f2-172">Osvědčené postupy pro výkon dotazů</span><span class="sxs-lookup"><span data-stu-id="770f2-172">Best practices for query performance</span></span>
<span data-ttu-id="770f2-173">Hello následují hello nejběžnější faktory, které mají vliv na výkon dotazu Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="770f2-173">hello following are hello most common factors that impact Azure Cosmos DB query performance.</span></span> <span data-ttu-id="770f2-174">Jsme podrobněji prozkoumat každý z těchto témat v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="770f2-174">We dig deeper into each of these topics in this article.</span></span>

| <span data-ttu-id="770f2-175">Koeficient</span><span class="sxs-lookup"><span data-stu-id="770f2-175">Factor</span></span> | <span data-ttu-id="770f2-176">Tip</span><span class="sxs-lookup"><span data-stu-id="770f2-176">Tip</span></span> | 
| ------ | -----| 
| <span data-ttu-id="770f2-177">Zřízená propustnost</span><span class="sxs-lookup"><span data-stu-id="770f2-177">Provisioned throughput</span></span> | <span data-ttu-id="770f2-178">Měření RU na jeden dotaz a zajistěte, abyste měli hello požadované zřízené propustnosti pro své dotazy.</span><span class="sxs-lookup"><span data-stu-id="770f2-178">Measure RU per query, and ensure that you have hello required provisioned throughput for your queries.</span></span> | 
| <span data-ttu-id="770f2-179">Dělení a klíče oddílů</span><span class="sxs-lookup"><span data-stu-id="770f2-179">Partitioning and partition keys</span></span> | <span data-ttu-id="770f2-180">Upřednostnit dotazy s hello hodnotu klíče oddílu v klauzuli filtru hello pro s nízkou latencí.</span><span class="sxs-lookup"><span data-stu-id="770f2-180">Favor queries with hello partition key value in hello filter clause for low latency.</span></span> |
| <span data-ttu-id="770f2-181">Možnosti sady SDK a dotazů</span><span class="sxs-lookup"><span data-stu-id="770f2-181">SDK and query options</span></span> | <span data-ttu-id="770f2-182">Doporučené postupy SDK jako přímé připojení a ladit možnosti provedení dotazu na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="770f2-182">Follow SDK best practices like direct connectivity, and tune client-side query execution options.</span></span> |
| <span data-ttu-id="770f2-183">Latence sítě</span><span class="sxs-lookup"><span data-stu-id="770f2-183">Network latency</span></span> | <span data-ttu-id="770f2-184">Účet pro síť režie v měření a použít více funkci tooread rozhraní API z hello nejbližší oblast.</span><span class="sxs-lookup"><span data-stu-id="770f2-184">Account for network overhead in measurement, and use multi-homing APIs tooread from hello nearest region.</span></span> |
| <span data-ttu-id="770f2-185">Zásady indexování</span><span class="sxs-lookup"><span data-stu-id="770f2-185">Indexing Policy</span></span> | <span data-ttu-id="770f2-186">Ujistěte se, že máte požadované hello cesty nebo zásady indexování pro dotaz hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-186">Ensure that you have hello required indexing paths/policy for hello query.</span></span> |
| <span data-ttu-id="770f2-187">Metriky spuštění dotazu</span><span class="sxs-lookup"><span data-stu-id="770f2-187">Query execution metrics</span></span> | <span data-ttu-id="770f2-188">Analýza hello dotazu provádění metriky tooidentify potenciální přepisů dotaz a datové tvarů.</span><span class="sxs-lookup"><span data-stu-id="770f2-188">Analyze hello query execution metrics tooidentify potential rewrites of query and data shapes.</span></span>  |

### <a name="provisioned-throughput"></a><span data-ttu-id="770f2-189">Zřízená propustnost</span><span class="sxs-lookup"><span data-stu-id="770f2-189">Provisioned throughput</span></span>
<span data-ttu-id="770f2-190">V systému Cosmos databáze můžete vytvořit kontejnery dat, každý s vyhrazenou propustností vyjádřené v žádosti o jednotkách (RU) za sekundu.</span><span class="sxs-lookup"><span data-stu-id="770f2-190">In Cosmos DB, you create containers of data, each with reserved throughput expressed in request units (RU) per-second.</span></span> <span data-ttu-id="770f2-191">Čtení 1 KB dokumentu je 1 RU a každé operace (včetně dotazů) je normalizovaný tooa pevně daný počet RUs podle jeho složitost.</span><span class="sxs-lookup"><span data-stu-id="770f2-191">A read of a 1-KB document is 1 RU, and every operation (including queries) is normalized tooa fixed number of RUs based on its complexity.</span></span> <span data-ttu-id="770f2-192">Například pokud máte 1000 zřízení RU/s pro váš kontejner, a máte dotaz jako `SELECT * FROM c WHERE c.city = 'Seattle'` , který využívá 5 RUs a potom můžete provést (1000 RU/s) / (5 RU/dotazu) = 200 dotazu nebo s takové dotazy za sekundu.</span><span class="sxs-lookup"><span data-stu-id="770f2-192">For example, if you have 1000 RU/s provisioned for your container, and you have a query like `SELECT * FROM c WHERE c.city = 'Seattle'` that consumes 5 RUs, then you can perform (1000 RU/s) / (5 RU/query) = 200 query/s such queries per second.</span></span> 

<span data-ttu-id="770f2-193">Pokud odešlete více než 200 dotazů za sekundu hello služba spustí omezení rychlosti příchozí požadavky nad 200/s.</span><span class="sxs-lookup"><span data-stu-id="770f2-193">If you submit more than 200 queries/sec, hello service starts rate-limiting incoming requests above 200/s.</span></span> <span data-ttu-id="770f2-194">Hello sady SDK automaticky zpracovávat tento případ provedením omezení rychlosti nebo opakování, proto možná jste si všimli vyšší latence pro tyto dotazy.</span><span class="sxs-lookup"><span data-stu-id="770f2-194">hello SDKs automatically handle this case by performing a backoff/retry, therefore you might notice a higher latency for these queries.</span></span> <span data-ttu-id="770f2-195">Zvýšení hello zřízené propustnosti toohello požadované zvyšuje hodnotu dotazu latence a propustnosti.</span><span class="sxs-lookup"><span data-stu-id="770f2-195">Increasing hello provisioned throughput toohello required value improves your query latency and throughput.</span></span> 

<span data-ttu-id="770f2-196">toolearn Další informace o jednotek žádosti, najdete v části [požadované jednotky](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-196">toolearn more about request units, see [Request units](request-units.md).</span></span>

### <a name="partitioning-and-partition-keys"></a><span data-ttu-id="770f2-197">Dělení a klíče oddílů</span><span class="sxs-lookup"><span data-stu-id="770f2-197">Partitioning and partition keys</span></span>
<span data-ttu-id="770f2-198">S Azure DB Cosmos obvykle dotazy provádět v hello následující pořadí z nejrychlejší nebo většinu efektivní tooslower nebo méně efektivní.</span><span class="sxs-lookup"><span data-stu-id="770f2-198">With Azure Cosmos DB, typically queries perform in hello following order from fastest/most efficient tooslower/less efficient.</span></span> 

* <span data-ttu-id="770f2-199">ZÍSKAT klíč jednoho oddílu a klíč položky</span><span class="sxs-lookup"><span data-stu-id="770f2-199">GET on a single partition key and item key</span></span>
* <span data-ttu-id="770f2-200">Dotaz s klauzulí filtru pro jeden oddíl klíč</span><span class="sxs-lookup"><span data-stu-id="770f2-200">Query with a filter clause on a single partition key</span></span>
* <span data-ttu-id="770f2-201">Dotazování bez klauzule filtru rovnosti nebo rozsah na žádnou vlastnost</span><span class="sxs-lookup"><span data-stu-id="770f2-201">Query without an equality or range filter clause on any property</span></span>
* <span data-ttu-id="770f2-202">Dotazování bez filtry</span><span class="sxs-lookup"><span data-stu-id="770f2-202">Query without filters</span></span>

<span data-ttu-id="770f2-203">Dotazuje této nutné tooconsult všechny oddíly potřeba vyšší latence a může využívat vyšší RUs.</span><span class="sxs-lookup"><span data-stu-id="770f2-203">Queries that need tooconsult all partitions need higher latency, and can consume higher RUs.</span></span> <span data-ttu-id="770f2-204">Vzhledem k tomu, že každý oddíl má automatické indexování pro všechny vlastnosti, hello dotazu je možné dodávat efektivně z hello indexu v tomto případě.</span><span class="sxs-lookup"><span data-stu-id="770f2-204">Since each partition has automatic indexing against all properties, hello query can be served efficiently from hello index in this case.</span></span> <span data-ttu-id="770f2-205">Můžete provést dotazy, které jsou rozmístěny oddíly rychlejší s použitím možností paralelismus hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-205">You can make queries that span partitions faster by using hello parallelism options.</span></span>

<span data-ttu-id="770f2-206">toolearn Další informace o vytváření oddílů a klíče oddílů, najdete v části [vytváření oddílů v Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-206">toolearn more about partitioning and partition keys, see [Partitioning in Azure Cosmos DB](partition-data.md).</span></span>

### <a name="sdk-and-query-options"></a><span data-ttu-id="770f2-207">Možnosti sady SDK a dotazů</span><span class="sxs-lookup"><span data-stu-id="770f2-207">SDK and query options</span></span>
<span data-ttu-id="770f2-208">V tématu [tipy pro zvýšení výkonu](performance-tips.md) a [testování výkonu](performance-testing.md) pro jak tooget hello nejlépe výkonu na straně klienta z Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="770f2-208">See [Performance Tips](performance-tips.md) and [Performance testing](performance-testing.md) for how tooget hello best client-side performance from Azure Cosmos DB.</span></span> <span data-ttu-id="770f2-209">To zahrnuje použití hello nejnovější SDK, konfigurace specifických pro platformy jako výchozí počet připojení, frekvenci uvolňování paměti, konfiguraci a použití možnosti lightweight připojení jako přímé/TCP.</span><span class="sxs-lookup"><span data-stu-id="770f2-209">This includes using hello latest SDKs, configuring platform-specific configurations like default number of connections, frequency of garbage collection, and using lightweight connectivity options like Direct/TCP.</span></span> 


#### <a name="max-item-count"></a><span data-ttu-id="770f2-210">Počet položek. maximální počet</span><span class="sxs-lookup"><span data-stu-id="770f2-210">Max Item Count</span></span>
<span data-ttu-id="770f2-211">Pro dotazy, hello hodnota `MaxItemCount` může mít významný dopad na dobu začátku do konce dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-211">For queries, hello value of `MaxItemCount` can have a significant impact on end-to-end query time.</span></span> <span data-ttu-id="770f2-212">Každý odezvy toohello server vrátí maximálně hello počet položek v `MaxItemCount` (výchozí 100 položek).</span><span class="sxs-lookup"><span data-stu-id="770f2-212">Each round trip toohello server will return no more than hello number of items in `MaxItemCount` (Default of 100 items).</span></span> <span data-ttu-id="770f2-213">Nastavení této hodnoty vyšší tooa (-1 je maximální a doporučené), který umožní zvýšení celkové doby trvání dotazu omezením hello počet zpátečních cest mezi serverem a klientem, zejména pro dotazy s velké množství výsledků.</span><span class="sxs-lookup"><span data-stu-id="770f2-213">Setting this tooa higher value (-1 is maximum, and recommended) will improve your query duration overall by limiting hello number of round trips between server and client, especially for queries with large result sets.</span></span>

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxItemCount = -1, 
    }).AsDocumentQuery();
```

#### <a name="max-degree-of-parallelism"></a><span data-ttu-id="770f2-214">Maximální počet stupně paralelního zpracování</span><span class="sxs-lookup"><span data-stu-id="770f2-214">Max Degree of Parallelism</span></span>
<span data-ttu-id="770f2-215">Pro dotazy, ladit hello `MaxDegreeOfParallelism` tooidentify hello doporučené konfigurace pro aplikace, zejména v případě, že můžete provádět dotazy cross-partition (bez filtru na hodnotě hello klíč oddílu).</span><span class="sxs-lookup"><span data-stu-id="770f2-215">For queries, tune hello `MaxDegreeOfParallelism` tooidentify hello best configurations for your application, especially if you perform cross-partition queries (without a filter on hello partition-key value).</span></span> <span data-ttu-id="770f2-216">`MaxDegreeOfParallelism`ovládací prvky hello maximální počet paralelních úkolů, tedy hello maximální počet oddílů toobe navštívené paralelně.</span><span class="sxs-lookup"><span data-stu-id="770f2-216">`MaxDegreeOfParallelism`  controls hello maximum number of parallel tasks, i.e., hello maximum of partitions toobe visited in parallel.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        MaxDegreeOfParallelism = -1, 
        EnableCrossPartitionQuery = true 
    }).AsDocumentQuery();
```

<span data-ttu-id="770f2-217">Předpokládejme, že</span><span class="sxs-lookup"><span data-stu-id="770f2-217">Let’s assume that</span></span>
* <span data-ttu-id="770f2-218">D = výchozí maximální počet paralelních úloh (celkový počet procesorů v klientském počítači hello =)</span><span class="sxs-lookup"><span data-stu-id="770f2-218">D = Default Maximum number of parallel tasks (= total number of processor in hello client machine)</span></span>
* <span data-ttu-id="770f2-219">P = zadán uživatel maximální počet paralelních úloh</span><span class="sxs-lookup"><span data-stu-id="770f2-219">P = User-specified maximum number of parallel tasks</span></span>
* <span data-ttu-id="770f2-220">N = počet oddílů, které potřebuje toobe navštívené odpovědí na dotazy</span><span class="sxs-lookup"><span data-stu-id="770f2-220">N = Number of partitions that needs  toobe visited for answering a query</span></span>

<span data-ttu-id="770f2-221">Toto jsou důsledky chování hello paralelní dotazy pro různé hodnoty P.</span><span class="sxs-lookup"><span data-stu-id="770f2-221">Following are implications of how hello parallel queries would behave for different values of P.</span></span>
* <span data-ttu-id="770f2-222">(P == 0) = > sériové režimu</span><span class="sxs-lookup"><span data-stu-id="770f2-222">(P == 0) => Serial Mode</span></span>
* <span data-ttu-id="770f2-223">(P == 1) = > maximálně jeden úkol</span><span class="sxs-lookup"><span data-stu-id="770f2-223">(P == 1) => Maximum of one task</span></span>
* <span data-ttu-id="770f2-224">(P > 1) = > Min (P, N) paralelní úlohy</span><span class="sxs-lookup"><span data-stu-id="770f2-224">(P > 1) => Min (P, N) parallel tasks</span></span> 
* <span data-ttu-id="770f2-225">(P < 1) = > Min (N, D) paralelní úlohy</span><span class="sxs-lookup"><span data-stu-id="770f2-225">(P < 1) => Min (N, D) parallel tasks</span></span>

<span data-ttu-id="770f2-226">Poznámky k verzi sady SDK a najdete v části Podrobnosti o implementované třídy a metody [DocumentDB SDK](documentdb-sdk-dotnet.md)</span><span class="sxs-lookup"><span data-stu-id="770f2-226">For SDK release notes, and details on implemented classes and methods see [DocumentDB SDKs](documentdb-sdk-dotnet.md)</span></span>

### <a name="network-latency"></a><span data-ttu-id="770f2-227">Latence sítě</span><span class="sxs-lookup"><span data-stu-id="770f2-227">Network latency</span></span>
<span data-ttu-id="770f2-228">V tématu [globální distribuční databázi Cosmos Azure](tutorial-global-distribution-documentdb.md) jak tooset až globální distribuční a připojit toohello nejbližší oblast.</span><span class="sxs-lookup"><span data-stu-id="770f2-228">See [Azure Cosmos DB global distribution](tutorial-global-distribution-documentdb.md) for how tooset up global distribution, and connect toohello closest region.</span></span> <span data-ttu-id="770f2-229">Latence sítě nemá významný dopad na výkon dotazů, pokud potřebujete toomake vícenásobný nebo načíst velké sadu výsledků hello dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-229">Network latency has a significant impact on query performance when you need toomake multiple round-trips or retrieve a large result set from hello query.</span></span> 

<span data-ttu-id="770f2-230">Hello na metriky provádění dotazu se dozvíte, jak tooretrieve hello serveru doba provádění dotazů ( `totalExecutionTimeInMs`), takže můžete rozlišit mezi času stráveného při provádění dotazu a čas strávený v síti přenosu.</span><span class="sxs-lookup"><span data-stu-id="770f2-230">hello section on query execution metrics explains how tooretrieve hello server execution time of queries ( `totalExecutionTimeInMs`), so that you can differentiate between time spent in query execution and time spent in network transit.</span></span>

### <a name="indexing-policy"></a><span data-ttu-id="770f2-231">Zásady indexování</span><span class="sxs-lookup"><span data-stu-id="770f2-231">Indexing policy</span></span>
<span data-ttu-id="770f2-232">V tématu [Konfigurace zásady indexování](indexing-policies.md) pro indexování cesty, typy a režimy, a jak by se projevily při provádění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-232">See [Configuring indexing policy](indexing-policies.md) for indexing paths, kinds, and modes, and how they impact query execution.</span></span> <span data-ttu-id="770f2-233">Ve výchozím hello indexování zásad používá Hash indexování pro řetězce, který je efektivní dotazy na rovnost, ale ne pro rozsah dotazy nebo order by – dotazy.</span><span class="sxs-lookup"><span data-stu-id="770f2-233">By default, hello indexing policy uses Hash indexing for strings, which is effective for equality queries, but not for range queries/order by queries.</span></span> <span data-ttu-id="770f2-234">Pokud potřebujete dotazy na rozsah pro řetězce, doporučujeme zadání hello index typu rozsah pro všechny řetězce.</span><span class="sxs-lookup"><span data-stu-id="770f2-234">If you need range queries for strings, we recommend specifying hello Range index type for all strings.</span></span> 

## <a name="query-execution-metrics"></a><span data-ttu-id="770f2-235">Metriky spuštění dotazu</span><span class="sxs-lookup"><span data-stu-id="770f2-235">Query execution metrics</span></span>
<span data-ttu-id="770f2-236">Můžete získat podrobné metriky pro spuštění dotazu předáním v hello volitelné `x-ms-documentdb-populatequerymetrics` záhlaví (`FeedOptions.PopulateQueryMetrics` v hello .NET SDK).</span><span class="sxs-lookup"><span data-stu-id="770f2-236">You can obtain detailed metrics on query execution by passing in hello optional `x-ms-documentdb-populatequerymetrics` header (`FeedOptions.PopulateQueryMetrics` in hello .NET SDK).</span></span> <span data-ttu-id="770f2-237">Hodnota vrácená v Hello `x-ms-documentdb-query-metrics` má hello následující páry klíč hodnota určená pro pokročilé řešení problémů s spuštění dotazu.</span><span class="sxs-lookup"><span data-stu-id="770f2-237">hello value returned in `x-ms-documentdb-query-metrics` has hello following key-value pairs meant for advanced troubleshooting of query execution.</span></span> 

```cs
IDocumentQuery<dynamic> query = client.CreateDocumentQuery(
    UriFactory.CreateDocumentCollectionUri(DatabaseName, CollectionName), 
    "SELECT * FROM c WHERE c.city = 'Seattle'", 
    new FeedOptions 
    { 
        PopulateQueryMetrics = true, 
    }).AsDocumentQuery();

FeedResponse<dynamic> result = await query.ExecuteNextAsync();

// Returns metrics by partition key range Id
IReadOnlyDictionary<string, QueryMetrics> metrics = result.QueryMetrics;

```

| <span data-ttu-id="770f2-238">Metrika</span><span class="sxs-lookup"><span data-stu-id="770f2-238">Metric</span></span> | <span data-ttu-id="770f2-239">Jednotka</span><span class="sxs-lookup"><span data-stu-id="770f2-239">Unit</span></span> | <span data-ttu-id="770f2-240">Popis</span><span class="sxs-lookup"><span data-stu-id="770f2-240">Description</span></span> | 
| ------ | -----| ----------- |
| `totalExecutionTimeInMs` | <span data-ttu-id="770f2-241">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-241">milliseconds</span></span> | <span data-ttu-id="770f2-242">Doba provádění dotazu</span><span class="sxs-lookup"><span data-stu-id="770f2-242">Query execution time</span></span> | 
| `queryCompileTimeInMs` | <span data-ttu-id="770f2-243">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-243">milliseconds</span></span> | <span data-ttu-id="770f2-244">Doba kompilace dotazu</span><span class="sxs-lookup"><span data-stu-id="770f2-244">Query compile time</span></span>  | 
| `queryLogicalPlanBuildTimeInMs` | <span data-ttu-id="770f2-245">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-245">milliseconds</span></span> | <span data-ttu-id="770f2-246">Plán logického dotazu toobuild čas</span><span class="sxs-lookup"><span data-stu-id="770f2-246">Time toobuild logical query plan</span></span> | 
| `queryPhysicalPlanBuildTimeInMs` | <span data-ttu-id="770f2-247">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-247">milliseconds</span></span> | <span data-ttu-id="770f2-248">Plán fyzické dotazu toobuild čas</span><span class="sxs-lookup"><span data-stu-id="770f2-248">Time toobuild physical query plan</span></span> | 
| `queryOptimizationTimeInMs` | <span data-ttu-id="770f2-249">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-249">milliseconds</span></span> | <span data-ttu-id="770f2-250">Čas strávený v optimalizaci dotazu</span><span class="sxs-lookup"><span data-stu-id="770f2-250">Time spent in optimizing query</span></span> | 
| `VMExecutionTimeInMs` | <span data-ttu-id="770f2-251">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-251">milliseconds</span></span> | <span data-ttu-id="770f2-252">Čas strávený v dotazu runtime</span><span class="sxs-lookup"><span data-stu-id="770f2-252">Time spent in query runtime</span></span> | 
| `indexLookupTimeInMs` | <span data-ttu-id="770f2-253">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-253">milliseconds</span></span> | <span data-ttu-id="770f2-254">Čas strávený v indexu fyzické vrstvě</span><span class="sxs-lookup"><span data-stu-id="770f2-254">Time spent in physical index layer</span></span> | 
| `documentLoadTimeInMs` | <span data-ttu-id="770f2-255">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-255">milliseconds</span></span> | <span data-ttu-id="770f2-256">Čas strávený v nahrávání dokumentů</span><span class="sxs-lookup"><span data-stu-id="770f2-256">Time spent in loading documents</span></span>  | 
| `systemFunctionExecuteTimeInMs` | <span data-ttu-id="770f2-257">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-257">milliseconds</span></span> | <span data-ttu-id="770f2-258">Celkový čas strávený provádění (Předdefinované) funkce systému v milisekundách</span><span class="sxs-lookup"><span data-stu-id="770f2-258">Total time spent executing system (built-in) functions in milliseconds</span></span>  | 
| `userFunctionExecuteTimeInMs` | <span data-ttu-id="770f2-259">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-259">milliseconds</span></span> | <span data-ttu-id="770f2-260">Celkový čas strávený spouštění uživatelsky definované funkce v milisekundách</span><span class="sxs-lookup"><span data-stu-id="770f2-260">Total time spent executing user-defined functions in milliseconds</span></span> | 
| `retrievedDocumentCount` | <span data-ttu-id="770f2-261">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-261">milliseconds</span></span> | <span data-ttu-id="770f2-262">Celkový počet načtených dokumentů</span><span class="sxs-lookup"><span data-stu-id="770f2-262">Total number of retrieved documents</span></span>  | 
| `retrievedDocumentSize` | <span data-ttu-id="770f2-263">Bajty</span><span class="sxs-lookup"><span data-stu-id="770f2-263">bytes</span></span> | <span data-ttu-id="770f2-264">Celková velikost načtené dokumenty v bajtech</span><span class="sxs-lookup"><span data-stu-id="770f2-264">Total size of retrieved documents in bytes</span></span>  | 
| `outputDocumentCount` | <span data-ttu-id="770f2-265">Počet</span><span class="sxs-lookup"><span data-stu-id="770f2-265">count</span></span> | <span data-ttu-id="770f2-266">Počet výstupních dokumentů</span><span class="sxs-lookup"><span data-stu-id="770f2-266">Number of output documents</span></span> | 
| `writeOutputTimeInMs` | <span data-ttu-id="770f2-267">milisekundy</span><span class="sxs-lookup"><span data-stu-id="770f2-267">milliseconds</span></span> | <span data-ttu-id="770f2-268">Doba provádění dotazu v milisekundách</span><span class="sxs-lookup"><span data-stu-id="770f2-268">Query execution time in milliseconds</span></span> | 
| `indexUtilizationRatio` | <span data-ttu-id="770f2-269">poměr (< = 1)</span><span class="sxs-lookup"><span data-stu-id="770f2-269">ratio (<=1)</span></span> | <span data-ttu-id="770f2-270">Načíst poměr počtu dokumenty odpovídající hello filtru toohello number dokumentů</span><span class="sxs-lookup"><span data-stu-id="770f2-270">Ratio of number of documents matched by hello filter toohello number of documents loaded</span></span>  | 

<span data-ttu-id="770f2-271">Hello klienta SDK může interně být více dotaz operations tooserve hello dotazu v rámci každého oddílu.</span><span class="sxs-lookup"><span data-stu-id="770f2-271">hello client SDKs may internally make multiple query operations tooserve hello query within each partition.</span></span> <span data-ttu-id="770f2-272">Hello klient zadává víc než jedno volání oddílů pokud celkový počet výsledků hello překročí `x-ms-max-item-count`, pokud dotaz hello překračuje hello zřízená propustnost pro hello oddílu, nebo pokud hello datovou část dotazu dosáhne hello maximální velikosti na stránce nebo pokud hello dotazu dosáhne hello systém přidělené časový limit.</span><span class="sxs-lookup"><span data-stu-id="770f2-272">hello client makes more than one call per-partition if hello total results exceed `x-ms-max-item-count`, if hello query exceeds hello provisioned throughput for hello partition, or if hello query payload reaches hello maximum size per page, or if hello query reaches hello system allocated timeout limit.</span></span> <span data-ttu-id="770f2-273">Každé spuštění částečné dotaz vrátí `x-ms-documentdb-query-metrics` pro tuto stránku.</span><span class="sxs-lookup"><span data-stu-id="770f2-273">Each partial query execution returns a `x-ms-documentdb-query-metrics` for that page.</span></span> 

<span data-ttu-id="770f2-274">Tady jsou některé ukázkové dotazy a jak toointerpret některé hello metrik vrácená z dotazu spuštění:</span><span class="sxs-lookup"><span data-stu-id="770f2-274">Here are some sample queries, and how toointerpret some of hello metrics returned from query execution:</span></span> 

| <span data-ttu-id="770f2-275">Dotaz</span><span class="sxs-lookup"><span data-stu-id="770f2-275">Query</span></span> | <span data-ttu-id="770f2-276">Ukázka metrika</span><span class="sxs-lookup"><span data-stu-id="770f2-276">Sample Metric</span></span> | <span data-ttu-id="770f2-277">Popis</span><span class="sxs-lookup"><span data-stu-id="770f2-277">Description</span></span> | 
| ------ | -----| ----------- |
| `SELECT TOP 100 * FROM c` | `"RetrievedDocumentCount": 101` | <span data-ttu-id="770f2-278">Hello počet dokumentů, načíst je 100 + 1 klauzule TOP toomatch hello.</span><span class="sxs-lookup"><span data-stu-id="770f2-278">hello number of documents retrieved is 100+1 toomatch hello TOP clause.</span></span> <span data-ttu-id="770f2-279">Doba dotazu je většinou věnovaný `WriteOutputTime` a `DocumentLoadTime` vzhledem k tomu, že je kontrolu.</span><span class="sxs-lookup"><span data-stu-id="770f2-279">Query time is mostly spent in `WriteOutputTime` and `DocumentLoadTime` since it is a scan.</span></span> | 
| `SELECT TOP 500 * FROM c` | `"RetrievedDocumentCount": 501` | <span data-ttu-id="770f2-280">RetrievedDocumentCount je nyní vyšší (500 + 1 toomatch hello klauzule TOP).</span><span class="sxs-lookup"><span data-stu-id="770f2-280">RetrievedDocumentCount is now higher (500+1 toomatch hello TOP clause).</span></span> | 
| `SELECT * FROM c WHERE c.N = 55` | `"IndexLookupTime": "00:00:00.0009500"` | <span data-ttu-id="770f2-281">O 0.9 ms je věnovaný IndexLookupTime pro vyhledávání klíčů, protože je indexu vyhledávání `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="770f2-281">About 0.9 ms is spent in IndexLookupTime for a key lookup, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT * FROM c WHERE c.N > 55` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="770f2-282">Něco delší dobu (1.7 ms) věnovaný IndexLookupTime přes rozsah kontroly, protože je indexu vyhledávání `/N/?`.</span><span class="sxs-lookup"><span data-stu-id="770f2-282">Slightly more time (1.7 ms) spent in IndexLookupTime over a range scan, because it's an index lookup on `/N/?`.</span></span> | 
| `SELECT TOP 500 c.N FROM c` | `"IndexLookupTime": "00:00:00.0017700"` | <span data-ttu-id="770f2-283">Stejný čas strávený `DocumentLoadTime` jako předchozí dotazy, ale nižší `WriteOutputTime` protože jsme se projekce pouze jednu vlastnost.</span><span class="sxs-lookup"><span data-stu-id="770f2-283">Same time spent on `DocumentLoadTime` as previous queries, but lower `WriteOutputTime` because we're projecting only one property.</span></span> | 
| `SELECT TOP 500 udf.toPercent(c.N) FROM c` | `"UserDefinedFunctionExecutionTime": "00:00:00.2136500"` | <span data-ttu-id="770f2-284">O 213 ms je věnovaný `UserDefinedFunctionExecutionTime` provádění hello UDF na každou hodnotu `c.N`.</span><span class="sxs-lookup"><span data-stu-id="770f2-284">About 213 ms is spent in `UserDefinedFunctionExecutionTime` executing hello UDF on each value of `c.N`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(c.Name, 'Den')` | `"IndexLookupTime": "00:00:00.0006400", "SystemFunctionExecutionTime": "00:00:00.0074100"` | <span data-ttu-id="770f2-285">Je věnovaný přibližně 0,6 ms `IndexLookupTime` na `/Name/?`.</span><span class="sxs-lookup"><span data-stu-id="770f2-285">About 0.6 ms is spent in `IndexLookupTime` on `/Name/?`.</span></span> <span data-ttu-id="770f2-286">Většina hello dotaz. čas provedení (ms ~ 7) v `SystemFunctionExecutionTime`.</span><span class="sxs-lookup"><span data-stu-id="770f2-286">Most of hello query execution time (~7 ms) in `SystemFunctionExecutionTime`.</span></span> |
| `SELECT TOP 500 c.Name FROM c WHERE STARTSWITH(LOWER(c.Name), 'den')` | `"IndexLookupTime": "00:00:00", "RetrievedDocumentCount": 2491,  "OutputDocumentCount": 500` | <span data-ttu-id="770f2-287">Dotaz se provádí jako kontrolu, protože používá `LOWER`, a jsou vráceny 500 mimo 2491 načtené dokumenty.</span><span class="sxs-lookup"><span data-stu-id="770f2-287">Query is performed as a scan because it uses `LOWER`, and 500 out of 2491 retrieved documents are returned.</span></span> |


## <a name="next-steps"></a><span data-ttu-id="770f2-288">Další kroky</span><span class="sxs-lookup"><span data-stu-id="770f2-288">Next steps</span></span>
* <span data-ttu-id="770f2-289">toolearn o operátory dotazu SQL hello podporována a klíčová slova, najdete v části [dotazu SQL](documentdb-sql-query.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-289">toolearn about hello supported SQL query operators and keywords, see [SQL query](documentdb-sql-query.md).</span></span> 
* <span data-ttu-id="770f2-290">toolearn o jednotkách žádosti, najdete v části [požadované jednotky](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="770f2-290">toolearn about request units, see [request units](request-units.md).</span></span>
* <span data-ttu-id="770f2-291">toolearn o zásady indexování, najdete v části [indexování zásad](indexing-policies.md)</span><span class="sxs-lookup"><span data-stu-id="770f2-291">toolearn about indexing policy, see [indexing policy](indexing-policies.md)</span></span> 



---
title: "Řízení přístupu Azure Cosmos DB podpora brány firewall & IP | Microsoft Docs"
description: "Naučte se používat zásady řízení přístupu IP pro podporu brány firewall na účty databáze Azure Cosmos DB."
keywords: "Řízení přístupu IP, podporu brány firewall"
services: cosmos-db
author: shahankur11
manager: jhubbard
editor: 
tags: azure-resource-manager
documentationcenter: 
ms.assetid: c1b9ede0-ed93-411a-ac9a-62c113a8e887
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 05/22/2017
ms.author: ankshah
ms.openlocfilehash: e08c0ba9c1fc0bab72ae8c1158aafaad4f66920e
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="azure-cosmos-db-firewall-support"></a><span data-ttu-id="de644-104">Podpora brány firewall Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="de644-104">Azure Cosmos DB firewall support</span></span>
<span data-ttu-id="de644-105">Zabezpečení dat uložených v databázi účet Azure Cosmos DB, Azure Cosmos DB poskytl podporu pro tajný klíč na základě [modelu autorizace](https://msdn.microsoft.com/library/azure/dn783368.aspx) , využívá ověřovací kód silné Hash-based zprávy (HMAC).</span><span class="sxs-lookup"><span data-stu-id="de644-105">To secure data stored in an Azure Cosmos DB database account, Azure Cosmos DB has provided support for a secret based [authorization model](https://msdn.microsoft.com/library/azure/dn783368.aspx) that utilizes a strong Hash-based message authentication code (HMAC).</span></span> <span data-ttu-id="de644-106">Teď kromě tajný autorizace založené na modelu Azure Cosmos DB podporuje zásady řízené řízení přístupu na základě IP pro podporu brány firewall pro příchozí.</span><span class="sxs-lookup"><span data-stu-id="de644-106">Now, in addition to the secret based authorization model, Azure Cosmos DB supports policy driven IP-based access controls for inbound firewall support.</span></span> <span data-ttu-id="de644-107">Tento model je velmi podobný pravidla brány firewall systému tradiční databází a poskytuje další úroveň zabezpečení pro databázový účet Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-107">This model is very similar to the firewall rules of a traditional database system and provides an additional level of security to the Azure Cosmos DB database account.</span></span> <span data-ttu-id="de644-108">Pomocí tohoto modelu teď můžete konfigurovat účet Azure Cosmos DB databáze tak, aby byla přístupná jenom z schválené sadu počítačů nebo cloudových služeb.</span><span class="sxs-lookup"><span data-stu-id="de644-108">With this model, you can now configure an Azure Cosmos DB database account to be accessible only from an approved set of machines and/or cloud services.</span></span> <span data-ttu-id="de644-109">Přístup k prostředkům Azure Cosmos DB z tyto schválené sady počítačů a služeb stále vyžadují volajícího, aby k dispozici platný autorizační token.</span><span class="sxs-lookup"><span data-stu-id="de644-109">Access to Azure Cosmos DB resources from these approved sets of machines and services still require the caller to present a valid authorization token.</span></span>

## <a name="ip-access-control-overview"></a><span data-ttu-id="de644-110">Přehled řízení přístupu IP</span><span class="sxs-lookup"><span data-stu-id="de644-110">IP access control overview</span></span>
<span data-ttu-id="de644-111">Ve výchozím nastavení je přístupné z veřejného Internetu účet Azure Cosmos DB databáze, tak dlouho, dokud žádosti je přiložena token platný autorizace.</span><span class="sxs-lookup"><span data-stu-id="de644-111">By default, an Azure Cosmos DB database account is accessible from public internet as long as the request is accompanied by a valid authorization token.</span></span> <span data-ttu-id="de644-112">Konfigurace řízení přístupu na základě zásad IP, uživatel musí poskytnout sadu IP adresy nebo rozsahy IP adres ve formátu CIDR zahrnuty jako seznam povolených IP adresy klienta pro účet danou databázi.</span><span class="sxs-lookup"><span data-stu-id="de644-112">To configure IP policy-based access control, the user must provide the set of IP addresses or IP address ranges in CIDR form to be included as the allowed list of client IPs for a given database account.</span></span> <span data-ttu-id="de644-113">Jakmile tato konfigurace se použije, všechny požadavky z počítače mimo tento seznam povolených se zablokuje serverem.</span><span class="sxs-lookup"><span data-stu-id="de644-113">Once this configuration is applied, all requests originating from machines outside this allowed list will be blocked by the server.</span></span>  <span data-ttu-id="de644-114">Připojení zpracování toku řízení přístupu na základě IP je popsaná v následujícím diagramu.</span><span class="sxs-lookup"><span data-stu-id="de644-114">The connection processing flow for the IP-based access control is described in the following diagram.</span></span>

![Diagram zobrazující proces připojení u řízení přístupu na základě IP](./media/firewall-support/firewall-support-flow.png)

## <a name="connections-from-cloud-services"></a><span data-ttu-id="de644-116">Připojení z cloudové služby</span><span class="sxs-lookup"><span data-stu-id="de644-116">Connections from cloud services</span></span>
<span data-ttu-id="de644-117">Cloudové služby v Azure, jsou velmi běžný způsob, jak hostování logikou střední úrovně služby pomocí Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-117">In Azure, cloud services are a very common way for hosting middle tier service logic using Azure Cosmos DB.</span></span> <span data-ttu-id="de644-118">Pokud chcete umožnit přístup k účtu Azure Cosmos DB databáze z cloudové služby, veřejnou IP adresu cloudové služby musíte přidat do seznamu povolených IP adres, které jsou spojené s vaším účtem Azure Cosmos DB databáze pomocí [konfigurace zásad řízení přístupu IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="de644-118">To enable access to an Azure Cosmos DB database account from a cloud service, the public IP address of the cloud service must be added to the allowed list of IP addresses associated with your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span>  <span data-ttu-id="de644-119">To zajistí, že všechny instance rolí, služeb cloud mít přístup ke svému účtu databáze Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-119">This ensures that all role instances of cloud services have access to your Azure Cosmos DB database account.</span></span> <span data-ttu-id="de644-120">IP adresy můžete načíst pro vaše cloudové služby na portálu Azure, jak je znázorněno na následujícím snímku obrazovky.</span><span class="sxs-lookup"><span data-stu-id="de644-120">You can retrieve IP addresses for your cloud services in the Azure portal, as shown in the following screenshot.</span></span>

![Snímek obrazovky s veřejnou IP adresu pro cloudové služby zobrazí na portálu Azure](./media/firewall-support/public-ip-addresses.png)

<span data-ttu-id="de644-122">Při škálování cloudové služby tak, že přidáte další role instance tyto nové instance automaticky mít přístup k účtu Azure Cosmos DB databáze, protože jsou součástí stejné cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="de644-122">When you scale out your cloud service by adding additional role instance(s), those new instances will automatically have access to the Azure Cosmos DB database account since they are part of the same cloud service.</span></span>

## <a name="connections-from-virtual-machines"></a><span data-ttu-id="de644-123">Připojení z virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="de644-123">Connections from virtual machines</span></span>
<span data-ttu-id="de644-124">[Virtuální počítače](https://azure.microsoft.com/services/virtual-machines/) nebo [sady škálování virtuálního počítače](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) lze také použít k hostování střední vrstvy služeb pomocí Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-124">[Virtual machines](https://azure.microsoft.com/services/virtual-machines/) or [virtual machine scale sets](../virtual-machine-scale-sets/virtual-machine-scale-sets-overview.md) can also be used to host middle tier services using Azure Cosmos DB.</span></span>  <span data-ttu-id="de644-125">Jak nakonfigurovat účet Azure Cosmos DB databáze pro povolení přístupu z virtuálních počítačů, veřejné IP adresy virtuálního počítače nebo škálovací sadu virtuálních počítačů musí být nakonfigurován jako jednu z povolených IP adres pro váš účet Azure Cosmos DB databáze pomocí [konfigurace zásad řízení přístupu IP](#configure-ip-policy).</span><span class="sxs-lookup"><span data-stu-id="de644-125">To configure the Azure Cosmos DB database account to allow access from virtual machines, public IP addresses of virtual machine and/or virtual machine scale set must be configured as one of the allowed IP addresses for your Azure Cosmos DB database account by [configuring the IP access control policy](#configure-ip-policy).</span></span> <span data-ttu-id="de644-126">IP adresy pro virtuální počítače na portálu Azure můžete načíst, jak je znázorněno na následujícím snímku obrazovky.</span><span class="sxs-lookup"><span data-stu-id="de644-126">You can retrieve IP addresses for virtual machines in the Azure portal, as shown in the following screenshot.</span></span>

![Snímek obrazovky s veřejnou IP adresu pro virtuální počítač, který se zobrazí na portálu Azure](./media/firewall-support/public-ip-addresses-dns.png)

<span data-ttu-id="de644-128">Když přidáte instance dalších virtuálních počítačů do skupiny, jsou automaticky k dispozici přístup ke svému účtu databáze Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-128">When you add additional virtual machine instances to the group, they are automatically provided access to your Azure Cosmos DB database account.</span></span>

## <a name="connections-from-the-internet"></a><span data-ttu-id="de644-129">Připojení z Internetu</span><span class="sxs-lookup"><span data-stu-id="de644-129">Connections from the internet</span></span>
<span data-ttu-id="de644-130">Při přístupu k účtu Azure Cosmos DB databáze z počítače na Internetu, musí být IP adresa klienta nebo rozsah IP adres počítače přidány do seznamu povolených IP adresy pro účet Azure Cosmos DB databáze.</span><span class="sxs-lookup"><span data-stu-id="de644-130">When you access an Azure Cosmos DB database account from a computer on the internet, the client IP address or IP address range of the machine must be added to the allowed list of IP address for the Azure Cosmos DB database account.</span></span> 

## <span data-ttu-id="de644-131"><a id="configure-ip-policy"></a>Konfigurace zásad řízení přístupu IP</span><span class="sxs-lookup"><span data-stu-id="de644-131"><a id="configure-ip-policy"></a> Configuring the IP access control policy</span></span>
<span data-ttu-id="de644-132">Zásady řízení přístupu IP lze nastavit na portálu Azure nebo prostřednictvím kódu programu prostřednictvím [rozhraní příkazového řádku Azure](cli-samples.md), [prostředí Azure Powershell](powershell-samples.md), nebo [REST API](/rest/api/documentdb/) aktualizací `ipRangeFilter` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="de644-132">The IP access control policy can be set in the Azure portal, or programmatically through [Azure CLI](cli-samples.md), [Azure Powershell](powershell-samples.md), or the [REST API](/rest/api/documentdb/) by updating the `ipRangeFilter` property.</span></span> <span data-ttu-id="de644-133">IP adresy a rozsahy musí být oddělené čárkami a nesmí obsahovat žádné mezery.</span><span class="sxs-lookup"><span data-stu-id="de644-133">IP addresses/ranges must be comma separated and must not contain any spaces.</span></span> <span data-ttu-id="de644-134">Příklad: "13.91.6.132,13.91.6.1/24".</span><span class="sxs-lookup"><span data-stu-id="de644-134">Example: "13.91.6.132,13.91.6.1/24".</span></span> <span data-ttu-id="de644-135">Při aktualizaci databázový účet prostřednictvím těchto metod, ujistěte se, že jste naplnit všechny vlastnosti, aby se zabránilo obnovení výchozího nastavení.</span><span class="sxs-lookup"><span data-stu-id="de644-135">When updating your database account through these methods, be sure to populate all of the properties to prevent resetting to default settings.</span></span>

> [!NOTE]
> <span data-ttu-id="de644-136">Povolením IP zásad řízení přístupu pro váš účet Azure Cosmos DB databáze, veškerý přístup ke svému účtu Azure Cosmos DB databáze z počítače mimo nastavenou povoleny, seznam rozsahů IP adres jsou zablokované.</span><span class="sxs-lookup"><span data-stu-id="de644-136">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="de644-137">Na základě tento model procházení operace roviny dat z portálu také se zablokuje k zajištění integrity řízení přístupu.</span><span class="sxs-lookup"><span data-stu-id="de644-137">By virtue of this model, browsing the data plane operation from the portal will also be blocked to ensure the integrity of access control.</span></span>

<span data-ttu-id="de644-138">Pro zjednodušení vývoje, portálu Azure vám pomůže identifikovat a přidejte do seznamu povolených IP klientského počítače, aby aplikace běžící váš počítač přístup k účtu Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-138">To simplify development, the Azure portal helps you identify and add the IP of your client machine to the allowed list, so that apps running your machine can access the Azure Cosmos DB account.</span></span> <span data-ttu-id="de644-139">Poznámka: rozpoznání IP adresa klienta zde jak je vidět na portálu.</span><span class="sxs-lookup"><span data-stu-id="de644-139">Note that the client IP address here is detected as seen by the portal.</span></span> <span data-ttu-id="de644-140">Může být IP adresa klienta počítače, ale mohou být také IP adresu brány vaší sítě.</span><span class="sxs-lookup"><span data-stu-id="de644-140">It may be the client IP address of your machine, but it could also be the IP address of your network gateway.</span></span> <span data-ttu-id="de644-141">Nezapomeňte odebrat před přechodem do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="de644-141">Do not forget to remove it before going to production.</span></span>

<span data-ttu-id="de644-142">Chcete-li nastavit zásady řízení přístupu IP na portálu Azure, přejděte do okna Azure Cosmos DB účet, klikněte na **brány Firewall** v navigační nabídce klikněte **ON**</span><span class="sxs-lookup"><span data-stu-id="de644-142">To set the IP access control policy in the Azure portal, navigate to the Azure Cosmos DB account blade, click **Firewall** in the navigation menu, then click **ON**</span></span> 

![Snímek obrazovky ukazující, jak otevřít okno brány Firewall na portálu Azure](./media/firewall-support/azure-portal-firewall.png)

<span data-ttu-id="de644-144">V podokně nové určete, jestli portálu Azure můžete přístup k účtu a přidání dalších adresy a rozsahy, protože je to vhodné a pak klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="de644-144">In the new pane, specify whether the Azure portal can access the account, and add other addresses and ranges as appropriate, then click **Save**.</span></span>  

> [!NOTE]
> <span data-ttu-id="de644-145">Když povolíte IP zásad řízení přístupu, je nutné přidat IP adresu pro portál Azure k získání přístupu.</span><span class="sxs-lookup"><span data-stu-id="de644-145">When you enable an IP access control policy, you need to add the IP address for the Azure portal to maintain access.</span></span> <span data-ttu-id="de644-146">Portál IP adresy jsou:</span><span class="sxs-lookup"><span data-stu-id="de644-146">The portal IP addresses are:</span></span>
> |<span data-ttu-id="de644-147">Oblast</span><span class="sxs-lookup"><span data-stu-id="de644-147">Region</span></span>|<span data-ttu-id="de644-148">IP adresa</span><span class="sxs-lookup"><span data-stu-id="de644-148">IP address</span></span>|
> |------|----------|
> |<span data-ttu-id="de644-149">Všechny oblasti s výjimkou těchto zadané níže</span><span class="sxs-lookup"><span data-stu-id="de644-149">All regions except those specified below</span></span>| <span data-ttu-id="de644-150">104.42.195.92</span><span class="sxs-lookup"><span data-stu-id="de644-150">104.42.195.92</span></span>|
> |<span data-ttu-id="de644-151">Německo</span><span class="sxs-lookup"><span data-stu-id="de644-151">Germany</span></span>|<span data-ttu-id="de644-152">51.4.229.218</span><span class="sxs-lookup"><span data-stu-id="de644-152">51.4.229.218</span></span>|
> |<span data-ttu-id="de644-153">Čína</span><span class="sxs-lookup"><span data-stu-id="de644-153">China</span></span>|<span data-ttu-id="de644-154">139.217.8.252</span><span class="sxs-lookup"><span data-stu-id="de644-154">139.217.8.252</span></span>|
> |<span data-ttu-id="de644-155">USA (Gov) – Arizona</span><span class="sxs-lookup"><span data-stu-id="de644-155">US Gov Arizona</span></span>|<span data-ttu-id="de644-156">52.244.48.71</span><span class="sxs-lookup"><span data-stu-id="de644-156">52.244.48.71</span></span>|
>

![Snímek obrazovky ukazující, jak nakonfigurovat nastavení brány firewall na portálu Azure](./media/firewall-support/azure-portal-firewall-configure.png)

## <a name="troubleshooting-the-ip-access-control-policy"></a><span data-ttu-id="de644-158">Řešení potíží s zásad řízení přístupu IP</span><span class="sxs-lookup"><span data-stu-id="de644-158">Troubleshooting the IP access control policy</span></span>
### <a name="portal-operations"></a><span data-ttu-id="de644-159">Operace portálu</span><span class="sxs-lookup"><span data-stu-id="de644-159">Portal operations</span></span>
<span data-ttu-id="de644-160">Povolením IP zásad řízení přístupu pro váš účet Azure Cosmos DB databáze, veškerý přístup ke svému účtu Azure Cosmos DB databáze z počítače mimo nastavenou povoleny, seznam rozsahů IP adres jsou zablokované.</span><span class="sxs-lookup"><span data-stu-id="de644-160">By enabling an IP access control policy for your Azure Cosmos DB database account, all access to your Azure Cosmos DB database account from machines outside the configured allowed list of IP address ranges are blocked.</span></span> <span data-ttu-id="de644-161">Proto pokud chcete povolit portálu datové roviny operací, jako je procházení kolekcí a dotazů dokumentů, musíte výslovně povolit pomocí Azure přístup k portálu **brány Firewall** okno na portálu.</span><span class="sxs-lookup"><span data-stu-id="de644-161">Therefore if you want to enable portal data plane operations like browsing collections and query documents, you need to explicitly allow Azure portal access using the **Firewall** blade in the portal.</span></span> 

![Snímek obrazovky ukazující, jak chcete umožnit přístup k portálu Azure](./media/firewall-support/azure-portal-access-firewall.png)

### <a name="sdk--rest-api"></a><span data-ttu-id="de644-163">Sadu SDK a Rest API</span><span class="sxs-lookup"><span data-stu-id="de644-163">SDK & Rest API</span></span>
<span data-ttu-id="de644-164">Pro z bezpečnostních důvodů, přístup prostřednictvím sady SDK nebo REST API z počítače není na seznamu povolených vrátí obecné 404 nebyl nalezen odpověď se žádné další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="de644-164">For security reasons, access via SDK or REST API from machines not on the allowed list will return a generic 404 Not Found response with no additional details.</span></span> <span data-ttu-id="de644-165">Zkontrolujte, zda IP nakonfigurovaných pro váš účet Azure Cosmos DB databáze seznamu povolených zajistit že správné zásady konfigurace se použije ke svému účtu databáze Azure Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="de644-165">Please verify the IP allowed list configured for your Azure Cosmos DB database account to ensure the correct policy configuration is applied to your Azure Cosmos DB database account.</span></span>

## <a name="next-steps"></a><span data-ttu-id="de644-166">Další kroky</span><span class="sxs-lookup"><span data-stu-id="de644-166">Next steps</span></span>
<span data-ttu-id="de644-167">Informace o síti tipy pro zvýšení výkonu související, najdete v článku [tipy pro zvýšení výkonu](performance-tips.md).</span><span class="sxs-lookup"><span data-stu-id="de644-167">For information about network related performance tips, see [Performance tips](performance-tips.md).</span></span>


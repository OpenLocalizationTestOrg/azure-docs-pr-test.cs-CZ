---
title: "Tipy pro zvýšení výkonu - Azure Cosmos databáze NoSQL | Microsoft Docs"
description: "Další možnosti konfigurace klienta ke zlepšení výkonu databáze Azure Cosmos DB"
keywords: "tom, jak zvýšit výkon databáze"
services: cosmos-db
author: mimig1
manager: jhubbard
editor: 
documentationcenter: 
ms.assetid: 94ff155e-f9bc-488f-8c7a-5e7037091bb9
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 02/23/2017
ms.author: mimig
ms.openlocfilehash: a94cda90eca9dca2b93adb8f5091d829e7375aa5
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="performance-tips-for-azure-cosmos-db"></a><span data-ttu-id="89222-104">Tipy pro zvýšení výkonu pro Azure Cosmos DB</span><span class="sxs-lookup"><span data-stu-id="89222-104">Performance tips for Azure Cosmos DB</span></span>
<span data-ttu-id="89222-105">Azure Cosmos DB je rychlé a flexibilní distribuovanou databázi, která bezproblémově škáluje s zaručenou latence a propustnosti.</span><span class="sxs-lookup"><span data-stu-id="89222-105">Azure Cosmos DB is a fast and flexible distributed database that scales seamlessly with guaranteed latency and throughput.</span></span> <span data-ttu-id="89222-106">Není nutné provádět změny hlavní architektura nebo zapsat složitý kód se škálovat databázi Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="89222-106">You do not have to make major architecture changes or write complex code to scale your database with Cosmos DB.</span></span> <span data-ttu-id="89222-107">Škálování nahoru a dolů je stejně snadná jako provedení jednoho volání rozhraní API nebo [volání metody SDK](set-throughput.md#set-throughput-sdk).</span><span class="sxs-lookup"><span data-stu-id="89222-107">Scaling up and down is as easy as making a single API call or [SDK method call](set-throughput.md#set-throughput-sdk).</span></span> <span data-ttu-id="89222-108">Ale protože Cosmos DB přistupuje prostřednictvím sítě volání existují optimalizace straně klienta, provedené k dosažení nejvyššího výkonu.</span><span class="sxs-lookup"><span data-stu-id="89222-108">However, because Cosmos DB is accessed via network calls there are client-side optimizations you can make to achieve peak performance.</span></span>

<span data-ttu-id="89222-109">Takže pokud vás nemůže ověřit "jak vylepšit výkon Moje databáze?"</span><span class="sxs-lookup"><span data-stu-id="89222-109">So if you're asking "How can I improve my database performance?"</span></span> <span data-ttu-id="89222-110">Zvažte následující možnosti:</span><span class="sxs-lookup"><span data-stu-id="89222-110">consider the following options:</span></span>

## <a name="networking"></a><span data-ttu-id="89222-111">Sítě</span><span class="sxs-lookup"><span data-stu-id="89222-111">Networking</span></span>
<a id="direct-connection"></a>

1. <span data-ttu-id="89222-112">**Zásady připojení: použití režimu přímé připojení**</span><span class="sxs-lookup"><span data-stu-id="89222-112">**Connection policy: Use direct connection mode**</span></span>

    <span data-ttu-id="89222-113">Jak se klient připojí k databázi Cosmos má důležité dopady na výkon, hlavně z hlediska zjištěnou latence klienta.</span><span class="sxs-lookup"><span data-stu-id="89222-113">How a client connects to Cosmos DB has important implications on performance, especially in terms of observed client-side latency.</span></span> <span data-ttu-id="89222-114">Nejsou k dispozici pro konfiguraci klienta zásady připojení – připojení dvě nastavení konfigurace klíče *režimu* a [připojení *protokol*](#connection-protocol).</span><span class="sxs-lookup"><span data-stu-id="89222-114">There are two key configuration settings available for configuring client Connection Policy – the connection *mode* and the [connection *protocol*](#connection-protocol).</span></span>  <span data-ttu-id="89222-115">Jsou k dispozici dva režimy:</span><span class="sxs-lookup"><span data-stu-id="89222-115">The two available modes are:</span></span>

   1. <span data-ttu-id="89222-116">Režim brány (výchozí)</span><span class="sxs-lookup"><span data-stu-id="89222-116">Gateway Mode (default)</span></span>
   2. <span data-ttu-id="89222-117">Přímý režim</span><span class="sxs-lookup"><span data-stu-id="89222-117">Direct Mode</span></span>

      <span data-ttu-id="89222-118">Režim brány je podporovaná na všech platformách SDK a je nakonfigurované výchozí.</span><span class="sxs-lookup"><span data-stu-id="89222-118">Gateway Mode is supported on all SDK platforms and is the configured default.</span></span>  <span data-ttu-id="89222-119">Pokud vaše aplikace běží v rámci podnikové sítě s omezeními striktní brány firewall, režimu brány je nejlepší volbou, protože používá standardní port HTTPS a jeden koncový bod.</span><span class="sxs-lookup"><span data-stu-id="89222-119">If your application runs within a corporate network with strict firewall restrictions, Gateway Mode is the best choice since it uses the standard HTTPS port and a single endpoint.</span></span> <span data-ttu-id="89222-120">Kompromis výkonu, je ale, že režimu brány zahrnuje směrování další síti pokaždé, když data číst nebo zapisovat do databáze Cosmos.</span><span class="sxs-lookup"><span data-stu-id="89222-120">The performance tradeoff, however, is that Gateway Mode involves an additional network hop every time data is read or written to Cosmos DB.</span></span> <span data-ttu-id="89222-121">Z toho důvodu přímý režim nabízí lepší výkon z důvodu méně síťové směrování.</span><span class="sxs-lookup"><span data-stu-id="89222-121">Because of this, Direct Mode offers better performance due to fewer network hops.</span></span>
<a id="use-tcp"></a>
2. <span data-ttu-id="89222-122">**Zásady připojení: použití protokolu TCP**</span><span class="sxs-lookup"><span data-stu-id="89222-122">**Connection policy: Use the TCP protocol**</span></span>

    <span data-ttu-id="89222-123">Při použití režimu přímého, existují dvě možnosti protokolu k dispozici:</span><span class="sxs-lookup"><span data-stu-id="89222-123">When using Direct Mode, there are two protocol options available:</span></span>

   * <span data-ttu-id="89222-124">TCP</span><span class="sxs-lookup"><span data-stu-id="89222-124">TCP</span></span>
   * <span data-ttu-id="89222-125">HTTPS</span><span class="sxs-lookup"><span data-stu-id="89222-125">HTTPS</span></span>

     <span data-ttu-id="89222-126">Cosmos DB nabízí jednoduchý a otevřete programovací model RESTful přes protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="89222-126">Cosmos DB offers a simple and open RESTful programming model over HTTPS.</span></span> <span data-ttu-id="89222-127">Kromě toho nabízí efektivní protokolu TCP, který je také dosáhl standardu RESTful v jeho komunikace modelu a je k dispozici prostřednictvím klient .NET SDK.</span><span class="sxs-lookup"><span data-stu-id="89222-127">Additionally, it offers an efficient TCP protocol, which is also RESTful in its communication model and is available through the .NET client SDK.</span></span> <span data-ttu-id="89222-128">Přímé TCP a HTTPS používat protokol SSL pro počáteční ověřování a šifrování přenosů.</span><span class="sxs-lookup"><span data-stu-id="89222-128">Both Direct TCP and HTTPS use SSL for initial authentication and encrypting traffic.</span></span> <span data-ttu-id="89222-129">Pro nejlepší výkon použijte protokol TCP, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="89222-129">For best performance, use the TCP protocol when possible.</span></span>

     <span data-ttu-id="89222-130">Při použití protokolu TCP v režimu brány, TCP Port 443 je port Cosmos DB a 10255 je port, rozhraní API MongoDB.</span><span class="sxs-lookup"><span data-stu-id="89222-130">When using TCP in Gateway Mode, TCP Port 443 is the Cosmos DB port, and 10255 is the MongoDB API port.</span></span> <span data-ttu-id="89222-131">Při použití protokolu TCP v režimu přímého kromě portů brány, je potřeba zajistit port rozsahu 10000 až 20000 je otevřený, protože Cosmos DB používá dynamické porty TCP.</span><span class="sxs-lookup"><span data-stu-id="89222-131">When using TCP in Direct Mode, in addition to the Gateway ports, you need to ensure the port range between 10000 and 20000 is open because Cosmos DB uses dynamic TCP ports.</span></span> <span data-ttu-id="89222-132">Pokud nejsou tyto porty otevřít a pokus o použití protokolu TCP, obdržíte chybu 503 Služba není k dispozici.</span><span class="sxs-lookup"><span data-stu-id="89222-132">If these ports are not open and you attempt to use TCP, you receive a 503 Service Unavailable error.</span></span>

     <span data-ttu-id="89222-133">Režim připojení je nakonfigurovat při vytváření instance DocumentClient s parametrem ConnectionPolicy.</span><span class="sxs-lookup"><span data-stu-id="89222-133">The Connectivity Mode is configured during the construction of the DocumentClient instance with the ConnectionPolicy parameter.</span></span> <span data-ttu-id="89222-134">Pokud se používá přímý režim, můžete v rámci parametr ConnectionPolicy nastavit protokol.</span><span class="sxs-lookup"><span data-stu-id="89222-134">If Direct Mode is used, the Protocol can also be set within the ConnectionPolicy parameter.</span></span>

    ```C#
    var serviceEndpoint = new Uri("https://contoso.documents.net");
    var authKey = new "your authKey from the Azure portal";
    DocumentClient client = new DocumentClient(serviceEndpoint, authKey,
    new ConnectionPolicy
    {
        ConnectionMode = ConnectionMode.Direct,
        ConnectionProtocol = Protocol.Tcp
    });
    ```

    <span data-ttu-id="89222-135">Protože TCP je podporována pouze v režimu přímého, pokud se používá v režimu brány, vždy používá protokol HTTPS ke komunikaci s bránou a hodnota protokolu v ConnectionPolicy je ignorována.</span><span class="sxs-lookup"><span data-stu-id="89222-135">Because TCP is only supported in Direct Mode, if Gateway Mode is used, then the HTTPS protocol is always used to communicate with the Gateway and the Protocol value in the ConnectionPolicy is ignored.</span></span>

    ![Obrázek připojení zásad Azure Cosmos DB](./media/performance-tips/connection-policy.png)

3. <span data-ttu-id="89222-137">**Volání OpenAsync, aby se zabránilo zpoždění při spuštění na první požadavek**</span><span class="sxs-lookup"><span data-stu-id="89222-137">**Call OpenAsync to avoid startup latency on first request**</span></span>

    <span data-ttu-id="89222-138">Ve výchozím nastavení první požadavek má vyšší latence, protože má načíst tabulky směrování adres.</span><span class="sxs-lookup"><span data-stu-id="89222-138">By default, the first request has a higher latency because it has to fetch the address routing table.</span></span> <span data-ttu-id="89222-139">Abyste se vyhnuli tato čekací doba spuštění na první žádost, měli byste zavolat OpenAsync() jednou během inicializace následujícím způsobem.</span><span class="sxs-lookup"><span data-stu-id="89222-139">To avoid this startup latency on the first request, you should call OpenAsync() once during initialization as follows.</span></span>

        await client.OpenAsync();
   <a id="same-region"></a>
4. <span data-ttu-id="89222-140">**Společně umístit klienty ve stejné oblasti Azure výkonu**</span><span class="sxs-lookup"><span data-stu-id="89222-140">**Collocate clients in same Azure region for performance**</span></span>

    <span data-ttu-id="89222-141">Pokud je to možné, umístěte všechny aplikace, volání Cosmos DB ve stejné oblasti jako databázi Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="89222-141">When possible, place any applications calling Cosmos DB in the same region as the Cosmos DB database.</span></span> <span data-ttu-id="89222-142">Přibližná porovnání najdete dokončí volání Cosmos DB v rámci stejné oblasti v rámci ms 1 – 2, ale je latence mezi – západ a východním pobřeží USA > 50 ms.</span><span class="sxs-lookup"><span data-stu-id="89222-142">For an approximate comparison, calls to Cosmos DB within the same region complete within 1-2 ms, but the latency between the West and East coast of the US is >50 ms.</span></span> <span data-ttu-id="89222-143">Tato čekací doba můžete z požadavku na žádost pravděpodobně lišit v závislosti na směrování žádosti jako předává z klienta na hranici datového centra Azure.</span><span class="sxs-lookup"><span data-stu-id="89222-143">This latency can likely vary from request to request depending on the route taken by the request as it passes from the client to the Azure datacenter boundary.</span></span> <span data-ttu-id="89222-144">Nejnižší možnou latenci je dosaženo tím zajistíte, že je volající aplikace se nachází v rámci stejné oblasti Azure jako koncový bod zřízené Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="89222-144">The lowest possible latency is achieved by ensuring the calling application is located within the same Azure region as the provisioned Cosmos DB endpoint.</span></span> <span data-ttu-id="89222-145">Seznam dostupných oblastí najdete v tématu [oblasti Azure](https://azure.microsoft.com/regions/#services).</span><span class="sxs-lookup"><span data-stu-id="89222-145">For a list of available regions, see [Azure Regions](https://azure.microsoft.com/regions/#services).</span></span>

    <span data-ttu-id="89222-146">![Obrázek připojení zásad Azure Cosmos DB](./media/performance-tips/same-region.png)
   <a id="increase-threads"></a></span><span class="sxs-lookup"><span data-stu-id="89222-146">![Illustration of the Azure Cosmos DB connection policy](./media/performance-tips/same-region.png)
<a id="increase-threads"></a></span></span>
5. <span data-ttu-id="89222-147">**Zvýšit počet vláken/úlohy**</span><span class="sxs-lookup"><span data-stu-id="89222-147">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="89222-148">Vzhledem k tomu, že k databázi Azure Cosmos volání přes síť, musíte ke změně stupně paralelního zpracování žádostí o tak, aby klientská aplikace stráví velmi malé dobu čekání mezi požadavky.</span><span class="sxs-lookup"><span data-stu-id="89222-148">Since calls to Azure Cosmos DB are made over the network, you may need to vary the degree of parallelism of your requests so that the client application spends very little time waiting between requests.</span></span> <span data-ttu-id="89222-149">Pokud například používáte. NET na [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), vytvořte v pořadí 100s úloh čtení nebo zápisu do Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="89222-149">For example, if you're using .NET's [Task Parallel Library](https://msdn.microsoft.com//library/dd460717.aspx), create in the order of 100s of Tasks reading or writing to Cosmos DB.</span></span>

## <a name="sdk-usage"></a><span data-ttu-id="89222-150">Použití sady SDK</span><span class="sxs-lookup"><span data-stu-id="89222-150">SDK Usage</span></span>
1. <span data-ttu-id="89222-151">**Nainstalujte nejnovější sadu SDK**</span><span class="sxs-lookup"><span data-stu-id="89222-151">**Install the most recent SDK**</span></span>

    <span data-ttu-id="89222-152">Sady SDK DB Cosmos neustále probíhá lepší zajistit optimální výkon.</span><span class="sxs-lookup"><span data-stu-id="89222-152">The Cosmos DB SDKs are constantly being improved to provide the best performance.</span></span> <span data-ttu-id="89222-153">Najdete v článku [Cosmos DB SDK](documentdb-sdk-dotnet.md) stránky, abyste zjistili nejnovější SDK a zkontrolujte vylepšení.</span><span class="sxs-lookup"><span data-stu-id="89222-153">See the [Cosmos DB SDK](documentdb-sdk-dotnet.md) pages to determine the most recent SDK and review improvements.</span></span>
2. <span data-ttu-id="89222-154">**Použít klienta Cosmos DB singleton po dobu jeho existence vaší aplikace.**</span><span class="sxs-lookup"><span data-stu-id="89222-154">**Use a singleton Cosmos DB client for the lifetime of your application**</span></span>

    <span data-ttu-id="89222-155">Všimněte si, že každá instance DocumentClient je bezpečné pro přístup z více vláken a provádí správu efektivní připojení a ukládání adres do mezipaměti v režimu přímého.</span><span class="sxs-lookup"><span data-stu-id="89222-155">Note that each DocumentClient instance is thread-safe and performs efficient connection management and address caching when operating in Direct Mode.</span></span> <span data-ttu-id="89222-156">Povolit správu efektivní připojení a lepší výkon pomocí DocumentClient, doporučujeme použít jednu instanci DocumentClient jednotlivé domény aplikace po dobu jeho existence aplikace.</span><span class="sxs-lookup"><span data-stu-id="89222-156">To allow efficient connection management and better performance by DocumentClient, it is recommended to use a single instance of DocumentClient per AppDomain for the lifetime of the application.</span></span>

   <a id="max-connection"></a>
3. <span data-ttu-id="89222-157">**Při použití režimu brány zvýšit System.Net MaxConnections na hostitele**</span><span class="sxs-lookup"><span data-stu-id="89222-157">**Increase System.Net MaxConnections per host when using Gateway mode**</span></span>

    <span data-ttu-id="89222-158">Jsou vytvářeny požadavky cosmos DB přes protokol HTTPS nebo REST při použití režimu brány a podléhají výchozí limit připojení pro hostitele nebo IP adresa.</span><span class="sxs-lookup"><span data-stu-id="89222-158">Cosmos DB requests are made over HTTPS/REST when using Gateway mode, and are subjected to the default connection limit per hostname or IP address.</span></span> <span data-ttu-id="89222-159">Musíte nastavit MaxConnections na vyšší hodnotu (100-1000) tak, aby klientské knihovny může využívat víc souběžných připojení k databázi Cosmos.</span><span class="sxs-lookup"><span data-stu-id="89222-159">You may need to set the MaxConnections to a higher value (100-1000) so that the client library can utilize multiple simultaneous connections to Cosmos DB.</span></span> <span data-ttu-id="89222-160">V sadě SDK .NET 1.8.0 a vyšší, výchozí hodnota pro [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) je 50 a chcete-li změnit hodnotu, můžete nastavit [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx)na vyšší hodnotu.</span><span class="sxs-lookup"><span data-stu-id="89222-160">In the .NET SDK 1.8.0 and above, the default value for [ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit.aspx) is 50 and to change the value, you can set the [Documents.Client.ConnectionPolicy.MaxConnectionLimit](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.client.connectionpolicy.maxconnectionlimit.aspx) to a higher value.</span></span>   
4. <span data-ttu-id="89222-161">**Ladění paralelní dotazy pro dělené kolekce**</span><span class="sxs-lookup"><span data-stu-id="89222-161">**Tuning parallel queries for partitioned collections**</span></span>

     <span data-ttu-id="89222-162">DocumentDB .NET SDK verze 1.9.0 a vyšší paralelní dotazy podpory, které vám umožní dotazovat dělenou kolekci paralelně (najdete v části [práce sady SDK](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) a související [ukázky kódu jsou](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) Další informace informace o).</span><span class="sxs-lookup"><span data-stu-id="89222-162">DocumentDB .NET SDK version 1.9.0 and above support parallel queries, which enable you to query a partitioned collection in parallel (see [Working with the SDKs](documentdb-partition-data.md#working-with-the-azure-cosmos-db-sdks) and the related [code samples](https://github.com/Azure/azure-documentdb-dotnet/blob/master/samples/code-samples/Queries/Program.cs) for more info).</span></span> <span data-ttu-id="89222-163">Paralelní dotazy jsou navrženy pro zlepšit latenci dotazů a propustnosti na jejich sériové protějšku.</span><span class="sxs-lookup"><span data-stu-id="89222-163">Parallel queries are designed to improve query latency and throughput over their serial counterpart.</span></span> <span data-ttu-id="89222-164">Paralelní dotazy poskytují dva parametry, které uživatelé mohli vyladit vlastní-přizpůsobit jejich požadavků (a) MaxDegreeOfParallelism: řídit maximální počet oddílů pak může být dotazována v paralelní a (b) MaxBufferedItemCount: k řízení počet předem načtených výsledky.</span><span class="sxs-lookup"><span data-stu-id="89222-164">Parallel queries provide two parameters that users can tune to custom-fit their requirements, (a) MaxDegreeOfParallelism: to control the maximum number of partitions then can be queried in parallel, and (b) MaxBufferedItemCount: to control the number of pre-fetched results.</span></span>

    <span data-ttu-id="89222-165">(a) ***ladění MaxDegreeOfParallelism\: *** paralelní dotaz funguje dotazováním více oddílů souběžně.</span><span class="sxs-lookup"><span data-stu-id="89222-165">(a) ***Tuning MaxDegreeOfParallelism\:*** Parallel query works by querying multiple partitions in parallel.</span></span> <span data-ttu-id="89222-166">Data z shromažďování jednotlivých oddílů je však načtených sériově s ohledem na dotaz.</span><span class="sxs-lookup"><span data-stu-id="89222-166">However, data from an individual partitioned collect is fetched serially with respect to the query.</span></span> <span data-ttu-id="89222-167">Ano nastavení MaxDegreeOfParallelism na počet oddílů má maximální riziko dosažení většina původce dotazu, zadaná jinými podmínkami systému zůstávají stejné.</span><span class="sxs-lookup"><span data-stu-id="89222-167">So, setting the MaxDegreeOfParallelism to the number of partitions has the maximum chance of achieving the most performant query, provided all other system conditions remain the same.</span></span> <span data-ttu-id="89222-168">Pokud si nejste jisti počet oddílů, můžete nastavit MaxDegreeOfParallelism na vysoké číslo, a systém zvolí minimální (počet oddílů, uživatel zadal vstup) jako MaxDegreeOfParallelism.</span><span class="sxs-lookup"><span data-stu-id="89222-168">If you don't know the number of partitions, you can set the MaxDegreeOfParallelism to a high number, and the system chooses the minimum (number of partitions, user provided input) as the MaxDegreeOfParallelism.</span></span>

    <span data-ttu-id="89222-169">Je důležité si uvědomit, že paralelní dotazy vytvořit nejlepší výhody, pokud data je rovnoměrně rozdělené mezi všechny oddíly s ohledem na dotaz.</span><span class="sxs-lookup"><span data-stu-id="89222-169">It is important to note that parallel queries produce the best benefits if the data is evenly distributed across all partitions with respect to the query.</span></span> <span data-ttu-id="89222-170">Pokud dělené kolekce je rozdělena na oddíly tak, že se soustřeďuje všechny nebo většinu dat vrácených dotazem do několika oddílů (jeden oddíl v nejhorším případě), a potom výkonu dotazu by omezené podle těchto oddílů.</span><span class="sxs-lookup"><span data-stu-id="89222-170">If the partitioned collection is partitioned such a way that all or a majority of the data returned by a query is concentrated in a few partitions (one partition in worst case), then the performance of the query would be bottlenecked by those partitions.</span></span>

    <span data-ttu-id="89222-171">(b) ***ladění MaxBufferedItemCount\: *** paralelního dotazu slouží k předem načíst výsledky během aktuální dávku výsledky zpracování klientem.</span><span class="sxs-lookup"><span data-stu-id="89222-171">(b) ***Tuning MaxBufferedItemCount\:*** Parallel query is designed to pre-fetch results while the current batch of results is being processed by the client.</span></span> <span data-ttu-id="89222-172">Předběžné načítání pomáhá v celkového zlepšení latence dotazu.</span><span class="sxs-lookup"><span data-stu-id="89222-172">The pre-fetching helps in overall latency improvement of a query.</span></span> <span data-ttu-id="89222-173">MaxBufferedItemCount je parametr omezit počet předem načtených výsledků.</span><span class="sxs-lookup"><span data-stu-id="89222-173">MaxBufferedItemCount is the parameter to limit the number of pre-fetched results.</span></span> <span data-ttu-id="89222-174">Nastavení MaxBufferedItemCount očekávaný počet výsledků vrácených (nebo vyšším číslem) umožňuje dotazu z předem načítání maximální výhody nezískají.</span><span class="sxs-lookup"><span data-stu-id="89222-174">Setting MaxBufferedItemCount to the expected number of results returned (or a higher number) allows the query to receive maximum benefit from pre-fetching.</span></span>

    <span data-ttu-id="89222-175">Upozorňujeme, že předběžné načítání funguje stejným způsobem bez ohledu MaxDegreeOfParallelism a je do jedné vyrovnávací paměti pro data ze všech oddílů.</span><span class="sxs-lookup"><span data-stu-id="89222-175">Note that pre-fetching works the same way irrespective of the MaxDegreeOfParallelism, and there is a single buffer for the data from all partitions.</span></span>  
5. <span data-ttu-id="89222-176">**Zapnout na straně serveru globálního katalogu**</span><span class="sxs-lookup"><span data-stu-id="89222-176">**Turn on server-side GC**</span></span>

    <span data-ttu-id="89222-177">V některých případech mohou pomoci snížit frekvenci uvolňování paměti.</span><span class="sxs-lookup"><span data-stu-id="89222-177">Reducing the frequency of garbage collection may help in some cases.</span></span> <span data-ttu-id="89222-178">V rozhraní .NET, nastavte [gcserver –](https://msdn.microsoft.com/library/ms229357.aspx) na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="89222-178">In .NET, set [gcServer](https://msdn.microsoft.com/library/ms229357.aspx) to true.</span></span>
6. <span data-ttu-id="89222-179">**Implementace omezení rychlosti v intervalech RetryAfter**</span><span class="sxs-lookup"><span data-stu-id="89222-179">**Implement backoff at RetryAfter intervals**</span></span>

    <span data-ttu-id="89222-180">Během testování výkonu měli zvýšit zatížení, dokud malý počet žádostí o získání omezeny.</span><span class="sxs-lookup"><span data-stu-id="89222-180">During performance testing, you should increase load until a small rate of requests get throttled.</span></span> <span data-ttu-id="89222-181">Pokud omezené, klientská aplikace měli omezení rychlosti na omezení pro interval opakování zadaný server.</span><span class="sxs-lookup"><span data-stu-id="89222-181">If throttled, the client application should backoff on throttle for the server-specified retry interval.</span></span> <span data-ttu-id="89222-182">Bere ohledy omezení rychlosti zajišťuje strávený minimální množství času čekat mezi opakovanými pokusy.</span><span class="sxs-lookup"><span data-stu-id="89222-182">Respecting the backoff ensures that you spend minimal amount of time waiting between retries.</span></span> <span data-ttu-id="89222-183">Podpora zásad opakování je součástí verze 1.8.0 a výše documentdb [.NET](documentdb-sdk-dotnet.md) a [Java](documentdb-sdk-java.md), verze 1.9.0 a vyšší z [Node.js](documentdb-sdk-node.md) a [Python ](documentdb-sdk-python.md), a všechny podporované verze [.NET Core](documentdb-sdk-dotnet-core.md) sady SDK.</span><span class="sxs-lookup"><span data-stu-id="89222-183">Retry policy support is included in Version 1.8.0 and above of the DocumentDB [.NET](documentdb-sdk-dotnet.md) and [Java](documentdb-sdk-java.md), version 1.9.0 and above of the [Node.js](documentdb-sdk-node.md) and [Python](documentdb-sdk-python.md), and all supported versions of the [.NET Core](documentdb-sdk-dotnet-core.md) SDKs.</span></span> <span data-ttu-id="89222-184">Další informace najdete v tématu [Exceeding vyhrazené omezení propustnosti](request-units.md#RequestRateTooLarge) a [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span><span class="sxs-lookup"><span data-stu-id="89222-184">For more information, see [Exceeding reserved throughput limits](request-units.md#RequestRateTooLarge) and [RetryAfter](https://msdn.microsoft.com/library/microsoft.azure.documents.documentclientexception.retryafter.aspx).</span></span>
7. <span data-ttu-id="89222-185">**Horizontální navýšení kapacity vaše úlohy klienta**</span><span class="sxs-lookup"><span data-stu-id="89222-185">**Scale out your client-workload**</span></span>

    <span data-ttu-id="89222-186">Pokud testujete na úrovních vysoké propustnosti (> 50 000 RU/s), klientská aplikace se může stát úzkým místem kvůli počítač omezení se na využití procesoru nebo sítě.</span><span class="sxs-lookup"><span data-stu-id="89222-186">If you are testing at high throughput levels (>50,000 RU/s), the client application may become the bottleneck due to the machine capping out on CPU or Network utilization.</span></span> <span data-ttu-id="89222-187">Pokud dostanete tento bod, můžete dál tak, aby nabízel další účet Cosmos DB podle škálování klientských aplikací na více serverech.</span><span class="sxs-lookup"><span data-stu-id="89222-187">If you reach this point, you can continue to push the Cosmos DB account further by scaling out your client applications across multiple servers.</span></span>
8. <span data-ttu-id="89222-188">**Dokument mezipaměti identifikátorů URI pro nižší latenci pro čtení**</span><span class="sxs-lookup"><span data-stu-id="89222-188">**Cache document URIs for lower read latency**</span></span>

    <span data-ttu-id="89222-189">Dokument mezipaměti identifikátory URI, kdykoli je to možné nejlepšího výkonu dosáhnete pro čtení.</span><span class="sxs-lookup"><span data-stu-id="89222-189">Cache document URIs whenever possible for the best read performance.</span></span>
   <a id="tune-page-size"></a>
9. <span data-ttu-id="89222-190">**Optimalizovat velikost stránky pro dotazy/číst informační kanály pro lepší výkon**</span><span class="sxs-lookup"><span data-stu-id="89222-190">**Tune the page size for queries/read feeds for better performance**</span></span>

    <span data-ttu-id="89222-191">Při provádění hromadně číst dokumenty pomocí funkce (například ReadDocumentFeedAsync) informační kanál čtení, nebo při vystavování dotazu DocumentDB SQL, budou vráceny výsledky segmentovaným způsobem, pokud sadu výsledků dotazu je příliš velký.</span><span class="sxs-lookup"><span data-stu-id="89222-191">When performing a bulk read of documents using read feed functionality (for example, ReadDocumentFeedAsync) or when issuing a DocumentDB SQL query, the results are returned in a segmented fashion if the result set is too large.</span></span> <span data-ttu-id="89222-192">Ve výchozím nastavení budou vráceny výsledky v bloky 100 položky nebo 1 MB, z těchto omezení dosáhl první.</span><span class="sxs-lookup"><span data-stu-id="89222-192">By default, results are returned in chunks of 100 items or 1 MB, whichever limit is hit first.</span></span>

    <span data-ttu-id="89222-193">Ke snížení počtu sítě zaokrouhlit služebních cest potřebnou k načtení všech příslušných výsledků, můžete zvýšit velikost stránky pomocí hlavička x-ms-max--počet položek požadavku na až 1000.</span><span class="sxs-lookup"><span data-stu-id="89222-193">To reduce the number of network round trips required to retrieve all applicable results, you can increase the page size using x-ms-max-item-count request header to up to 1000.</span></span> <span data-ttu-id="89222-194">V případech, kdy je třeba zobrazit jen pár výsledky například pokud vaše uživatelské rozhraní nebo aplikací rozhraní API vrátí jenom 10 výsledků na dobu, může také snížit velikost stránky na 10 ke snížení propustnosti využité pro čtení a dotazy.</span><span class="sxs-lookup"><span data-stu-id="89222-194">In cases where you need to display only a few results, for example, if your user interface or application API returns only 10 results a time, you can also decrease the page size to 10 to reduce the throughput consumed for reads and queries.</span></span>

    <span data-ttu-id="89222-195">Mohou také nastavit velikost stránky pomocí sady k dispozici DB SDK Cosmos.</span><span class="sxs-lookup"><span data-stu-id="89222-195">You may also set the page size using the available Cosmos DB SDKs.</span></span>  <span data-ttu-id="89222-196">Například:</span><span class="sxs-lookup"><span data-stu-id="89222-196">For example:</span></span>

        IQueryable<dynamic> authorResults = client.CreateDocumentQuery(documentCollection.SelfLink, "SELECT p.Author FROM Pages p WHERE p.Title = 'About Seattle'", new FeedOptions { MaxItemCount = 1000 });
10. <span data-ttu-id="89222-197">**Zvýšit počet vláken/úlohy**</span><span class="sxs-lookup"><span data-stu-id="89222-197">**Increase number of threads/tasks**</span></span>

    <span data-ttu-id="89222-198">V tématu [zvýšit počet vláken/úlohy](#increase-threads) v části sítě.</span><span class="sxs-lookup"><span data-stu-id="89222-198">See [Increase number of threads/tasks](#increase-threads) in the Networking section.</span></span>

11. <span data-ttu-id="89222-199">**Použijte hostitele 64-bit zpracování**</span><span class="sxs-lookup"><span data-stu-id="89222-199">**Use 64-bit host processing**</span></span>

    <span data-ttu-id="89222-200">DocumentDB SDK pracuje v 32bitové hostitelský proces, při použití DocumentDB .NET SDK verze 1.11.4 a vyšší.</span><span class="sxs-lookup"><span data-stu-id="89222-200">The DocumentDB SDK works in a 32-bit host process when you are using DocumentDB .NET SDK version 1.11.4 and above.</span></span> <span data-ttu-id="89222-201">Ale pokud používáte křížové oddílu dotazy, se doporučuje zpracování hostitelem 64-bit pro zlepšení výkonu.</span><span class="sxs-lookup"><span data-stu-id="89222-201">However, if you are using cross partition queries, 64-bit host processing is recommended for improved performance.</span></span> <span data-ttu-id="89222-202">Následující typy aplikací mít 32-bit hostitelský proces jako výchozí, tak, aby bylo možné změnit, na 64-bit, postupujte podle těchto kroků na základě typu aplikace:</span><span class="sxs-lookup"><span data-stu-id="89222-202">The following types of applications have 32-bit host process as the default, so in order to change that to 64-bit, follow these steps based on the type of your application:</span></span>

    - <span data-ttu-id="89222-203">Pro spustitelný soubor aplikace, to můžete provést zrušením zaškrtnutí políčka **raději 32bitové** možnost **vlastnosti projektu** okno na **sestavení** kartě.</span><span class="sxs-lookup"><span data-stu-id="89222-203">For Executable applications, this can be done by unchecking the **Prefer 32-bit** option in the **Project Properties** window, on the **Build** tab.</span></span>

    - <span data-ttu-id="89222-204">Pro testovací projekty založené na VSTest, to lze provést výběrem **testování**->**Test nastavení**->**výchozí architekturu procesoru jako X64**, z **testu sady Visual Studio** možnost nabídky.</span><span class="sxs-lookup"><span data-stu-id="89222-204">For VSTest based test projects, this can be done by selecting **Test**->**Test Settings**->**Default Processor Architecture as X64**, from the **Visual Studio Test** menu option.</span></span>

    - <span data-ttu-id="89222-205">Pro místně nasazené webové aplikace ASP.NET, stačí kontrolou **použít 64bitová verze služby IIS Express pro weby a projekty**v části **nástroje**->**možnosti**  -> **Projekty a řešení**->**webových projektů**.</span><span class="sxs-lookup"><span data-stu-id="89222-205">For locally deployed ASP.NET Web applications, this can be done by checking the **Use the 64-bit version of IIS Express for web sites and projects**, under **Tools**->**Options**->**Projects and Solutions**->**Web Projects**.</span></span>

    - <span data-ttu-id="89222-206">Pro ASP.NET – webové aplikace nasazené na platformě Azure, to lze provést výběrem **platforma jako 64-bit** v **nastavení aplikace** na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="89222-206">For ASP.NET Web applications deployed on Azure, this can be done by choosing the **Platform as 64-bit** in the **Application Settings** on the Azure portal.</span></span>

## <a name="indexing-policy"></a><span data-ttu-id="89222-207">Zásady indexování</span><span class="sxs-lookup"><span data-stu-id="89222-207">Indexing Policy</span></span>
1. <span data-ttu-id="89222-208">**Použít Opožděné indexování pro rychlejší sazby přijímání dobu ve špičce**</span><span class="sxs-lookup"><span data-stu-id="89222-208">**Use lazy indexing for faster peak time ingestion rates**</span></span>

    <span data-ttu-id="89222-209">Cosmos DB umožňuje zadat – na úrovni kolekce – indexování zásady, které můžete zvolit, pokud chcete, aby dokumenty v kolekci pro automatické indexování nebo ne.</span><span class="sxs-lookup"><span data-stu-id="89222-209">Cosmos DB allows you to specify – at the collection level – an indexing policy, which enables you to choose if you want the documents in a collection to be automatically indexed or not.</span></span>  <span data-ttu-id="89222-210">Kromě toho můžete taky rozhodnout mezi synchronní (konzistentní) a asynchronní aktualizace indexu (Lazy).</span><span class="sxs-lookup"><span data-stu-id="89222-210">In addition, you may also choose between synchronous (Consistent) and asynchronous (Lazy) index updates.</span></span> <span data-ttu-id="89222-211">Ve výchozím nastavení je synchronně aktualizace indexu na každý insert, replace nebo odstranění dokumentu do kolekce.</span><span class="sxs-lookup"><span data-stu-id="89222-211">By default, the index is updated synchronously on each insert, replace, or delete of a document to the collection.</span></span> <span data-ttu-id="89222-212">Synchronně režim umožňuje dotazů do stejné respektovat [úroveň konzistence](consistency-levels.md) jako u dokumentu načte bez jakéhokoli zpoždění pro index "nezaznamenaly".</span><span class="sxs-lookup"><span data-stu-id="89222-212">Synchronously mode enables the queries to honor the same [consistency level](consistency-levels.md) as that of the document reads without any delay for the index to “catch up".</span></span>

    <span data-ttu-id="89222-213">Opožděné indexování lze považovat za pro scénáře, ve kterých je zapisovat data v shluky a chcete umořit práce potřebné k indexu obsah po delší dobu.</span><span class="sxs-lookup"><span data-stu-id="89222-213">Lazy indexing may be considered for scenarios in which data is written in bursts, and you want to amortize the work required to index content over a longer period of time.</span></span> <span data-ttu-id="89222-214">Opožděné indexování také umožňuje efektivně používat zřízené propustnosti a obsluhovat požadavky na zápis ve špičce s minimální latenci.</span><span class="sxs-lookup"><span data-stu-id="89222-214">Lazy indexing also allows you to use your provisioned throughput effectively and serve write requests at peak times with minimal latency.</span></span> <span data-ttu-id="89222-215">Je důležité je však potřeba poznamenat, že pokud je povoleno indexování opožděné, výsledky dotazu jsou nakonec byl konzistentní bez ohledu na úroveň konzistence nakonfigurovaných pro účet Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="89222-215">It is important to note, however, that when lazy indexing is enabled, query results are eventually consistent regardless of the consistency level configured for the Cosmos DB account.</span></span>

    <span data-ttu-id="89222-216">Proto konzistentní indexování režimu (IndexingPolicy.IndexingMode je nastavený na konzistentní) způsobuje nejvyšší poplatků jednotky požadavek na zápis, při Lazy indexování režim (IndexingPolicy.IndexingMode je nastavený na Lazy) a žádný indexování (IndexingPolicy.Automatic je nastavený na False) mají nulové indexování náklady v době zápisu.</span><span class="sxs-lookup"><span data-stu-id="89222-216">Hence, Consistent indexing mode (IndexingPolicy.IndexingMode is set to Consistent) incurs the highest request unit charge per write, while Lazy indexing mode (IndexingPolicy.IndexingMode is set to Lazy) and no indexing (IndexingPolicy.Automatic is set to False) have zero indexing cost at the time of write.</span></span>
2. <span data-ttu-id="89222-217">**Vyloučit z indexování pro rychlejší zápisy nepoužívané cesty**</span><span class="sxs-lookup"><span data-stu-id="89222-217">**Exclude unused paths from indexing for faster writes**</span></span>

    <span data-ttu-id="89222-218">Zásady indexování cosmos DB společnosti můžete také zadat které cesty dokumentu zahrnout nebo vyloučit z indexování s využitím indexování cesty (IndexingPolicy.IncludedPaths a IndexingPolicy.ExcludedPaths).</span><span class="sxs-lookup"><span data-stu-id="89222-218">Cosmos DB’s indexing policy also allows you to specify which document paths to include or exclude from indexing by leveraging Indexing Paths (IndexingPolicy.IncludedPaths and IndexingPolicy.ExcludedPaths).</span></span> <span data-ttu-id="89222-219">Použití indexování cesty můžete jako indexování náklady jsou přímo korelační počet jedinečných cesty indexované nabízet zápisu lepší výkon a dolní index úložiště pro scénáře, ve kterých jsou předem, známé typy dotazů.</span><span class="sxs-lookup"><span data-stu-id="89222-219">The use of indexing paths can offer improved write performance and lower index storage for scenarios in which the query patterns are known beforehand, as indexing costs are directly correlated to the number of unique paths indexed.</span></span>  <span data-ttu-id="89222-220">Například následující kód ukazuje, jak vyloučit celý oddíl dokumentů (také známa jako</span><span class="sxs-lookup"><span data-stu-id="89222-220">For example, the following code shows how to exclude an entire section of the documents (a.k.a.</span></span> <span data-ttu-id="89222-221">podstrom) indexování pomocí "*" zástupný znak.</span><span class="sxs-lookup"><span data-stu-id="89222-221">a subtree) from indexing using the "*" wildcard.</span></span>

    ```C#
    var collection = new DocumentCollection { Id = "excludedPathCollection" };
    collection.IndexingPolicy.IncludedPaths.Add(new IncludedPath { Path = "/*" });
    collection.IndexingPolicy.ExcludedPaths.Add(new ExcludedPath { Path = "/nonIndexedContent/*");
    collection = await client.CreateDocumentCollectionAsync(UriFactory.CreateDatabaseUri("db"), excluded);
    ```

    <span data-ttu-id="89222-222">Další informace najdete v tématu [Azure DB Cosmos indexování zásady](indexing-policies.md).</span><span class="sxs-lookup"><span data-stu-id="89222-222">For more information, see [Azure Cosmos DB indexing policies](indexing-policies.md).</span></span>

## <a name="throughput"></a><span data-ttu-id="89222-223">Propustnost</span><span class="sxs-lookup"><span data-stu-id="89222-223">Throughput</span></span>
<a id="measure-rus"></a>

1. <span data-ttu-id="89222-224">**Měření a optimalizovat pro nižší požadavek jednotek za sekundu využití**</span><span class="sxs-lookup"><span data-stu-id="89222-224">**Measure and tune for lower request units/second usage**</span></span>

    <span data-ttu-id="89222-225">Cosmos DB nabízí širokou škálu databázové operace, včetně dotazů na relační a hierarchických UDF, uložené procedury a triggery – všechny provozní s dokumenty v databázi kolekce.</span><span class="sxs-lookup"><span data-stu-id="89222-225">Cosmos DB offers a rich set of database operations including relational and hierarchical queries with UDFs, stored procedures, and triggers – all operating on the documents within a database collection.</span></span> <span data-ttu-id="89222-226">Náklady spojené s každou z těchto operací se liší podle využití procesoru, vstupně-výstupní operace a paměť požadovanou pro dokončení operace.</span><span class="sxs-lookup"><span data-stu-id="89222-226">The cost associated with each of these operations varies based on the CPU, IO, and memory required to complete the operation.</span></span> <span data-ttu-id="89222-227">Namísto přemýšlení o a správu hardwarové prostředky si můžete představit jednotka žádosti (RU) jako jednu míru pro prostředky potřebné k provádět různé operace databáze a služeb na žádost aplikace.</span><span class="sxs-lookup"><span data-stu-id="89222-227">Instead of thinking about and managing hardware resources, you can think of a request unit (RU) as a single measure for the resources required to perform various database operations and service an application request.</span></span>

    <span data-ttu-id="89222-228">[Požadované jednotky](request-units.md) zřízeny pro každý účet databáze na základě počtu jednotek kapacity, které jste si koupili.</span><span class="sxs-lookup"><span data-stu-id="89222-228">[Request units](request-units.md) are provisioned for each database account based on the number of capacity units that you purchase.</span></span> <span data-ttu-id="89222-229">Spotřeba jednotek žádosti budou vyhodnocené jako za sekundu.</span><span class="sxs-lookup"><span data-stu-id="89222-229">Request unit consumption is evaluated as a rate per second.</span></span> <span data-ttu-id="89222-230">Aplikace, které překračují rychlost jednotky zřízené požadavků pro svůj účet je omezená, dokud rychlost klesne pod úroveň vyhrazené pro účet.</span><span class="sxs-lookup"><span data-stu-id="89222-230">Applications that exceed the provisioned request unit rate for their account is limited until the rate drops below the reserved level for the account.</span></span> <span data-ttu-id="89222-231">Pokud vaše aplikace vyžaduje vyšší úroveň propustnosti, si můžete zakoupit jednotky dodatečnou kapacitu.</span><span class="sxs-lookup"><span data-stu-id="89222-231">If your application requires a higher level of throughput, you can purchase additional capacity units.</span></span>

    <span data-ttu-id="89222-232">Složitost dotazu má dopad na tom, kolik jednotek žádosti se spotřebovávají pro operace.</span><span class="sxs-lookup"><span data-stu-id="89222-232">The complexity of a query impacts how many Request Units are consumed for an operation.</span></span> <span data-ttu-id="89222-233">Počet predikáty, povaha predikáty, počet UDF a velikost datové sady zdroje, které jsou všechny ovlivnit náklady na operace dotazů.</span><span class="sxs-lookup"><span data-stu-id="89222-233">The number of predicates, nature of the predicates, number of UDFs, and the size of the source data set all influence the cost of query operations.</span></span>

    <span data-ttu-id="89222-234">K měření režijní náklady na všechny operace (vytvoření, aktualizace nebo odstranění), zkontrolujte hlavičky x-ms požadavek – zdarma (nebo ekvivalentní vlastnost RequestCharge v ResourceResponse<T> nebo FeedResponse<T> v sadě SDK .NET) k měření počet jednotek žádosti uplatníte tyto operace.</span><span class="sxs-lookup"><span data-stu-id="89222-234">To measure the overhead of any operation (create, update, or delete), inspect the x-ms-request-charge header (or the equivalent RequestCharge property in ResourceResponse<T> or FeedResponse<T> in the .NET SDK) to measure the number of request units consumed by these operations.</span></span>

    ```C#
    // Measure the performance (request units) of writes
    ResourceResponse<Document> response = await client.CreateDocumentAsync(collectionSelfLink, myDocument);
    Console.WriteLine("Insert of document consumed {0} request units", response.RequestCharge);
    // Measure the performance (request units) of queries
    IDocumentQuery<dynamic> queryable = client.CreateDocumentQuery(collectionSelfLink, queryString).AsDocumentQuery();
    while (queryable.HasMoreResults)
         {
              FeedResponse<dynamic> queryResponse = await queryable.ExecuteNextAsync<dynamic>();
              Console.WriteLine("Query batch consumed {0} request units", queryResponse.RequestCharge);
         }
    ```             

    <span data-ttu-id="89222-235">Žádost o poplatků, vrátí se v tuto hlavičku je zlomek zřízené propustnosti (tj, 2000 RUs / druhý).</span><span class="sxs-lookup"><span data-stu-id="89222-235">The request charge returned in this header is a fraction of your provisioned throughput (i.e., 2000 RUs / second).</span></span> <span data-ttu-id="89222-236">Například pokud předchozí dotaz vrátí 1000 1KB – dokumenty, náklady na operaci je 1 000.</span><span class="sxs-lookup"><span data-stu-id="89222-236">For example, if the preceding query returns 1000 1KB-documents, the cost of the operation is 1000.</span></span> <span data-ttu-id="89222-237">Jako takový jedné sekundy ctí serveru pouze dva takových požadavků před omezení následných žádostí.</span><span class="sxs-lookup"><span data-stu-id="89222-237">As such, within one second, the server honors only two such requests before throttling subsequent requests.</span></span> <span data-ttu-id="89222-238">Další informace najdete v tématu [požadované jednotky](request-units.md) a [kalkulačky jednotek žádosti](https://www.documentdb.com/capacityplanner).</span><span class="sxs-lookup"><span data-stu-id="89222-238">For more information, see [Request units](request-units.md) and the [request unit calculator](https://www.documentdb.com/capacityplanner).</span></span>
<a id="429"></a>
2. <span data-ttu-id="89222-239">**Rychlost omezení nebo požadavků popisovač míra příliš velký**</span><span class="sxs-lookup"><span data-stu-id="89222-239">**Handle rate limiting/request rate too large**</span></span>

    <span data-ttu-id="89222-240">Když se klient pokusí delší než vyhrazenou propustností pro účet, není bez snížení výkonu na serveru a bez využití kapacity propustnosti mimo úroveň vyhrazené.</span><span class="sxs-lookup"><span data-stu-id="89222-240">When a client attempts to exceed the reserved throughput for an account, there is no performance degradation at the server and no use of throughput capacity beyond the reserved level.</span></span> <span data-ttu-id="89222-241">Server bude ho preventivně ukončení požadavek s RequestRateTooLarge (kód stavu HTTP 429) a vrátit hlavičku x-ms opakování za ms určující dobu v milisekundách, která uživatel musí počkat před provedením nového pokusu žádosti.</span><span class="sxs-lookup"><span data-stu-id="89222-241">The server will preemptively end the request with RequestRateTooLarge (HTTP status code 429) and return the x-ms-retry-after-ms header indicating the amount of time, in milliseconds, that the user must wait before reattempting the request.</span></span>

        HTTP Status 429,
        Status Line: RequestRateTooLarge
        x-ms-retry-after-ms :100

    <span data-ttu-id="89222-242">Sady SDK všechny implicitně catch této odpovědi, respektují záhlaví zadaný server opakovat po a opakujte žádost.</span><span class="sxs-lookup"><span data-stu-id="89222-242">The SDKs all implicitly catch this response, respect the server-specified retry-after header, and retry the request.</span></span> <span data-ttu-id="89222-243">Pokud váš účet je současně přistupuje více klientů, další pokus bude úspěšné.</span><span class="sxs-lookup"><span data-stu-id="89222-243">Unless your account is being accessed concurrently by multiple clients, the next retry will succeed.</span></span>

    <span data-ttu-id="89222-244">Pokud máte více než jednoho klienta kumulativně operační konzistentně vyšší rychlost požadavků, nemusí stačit výchozí počet opakování aktuálně nastavený na hodnotu 9 interně klientem; v tomto případě klient vyvolá DocumentClientException se stavovým kódem 429 k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="89222-244">If you have more than one client cumulatively operating consistently above the request rate, the default retry count currently set to 9 internally by the client may not suffice; in this case, the client throws a DocumentClientException with status code 429 to the application.</span></span> <span data-ttu-id="89222-245">Výchozí počet opakování můžete změnit nastavením RetryOptions ConnectionPolicy instance.</span><span class="sxs-lookup"><span data-stu-id="89222-245">The default retry count can be changed by setting the RetryOptions on the ConnectionPolicy instance.</span></span> <span data-ttu-id="89222-246">Ve výchozím nastavení je DocumentClientException se stavovým kódem 429 vrátila po uplynutí určité doby kumulativní Počkejte 30 sekund, pokud požadavek i nadále fungovat vyšší rychlost požadavků.</span><span class="sxs-lookup"><span data-stu-id="89222-246">By default, the DocumentClientException with status code 429 is returned after a cumulative wait time of 30 seconds if the request continues to operate above the request rate.</span></span> <span data-ttu-id="89222-247">K tomu dojde i v případě aktuální počet opakování je menší než počet maximálního počtu opakování, je jej výchozí hodnotu 9 nebo hodnotu definovanou uživatelem.</span><span class="sxs-lookup"><span data-stu-id="89222-247">This occurs even when the current retry count is less than the max retry count, be it the default of 9 or a user-defined value.</span></span>

    <span data-ttu-id="89222-248">Při automatické opakování chování pomáhá zlepšovat odolnost proti chybám a použitelnost pro většinu aplikací, zřejmě ve odds při provádění srovnávacích testů výkonu, zejména v případě, že měření latence.</span><span class="sxs-lookup"><span data-stu-id="89222-248">While the automated retry behavior helps to improve resiliency and usability for the most applications, it might come at odds when doing performance benchmarks, especially when measuring latency.</span></span>  <span data-ttu-id="89222-249">Latence zjištěnými klienta bude špiček Pokud experimentu dotkne omezení serveru a způsobí, že klient SDK bezobslužně opakovat.</span><span class="sxs-lookup"><span data-stu-id="89222-249">The client-observed latency will spike if the experiment hits the server throttle and causes the client SDK to silently retry.</span></span> <span data-ttu-id="89222-250">Abyste se vyhnuli latence špičky během výkonu experimenty, měřit poplatků vrácený jednotlivých operací a ujistěte se, že jsou pod rychlost vyhrazené požadavků operační požadavky.</span><span class="sxs-lookup"><span data-stu-id="89222-250">To avoid latency spikes during performance experiments, measure the charge returned by each operation and ensure that requests are operating below the reserved request rate.</span></span> <span data-ttu-id="89222-251">Další informace najdete v tématu [požadované jednotky](request-units.md).</span><span class="sxs-lookup"><span data-stu-id="89222-251">For more information, see [Request units](request-units.md).</span></span>
3. <span data-ttu-id="89222-252">**Návrh pro menší dokumenty pro vyšší propustnost**</span><span class="sxs-lookup"><span data-stu-id="89222-252">**Design for smaller documents for higher throughput**</span></span>

    <span data-ttu-id="89222-253">Požadavek zdarma (tj. zpracování žádosti náklady) dané operace je korelační přímo na velikost dokumentu.</span><span class="sxs-lookup"><span data-stu-id="89222-253">The request charge (i.e. request processing cost) of a given operation is directly correlated to the size of the document.</span></span> <span data-ttu-id="89222-254">Operace u velkých dokumentů nákladů více než operací pro malé dokumenty.</span><span class="sxs-lookup"><span data-stu-id="89222-254">Operations on large documents cost more than operations for small documents.</span></span>

## <a name="next-steps"></a><span data-ttu-id="89222-255">Další kroky</span><span class="sxs-lookup"><span data-stu-id="89222-255">Next steps</span></span>
<span data-ttu-id="89222-256">Ukázkovou aplikaci, používá k vyhodnocení Cosmos DB pro vysoce výkonné scénáře na několik klientských počítačů, najdete v části [výkonu a možností škálování testování pomocí Cosmos DB](performance-testing.md).</span><span class="sxs-lookup"><span data-stu-id="89222-256">For a sample application used to evaluate Cosmos DB for high-performance scenarios on a few client machines, see [Performance and scale testing with Cosmos DB](performance-testing.md).</span></span>

<span data-ttu-id="89222-257">Další informace o návrhu aplikace pro škálování a vysoký výkon, viz také [dělení a škálování v Azure Cosmos DB](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="89222-257">Also, to learn more about designing your application for scale and high performance, see [Partitioning and scaling in Azure Cosmos DB](partition-data.md).</span></span>

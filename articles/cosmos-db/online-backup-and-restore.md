---
title: "aaaOnline zálohování a obnovení s Azure Cosmos DB | Microsoft Docs"
description: "Zjistěte, jak tooperform automatické zálohování a obnovení na databázi Azure Cosmos DB."
keywords: "zálohování a obnovení, zálohování online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: a0b464c95681dfc7b5462b02bf04c2c43d6bc16f
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="00a25-104">Automatické online zálohování a obnovení databáze Cosmos Azure</span><span class="sxs-lookup"><span data-stu-id="00a25-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="00a25-105">Azure Cosmos DB automaticky provede zálohování všech dat v pravidelných intervalech.</span><span class="sxs-lookup"><span data-stu-id="00a25-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="00a25-106">Automatické zálohování Hello se provádějí bez ovlivnění hello výkon nebo dostupnost databázové operace.</span><span class="sxs-lookup"><span data-stu-id="00a25-106">hello automatic backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="00a25-107">Všechny zálohy se ukládají odděleně v jiné službě úložiště a tyto zálohy jsou globálně replikovat pro odolnost proti místní havárie.</span><span class="sxs-lookup"><span data-stu-id="00a25-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="00a25-108">Automatické zálohování Hello jsou určené pro scénáře, když jste omylem odstranit kontejner vaší Comos DB a později vyžadují obnovení dat nebo řešení zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="00a25-108">hello automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="00a25-109">Tento článek začíná rychlé rekapitulace hello data redundance a dostupnosti v Cosmos DB a pak popisuje zálohování.</span><span class="sxs-lookup"><span data-stu-id="00a25-109">This article starts with a quick recap of hello data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="00a25-110">Vysoká dostupnost s Cosmos DB - rekapitulace</span><span class="sxs-lookup"><span data-stu-id="00a25-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="00a25-111">Cosmos DB je navrženou toobe [globálně distribuované](distribute-data-globally.md) – umožňuje tooscale propustnosti nad několika oblastmi Azure společně s zásad řízené převzetí služeb při selhání a transparentní rozhraní API více funkci.</span><span class="sxs-lookup"><span data-stu-id="00a25-111">Cosmos DB is designed toobe [globally distributed](distribute-data-globally.md) – it allows you tooscale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="00a25-112">Jako nabídku databáze systému [99,99 % dostupnost SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db), všech zápisů hello v Cosmos DB jsou trvale potvrzena toolocal disky podle kvora replik v rámci místního datového centra dříve, než potvrdil toohello klienta.</span><span class="sxs-lookup"><span data-stu-id="00a25-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all hello writes in Cosmos DB are durably committed toolocal disks by a quorum of replicas within a local data center before acknowledging toohello client.</span></span> <span data-ttu-id="00a25-113">Upozorňujeme, že hello vysokou dostupnost databáze Cosmos spoléhá na místní úložiště a nezávisí na žádné technologie externího úložiště.</span><span class="sxs-lookup"><span data-stu-id="00a25-113">Note that hello high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="00a25-114">Kromě toho pokud databázový účet je přidružen více než jedné oblasti Azure, replikují se v jiných oblastech také vaše zápisy.</span><span class="sxs-lookup"><span data-stu-id="00a25-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="00a25-115">tooscale daty propustnost a přístup v nízkou latenci, může mít mnoho pro čtení oblasti spojené s vaším účtem databáze podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="00a25-115">tooscale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="00a25-116">V každé oblasti pro čtení je spolehlivě hello (replikované) dat zachová pro sady replik.</span><span class="sxs-lookup"><span data-stu-id="00a25-116">In each read region, hello (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="00a25-117">Jak je znázorněno v následujícím diagramu hello, je jediný kontejner Cosmos DB [vodorovně oddílů](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="00a25-117">As illustrated in hello following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="00a25-118">"Oddíl" je označený jako kruh v následujícím diagramu hello a každý oddíl je zpřístupnit pomocí sady replik.</span><span class="sxs-lookup"><span data-stu-id="00a25-118">A “partition” is denoted by a circle in hello following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="00a25-119">Toto je místní distribuční hello v rámci jedné oblasti Azure (označen hello osy X).</span><span class="sxs-lookup"><span data-stu-id="00a25-119">This is hello local distribution within a single Azure region (denoted by hello X axis).</span></span> <span data-ttu-id="00a25-120">Dále každý oddíl (s jeho odpovídající sady replik) je pak globálně distribuované nad několika oblastmi spojené s vaším účtem databáze (například v tento obrázek hello tři oblasti – Východ USA, západní USA a střed).</span><span class="sxs-lookup"><span data-stu-id="00a25-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration hello three regions – East US, West US and Central India).</span></span> <span data-ttu-id="00a25-121">Hello "oddílu sada" je globálně distribuované entity, která obsahuje více kopií vašich dat v jednotlivých oblastech (označen osy hello Y).</span><span class="sxs-lookup"><span data-stu-id="00a25-121">hello “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by hello Y axis).</span></span> <span data-ttu-id="00a25-122">Můžete přiřadit prioritu toohello oblasti spojené s vaším účtem databáze a databáze Cosmos bude transparentně další oblasti toohello převzetí služeb při selhání v případě havárie.</span><span class="sxs-lookup"><span data-stu-id="00a25-122">You can assign priority toohello regions associated with your database account and Cosmos DB will transparently failover toohello next region in case of disaster.</span></span> <span data-ttu-id="00a25-123">Můžete také ručně simulovat převzetí služeb při selhání tootest hello začátku do konce dostupnosti vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="00a25-123">You can also manually simulate failover tootest hello end-to-end availability of your application.</span></span>  

<span data-ttu-id="00a25-124">Hello následující obrázek ukazuje hello vysoký stupeň redundance s Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="00a25-124">hello following image illustrates hello high degree of redundancy with Cosmos DB.</span></span>

![Vysoký stupeň redundance s Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Vysoký stupeň redundance s Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="00a25-127">Úplné, automatické, online zálohování</span><span class="sxs-lookup"><span data-stu-id="00a25-127">Full, automatic, online backups</span></span>
<span data-ttu-id="00a25-128">Bohužel se I odstraněn Moje kontejner nebo databáze.</span><span class="sxs-lookup"><span data-stu-id="00a25-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="00a25-129">S Cosmos databáze nejen vaše data, ale hello zálohování dat také probíhají vysoce redundantní a odolné tooregional havárie.</span><span class="sxs-lookup"><span data-stu-id="00a25-129">With Cosmos DB, not only your data, but hello backups of your data are also made highly redundant and resilient tooregional disasters.</span></span> <span data-ttu-id="00a25-130">Tyto automatizované zálohy jsou aktuálně prováděné přibližně každé čtyři hodiny a nejnovější 2 zálohy jsou uložené za všech okolností.</span><span class="sxs-lookup"><span data-stu-id="00a25-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="00a25-131">Pokud jsou hello data ať už náhodně vyřazeny nebo je poškozen, prosím [požádejte podporu Azure](https://azure.microsoft.com/support/options/) v rámci 8 hodin.</span><span class="sxs-lookup"><span data-stu-id="00a25-131">If hello data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="00a25-132">bez ovlivnění hello výkon nebo dostupnost databázové operace jsou provedeny Hello zálohy.</span><span class="sxs-lookup"><span data-stu-id="00a25-132">hello backups are taken without affecting hello performance or availability of your database operations.</span></span> <span data-ttu-id="00a25-133">Cosmos DB přebírá zálohování hello hello pozadí bez použití vašeho zřízené RUs nebo které mají vliv na výkon hello a bez ovlivnění dostupnosti hello vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="00a25-133">Cosmos DB takes hello backup in hello background without consuming your provisioned RUs or affecting hello performance and without affecting hello availability of your database.</span></span> 

<span data-ttu-id="00a25-134">Na rozdíl od vaše data, která je uložena v rámci Cosmos DB automatické zálohování hello ukládají ve službě Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="00a25-134">Unlike your data that is stored inside Cosmos DB, hello automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="00a25-135">tooguarantee hello nízkou latenci nebo efektivní nahrávání, hello snímek zálohy se nahraný tooan instanci Azure Blob storage ve stejné oblasti jako hello aktuální zápisu oblast účtu databáze Cosmos DB hello.</span><span class="sxs-lookup"><span data-stu-id="00a25-135">tooguarantee hello low latency/efficient upload, hello snapshot of your backup is uploaded tooan instance of Azure Blob storage in hello same region as hello current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="00a25-136">V zájmu odolnosti proti místní po havárii každý snímek zálohovaných dat do Azure Blob Storage opět replikují přes tooanother oblast geograficky redundantní úložiště (GRS).</span><span class="sxs-lookup"><span data-stu-id="00a25-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) tooanother region.</span></span> <span data-ttu-id="00a25-137">Hello následující diagram ukazuje, že je hello celý Cosmos DB kontejneru (s všechny tři primární oddíly v západní USA, v tomto příkladu) zálohovány v vzdáleného účtu úložiště objektů Blob Azure v západní USA a GRS replikovat tooEast nás.</span><span class="sxs-lookup"><span data-stu-id="00a25-137">hello following diagram shows that hello entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated tooEast US.</span></span> 

<span data-ttu-id="00a25-138">Hello následující obrázek ukazuje pravidelné úplné zálohy všech Cosmos DB entit ve službě Azure Storage GRS.</span><span class="sxs-lookup"><span data-stu-id="00a25-138">hello following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Pravidelné úplné zálohy všechny entity Cosmos DB v GRS Azure Storage](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="00a25-140">Doba uchovávání záloh</span><span class="sxs-lookup"><span data-stu-id="00a25-140">Backup retention period</span></span>
<span data-ttu-id="00a25-141">Jak je popsáno výše, Azure Cosmos DB trvá snímky dat každé čtyři hodiny a uchovává hello posledních dvou snímky všech oddílů po dobu 30 dnů.</span><span class="sxs-lookup"><span data-stu-id="00a25-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains hello last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="00a25-142">Podle našich předpisy jsou snímky vymazány po 90 dnech.</span><span class="sxs-lookup"><span data-stu-id="00a25-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="00a25-143">Pokud chcete toomaintain vlastní snímky, můžete použít možnost tooJSON export hello v hello Azure Cosmos DB [nástroj pro migraci dat](import-data.md#export-to-json-file) tooschedule další zálohy.</span><span class="sxs-lookup"><span data-stu-id="00a25-143">If you want toomaintain your own snapshots, you can use hello export tooJSON option in hello Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) tooschedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="00a25-144">Obnovení databáze z online zálohování</span><span class="sxs-lookup"><span data-stu-id="00a25-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="00a25-145">Pokud omylem odstraníte databáze nebo kolekce, můžete [souboru lístek podpory](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) nebo [volání podpory Azure](https://azure.microsoft.com/support/options/) toorestore hello data z posledního automatické zálohování hello.</span><span class="sxs-lookup"><span data-stu-id="00a25-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) toorestore hello data from hello last automatic backup.</span></span> <span data-ttu-id="00a25-146">Pokud budete potřebovat toorestore databáze z důvodu problému s poškozením dat, najdete v části [zpracování poškození dat](#handling-data-corruption) podle potřeby tootake další kroky tooprevent hello poškozená data ze zálohy průbojnými hello.</span><span class="sxs-lookup"><span data-stu-id="00a25-146">If you need toorestore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need tootake additional steps tooprevent hello corrupted data from penetrating hello backups.</span></span> <span data-ttu-id="00a25-147">Pro konkrétní snímek vašeho zálohování toobe obnovit Cosmos DB vyžaduje, aby hello data byla k dispozici pro dobu trvání hello hello cyklus zálohování tohoto snímku.</span><span class="sxs-lookup"><span data-stu-id="00a25-147">For a specific snapshot of your backup toobe restored, Cosmos DB requires that hello data was available for hello duration of hello backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="00a25-148">Zpracování poškození dat</span><span class="sxs-lookup"><span data-stu-id="00a25-148">Handling data corruption</span></span>
<span data-ttu-id="00a25-149">Azure Cosmos DB zachová hello posledních dvou zálohování všech oddílů v systému hello.</span><span class="sxs-lookup"><span data-stu-id="00a25-149">Azure Cosmos DB retains hello last two backups of every partition in hello system.</span></span> <span data-ttu-id="00a25-150">Tento model funguje dobře, když kontejner (kolekce dokumentů, graf, tabulku) nebo v databázi je omylem odstranit, protože jeden z poslední verze hello může být obnovena.</span><span class="sxs-lookup"><span data-stu-id="00a25-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of hello last versions can be restored.</span></span> <span data-ttu-id="00a25-151">Však v hello tom případě, když uživatelé mohou zavést kvůli problému s poškozením dat, Azure Cosmos DB může být vědomi hello poškození dat, a je možné, že hello poškození může mít procházejí hello zálohy.</span><span class="sxs-lookup"><span data-stu-id="00a25-151">However, in hello case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of hello data corruption, and it is possible that hello corruption may have penetrated hello backups.</span></span> <span data-ttu-id="00a25-152">Jakmile se detekuje poškození, byste měli odstranit kontejner hello poškozený (kolekce nebo grafu nebo tabulky) tak, aby zálohování jsou chráněny před přepsáním s poškozenými daty.</span><span class="sxs-lookup"><span data-stu-id="00a25-152">As soon as corruption is detected, you should delete hello corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="00a25-153">Vzhledem k tomu, že poslední zálohy hello může být staré čtyři hodiny, můžete použít hello uživatele [změnit informačního kanálu](change-feed.md) toocapture a úložiště hello poslední čtyři hodiny vhodné dat před odstraněním hello kontejneru.</span><span class="sxs-lookup"><span data-stu-id="00a25-153">Since hello last backup could be four hours old, hello user can employ [change feed](change-feed.md) toocapture and store hello last four hours worth of data before deleting hello container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="00a25-154">Další kroky</span><span class="sxs-lookup"><span data-stu-id="00a25-154">Next steps</span></span>

<span data-ttu-id="00a25-155">najdete v databázi v několika datových centrech tooreplicate [distribuci dat globálně pomocí Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="00a25-155">tooreplicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="00a25-156">toofile kontaktujte podporu Azure [souboru lístek z portálu Azure hello](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="00a25-156">toofile contact Azure Support, [file a ticket from hello Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>


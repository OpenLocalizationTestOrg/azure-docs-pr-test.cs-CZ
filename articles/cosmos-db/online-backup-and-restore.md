---
title: "Online zálohování a obnovení s Azure Cosmos DB | Microsoft Docs"
description: "Zjistěte, jak provést automatické zálohování a obnovení na databázi Azure Cosmos DB."
keywords: "zálohování a obnovení, zálohování online"
services: cosmos-db
documentationcenter: 
author: RahulPrasad16
manager: jhubbard
editor: monicar
ms.assetid: 98eade4a-7ef4-4667-b167-6603ecd80b79
ms.service: cosmos-db
ms.workload: data-services
ms.tgt_pltfrm: na
ms.devlang: multiple
ms.topic: article
ms.date: 08/11/2017
ms.author: raprasa
ms.openlocfilehash: 130f0eb259621737d6dbdb151e363915fb334ce1
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="automatic-online-backup-and-restore-with-azure-cosmos-db"></a><span data-ttu-id="95f4a-104">Automatické online zálohování a obnovení databáze Cosmos Azure</span><span class="sxs-lookup"><span data-stu-id="95f4a-104">Automatic online backup and restore with Azure Cosmos DB</span></span>
<span data-ttu-id="95f4a-105">Azure Cosmos DB automaticky provede zálohování všech dat v pravidelných intervalech.</span><span class="sxs-lookup"><span data-stu-id="95f4a-105">Azure Cosmos DB automatically takes backups of all your data at regular intervals.</span></span> <span data-ttu-id="95f4a-106">Automatické zálohování se provádějí bez vlivu na výkon nebo dostupnost databázových operací.</span><span class="sxs-lookup"><span data-stu-id="95f4a-106">The automatic backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="95f4a-107">Všechny zálohy se ukládají odděleně v jiné službě úložiště a tyto zálohy jsou globálně replikovat pro odolnost proti místní havárie.</span><span class="sxs-lookup"><span data-stu-id="95f4a-107">All your backups are stored separately in another storage service, and those backups are globally replicated for resiliency against regional disasters.</span></span> <span data-ttu-id="95f4a-108">Automatické zálohování jsou určené pro scénáře, když jste omylem odstranit kontejner vaší Comos DB a později vyžadují obnovení dat nebo řešení zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="95f4a-108">The automatic backups are intended for scenarios when you accidentally delete your Comos DB container and later require data recovery or a disaster recovery solution.</span></span>  

<span data-ttu-id="95f4a-109">Tento článek začíná rychlé rekapitulace data redundance a dostupnosti v Cosmos DB a pak popisuje zálohování.</span><span class="sxs-lookup"><span data-stu-id="95f4a-109">This article starts with a quick recap of the data redundancy and availability in Cosmos DB, and then discusses backups.</span></span> 

## <a name="high-availability-with-cosmos-db---a-recap"></a><span data-ttu-id="95f4a-110">Vysoká dostupnost s Cosmos DB - rekapitulace</span><span class="sxs-lookup"><span data-stu-id="95f4a-110">High availability with Cosmos DB - a recap</span></span>
<span data-ttu-id="95f4a-111">Cosmos DB je navržený jako [globálně distribuované](distribute-data-globally.md) – umožňuje škálovat propustnosti nad několika oblastmi Azure společně s zásad řízené převzetí služeb při selhání a transparentní rozhraní API více funkci.</span><span class="sxs-lookup"><span data-stu-id="95f4a-111">Cosmos DB is designed to be [globally distributed](distribute-data-globally.md) – it allows you to scale throughput across multiple Azure regions along with policy driven failover and transparent multi-homing APIs.</span></span> <span data-ttu-id="95f4a-112">Jako nabídku databáze systému [99,99 % dostupnost SLA](https://azure.microsoft.com/support/legal/sla/cosmos-db), všechny provede zápis do databáze. Cosmos jsou trvale potvrzena na místní disky ve kvora replik v rámci místního datového centra dříve, než potvrdil klientovi.</span><span class="sxs-lookup"><span data-stu-id="95f4a-112">As a database system offering [99.99% availability SLAs](https://azure.microsoft.com/support/legal/sla/cosmos-db), all the writes in Cosmos DB are durably committed to local disks by a quorum of replicas within a local data center before acknowledging to the client.</span></span> <span data-ttu-id="95f4a-113">Všimněte si, že vysokou dostupnost databáze Cosmos spoléhá na místní úložiště a nezávisí na žádné technologie externího úložiště.</span><span class="sxs-lookup"><span data-stu-id="95f4a-113">Note that the high availability of Cosmos DB relies on local storage and does not depend on any external storage technologies.</span></span> <span data-ttu-id="95f4a-114">Kromě toho pokud databázový účet je přidružen více než jedné oblasti Azure, replikují se v jiných oblastech také vaše zápisy.</span><span class="sxs-lookup"><span data-stu-id="95f4a-114">Additionally, if your database account is associated with more than one Azure region, your writes are replicated across other regions as well.</span></span> <span data-ttu-id="95f4a-115">Škálovat vaše data propustnost a přístup v nízkou latenci, může mít mnoho pro čtení oblasti spojené s vaším účtem databáze podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="95f4a-115">To scale your throughput and access data at low latencies, you can have as many read regions associated with your database account as you like.</span></span> <span data-ttu-id="95f4a-116">V každé oblasti pro čtení je spolehlivě (replikovaných) dat zachová pro sady replik.</span><span class="sxs-lookup"><span data-stu-id="95f4a-116">In each read region, the (replicated) data is durably persisted across a replica set.</span></span>  

<span data-ttu-id="95f4a-117">Jak je znázorněno v následujícím diagramu, je jediný kontejner Cosmos DB [vodorovně oddílů](partition-data.md).</span><span class="sxs-lookup"><span data-stu-id="95f4a-117">As illustrated in the following diagram, a single Cosmos DB container is [horizontally partitioned](partition-data.md).</span></span> <span data-ttu-id="95f4a-118">Kruh v následujícím diagramu je označený jako "Oddíl" a každý oddíl je zpřístupnit pomocí sady replik.</span><span class="sxs-lookup"><span data-stu-id="95f4a-118">A “partition” is denoted by a circle in the following diagram, and each partition is made highly available via a replica set.</span></span> <span data-ttu-id="95f4a-119">Toto je místní distribuční v rámci jedné oblasti Azure (označen osy X).</span><span class="sxs-lookup"><span data-stu-id="95f4a-119">This is the local distribution within a single Azure region (denoted by the X axis).</span></span> <span data-ttu-id="95f4a-120">Dále každý oddíl (s jeho odpovídající sady replik) je pak globálně distribuované nad několika oblastmi spojené s vaším účtem databáze (například v tento obrázek tří oblastí – Východ USA, západní USA a střed).</span><span class="sxs-lookup"><span data-stu-id="95f4a-120">Further, each partition (with its corresponding replica set) is then globally distributed across multiple regions associated with your database account (for example, in this illustration the three regions – East US, West US and Central India).</span></span> <span data-ttu-id="95f4a-121">"Oddílu sada" je globálně distribuované entity, která obsahuje více kopií vašich dat v jednotlivých oblastech (označen osy Y).</span><span class="sxs-lookup"><span data-stu-id="95f4a-121">The “partition set” is a globally distributed entity comprising of multiple copies of your data in each region (denoted by the Y axis).</span></span> <span data-ttu-id="95f4a-122">Můžete přiřadit prioritu oblasti spojené s vaším účtem databáze a databáze Cosmos bude transparentně převzetí služeb při selhání pro další oblast v případě havárie.</span><span class="sxs-lookup"><span data-stu-id="95f4a-122">You can assign priority to the regions associated with your database account and Cosmos DB will transparently failover to the next region in case of disaster.</span></span> <span data-ttu-id="95f4a-123">Můžete také ručně simulovat převzetí služeb při selhání začátku do konce dostupnosti vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="95f4a-123">You can also manually simulate failover to test the end-to-end availability of your application.</span></span>  

<span data-ttu-id="95f4a-124">Následující obrázek ukazuje vysoký stupeň redundance s Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="95f4a-124">The following image illustrates the high degree of redundancy with Cosmos DB.</span></span>

![Vysoký stupeň redundance s Cosmos DB](./media/online-backup-and-restore/redundancy.png)

![Vysoký stupeň redundance s Cosmos DB](./media/online-backup-and-restore/global-distribution.png)

## <a name="full-automatic-online-backups"></a><span data-ttu-id="95f4a-127">Úplné, automatické, online zálohování</span><span class="sxs-lookup"><span data-stu-id="95f4a-127">Full, automatic, online backups</span></span>
<span data-ttu-id="95f4a-128">Bohužel se I odstraněn Moje kontejner nebo databáze.</span><span class="sxs-lookup"><span data-stu-id="95f4a-128">Oops, I deleted my container or database!</span></span> <span data-ttu-id="95f4a-129">S Cosmos databáze jenom data, ale zálohování dat spočívá ve vysoce redundantní a odolné regionální havárie.</span><span class="sxs-lookup"><span data-stu-id="95f4a-129">With Cosmos DB, not only your data, but the backups of your data are also made highly redundant and resilient to regional disasters.</span></span> <span data-ttu-id="95f4a-130">Tyto automatizované zálohy jsou aktuálně prováděné přibližně každé čtyři hodiny a nejnovější 2 zálohy jsou uložené za všech okolností.</span><span class="sxs-lookup"><span data-stu-id="95f4a-130">These automated backups are currently taken approximately every four hours and latest 2 backups are stored at all times.</span></span> <span data-ttu-id="95f4a-131">Pokud jsou data ať už náhodně vyřazeny nebo je poškozen, prosím [požádejte podporu Azure](https://azure.microsoft.com/support/options/) v rámci 8 hodin.</span><span class="sxs-lookup"><span data-stu-id="95f4a-131">If the data is accidently dropped or corrupted, please [contact Azure support](https://azure.microsoft.com/support/options/) within 8 hours.</span></span> 

<span data-ttu-id="95f4a-132">Zálohy jsou převzaty bez vlivu na výkon nebo dostupnost databázových operací.</span><span class="sxs-lookup"><span data-stu-id="95f4a-132">The backups are taken without affecting the performance or availability of your database operations.</span></span> <span data-ttu-id="95f4a-133">Cosmos DB přebírá zálohování na pozadí bez použití vašeho zřízené RUs nebo které mají vliv na výkon a bez ovlivnění dostupnosti vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="95f4a-133">Cosmos DB takes the backup in the background without consuming your provisioned RUs or affecting the performance and without affecting the availability of your database.</span></span> 

<span data-ttu-id="95f4a-134">Na rozdíl od vaše data, která je uložena v rámci Cosmos DB automatické zálohování ukládají ve službě Azure Blob Storage.</span><span class="sxs-lookup"><span data-stu-id="95f4a-134">Unlike your data that is stored inside Cosmos DB, the automatic backups are stored in Azure Blob Storage service.</span></span> <span data-ttu-id="95f4a-135">Pokud chcete zajistit nízkou latenci nebo efektivní nahrávání, je snímek zálohy nahrán do instanci Azure Blob storage ve stejné oblasti jako aktuální oblasti zápisu účtu databáze Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="95f4a-135">To guarantee the low latency/efficient upload, the snapshot of your backup is uploaded to an instance of Azure Blob storage in the same region as the current write region of your Cosmos DB database account.</span></span> <span data-ttu-id="95f4a-136">V zájmu odolnosti proti místní po havárii každý snímek zálohovaných dat do Azure Blob Storage opět replikují přes geograficky redundantní úložiště (GRS) do jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="95f4a-136">For resiliency against regional disaster, each snapshot of your backup data in Azure Blob Storage is again replicated via geo-redundant storage (GRS) to another region.</span></span> <span data-ttu-id="95f4a-137">Následující diagram znázorňuje, že celého kontejneru Cosmos DB (s všechny tři primární oddíly v západní USA, v tomto příkladu) je zálohovány v vzdáleného účtu úložiště objektů Blob Azure v západní USA a pak GRS replikované východní USA.</span><span class="sxs-lookup"><span data-stu-id="95f4a-137">The following diagram shows that the entire Cosmos DB container (with all three primary partitions in West US, in this example) is backed up in a remote Azure Blob Storage account in West US and then GRS replicated to East US.</span></span> 

<span data-ttu-id="95f4a-138">Následující obrázek ukazuje pravidelné úplné zálohy všech Cosmos DB entit ve službě Azure Storage GRS.</span><span class="sxs-lookup"><span data-stu-id="95f4a-138">The following image illustrates periodic full backups of all Cosmos DB entities in GRS Azure Storage.</span></span>

![Pravidelné úplné zálohy všechny entity Cosmos DB v GRS Azure Storage](./media/online-backup-and-restore/automatic-backup.png)

## <a name="backup-retention-period"></a><span data-ttu-id="95f4a-140">Doba uchovávání záloh</span><span class="sxs-lookup"><span data-stu-id="95f4a-140">Backup retention period</span></span>
<span data-ttu-id="95f4a-141">Jak je popsáno výše, Azure Cosmos DB trvá snímky dat každé čtyři hodiny a uchovává posledních dvou snímky všech oddílů po dobu 30 dnů.</span><span class="sxs-lookup"><span data-stu-id="95f4a-141">As described above, Azure Cosmos DB takes snapshots of your data every four hours and retains the last two snapshots of every partition for 30 days.</span></span> <span data-ttu-id="95f4a-142">Podle našich předpisy jsou snímky vymazány po 90 dnech.</span><span class="sxs-lookup"><span data-stu-id="95f4a-142">Per our compliance regulations, snapshots are purged after 90 days.</span></span>

<span data-ttu-id="95f4a-143">Pokud chcete zachovat vlastní snímky, můžete použít metodu exportu možnosti JSON v Azure Cosmos DB [nástroj pro migraci dat](import-data.md#export-to-json-file) naplánovat další zálohy.</span><span class="sxs-lookup"><span data-stu-id="95f4a-143">If you want to maintain your own snapshots, you can use the export to JSON option in the Azure Cosmos DB [Data Migration tool](import-data.md#export-to-json-file) to schedule additional backups.</span></span> 

## <a name="restoring-a-database-from-an-online-backup"></a><span data-ttu-id="95f4a-144">Obnovení databáze z online zálohování</span><span class="sxs-lookup"><span data-stu-id="95f4a-144">Restoring a database from an online backup</span></span>
<span data-ttu-id="95f4a-145">Pokud omylem odstraníte databáze nebo kolekce, můžete [souboru lístek podpory](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) nebo [volání podpory Azure](https://azure.microsoft.com/support/options/) k obnovení dat z poslední automatické zálohování.</span><span class="sxs-lookup"><span data-stu-id="95f4a-145">If you accidentally delete your database or collection, you can [file a support ticket](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade) or [call Azure support](https://azure.microsoft.com/support/options/) to restore the data from the last automatic backup.</span></span> <span data-ttu-id="95f4a-146">Pokud potřebujete obnovit databázi z důvodu problému s poškozením dat, přečtěte si téma [zpracování poškození dat](#handling-data-corruption) jako je třeba provést další kroky k zabránit narušující zálohování poškozená data.</span><span class="sxs-lookup"><span data-stu-id="95f4a-146">If you need to restore your database because of data corruption issue, see [Handling data corruption](#handling-data-corruption) as you need to take additional steps to prevent the corrupted data from penetrating the backups.</span></span> <span data-ttu-id="95f4a-147">Pro konkrétní snímek zálohy obnovit Cosmos DB vyžaduje, aby data byla k dispozici po dobu trvání cyklu zálohování pro tento snímek.</span><span class="sxs-lookup"><span data-stu-id="95f4a-147">For a specific snapshot of your backup to be restored, Cosmos DB requires that the data was available for the duration of the backup cycle for that snapshot.</span></span>

## <a name="handling-data-corruption"></a><span data-ttu-id="95f4a-148">Zpracování poškození dat</span><span class="sxs-lookup"><span data-stu-id="95f4a-148">Handling data corruption</span></span>
<span data-ttu-id="95f4a-149">Azure Cosmos DB ponechá posledních dvou zálohování všech oddílů v systému.</span><span class="sxs-lookup"><span data-stu-id="95f4a-149">Azure Cosmos DB retains the last two backups of every partition in the system.</span></span> <span data-ttu-id="95f4a-150">Tento model funguje dobře, když kontejner (kolekce dokumentů, graf, tabulku) nebo v databázi je omylem odstranit, protože jeden z poslední verze může být obnovena.</span><span class="sxs-lookup"><span data-stu-id="95f4a-150">This model works very well when a container (collection of documents, graph, table) or a database is accidentally deleted since one of the last versions can be restored.</span></span> <span data-ttu-id="95f4a-151">Ale v tom případě, když uživatelé mohou zavést kvůli problému s poškozením dat, Azure Cosmos DB může být vědomi poškození dat, a je možné, že poškození může procházejí zálohování.</span><span class="sxs-lookup"><span data-stu-id="95f4a-151">However, in the case when when users may introduce a data corruption issue, Azure Cosmos DB may be unaware of the data corruption, and it is possible that the corruption may have penetrated the backups.</span></span> <span data-ttu-id="95f4a-152">Jakmile se detekuje poškození, byste měli odstranit poškozená kontejneru (kolekce nebo grafu nebo tabulky), aby zálohování jsou chráněny před přepsáním s poškozenými daty.</span><span class="sxs-lookup"><span data-stu-id="95f4a-152">As soon as corruption is detected, you should delete the corrupted container (collection/graph/table) so that backups are protected from being overwritten with corrupted data.</span></span> <span data-ttu-id="95f4a-153">Vzhledem k tomu, že poslední zálohy může být staré čtyři hodiny, můžete použít uživatele [změnit informačního kanálu](change-feed.md) zaznamenání a uložení poslední čtyři hodiny vhodné dat před odstraněním kontejneru.</span><span class="sxs-lookup"><span data-stu-id="95f4a-153">Since the last backup could be four hours old, the user can employ [change feed](change-feed.md) to capture and store the last four hours worth of data before deleting the container.</span></span>

## <a name="next-steps"></a><span data-ttu-id="95f4a-154">Další kroky</span><span class="sxs-lookup"><span data-stu-id="95f4a-154">Next steps</span></span>

<span data-ttu-id="95f4a-155">K replikaci databáze v několika datových centrech, najdete v části [distribuci dat globálně pomocí Cosmos DB](distribute-data-globally.md).</span><span class="sxs-lookup"><span data-stu-id="95f4a-155">To replicate your database in multiple data centers, see [distribute your data globally with Cosmos DB](distribute-data-globally.md).</span></span> 

<span data-ttu-id="95f4a-156">Soubor kontaktujte podporu Azure [souboru lístek z portálu Azure](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span><span class="sxs-lookup"><span data-stu-id="95f4a-156">To file contact Azure Support, [file a ticket from the Azure portal](https://portal.azure.com/?#blade/Microsoft_Azure_Support/HelpAndSupportBlade).</span></span>


---
title: "Zachovat výstup úlohy a úkolů do služby Azure Storage pomocí rozhraní API služby Azure Batch | Microsoft Docs"
description: "Naučte se používat rozhraní API služby Batch udržení výstup úlohy a úlohy Batch do služby Azure Storage."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 2530b7c20347b9fb58aee4dfe693847cf3911741
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="persist-task-data-to-azure-storage-with-the-batch-service-api"></a><span data-ttu-id="6279d-103">Zachovat data úloh do služby Azure Storage pomocí rozhraní API služby Batch</span><span class="sxs-lookup"><span data-stu-id="6279d-103">Persist task data to Azure Storage with the Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="6279d-104">Počínaje verzí 2017-05-01, rozhraní API služby Batch podporuje zachování výstupní data do úložiště Azure pro úlohy a úkolech Správce úloh, které běží na fondy s danou konfiguraci virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="6279d-104">Starting with version 2017-05-01, the Batch service API supports persisting output data to Azure Storage for tasks and job manager tasks that run on pools with the virtual machine configuration.</span></span> <span data-ttu-id="6279d-105">Přidáte-li úlohu, můžete zadat kontejner ve službě Azure Storage jako cíl pro výstup úkolu.</span><span class="sxs-lookup"><span data-stu-id="6279d-105">When you add a task, you can specify a container in Azure Storage as the destination for the task's output.</span></span> <span data-ttu-id="6279d-106">Služba Batch pak zapíše veškerá výstupní data do tohoto kontejneru, po dokončení úlohy.</span><span class="sxs-lookup"><span data-stu-id="6279d-106">The Batch service then writes any output data to that container when the task is complete.</span></span>

<span data-ttu-id="6279d-107">Výhodou pomocí rozhraní API služby Batch udržení výstup úlohy je, že není potřeba upravovat aplikace, který je spuštěn úkol.</span><span class="sxs-lookup"><span data-stu-id="6279d-107">An advantage to using the Batch service API to persist task output is that you do not need to modify the application that the task is running.</span></span> <span data-ttu-id="6279d-108">Místo toho se několik jednoduchých úprav klientskou aplikaci, můžete zachovat výstup úkolu v rámci kód, který vytvoří úlohu.</span><span class="sxs-lookup"><span data-stu-id="6279d-108">Instead, with a few simple modifications to your client application, you can persist the task's output from within the code that creates the task.</span></span>   

## <a name="when-do-i-use-the-batch-service-api-to-persist-task-output"></a><span data-ttu-id="6279d-109">Když pomocí rozhraní API služby Batch lze zachovat výstup úlohy?</span><span class="sxs-lookup"><span data-stu-id="6279d-109">When do I use the Batch service API to persist task output?</span></span>

<span data-ttu-id="6279d-110">Azure Batch poskytuje více než jeden způsob, jak zachovat výstup úlohy.</span><span class="sxs-lookup"><span data-stu-id="6279d-110">Azure Batch provides more than one way to persist task output.</span></span> <span data-ttu-id="6279d-111">Pomocí rozhraní API služby Batch je vhodné přístup, který je nejvhodnější pro tyto scénáře:</span><span class="sxs-lookup"><span data-stu-id="6279d-111">Using the Batch service API is a convenient approach that's best suited to these scenarios:</span></span>

- <span data-ttu-id="6279d-112">Chcete napsat kód pro zachování výstup úlohy z v rámci klientské aplikace beze změny aplikace, která vaše úloha spuštěna.</span><span class="sxs-lookup"><span data-stu-id="6279d-112">You want to write code to persist task output from within your client application, without modifying the application that your task is running.</span></span>
- <span data-ttu-id="6279d-113">Chcete zachovat výstup z úlohy Batch a úkolech Správce úloh ve fondech vytvořené pomocí konfigurace virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="6279d-113">You want to persist output from Batch tasks and job manager tasks in pools created with the virtual machine configuration.</span></span>
- <span data-ttu-id="6279d-114">Chcete zachovat výstup ke kontejneru úložiště Azure libovolný název.</span><span class="sxs-lookup"><span data-stu-id="6279d-114">You want to persist output to an Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="6279d-115">Chcete zachovat výstup do Azure Storage kontejner s názvem podle [dávkového souboru konvence standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="6279d-115">You want to persist output to an Azure Storage container named according to the [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="6279d-116">Pokud váš scénář se liší od výše uvedené, musíte vzít v úvahu jiný přístup.</span><span class="sxs-lookup"><span data-stu-id="6279d-116">If your scenario differs from those listed above, you may need to consider a different approach.</span></span> <span data-ttu-id="6279d-117">Například rozhraní API služby Batch nepodporuje aktuálně streamování výstup do úložiště Azure. když je spuštěn úkol.</span><span class="sxs-lookup"><span data-stu-id="6279d-117">For example, the Batch service API does not currently support streaming output to Azure Storage while the task is running.</span></span> <span data-ttu-id="6279d-118">Do výstupního datového proudu, zvažte použití dávkového souboru konvence knihovny, k dispozici pro rozhraní .NET.</span><span class="sxs-lookup"><span data-stu-id="6279d-118">To stream output, consider using the Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="6279d-119">Pro jiné jazyky musíte implementovat vlastní řešení.</span><span class="sxs-lookup"><span data-stu-id="6279d-119">For other languages, you'll need to implement your own solution.</span></span> <span data-ttu-id="6279d-120">Další informace o dalších možnostech pro zachování výstup úlohy najdete v tématu [zachovat výstup úlohy a úkolů do služby Azure Storage](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="6279d-120">For more information on other options for persisting task output, see [Persist job and task output to Azure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="6279d-121">Vytvořit kontejner ve službě Azure Storage</span><span class="sxs-lookup"><span data-stu-id="6279d-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="6279d-122">Udržení výstup úlohy do úložiště Azure, budete muset vytvořit kontejner, který slouží jako cíl pro výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="6279d-122">To persist task output to Azure Storage, you'll need to create a container that serves as the destination for your output files.</span></span> <span data-ttu-id="6279d-123">Vytvoření kontejneru před spuštěním úkolu, pokud možno před odesláním úlohu.</span><span class="sxs-lookup"><span data-stu-id="6279d-123">Create the container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="6279d-124">Pokud chcete vytvořit kontejner, použijte odpovídající Klientská knihovna pro úložiště Azure nebo sady SDK.</span><span class="sxs-lookup"><span data-stu-id="6279d-124">To create the container, use the appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="6279d-125">Další informace o rozhraní API úložiště Azure najdete v tématu [dokumentaci pro Azure Storage](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="6279d-125">For more information about Azure Storage APIs, see the [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="6279d-126">Například pokud píšete vaší aplikace v jazyce C#, použijte [Klientská knihovna pro úložiště Azure pro .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="6279d-126">For example, if you are writing your application in C#, use the [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="6279d-127">Následující příklad ukazuje, jak vytvořit kontejner:</span><span class="sxs-lookup"><span data-stu-id="6279d-127">The following example shows how to create a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-the-container"></a><span data-ttu-id="6279d-128">Získání sdíleného přístupového podpisu kontejneru</span><span class="sxs-lookup"><span data-stu-id="6279d-128">Get a shared access signature for the container</span></span>

<span data-ttu-id="6279d-129">Po vytvoření kontejneru získáte sdílený přístupový podpis (SAS) s přístupem k zápisu do kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-129">After you create the container, get a shared access signature (SAS) with write access to the container.</span></span> <span data-ttu-id="6279d-130">SAS poskytuje Delegovaný přístup ke kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-130">A SAS provides delegated access to the container.</span></span> <span data-ttu-id="6279d-131">SAS uděluje přístup pomocí zadané sady oprávnění a v zadaném časovém intervalu.</span><span class="sxs-lookup"><span data-stu-id="6279d-131">The SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="6279d-132">Služba Batch musí SAS s oprávněními k zápisu pro zápis výstupu úlohy do kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-132">The Batch service needs a SAS with write permissions to write task output to the container.</span></span> <span data-ttu-id="6279d-133">Další informace o tokenu SAS naleznete v tématu [pomocí sdílené přístupové podpisy \(SAS\) ve službě Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="6279d-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="6279d-134">Když získáte SAS pomocí rozhraní API úložiště Azure, rozhraní API vrátí řetězec tokenu SAS.</span><span class="sxs-lookup"><span data-stu-id="6279d-134">When you get a SAS using the Azure Storage APIs, the API returns a SAS token string.</span></span> <span data-ttu-id="6279d-135">Tento token řetězec obsahuje všechny parametry SAS, včetně oprávnění a interval, za které SAS platný.</span><span class="sxs-lookup"><span data-stu-id="6279d-135">This token string includes all parameters of the SAS, including the permissions and the interval over which the SAS is valid.</span></span> <span data-ttu-id="6279d-136">Použití sdíleného přístupového podpisu pro přístup k kontejner ve službě Azure Storage, budete muset připojit řetězec tokenu SAS k identifikátoru URI prostředku.</span><span class="sxs-lookup"><span data-stu-id="6279d-136">To use the SAS to access a container in Azure Storage, you need to append the SAS token string to the resource URI.</span></span> <span data-ttu-id="6279d-137">Identifikátor URI, společně s připojením tokenu SAS, poskytuje ověřený přístup do služby Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="6279d-137">The resource URI, together with the appended SAS token, provides authenticated access to Azure Storage.</span></span>

<span data-ttu-id="6279d-138">Následující příklad ukazuje, jak získat řetězec tokenu SAS jen pro zápis pro kontejner, a poté připojí ke kontejneru identifikátor URI SAS:</span><span class="sxs-lookup"><span data-stu-id="6279d-138">The following example shows how to get a write-only SAS token string for the container, then appends the SAS to the container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="6279d-139">Zadejte výstupní soubory pro výstup úlohy</span><span class="sxs-lookup"><span data-stu-id="6279d-139">Specify output files for task output</span></span>

<span data-ttu-id="6279d-140">K určení výstupní soubory pro úlohu, vytvořit kolekci [výstupní soubor](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objekty a přiřadit ji ke [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) vlastnost, když vytvoříte úlohu.</span><span class="sxs-lookup"><span data-stu-id="6279d-140">To specify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it to the [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create the task.</span></span> 

<span data-ttu-id="6279d-141">Následující příklad kódu .NET vytvoří úlohu, která zapisuje náhodná čísla do souboru s názvem `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="6279d-141">The following .NET code example creates a task that writes random numbers to a file named `output.txt`.</span></span> <span data-ttu-id="6279d-142">V příkladu se vytváří výstupní soubor pro `output.txt` k zápisu do kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-142">The example creates an output file for `output.txt` to be written to the container.</span></span> <span data-ttu-id="6279d-143">V příkladu se vytváří také výstupní soubory pro všechny soubory protokolů, které se shodují se vzorem souboru `std*.txt` (_například_, `stdout.txt` a `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="6279d-143">The example also creates output files for any log files that match the file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="6279d-144">URL adresa kontejneru vyžaduje SAS, který byl vytvořen dříve kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-144">The container URL requires the SAS that was created previously for the container.</span></span> <span data-ttu-id="6279d-145">Služba Batch používá SAS k ověření přístupu ke kontejneru:</span><span class="sxs-lookup"><span data-stu-id="6279d-145">The Batch service uses the SAS to authenticate access to the container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="6279d-146">Zadejte odpovídající vzor souboru</span><span class="sxs-lookup"><span data-stu-id="6279d-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="6279d-147">Když zadáte výstupního souboru, můžete použít [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) vlastnosti a určit tak odpovídající vzor souboru.</span><span class="sxs-lookup"><span data-stu-id="6279d-147">When you specify an output file, you can use the [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property to specify a file pattern for matching.</span></span> <span data-ttu-id="6279d-148">Vzor souboru může odpovídat nulové soubory, jeden soubor nebo u sady souborů, které jsou vytvořené úlohou.</span><span class="sxs-lookup"><span data-stu-id="6279d-148">The file pattern may match zero files, a single file, or a set of files that are created by the task.</span></span>

<span data-ttu-id="6279d-149">**FilePattern** vlastnost podporuje zástupné znaky standardní systém souborů, jako `*` (pro tohoto nerekurzivního odpovídá) a `**` (pro rekurzivní odpovídá).</span><span class="sxs-lookup"><span data-stu-id="6279d-149">The **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="6279d-150">Například výše uvedený příklad určuje vzor souborů tak, aby odpovídaly `std*.txt` bez rekurzivně:</span><span class="sxs-lookup"><span data-stu-id="6279d-150">For example, the code sample above specifies the file pattern to match `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="6279d-151">Chcete-li nahrát jeden soubor, zadejte vzor souborů s žádné zástupné znaky.</span><span class="sxs-lookup"><span data-stu-id="6279d-151">To upload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="6279d-152">Například výše uvedený příklad určuje vzor souborů tak, aby odpovídaly `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="6279d-152">For example, the code sample above specifies the file pattern to match `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="6279d-153">Zadejte podmínku nahrávání</span><span class="sxs-lookup"><span data-stu-id="6279d-153">Specify an upload condition</span></span>

<span data-ttu-id="6279d-154">[OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) vlastnost umožňuje podmíněného odesílání výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="6279d-154">The [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="6279d-155">Obvyklým scénářem je nahrávat jednu sadu souborů, pokud je úloha úspěšná a jinou sadu souborů, pokud se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="6279d-155">A common scenario is to upload one set of files if the task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="6279d-156">Můžete například nahrát podrobné soubory protokolů, jenom v případě, že úloha selže a ukončí se nenulový ukončovací kód.</span><span class="sxs-lookup"><span data-stu-id="6279d-156">For example, you may want to upload verbose log files only when the task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="6279d-157">Podobně můžete nahrát výsledek soubory pouze v případě, že je úloha úspěšná, jak tyto soubory mohou být chybí nebo není úplná, pokud se úloha nezdaří.</span><span class="sxs-lookup"><span data-stu-id="6279d-157">Similarly, you may want to upload result files only if the task succeeds, as those files may be missing or incomplete if the task fails.</span></span>

<span data-ttu-id="6279d-158">Ukázka kódu výše nastaví **UploadCondition** vlastnost **TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="6279d-158">The code sample above sets the **UploadCondition** property to **TaskCompletion**.</span></span> <span data-ttu-id="6279d-159">Toto nastavení určuje, zda je soubor k odeslání, jakmile úkoly dokončí, bez ohledu na hodnotu v něm ukončovací kód.</span><span class="sxs-lookup"><span data-stu-id="6279d-159">This setting specifies that the file is to be uploaded after the tasks completes, regardless of the value of the exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="6279d-160">Další nastavení, najdete v článku [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) výčtu.</span><span class="sxs-lookup"><span data-stu-id="6279d-160">For other settings, see the [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-the-same-name"></a><span data-ttu-id="6279d-161">Odstranit nejednoznačnost soubory se stejným názvem</span><span class="sxs-lookup"><span data-stu-id="6279d-161">Disambiguate files with the same name</span></span>

<span data-ttu-id="6279d-162">Úkoly v úloze může vytvořit soubory, které mají stejný název.</span><span class="sxs-lookup"><span data-stu-id="6279d-162">The tasks in a job may produce files that have the same name.</span></span> <span data-ttu-id="6279d-163">Například `stdout.txt` a `stderr.txt` jsou vytvořeny pro každý úkol, který běží v rámci úlohy.</span><span class="sxs-lookup"><span data-stu-id="6279d-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="6279d-164">Protože každá úloha se spustí v jeho vlastní kontextu, nemusíte tyto soubory dojít ke konfliktu v systému souborů uzlu.</span><span class="sxs-lookup"><span data-stu-id="6279d-164">Because each task runs in its own context, these files don't conflict on the node's file system.</span></span> <span data-ttu-id="6279d-165">Ale při nahrávání souborů z více úloh na kontejner sdílené, musíte odstranit nejednoznačnost soubory se stejným názvem.</span><span class="sxs-lookup"><span data-stu-id="6279d-165">However, when you upload files from multiple tasks to a shared container, you'll need to disambiguate files with the same name.</span></span>

<span data-ttu-id="6279d-166">[OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) vlastnost určuje cílový objekt blob nebo virtuální adresář pro výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="6279d-166">The [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies the destination blob or virtual directory for output files.</span></span> <span data-ttu-id="6279d-167">Můžete použít **cesta** vlastnost na název objektu blob nebo virtuální adresář tak, že jsou ve službě Azure Storage jednoznačně pojmenované výstupní soubory se stejným názvem.</span><span class="sxs-lookup"><span data-stu-id="6279d-167">You can use the **Path** property to name the blob or virtual directory in such a way that output files with the same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="6279d-168">Pomocí ID úkolu v cestě je vhodný způsob k zajištění jedinečné názvy a snadno identifikovat soubory.</span><span class="sxs-lookup"><span data-stu-id="6279d-168">Using the task ID in the path is a good way to ensure unique names and easily identify files.</span></span>

<span data-ttu-id="6279d-169">Pokud **FilePattern** je nastavena na výraz se zástupnými znaky, pak všechny soubory, které se shodují se vzorem se odešlou do virtuálního adresáře určeného **cesta** vlastnost.</span><span class="sxs-lookup"><span data-stu-id="6279d-169">If the **FilePattern** property is set to a wildcard expression, then all files that match the pattern are uploaded to the virtual directory specified by the **Path** property.</span></span> <span data-ttu-id="6279d-170">Například, pokud je kontejner `mycontainer`, úlohu ID je `mytask`, a je vzor souborů `..\std*.txt`, pak bude vypadat podobně jako absolutní identifikátory URI pro výstupní soubory ve službě Azure Storage:</span><span class="sxs-lookup"><span data-stu-id="6279d-170">For example, if the container is `mycontainer`, the task ID is `mytask`, and the file pattern is `..\std*.txt`, then the absolute URIs to the output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="6279d-171">Pokud **FilePattern** je nastavena na shodovat s názvem jeden soubor, což znamená, neobsahuje žádné zástupné znaky a potom hodnotu **cesta** vlastnost určuje název plně kvalifikovaný objektu blob.</span><span class="sxs-lookup"><span data-stu-id="6279d-171">If the **FilePattern** property is set to match a single file name, meaning it does not contain any wildcard characters, then the value of the **Path** property specifies the fully qualified blob name.</span></span> <span data-ttu-id="6279d-172">Pokud očekáváte, že ke konfliktu názvů s jeden soubor z více úloh, zadejte název virtuálního adresáře v rámci názvu souboru, který chcete odstranit nejednoznačnost těchto souborů.</span><span class="sxs-lookup"><span data-stu-id="6279d-172">If you anticipate naming conflicts with a single file from multiple tasks, then include the name of the virtual directory as part of the file name to disambiguate those files.</span></span> <span data-ttu-id="6279d-173">Například nastavit **cesta** vlastnost ID úkolu, oddělovací znak (obvykle dopředné lomítko) a název souboru:</span><span class="sxs-lookup"><span data-stu-id="6279d-173">For example, set the **Path** property to include the task ID, the delimiter character (typically a forward slash), and the file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="6279d-174">Absolutní identifikátory URI pro výstupní soubory pro sadu úloh bude vypadat podobně jako:</span><span class="sxs-lookup"><span data-stu-id="6279d-174">The absolute URIs to the output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="6279d-175">Další informace o virtuálních adresářů v Azure Storage najdete v tématu [seznam objektů BLOB v kontejneru](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="6279d-175">For more information about virtual directories in Azure Storage, see [List the blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="6279d-176">Diagnostikovat chyby odesílání souborů</span><span class="sxs-lookup"><span data-stu-id="6279d-176">Diagnose file upload errors</span></span>

<span data-ttu-id="6279d-177">Pokud chcete nahrát výstupní soubory do úložiště Azure se nezdaří, pak úlohu přesune do **dokončeno** stavu a [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) je nastavena.</span><span class="sxs-lookup"><span data-stu-id="6279d-177">If uploading output files to Azure Storage fails, then the task moves to the **Completed** state and the [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="6279d-178">Zkontrolujte **FailureInformation** vlastnosti k určení, co došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="6279d-178">Examine the **FailureInformation** property to determine what error occurred.</span></span> <span data-ttu-id="6279d-179">Zde je ukázka, k chybě, která proběhne nahrávání souborů, pokud nelze nalézt kontejner:</span><span class="sxs-lookup"><span data-stu-id="6279d-179">For example, here is an error that occurs on file upload if the container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of the specified Azure container(s) was not found while attempting to upload an output file
```

<span data-ttu-id="6279d-180">Na každých nahrávání souborů Batch zapíše dva soubory protokolu ve výpočetním uzlu `fileuploadout.txt` a `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="6279d-180">On every file upload, Batch writes two log files to the compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="6279d-181">Můžete zkontrolovat tyto soubory protokolu Další informace o konkrétní chyby.</span><span class="sxs-lookup"><span data-stu-id="6279d-181">You can examine these log files to learn more about a specific failure.</span></span> <span data-ttu-id="6279d-182">V případech, kde nahrávání souborů byla nikdy pokus, např. protože vlastní úloha nebylo možné spustit pak tyto soubory protokolu neexistují.</span><span class="sxs-lookup"><span data-stu-id="6279d-182">In cases where the file upload was never attempted, for example because the task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="6279d-183">Diagnostika výkon nahrávání souborů</span><span class="sxs-lookup"><span data-stu-id="6279d-183">Diagnose file upload performance</span></span>

<span data-ttu-id="6279d-184">`fileuploadout.txt` Protokoly průběhu odesílání souboru.</span><span class="sxs-lookup"><span data-stu-id="6279d-184">The `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="6279d-185">Tento soubor Další informace o tom, jak dlouho trvá vaší nahrávání souborů můžete zkontrolovat.</span><span class="sxs-lookup"><span data-stu-id="6279d-185">You can examine this file to learn more about how long your file uploads are taking.</span></span> <span data-ttu-id="6279d-186">Mějte na paměti, že existuje celá řada přispívajících faktorů nahrát výkonu, včetně velikosti uzlu dalších aktivit na uzlu v době nahrávání, jestli je cílový kontejner ve stejné oblasti jako fondu Batch, kolik uzly nahráváte do stora ge účet ve stejnou dobu a tak dále.</span><span class="sxs-lookup"><span data-stu-id="6279d-186">Keep in mind that there are many contributing factors to upload performance, including the size of the node, other activity on the node at the time of the upload, whether the target container is in the same region as the Batch pool, how many nodes are uploading to the storage account at the same time, and so on.</span></span>

## <a name="use-the-batch-service-api-with-the-batch-file-conventions-standard"></a><span data-ttu-id="6279d-187">Rozhraní API služby Batch pomocí standardní konvence dávkového souboru</span><span class="sxs-lookup"><span data-stu-id="6279d-187">Use the Batch service API with the Batch File Conventions standard</span></span>

<span data-ttu-id="6279d-188">Můžete zachovat výstup úlohy s rozhraním API služby Batch, můžete pojmenovat cílový kontejner a objekty BLOB, ale chcete.</span><span class="sxs-lookup"><span data-stu-id="6279d-188">When you persist task output with the Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="6279d-189">Můžete také název je podle požadavků [dávkového souboru konvence standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="6279d-189">You can also choose to name them according to the [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="6279d-190">Standardní konvence souboru určuje názvy cílový kontejner a objektů blob v Azure Storage pro danou výstupní soubor založený na názvy úloh a úloh.</span><span class="sxs-lookup"><span data-stu-id="6279d-190">The File Conventions standard determines the names of the destination container and blob in Azure Storage for a given output file based on the names of the job and task.</span></span> <span data-ttu-id="6279d-191">Pokud používáte standard souboru konvence pro pojmenování výstupní soubory, pak jsou k dispozici pro zobrazení v výstupní soubory [portál Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="6279d-191">If you do use the File Conventions standard for naming output files, then your output files are available for viewing in the [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="6279d-192">Pokud vyvíjíte v jazyce C#, můžete použít metody, které jsou součástí [konvence souboru Batch library pro .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="6279d-192">If you are developing in C#, you can use the methods built into the [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="6279d-193">V této knihovně pro vás vytvoří správně pojmenované kontejnerů a objektů blob cesty.</span><span class="sxs-lookup"><span data-stu-id="6279d-193">This library creates the properly named containers and blob paths for you.</span></span> <span data-ttu-id="6279d-194">Například můžete volat rozhraní API získat správný název kontejneru, založené na název úlohy:</span><span class="sxs-lookup"><span data-stu-id="6279d-194">For example, you can call the API to get the correct name for the container, based on the job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="6279d-195">Můžete použít [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) metoda vrátí adresu URL sdílený přístupový podpis (SAS), která se používá k zápisu do kontejneru.</span><span class="sxs-lookup"><span data-stu-id="6279d-195">You can use the [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method to return a shared access signature (SAS) URL that is used to write to the container.</span></span> <span data-ttu-id="6279d-196">Potom můžete předat tuto SAS k [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) konstruktor.</span><span class="sxs-lookup"><span data-stu-id="6279d-196">You can then pass this SAS to the [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="6279d-197">Pokud vyvíjíte v jiném jazyce než v C#, musíte implementovat standard souboru konvence sami.</span><span class="sxs-lookup"><span data-stu-id="6279d-197">If you are developing in a language other than C#, you will need to implement the File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="6279d-198">Ukázka kódu</span><span class="sxs-lookup"><span data-stu-id="6279d-198">Code sample</span></span>

<span data-ttu-id="6279d-199">[PersistOutputs] [ github_persistoutputs] ukázkový projekt je jedním z [ukázky kódu Azure Batch] [ github_samples] na Githubu.</span><span class="sxs-lookup"><span data-stu-id="6279d-199">The [PersistOutputs][github_persistoutputs] sample project is one of the [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="6279d-200">Toto řešení sady Visual Studio ukazuje, jak pomocí klientské knihovny Batch pro .NET lze zachovat výstup úlohy do odolné úložiště.</span><span class="sxs-lookup"><span data-stu-id="6279d-200">This Visual Studio solution demonstrates how to use the Batch client library for .NET to persist task output to durable storage.</span></span> <span data-ttu-id="6279d-201">Pokud chcete spustit ukázku, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="6279d-201">To run the sample, follow these steps:</span></span>

1. <span data-ttu-id="6279d-202">Otevřete projekt ve **Visual Studio 2015 nebo novější**.</span><span class="sxs-lookup"><span data-stu-id="6279d-202">Open the project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="6279d-203">Přidat Batch a Storage **přihlašovací údaje účtu** k **AccountSettings.settings** v Microsoft.Azure.Batch.Samples.Common projektu.</span><span class="sxs-lookup"><span data-stu-id="6279d-203">Add your Batch and Storage **account credentials** to **AccountSettings.settings** in the Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="6279d-204">**Sestavení** (ale není spuštěný) řešení.</span><span class="sxs-lookup"><span data-stu-id="6279d-204">**Build** (but do not run) the solution.</span></span> <span data-ttu-id="6279d-205">Pokud se zobrazí výzva, obnovení všech balíčků NuGet.</span><span class="sxs-lookup"><span data-stu-id="6279d-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="6279d-206">Použít portál Azure k nahrání [balíčku aplikace](batch-application-packages.md) pro **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="6279d-206">Use the Azure portal to upload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="6279d-207">Zahrnout `PersistOutputsTask.exe` a jeho závislá sestavení v balíčku .zip, nastavte na "PersistOutputsTask" ID aplikace a verze balíčku aplikace do "1.0".</span><span class="sxs-lookup"><span data-stu-id="6279d-207">Include the `PersistOutputsTask.exe` and its dependent assemblies in the .zip package, set the application ID to "PersistOutputsTask", and the application package version to "1.0".</span></span>
5. <span data-ttu-id="6279d-208">**Spustit** (spustit) **PersistOutputs** projektu.</span><span class="sxs-lookup"><span data-stu-id="6279d-208">**Start** (run) the **PersistOutputs** project.</span></span>
6. <span data-ttu-id="6279d-209">Po zobrazení výzvy vyberte technologie trvalost použít ke spuštění ukázky, zadejte **2** spustit ukázku pomocí rozhraní API služby Batch udržení výstup úlohy.</span><span class="sxs-lookup"><span data-stu-id="6279d-209">When prompted to choose the persistence technology to use for running the sample, enter **2** to run the sample using the Batch service API to persist task output.</span></span>
7. <span data-ttu-id="6279d-210">V případě potřeby ukázku spustit znovu, zadávání **3** udržení výstup s rozhraním API služby Batch a také název cílová cesta kontejnerů a objektů blob podle standardu názvů souborů.</span><span class="sxs-lookup"><span data-stu-id="6279d-210">If desired, run the sample again, entering **3** to persist output with the Batch service API, and also to name the destination container and blob path according to the File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6279d-211">Další kroky</span><span class="sxs-lookup"><span data-stu-id="6279d-211">Next steps</span></span>

- <span data-ttu-id="6279d-212">Další informace o zachování výstup úlohy s knihovnou souboru konvence pro rozhraní .NET najdete v tématu [zachovat úloh a úkolů data do služby Azure Storage pomocí knihovny Batch souboru konvence pro technologii .NET zachovat ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="6279d-212">For more information on persisting task output with the File Conventions library for .NET, see [Persist job and task data to Azure Storage with the Batch File Conventions library for .NET to persist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="6279d-213">Informace o dalších přístupy k zachování výstupní data ve službě Azure Batch, najdete v části [zachovat výstup úlohy a úkolů do služby Azure Storage](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="6279d-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output to Azure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples

---
title: "aaaPersist úloh a úkolů výstup tooAzure úložiště s hello rozhraní API služby Azure Batch | Microsoft Docs"
description: "Zjistěte, jak toouse rozhraní API služby Batch toopersist dávkové úlohy a úlohy výstupní tooAzure úložiště."
services: batch
author: tamram
manager: timlt
editor: 
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 06/16/2017
ms.author: tamram
ms.openlocfilehash: 71b3f7c0dda2d2a9d8eb3eef83229873c70ca22c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="persist-task-data-tooazure-storage-with-hello-batch-service-api"></a><span data-ttu-id="badfd-103">Zachovat data tooAzure úloh úložiště s hello rozhraní API služby Batch</span><span class="sxs-lookup"><span data-stu-id="badfd-103">Persist task data tooAzure Storage with hello Batch service API</span></span>

[!INCLUDE [batch-task-output-include](../../includes/batch-task-output-include.md)]

<span data-ttu-id="badfd-104">Počínaje verzí 2017-05-01, hello rozhraní API služby Batch podporuje zachování výstupní data tooAzure úložiště pro úlohy a úkolech Správce úloh, které běží na fondy s hello konfigurace virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="badfd-104">Starting with version 2017-05-01, hello Batch service API supports persisting output data tooAzure Storage for tasks and job manager tasks that run on pools with hello virtual machine configuration.</span></span> <span data-ttu-id="badfd-105">Když přidáte úlohu, můžete ve službě Azure Storage kontejner jako hello cíl pro výstup hello úlohy.</span><span class="sxs-lookup"><span data-stu-id="badfd-105">When you add a task, you can specify a container in Azure Storage as hello destination for hello task's output.</span></span> <span data-ttu-id="badfd-106">Služba Batch Hello pak zapíše kontejner toothat žádné výstup dat po dokončení úloh hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-106">hello Batch service then writes any output data toothat container when hello task is complete.</span></span>

<span data-ttu-id="badfd-107">Využít toousing hello Batch výstup úlohy toopersist rozhraní API služby se nemusí toomodify hello aplikace, která hello úloha je spuštěna.</span><span class="sxs-lookup"><span data-stu-id="badfd-107">An advantage toousing hello Batch service API toopersist task output is that you do not need toomodify hello application that hello task is running.</span></span> <span data-ttu-id="badfd-108">Místo toho se několik jednoduchých úprav tooyour klientskou aplikaci, můžete zachovat výstup hello úloh v rámci hello kód, který vytvoří hello úloh.</span><span class="sxs-lookup"><span data-stu-id="badfd-108">Instead, with a few simple modifications tooyour client application, you can persist hello task's output from within hello code that creates hello task.</span></span>   

## <a name="when-do-i-use-hello-batch-service-api-toopersist-task-output"></a><span data-ttu-id="badfd-109">Kdy použít výstup úlohy toopersist hello rozhraní API služby Batch?</span><span class="sxs-lookup"><span data-stu-id="badfd-109">When do I use hello Batch service API toopersist task output?</span></span>

<span data-ttu-id="badfd-110">Azure Batch poskytuje více než jedním ze způsobů toopersist výstup úlohy.</span><span class="sxs-lookup"><span data-stu-id="badfd-110">Azure Batch provides more than one way toopersist task output.</span></span> <span data-ttu-id="badfd-111">Pomocí hello rozhraní API služby Batch je vhodné přístup, který je nejlepší vhodná toothese scénáře:</span><span class="sxs-lookup"><span data-stu-id="badfd-111">Using hello Batch service API is a convenient approach that's best suited toothese scenarios:</span></span>

- <span data-ttu-id="badfd-112">Výstup úlohy toopersist toowrite kód z chcete v rámci klientské aplikace beze změny aplikace hello spuštěná vaše úloha.</span><span class="sxs-lookup"><span data-stu-id="badfd-112">You want toowrite code toopersist task output from within your client application, without modifying hello application that your task is running.</span></span>
- <span data-ttu-id="badfd-113">Chcete toopersist výstup z úlohy Batch a úkolech Správce úloh ve fondech vytvořené pomocí hello konfigurace virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="badfd-113">You want toopersist output from Batch tasks and job manager tasks in pools created with hello virtual machine configuration.</span></span>
- <span data-ttu-id="badfd-114">Chcete toopersist výstup tooan Azure Storage kontejner s libovolný název.</span><span class="sxs-lookup"><span data-stu-id="badfd-114">You want toopersist output tooan Azure Storage container with an arbitrary name.</span></span>
- <span data-ttu-id="badfd-115">Chcete-li toopersist výstup tooan Azure Storage kontejner s názvem podle toohello [dávkového souboru konvence standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="badfd-115">You want toopersist output tooan Azure Storage container named according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> 

<span data-ttu-id="badfd-116">Pokud váš scénář se liší od výše uvedené, může být nutné tooconsider jiný přístup.</span><span class="sxs-lookup"><span data-stu-id="badfd-116">If your scenario differs from those listed above, you may need tooconsider a different approach.</span></span> <span data-ttu-id="badfd-117">Například rozhraní API služby Batch hello nepodporuje aktuálně streamování výstup tooAzure úložiště je spuštěna úloha hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-117">For example, hello Batch service API does not currently support streaming output tooAzure Storage while hello task is running.</span></span> <span data-ttu-id="badfd-118">toostream výstup, zvažte použití hello dávkového souboru konvence knihovny, k dispozici pro rozhraní .NET.</span><span class="sxs-lookup"><span data-stu-id="badfd-118">toostream output, consider using hello Batch File Conventions library, available for .NET.</span></span> <span data-ttu-id="badfd-119">Pro jiné jazyky budete potřebovat tooimplement vlastní řešení.</span><span class="sxs-lookup"><span data-stu-id="badfd-119">For other languages, you'll need tooimplement your own solution.</span></span> <span data-ttu-id="badfd-120">Další informace o dalších možnostech pro zachování výstup úlohy najdete v tématu [zachovat úlohy a úkolů výstupní tooAzure úložiště](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="badfd-120">For more information on other options for persisting task output, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span> 

## <a name="create-a-container-in-azure-storage"></a><span data-ttu-id="badfd-121">Vytvořit kontejner ve službě Azure Storage</span><span class="sxs-lookup"><span data-stu-id="badfd-121">Create a container in Azure Storage</span></span>

<span data-ttu-id="badfd-122">Úloha toopersist výstup tooAzure úložiště, budete potřebovat toocreate kontejner, který slouží jako hello cíl pro výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="badfd-122">toopersist task output tooAzure Storage, you'll need toocreate a container that serves as hello destination for your output files.</span></span> <span data-ttu-id="badfd-123">Vytvoření kontejneru hello před spuštěním úkolu, pokud možno před odesláním úlohu.</span><span class="sxs-lookup"><span data-stu-id="badfd-123">Create hello container before you run your task, preferably before you submit your job.</span></span> <span data-ttu-id="badfd-124">toocreate hello kontejner, použijte hello odpovídající Azure Klientská knihovna pro úložiště nebo sady SDK.</span><span class="sxs-lookup"><span data-stu-id="badfd-124">toocreate hello container, use hello appropriate Azure Storage client library or SDK.</span></span> <span data-ttu-id="badfd-125">Další informace o rozhraní API úložiště Azure najdete v tématu hello [dokumentaci pro Azure Storage](https://docs.microsoft.com/azure/storage/).</span><span class="sxs-lookup"><span data-stu-id="badfd-125">For more information about Azure Storage APIs, see hello [Azure Storage documentation](https://docs.microsoft.com/azure/storage/).</span></span>

<span data-ttu-id="badfd-126">Například pokud píšete vaší aplikace v jazyce C#, použijte hello [Klientská knihovna pro úložiště Azure pro .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span><span class="sxs-lookup"><span data-stu-id="badfd-126">For example, if you are writing your application in C#, use hello [Azure Storage client library for .NET](https://www.nuget.org/packages/WindowsAzure.Storage/).</span></span> <span data-ttu-id="badfd-127">Následující příklad ukazuje, jak Hello toocreate kontejner:</span><span class="sxs-lookup"><span data-stu-id="badfd-127">hello following example shows how toocreate a container:</span></span>

```csharp
CloudBlobContainer container = storageAccount.CreateCloudBlobClient().GetContainerReference(containerName);
await conainer.CreateIfNotExists();
```

## <a name="get-a-shared-access-signature-for-hello-container"></a><span data-ttu-id="badfd-128">Získání sdíleného přístupového podpisu kontejneru hello</span><span class="sxs-lookup"><span data-stu-id="badfd-128">Get a shared access signature for hello container</span></span>

<span data-ttu-id="badfd-129">Po vytvoření kontejneru hello získáte sdílený přístupový podpis (SAS), s kontejnerem toohello přístup pro zápis.</span><span class="sxs-lookup"><span data-stu-id="badfd-129">After you create hello container, get a shared access signature (SAS) with write access toohello container.</span></span> <span data-ttu-id="badfd-130">SAS poskytuje Delegovaný přístup toohello kontejneru.</span><span class="sxs-lookup"><span data-stu-id="badfd-130">A SAS provides delegated access toohello container.</span></span> <span data-ttu-id="badfd-131">Hello SAS uděluje přístup pomocí zadané sady oprávnění a v zadaném časovém intervalu.</span><span class="sxs-lookup"><span data-stu-id="badfd-131">hello SAS grants access with a specified set of permissions and over a specified time interval.</span></span> <span data-ttu-id="badfd-132">Hello služba Batch musí SAS s zápisu oprávnění toowrite úloh výstup toohello kontejneru.</span><span class="sxs-lookup"><span data-stu-id="badfd-132">hello Batch service needs a SAS with write permissions toowrite task output toohello container.</span></span> <span data-ttu-id="badfd-133">Další informace o tokenu SAS naleznete v tématu [pomocí sdílené přístupové podpisy \(SAS\) ve službě Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="badfd-133">For more information about SAS, see [Using shared access signatures \(SAS\) in Azure Storage](../storage/common/storage-dotnet-shared-access-signature-part-1.md).</span></span>

<span data-ttu-id="badfd-134">Když získáte SAS pomocí hello rozhraní API úložiště Azure, hello rozhraní API vrátí řetězec tokenu SAS.</span><span class="sxs-lookup"><span data-stu-id="badfd-134">When you get a SAS using hello Azure Storage APIs, hello API returns a SAS token string.</span></span> <span data-ttu-id="badfd-135">Tento token řetězec zahrnuje všechny parametry hello SAS, včetně hello oprávnění a hello interval, přes které hello SAS platný.</span><span class="sxs-lookup"><span data-stu-id="badfd-135">This token string includes all parameters of hello SAS, including hello permissions and hello interval over which hello SAS is valid.</span></span> <span data-ttu-id="badfd-136">toouse hello SAS tooaccess kontejner ve službě Azure Storage, musíte tooappend hello SAS token řetězec toohello identifikátor URI.</span><span class="sxs-lookup"><span data-stu-id="badfd-136">toouse hello SAS tooaccess a container in Azure Storage, you need tooappend hello SAS token string toohello resource URI.</span></span> <span data-ttu-id="badfd-137">Hello identifikátor URI, společně s hello připojí SAS token, poskytuje ověřený přístup tooAzure úložiště.</span><span class="sxs-lookup"><span data-stu-id="badfd-137">hello resource URI, together with hello appended SAS token, provides authenticated access tooAzure Storage.</span></span>

<span data-ttu-id="badfd-138">Hello následující příklad ukazuje, jak tooget jen pro zápis SAS token řetězec pro hello kontejner, a poté připojí hello SAS toohello kontejneru URI:</span><span class="sxs-lookup"><span data-stu-id="badfd-138">hello following example shows how tooget a write-only SAS token string for hello container, then appends hello SAS toohello container URI:</span></span>

```csharp
string containerSasToken = container.GetSharedAccessSignature(new SharedAccessBlobPolicy()
{
    SharedAccessExpiryTime = DateTimeOffset.UtcNow.AddDays(1),
    Permissions = SharedAccessBlobPermissions.Write
});

string containerSasUrl = container.Uri.AbsoluteUri + containerSasToken; 
```

## <a name="specify-output-files-for-task-output"></a><span data-ttu-id="badfd-139">Zadejte výstupní soubory pro výstup úlohy</span><span class="sxs-lookup"><span data-stu-id="badfd-139">Specify output files for task output</span></span>

<span data-ttu-id="badfd-140">výstupní soubory toospecify pro úlohy, vytvořit kolekci [výstupní soubor](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objekty a přiřaďte ho toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) vlastnost při vytvoření úlohy hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-140">toospecify output files for a task, create a collection of [OutputFile](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile) objects and assign it toohello [CloudTask.OutputFiles](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.cloudtask.outputfiles#Microsoft_Azure_Batch_CloudTask_OutputFiles) property when you create hello task.</span></span> 

<span data-ttu-id="badfd-141">Hello následující příklad kódu .NET vytvoří úlohu, která zapisuje náhodná čísla tooa soubor s názvem `output.txt`.</span><span class="sxs-lookup"><span data-stu-id="badfd-141">hello following .NET code example creates a task that writes random numbers tooa file named `output.txt`.</span></span> <span data-ttu-id="badfd-142">Příklad Hello vytvoří výstupní soubor pro `output.txt` toobe zapsána toohello kontejneru.</span><span class="sxs-lookup"><span data-stu-id="badfd-142">hello example creates an output file for `output.txt` toobe written toohello container.</span></span> <span data-ttu-id="badfd-143">Příklad Hello také vytvoří výstupní soubory pro všechny soubory protokolu, které odpovídají vzor souborů hello `std*.txt` (_například_, `stdout.txt` a `stderr.txt`).</span><span class="sxs-lookup"><span data-stu-id="badfd-143">hello example also creates output files for any log files that match hello file pattern `std*.txt` (_e.g._, `stdout.txt` and `stderr.txt`).</span></span> <span data-ttu-id="badfd-144">URL adresa kontejneru Hello vyžaduje hello SAS, který byl vytvořen dříve hello kontejneru.</span><span class="sxs-lookup"><span data-stu-id="badfd-144">hello container URL requires hello SAS that was created previously for hello container.</span></span> <span data-ttu-id="badfd-145">Hello služba Batch používá hello SAS tooauthenticate přístup toohello kontejneru:</span><span class="sxs-lookup"><span data-stu-id="badfd-145">hello Batch service uses hello SAS tooauthenticate access toohello container:</span></span> 

```csharp
new CloudTask(taskId, "cmd /v:ON /c \"echo off && set && (FOR /L %i IN (1,1,100000) DO (ECHO !RANDOM!)) > output.txt\"")
{
    OutputFiles = new List<OutputFile>
    {
        new OutputFile(
            filePattern: @"..\std*.txt",
            destination: new OutputFileDestination(
         new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId)),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
        new OutputFile(
            filePattern: @"output.txt",
            destination: 
         new OutputFileDestination(new OutputFileBlobContainerDestination(
                    containerUrl: containerSasUrl,
                    path: taskId + @"\output.txt")),
            uploadOptions: new OutputFileUploadOptions(
            uploadCondition: OutputFileUploadCondition.TaskCompletion)),
}
```

### <a name="specify-a-file-pattern-for-matching"></a><span data-ttu-id="badfd-146">Zadejte odpovídající vzor souboru</span><span class="sxs-lookup"><span data-stu-id="badfd-146">Specify a file pattern for matching</span></span>

<span data-ttu-id="badfd-147">Když zadáte výstupního souboru, můžete použít hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) toospecify vlastnost odpovídající vzor souboru.</span><span class="sxs-lookup"><span data-stu-id="badfd-147">When you specify an output file, you can use hello [OutputFile.FilePattern](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfile.filepattern#Microsoft_Azure_Batch_OutputFile_FilePattern) property toospecify a file pattern for matching.</span></span> <span data-ttu-id="badfd-148">vzor souboru Hello může odpovídat nulové soubory, jeden soubor nebo u sady souborů, které jsou vytvořené úlohou hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-148">hello file pattern may match zero files, a single file, or a set of files that are created by hello task.</span></span>

<span data-ttu-id="badfd-149">Hello **FilePattern** vlastnost podporuje zástupné znaky standardní systém souborů, jako `*` (pro tohoto nerekurzivního odpovídá) a `**` (pro rekurzivní odpovídá).</span><span class="sxs-lookup"><span data-stu-id="badfd-149">hello **FilePattern** property supports standard filesystem wildcards such as `*` (for non-recursive matches) and `**` (for recursive matches).</span></span> <span data-ttu-id="badfd-150">Například ukázka kódu hello výše určuje hello souboru vzor toomatch `std*.txt` bez rekurzivně:</span><span class="sxs-lookup"><span data-stu-id="badfd-150">For example, hello code sample above specifies hello file pattern toomatch `std*.txt` non-recursively:</span></span> 

`filePattern: @"..\std*.txt"`

<span data-ttu-id="badfd-151">tooupload jeden soubor, zadejte vzor souborů s žádné zástupné znaky.</span><span class="sxs-lookup"><span data-stu-id="badfd-151">tooupload a single file, specify a file pattern with no wildcards.</span></span> <span data-ttu-id="badfd-152">Například ukázka kódu hello výše určuje hello souboru vzor toomatch `output.txt`:</span><span class="sxs-lookup"><span data-stu-id="badfd-152">For example, hello code sample above specifies hello file pattern toomatch `output.txt`:</span></span>

`filePattern: @"output.txt"`

### <a name="specify-an-upload-condition"></a><span data-ttu-id="badfd-153">Zadejte podmínku nahrávání</span><span class="sxs-lookup"><span data-stu-id="badfd-153">Specify an upload condition</span></span>

<span data-ttu-id="badfd-154">Hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) vlastnost umožňuje podmíněného odesílání výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="badfd-154">hello [OutputFileUploadOptions.UploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileuploadoptions.uploadcondition#Microsoft_Azure_Batch_OutputFileUploadOptions_UploadCondition) property permits conditional uploading of output files.</span></span> <span data-ttu-id="badfd-155">Obvyklým scénářem je tooupload jednu sadu souborů, pokud úloha hello úspěšná a jinou sadu souborů, pokud se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="badfd-155">A common scenario is tooupload one set of files if hello task succeeds, and a different set of files if it fails.</span></span> <span data-ttu-id="badfd-156">Můžete například souborů podrobného protokolování tooupload jenom v případě, že hello úloh selže a ukončí se nenulový ukončovací kód.</span><span class="sxs-lookup"><span data-stu-id="badfd-156">For example, you may want tooupload verbose log files only when hello task fails and exits with a nonzero exit code.</span></span> <span data-ttu-id="badfd-157">Podobně můžete tooupload výsledek soubory pouze v případě, že úloha hello úspěšná, jak tyto soubory mohou být chybí nebo jsou neúplné v případě selhání úlohy hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-157">Similarly, you may want tooupload result files only if hello task succeeds, as those files may be missing or incomplete if hello task fails.</span></span>

<span data-ttu-id="badfd-158">Hello ukázka kódu výše nastaví hello **UploadCondition** vlastnost příliš**TaskCompletion**.</span><span class="sxs-lookup"><span data-stu-id="badfd-158">hello code sample above sets hello **UploadCondition** property too**TaskCompletion**.</span></span> <span data-ttu-id="badfd-159">Toto nastavení určuje, že soubor hello je toobe nahrán po dokončení úlohy hello, bez ohledu na hodnotu hello hello ukončovací kód.</span><span class="sxs-lookup"><span data-stu-id="badfd-159">This setting specifies that hello file is toobe uploaded after hello tasks completes, regardless of hello value of hello exit code.</span></span> 

`uploadCondition: OutputFileUploadCondition.TaskCompletion`

<span data-ttu-id="badfd-160">Další nastavení, najdete v části hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) výčtu.</span><span class="sxs-lookup"><span data-stu-id="badfd-160">For other settings, see hello [OutputFileUploadCondition](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.common.outputfileuploadcondition) enum.</span></span>

### <a name="disambiguate-files-with-hello-same-name"></a><span data-ttu-id="badfd-161">Odstranit nejednoznačnost soubory s hello stejným názvem</span><span class="sxs-lookup"><span data-stu-id="badfd-161">Disambiguate files with hello same name</span></span>

<span data-ttu-id="badfd-162">vytvářet soubory, které mají hello Hello úkoly v úloze stejný název.</span><span class="sxs-lookup"><span data-stu-id="badfd-162">hello tasks in a job may produce files that have hello same name.</span></span> <span data-ttu-id="badfd-163">Například `stdout.txt` a `stderr.txt` jsou vytvořeny pro každý úkol, který běží v rámci úlohy.</span><span class="sxs-lookup"><span data-stu-id="badfd-163">For example, `stdout.txt` and `stderr.txt` are created for every task that runs in a job.</span></span> <span data-ttu-id="badfd-164">Protože každá úloha se spustí v jeho vlastní kontextu, není v systému souborů hello uzlu konfliktu tyto soubory.</span><span class="sxs-lookup"><span data-stu-id="badfd-164">Because each task runs in its own context, these files don't conflict on hello node's file system.</span></span> <span data-ttu-id="badfd-165">Ale při nahrávání souborů z více úloh tooa sdílené kontejneru, budete potřebovat toodisambiguate soubory s hello stejný název.</span><span class="sxs-lookup"><span data-stu-id="badfd-165">However, when you upload files from multiple tasks tooa shared container, you'll need toodisambiguate files with hello same name.</span></span>

<span data-ttu-id="badfd-166">Hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) vlastnost určuje cílový objekt blob hello nebo virtuální adresář pro výstupní soubory.</span><span class="sxs-lookup"><span data-stu-id="badfd-166">hello [OutputFileBlobContainerDestination.Path](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination.path#Microsoft_Azure_Batch_OutputFileBlobContainerDestination_Path) property specifies hello destination blob or virtual directory for output files.</span></span> <span data-ttu-id="badfd-167">Můžete použít hello **cesta** vlastnost tooname hello blob nebo virtuální adresář tak, že výstupní soubory se stejným názvem jsou jedinečně pojmenované ve službě Azure Storage hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-167">You can use hello **Path** property tooname hello blob or virtual directory in such a way that output files with hello same name are uniquely named in Azure Storage.</span></span> <span data-ttu-id="badfd-168">Pomocí ID úkolu hello v cestě hello je dobře jedinečné názvy tooensure a snadno identifikovat soubory.</span><span class="sxs-lookup"><span data-stu-id="badfd-168">Using hello task ID in hello path is a good way tooensure unique names and easily identify files.</span></span>

<span data-ttu-id="badfd-169">Pokud hello **FilePattern** je nastavena tooa výraz se zástupnými znaky, pak všechny soubory, které odpovídají hello vzor jsou nahrané toohello virtuální adresář zadaný hello **cesta** vlastnost.</span><span class="sxs-lookup"><span data-stu-id="badfd-169">If hello **FilePattern** property is set tooa wildcard expression, then all files that match hello pattern are uploaded toohello virtual directory specified by hello **Path** property.</span></span> <span data-ttu-id="badfd-170">Například pokud hello kontejneru je `mycontainer`, hello úloh ID je `mytask`, a je vzor souborů hello `..\std*.txt`, pak hello absolutní identifikátory URI toohello výstupní soubory ve službě Azure Storage bude vypadat podobně jako:</span><span class="sxs-lookup"><span data-stu-id="badfd-170">For example, if hello container is `mycontainer`, hello task ID is `mytask`, and hello file pattern is `..\std*.txt`, then hello absolute URIs toohello output files in Azure Storage will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/mytask/stderr.txt
https://myaccount.blob.core.windows.net/mycontainer/mytask/stdout.txt
```

<span data-ttu-id="badfd-171">Pokud hello **FilePattern** vlastnost sady toomatch jeden název souboru, což znamená, neobsahuje žádné zástupné znaky, pak hello hodnotu hello **cesta** vlastnost určuje název objektu blob plně kvalifikovaný hello .</span><span class="sxs-lookup"><span data-stu-id="badfd-171">If hello **FilePattern** property is set toomatch a single file name, meaning it does not contain any wildcard characters, then hello value of hello **Path** property specifies hello fully qualified blob name.</span></span> <span data-ttu-id="badfd-172">Pokud očekáváte, že ke konfliktu názvů s jeden soubor z více úloh, zadejte hello název virtuálního adresáře hello jako součást toodisambiguate název souboru hello těchto souborů.</span><span class="sxs-lookup"><span data-stu-id="badfd-172">If you anticipate naming conflicts with a single file from multiple tasks, then include hello name of hello virtual directory as part of hello file name toodisambiguate those files.</span></span> <span data-ttu-id="badfd-173">Například sada hello **cesta** ID vlastnosti tooinclude hello úloh, hello oddělovací znak (obvykle dopředné lomítko) a název souboru hello:</span><span class="sxs-lookup"><span data-stu-id="badfd-173">For example, set hello **Path** property tooinclude hello task ID, hello delimiter character (typically a forward slash), and hello file name:</span></span>

`path: taskId + @"/output.txt"`

<span data-ttu-id="badfd-174">Hello absolutní identifikátory URI toohello výstupní soubory pro sadu úloh bude vypadat podobně jako:</span><span class="sxs-lookup"><span data-stu-id="badfd-174">hello absolute URIs toohello output files for a set of tasks will be similar to:</span></span>

```
https://myaccount.blob.core.windows.net/mycontainer/task1/output.txt
https://myaccount.blob.core.windows.net/mycontainer/task2/output.txt
```

<span data-ttu-id="badfd-175">Další informace o virtuálních adresářů v Azure Storage najdete v tématu [seznamu hello objektů BLOB v kontejneru](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span><span class="sxs-lookup"><span data-stu-id="badfd-175">For more information about virtual directories in Azure Storage, see [List hello blobs in a container](../storage/blobs/storage-dotnet-how-to-use-blobs.md#list-the-blobs-in-a-container).</span></span>


## <a name="diagnose-file-upload-errors"></a><span data-ttu-id="badfd-176">Diagnostikovat chyby odesílání souborů</span><span class="sxs-lookup"><span data-stu-id="badfd-176">Diagnose file upload errors</span></span>

<span data-ttu-id="badfd-177">Pokud odesílání výstupní soubory tooAzure úložiště selže, pak hello úloh přesune toohello **dokončeno** stavu a hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) je nastavena.</span><span class="sxs-lookup"><span data-stu-id="badfd-177">If uploading output files tooAzure Storage fails, then hello task moves toohello **Completed** state and hello [TaskExecutionInformation.FailureInformation](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.taskexecutioninformation.failureinformation#Microsoft_Azure_Batch_TaskExecutionInformation_FailureInformation) property is set.</span></span> <span data-ttu-id="badfd-178">Zkontrolujte hello **FailureInformation** toodetermine vlastnost co došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="badfd-178">Examine hello **FailureInformation** property toodetermine what error occurred.</span></span> <span data-ttu-id="badfd-179">Zde je ukázka, k chybě, která proběhne nahrávání souborů, pokud nelze nalézt kontejner hello:</span><span class="sxs-lookup"><span data-stu-id="badfd-179">For example, here is an error that occurs on file upload if hello container cannot be found:</span></span> 

```
Category: UserError
Code: FileUploadContainerNotFound
Message: One of hello specified Azure container(s) was not found while attempting tooupload an output file
```

<span data-ttu-id="badfd-180">Na každých nahrávání souborů Batch zapíše dva protokolu soubory toohello výpočetním uzlu, `fileuploadout.txt` a `fileuploaderr.txt`.</span><span class="sxs-lookup"><span data-stu-id="badfd-180">On every file upload, Batch writes two log files toohello compute node, `fileuploadout.txt` and `fileuploaderr.txt`.</span></span> <span data-ttu-id="badfd-181">Můžete zkontrolovat tyto soubory protokolu toolearn Další informace o konkrétní chyby.</span><span class="sxs-lookup"><span data-stu-id="badfd-181">You can examine these log files toolearn more about a specific failure.</span></span> <span data-ttu-id="badfd-182">V případech, kde hello nahrávání souborů byla nikdy pokus, např. protože vlastní úloha hello nebylo možné spustit pak tyto soubory protokolu neexistují.</span><span class="sxs-lookup"><span data-stu-id="badfd-182">In cases where hello file upload was never attempted, for example because hello task itself couldn’t run, then these log files will not exist.</span></span>

## <a name="diagnose-file-upload-performance"></a><span data-ttu-id="badfd-183">Diagnostika výkon nahrávání souborů</span><span class="sxs-lookup"><span data-stu-id="badfd-183">Diagnose file upload performance</span></span>

<span data-ttu-id="badfd-184">Hello `fileuploadout.txt` protokoly průběhu odesílání souboru.</span><span class="sxs-lookup"><span data-stu-id="badfd-184">hello `fileuploadout.txt` file logs upload progress.</span></span> <span data-ttu-id="badfd-185">Tento soubor toolearn, které další informace o tom, jak dlouho nahrávání souboru trvá můžete zkontrolovat.</span><span class="sxs-lookup"><span data-stu-id="badfd-185">You can examine this file toolearn more about how long your file uploads are taking.</span></span> <span data-ttu-id="badfd-186">Mějte na paměti, že existuje celá řada přispívajících faktorů tooupload výkonu, včetně velikosti hello hello uzlu, dalších aktivit na hello uzlu v době hello hello nahrávání, zda text hello cílový kontejner je v hello jsou stejné oblasti jako hello fondu Batch, kolik uzly odesílání toohello účet úložiště v hello stejný čas a tak dále.</span><span class="sxs-lookup"><span data-stu-id="badfd-186">Keep in mind that there are many contributing factors tooupload performance, including hello size of hello node, other activity on hello node at hello time of hello upload, whether hello target container is in hello same region as hello Batch pool, how many nodes are uploading toohello storage account at hello same time, and so on.</span></span>

## <a name="use-hello-batch-service-api-with-hello-batch-file-conventions-standard"></a><span data-ttu-id="badfd-187">Pomocí rozhraní API služby Batch hello hello dávkového souboru konvence standardní</span><span class="sxs-lookup"><span data-stu-id="badfd-187">Use hello Batch service API with hello Batch File Conventions standard</span></span>

<span data-ttu-id="badfd-188">Můžete zachovat výstup úlohy s hello rozhraní API služby Batch, můžete pojmenovat cílový kontejner a objekty BLOB, ale chcete.</span><span class="sxs-lookup"><span data-stu-id="badfd-188">When you persist task output with hello Batch service API, you can name your destination container and blobs however you like.</span></span> <span data-ttu-id="badfd-189">Můžete také tooname je podle toohello [dávkového souboru konvence standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span><span class="sxs-lookup"><span data-stu-id="badfd-189">You can also choose tooname them according toohello [Batch File Conventions standard](https://github.com/Azure/azure-sdk-for-net/tree/vs17Dev/src/SDKs/Batch/Support/FileConventions#conventions).</span></span> <span data-ttu-id="badfd-190">standardní konvence souboru Hello určuje hello názvy hello cílový kontejner a objektů blob v Azure Storage pro danou výstupní soubor založený na názvy hello hello úlohy a úlohy.</span><span class="sxs-lookup"><span data-stu-id="badfd-190">hello File Conventions standard determines hello names of hello destination container and blob in Azure Storage for a given output file based on hello names of hello job and task.</span></span> <span data-ttu-id="badfd-191">Pokud používáte hello standardní soubor konvence pro pojmenování výstupní soubory, pak výstupní soubory jsou k dispozici pro zobrazení v hello [portál Azure](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="badfd-191">If you do use hello File Conventions standard for naming output files, then your output files are available for viewing in hello [Azure portal](https://portal.azure.com).</span></span>

<span data-ttu-id="badfd-192">Pokud vyvíjíte v jazyce C#, můžete použít metody hello součástí hello [konvence souboru Batch library pro .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span><span class="sxs-lookup"><span data-stu-id="badfd-192">If you are developing in C#, you can use hello methods built into hello [Batch File Conventions library for .NET](https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files).</span></span> <span data-ttu-id="badfd-193">V této knihovně vytvoří hello správně s názvem kontejnerů a objektů blob cesty pro vás.</span><span class="sxs-lookup"><span data-stu-id="badfd-193">This library creates hello properly named containers and blob paths for you.</span></span> <span data-ttu-id="badfd-194">Například můžete volat hello rozhraní API tooget hello správný název kontejneru hello, na základě názvu úlohy hello:</span><span class="sxs-lookup"><span data-stu-id="badfd-194">For example, you can call hello API tooget hello correct name for hello container, based on hello job name:</span></span>

```csharp
string containerName = job.OutputStorageContainerName();
```

<span data-ttu-id="badfd-195">Můžete použít hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) metoda tooreturn adresu URL sdílený přístupový podpis (SAS), která je použité toowrite toohello kontejner.</span><span class="sxs-lookup"><span data-stu-id="badfd-195">You can use hello [CloudJobExtensions.GetOutputStorageContainerUrl](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.conventions.files.cloudjobextensions.getoutputstoragecontainerurl) method tooreturn a shared access signature (SAS) URL that is used toowrite toohello container.</span></span> <span data-ttu-id="badfd-196">Potom můžete předat tuto SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) konstruktor.</span><span class="sxs-lookup"><span data-stu-id="badfd-196">You can then pass this SAS toohello [OutputFileBlobContainerDestination](https://docs.microsoft.com/dotnet/api/microsoft.azure.batch.outputfileblobcontainerdestination) constructor.</span></span>

<span data-ttu-id="badfd-197">Pokud vyvíjíte v jiném jazyce než v C#, je nutné tooimplement hello souboru konvence standard sami.</span><span class="sxs-lookup"><span data-stu-id="badfd-197">If you are developing in a language other than C#, you will need tooimplement hello File Conventions standard yourself.</span></span>

## <a name="code-sample"></a><span data-ttu-id="badfd-198">Ukázka kódu</span><span class="sxs-lookup"><span data-stu-id="badfd-198">Code sample</span></span>

<span data-ttu-id="badfd-199">Hello [PersistOutputs] [ github_persistoutputs] ukázkový projekt je jedním z hello [ukázky kódu Azure Batch] [ github_samples] na Githubu.</span><span class="sxs-lookup"><span data-stu-id="badfd-199">hello [PersistOutputs][github_persistoutputs] sample project is one of hello [Azure Batch code samples][github_samples] on GitHub.</span></span> <span data-ttu-id="badfd-200">Toto řešení sady Visual Studio ukazuje, jak toouse hello Batch Klientská knihovna pro .NET toopersist úloh výstup toodurable úložiště.</span><span class="sxs-lookup"><span data-stu-id="badfd-200">This Visual Studio solution demonstrates how toouse hello Batch client library for .NET toopersist task output toodurable storage.</span></span> <span data-ttu-id="badfd-201">toorun hello ukázkové, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="badfd-201">toorun hello sample, follow these steps:</span></span>

1. <span data-ttu-id="badfd-202">Hello otevřete projekt v **Visual Studio 2015 nebo novější**.</span><span class="sxs-lookup"><span data-stu-id="badfd-202">Open hello project in **Visual Studio 2015 or newer**.</span></span>
2. <span data-ttu-id="badfd-203">Přidat Batch a Storage **přihlašovací údaje účtu** příliš**AccountSettings.settings** v projektu Microsoft.Azure.Batch.Samples.Common hello.</span><span class="sxs-lookup"><span data-stu-id="badfd-203">Add your Batch and Storage **account credentials** too**AccountSettings.settings** in hello Microsoft.Azure.Batch.Samples.Common project.</span></span>
3. <span data-ttu-id="badfd-204">**Sestavení** (ale není spuštěný) hello řešení.</span><span class="sxs-lookup"><span data-stu-id="badfd-204">**Build** (but do not run) hello solution.</span></span> <span data-ttu-id="badfd-205">Pokud se zobrazí výzva, obnovení všech balíčků NuGet.</span><span class="sxs-lookup"><span data-stu-id="badfd-205">Restore any NuGet packages if prompted.</span></span>
4. <span data-ttu-id="badfd-206">Použití hello Azure portálu tooupload [balíčku aplikace](batch-application-packages.md) pro **PersistOutputsTask**.</span><span class="sxs-lookup"><span data-stu-id="badfd-206">Use hello Azure portal tooupload an [application package](batch-application-packages.md) for **PersistOutputsTask**.</span></span> <span data-ttu-id="badfd-207">Zahrnout hello `PersistOutputsTask.exe` a jeho závislá sestavení v hello ZIP balíčku, ID aplikace hello sady příliš "PersistOutputsTask" a aplikace hello verze balíčku příliš "1.0".</span><span class="sxs-lookup"><span data-stu-id="badfd-207">Include hello `PersistOutputsTask.exe` and its dependent assemblies in hello .zip package, set hello application ID too"PersistOutputsTask", and hello application package version too"1.0".</span></span>
5. <span data-ttu-id="badfd-208">**Spustit** (spustit) hello **PersistOutputs** projektu.</span><span class="sxs-lookup"><span data-stu-id="badfd-208">**Start** (run) hello **PersistOutputs** project.</span></span>
6. <span data-ttu-id="badfd-209">Když výzvami toochoose hello trvalost technologie toouse pro spuštěné hello ukázku, zadejte **2** toorun hello ukázku pomocí výstup úlohy toopersist hello rozhraní API služby Batch.</span><span class="sxs-lookup"><span data-stu-id="badfd-209">When prompted toochoose hello persistence technology toouse for running hello sample, enter **2** toorun hello sample using hello Batch service API toopersist task output.</span></span>
7. <span data-ttu-id="badfd-210">V případě potřeby hello ukázku spustit znovu, zadávání **3** toopersist výstup s hello rozhraní API služby Batch a také tooname hello cílovou kontejnerů a objektů blob cestu, podle toohello souboru konvence standardní.</span><span class="sxs-lookup"><span data-stu-id="badfd-210">If desired, run hello sample again, entering **3** toopersist output with hello Batch service API, and also tooname hello destination container and blob path according toohello File Conventions standard.</span></span>

## <a name="next-steps"></a><span data-ttu-id="badfd-211">Další kroky</span><span class="sxs-lookup"><span data-stu-id="badfd-211">Next steps</span></span>

- <span data-ttu-id="badfd-212">Další informace o zachování výstup úlohy s knihovnou hello souboru konvence pro rozhraní .NET najdete v tématu [zachovat úloh a úkolů tooAzure dat úložiště s knihovnou hello konvence souboru Batch pro .NET toopersist ](batch-task-output-file-conventions.md).</span><span class="sxs-lookup"><span data-stu-id="badfd-212">For more information on persisting task output with hello File Conventions library for .NET, see [Persist job and task data tooAzure Storage with hello Batch File Conventions library for .NET toopersist ](batch-task-output-file-conventions.md).</span></span>
- <span data-ttu-id="badfd-213">Informace o dalších přístupy k zachování výstupní data ve službě Azure Batch, najdete v části [zachovat úlohy a úkolů výstupní tooAzure úložiště](batch-task-output.md).</span><span class="sxs-lookup"><span data-stu-id="badfd-213">For information on other approaches for persisting output data in Azure Batch, see [Persist job and task output tooAzure Storage](batch-task-output.md).</span></span>

[github_persistoutputs]: https://github.com/Azure/azure-batch-samples/tree/master/CSharp/ArticleProjects/PersistOutputs
[github_samples]: https://github.com/Azure/azure-batch-samples

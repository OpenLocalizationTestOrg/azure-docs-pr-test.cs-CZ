---
title: "Začněte vytvářet řešení Batch pomocí šablony projektů Visual Studio – Azure | Microsoft Docs"
description: "Zjistěte, jak pomocí šablony projektů Visual Studio můžete implementovat a spouštět úlohy náročné na Azure Batch."
services: batch
documentationcenter: .net
author: fayora
manager: timlt
editor: 
ms.assetid: 5e041ae2-25af-4882-a79e-3aa63c4bfb20
ms.service: batch
ms.devlang: multiple
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: big-compute
ms.date: 02/27/2017
ms.author: tamram
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: da77ce827c65deb18d9d84ce5cf768d89788e205
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="use-visual-studio-project-templates-to-jump-start-batch-solutions"></a><span data-ttu-id="d6c50-103">Sestavování řešení Batch pomocí šablony projektů Visual Studio</span><span class="sxs-lookup"><span data-stu-id="d6c50-103">Use Visual Studio project templates to jump-start Batch solutions</span></span>

<span data-ttu-id="d6c50-104">**Správce úloh** a **šablony sady Visual Studio úloh procesoru** pro dávku zadejte kód, abyste pro implementaci a spouštění výpočetně náročných úloh na dávce s minimem úsilí.</span><span class="sxs-lookup"><span data-stu-id="d6c50-104">The **Job Manager** and **Task Processor Visual Studio templates** for Batch provide code to help you to implement and run your compute-intensive workloads on Batch with the least amount of effort.</span></span> <span data-ttu-id="d6c50-105">Tento dokument popisuje tyto šablony a poskytuje pokyny, jak je používat.</span><span class="sxs-lookup"><span data-stu-id="d6c50-105">This document describes these templates and provides guidance for how to use them.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d6c50-106">Tento článek popisuje pouze informace pro tyto dvě šablony a předpokládá, že jste obeznámeni se službou Batch a s ním souvisejí klíčové koncepty: fondy, výpočetní uzly, úlohy a úlohy, úkolech Správce úloh, proměnné prostředí a další relevantní informace.</span><span class="sxs-lookup"><span data-stu-id="d6c50-106">This article discusses only information applicable to these two templates, and assumes that you are familiar with the Batch service and key concepts related to it: pools, compute nodes, jobs and tasks, job manager tasks, environment variables, and other relevant information.</span></span> <span data-ttu-id="d6c50-107">Můžete najít další informace v [základy Azure Batch](batch-technical-overview.md), [přehled funkcí Batch pro vývojáře](batch-api-basics.md), a [Začínáme s knihovnou Azure Batch pro .NET](batch-dotnet-get-started.md).</span><span class="sxs-lookup"><span data-stu-id="d6c50-107">You can find more information in [Basics of Azure Batch](batch-technical-overview.md), [Batch feature overview for developers](batch-api-basics.md), and [Get started with the Azure Batch library for .NET](batch-dotnet-get-started.md).</span></span>
> 
> 

## <a name="high-level-overview"></a><span data-ttu-id="d6c50-108">Podrobný přehled</span><span class="sxs-lookup"><span data-stu-id="d6c50-108">High-level overview</span></span>
<span data-ttu-id="d6c50-109">Správce úloh a úloh procesoru šablony lze vytvořit užitečné dvě součásti:</span><span class="sxs-lookup"><span data-stu-id="d6c50-109">The Job Manager and Task Processor templates can be used to create two useful components:</span></span>

* <span data-ttu-id="d6c50-110">Úkolu Správce úloh, který implementuje rozdělovače úlohy, který můžete rozdělit úlohu na více úkolů, které můžete spustit samostatně, paralelně.</span><span class="sxs-lookup"><span data-stu-id="d6c50-110">A job manager task that implements a job splitter that can break a job down into multiple tasks that can run independently, in parallel.</span></span>
* <span data-ttu-id="d6c50-111">Procesor úloh, které lze použít k provádění předem zpracování a po zpracování kolem příkazového řádku s aplikací.</span><span class="sxs-lookup"><span data-stu-id="d6c50-111">A task processor that can be used to perform pre-processing and post-processing around an application command line.</span></span>

<span data-ttu-id="d6c50-112">Například v případě vykreslování film by rozdělovače úlohy zapnout úlohu jeden film do stovkami nebo tisíci samostatné úkoly, které by jednotlivé snímky zpracovávají odděleně.</span><span class="sxs-lookup"><span data-stu-id="d6c50-112">For example, in a movie rendering scenario, the job splitter would turn a single movie job into hundreds or thousands of separate tasks that would process individual frames separately.</span></span> <span data-ttu-id="d6c50-113">Odpovídajícím způsobem procesoru úloh by měl vyvolat vykreslování aplikace a všechny závislé procesy, které jsou potřebné k vykreslení každý rámečku, jakož i provádět žádné další akce (například kopírování vykreslené rámečku do umístění úložiště).</span><span class="sxs-lookup"><span data-stu-id="d6c50-113">Correspondingly, the task processor would invoke the rendering application and all dependent processes that are needed to render each frame, as well as perform any additional actions (for example, copying the rendered frame to a storage location).</span></span>

> [!NOTE]
> <span data-ttu-id="d6c50-114">Správce úloh a úloh procesoru šablony jsou nezávisle na sobě navzájem, takže můžete použít obě, nebo jenom jeden z nich, v závislosti na požadavcích vaší výpočetní úlohy a vaše předvolby.</span><span class="sxs-lookup"><span data-stu-id="d6c50-114">The Job Manager and Task Processor templates are independent of each other, so you can choose to use both, or only one of them, depending on the requirements of your compute job and on your preferences.</span></span>
> 
> 

<span data-ttu-id="d6c50-115">Jak je znázorněno v následujícím diagramu, bude výpočetní úlohu, která používá tyto šablony projít tří fází:</span><span class="sxs-lookup"><span data-stu-id="d6c50-115">As shown in the diagram below, a compute job that uses these templates will go through three stages:</span></span>

1. <span data-ttu-id="d6c50-116">Kód klienta (např. aplikace, webové služby atd.) odešle úlohu pro službu Batch v Azure, a určení jako jeho Správce úloh úkolů programu Správce úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-116">The client code (e.g., application, web service, etc.) submits a job to the Batch service on Azure, specifying as its job manager task the job manager program.</span></span>
2. <span data-ttu-id="d6c50-117">Služba Batch spustí úkol správce na výpočetním uzlu a rozdělovače úloha spustí na zadaný počet úloh procesoru úlohy, jako mnoho výpočetní uzly podle potřeby, na základě specifikací v kódu rozdělovače úlohy a parametry.</span><span class="sxs-lookup"><span data-stu-id="d6c50-117">The Batch service runs the job manager task on a compute node and the job splitter launches the specified number of task processor tasks, on as many compute nodes as required, based on the parameters and specifications in the job splitter code.</span></span>
3. <span data-ttu-id="d6c50-118">Procesor úkoly úloh spustit samostatně, paralelní zpracování vstupních dat a vygenerovat výstupní data.</span><span class="sxs-lookup"><span data-stu-id="d6c50-118">The task processor tasks run independently, in parallel, to process the input data and generate the output data.</span></span>

![Diagram znázorňující, jak kód klienta komunikuje se službou Batch][diagram01]

## <a name="prerequisites"></a><span data-ttu-id="d6c50-120">Požadavky</span><span class="sxs-lookup"><span data-stu-id="d6c50-120">Prerequisites</span></span>
<span data-ttu-id="d6c50-121">Použití šablon Batch, budete potřebovat následující:</span><span class="sxs-lookup"><span data-stu-id="d6c50-121">To use the Batch templates, you will need the following:</span></span>

* <span data-ttu-id="d6c50-122">Počítač s nainstalovaná sada Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="d6c50-122">A computer with Visual Studio 2015 installed.</span></span> <span data-ttu-id="d6c50-123">Šablony batch jsou aktuálně podporovány pouze pro Visual Studio 2015.</span><span class="sxs-lookup"><span data-stu-id="d6c50-123">Batch templates are currently only supported for Visual Studio 2015.</span></span>
* <span data-ttu-id="d6c50-124">Batch šablony, které jsou k dispozici na [Galerie sady Visual Studio] [ vs_gallery] jako rozšíření Visual Studia.</span><span class="sxs-lookup"><span data-stu-id="d6c50-124">The Batch templates, which are available from the [Visual Studio Gallery][vs_gallery] as Visual Studio extensions.</span></span> <span data-ttu-id="d6c50-125">Existují dva způsoby, jak získat šablony:</span><span class="sxs-lookup"><span data-stu-id="d6c50-125">There are two ways to get the templates:</span></span>
  
  * <span data-ttu-id="d6c50-126">Instalace šablony pomocí **rozšíření a aktualizace** dialogové okno v sadě Visual Studio (Další informace najdete v tématu [hledání a používání rozšíření Visual Studia][vs_find_use_ext]).</span><span class="sxs-lookup"><span data-stu-id="d6c50-126">Install the templates using the **Extensions and Updates** dialog box in Visual Studio (for more information, see [Finding and Using Visual Studio Extensions][vs_find_use_ext]).</span></span> <span data-ttu-id="d6c50-127">V **rozšíření a aktualizace** dialogové okno pole, vyhledávání a stáhněte si následující dvě rozšíření:</span><span class="sxs-lookup"><span data-stu-id="d6c50-127">In the **Extensions and Updates** dialog box, search and download the following two extensions:</span></span>
    
    * <span data-ttu-id="d6c50-128">Správce úloh Azure Batch pomocí rozdělovače úlohy</span><span class="sxs-lookup"><span data-stu-id="d6c50-128">Azure Batch Job Manager with Job Splitter</span></span>
    * <span data-ttu-id="d6c50-129">Procesor úlohy Azure Batch</span><span class="sxs-lookup"><span data-stu-id="d6c50-129">Azure Batch Task Processor</span></span>
  * <span data-ttu-id="d6c50-130">Stáhnout šablony z online Galerie pro sadu Visual Studio: [projektu šablony aplikace Microsoft Azure Batch][vs_gallery_templates]</span><span class="sxs-lookup"><span data-stu-id="d6c50-130">Download the templates from the online gallery for Visual Studio: [Microsoft Azure Batch Project Templates][vs_gallery_templates]</span></span>
* <span data-ttu-id="d6c50-131">Pokud budete chtít použít [balíčky aplikací](batch-application-packages.md) funkci k nasazení Správce úloh a úloh procesor dávky výpočetní uzly, budete muset propojit účet úložiště k účtu Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-131">If you plan to use the [Application Packages](batch-application-packages.md) feature to deploy the job manager and task processor to the Batch compute nodes, you need to link a storage account to your Batch account.</span></span>

## <a name="preparation"></a><span data-ttu-id="d6c50-132">Příprava</span><span class="sxs-lookup"><span data-stu-id="d6c50-132">Preparation</span></span>
<span data-ttu-id="d6c50-133">Doporučujeme vytvářet řešení, které může obsahovat váš správce úloh a také vaše úloha procesoru, protože to může být usnadňuje sdílení kódu mezi Správce úloh a úloh procesoru programy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-133">We recommend creating a solution that can contain your job manager as well as your task processor, because this can make it easier to share code between your job manager and task processor programs.</span></span> <span data-ttu-id="d6c50-134">Pokud chcete vytvořit toto řešení, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="d6c50-134">To create this solution, follow these steps:</span></span>

1. <span data-ttu-id="d6c50-135">Otevřete Visual Studio a vyberte **soubor** > **nový** > **projektu**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-135">Open Visual Studio and select **File** > **New** > **Project**.</span></span>
2. <span data-ttu-id="d6c50-136">V části **šablony**, rozbalte položku **jiné typy projektů**, klikněte na tlačítko **řešení sady Visual Studio**a potom vyberte **prázdného řešení**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-136">Under **Templates**, expand **Other Project Types**, click **Visual Studio Solutions**, and then select **Blank Solution**.</span></span>
3. <span data-ttu-id="d6c50-137">Zadejte název, který popisuje vaší aplikace a účel tohoto řešení (například "LitwareBatchTaskPrograms").</span><span class="sxs-lookup"><span data-stu-id="d6c50-137">Type a name that describes your application and the purpose of this solution (e.g., "LitwareBatchTaskPrograms").</span></span>
4. <span data-ttu-id="d6c50-138">Chcete-li vytvořit nové řešení, klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-138">To create the new solution, click **OK**.</span></span>

## <a name="job-manager-template"></a><span data-ttu-id="d6c50-139">Správce úloh šablony</span><span class="sxs-lookup"><span data-stu-id="d6c50-139">Job Manager template</span></span>
<span data-ttu-id="d6c50-140">Správce úloh šablony pomáhá při implementaci úkolu Správce úloh, které můžete provádět následující akce:</span><span class="sxs-lookup"><span data-stu-id="d6c50-140">The Job Manager template helps you to implement a job manager task that can perform the following actions:</span></span>

* <span data-ttu-id="d6c50-141">Úlohu rozdělte do několika úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-141">Split a job into multiple tasks.</span></span>
* <span data-ttu-id="d6c50-142">Odešlete tyto úlohy ke spuštění v dávce.</span><span class="sxs-lookup"><span data-stu-id="d6c50-142">Submit those tasks to run on Batch.</span></span>

> [!NOTE]
> <span data-ttu-id="d6c50-143">Další informace o úkolech Správce úloh najdete v tématu [přehled funkcí Batch pro vývojáře](batch-api-basics.md#job-manager-task).</span><span class="sxs-lookup"><span data-stu-id="d6c50-143">For more information about job manager tasks, see [Batch feature overview for developers](batch-api-basics.md#job-manager-task).</span></span>
> 
> 

### <a name="create-a-job-manager-using-the-template"></a><span data-ttu-id="d6c50-144">Vytvoření správce úloh, pomocí šablony</span><span class="sxs-lookup"><span data-stu-id="d6c50-144">Create a Job Manager using the template</span></span>
<span data-ttu-id="d6c50-145">Chcete-li přidat správce úloh na řešení, které jste vytvořili dříve, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="d6c50-145">To add a job manager to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="d6c50-146">Otevřete existující řešení v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d6c50-146">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="d6c50-147">V Průzkumníku řešení klikněte pravým tlačítkem na řešení, klikněte na tlačítko **přidat** > **nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-147">In Solution Explorer, right-click the solution, click **Add** > **New Project**.</span></span>
3. <span data-ttu-id="d6c50-148">V části **Visual C#**, klikněte na tlačítko **cloudu**a potom klikněte na **Správce úloh Azure Batch pomocí úlohy rozdělovače**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-148">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Job Manager with Job Splitter**.</span></span>
4. <span data-ttu-id="d6c50-149">Zadejte název, který popisuje vaší aplikace a identifikuje tohoto projektu jako správce úloh (např.) "LitwareJobManager").</span><span class="sxs-lookup"><span data-stu-id="d6c50-149">Type a name that describes your application and identifies this project as the job manager (e.g. "LitwareJobManager").</span></span>
5. <span data-ttu-id="d6c50-150">Chcete-li vytvořit projekt, klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-150">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="d6c50-151">Nakonec sestavte projekt a vynutit sadě Visual Studio načíst všechny odkazované balíčky NuGet a ověřte, zda je projekt platný před zahájením provádění úprav.</span><span class="sxs-lookup"><span data-stu-id="d6c50-151">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="job-manager-template-files-and-their-purpose"></a><span data-ttu-id="d6c50-152">Soubory šablon Správce úloh a jejich účel</span><span class="sxs-lookup"><span data-stu-id="d6c50-152">Job Manager template files and their purpose</span></span>
<span data-ttu-id="d6c50-153">Když vytvoříte projekt pomocí šablony Správce úloh, generuje tři skupiny soubory kódu:</span><span class="sxs-lookup"><span data-stu-id="d6c50-153">When you create a project using the Job Manager template, it generates three groups of code files:</span></span>

* <span data-ttu-id="d6c50-154">Hlavní programový soubor (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="d6c50-154">The main program file (Program.cs).</span></span> <span data-ttu-id="d6c50-155">Tato položka obsahuje program Vstupní bod a nejvyšší úrovně výjimek.</span><span class="sxs-lookup"><span data-stu-id="d6c50-155">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="d6c50-156">Neměli byste potřebovat obvykle tuto možnost lze upravit.</span><span class="sxs-lookup"><span data-stu-id="d6c50-156">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="d6c50-157">Do složky Framework.</span><span class="sxs-lookup"><span data-stu-id="d6c50-157">The Framework directory.</span></span> <span data-ttu-id="d6c50-158">Tato položka obsahuje soubory zodpovědná za práci, často používaný' pomocí programu Správce úloh – rozbalování parametrů, přidávání úkolů do úlohy Batch atd. Neměli byste potřebovat normálně k úpravě těchto souborů.</span><span class="sxs-lookup"><span data-stu-id="d6c50-158">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="d6c50-159">Soubor rozdělovače úlohy (JobSplitter.cs).</span><span class="sxs-lookup"><span data-stu-id="d6c50-159">The job splitter file (JobSplitter.cs).</span></span> <span data-ttu-id="d6c50-160">Toto je, kam jste umístili specifické pro aplikaci logiky k rozdělení úlohu do úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-160">This is where you will put your application-specific logic for splitting a job into tasks.</span></span>

<span data-ttu-id="d6c50-161">Samozřejmě můžete přidat další soubory jako nezbytný pro podporu kódu rozdělovače úlohy, v závislosti na složitosti úlohu, rozdělování logiku.</span><span class="sxs-lookup"><span data-stu-id="d6c50-161">Of course you can add additional files as required to support your job splitter code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="d6c50-162">Šablona generuje také standardní soubory rozhraní .NET projektu, například souboru .csproj, app.config, souboru packages.config, atd.</span><span class="sxs-lookup"><span data-stu-id="d6c50-162">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="d6c50-163">Zbývající část tohoto oddílu popisuje různých souborů a jejich struktura kódu a vysvětluje, jaké jsou jednotlivé třídy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-163">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Průzkumník řešení Visual Studio, které jsou zobrazující Správce úloh šablony řešení][solution_explorer01]

<span data-ttu-id="d6c50-165">**Soubory Framework**</span><span class="sxs-lookup"><span data-stu-id="d6c50-165">**Framework files**</span></span>

* <span data-ttu-id="d6c50-166">`Configuration.cs`: Zapouzdří načítání úlohy konfigurační data, jako je například Podrobnosti účtu Batch, přihlašovací údaje účtu propojené úložiště, úlohy a informace o úloze a parametry úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-166">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="d6c50-167">Také poskytuje přístup k proměnné prostředí definované Batch (viz nastavení prostředí pro úkoly v dokumentaci k Batch) prostřednictvím třídy Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="d6c50-167">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="d6c50-168">`IConfiguration.cs`: Abstrahuje implementace třídy konfigurace, aby bylo možné testování částí rozdělovače vaše úlohy pomocí falešných nebo imitované konfiguraci objektu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-168">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="d6c50-169">`JobManager.cs`: Orchestruje součástí programu Správce úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-169">`JobManager.cs`: Orchestrates the components of the job manager program.</span></span> <span data-ttu-id="d6c50-170">Zodpovídá za inicializaci rozdělovače úlohy, vyvolání rozdělovače úlohy a odeslání úlohy vrácený rozdělovače úlohy k odesílatel úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-170">It is responsible for the initializing the job splitter, invoking the job splitter, and dispatching the tasks returned by the job splitter to the task submitter.</span></span>
* <span data-ttu-id="d6c50-171">`JobManagerException.cs`: Představuje chybu, která vyžaduje Správce úloh ukončit.</span><span class="sxs-lookup"><span data-stu-id="d6c50-171">`JobManagerException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="d6c50-172">JobManagerException slouží k zabalení 'očekávaný: chyby, kde lze zadat konkrétní diagnostické informace jako součást ukončení.</span><span class="sxs-lookup"><span data-stu-id="d6c50-172">JobManagerException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>
* <span data-ttu-id="d6c50-173">`TaskSubmitter.cs`: Tato třída je zodpovědný přidávání úkolů vrácený rozdělovače úlohy pro dávkové úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-173">`TaskSubmitter.cs`: This class is responsible to adding tasks returned by the job splitter to the Batch job.</span></span> <span data-ttu-id="d6c50-174">Agreguje třída JobManager pořadí úloh do dávek pro efektivní, ale včas přidání do úlohy, potom volá TaskSubmitter.SubmitTasks vlákna na pozadí pro každou dávku.</span><span class="sxs-lookup"><span data-stu-id="d6c50-174">The JobManager class aggregates the sequence of tasks into batches for efficient but timely addition to the job, then calls TaskSubmitter.SubmitTasks on a background thread for each batch.</span></span>

<span data-ttu-id="d6c50-175">**Úloha rozdělovače**</span><span class="sxs-lookup"><span data-stu-id="d6c50-175">**Job Splitter**</span></span>

<span data-ttu-id="d6c50-176">`JobSplitter.cs`: Tato třída obsahuje konkrétní aplikace logiky k rozdělení úlohu do úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-176">`JobSplitter.cs`: This class contains application-specific logic for splitting the job into tasks.</span></span> <span data-ttu-id="d6c50-177">Rozhraní framework vyvolá metodu JobSplitter.Split získat sekvenci úlohy, které přidá do úlohy, jako je metoda vrátí.</span><span class="sxs-lookup"><span data-stu-id="d6c50-177">The framework invokes the JobSplitter.Split method to obtain a sequence of tasks, which it adds to the job as the method returns them.</span></span> <span data-ttu-id="d6c50-178">Toto je třída, kde bude vložit logiku úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-178">This is the class where you will inject the logic of your job.</span></span> <span data-ttu-id="d6c50-179">Implementujte metodu rozdělení vrátit posloupnost instancí CloudTask představující úlohy, do kterých chcete oddílu úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-179">Implement the Split method to return a sequence of CloudTask instances representing the tasks into which you want to partition the job.</span></span>

<span data-ttu-id="d6c50-180">**Standardní soubory projektu příkazového řádku .NET**</span><span class="sxs-lookup"><span data-stu-id="d6c50-180">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="d6c50-181">`App.config`: Standardní soubor konfigurace aplikace .NET.</span><span class="sxs-lookup"><span data-stu-id="d6c50-181">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="d6c50-182">`Packages.config`: Standardní soubor závislost balíčku NuGet.</span><span class="sxs-lookup"><span data-stu-id="d6c50-182">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="d6c50-183">`Program.cs`: Obsahuje program Vstupní bod a nejvyšší úrovně výjimek.</span><span class="sxs-lookup"><span data-stu-id="d6c50-183">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

### <a name="implementing-the-job-splitter"></a><span data-ttu-id="d6c50-184">Implementace rozdělovače úlohy</span><span class="sxs-lookup"><span data-stu-id="d6c50-184">Implementing the job splitter</span></span>
<span data-ttu-id="d6c50-185">Když otevřete Správce úloh šablony projektu, projekt bude mít JobSplitter.cs soubor otevřete ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="d6c50-185">When you open the Job Manager template project, the project will have the JobSplitter.cs file open by default.</span></span> <span data-ttu-id="d6c50-186">Rozdělení logiku pro úlohy můžete implementovat v vaše úlohy pomocí zobrazení metoda Split() níže:</span><span class="sxs-lookup"><span data-stu-id="d6c50-186">You can implement the split logic for the tasks in your workload by using the Split() method show below:</span></span>

```csharp
/// <summary>
/// Gets the tasks into which to split the job. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The job manager framework invokes the Split method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation should return tasks lazily, for example using a C#
/// iterator and the "yield return" statement; this allows tasks to be added
/// and to start running while splitting is still in progress.
/// </summary>
/// <returns>The tasks to be added to the job. Tasks are added automatically
/// by the job manager framework as they are returned by this method.</returns>
public IEnumerable<CloudTask> Split()
{
    // Your code for the split logic goes here.
    int startFrame = Convert.ToInt32(_parameters["StartFrame"]);
    int endFrame = Convert.ToInt32(_parameters["EndFrame"]);

    for (int i = startFrame; i <= endFrame; i++)
    {
        yield return new CloudTask("myTask" + i, "cmd /c dir");
    }
}
```

> [!NOTE]
> <span data-ttu-id="d6c50-187">Části s poznámkami v `Split()` metoda je části pouze kód šablony Správce úloh, který je určena pro vás upravit přidáním logiku rozdělení úloh na různé úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-187">The annotated section in the `Split()` method is the only section of the Job Manager template code that is intended for you to modify by adding the logic to split your jobs into different tasks.</span></span> <span data-ttu-id="d6c50-188">Pokud chcete změnit různé části šablony, zkontrolujte, zda jsou familiarized s fungování Batch a vyzkoušejte několik [ukázky kódu služby Batch][github_samples].</span><span class="sxs-lookup"><span data-stu-id="d6c50-188">If you want to modify a different section of the template, please ensure you are familiarized with how Batch works, and try out a few of the [Batch code samples][github_samples].</span></span>
> 
> 

<span data-ttu-id="d6c50-189">Implementace Split() má přístup k:</span><span class="sxs-lookup"><span data-stu-id="d6c50-189">Your Split() implementation has access to:</span></span>

* <span data-ttu-id="d6c50-190">Parametry úlohy prostřednictvím `_parameters` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-190">The job parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="d6c50-191">CloudJob objekt představující úlohu, prostřednictvím `_job` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-191">The CloudJob object representing the job, via the `_job` field.</span></span>
* <span data-ttu-id="d6c50-192">Objektu CloudTask představující úkolu Správce úloh, pomocí `_jobManagerTask` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-192">The CloudTask object representing the job manager task, via the `_jobManagerTask` field.</span></span>

<span data-ttu-id="d6c50-193">Vaše `Split()` implementace nemusí přímo přidání úkolů do úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-193">Your `Split()` implementation does not need to add tasks to the job directly.</span></span> <span data-ttu-id="d6c50-194">Místo toho kódu by měla vrátit pořadí objektů CloudTask a tyto do úlohy automaticky přidá framework třídy, které vyvolají rozdělovače úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-194">Instead, your code should return a sequence of CloudTask objects, and these will be added to the job automatically by the framework classes that invoke the job splitter.</span></span> <span data-ttu-id="d6c50-195">Je běžné použití jazyka C# na iterator (`yield return`) funkce pro implementaci příčky úlohy, jako to umožňuje úlohy spusťte nejdříve systémem než čekání na všechny úlohy se vypočítá.</span><span class="sxs-lookup"><span data-stu-id="d6c50-195">It's common to use C#'s iterator (`yield return`) feature to implement job splitters as this allows the tasks to start running as soon as possible rather than waiting for all tasks to be calculated.</span></span>

<span data-ttu-id="d6c50-196">**Selhání úlohy rozdělovače**</span><span class="sxs-lookup"><span data-stu-id="d6c50-196">**Job splitter failure**</span></span>

<span data-ttu-id="d6c50-197">Pokud vaše úlohy rozdělovače dojde k chybě, měli buď:</span><span class="sxs-lookup"><span data-stu-id="d6c50-197">If your job splitter encounters an error, it should either:</span></span>

* <span data-ttu-id="d6c50-198">Ukončit pořadí pomocí jazyka C# `yield break` příkaz, ve kterém bude případ Správce úloh jednal jako úspěšné; nebo</span><span class="sxs-lookup"><span data-stu-id="d6c50-198">Terminate the sequence using the C# `yield break` statement, in which case the job manager will be treated as successful; or</span></span>
* <span data-ttu-id="d6c50-199">Způsobí výjimku, ve kterém případě, kdy správce úloh bude považována za se nezdařilo a může být opakována v závislosti na tom, jak klient má nakonfigurované ji).</span><span class="sxs-lookup"><span data-stu-id="d6c50-199">Throw an exception, in which case the job manager will be treated as failed and may be retried depending on how the client has configured it).</span></span>

<span data-ttu-id="d6c50-200">V obou případech bude vhodné spouštět všechny úlohy už vrácený rozdělovače úlohy a přidány do úlohy Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-200">In both cases, any tasks already returned by the job splitter and added to the Batch job will be eligible to run.</span></span> <span data-ttu-id="d6c50-201">Pokud nechcete, aby k tomu dojít, pak vám může:</span><span class="sxs-lookup"><span data-stu-id="d6c50-201">If you don't want this to happen, then you could:</span></span>

* <span data-ttu-id="d6c50-202">Ukončit úlohu před návratem od rozdělovače úlohy</span><span class="sxs-lookup"><span data-stu-id="d6c50-202">Terminate the job before returning from the job splitter</span></span>
* <span data-ttu-id="d6c50-203">Formulovali celý úkol kolekcí před jejím vrácením (tedy vrátit `ICollection<CloudTask>` nebo `IList<CloudTask>` místo implementace rozdělovače vaše úlohy pomocí iterator C#)</span><span class="sxs-lookup"><span data-stu-id="d6c50-203">Formulate the entire task collection before returning it (that is, return an `ICollection<CloudTask>` or `IList<CloudTask>` instead of implementing your job splitter using a C# iterator)</span></span>
* <span data-ttu-id="d6c50-204">Ujistěte se, všechny úlohy, které závisí na úspěšné dokončení Správce úloh pomocí závislosti úkolů</span><span class="sxs-lookup"><span data-stu-id="d6c50-204">Use task dependencies to make all tasks depend on the successful completion of the job manager</span></span>

<span data-ttu-id="d6c50-205">**Opakování úlohy správce**</span><span class="sxs-lookup"><span data-stu-id="d6c50-205">**Job manager retries**</span></span>

<span data-ttu-id="d6c50-206">Pokud správce úloh selže, může pokus o službou Batch v závislosti na nastavení klienta opakování.</span><span class="sxs-lookup"><span data-stu-id="d6c50-206">If the job manager fails, it may be retried by the Batch service depending on the client retry settings.</span></span> <span data-ttu-id="d6c50-207">Obecně platí to je bezpečné, protože při rozhraní přidá úkolů do úlohy, je ignorováno jakékoli úlohy, které již existují.</span><span class="sxs-lookup"><span data-stu-id="d6c50-207">In general, this is safe, because when the framework adds tasks to the job, it ignores any tasks that already exist.</span></span> <span data-ttu-id="d6c50-208">Ale pokud výpočet úlohy je náročná, nemusí chcete zpoplatněná náklady přepočítání úlohy, které již byly přidány do úlohy; Naopak pokud ke generování ID pro stejnou úlohu spusťte znovu není zaručena pak chování 'ignorovat duplicity' nebude nové.</span><span class="sxs-lookup"><span data-stu-id="d6c50-208">However, if calculating tasks is expensive, you may not wish to incur the cost of recalculating tasks that have already been added to the job; conversely, if the re-run is not guaranteed to generate the same task IDs then the 'ignore duplicates' behavior will not kick in.</span></span> <span data-ttu-id="d6c50-209">V těchto případech měli navrhnout vaše úlohy rozdělovače ke zjištění práci, kterou již bylo provedeno a neopakuje, například provedením CloudJob.ListTasks předtím, než začnete yield úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-209">In these cases you should design your job splitter to detect the work that has already been done and not repeat it, for example by performing a CloudJob.ListTasks before starting to yield tasks.</span></span>

### <a name="exit-codes-and-exceptions-in-the-job-manager-template"></a><span data-ttu-id="d6c50-210">Kódy ukončení a výjimky v šabloně Správce úloh</span><span class="sxs-lookup"><span data-stu-id="d6c50-210">Exit codes and exceptions in the Job Manager template</span></span>
<span data-ttu-id="d6c50-211">Kódy ukončení a výjimky poskytují mechanismus určit výsledek spuštění programu, a může pomoct zjistit případné problémy s spuštění programu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-211">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help to identify any problems with the execution of the program.</span></span> <span data-ttu-id="d6c50-212">Správce úloh šablony implementuje ukončovacích kódů a výjimek popsaných v této části.</span><span class="sxs-lookup"><span data-stu-id="d6c50-212">The Job Manager template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="d6c50-213">Úkolu Správce úloh, která je implementována pomocí šablony Správce úloh se můžete vrátit tři možné ukončovací kód:</span><span class="sxs-lookup"><span data-stu-id="d6c50-213">A job manager task that is implemented with the Job Manager template can return three possible exit codes:</span></span>

| <span data-ttu-id="d6c50-214">Kód</span><span class="sxs-lookup"><span data-stu-id="d6c50-214">Code</span></span> | <span data-ttu-id="d6c50-215">Popis</span><span class="sxs-lookup"><span data-stu-id="d6c50-215">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d6c50-216">0</span><span class="sxs-lookup"><span data-stu-id="d6c50-216">0</span></span> |<span data-ttu-id="d6c50-217">Správce úloh byla úspěšně dokončena.</span><span class="sxs-lookup"><span data-stu-id="d6c50-217">The job manager completed successfully.</span></span> <span data-ttu-id="d6c50-218">Rozdělovače kódu úlohy byl dokončen a všechny úlohy byly přidány do úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-218">Your job splitter code ran to completion, and all tasks were added to the job.</span></span> |
| <span data-ttu-id="d6c50-219">1</span><span class="sxs-lookup"><span data-stu-id="d6c50-219">1</span></span> |<span data-ttu-id="d6c50-220">Úkolu Správce úloh se nezdařilo s výjimkou v 'očekávané' součástí programu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-220">The job manager task failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="d6c50-221">Výjimka byla převedeny na JobManagerException s diagnostické informace a, kde je to možné, návrhy na řešení selhání.</span><span class="sxs-lookup"><span data-stu-id="d6c50-221">The exception was translated to a JobManagerException with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="d6c50-222">2</span><span class="sxs-lookup"><span data-stu-id="d6c50-222">2</span></span> |<span data-ttu-id="d6c50-223">Úkolu Správce úloh se nezdařilo s výjimkou 'neočekávané'.</span><span class="sxs-lookup"><span data-stu-id="d6c50-223">The job manager task failed with an 'unexpected' exception.</span></span> <span data-ttu-id="d6c50-224">Protokolu byla zaznamenána výjimka standardním výstupu, ale Správci úloh se nepodařilo přidat žádné další diagnostiky nebo nápravnou informace.</span><span class="sxs-lookup"><span data-stu-id="d6c50-224">The exception was logged to standard output, but the job manager was unable to add any additional diagnostic or remediation information.</span></span> |

<span data-ttu-id="d6c50-225">V případě selhání úlohy správce úloh některé úlohy mohou stále jsou přidané do služby předtím, než se stala chyba.</span><span class="sxs-lookup"><span data-stu-id="d6c50-225">In the case of job manager task failure, some tasks may still have been added to the service before the error occurred.</span></span> <span data-ttu-id="d6c50-226">Tyto úlohy se spustí normálně.</span><span class="sxs-lookup"><span data-stu-id="d6c50-226">These tasks will run as normal.</span></span> <span data-ttu-id="d6c50-227">Najdete v části "Selhání úlohy rozdělovače" nad diskuzi o tuto cestu kódu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-227">See "Job Splitter Failure" above for discussion of this code path.</span></span>

<span data-ttu-id="d6c50-228">Všechny informace vrácené výjimky jsou zapsána do stdout.txt a stderr.txt soubory.</span><span class="sxs-lookup"><span data-stu-id="d6c50-228">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="d6c50-229">Další informace najdete v tématu [zpracování chyb](batch-api-basics.md#error-handling).</span><span class="sxs-lookup"><span data-stu-id="d6c50-229">For more information, see [Error Handling](batch-api-basics.md#error-handling).</span></span>

### <a name="client-considerations"></a><span data-ttu-id="d6c50-230">Důležité informace o klientech</span><span class="sxs-lookup"><span data-stu-id="d6c50-230">Client considerations</span></span>
<span data-ttu-id="d6c50-231">Tato část popisuje některé požadavky na implementaci klienta při vyvolání Správce úloh, na základě této šablony.</span><span class="sxs-lookup"><span data-stu-id="d6c50-231">This section describes some client implementation requirements when invoking a job manager based on this template.</span></span> <span data-ttu-id="d6c50-232">V tématu [jak předat parametry a proměnné prostředí z klientského kódu](#pass-environment-settings) podrobnosti o předání parametry a nastavení prostředí.</span><span class="sxs-lookup"><span data-stu-id="d6c50-232">See [How to pass parameters and environment variables from the client code](#pass-environment-settings) for details on passing parameters and environment settings.</span></span>

<span data-ttu-id="d6c50-233">**Povinné přihlašovací údaje**</span><span class="sxs-lookup"><span data-stu-id="d6c50-233">**Mandatory credentials**</span></span>

<span data-ttu-id="d6c50-234">Chcete-li přidání úkolů do úlohy Azure Batch, úkolu Správce úloh vyžaduje adresa URL účtu Azure Batch a klíč.</span><span class="sxs-lookup"><span data-stu-id="d6c50-234">In order to add tasks to the Azure Batch job, the job manager task requires your Azure Batch account URL and key.</span></span> <span data-ttu-id="d6c50-235">Je nutné předat v proměnné prostředí s názvem YOUR_BATCH_URL a YOUR_BATCH_KEY.</span><span class="sxs-lookup"><span data-stu-id="d6c50-235">You must pass these in environment variables named YOUR_BATCH_URL and YOUR_BATCH_KEY.</span></span> <span data-ttu-id="d6c50-236">Můžete nastavit tyto ve Správci úloh nastavení prostředí úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-236">You can set these in the Job Manager task environment settings.</span></span> <span data-ttu-id="d6c50-237">Například v C# klienta:</span><span class="sxs-lookup"><span data-stu-id="d6c50-237">For example, in a C# client:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    new EnvironmentSetting("YOUR_BATCH_URL", "https://account.region.batch.azure.com"),
    new EnvironmentSetting("YOUR_BATCH_KEY", "{your_base64_encoded_account_key}"),
};
```
<span data-ttu-id="d6c50-238">**Přihlašovací údaje úložiště**</span><span class="sxs-lookup"><span data-stu-id="d6c50-238">**Storage credentials**</span></span>

<span data-ttu-id="d6c50-239">Klient obvykle není nutné poskytnout pověření k účtu propojené úložiště na úkolu Správce úloh, protože není nutné explicitně přístup propojený účet úložiště (a) nejvíce Správci úloh a (b) propojený účet úložiště se často poskytuje na všechny úlohy jako běžné nastavení prostředí pro úlohu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-239">Typically, the client does not need to provide the linked storage account credentials to the job manager task because (a) most job managers do not need to explicitly access the linked storage account and (b) the linked storage account is often provided to all tasks as a common environment setting for the job.</span></span> <span data-ttu-id="d6c50-240">Pokud nejsou poskytuje propojený účet úložiště pomocí běžných nastavení prostředí a Správce úloh vyžaduje přístup k propojené úložiště, pak by měl zadáte přihlašovacích údajů propojené úložiště následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="d6c50-240">If you are not providing the linked storage account via the common environment settings, and the job manager requires access to linked storage, then you should supply the linked storage credentials as follows:</span></span>

```csharp
job.JobManagerTask.EnvironmentSettings = new [] {
    /* other environment settings */
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="d6c50-241">**Nastavení úloh Správce úloh**</span><span class="sxs-lookup"><span data-stu-id="d6c50-241">**Job manager task settings**</span></span>

<span data-ttu-id="d6c50-242">Klient musí nastavit správce úloh *killJobOnCompletion* příznak, který **false**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-242">The client should set the job manager *killJobOnCompletion* flag to **false**.</span></span>

<span data-ttu-id="d6c50-243">Obvykle je bezpečné pro klienta k nastavení *runExclusive* k **false**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-243">It is usually safe for the client to set *runExclusive* to **false**.</span></span>

<span data-ttu-id="d6c50-244">Klient musí použít *resourceFiles* nebo *applicationPackageReferences* kolekce se má úloha manager spustitelného souboru (a její požadované knihovny DLL) nasazené na výpočetním uzlu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-244">The client should use the *resourceFiles* or *applicationPackageReferences* collection to have the job manager executable (and its required DLLs) deployed to the compute node.</span></span>

<span data-ttu-id="d6c50-245">Ve výchozím nastavení nebude Správce úloh zopakován, pokud se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="d6c50-245">By default, the job manager will not be retried if it fails.</span></span> <span data-ttu-id="d6c50-246">V závislosti na logice úlohy správce klienta chtít povolit opakování prostřednictvím *omezení*/*maxTaskRetryCount*.</span><span class="sxs-lookup"><span data-stu-id="d6c50-246">Depending on your job manager logic, the client may want to enable retries via *constraints*/*maxTaskRetryCount*.</span></span>

<span data-ttu-id="d6c50-247">**Nastavení úloh**</span><span class="sxs-lookup"><span data-stu-id="d6c50-247">**Job settings**</span></span>

<span data-ttu-id="d6c50-248">Pokud úloha rozdělovače vysílá úlohy se závislostmi, klient musí nastavit usesTaskDependencies úlohy na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="d6c50-248">If the job splitter emits tasks with dependencies, the client must set the job's usesTaskDependencies to true.</span></span>

<span data-ttu-id="d6c50-249">V modelu rozdělovače úlohy neobvyklé, že klientům chcete přidání úkolů do úlohy nad rámec jaké úlohu rozdělovače vytvoří.</span><span class="sxs-lookup"><span data-stu-id="d6c50-249">In the job splitter model, it is unusual for clients to wish to add tasks to jobs over and above what the job splitter creates.</span></span> <span data-ttu-id="d6c50-250">Klient má proto za normálních okolností nastavit úlohy *onAllTasksComplete* k **terminatejob**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-250">The client should therefore normally set the job's *onAllTasksComplete* to **terminatejob**.</span></span>

## <a name="task-processor-template"></a><span data-ttu-id="d6c50-251">Šablony úloh procesoru</span><span class="sxs-lookup"><span data-stu-id="d6c50-251">Task Processor template</span></span>
<span data-ttu-id="d6c50-252">Šablony úloh procesoru pomáhá při implementaci procesor úloh, které můžete provádět následující akce:</span><span class="sxs-lookup"><span data-stu-id="d6c50-252">A Task Processor template helps you to implement a task processor that can perform the following actions:</span></span>

* <span data-ttu-id="d6c50-253">Nastavte informace vyžadované každý úkol Batch ke spuštění.</span><span class="sxs-lookup"><span data-stu-id="d6c50-253">Set up the information required by each Batch task to run.</span></span>
* <span data-ttu-id="d6c50-254">Spusťte všechny akce, které vyžaduje každý úkol Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-254">Run all actions required by each Batch task.</span></span>
* <span data-ttu-id="d6c50-255">Uložte výstupy úlohy do trvalého úložiště.</span><span class="sxs-lookup"><span data-stu-id="d6c50-255">Save task outputs to persistent storage.</span></span>

<span data-ttu-id="d6c50-256">Procesor úloh není potřeba spouštět úlohy Batch, klíče výhodou použití procesor úloh sice poskytuje obálka pro implementaci všechny akce provádění úkolů na jednom místě.</span><span class="sxs-lookup"><span data-stu-id="d6c50-256">Although a task processor is not required to run tasks on Batch, the key advantage of using a task processor is that it provides a wrapper to implement all task execution actions in one location.</span></span> <span data-ttu-id="d6c50-257">Například pokud potřebujete spustit více aplikacemi v rámci každé úlohy, nebo pokud je nutné zkopírovat data do trvalého úložiště po dokončení každé úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-257">For example, if you need to run several applications in the context of each task, or if you need to copy data to persistent storage after completing each task.</span></span>

<span data-ttu-id="d6c50-258">Akce prováděné procesorem úloha může být jako jednoduché nebo komplexní a jako mnoho nebo jako několika podle požadavků vaší zatížení.</span><span class="sxs-lookup"><span data-stu-id="d6c50-258">The actions performed by the task processor can be as simple or complex, and as many or as few, as required by your workload.</span></span> <span data-ttu-id="d6c50-259">Kromě toho implementací všechny akce úkolů do jednoho procesoru úloh můžete snadno aktualizovat nebo přidávat akce založené na změny požadavků na zatížení nebo aplikace.</span><span class="sxs-lookup"><span data-stu-id="d6c50-259">Additionally, by implementing all task actions into one task processor, you can readily update or add actions based on changes to applications or workload requirements.</span></span> <span data-ttu-id="d6c50-260">Ale v některých případech procesor úloh nemusí být optimální řešení týkající se vaší implementace jako ji můžete přidat nepotřebné složitost, například při spuštění úlohy, které lze rychle spustit z příkazového řádku jednoduché.</span><span class="sxs-lookup"><span data-stu-id="d6c50-260">However, in some cases a task processor might not be the optimal solution for your implementation as it can add unnecessary complexity, for example when running jobs that can be quickly started from a simple command line.</span></span>

### <a name="create-a-task-processor-using-the-template"></a><span data-ttu-id="d6c50-261">Vytvoření úloh procesor pomocí šablony</span><span class="sxs-lookup"><span data-stu-id="d6c50-261">Create a Task Processor using the template</span></span>
<span data-ttu-id="d6c50-262">Chcete-li přidat úloha procesor na řešení, které jste vytvořili dříve, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="d6c50-262">To add a task processor to the solution that you created earlier, follow these steps:</span></span>

1. <span data-ttu-id="d6c50-263">Otevřete existující řešení v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="d6c50-263">Open your existing solution in Visual Studio.</span></span>
2. <span data-ttu-id="d6c50-264">V Průzkumníku řešení klikněte pravým tlačítkem na řešení, klikněte na tlačítko **přidat**a potom klikněte na **nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-264">In Solution Explorer, right-click the solution, click **Add**, and then click **New Project**.</span></span>
3. <span data-ttu-id="d6c50-265">V části **Visual C#**, klikněte na tlačítko **cloudu**a potom klikněte na **Azure Batch úloh procesoru**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-265">Under **Visual C#**, click **Cloud**, and then click **Azure Batch Task Processor**.</span></span>
4. <span data-ttu-id="d6c50-266">Zadejte název, který popisuje vaší aplikace a identifikuje tohoto projektu jako úloha procesoru (např.) "LitwareTaskProcessor").</span><span class="sxs-lookup"><span data-stu-id="d6c50-266">Type a name that describes your application and identifies this project as the task processor (e.g. "LitwareTaskProcessor").</span></span>
5. <span data-ttu-id="d6c50-267">Chcete-li vytvořit projekt, klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="d6c50-267">To create the project, click **OK**.</span></span>
6. <span data-ttu-id="d6c50-268">Nakonec sestavte projekt a vynutit sadě Visual Studio načíst všechny odkazované balíčky NuGet a ověřte, zda je projekt platný před zahájením provádění úprav.</span><span class="sxs-lookup"><span data-stu-id="d6c50-268">Finally, build the project to force Visual Studio to load all referenced NuGet packages and to verify that the project is valid before you start modifying it.</span></span>

### <a name="task-processor-template-files-and-their-purpose"></a><span data-ttu-id="d6c50-269">Soubory šablon procesoru úloh a jejich účel</span><span class="sxs-lookup"><span data-stu-id="d6c50-269">Task Processor template files and their purpose</span></span>
<span data-ttu-id="d6c50-270">Při vytváření projektu pomocí šablony úloh procesoru generuje tři skupiny soubory kódu:</span><span class="sxs-lookup"><span data-stu-id="d6c50-270">When you create a project using the task processor template, it generates three groups of code files:</span></span>

* <span data-ttu-id="d6c50-271">Hlavní programový soubor (Program.cs).</span><span class="sxs-lookup"><span data-stu-id="d6c50-271">The main program file (Program.cs).</span></span> <span data-ttu-id="d6c50-272">Tato položka obsahuje program Vstupní bod a nejvyšší úrovně výjimek.</span><span class="sxs-lookup"><span data-stu-id="d6c50-272">This contains the program entry point and top-level exception handling.</span></span> <span data-ttu-id="d6c50-273">Neměli byste potřebovat obvykle tuto možnost lze upravit.</span><span class="sxs-lookup"><span data-stu-id="d6c50-273">You shouldn't normally need to modify this.</span></span>
* <span data-ttu-id="d6c50-274">Do složky Framework.</span><span class="sxs-lookup"><span data-stu-id="d6c50-274">The Framework directory.</span></span> <span data-ttu-id="d6c50-275">Tato položka obsahuje soubory zodpovědná za práci, často používaný' pomocí programu Správce úloh – rozbalování parametrů, přidávání úkolů do úlohy Batch atd. Neměli byste potřebovat normálně k úpravě těchto souborů.</span><span class="sxs-lookup"><span data-stu-id="d6c50-275">This contains the files responsible for the 'boilerplate' work done by the job manager program – unpacking parameters, adding tasks to the Batch job, etc. You shouldn't normally need to modify these files.</span></span>
* <span data-ttu-id="d6c50-276">Soubor procesoru úloh (TaskProcessor.cs).</span><span class="sxs-lookup"><span data-stu-id="d6c50-276">The task processor file (TaskProcessor.cs).</span></span> <span data-ttu-id="d6c50-277">Toto je, kam jste umístili logika specifické pro aplikaci pro provádění úlohy (obvykle ve volají existující spustitelný soubor).</span><span class="sxs-lookup"><span data-stu-id="d6c50-277">This is where you will put your application-specific logic for executing a task (typically by calling out to an existing executable).</span></span> <span data-ttu-id="d6c50-278">Před a po zpracování kódu, třeba stahování další data nebo nahrávání souborů výsledek také zde bude.</span><span class="sxs-lookup"><span data-stu-id="d6c50-278">Pre- and post-processing code, such as downloading additional data or uploading result files, also goes here.</span></span>

<span data-ttu-id="d6c50-279">Samozřejmě můžete přidat další soubory jako nezbytný pro podporu kódu procesoru úloh, v závislosti na složitosti úlohu, rozdělování logiku.</span><span class="sxs-lookup"><span data-stu-id="d6c50-279">Of course you can add additional files as required to support your task processor code, depending on the complexity of the job splitting logic.</span></span>

<span data-ttu-id="d6c50-280">Šablona generuje také standardní soubory rozhraní .NET projektu, například souboru .csproj, app.config, souboru packages.config, atd.</span><span class="sxs-lookup"><span data-stu-id="d6c50-280">The template also generates standard .NET project files such as a .csproj file, app.config, packages.config, etc.</span></span>

<span data-ttu-id="d6c50-281">Zbývající část tohoto oddílu popisuje různých souborů a jejich struktura kódu a vysvětluje, jaké jsou jednotlivé třídy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-281">The rest of this section describes the different files and their code structure, and explains what each class does.</span></span>

![Visual Studio Průzkumník řešení zobrazující řešení šablony úloh procesoru][solution_explorer02]

<span data-ttu-id="d6c50-283">**Soubory Framework**</span><span class="sxs-lookup"><span data-stu-id="d6c50-283">**Framework files**</span></span>

* <span data-ttu-id="d6c50-284">`Configuration.cs`: Zapouzdří načítání úlohy konfigurační data, jako je například Podrobnosti účtu Batch, přihlašovací údaje účtu propojené úložiště, úlohy a informace o úloze a parametry úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-284">`Configuration.cs`: Encapsulates the loading of job configuration data such as Batch account details, linked storage account credentials, job and task information, and job parameters.</span></span> <span data-ttu-id="d6c50-285">Také poskytuje přístup k proměnné prostředí definované Batch (viz nastavení prostředí pro úkoly v dokumentaci k Batch) prostřednictvím třídy Configuration.EnvironmentVariable.</span><span class="sxs-lookup"><span data-stu-id="d6c50-285">It also provides access to Batch-defined environment variables (see Environment settings for tasks, in the Batch documentation) via the Configuration.EnvironmentVariable class.</span></span>
* <span data-ttu-id="d6c50-286">`IConfiguration.cs`: Abstrahuje implementace třídy konfigurace, aby bylo možné testování částí rozdělovače vaše úlohy pomocí falešných nebo imitované konfiguraci objektu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-286">`IConfiguration.cs`: Abstracts the implementation of the Configuration class, so that you can unit test your job splitter using a fake or mock configuration object.</span></span>
* <span data-ttu-id="d6c50-287">`TaskProcessorException.cs`: Představuje chybu, která vyžaduje Správce úloh ukončit.</span><span class="sxs-lookup"><span data-stu-id="d6c50-287">`TaskProcessorException.cs`: Represents an error that requires the job manager to terminate.</span></span> <span data-ttu-id="d6c50-288">TaskProcessorException slouží k zabalení 'očekávaný: chyby, kde lze zadat konkrétní diagnostické informace jako součást ukončení.</span><span class="sxs-lookup"><span data-stu-id="d6c50-288">TaskProcessorException is used to wrap 'expected' errors where specific diagnostic information can be provided as part of termination.</span></span>

<span data-ttu-id="d6c50-289">**Úloha procesoru**</span><span class="sxs-lookup"><span data-stu-id="d6c50-289">**Task Processor**</span></span>

* <span data-ttu-id="d6c50-290">`TaskProcessor.cs`: Spustí úlohu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-290">`TaskProcessor.cs`: Runs the task.</span></span> <span data-ttu-id="d6c50-291">Rozhraní framework vyvolá metodu TaskProcessor.Run.</span><span class="sxs-lookup"><span data-stu-id="d6c50-291">The framework invokes the TaskProcessor.Run method.</span></span> <span data-ttu-id="d6c50-292">Toto je třída, kde bude vložit specifické pro aplikaci logiky vaše úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-292">This is the class where you will inject the application-specific logic of your task.</span></span> <span data-ttu-id="d6c50-293">Implementujte metodu spustit, abyste:</span><span class="sxs-lookup"><span data-stu-id="d6c50-293">Implement the Run method to:</span></span>
  * <span data-ttu-id="d6c50-294">Analýza a ověření žádné parametry úlohy</span><span class="sxs-lookup"><span data-stu-id="d6c50-294">Parse and validate any task parameters</span></span>
  * <span data-ttu-id="d6c50-295">Napište příkazového řádku pro jakýkoli externí program, který má být vyvolán</span><span class="sxs-lookup"><span data-stu-id="d6c50-295">Compose the command line for any external program you want to invoke</span></span>
  * <span data-ttu-id="d6c50-296">Přihlaste se další diagnostické informace, které můžete potřebovat pro účely ladění</span><span class="sxs-lookup"><span data-stu-id="d6c50-296">Log any diagnostic information you may require for debugging purposes</span></span>
  * <span data-ttu-id="d6c50-297">Spustit proces, který používá tento příkazový řádek</span><span class="sxs-lookup"><span data-stu-id="d6c50-297">Start a process using that command line</span></span>
  * <span data-ttu-id="d6c50-298">Počkejte na ukončení procesu</span><span class="sxs-lookup"><span data-stu-id="d6c50-298">Wait for the process to exit</span></span>
  * <span data-ttu-id="d6c50-299">Zaznamenat kód ukončení procesu k určení, zda je byla úspěšná nebo neúspěšná</span><span class="sxs-lookup"><span data-stu-id="d6c50-299">Capture the exit code of the process to determine if it succeeded or failed</span></span>
  * <span data-ttu-id="d6c50-300">Uložit výstupní soubory, které chcete zachovat do trvalého úložiště</span><span class="sxs-lookup"><span data-stu-id="d6c50-300">Save any output files you want to keep to persistent storage</span></span>

<span data-ttu-id="d6c50-301">**Standardní soubory projektu příkazového řádku .NET**</span><span class="sxs-lookup"><span data-stu-id="d6c50-301">**Standard .NET command line project files**</span></span>

* <span data-ttu-id="d6c50-302">`App.config`: Standardní soubor konfigurace aplikace .NET.</span><span class="sxs-lookup"><span data-stu-id="d6c50-302">`App.config`: Standard .NET application configuration file.</span></span>
* <span data-ttu-id="d6c50-303">`Packages.config`: Standardní soubor závislost balíčku NuGet.</span><span class="sxs-lookup"><span data-stu-id="d6c50-303">`Packages.config`: Standard NuGet package dependency file.</span></span>
* <span data-ttu-id="d6c50-304">`Program.cs`: Obsahuje program Vstupní bod a nejvyšší úrovně výjimek.</span><span class="sxs-lookup"><span data-stu-id="d6c50-304">`Program.cs`: Contains the program entry point and top-level exception handling.</span></span>

## <a name="implementing-the-task-processor"></a><span data-ttu-id="d6c50-305">Implementace úkolů procesoru</span><span class="sxs-lookup"><span data-stu-id="d6c50-305">Implementing the task processor</span></span>
<span data-ttu-id="d6c50-306">Když otevřete projekt šablony úloh procesoru, bude mít projektu TaskProcessor.cs soubor otevřete ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="d6c50-306">When you open the Task Processor template project, the project will have the TaskProcessor.cs file open by default.</span></span> <span data-ttu-id="d6c50-307">Spuštění logiku pro úlohy můžete implementovat v vaše úlohy pomocí metodu Run() vidíte níže:</span><span class="sxs-lookup"><span data-stu-id="d6c50-307">You can implement the run logic for the tasks in your workload by using the Run() method shown below:</span></span>

```csharp
/// <summary>
/// Runs the task processing logic. This is where you inject
/// your application-specific logic for decomposing the job into tasks.
///
/// The task processor framework invokes the Run method for you; you need
/// only to implement it, not to call it yourself. Typically, your
/// implementation will execute an external program (from resource files or
/// an application package), check the exit code of that program and
/// save output files to persistent storage.
/// </summary>
public async Task<int> Run()

{
    try
    {
        //Your code for the task processor goes here.
        var command = $"compare {_parameters["Frame1"]} {_parameters["Frame2"]} compare.gif";
        using (var process = Process.Start($"cmd /c {command}"))
        {
            process.WaitForExit();
            var taskOutputStorage = new TaskOutputStorage(
            _configuration.StorageAccount,
            _configuration.JobId,
            _configuration.TaskId
            );
            await taskOutputStorage.SaveAsync(
            TaskOutputKind.TaskOutput,
            @"..\stdout.txt",
            @"stdout.txt"
            );
            return process.ExitCode;
        }
    }
    catch (Exception ex)
    {
        throw new TaskProcessorException(
        $"{ex.GetType().Name} exception in run task processor: {ex.Message}",
        ex
        );
    }
}
```
> [!NOTE]
> <span data-ttu-id="d6c50-308">Části s poznámkami v metodu Run() je pouze část kód šablony úloh procesoru, který je určena pro vás upravit přidáním spuštění logiku pro úlohy v vaše úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-308">The annotated section in the Run() method is the only section of the Task Processor template code that is intended for you to modify by adding the run logic for the tasks in your workload.</span></span> <span data-ttu-id="d6c50-309">Pokud chcete změnit různé části šablony, prosím nejdřív Seznamte se s fungování Batch přečtení dokumentace Batch a vyzkoušení několik ukázky kódu Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-309">If you want to modify a different section of the template, please first familiarize yourself with how Batch works by reviewing the Batch documentation and trying out a few of the Batch code samples.</span></span>
> 
> 

<span data-ttu-id="d6c50-310">Metodu Run() je zodpovědná za spuštění příkazového řádku, od jednoho nebo více procesů čekání na dokončení, všechny procesu ukládání výsledků a nakonec vrácení s ukončovacím kódem.</span><span class="sxs-lookup"><span data-stu-id="d6c50-310">The Run() method is responsible for launching the command line, starting one or more processes, waiting for all process to complete, saving the results, and finally returning with an exit code.</span></span> <span data-ttu-id="d6c50-311">Metodu Run() je, kde můžete implementovat logiku zpracování pro vaše úkoly.</span><span class="sxs-lookup"><span data-stu-id="d6c50-311">The Run() method is where you implement the processing logic for your tasks.</span></span> <span data-ttu-id="d6c50-312">Rozhraní framework procesoru úloh vyvolá metodu Run() pro vás; není nutné volat sami.</span><span class="sxs-lookup"><span data-stu-id="d6c50-312">The task processor framework invokes the Run() method for you; you do not need to call it yourself.</span></span>

<span data-ttu-id="d6c50-313">Implementace Run() má přístup k:</span><span class="sxs-lookup"><span data-stu-id="d6c50-313">Your Run() implementation has access to:</span></span>

* <span data-ttu-id="d6c50-314">Parametry úlohy prostřednictvím `_parameters` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-314">The task parameters, via the `_parameters` field.</span></span>
* <span data-ttu-id="d6c50-315">ID úlohy a úkolů prostřednictvím `_jobId` a `_taskId` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-315">The job and task ids, via the `_jobId` and `_taskId` fields.</span></span>
* <span data-ttu-id="d6c50-316">Konfigurace úlohy prostřednictvím `_configuration` pole.</span><span class="sxs-lookup"><span data-stu-id="d6c50-316">The task configuration, via the `_configuration` field.</span></span>

<span data-ttu-id="d6c50-317">**Selhání úlohy**</span><span class="sxs-lookup"><span data-stu-id="d6c50-317">**Task failure**</span></span>

<span data-ttu-id="d6c50-318">V případě selhání můžete k ukončení metodu Run() došlo k výjimce, ale zůstane obslužná rutina výjimky nejvyšší úrovně v prvku kód ukončení úkolů.</span><span class="sxs-lookup"><span data-stu-id="d6c50-318">In case of failure, you can exit the Run() method by throwing an exception, but this leaves the top level exception handler in control of the task exit code.</span></span> <span data-ttu-id="d6c50-319">Pokud potřebujete řídit ukončovací kód, aby mohl rozlišit různé typy selhání, například k diagnostickým účelům nebo protože některé selhání režimy musí ukončit úlohu a ostatní neměli, musí ukončit metodu Run() vrácením nenulový ukončovací kód.</span><span class="sxs-lookup"><span data-stu-id="d6c50-319">If you need to control the exit code so that you can distinguish different types of failure, for example for diagnostic purposes or because some failure modes should terminate the job and others should not, then you should exit the Run() method by returning a non-zero exit code.</span></span> <span data-ttu-id="d6c50-320">To se stane kód ukončení úkolů.</span><span class="sxs-lookup"><span data-stu-id="d6c50-320">This becomes the task exit code.</span></span>

### <a name="exit-codes-and-exceptions-in-the-task-processor-template"></a><span data-ttu-id="d6c50-321">Kódy ukončení a výjimky v šabloně úlohy procesoru</span><span class="sxs-lookup"><span data-stu-id="d6c50-321">Exit codes and exceptions in the Task Processor template</span></span>
<span data-ttu-id="d6c50-322">Kódy ukončení a výjimky poskytují mechanismus určit výsledek spuštění programu, a můžou pomoct zjistit případné problémy s spuštění programu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-322">Exit codes and exceptions provide a mechanism to determine the outcome of running a program, and they can help identify any problems with the execution of the program.</span></span> <span data-ttu-id="d6c50-323">Šablony úloh procesoru implementuje ukončovacích kódů a výjimek popsaných v této části.</span><span class="sxs-lookup"><span data-stu-id="d6c50-323">The Task Processor template implements the exit codes and exceptions described in this section.</span></span>

<span data-ttu-id="d6c50-324">Úloha procesoru úloh, která je implementována pomocí šablony úloh procesoru vrátit tři možné ukončovací kód:</span><span class="sxs-lookup"><span data-stu-id="d6c50-324">A task processor task that is implemented with the Task Processor template can return three possible exit codes:</span></span>

| <span data-ttu-id="d6c50-325">Kód</span><span class="sxs-lookup"><span data-stu-id="d6c50-325">Code</span></span> | <span data-ttu-id="d6c50-326">Popis</span><span class="sxs-lookup"><span data-stu-id="d6c50-326">Description</span></span> |
| --- | --- |
| <span data-ttu-id="d6c50-327">[Process.ExitCode][process_exitcode]</span><span class="sxs-lookup"><span data-stu-id="d6c50-327">[Process.ExitCode][process_exitcode]</span></span> |<span data-ttu-id="d6c50-328">Úloha procesor byl dokončen.</span><span class="sxs-lookup"><span data-stu-id="d6c50-328">The task processor ran to completion.</span></span> <span data-ttu-id="d6c50-329">Všimněte si, že tento program můžete vyvolat úspěšného – pouze neznamená, že procesor úkolů úspěšně volat a provést jakékoli po zpracování bez výjimek.</span><span class="sxs-lookup"><span data-stu-id="d6c50-329">Note that this does not imply that the program you invoked was successful – only that the task processor invoked it successfully and performed any post-processing without exceptions.</span></span> <span data-ttu-id="d6c50-330">Význam ukončovací kód závisí na vyvolaný program – obvykle ukončovací kód 0 znamená program úspěšná a jiný kód ukončení znamená program selhal.</span><span class="sxs-lookup"><span data-stu-id="d6c50-330">The meaning of the exit code depends on the invoked program – typically exit code 0 means the program succeeded and any other exit code means the program failed.</span></span> |
| <span data-ttu-id="d6c50-331">1</span><span class="sxs-lookup"><span data-stu-id="d6c50-331">1</span></span> |<span data-ttu-id="d6c50-332">Procesor úlohy se nezdařilo s výjimkou v 'očekávané' součástí programu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-332">The task processor failed with an exception in an 'expected' part of the program.</span></span> <span data-ttu-id="d6c50-333">Výjimka byl přeložen na `TaskProcessorException` s diagnostické informace a, kde je to možné, návrhy na řešení selhání.</span><span class="sxs-lookup"><span data-stu-id="d6c50-333">The exception was translated to a `TaskProcessorException` with diagnostic information and, where possible, suggestions for resolving the failure.</span></span> |
| <span data-ttu-id="d6c50-334">2</span><span class="sxs-lookup"><span data-stu-id="d6c50-334">2</span></span> |<span data-ttu-id="d6c50-335">Procesor úlohy se nezdařilo s 'neočekávané' výjimky.</span><span class="sxs-lookup"><span data-stu-id="d6c50-335">The task processor failed with an 'unexpected' exception.</span></span> <span data-ttu-id="d6c50-336">Protokolu byla zaznamenána výjimka standardním výstupu, ale procesoru úloh se nepodařilo přidat další diagnostiky nebo nápravnou informace.</span><span class="sxs-lookup"><span data-stu-id="d6c50-336">The exception was logged to standard output, but the task processor was unable to add any additional diagnostic or remediation information.</span></span> |

> [!NOTE]
> <span data-ttu-id="d6c50-337">Pokud program, který je vyvolán používá k označení režimy konkrétní chyby ukončovací kód 1 a 2, pak pomocí ukončovací kód 1 a 2 pro procesoru chybám úloh je nejednoznačný.</span><span class="sxs-lookup"><span data-stu-id="d6c50-337">If the program you invoke uses exit codes 1 and 2 to indicate specific failure modes, then using exit codes 1 and 2 for task processor errors is ambiguous.</span></span> <span data-ttu-id="d6c50-338">Kódy chyb procesoru těchto úloh můžete změnit na rozlišovací ukončovací kód úpravou případů výjimka v souboru Program.cs.</span><span class="sxs-lookup"><span data-stu-id="d6c50-338">You can change these task processor error codes to distinctive exit codes by editing the exception cases in the Program.cs file.</span></span>
> 
> 

<span data-ttu-id="d6c50-339">Všechny informace vrácené výjimky jsou zapsána do stdout.txt a stderr.txt soubory.</span><span class="sxs-lookup"><span data-stu-id="d6c50-339">All the information returned by exceptions is written into stdout.txt and stderr.txt files.</span></span> <span data-ttu-id="d6c50-340">Další informace najdete v tématu zpracování chyb v dokumentaci k Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-340">For more information, see Error Handling, in the Batch documentation.</span></span>

### <a name="client-considerations"></a><span data-ttu-id="d6c50-341">Důležité informace o klientech</span><span class="sxs-lookup"><span data-stu-id="d6c50-341">Client considerations</span></span>
<span data-ttu-id="d6c50-342">**Přihlašovací údaje úložiště**</span><span class="sxs-lookup"><span data-stu-id="d6c50-342">**Storage credentials**</span></span>

<span data-ttu-id="d6c50-343">Pokud procesor úloh používá úložiště objektů blob v Azure k uchování výstupů, například pomocí souboru konvence pomocné knihovny, pak potřebuje přístup k *buď* údaje k účtu úložiště cloudu *nebo* adresu URL kontejneru objektů blob, která zahrnuje sdílený přístupový podpis (SAS).</span><span class="sxs-lookup"><span data-stu-id="d6c50-343">If your task processor uses Azure blob storage to persist outputs, for example using the file conventions helper library, then it needs access to *either* the cloud storage account credentials *or* a blob container URL that includes a shared access signature (SAS).</span></span> <span data-ttu-id="d6c50-344">Šablona zahrnuje podporu poskytování pověření prostřednictvím společné proměnné prostředí.</span><span class="sxs-lookup"><span data-stu-id="d6c50-344">The template includes support for providing credentials via common environment variables.</span></span> <span data-ttu-id="d6c50-345">Váš klient může předat přihlašovacích údajů úložiště následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="d6c50-345">Your client can pass the storage credentials as follows:</span></span>

```csharp
job.CommonEnvironmentSettings = new [] {
    new EnvironmentSetting("LINKED_STORAGE_ACCOUNT", "{storageAccountName}"),
    new EnvironmentSetting("LINKED_STORAGE_KEY", "{storageAccountKey}"),
};
```

<span data-ttu-id="d6c50-346">Účet úložiště se pak dostupná ve třídě TaskProcessor prostřednictvím `_configuration.StorageAccount` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="d6c50-346">The storage account is then available in the TaskProcessor class via the `_configuration.StorageAccount` property.</span></span>

<span data-ttu-id="d6c50-347">Pokud byste radši chtěli použít adresu URL kontejneru s tokenem SAS, můžete to taky předat prostřednictvím nastavení prostředí běžné úlohy, ale procesor šablony úloh aktuálně nezahrnuje integrovanou podporu pro tento.</span><span class="sxs-lookup"><span data-stu-id="d6c50-347">If you prefer to use a container URL with SAS, you can also pass this via an job common environment setting, but the task processor template does not currently include built-in support for this.</span></span>

<span data-ttu-id="d6c50-348">**Instalační program úložiště**</span><span class="sxs-lookup"><span data-stu-id="d6c50-348">**Storage setup**</span></span>

<span data-ttu-id="d6c50-349">Doporučuje se, že Správce úloh klienta nebo úloha vytvořit žádné kontejnery požadované úlohami před přidání úkolů do úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-349">It is recommended that the client or job manager task create any containers required by tasks before adding the tasks to the job.</span></span> <span data-ttu-id="d6c50-350">Toto je povinné, že pokud použijete adresu URL kontejneru s tokenem SAS, jako například adresu URL nezahrnuje oprávnění k vytvoření kontejneru.</span><span class="sxs-lookup"><span data-stu-id="d6c50-350">This is mandatory if you use a container URL with SAS, as such a URL does not include permission to create the container.</span></span> <span data-ttu-id="d6c50-351">I v případě, že předáváte přihlašovacích údajů účtu úložiště, doporučujeme jako ukládá každý úkol, museli volání CloudBlobContainer.CreateIfNotExistsAsync na kontejneru.</span><span class="sxs-lookup"><span data-stu-id="d6c50-351">It is recommended even if you pass storage account credentials, as it saves every task having to call CloudBlobContainer.CreateIfNotExistsAsync on the container.</span></span>

## <a name="pass-parameters-and-environment-variables"></a><span data-ttu-id="d6c50-352">Předávání parametrů a proměnných prostředí</span><span class="sxs-lookup"><span data-stu-id="d6c50-352">Pass parameters and environment variables</span></span>
### <a name="pass-environment-settings"></a><span data-ttu-id="d6c50-353">Předat nastavení prostředí</span><span class="sxs-lookup"><span data-stu-id="d6c50-353">Pass environment settings</span></span>
<span data-ttu-id="d6c50-354">Informace o úkolu Správce úloh ve formě nastavení prostředí můžete předat klienta.</span><span class="sxs-lookup"><span data-stu-id="d6c50-354">A client can pass information to the job manager task in the form of environment settings.</span></span> <span data-ttu-id="d6c50-355">Tyto informace pak může být použit úkol správce při generování úlohy procesoru úloh, které se spustí jako součást výpočetní úlohy.</span><span class="sxs-lookup"><span data-stu-id="d6c50-355">This information can then be used by the job manager task when generating the task processor tasks that will run as part of the compute job.</span></span> <span data-ttu-id="d6c50-356">Příklady informace, které můžete předat jako nastavení prostředí:</span><span class="sxs-lookup"><span data-stu-id="d6c50-356">Examples of the information that you can pass as environment settings are:</span></span>

* <span data-ttu-id="d6c50-357">Klíče pro účet a název účtu úložiště</span><span class="sxs-lookup"><span data-stu-id="d6c50-357">Storage account name and account keys</span></span>
* <span data-ttu-id="d6c50-358">Adresa URL účtu batch</span><span class="sxs-lookup"><span data-stu-id="d6c50-358">Batch account URL</span></span>
* <span data-ttu-id="d6c50-359">Klíč účtu batch</span><span class="sxs-lookup"><span data-stu-id="d6c50-359">Batch account key</span></span>

<span data-ttu-id="d6c50-360">Služba Batch je jednoduchý mechanismus pro nastavení prostředí předat úkolu Správce úloh pomocí `EnvironmentSettings` vlastnost [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span><span class="sxs-lookup"><span data-stu-id="d6c50-360">The Batch service has a simple mechanism to pass environment settings to a job manager task by using the `EnvironmentSettings` property in [Microsoft.Azure.Batch.JobManagerTask][net_jobmanagertask].</span></span>

<span data-ttu-id="d6c50-361">Chcete-li například získat `BatchClient` instance pro účet Batch můžete předat jako proměnné prostředí z klienta code adresu URL a pověření sdíleného klíče pro účet Batch.</span><span class="sxs-lookup"><span data-stu-id="d6c50-361">For example, to get the `BatchClient` instance for a Batch account, you can pass as environment variables from the client code the URL and shared key credentials for the Batch account.</span></span> <span data-ttu-id="d6c50-362">Stejně tak přístup k účtu úložiště, který je spojen s účtem Batch, můžete předat název účtu úložiště a klíč účtu úložiště jako proměnné prostředí.</span><span class="sxs-lookup"><span data-stu-id="d6c50-362">Likewise, to access the storage account that is linked to the Batch account, you can pass the storage account name and the storage account key as environment variables.</span></span>

### <a name="pass-parameters-to-the-job-manager-template"></a><span data-ttu-id="d6c50-363">Předat parametry do šablony Správce úloh</span><span class="sxs-lookup"><span data-stu-id="d6c50-363">Pass parameters to the Job Manager template</span></span>
<span data-ttu-id="d6c50-364">V mnoha případech je vhodné předat parametry na úlohu úkolu Správce úloh, řídit úlohu, rozdělování procesu nebo konfigurovat úlohy pro úlohu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-364">In many cases, it's useful to pass per-job parameters to the job manager task, either to control the job splitting process or to configure the tasks for the job.</span></span> <span data-ttu-id="d6c50-365">To provedete tím, že nahrajete soubor JSON s názvem parameters.JSON tímto kódem jako soubor prostředků pro spuštění úkolu Správce úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-365">You can do this by uploading a JSON file named parameters.json as a resource file for the job manager task.</span></span> <span data-ttu-id="d6c50-366">Parametry se pak můžou stát k dispozici v `JobSplitter._parameters` pole v šabloně Správce úloh.</span><span class="sxs-lookup"><span data-stu-id="d6c50-366">The parameters can then become available in the `JobSplitter._parameters` field in the Job Manager template.</span></span>

> [!NOTE]
> <span data-ttu-id="d6c50-367">Předdefinované parametr obslužná rutina podporuje pouze slovník řetězec řetězec.</span><span class="sxs-lookup"><span data-stu-id="d6c50-367">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="d6c50-368">Pokud chcete předat komplexní JSON hodnoty jako hodnoty parametrů, budete muset předat jako řetězce a analyzovat je ve rozdělovače úlohy nebo upravit rozhraní framework `Configuration.GetJobParameters` metoda.</span><span class="sxs-lookup"><span data-stu-id="d6c50-368">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the job splitter, or modify the framework's `Configuration.GetJobParameters` method.</span></span>
> 
> 

### <a name="pass-parameters-to-the-task-processor-template"></a><span data-ttu-id="d6c50-369">Předat parametry do šablony úloh procesoru</span><span class="sxs-lookup"><span data-stu-id="d6c50-369">Pass parameters to the Task Processor template</span></span>
<span data-ttu-id="d6c50-370">Můžete také předat parametry jednotlivé úlohy implementovaná pomocí šablony úloh procesoru.</span><span class="sxs-lookup"><span data-stu-id="d6c50-370">You can also pass parameters to individual tasks implemented using the Task Processor template.</span></span> <span data-ttu-id="d6c50-371">Stejně jako pomocí šablony Správce úloh, procesor šablony úloh hledá soubor prostředků s názvem</span><span class="sxs-lookup"><span data-stu-id="d6c50-371">Just as with the job manager template, the task processor template looks for a resource file named</span></span>

<span data-ttu-id="d6c50-372">Parameters.JSON tímto kódem a pokud zjistila, že ho načte jako slovník parametrů.</span><span class="sxs-lookup"><span data-stu-id="d6c50-372">parameters.json, and if found it loads it as the parameters dictionary.</span></span> <span data-ttu-id="d6c50-373">Existuje několik možností pro jak předat parametry úlohy procesoru úloh:</span><span class="sxs-lookup"><span data-stu-id="d6c50-373">There are a couple of options for how to pass parameters to the task processor tasks:</span></span>

* <span data-ttu-id="d6c50-374">Znovu použít parametry úlohy JSON.</span><span class="sxs-lookup"><span data-stu-id="d6c50-374">Reuse the job parameters JSON.</span></span> <span data-ttu-id="d6c50-375">To funguje dobře v případě, že pouze parametry jsou ty úlohy celou (pro příklad, vykreslení výška a šířka).</span><span class="sxs-lookup"><span data-stu-id="d6c50-375">This works well if the only parameters are job-wide ones (for example, a render height and width).</span></span> <span data-ttu-id="d6c50-376">K tomuto účelu, při vytváření CloudTask v rozdělovače úlohy Přidat odkaz na objekt souboru parameters.JSON tímto kódem prostředku z úkolu Správce úloh ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) do kolekce ResourceFiles CloudTask.</span><span class="sxs-lookup"><span data-stu-id="d6c50-376">To do this, when creating a CloudTask in the job splitter, add a reference to the parameters.json resource file object from the job manager task's ResourceFiles (`JobSplitter._jobManagerTask.ResourceFiles`) to the CloudTask's ResourceFiles collection.</span></span>
* <span data-ttu-id="d6c50-377">Generování a nahrávání dokumentu Parameters.JSON tímto kódem specifických úkolů při provádění úlohy rozdělovače a odkazovat na tento objekt blob v kolekci souborů prostředků úkolu.</span><span class="sxs-lookup"><span data-stu-id="d6c50-377">Generate and upload a task-specific parameters.json document as part of job splitter execution, and reference that blob in the task's resource files collection.</span></span> <span data-ttu-id="d6c50-378">To je nezbytné, pokud jiné úlohy s odlišnými parametry.</span><span class="sxs-lookup"><span data-stu-id="d6c50-378">This is necessary if different tasks have different parameters.</span></span> <span data-ttu-id="d6c50-379">Příkladem může být 3D vykreslování scénář, kde je index rámečku předaný úlohu jako parametr.</span><span class="sxs-lookup"><span data-stu-id="d6c50-379">An example might be a 3D rendering scenario where the frame index is passed to the task as a parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="d6c50-380">Předdefinované parametr obslužná rutina podporuje pouze slovník řetězec řetězec.</span><span class="sxs-lookup"><span data-stu-id="d6c50-380">The built-in parameter handler supports only string-to-string dictionaries.</span></span> <span data-ttu-id="d6c50-381">Pokud chcete předat komplexní JSON hodnoty jako hodnoty parametrů, budete muset předat jako řetězce a analyzovat je procesor úlohy nebo upravit rozhraní framework `Configuration.GetTaskParameters` metoda.</span><span class="sxs-lookup"><span data-stu-id="d6c50-381">If you want to pass complex JSON values as parameter values, you will need to pass these as strings and parse them in the task processor, or modify the framework's `Configuration.GetTaskParameters` method.</span></span>
> 
> 

## <a name="next-steps"></a><span data-ttu-id="d6c50-382">Další kroky</span><span class="sxs-lookup"><span data-stu-id="d6c50-382">Next steps</span></span>
### <a name="persist-job-and-task-output-to-azure-storage"></a><span data-ttu-id="d6c50-383">Zachovat výstup úlohy a úkolů do úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="d6c50-383">Persist job and task output to Azure Storage</span></span>
<span data-ttu-id="d6c50-384">Další užitečné nástroje při vývoji řešení Batch je [Azure Batch souboru konvence][nuget_package].</span><span class="sxs-lookup"><span data-stu-id="d6c50-384">Another helpful tool in Batch solution development is [Azure Batch File Conventions][nuget_package].</span></span> <span data-ttu-id="d6c50-385">Tato knihovna tříd rozhraní .NET (momentálně ve verzi preview) v aplikacích Batch .NET pomocí snadno ukládání a načítání úloh výstupy do a z Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="d6c50-385">Use this .NET class library (currently in preview) in your Batch .NET applications to easily store and retrieve task outputs to and from Azure Storage.</span></span> <span data-ttu-id="d6c50-386">[Zachovat výstup úlohy a úlohy Azure Batch](batch-task-output.md) obsahuje úplnou diskusi o knihovně a jeho použití.</span><span class="sxs-lookup"><span data-stu-id="d6c50-386">[Persist Azure Batch job and task output](batch-task-output.md) contains a full discussion of the library and its usage.</span></span>

### <a name="batch-forum"></a><span data-ttu-id="d6c50-387">Fórum batch</span><span class="sxs-lookup"><span data-stu-id="d6c50-387">Batch Forum</span></span>
<span data-ttu-id="d6c50-388">[Fóru služby Azure Batch] [ forum] na webu MSDN je skvělým místem popisují Batch a klást otázky týkající se služby.</span><span class="sxs-lookup"><span data-stu-id="d6c50-388">The [Azure Batch Forum][forum] on MSDN is a great place to discuss Batch and ask questions about the service.</span></span> <span data-ttu-id="d6c50-389">HEAD na přes pro užitečné "rychlé" příspěvky a při jejich vzniku při sestavování řešení Batch zveřejněte svoje otázky.</span><span class="sxs-lookup"><span data-stu-id="d6c50-389">Head on over for helpful "sticky" posts, and post your questions as they arise while you build your Batch solutions.</span></span>

[forum]: https://social.msdn.microsoft.com/forums/azure/en-US/home?forum=azurebatch
[net_jobmanagertask]: https://msdn.microsoft.com/library/azure/microsoft.azure.batch.jobmanagertask.aspx
[github_samples]: https://github.com/Azure/azure-batch-samples
[nuget_package]: https://www.nuget.org/packages/Microsoft.Azure.Batch.Conventions.Files
[process_exitcode]: https://msdn.microsoft.com/library/system.diagnostics.process.exitcode.aspx
[vs_gallery]: https://visualstudiogallery.msdn.microsoft.com/
[vs_gallery_templates]: https://go.microsoft.com/fwlink/?linkid=820714
[vs_find_use_ext]: https://msdn.microsoft.com/library/dd293638.aspx

[diagram01]: ./media/batch-visual-studio-templates/diagram01.png
[solution_explorer01]: ./media/batch-visual-studio-templates/solution_explorer01.png
[solution_explorer02]: ./media/batch-visual-studio-templates/solution_explorer02.png

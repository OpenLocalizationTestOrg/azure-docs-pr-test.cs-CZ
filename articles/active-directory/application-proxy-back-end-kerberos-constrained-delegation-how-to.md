---
title: "aaaHow tooconfigure toouse aplikace Proxy aplikace omezené delegování Kerberos | Microsoft Docs"
description: "Jak tooconfigure omezené delegování Kerberos pro aplikaci Azure AD Application Proxy."
services: active-directory
documentationcenter: 
author: ajamess
manager: femila
ms.assetid: 
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/11/2017
ms.author: asteen
ms.openlocfilehash: 93dac264ff1d3b99dead1d9c759c37c59373cbd4
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="how-tooconfigure-an-application-proxy-application-toouse-kerberos-constrained-delegation"></a><span data-ttu-id="0a737-103">Jak tooconfigure toouse aplikace Proxy aplikace omezené delegování Kerberos</span><span class="sxs-lookup"><span data-stu-id="0a737-103">How tooconfigure an Application Proxy application toouse Kerberos Constrained Delegation</span></span>

<span data-ttu-id="0a737-104">Hello dostupné metody pro dosažení toopublished jednotné přihlašování, které aplikace můžou poněkud lišit od tooapplication aplikace a jednu z možností hello, Proxy aplikace služby Azure nabízí vpravo předinstalované hello, je pomocí protokolu Kerberos vynuceným delegování použitím (KCD).</span><span class="sxs-lookup"><span data-stu-id="0a737-104">hello methods available for achieving SSO toopublished applications can somewhat vary from application tooapplication and one of hello options that Azure Application Proxy offers right out of hello box, is Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="0a737-105">Toto je, kde hostitel konektor je nakonfigurované tooperform omezené kerberos ověření toobackend aplikacemi, jménem uživatelů.</span><span class="sxs-lookup"><span data-stu-id="0a737-105">This is where a connector host is configured tooperform constrained kerberos authentication toobackend applications, on behalf of users.</span></span>

<span data-ttu-id="0a737-106">Hello skutečné postup pro povolení použitím KCD je relativně jednoduché a obvykle vyžaduje více než obecné znalosti o hello různými součástmi a tok ověřování, která usnadňuje jednotné přihlašování.</span><span class="sxs-lookup"><span data-stu-id="0a737-106">hello actual procedure for enabling KCD is relatively straightforward and typically requires no more than a general understanding of hello various components and authentication flow that facilitates SSO.</span></span> <span data-ttu-id="0a737-107">Hledání, že poskytují toohelp informace o řešení potíží s scénáře, kde použitím KCD SSO nebude fungovat podle očekávání, může být Zhuštěno.</span><span class="sxs-lookup"><span data-stu-id="0a737-107">Finding good sources of information toohelp troubleshoot scenarios where KCD SSO doesn’t function as expected, can be sparse.</span></span>

<span data-ttu-id="0a737-108">Tento článek jako takový pokusí tooprovide jediný bod odkaz, který by měly pomoci při řešení potíží a samoobslužné napravit některé nalezené hello nejběžnějších problémů, které vidíte.</span><span class="sxs-lookup"><span data-stu-id="0a737-108">As such, this article attempts tooprovide a single point of reference that should help troubleshoot and self-remediate some of hello most common issues that we see.</span></span> <span data-ttu-id="0a737-109">Na hello stejný čas nabídka Další pokyny pro diagnostiku hello složitější a problémových implementace.</span><span class="sxs-lookup"><span data-stu-id="0a737-109">At hello same time offer additional guidance for diagnosing hello more complex and troubled of implementation.</span></span>

<span data-ttu-id="0a737-110">Všimněte si, že v tomto článku umožňuje hello následující předpoklady:</span><span class="sxs-lookup"><span data-stu-id="0a737-110">note that this article makes hello following assumptions:</span></span>

-   <span data-ttu-id="0a737-111">Proxy aplikace služby Azure nasazený dle naše [dokumentace](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) a obecné přístup toonon použitím KCD aplikace funguje podle očekávání.</span><span class="sxs-lookup"><span data-stu-id="0a737-111">Azure Application Proxy has been deployed as per our [documentation](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-enable) and general access toonon KCD applications is working as expected.</span></span>

-   <span data-ttu-id="0a737-112">Hello publikované cílová aplikace je založena na službě IIS a společnosti Microsoft implementace protokolu kerberos.</span><span class="sxs-lookup"><span data-stu-id="0a737-112">hello published target application is based on IIS and Microsoft’s implementation of kerberos.</span></span>

-   <span data-ttu-id="0a737-113">hostitelé serveru a aplikace Hello nacházet v jedné doméně služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="0a737-113">hello server and application hosts reside in a single Active Directory domain.</span></span> <span data-ttu-id="0a737-114">Podrobné informace o pro různé scénáře domény a doménové struktury naleznete v našem [dokument White Paper použitím KCD](http://aka.ms/KCDPaper).</span><span class="sxs-lookup"><span data-stu-id="0a737-114">Detailed information on cross domain and forest scenarios can be found in our [KCD whitepaper](http://aka.ms/KCDPaper).</span></span>

-   <span data-ttu-id="0a737-115">Hello subjektu aplikace je publikována v Azure klienta povoleno předběžné ověřování, uživatelé se očekává, že a ověřování na základě tooauthenticate tooAzure prostřednictvím formulářů.</span><span class="sxs-lookup"><span data-stu-id="0a737-115">hello subject application is published in an Azure tenant with pre-authentication enabled, and users are expected tooauthenticate tooAzure via forms based authentication.</span></span> <span data-ttu-id="0a737-116">Scénáře ověřování klienta bohaté nejsou uvedené v tomto článku, ale je možné přidat v určitém okamžiku v budoucnu hello.</span><span class="sxs-lookup"><span data-stu-id="0a737-116">Rich client authentication scenarios are not covered by this article, but be added at some point in hello future.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="0a737-117">Požadavky</span><span class="sxs-lookup"><span data-stu-id="0a737-117">Prerequisites</span></span>

<span data-ttu-id="0a737-118">Proxy aplikace služby Azure se dá nasadit na prakticky libovolný typ infrastruktury nebo prostředí a hello architektury už nepochybně lišit tooorganization organizace.</span><span class="sxs-lookup"><span data-stu-id="0a737-118">Azure Application Proxy can be deployed into pretty much any type of infrastructure or environment and hello architectures no doubt vary from organization tooorganization.</span></span> <span data-ttu-id="0a737-119">Mezi nejběžnější příčiny hello použitím KCD související s problémy s nejsou hello prostředí, sami, ale spíše jednoduché chybná konfigurace nebo obecné dohledu.</span><span class="sxs-lookup"><span data-stu-id="0a737-119">One of hello most common causes of KCD related issues are not hello environments themselves, but rather simple mis-configurations, or general oversight.</span></span>

<span data-ttu-id="0a737-120">Z tohoto důvodu naše Rady, jak je vždy toostart tím, že zajistí jste splnili všechny hello předpoklady nastíněny v našem hlavní [pomocí použitím KCD jednotné přihlašování, článek Proxy aplikace hello](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) před spuštěním řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="0a737-120">For this reason, our advice is always toostart by making sure you have met all hello pre-requisites laid out in our main [Using KCD SSO with hello Application Proxy article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd) before starting troubleshooting.</span></span>

<span data-ttu-id="0a737-121">Zejména hello části na konfiguraci použitím KCD na 2012R2, aktivuje se podstatně liší přístup tooconfiguring použitím KCD v dřívějších verzích systému Windows, ale také při se s vědomím několik další důležité informace:</span><span class="sxs-lookup"><span data-stu-id="0a737-121">Particularly hello section on configuring KCD on 2012R2, as this employs a fundamentally different approach tooconfiguring KCD on previous versions of Windows, but also while being mindful of several other considerations:</span></span>

-   <span data-ttu-id="0a737-122">Je běžné pro tooopen serveru člena domény zabezpečený kanál dialogové okno s konkrétním řadičem domény.</span><span class="sxs-lookup"><span data-stu-id="0a737-122">It is not uncommon for a domain member server tooopen a secure channel dialog with a specific domain controller.</span></span> <span data-ttu-id="0a737-123">Pak přesuňte tooanother dialogové okno v každém okamžiku, takže konektor hostitele obecně by nemělo být schopný toocommunicate s omezeným přístupem toobeing se pouze na určité místní lokality řadiče domény.</span><span class="sxs-lookup"><span data-stu-id="0a737-123">Then move tooanother dialog at any given time, so connector hosts should generally not be restricted toobeing able toocommunicate with only specific local site DCs.</span></span>

-   <span data-ttu-id="0a737-124">Podobně jako toohello výše bodu scénáře napříč doménami spoléhají na referenční seznamy, které budou řídit tooDCs hostitele konektoru, která se mohou nacházet mimo hraniční hello místní sítě.</span><span class="sxs-lookup"><span data-stu-id="0a737-124">Similar toohello above point, cross domain scenarios rely on referrals that direct a connector host tooDCs that may reside outside of hello local network perimeter.</span></span> <span data-ttu-id="0a737-125">V tomto scénáři, který je stejně důležité toomake se, že jste se také umožňuje provoz a vyšší tooDCs, které představují další příslušných domén, nebo s jiným delegování nezdaří.</span><span class="sxs-lookup"><span data-stu-id="0a737-125">In this scenario it is equally important toomake sure you are also allowing traffic onwards tooDCs that represent other respective domains, or else delegation fail.</span></span>

-   <span data-ttu-id="0a737-126">Kde je to možné, vyhněte se umístění všech aktivních zařízení IP adresy nebo ID mezi hostiteli v konektoru a řadiče domény, jako jsou někdy přes nežádoucí a narušovat přenos pomocí protokolu RPC jádra</span><span class="sxs-lookup"><span data-stu-id="0a737-126">Where possible, you should avoid placing any active IPS/IDS devices between connector hosts and DCs, as these are sometimes over intrusive and interfere with core RPC traffic</span></span>

<span data-ttu-id="0a737-127">Tolik, kolik rádi bychom znali tooresolve problémy rychle a efektivně, může trvat dobu, kde je to možné které by měl zkuste a otestovat delegování v hello nejjednodušší scénářů.</span><span class="sxs-lookup"><span data-stu-id="0a737-127">As much as we’d like tooresolve issues quickly and effectively, it can take time, so where possible you should try and test delegation in hello simplest of scenarios.</span></span> <span data-ttu-id="0a737-128">Dobrý den další proměnné, které můžete zavést, hello více můžete mít toocontend s.</span><span class="sxs-lookup"><span data-stu-id="0a737-128">hello more variables you introduce, hello more you may have toocontend with.</span></span> <span data-ttu-id="0a737-129">Například omezení testování jeden konektor tooa můžete uložit drahocenný čas a možné přidat další konektory hello problémy byl vyřešen.</span><span class="sxs-lookup"><span data-stu-id="0a737-129">For example, limiting your testing tooa single connector can save valuable time, and additional connectors can be added after hello issues has been resolved.</span></span>

<span data-ttu-id="0a737-130">Některé faktorech prostředí může taky způsobovat tooan problém, takže znovu Pokud možné zkuste a minimalizovat úplné minimální tooa hello architektura pro testování.</span><span class="sxs-lookup"><span data-stu-id="0a737-130">Some environmental factors may also be contributing tooan issue, so again if possible try and minimize hello architecture tooa bare minimum for testing.</span></span> <span data-ttu-id="0a737-131">Například, nejsou nesprávně nakonfigurované interní brány firewall seznamy ACL, takže pokud je to možné mít veškerý provoz z konektoru přímo přes toohello řadičů domény a back-end aplikace povolená.</span><span class="sxs-lookup"><span data-stu-id="0a737-131">For example, misconfigured internal firewall ACLs are not uncommon, so if possible have all traffic from a connector allowed straight through toohello DCs and backend application.</span></span> 

<span data-ttu-id="0a737-132">Ve skutečnosti hello absolutní nejlepší místo tooposition konektory je co tootheir cíle jako může být.</span><span class="sxs-lookup"><span data-stu-id="0a737-132">Actually hello absolute best place tooposition connectors is as close tootheir targets as can be.</span></span> <span data-ttu-id="0a737-133">S vložené den brány firewall a přitom se jednoduše testování přidá nepotřebné složitost a může prodloužit jenom vaše šetření.</span><span class="sxs-lookup"><span data-stu-id="0a737-133">Having a firewall sat inline whilst testing simply adds unnecessary complexity, and could just prolong your investigations.</span></span>

<span data-ttu-id="0a737-134">Ano co se považuje za problém použitím KCD přesto?</span><span class="sxs-lookup"><span data-stu-id="0a737-134">So, what constitutes a KCD problem anyway?</span></span> <span data-ttu-id="0a737-135">Dobře existuje několik classic indikace selhání a hello první známky problém obvykle projevují v přihlašování použitím KCD hello prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="0a737-135">Well, there several classic indications of KCD SSO failing and hello first signs of an issue usually manifest themselves in hello browser.</span></span>

   ![Chyba konfigurace nesprávný použitím KCD](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic1.png)

   ![Ověřování se nezdařilo z důvodu toomissing oprávnění](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic2.png)

<span data-ttu-id="0a737-138">všechny, které opatřeny hello stejné příznakem selhání tooperform jednotné přihlašování a v důsledku odepření hello aplikace toohello přístup uživatelů.</span><span class="sxs-lookup"><span data-stu-id="0a737-138">all which bear hello same symptom of failing tooperform SSO, and consequently denying hello user access toohello application.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="0a737-139">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="0a737-139">Troubleshooting</span></span>

<span data-ttu-id="0a737-140">Jak pak řešení závisí na hello problém a zjištěnými příznaků.</span><span class="sxs-lookup"><span data-stu-id="0a737-140">How you then troubleshoot depend on hello issue and observed symptoms.</span></span> <span data-ttu-id="0a737-141">Před přechodem všechny další by doporučujeme hello následující odkazy, jak budou obsahovat užitečné informace, které jste ještě nemusí mít pocházet napříč:</span><span class="sxs-lookup"><span data-stu-id="0a737-141">Before going any further we would suggest hello following links, as they contain useful information you may not yet have come across:</span></span>

-   [<span data-ttu-id="0a737-142">Řešení potíží s Proxy aplikace problémy a chybové zprávy</span><span class="sxs-lookup"><span data-stu-id="0a737-142">Troubleshoot Application Proxy problems and error messages</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot)

-   [<span data-ttu-id="0a737-143">Chyby protokolu Kerberos a symptomy</span><span class="sxs-lookup"><span data-stu-id="0a737-143">Kerberos errors and symptoms</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-troubleshoot#kerberos-errors)

-   [<span data-ttu-id="0a737-144">Práce s SSO při místní a cloudové identity nejsou identické</span><span class="sxs-lookup"><span data-stu-id="0a737-144">Working with SSO when on-premises and cloud identities are not identical</span></span>](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd#working-with-sso-when-on-premises-and-cloud-identities-are-not-identical)

<span data-ttu-id="0a737-145">Pokud máte k dispozici to daleko, pak hello hlavní problém výborný existuje.</span><span class="sxs-lookup"><span data-stu-id="0a737-145">If you’ve got this far, then hello main issue definitely exists.</span></span> <span data-ttu-id="0a737-146">Je třeba toodig hlubší, takže začněte tím, že oddělíte hello toku do tří různých fází, které lze řešit potíže s.</span><span class="sxs-lookup"><span data-stu-id="0a737-146">You need toodig deeper, so start by separating hello flow into three distinct stages that you can troubleshoot.</span></span>

<span data-ttu-id="0a737-147">**Předběžné ověření klienta** -hello externího uživatele ověřování tooAzure prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="0a737-147">**Client pre-authentication** - hello external user authenticating tooAzure via a browser.</span></span>

<span data-ttu-id="0a737-148">Je možné toopre-ověření je nutné pro jednotné přihlašování použitím KCD toofunction tooAzure.</span><span class="sxs-lookup"><span data-stu-id="0a737-148">Being able toopre-authenticate tooAzure is imperative for KCD SSO toofunction.</span></span> <span data-ttu-id="0a737-149">To by měla otestovat a řešit nejdříve, pokud jsou nějaké problémy.</span><span class="sxs-lookup"><span data-stu-id="0a737-149">This should be tested and addressed first, if there are any issues.</span></span> <span data-ttu-id="0a737-150">Všimněte si, že předběžné ověřování fáze hello nejsou žádná vztah tooKCD nebo hello publikované aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a737-150">Note that hello pre-authentication stage has no relation tooKCD or hello published application.</span></span> <span data-ttu-id="0a737-151">Měla by být poměrně snadno toocorrect případné nesrovnalosti podle správností kontrola hello subjektu účet existuje v Azure a že není zakázána nebo blokované.</span><span class="sxs-lookup"><span data-stu-id="0a737-151">It should be fairly easy toocorrect any discrepancies by sanity checking hello subject account exists in Azure, and that it is not disabled/blocked.</span></span> <span data-ttu-id="0a737-152">odpovědi na chybu Hello v prohlížeči hello je obvykle popisný dostatečně toounderstand hello příčina.</span><span class="sxs-lookup"><span data-stu-id="0a737-152">hello error response in hello browser is usually descriptive enough toounderstand hello cause.</span></span> <span data-ttu-id="0a737-153">Pokud si nejste jisti, můžete také zkontrolovat našich dalších tooverify dokumentace Poradce při potížích.</span><span class="sxs-lookup"><span data-stu-id="0a737-153">You can also check our other Troubleshoot docs tooverify if you aren’t sure.</span></span>

<span data-ttu-id="0a737-154">**Delegování služby** -hello konektor Azure Proxy získání lístků služby protokolu kerberos z KDC (Kerberos Distribution Center) jménem uživatele.</span><span class="sxs-lookup"><span data-stu-id="0a737-154">**Delegation service** - hello Azure Proxy connector obtaining a kerberos service ticket from a KDC (Kerberos Distribution Center), on behalf of users.</span></span>

<span data-ttu-id="0a737-155">Hello externí komunikace mezi klientem hello a hello Azure front-endu by měl mít žádný vliv na použitím KCD jakkoli, jiné než zajistit, že funguje.</span><span class="sxs-lookup"><span data-stu-id="0a737-155">hello external communications between hello client and hello Azure front end should have no bearing on KCD whatsoever, other than ensuring that it works.</span></span> <span data-ttu-id="0a737-156">Toto je tak hello služba Azure Proxy může být zadaný s platné ID uživatele, který být použité tooobtain lístek protokolu kerberos.</span><span class="sxs-lookup"><span data-stu-id="0a737-156">This is so hello Azure Proxy service can be provided with a valid user ID that be used tooobtain a kerberos ticket.</span></span> <span data-ttu-id="0a737-157">Bez této použitím KCD není možné a dojde k selhání.</span><span class="sxs-lookup"><span data-stu-id="0a737-157">Without this KCD is not possible and would fail.</span></span>

<span data-ttu-id="0a737-158">Jak je uvedeno nahoře, hello prohlížeče chybové zprávy obvykle nabízejí některé funkční různá vodítka na Proč se nedaří věcí.</span><span class="sxs-lookup"><span data-stu-id="0a737-158">As mentioned previously, hello browser error messages usually provide some good clues on why things are failing.</span></span> <span data-ttu-id="0a737-159">Zkontrolujte že toonote hello ID aktivity a časové razítko v odpovědi hello jako to umožní toocorrelate hello chování tooactual události v protokolu událostí hello Azure Proxy.</span><span class="sxs-lookup"><span data-stu-id="0a737-159">Make sure toonote down hello activity ID and timestamp in hello response as this allow you toocorrelate hello behavior tooactual events in hello Azure Proxy event log.</span></span>

   ![Chyba konfigurace nesprávný použitím KCD](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic3.png)

<span data-ttu-id="0a737-161">A protokolu událostí zaznamenané hello odpovídající položky hello by se zobrazit jako události 13019 nebo 12027.</span><span class="sxs-lookup"><span data-stu-id="0a737-161">And hello corresponding entries seen hello event log would be seen as events 13019 or 12027.</span></span> <span data-ttu-id="0a737-162">Můžete najít hello konektor protokoly událostí v **protokoly aplikací a služeb** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Konektor**&gt;**správce**.</span><span class="sxs-lookup"><span data-stu-id="0a737-162">You can find hello connector event logs in **Applications and Services Logs** &gt; **Microsoft** &gt; **AadApplicationProxy** &gt; **Connector**&gt;**Admin**.</span></span>

   ![Událost 13019 z protokolu událostí aplikace Proxy](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic4.png)

   ![12027 události z protokolu událostí aplikace Proxy](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic5.png)

-   <span data-ttu-id="0a737-165">Pro aplikace hello adresa a není záznam CName použít záznam v interní DNS</span><span class="sxs-lookup"><span data-stu-id="0a737-165">Use an A record in your internal DNS for hello application’s address, and not a CName</span></span>

-   <span data-ttu-id="0a737-166">Znovu zkontrolujte, které hostují konektor hello byla udělena hello práva toodelegate toohello určený název SPN pro cílový účet a že **používající libovolný protokol pro ověřování** je vybrána.</span><span class="sxs-lookup"><span data-stu-id="0a737-166">Re-confirm that hello connector host has been granted hello rights toodelegate toohello designated target account’s SPN, and that **Use any authentication protocol** is selected.</span></span> <span data-ttu-id="0a737-167">To je popsaná v našem hlavní [článku Konfigurace jednotného přihlašování](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span><span class="sxs-lookup"><span data-stu-id="0a737-167">This is covered in our main [SSO configuration article](https://docs.microsoft.com/azure/active-directory/active-directory-application-proxy-sso-using-kcd)</span></span>

-   <span data-ttu-id="0a737-168">Ověřte, že je po vydání pouze jednu instanci hello SPN v existence ve službě AD **setspn - x** z příkazový řádek na všechny domény členského hostitele</span><span class="sxs-lookup"><span data-stu-id="0a737-168">Verify that there is only a single instance of hello SPN in existence in AD by issuing a **setspn -x** from a cmd prompt on any domain member host</span></span>

-   <span data-ttu-id="0a737-169">Zkontrolujte toosee, pokud je zásada domény vynucené toolimit hello [maximální velikost protokolu kerberos vydaných tokenů](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), protože tento konektor hello zabránit získat token, pokud nalezen toobe nadměrné</span><span class="sxs-lookup"><span data-stu-id="0a737-169">Check toosee if a domain policy is being enforced toolimit hello [max size of issued kerberos tokens](https://blogs.technet.microsoft.com/askds/2012/09/12/maxtokensize-and-windows-8-and-windows-server-2012/), as this prevent hello connector from obtaining a token if found toobe excessive</span></span>

<span data-ttu-id="0a737-170">Trasování sítě zaznamenávání hello výměnách mezi hello konektor hostitele a domény služby KDC by pak hello další nejlepší krok při získávání více nízkou úroveň podrobností na hello problémy.</span><span class="sxs-lookup"><span data-stu-id="0a737-170">A network trace capturing hello exchanges between hello connector host and a domain KDC would then be hello next best step in obtaining more low level detail on hello issues.</span></span> <span data-ttu-id="0a737-171">Můžete najít v [podrobné informace Poradce při potížích dokumentu](https://aka.ms/proxytshootpaper).</span><span class="sxs-lookup"><span data-stu-id="0a737-171">You can find this in [deep dive Troubleshoot paper](https://aka.ms/proxytshootpaper).</span></span>

<span data-ttu-id="0a737-172">Pokud lístků spokojeni, měli byste vidět událost v protokolech hello s informacemi o tom, ověření se nezdařilo z důvodu toohello aplikace vrací 401.</span><span class="sxs-lookup"><span data-stu-id="0a737-172">If ticketing looks good, you should see an event in hello logs stating that authentication failed due toohello application returning a 401.</span></span> <span data-ttu-id="0a737-173">To běžně značí, že cílová aplikace hello odmítat lístku, takže pokračujte hello následující další fáze.</span><span class="sxs-lookup"><span data-stu-id="0a737-173">This typically indicates that hello target application rejecting your ticket, so proceed with hello following next stage.</span></span>

<span data-ttu-id="0a737-174">**Cílová aplikace** -hello příjemce lístek protokolu kerberos hello poskytované hello konektoru</span><span class="sxs-lookup"><span data-stu-id="0a737-174">**Target application** - hello consumer of hello kerberos ticket provided by hello connector</span></span>

<span data-ttu-id="0a737-175">Tento konektor hello fáze je očekávané toohave odesílány protokolu kerberos služby lístku toohello back-end, jako hlavičku v rámci hello první žádostí na aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a737-175">At this stage hello connector is expected toohave sent a kerberos service ticket toohello backend, as a header within hello first application request.</span></span>

-   <span data-ttu-id="0a737-176">Pomocí aplikace hello interní adresa URL definované v hello portál, ověřte, že aplikace hello dostupné přímo z prohlížeče hello na hostiteli konektor hello.</span><span class="sxs-lookup"><span data-stu-id="0a737-176">Using hello application’s internal URL defined in hello portal, validate that hello application is accessible directly from hello browser on hello connector host.</span></span> <span data-ttu-id="0a737-177">Potom může přihlásit úspěšně.</span><span class="sxs-lookup"><span data-stu-id="0a737-177">Then you can login successfully.</span></span> <span data-ttu-id="0a737-178">Podrobnosti o to naleznete na stránce Poradce při potížích konektor hello.</span><span class="sxs-lookup"><span data-stu-id="0a737-178">Details on doing this can be found on hello connector Troubleshoot page.</span></span>

-   <span data-ttu-id="0a737-179">Stále v hostiteli konektor hello, potvrďte, že hello ověřování mezi hello prohlížeče a aplikace hello je pomocí protokolu kerberos, jedním z následujících hello:</span><span class="sxs-lookup"><span data-stu-id="0a737-179">Still on hello connector host, confirm that hello authentication between hello browser and hello application is using kerberos, by doing one of hello following:</span></span>

1.  <span data-ttu-id="0a737-180">Spuštění nástrojů pro vývojáře (**F12**) v Internet Exploreru, nebo použijte [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) z hostitele konektor hello.</span><span class="sxs-lookup"><span data-stu-id="0a737-180">Run Dev tools(**F12**) in Internet Explorer, or use [Fiddler](https://blogs.msdn.microsoft.com/crminthefield/2012/10/10/using-fiddler-to-check-for-kerberos-auth/) from hello connector host.</span></span> <span data-ttu-id="0a737-181">Přejděte toohello aplikace pomocí hello interní adresa URL a zkontrolujte hello nabízí hlavičky WWW ověření vrácený v odpovědi hello z aplikace hello, tooensure, která buď vyjednávání nebo protokolu kerberos je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="0a737-181">Go toohello application using hello internal URL, and inspect hello offered WWW authorization headers returned in hello response from hello application, tooensure that either negotiate or kerberos is present.</span></span> <span data-ttu-id="0a737-182">Vrátí objekt blob následné protokolu kerberos se v reakci hello z prohlížeče toohello hello aplikace obvykle začínáte s **JÍ**, takže toto je dobrá indikace toho Kerberos se v play.</span><span class="sxs-lookup"><span data-stu-id="0a737-182">A subsequent kerberos blob returned in hello response from hello browser toohello application typically start with **YII**, so this is a good indication of kerberos being in play.</span></span> <span data-ttu-id="0a737-183">NTLM na hello druhé straně vždy začínat **TlRMTVNTUAAB**, který čte NTLMSSP při dekódovat z formátu Base64.</span><span class="sxs-lookup"><span data-stu-id="0a737-183">NTLM on hello other hand always start with **TlRMTVNTUAAB**, which reads NTLMSSP when decoded from Base64.</span></span> <span data-ttu-id="0a737-184">Pokud se zobrazí **TlRMTVNTUAAB** při spuštění hello objektu hello blob, to znamená, že se protokol Kerberos **není** k dispozici.</span><span class="sxs-lookup"><span data-stu-id="0a737-184">If you see **TlRMTVNTUAAB** at hello start of hello blob, this means that Kerberos is **not** available.</span></span> <span data-ttu-id="0a737-185">Pokud to nevidíte, pomocí protokolu Kerberos je pravděpodobně k dispozici.</span><span class="sxs-lookup"><span data-stu-id="0a737-185">If you don’t see this, Kerberos is likely available.</span></span>

  * <span data-ttu-id="0a737-186">Všimněte si, pokud používáte aplikaci Fiddler, tato metoda by vyžadovaly dočasně zakázat rozšířené ochrany na aplikace hello konfigurace ve službě IIS.</span><span class="sxs-lookup"><span data-stu-id="0a737-186">Note, if using Fiddler, this method would require temporarily disabling extended protection on hello application’s config in IIS.</span></span>

     ![Okno kontroly sítě prohlížeče](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic6.png)

    <span data-ttu-id="0a737-188">*Obrázek:* vzhledem k tomu, že to nezačíná TIRMTVNTUAAB, jedná se o příklad Kerberos je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="0a737-188">*Figure:* Since this does not start with TIRMTVNTUAAB, this is an example that Kerberos is available.</span></span> <span data-ttu-id="0a737-189">Jedná se o příklad objektu Blob protokolu Kerberos, který nezačíná JÍ.</span><span class="sxs-lookup"><span data-stu-id="0a737-189">This is an example of a Kerberos Blob that doesn’t start with YII.</span></span>

2.  <span data-ttu-id="0a737-190">NTLM dočasně odebrání seznam zprostředkovatelů hello na webu a přístup aplikace IIS přímo z prohlížeče IE na hostiteli konektor.</span><span class="sxs-lookup"><span data-stu-id="0a737-190">Temporarily remove NTLM from hello providers list on IIS site and access app directly from IE on connector host.</span></span> <span data-ttu-id="0a737-191">Pomocí protokolu NTLM již v seznamu zprostředkovatelů hello musí být schopný tooaccess aplikace hello pouze pomocí protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="0a737-191">With NTLM no longer in hello providers list, you should be able tooaccess hello application using Kerberos only.</span></span> <span data-ttu-id="0a737-192">Pokud tato možnost selže, pak navrhující, že došlo k potížím s konfigurací aplikace hello a ověřování protokolu Kerberos nefunguje.</span><span class="sxs-lookup"><span data-stu-id="0a737-192">If this fails, then that suggests that there is a problem with hello application’s configuration and Kerberos authentication is not functioning.</span></span>

<span data-ttu-id="0a737-193">Protokolu Kerberos není k dispozici, aplikace hello kontroly ověřování, které vyjednávání nastavení v IIS toomake, že je uvedena nejhornější prostřednictvím NTLM pod ní.</span><span class="sxs-lookup"><span data-stu-id="0a737-193">If Kerberos is not available, then check hello application’s authentication settings in IIS toomake sure negotiate is listed topmost, with NTLM just beneath it.</span></span> <span data-ttu-id="0a737-194">(Není Negotiate: ověřování protokolu kerberos nebo Negotiate: protokolu PKU2U).</span><span class="sxs-lookup"><span data-stu-id="0a737-194">(Not Negotiate:kerberos or Negotiate:PKU2U).</span></span> <span data-ttu-id="0a737-195">Pokračujte pouze v případě protokolu Kerberos je funkční.</span><span class="sxs-lookup"><span data-stu-id="0a737-195">Only continue if Kerberos is functional.</span></span>

   ![Zprostředkovatelé ověřování systému Windows](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic7.png)
   
-   <span data-ttu-id="0a737-197">Pomocí protokolu Kerberos a NTLM na místě umožňuje nyní dočasně zakázat předběžné ověřování pro aplikaci hello hello portálu.</span><span class="sxs-lookup"><span data-stu-id="0a737-197">With Kerberos and NTLM in place, lets now temporarily disable pre-authentication for hello application in hello portal.</span></span> <span data-ttu-id="0a737-198">V tématu, pokud je dostupný na hello Internetu pomocí hello externí adresu URL.</span><span class="sxs-lookup"><span data-stu-id="0a737-198">See if you can access it from hello internet using hello external URL.</span></span> <span data-ttu-id="0a737-199">By měl být výzvami tooauthenticate a musí být schopný toodo, tak s hello účet hello používá v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="0a737-199">You should be prompted tooauthenticate and should be able toodo so with hello same account used in hello previous step.</span></span> <span data-ttu-id="0a737-200">Pokud ne, to znamená problém s back-end aplikace hello a není použitím KCD vůbec.</span><span class="sxs-lookup"><span data-stu-id="0a737-200">If not, this indicates a problem with hello backend application and not KCD at all.</span></span>

-   <span data-ttu-id="0a737-201">Nyní znovu povolte předběžné ověření hello portálu a ověřit prostřednictvím Azure tak, že pokus tooconnect toohello aplikace prostřednictvím externí URL.</span><span class="sxs-lookup"><span data-stu-id="0a737-201">Now re-enable pre-authentication in hello portal and authenticate through Azure by attempting tooconnect toohello application via it’s external URL.</span></span> <span data-ttu-id="0a737-202">Pokud se nezdařila jednotné přihlašování, měla zobrazit zpráva zakázané chyby v prohlížeči hello plus událost 13022 v protokolu hello:</span><span class="sxs-lookup"><span data-stu-id="0a737-202">If SSO has failed, then you should see a forbidden error message in hello browser, plus event 13022 in hello log:</span></span>

    <span data-ttu-id="0a737-203">*Microsoft AAD Application Proxy Connector se nemůže ověřit uživatele hello, protože hello back-end server odpoví tooKerberos pokusy o přihlášení s chybou HTTP 401.*</span><span class="sxs-lookup"><span data-stu-id="0a737-203">*Microsoft AAD Application Proxy Connector cannot authenticate hello user because hello backend server responds tooKerberos authentication attempts with an HTTP 401 error.*</span></span>

    ![Je zakázané chyba 401 HTTTP](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic8.png)

-   <span data-ttu-id="0a737-205">Zkontrolujte hello IIS aplikace tooensure hello nakonfigurovaný fond aplikací je nakonfigurovaná toouse hello stejný účet, který hello SPN nakonfiguroval proti ve službě AD: navigace ve službě IIS, jak je uvedeno dále</span><span class="sxs-lookup"><span data-stu-id="0a737-205">Check hello IIS application tooensure hello configured application pool is configured toouse hello same account that hello SPN has been configured against in AD, by navigating in IIS as illustrated below</span></span>

    ![Okno Konfigurace aplikace IIS](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic9.png)

    <span data-ttu-id="0a737-207">Znáte hello identity vydejte následující hello z se, že tento účet jednoznačně nastavena hello SPN dotyčném vyzvat toomake cmd.</span><span class="sxs-lookup"><span data-stu-id="0a737-207">Once you know hello identity, issue hello following from a cmd prompt toomake sure this account is definitely configured with hello SPN in question.</span></span> <span data-ttu-id="0a737-208">Například **setspn – q http/spn.wacketywack.com**</span><span class="sxs-lookup"><span data-stu-id="0a737-208">For example,  **setspn – q http/spn.wacketywack.com**</span></span>

    ![SetSPN příkazové okno](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic10.png)

-   <span data-ttu-id="0a737-210">Zkontrolujte, že hello SPN definované vzhledem aplikace hello nastavení portálu hello je hello stejný hlavní název služby, který je nakonfigurovaný s hello cílový AD účet používá fond aplikací dané aplikace hello</span><span class="sxs-lookup"><span data-stu-id="0a737-210">Check that hello SPN defined against hello application’s settings in hello portal is hello same SPN that is configured against hello target AD account in use by hello application’s app pool</span></span>

   ![Hlavní název služby konfigurací na portálu Azure](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic11.png)
   
-   <span data-ttu-id="0a737-212">Přejděte do služby IIS a vyberte hello **Editor konfigurací** možnost hello aplikace a přejděte příliš**system.webServer/security/authentication/windowsAuthentication** toomake se, že **UseAppPoolCredentials** nastavena tootrue</span><span class="sxs-lookup"><span data-stu-id="0a737-212">Go into IIS and select hello **Configuration Editor** option for hello application, and navigate too**system.webServer/security/authentication/windowsAuthentication** toomake sure that **UseAppPoolCredentials** is set tootrue</span></span>

   ![Fondy aplikací IIS konfigurace přihlašovacích údajů – možnost](./media/application-proxy-back-end-kerberos-constrained-delegation-how-to/graphic12.png)

<span data-ttu-id="0a737-214">Aniž by byly užitečné v zlepšení výkonu hello operací protokolu Kerberos, a režimu jádra povolena také způsobí, že hello lístku hello požadovaná služba toobe dešifrovat pomocí účtu počítače.</span><span class="sxs-lookup"><span data-stu-id="0a737-214">While being useful in improving hello performance of Kerberos operations, leaving Kernel mode enabled also causes hello ticket for hello requested service toobe decrypted using machine account.</span></span> <span data-ttu-id="0a737-215">To se označuje taky jako místní systém hello, takže nutnosti přerušení tootrue tuto sadu použitím KCD, když je aplikace hello hostované na více serverech ve farmě.</span><span class="sxs-lookup"><span data-stu-id="0a737-215">This is also called hello Local system, so having this set tootrue break KCD when hello application is hosted across multiple servers in a farm.</span></span>

-   <span data-ttu-id="0a737-216">Jako další kontrolu, můžete také toodisable hello **rozšířené** ochrany příliš.</span><span class="sxs-lookup"><span data-stu-id="0a737-216">As an additional check, you may also want toodisable hello **Extended** protection too.</span></span> <span data-ttu-id="0a737-217">Byly došlo k scénáře, kde to se ukázalo jako toobreak použitím KCD při povolené ve velmi specifickém konfigurace, kde je aplikace publikována jako dílčí složku hello výchozí webové stránky.</span><span class="sxs-lookup"><span data-stu-id="0a737-217">There have been encountered scenarios where this has proved toobreak KCD when enabled in very specific configurations, where an application is published as a sub folder of hello Default Web site.</span></span> <span data-ttu-id="0a737-218">Tato samotné je nakonfigurován pro pouze anonymní ověřování ponechat hello celý dialogová okna šedá, které naznačují, že podřízené objekty nebude dědí všechny aktivní nastavení.</span><span class="sxs-lookup"><span data-stu-id="0a737-218">This itself is configured for Anonymous authentication only, leaving hello entire dialogs greyed out suggesting child objects would not be inheriting any active settings.</span></span> <span data-ttu-id="0a737-219">Ale kde to možné, bude vždy doporučujeme mít tuto funkci povolíte, proto by nestálo otestovat, ale nezapomeňte toorestore tento tooenabled.</span><span class="sxs-lookup"><span data-stu-id="0a737-219">But where possible we would always recommend having this enabled, so by all means test, but don’t forget toorestore this tooenabled.</span></span>

<span data-ttu-id="0a737-220">Tyto další kontroly by měl mít umístí můžete sledovat toostart pomocí k publikované aplikaci.</span><span class="sxs-lookup"><span data-stu-id="0a737-220">These additional checks should have put you on track toostart using your published application.</span></span> <span data-ttu-id="0a737-221">Můžete přejít k tématu a typu číselník až další konektory, které jsou také nakonfigurována toodelegate, ale pokud žádné další věci pak by doporučujeme číst z našich podrobnější návod technické [hello kompletní Příručka pro řešení potíží s Azure AD Application Proxy server](https://aka.ms/proxytshootpaper)</span><span class="sxs-lookup"><span data-stu-id="0a737-221">You can go ahead and spin up additional connectors that are also configured toodelegate, but if things are no further then we would suggest a read of our more in-depth technical walkthrough [hello complete guide for Troubleshoot Azure AD Application Proxy](https://aka.ms/proxytshootpaper)</span></span>

<span data-ttu-id="0a737-222">Pokud jste stále nelze tooprogress problém, podporu by být vyšší než radostí tooassist a pokračovat z tohoto umístění.</span><span class="sxs-lookup"><span data-stu-id="0a737-222">If you’re still unable tooprogress your issue, support would be more than happy tooassist and continue from here.</span></span> <span data-ttu-id="0a737-223">Vytvořit lístek podpory přímo v rámci portálu hello a naše technici bude oslovení tooyou.</span><span class="sxs-lookup"><span data-stu-id="0a737-223">Create a support ticket directly within hello portal and our engineers will reach out tooyou.</span></span>

## <a name="other-scenarios"></a><span data-ttu-id="0a737-224">Další scénáře</span><span class="sxs-lookup"><span data-stu-id="0a737-224">Other scenarios</span></span>

-   <span data-ttu-id="0a737-225">Proxy aplikace služby Azure vyžádá lístek protokolu Kerberos před odesláním jeho žádost tooan aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a737-225">Azure Application Proxy requests a Kerberos ticket before sending its request tooan application.</span></span> <span data-ttu-id="0a737-226">Některé 3. stran aplikace například Tableau Server nelíbí tuto metodu ověřování a místo očekává více konvenční hello místní tootake jednání,.</span><span class="sxs-lookup"><span data-stu-id="0a737-226">Some 3rd party applications such as Tableau Server do not like this method of authenticating, and rather expects hello more conventional negotiations tootake place,.</span></span> <span data-ttu-id="0a737-227">první požadavek Hello je anonymní, což toorespond aplikace hello s hello typy ověřování, které podporuje prostřednictvím 401.</span><span class="sxs-lookup"><span data-stu-id="0a737-227">hello first request is anonymous, allowing hello application toorespond with hello authentication types that it supports through a 401.</span></span>

-   <span data-ttu-id="0a737-228">Double směrování ověřování – běžně používá ve scénářích, kde vrstvené aplikace s back-end a před koncem, oba vyžadují ověřování, jako je služba SQL Reporting Services.</span><span class="sxs-lookup"><span data-stu-id="0a737-228">Double hop authentication - Commonly used in scenarios where an application is tiered, with a backend and front end, both requiring authentication, such as SQL Reporting Services.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a737-229">Další kroky</span><span class="sxs-lookup"><span data-stu-id="0a737-229">Next steps</span></span>
[<span data-ttu-id="0a737-230">Nakonfigurujte omezené delegování protokolu kerberos (použitím KCD) na spravované doméně</span><span class="sxs-lookup"><span data-stu-id="0a737-230">Configure kerberos constrained delegation (KCD) on a managed domain</span></span>](https://docs.microsoft.com/azure/active-directory-domain-services/active-directory-ds-enable-kcd)

---
title: "aaaDeveloper pokyny pro Azure Active Directory podmíněného přístupu | Microsoft Docs"
description: "Scénáře pro podmíněný přístup k Azure AD a Průvodce pro vývojáře"
services: active-directory
keywords: 
author: danieldobalian
manager: mbaldwin
editor: PatAltimore
ms.author: dadobali
ms.date: 07/19/2017
ms.assetid: 115bdab2-e1fd-4403-ac15-d4195e24ac95
ms.service: active-directory
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: identity
ms.openlocfilehash: 589393f5d084d64872b372d895dc889f300592bf
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="developer-guidance-for-azure-active-directory-conditional-access"></a><span data-ttu-id="74966-103">Průvodce pro vývojáře pro podmíněný přístup k Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="74966-103">Developer Guidance for Azure Active Directory Conditional Access</span></span>

<span data-ttu-id="74966-104">Azure Active Directory (AD) nabízí několik způsobů toosecure vaší aplikace a chránit službu.</span><span class="sxs-lookup"><span data-stu-id="74966-104">Azure Active Directory (AD) offers several ways toosecure your app and protect a service.</span></span>  <span data-ttu-id="74966-105">Jedním z těchto jedinečné funkce je podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-105">One of these unique features is conditional access.</span></span>  <span data-ttu-id="74966-106">Podmíněný přístup umožňuje vývojářům a podnikové zákazníky tooprotect služby v mnoho způsobů, včetně:</span><span class="sxs-lookup"><span data-stu-id="74966-106">Conditional access enables developers and enterprise customers tooprotect services in a multitude of ways including:</span></span>

* <span data-ttu-id="74966-107">Ověřování pomocí služby Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="74966-107">Multi-factor authentication</span></span>
* <span data-ttu-id="74966-108">Povolení jenom Intune zaregistrovaná zařízení tooaccess specifických služeb</span><span class="sxs-lookup"><span data-stu-id="74966-108">Allowing only Intune enrolled devices tooaccess specific services</span></span>
* <span data-ttu-id="74966-109">Omezení umístění uživatele a IP rozsahy</span><span class="sxs-lookup"><span data-stu-id="74966-109">Restricting user locations and IP ranges</span></span>

<span data-ttu-id="74966-110">Další informace o všech možnostech hello podmíněného přístupu najdete v tématu [podmíněného přístupu v hello portál Azure classic](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="74966-110">For more information on hello full capabilities of conditional access, see [Conditional access in hello Azure classic portal](../active-directory-conditional-access.md).</span></span> 

<span data-ttu-id="74966-111">V tomto článku se zaměříme na jaké podmíněného přístupu znamená toodevelopers vytváření aplikací pro Azure AD.</span><span class="sxs-lookup"><span data-stu-id="74966-111">In this article, we focus on what conditional access means toodevelopers building apps for Azure AD.</span></span>  <span data-ttu-id="74966-112">Předpokládá znalost [jeden](active-directory-integrating-applications.md) a [víceklientské](active-directory-devhowto-multi-tenant-overview.md) aplikace a [běžných vzorů ověřování](active-directory-authentication-scenarios.md).</span><span class="sxs-lookup"><span data-stu-id="74966-112">It assumes knowledge of [single](active-directory-integrating-applications.md) and [multi-tenant](active-directory-devhowto-multi-tenant-overview.md) apps and [common authentication patterns](active-directory-authentication-scenarios.md).</span></span>

<span data-ttu-id="74966-113">Jsme vám podrobně hello dopad přístup k prostředkům, které máte řízení přes, které mohou mít zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-113">We'll dive into hello impact of accessing resources you don't have control over that may have conditional access policies applied.</span></span>  <span data-ttu-id="74966-114">Kromě toho jsme hello dopad podmíněného přístupu v hello tok on-behalf-of, webové aplikace, prozkoumejte přístup hello Microsoft Graph a volání rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="74966-114">Moreover, we explore hello implications of conditional access in hello on-behalf-of flow, web apps, accessing hello Microsoft Graph, and calling APIs.</span></span>

## <a name="how-does-conditional-access-impact-an-app"></a><span data-ttu-id="74966-115">Jak podmíněný přístup ovlivňuje aplikace?</span><span class="sxs-lookup"><span data-stu-id="74966-115">How does conditional access impact an app?</span></span>

### <a name="app-topologies-impacted"></a><span data-ttu-id="74966-116">Topologie aplikace dopad</span><span class="sxs-lookup"><span data-stu-id="74966-116">App topologies impacted</span></span>

<span data-ttu-id="74966-117">Podmíněný přístup v nejběžnější případy, nezmění chování aplikace nebo vyžaduje změny z hello developer.</span><span class="sxs-lookup"><span data-stu-id="74966-117">In most common cases, conditional access does not change an app's behavior or requires any changes from hello developer.</span></span>  <span data-ttu-id="74966-118">Pouze v určitých případech při aplikaci nepřímo nebo tiché požadavky token pro služby, aplikace vyžaduje kód změní toohandle podmíněný přístup "ověření".</span><span class="sxs-lookup"><span data-stu-id="74966-118">Only in certain cases when an app indirectly or silently requests a token for a service, an app requires code changes toohandle conditional access "challenges".</span></span>  <span data-ttu-id="74966-119">To může být stejně jednoduché jako provádění požadavek interaktivní přihlašování.</span><span class="sxs-lookup"><span data-stu-id="74966-119">It may be as simple as performing an interactive sign-in request.</span></span> 

<span data-ttu-id="74966-120">Konkrétně hello následující scénáře vyžadují kód toohandle podmíněného přístupu "výzvy":</span><span class="sxs-lookup"><span data-stu-id="74966-120">Specifically, hello following scenarios require code toohandle conditional access "challenges":</span></span> 

* <span data-ttu-id="74966-121">Přístup hello Microsoft Graph aplikací</span><span class="sxs-lookup"><span data-stu-id="74966-121">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="74966-122">Provádění hello tok on-behalf-of aplikace</span><span class="sxs-lookup"><span data-stu-id="74966-122">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="74966-123">Přístup k více služby nebo prostředky aplikace</span><span class="sxs-lookup"><span data-stu-id="74966-123">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="74966-124">Jednostránkové aplikace pomocí ADAL.js</span><span class="sxs-lookup"><span data-stu-id="74966-124">Single page apps using ADAL.js</span></span>

<span data-ttu-id="74966-125">Zásady podmíněného přístupu může být použité toohello aplikace, ale také může být použité tooa webového rozhraní API aplikace přistupuje.</span><span class="sxs-lookup"><span data-stu-id="74966-125">Conditional access policies can be applied toohello app, but also can be applied tooa web API your app accesses.</span></span> <span data-ttu-id="74966-126">toolearn Další informace o tom, jak tooconfigure zásady podmíněného přístupu, najdete v tématu [Začínáme s Azure Active Directory podmíněného přístupu](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span><span class="sxs-lookup"><span data-stu-id="74966-126">toolearn more about how tooconfigure a conditional access policy, please see [Getting started with Azure Active Directory Conditional Access](../active-directory-conditional-access-azuread-connected-apps.md#configure-per-application-access-rules).</span></span>

<span data-ttu-id="74966-127">V závislosti na scénáři hello můžete použít podnikových zákazníků a kdykoli odebrat zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-127">Depending on hello scenario, an enterprise customer can apply and remove conditional access policies at any time.</span></span>  <span data-ttu-id="74966-128">Aby vaše aplikace toocontinue funguje při použití nové zásady je nutné zpracování výzvy"tooimplement hello".</span><span class="sxs-lookup"><span data-stu-id="74966-128">In order for your app toocontinue functioning when a new policy is applied, you need tooimplement hello "challenge" handling.</span></span> <span data-ttu-id="74966-129">Hello následující příklady znázorňují výzvy zpracování.</span><span class="sxs-lookup"><span data-stu-id="74966-129">hello following examples illustrate challenge handling.</span></span> 

### <a name="conditional-access-examples"></a><span data-ttu-id="74966-130">Příklady podmíněného přístupu</span><span class="sxs-lookup"><span data-stu-id="74966-130">Conditional access examples</span></span>

<span data-ttu-id="74966-131">Některé scénáře vyžadují kód změny toohandle podmíněného přístupu, zatímco ostatní pracovat, jako je.</span><span class="sxs-lookup"><span data-stu-id="74966-131">Some scenarios require code changes toohandle conditional access whereas others work as is.</span></span>  <span data-ttu-id="74966-132">Tady je několik scénářů, pomocí podmíněného přístupu toodo služby Multi-Factor authentication, která poskytuje určitý pohled na hello rozdíl.</span><span class="sxs-lookup"><span data-stu-id="74966-132">Here are a few scenarios using conditional access toodo multi-factor authentication that gives some insight into hello difference.</span></span>

* <span data-ttu-id="74966-133">Vytváříte jednoho klienta iOS aplikace a aplikovat zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-133">You are building a single-tenant iOS app and apply a conditional access policy.</span></span>  <span data-ttu-id="74966-134">aplikace Hello přihlásí uživatel a nemá požadovat přístup tooan API.</span><span class="sxs-lookup"><span data-stu-id="74966-134">hello app signs in a user and doesn't request access tooan API.</span></span>  <span data-ttu-id="74966-135">Když hello uživatel přihlásí, hello zásad se automaticky vyvolá a hello uživatel potřebuje tooperform vícefaktorové ověřování (MFA).</span><span class="sxs-lookup"><span data-stu-id="74966-135">When hello user signs in, hello policy is automatically invoked and hello user needs tooperform multi-factor authentication (MFA).</span></span> 
* <span data-ttu-id="74966-136">Vytváříte víceklientské webovou aplikaci, která používá hello Microsoft Graph tooaccess systému Exchange, mezi další služby.</span><span class="sxs-lookup"><span data-stu-id="74966-136">You are building a multi-tenant web app that uses hello Microsoft Graph tooaccess Exchange, among other services.</span></span>  <span data-ttu-id="74966-137">Enterprise zákazníkovi, který přijme tuto aplikaci nastaví zásadu na SharePoint Online.</span><span class="sxs-lookup"><span data-stu-id="74966-137">An enterprise customer who adopts this app sets a policy on SharePoint Online.</span></span>  <span data-ttu-id="74966-138">Pokud webová aplikace hello požádá o token pro MS Graph, se použije zásadu na všechny Microsoft Service (konkrétně služby, které je přístupné prostřednictvím grafu).</span><span class="sxs-lookup"><span data-stu-id="74966-138">When hello web app requests a token for MS Graph, a policy on any Microsoft Service is applied (specifically services that can be accessed through graph).</span></span>  <span data-ttu-id="74966-139">Tento koncový uživatel je vyzván k MFA.</span><span class="sxs-lookup"><span data-stu-id="74966-139">This end-user is prompted for MFA.</span></span> <span data-ttu-id="74966-140">V případě hello hello koncový uživatel přihlášený pomocí platné tokeny, deklarace identity "výzvu" je vrácen toohello webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="74966-140">In hello case, hello end-user is signed in with valid tokens, a claims "challenge" is returned toohello web app.</span></span>  
* <span data-ttu-id="74966-141">Vytváříte nativní aplikaci, která používá tooaccess hello střední vrstvy služby Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-141">You are building a native app that uses a middle tier service tooaccess hello Microsoft Graph.</span></span>  <span data-ttu-id="74966-142">Enterprise zákazníka hello firmy pomocí této aplikace platí tooExchange zásad, který je Online.</span><span class="sxs-lookup"><span data-stu-id="74966-142">An enterprise customer at hello company using this app applies a policy tooExchange Online.</span></span>  <span data-ttu-id="74966-143">Když koncový uživatel přihlásí, nativní aplikaci hello požaduje přístup toohello střední vrstvy a odešle hello token.</span><span class="sxs-lookup"><span data-stu-id="74966-143">When an end-user signs in, hello native app requests access toohello middle tier and sends hello token.</span></span>  <span data-ttu-id="74966-144">střední vrstvy Hello provede tok on-behalf-of toorequest přístup toohello MS Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-144">hello middle tier performs on-behalf-of flow toorequest access toohello MS Graph.</span></span>  <span data-ttu-id="74966-145">V tomto okamžiku zobrazí deklarace identity "výzvu" toohello střední vrstvy.</span><span class="sxs-lookup"><span data-stu-id="74966-145">At this point, a claims "challenge" is presented toohello middle tier.</span></span> <span data-ttu-id="74966-146">Hello střední vrstvy zasílá hello výzvy back toohello nativní aplikaci, která potřebuje toocomply se zásadami podmíněného přístupu hello.</span><span class="sxs-lookup"><span data-stu-id="74966-146">hello middle tier sends hello challenge back toohello native app, which needs toocomply with hello conditional access policy.</span></span>

### <a name="complying-with-a-conditional-access-policy"></a><span data-ttu-id="74966-147">V souladu se zásadami podmíněného přístupu</span><span class="sxs-lookup"><span data-stu-id="74966-147">Complying with a conditional access policy</span></span>

<span data-ttu-id="74966-148">Pro několik topologií jiné aplikace. zásady podmíněného přístupu vyhodnocení při hello relace.</span><span class="sxs-lookup"><span data-stu-id="74966-148">For several different app topologies, a conditional access policy is evaluated when hello session is established.</span></span>  <span data-ttu-id="74966-149">Jako zásady podmíněného přístupu na hello členitost aplikace a služby, hello bod, ve kterém je volána výraznou závisí na scénáři hello se snažíte tooaccomplish.</span><span class="sxs-lookup"><span data-stu-id="74966-149">As a conditional access policy operates on hello granularity of apps and services, hello point at which it is invoked depends heavily on hello scenario you're trying tooaccomplish.</span></span>

<span data-ttu-id="74966-150">Když se aplikace pokusí tooaccess služby se zásadami podmíněného přístupu, může dojít k výzvy podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-150">When your app attempts tooaccess a service with a conditional access policy, it may encounter a conditional access challenge.</span></span>  <span data-ttu-id="74966-151">Tento problém je zakódován do hello `claims` parametr, který se dodává v odpovědi z Azure AD nebo hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-151">This challenge is encoded in hello `claims` parameter that comes in a response from Azure AD or hello Microsoft Graph.</span></span>  <span data-ttu-id="74966-152">Tady je příklad tohoto parametru výzvy:</span><span class="sxs-lookup"><span data-stu-id="74966-152">Here's an example of this challenge parameter:</span></span> 

```
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="74966-153">Vývojáři můžou trvat tento problém a přidá je do nové žádosti o tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="74966-153">Developers can take this challenge and append it onto a new request tooAzure AD.</span></span>  <span data-ttu-id="74966-154">Předávání tento stav vyzve všechny akce nezbytné toocomply se zásadami podmíněného přístupu hello tooperform hello koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="74966-154">Passing this state prompts hello end-user tooperform any action necessary toocomply with hello conditional access policy.</span></span> <span data-ttu-id="74966-155">V následujících scénářích hello jsou vysvětleny specifika hello chyby a jak tooextract hello parametr.</span><span class="sxs-lookup"><span data-stu-id="74966-155">In hello following scenarios, specifics of hello error and how tooextract hello parameter are explained.</span></span> 

## <a name="scenarios"></a><span data-ttu-id="74966-156">Scénáře</span><span class="sxs-lookup"><span data-stu-id="74966-156">Scenarios</span></span>

### <a name="prerequisites"></a><span data-ttu-id="74966-157">Požadavky</span><span class="sxs-lookup"><span data-stu-id="74966-157">Prerequisites</span></span>

<span data-ttu-id="74966-158">Podmíněný přístup pro Azure AD je součástí funkce [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span><span class="sxs-lookup"><span data-stu-id="74966-158">Azure AD conditional access is a feature included in [Azure AD Premium](../active-directory-whatis.md#choose-an-edition).</span></span>  <span data-ttu-id="74966-159">Další informace o licenční požadavky v hello [zprávu nelicencovaná využití](../active-directory-conditional-access-unlicensed-usage-report.md).</span><span class="sxs-lookup"><span data-stu-id="74966-159">You can learn more about licensing requirements in hello [unlicensed usage report](../active-directory-conditional-access-unlicensed-usage-report.md).</span></span>  <span data-ttu-id="74966-160">Vývojáři se můžete zapojit do hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), což zahrnuje toohello bezplatné předplatné Enterprise Mobility Suite, které zahrnuje Azure AD Premium.</span><span class="sxs-lookup"><span data-stu-id="74966-160">Developers can join hello [Microsoft Developer Network](https://msdn.microsoft.com/dn308572.aspx), which includes a free subscription toohello Enterprise Mobility Suite which includes Azure AD Premium.</span></span>

### <a name="considerations-for-specific-scenarios"></a><span data-ttu-id="74966-161">Důležité informace týkající se konkrétních scénářů</span><span class="sxs-lookup"><span data-stu-id="74966-161">Considerations for specific scenarios</span></span>

<span data-ttu-id="74966-162">Následující informace pouze Hello platí v těchto scénářích podmíněného přístupu:</span><span class="sxs-lookup"><span data-stu-id="74966-162">hello following information only applies in these conditional access scenarios:</span></span>

* <span data-ttu-id="74966-163">Přístup hello Microsoft Graph aplikací</span><span class="sxs-lookup"><span data-stu-id="74966-163">Apps accessing hello Microsoft Graph</span></span>
* <span data-ttu-id="74966-164">Provádění hello tok on-behalf-of aplikace</span><span class="sxs-lookup"><span data-stu-id="74966-164">Apps performing hello on-behalf-of flow</span></span>
* <span data-ttu-id="74966-165">Přístup k více služby nebo prostředky aplikace</span><span class="sxs-lookup"><span data-stu-id="74966-165">Apps accessing multiple services/resources</span></span>
* <span data-ttu-id="74966-166">Jednostránkové aplikace pomocí ADAL.js</span><span class="sxs-lookup"><span data-stu-id="74966-166">Single page apps using ADAL.js</span></span>

<span data-ttu-id="74966-167">V následujících částech hello budete získáme do běžné scénáře, ve kterých jsou složitější.</span><span class="sxs-lookup"><span data-stu-id="74966-167">In hello following sections, we'll get into common scenarios in which are more complex.</span></span>  <span data-ttu-id="74966-168">Princip funkce základní Hello je podmíněného přístupu, které se vyhodnocují zásady ve hello dobu, kdy se požaduje hello token pro hello službu, která se má použít, pokud je přistupuje prostřednictvím hello Microsoft Graph zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-168">hello core operating principle is conditional access policies are evaluated at hello time hello token is requested for hello service that has a conditional access policy applied unless it's being accessed through hello Microsoft Graph.</span></span>

### <a name="scenario-app-accessing-hello-microsoft-graph"></a><span data-ttu-id="74966-169">Scénář: Aplikace přístup k hello Microsoft Graph</span><span class="sxs-lookup"><span data-stu-id="74966-169">Scenario: App accessing hello Microsoft Graph</span></span>

<span data-ttu-id="74966-170">V tomto scénáři jsme provede hello případ když webové aplikace požaduje přístup toohello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-170">In this scenario, we walk through hello case when a web app requests access toohello Microsoft Graph.</span></span> <span data-ttu-id="74966-171">zásady podmíněného přístupu Hello v takovém případě může být přiřazen tooSharePoint, Exchange nebo jiné služby, které je přístupné jako zatížení prostřednictvím hello Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-171">hello conditional access policy in this case could be assigned tooSharePoint, Exchange, or some other service that is accessed as a workload through hello Microsoft Graph.</span></span>  <span data-ttu-id="74966-172">V tomto příkladu předpokládejme, že je zásada podmíněného přístupu na Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="74966-172">In this example, let's assume there's a conditional access policy on Sharepoint Online.</span></span>

![Hello Microsoft Graph vývojový diagram přístupu k aplikaci](media/active-directory-conditional-access-developer/app-accessing-microsoft-graph-scenario.png)

<span data-ttu-id="74966-174">aplikace Hello poprvé požádá autorizace toohello Microsoft Graph který vyžaduje přístup k podřízené úlohy bez podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-174">hello app first requests authorization toohello Microsoft Graph which requires accessing a downstream workload without conditional access.</span></span>  <span data-ttu-id="74966-175">Hello neproběhne bez vyvolání všechny zásady a aplikace hello přijímá tokeny pro Microsoft Graph.</span><span class="sxs-lookup"><span data-stu-id="74966-175">hello request succeeds without invoking any policy and hello app receives tokens for Microsoft Graph.</span></span>  <span data-ttu-id="74966-176">V tomto okamžiku může aplikace hello používat hello přístupový token v nosiče požadavku pro koncový bod hello požadovaný.</span><span class="sxs-lookup"><span data-stu-id="74966-176">At this point, hello app may use hello access token in a bearer request for hello endpoint requested.</span></span> <span data-ttu-id="74966-177">Nyní hello aplikace potřebuje tooaccess koncový bod služby Sharepoint Online z Microsoft Graph, například:`https://graph.microsoft.com/v1.0/me/mySite`</span><span class="sxs-lookup"><span data-stu-id="74966-177">Now, hello app needs tooaccess a Sharepoint Online endpoint of Microsoft Graph, for example: `https://graph.microsoft.com/v1.0/me/mySite`</span></span>

<span data-ttu-id="74966-178">aplikace Hello již má platný token pro hello Microsoft Graph, aby mohl vykonávat novou žádost o hello bez vystavení nový token.</span><span class="sxs-lookup"><span data-stu-id="74966-178">hello app already has a valid token for hello Microsoft Graph, so it can perform hello new request without being issued a new token.</span></span> <span data-ttu-id="74966-179">Tento požadavek selže a je výzva deklarace identity vystavené Microsoft Graph tvar hello protokolu HTTP 403 Zakázáno s ```WWW-Authenticate``` výzvu.</span><span class="sxs-lookup"><span data-stu-id="74966-179">This request fails and a claims challenge is issued from Microsoft Graph in hello form of an HTTP 403 Forbidden with a ```WWW-Authenticate``` challenge.</span></span>
<span data-ttu-id="74966-180">Tady je příklad hello odpovědi:</span><span class="sxs-lookup"><span data-stu-id="74966-180">Here's an example of hello response:</span></span> 

```
HTTP 403; Forbidden 
error=insufficient_claims
www-authenticate="Bearer realm="", authorization_uri="https://login.windows.net/common/oauth2/authorize", client_id="<GUID>", error=insufficient_claims, claims={"access_token":{"polids":{"essential":true,"values":["<GUID>"]}}}"
```

<span data-ttu-id="74966-181">Hello výzvy deklarací identity je uvnitř hello ```WWW-Authenticate``` hlavičky, která může být parametr deklarace identity hello Analyzovaná tooextract pro další požadavek hello.</span><span class="sxs-lookup"><span data-stu-id="74966-181">hello claims challenge is inside hello ```WWW-Authenticate``` header, which can be parsed tooextract hello claims parameter for hello next request.</span></span>  <span data-ttu-id="74966-182">Jakmile je novou žádost o připojení toohello, Azure AD zná zásady podmíněného přístupu hello tooevaluate při přihlášení uživatele hello a hello aplikace je nyní souladu se zásadami podmíněného přístupu hello.</span><span class="sxs-lookup"><span data-stu-id="74966-182">Once it's appended toohello new request, Azure AD knows tooevaluate hello conditional access policy when signing in hello user and hello app is now in compliance with hello conditional access policy.</span></span>  <span data-ttu-id="74966-183">Koncový bod je úspěšné opakovaných hello požadavek toohello Sharepoint Online.</span><span class="sxs-lookup"><span data-stu-id="74966-183">Repeating hello request toohello Sharepoint Online endpoint succeeds.</span></span>

<span data-ttu-id="74966-184">Ukázky kódu, která ukazují, jak toohandle hello deklarací výzvy, najdete v části toohello [ukázka kódu .NET plochy](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) ADAL .NET nebo hello [ukázka kódu On-behalf-of](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) pro ADAL .NET.</span><span class="sxs-lookup"><span data-stu-id="74966-184">For code samples that demonstrate how toohandle hello claims challenge, refer toohello [.NET Desktop code sample](https://github.com/Azure-Samples/active-directory-dotnet-native-desktop) for ADAL .NET or hello [On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca) for ADAL .NET.</span></span>

### <a name="scenario-app-performing-hello-on-behalf-of-flow"></a><span data-ttu-id="74966-185">Scénář: Aplikace provádění hello tok on-behalf-of</span><span class="sxs-lookup"><span data-stu-id="74966-185">Scenario: App performing hello on-behalf-of flow</span></span>

<span data-ttu-id="74966-186">V tomto scénáři jsme provede hello případ, ve kterém nativní aplikaci volání webové služby nebo API.</span><span class="sxs-lookup"><span data-stu-id="74966-186">In this scenario, we walk through hello case in which a native app calls a web service/API.</span></span>  <span data-ttu-id="74966-187">Pak se tato služba nemá [hello "tok on-behalf-of"](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall podřízené služby.</span><span class="sxs-lookup"><span data-stu-id="74966-187">In turn, this service does [hello "on-behalf-of" flow](active-directory-authentication-scenarios.md#application-types-and-scenarios) toocall a downstream service.</span></span>  <span data-ttu-id="74966-188">V našem případě jsme provedli naše webu podřízené služby pro podmíněný přístup zásady toohello (webovém rozhraní API 2) a používají nativní aplikaci spíše než server/démon aplikace.</span><span class="sxs-lookup"><span data-stu-id="74966-188">In our case, we've applied our conditional access policy toohello downstream service (Web API 2) and are using a native app rather than a server/daemon app.</span></span> 

![Aplikace provádění hello on-behalf-of vývojový diagram](media/active-directory-conditional-access-developer/app-performing-on-behalf-of-scenario.png)

<span data-ttu-id="74966-190">Hello počáteční žádosti o token pro webové rozhraní API 1 nezobrazí výzvu hello koncového uživatele pro službu Multi-Factor authentication jako Web API 1 nemusí vždy dosáhl hello podřízené rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="74966-190">hello initial token request for Web API 1 does not prompt hello end-user for multi-factor authentication as Web API 1 may not always hit hello downstream API.</span></span>  <span data-ttu-id="74966-191">Jakmile Web API 1 pokusí toorequest tokenu hello on-behalf-of uživatele pro webové rozhraní API 2, hello požadavek selže, protože hello uživatel není přihlášený pomocí služby Multi-Factor authentication.</span><span class="sxs-lookup"><span data-stu-id="74966-191">Once Web API 1 tries toorequest a token on-behalf-of hello user for Web API 2, hello request fails since hello user has not signed in with multi-factor authentication.</span></span>

<span data-ttu-id="74966-192">Azure AD vrátí odpověď HTTP s některé zajímavé údaje:</span><span class="sxs-lookup"><span data-stu-id="74966-192">Azure AD returns an HTTP response with some interesting data:</span></span> 

> [!NOTE]
> <span data-ttu-id="74966-193">V této instanci je popis chyby služby Multi-Factor authentication, ale je širokou škálu `interaction_required` možné odpovídající tooconditional přístup.</span><span class="sxs-lookup"><span data-stu-id="74966-193">In this instance it's a multi-factor authentication error description, but there's a wide range of `interaction_required` possible pertaining tooconditional access.</span></span>  

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API 2 App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
```

<span data-ttu-id="74966-194">V našem webové rozhraní API 1, jsme catch hello chyba `error=interaction_required`a odeslat zpět hello `claims` výzvy toohello aplikace na ploše.</span><span class="sxs-lookup"><span data-stu-id="74966-194">In our Web API 1, we catch hello error `error=interaction_required`, and send back hello `claims` challenge toohello desktop app.</span></span>  <span data-ttu-id="74966-195">V tomto okamžiku můžete provést nové aplikace na ploše hello `acquireToken()` zavolat a připojit hello `claims`problém jako parametr řetězce dotazu navíc.</span><span class="sxs-lookup"><span data-stu-id="74966-195">At that point, hello desktop app can make a new `acquireToken()` call and append hello `claims`challenge as an extra query string parameter.</span></span>  <span data-ttu-id="74966-196">Tento nový požadavek vyžaduje hello uživatele toodo vícefaktorové ověřování a potom odešlete tento nový token back tooWeb 1 rozhraní API a kompletní hello on-behalf-of toku.</span><span class="sxs-lookup"><span data-stu-id="74966-196">This new request requires hello user toodo multi-factor authentication and then send this new token back tooWeb API 1 and complete hello on-behalf-of flow.</span></span>

<span data-ttu-id="74966-197">tootry se v tomto scénáři najdete v našich [ukázka kódu .NET](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="74966-197">tootry out this scenario, see our [.NET code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="74966-198">Ukazuje, jak toopass hello deklarace identity výzvy zpět z webové rozhraní API 1 toohello nativní aplikaci a vytvořit novou žádost o uvnitř hello klientskou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="74966-198">It demonstrates how toopass hello claims challenge back from Web API 1 toohello native app and construct a new request inside hello client app.</span></span> 

### <a name="scenario-app-accessing-multiple-services"></a><span data-ttu-id="74966-199">Scénář: Aplikace přístup k několika služeb</span><span class="sxs-lookup"><span data-stu-id="74966-199">Scenario: App accessing multiple services</span></span>

<span data-ttu-id="74966-200">V tomto scénáři jsme provede případ hello ve kterém přistupuje k webové aplikaci dvě služby, z nichž jeden je přiřazen zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-200">In this scenario, we walk through hello case in which a web app accesses two services one of which has a conditional access policy assigned.</span></span>  <span data-ttu-id="74966-201">V závislosti na logice aplikace můžou existovat cesta, ve kterém aplikace nevyžaduje přístup tooboth webové služby.</span><span class="sxs-lookup"><span data-stu-id="74966-201">Depending on your app logic, there may exist a path in which your app does not require access tooboth web services.</span></span>  <span data-ttu-id="74966-202">V tomto scénáři hello pořadí, ve kterém můžete požádat o token hraje důležitou roli v hello činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="74966-202">In this scenario, hello order in which you request a token plays an important role in hello end-user experience.</span></span>

<span data-ttu-id="74966-203">Předpokládejme máme webové služby A a B a webová služba B má naše zásady podmíněného přístupu použije.</span><span class="sxs-lookup"><span data-stu-id="74966-203">Let's assume we have web service A and B and web service B has our conditional access policy applied.</span></span>  <span data-ttu-id="74966-204">Při požadavku počáteční interaktivní auth hello vyžaduje souhlas pro obě služby, hello zásady podmíněného přístupu není potřeba ve všech případech.</span><span class="sxs-lookup"><span data-stu-id="74966-204">While hello initial interactive auth request requires consent for both services, hello conditional access policy is not required in all cases.</span></span>  <span data-ttu-id="74966-205">Pokud aplikace hello požádá o token pro webovou službu B, vyvolání hello zásad a následné žádosti pro webovou službu A také úspěšné následujícím způsobem.</span><span class="sxs-lookup"><span data-stu-id="74966-205">If hello app requests a token for web service B, then hello policy is invoked and subsequent requests for web service A also succeeds as follows.</span></span>

![Aplikace přístup k více služeb vývojový diagram](media/active-directory-conditional-access-developer/app-accessing-multiple-services-scenario.png)

<span data-ttu-id="74966-207">Případně pokud aplikace hello původně požaduje token pro webové služby A, koncových uživatelů hello nevyvolá hello zásady podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-207">Alternatively, if hello app initially requests a token for web service A, hello end-user does not invoke hello conditional access policy.</span></span>  <span data-ttu-id="74966-208">To umožňuje vývojáři aplikace hello činnost koncového uživatele hello toocontrol a bez vynucení toobe zásady podmíněného přístupu hello vyvolat ve všech případech.</span><span class="sxs-lookup"><span data-stu-id="74966-208">This allows hello app developer toocontrol hello end-user experience and not force hello conditional access policy toobe invoked in all cases.</span></span> <span data-ttu-id="74966-209">Hello složité případem je, pokud aplikace hello následně vyžaduje token pro webové služby serveru B. V tomto okamžiku hello koncový uživatel musí toocomply se zásadami podmíněného přístupu hello.</span><span class="sxs-lookup"><span data-stu-id="74966-209">hello tricky case is if hello app subsequently requests a token for web service B. At this point, hello end-user needs toocomply with hello conditional access policy.</span></span>  <span data-ttu-id="74966-210">Když se aplikace hello pokusí příliš`acquireToken`, to může generovat hello následující chybu (znázorněné v následujícím diagramu hello):</span><span class="sxs-lookup"><span data-stu-id="74966-210">When hello app tries too`acquireToken`, it may generate hello following error (illustrated in hello following diagram):</span></span> 

```
HTTP 400; Bad Request
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
claims={"access_token":{"polids":{"essential":true,"Values":["<GUID>"]}}}
``` 

![Přístup k více služeb, které žádají o nový token aplikace](media/active-directory-conditional-access-developer/app-accessing-multiple-services-new-token.png)

<span data-ttu-id="74966-212">Pokud aplikace hello je pomocí knihovny ADAL hello, token hello tooacquire selhání je vždy opakovat interaktivně.</span><span class="sxs-lookup"><span data-stu-id="74966-212">If hello app is using hello ADAL library, a failure tooacquire hello token is always retried interactively.</span></span>  <span data-ttu-id="74966-213">Když dojde k této žádosti interaktivní, koncový uživatel hello musí hello možnost toocomply s podmíněným přístupem hello.</span><span class="sxs-lookup"><span data-stu-id="74966-213">When this interactive request occurs, hello end-user has hello opportunity toocomply with hello conditional access.</span></span>  <span data-ttu-id="74966-214">Toto je hodnota true, pokud je požadavek hello `AcquireTokenSilentAsync` nebo `PromptBehavior.Never` v takovém případě aplikace hello musí tooperform interaktivní ```AcquireToken``` požadavku toogive hello koncového užití hello možnost toocomply zásadám hello.</span><span class="sxs-lookup"><span data-stu-id="74966-214">This is true unless hello request is a `AcquireTokenSilentAsync` or `PromptBehavior.Never` in which case hello app needs tooperform an interactive ```AcquireToken``` request toogive hello end use hello opportunity toocomply with hello policy.</span></span> 

### <a name="scenario-single-page-app-spa-using-adaljs"></a><span data-ttu-id="74966-215">Scénář: Jednu stránku aplikace (SPA) pomocí ADAL.js</span><span class="sxs-lookup"><span data-stu-id="74966-215">Scenario: Single Page App (SPA) using ADAL.js</span></span>

<span data-ttu-id="74966-216">V tomto scénáři jsme provede hello případ, když máme jednostránkové aplikace (SPA), pomocí ADAL.js toocall podmíněného přístupu chráněné webového rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="74966-216">In this scenario, we walk through hello case when we have a single page app (SPA), using ADAL.js toocall a conditional access protected web API.</span></span>  <span data-ttu-id="74966-217">To je jednoduché architekturou, ale má některé drobné odlišnosti, které je třeba vzít v úvahu při vývoji kolem podmíněného přístupu toobe.</span><span class="sxs-lookup"><span data-stu-id="74966-217">This is a simple architecture but has some nuances that need toobe taken into account when developing around conditional access.</span></span>

<span data-ttu-id="74966-218">V ADAL.js, existuje několik funkcí, které získat tokeny: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, a `acquireTokenRedirect(…)`.</span><span class="sxs-lookup"><span data-stu-id="74966-218">In ADAL.js, there are a few functions that obtain tokens: `login()`, `acquireToken(...)`, `acquireTokenPopup(…)`, and `acquireTokenRedirect(…)`.</span></span> 

* <span data-ttu-id="74966-219">`login()`Získá token ID prostřednictvím požadavek interaktivní přihlašování, ale není získali přístupové tokeny pro všechny služby (včetně podmíněného přístupu k chráněným webového rozhraní API).</span><span class="sxs-lookup"><span data-stu-id="74966-219">`login()` obtains an ID token through an interactive sign-in request but does not obtain access tokens for any service (including a conditional access protected web API).</span></span>  
* <span data-ttu-id="74966-220">`acquireToken(…)`Poté můžete být použité toosilently získat token přístupu, což znamená, že se za žádných okolností nezobrazuje uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="74966-220">`acquireToken(…)` can then be used toosilently obtain an access token meaning it does not show UI in any circumstance.</span></span>  
* <span data-ttu-id="74966-221">`acquireTokenPopup(…)`a `acquireTokenRedirect(…)` jsou obě použité toointeractively vyžádání tokenu pro prostředek, což znamená, budou vždy zobrazovat přihlašovací rozhraní.</span><span class="sxs-lookup"><span data-stu-id="74966-221">`acquireTokenPopup(…)` and `acquireTokenRedirect(…)` are both used toointeractively request a token for a resource meaning they always show sign-in UI.</span></span>

<span data-ttu-id="74966-222">Pokud aplikace potřebuje přístupu k tokenu toocall webového rozhraní API, všechny pokusy `acquireToken(…)`.</span><span class="sxs-lookup"><span data-stu-id="74966-222">When an app needs an access token toocall a Web API, it attempts an `acquireToken(…)`.</span></span>  <span data-ttu-id="74966-223">Pokud je platnost tokenu relace hello nebo potřebujeme toocomply se zásadami podmíněného přístupu, pak hello *acquireToken* funkce selže a hello používá aplikace `acquireTokenPopup()` nebo `acquireTokenRedirect()`.</span><span class="sxs-lookup"><span data-stu-id="74966-223">If hello token session is expired or we need toocomply with a conditional access policy, then hello *acquireToken* function fails and hello app uses `acquireTokenPopup()` or `acquireTokenRedirect()`.</span></span>

![Jednostránkové aplikace pomocí ADAL vývojový diagram](media/active-directory-conditional-access-developer/spa-using-adal-scenario.png)

<span data-ttu-id="74966-225">Projděme příklad s náš scénář podmíněného přístupu.</span><span class="sxs-lookup"><span data-stu-id="74966-225">Let's walk through an example with our conditional access scenario.</span></span>  <span data-ttu-id="74966-226">koncový uživatel Hello právě dostali v lokalitě hello a nemá relaci.</span><span class="sxs-lookup"><span data-stu-id="74966-226">hello end-user just landed on hello site and doesn’t have a session.</span></span>  <span data-ttu-id="74966-227">Můžeme provádět `login()` volání, získání ID tokenu bez ověřování Multi-Factor authentication.</span><span class="sxs-lookup"><span data-stu-id="74966-227">We perform a `login()` call, get an ID token without multi-factor authentication.</span></span>  <span data-ttu-id="74966-228">Potom uživatel hello dotkne tlačítko, které vyžaduje hello aplikace toorequest dat z webového rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="74966-228">Then hello user hits a button that requires hello app toorequest data from a web API.</span></span>  <span data-ttu-id="74966-229">aplikace Hello pokusí toodo `acquireToken()` volání ale selže, protože hello uživatele služby Multi-Factor authentication dosud neprovedl a je třeba toocomply se zásadami podmíněného přístupu hello.</span><span class="sxs-lookup"><span data-stu-id="74966-229">hello app tries toodo an `acquireToken()` call but fails since hello user has not performed multi-factor authentication yet and needs toocomply with hello conditional access policy.</span></span>

<span data-ttu-id="74966-230">Azure AD odesílá zpět hello následující odpověď HTTP:</span><span class="sxs-lookup"><span data-stu-id="74966-230">Azure AD sends back hello following HTTP response:</span></span> 

```
HTTP 400; Bad Request 
error=interaction_required
error_description=AADSTS50076: Due tooa configuration change made by your administrator, or because you moved tooa new location, you must use multi-factor authentication tooaccess '<Web API App/Client ID>'.
```

<span data-ttu-id="74966-231">Naše aplikace potřebuje toocatch hello `error=interaction_required`.</span><span class="sxs-lookup"><span data-stu-id="74966-231">Our app needs toocatch hello `error=interaction_required`.</span></span>  <span data-ttu-id="74966-232">Hello aplikace pak může použít buď `acquireTokenPopup()` nebo `acquireTokenRedirect()` na stejné hello prostředků.</span><span class="sxs-lookup"><span data-stu-id="74966-232">hello application can then use either `acquireTokenPopup()` or `acquireTokenRedirect()` on hello same resource.</span></span>  <span data-ttu-id="74966-233">uživatel Hello je toodo vynucené použití služby Multi-Factor authentication.</span><span class="sxs-lookup"><span data-stu-id="74966-233">hello user is forced toodo a multi-factor authentication.</span></span> <span data-ttu-id="74966-234">Po dokončení hello vícefaktorového ověřování uživatele hello hello aplikace se objeví čerstvou přístupový token pro hello požadovaný prostředek.</span><span class="sxs-lookup"><span data-stu-id="74966-234">After hello user completes hello multi-factor authentication, hello app is issued a fresh access token for hello requested resource.</span></span>

<span data-ttu-id="74966-235">tootry se v tomto scénáři najdete v našich [ukázka kódu On-behalf-of JS SPA](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span><span class="sxs-lookup"><span data-stu-id="74966-235">tootry out this scenario, see our [JS SPA On-behalf-of code sample](https://github.com/Azure-Samples/active-directory-dotnet-webapi-onbehalfof-ca).</span></span>  <span data-ttu-id="74966-236">Tento příklad používá hello zásady podmíněného přístupu a webového rozhraní API je zaregistrována dříve JS SPA toodemonstrate tento scénář.</span><span class="sxs-lookup"><span data-stu-id="74966-236">This code sample uses hello conditional access policy and web API you registered earlier with a JS SPA toodemonstrate this scenario.</span></span> <span data-ttu-id="74966-237">Zobrazuje, jak tooproperly popisovač hello deklarací výzvu a získat přístupový token, který lze použít pro webové rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="74966-237">It shows how tooproperly handle hello claims challenge and get an access token that can be used for your Web API.</span></span> <span data-ttu-id="74966-238">Případně, najdete v článku věnovaném hello Obecné [ukázka kódu Angular.js](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) pokyny k úhlová SPA</span><span class="sxs-lookup"><span data-stu-id="74966-238">Alternatively, checkout hello general [Angular.js code sample](https://github.com/Azure-Samples/active-directory-angularjs-singlepageapp) for guidance on an Angular SPA</span></span>


## <a name="see-also"></a><span data-ttu-id="74966-239">Viz také</span><span class="sxs-lookup"><span data-stu-id="74966-239">See also</span></span>

* <span data-ttu-id="74966-240">najdete v části toolearn Další informace o možnosti hello [podmíněného přístupu ve službě Azure AD](../active-directory-conditional-access.md).</span><span class="sxs-lookup"><span data-stu-id="74966-240">toolearn more about hello capabilities, see [Conditional Access in Azure AD](../active-directory-conditional-access.md).</span></span>
* <span data-ttu-id="74966-241">Ukázky kódu více Azure AD, najdete v části [úložiště Github ukázek kódu](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span><span class="sxs-lookup"><span data-stu-id="74966-241">For more Azure AD code samples, see [Github Repo of Code Samples](https://github.com/azure-samples?utf8=%E2%9C%93&q=active-directory).</span></span> 
* <span data-ttu-id="74966-242">Další informace o hello ADAL SDK a přístup hello referenční dokumentaci k nástroji, najdete v části [příručku knihovny](active-directory-authentication-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="74966-242">For more info on hello ADAL SDK's and access hello reference documentation, see [library guide](active-directory-authentication-libraries.md).</span></span>
* <span data-ttu-id="74966-243">toolearn Další informace o scénářích více klientů, najdete v části [jak toosign v uživatele, kteří používají vzor víceklientské hello](active-directory-devhowto-multi-tenant-overview.md).</span><span class="sxs-lookup"><span data-stu-id="74966-243">toolearn more about multi-tenant scenarios, see [How toosign in users using hello multi-tenant pattern](active-directory-devhowto-multi-tenant-overview.md).</span></span>

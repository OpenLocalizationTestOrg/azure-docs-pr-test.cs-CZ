---
title: "Azure Active Directory v2.0 obory, oprávnění a souhlasu | Microsoft Docs"
description: "Popis autorizace v koncového bodu v2.0 Azure AD, včetně obory, oprávnění a souhlasu."
services: active-directory
documentationcenter: 
author: dstrockis
manager: mbaldwin
editor: 
ms.assetid: 8f98cbf0-a71d-4e34-babf-e644ad9ff423
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 01/07/2017
ms.author: dastrock
ms.custom: aaddev
ms.openlocfilehash: 04869a7627ecb3e6a0d11733fae7da2ecb04ed51
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="scopes-permissions-and-consent-in-the-azure-active-directory-v20-endpoint"></a><span data-ttu-id="353b4-103">Obory, oprávnění a souhlasu v koncového bodu v2.0 Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="353b4-103">Scopes, permissions, and consent in the Azure Active Directory v2.0 endpoint</span></span>
<span data-ttu-id="353b4-104">Aplikace, které se integrují s Azure Active Directory (Azure AD), postupujte podle modelu autorizace, který nabízí uživatelům kontrolu nad přístupu svá data aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-104">Apps that integrate with Azure Active Directory (Azure AD) follow an authorization model that gives users control over how an app can access their data.</span></span> <span data-ttu-id="353b4-105">Implementace v2.0 modelu autorizace byl aktualizován a změní způsob, jakým aplikace musí komunikovat s Azure AD.</span><span class="sxs-lookup"><span data-stu-id="353b4-105">The v2.0 implementation of the authorization model has been updated, and it changes how an app must interact with Azure AD.</span></span> <span data-ttu-id="353b4-106">Tento článek se zabývá základními koncepty prostředí tato ověřování modelu, včetně obory, oprávnění a souhlasu.</span><span class="sxs-lookup"><span data-stu-id="353b4-106">This article covers the basic concepts of this authorization model, including scopes, permissions, and consent.</span></span>

> [!NOTE]
> <span data-ttu-id="353b4-107">Koncový bod v2.0 nepodporuje všechny scénáře Azure Active Directory a funkce.</span><span class="sxs-lookup"><span data-stu-id="353b4-107">The v2.0 endpoint does not support all Azure Active Directory scenarios and features.</span></span> <span data-ttu-id="353b4-108">Pokud chcete zjistit, zda byste měli používat koncový bod v2.0, přečtěte si informace o [v2.0 omezení](active-directory-v2-limitations.md).</span><span class="sxs-lookup"><span data-stu-id="353b4-108">To determine whether you should use the v2.0 endpoint, read about [v2.0 limitations](active-directory-v2-limitations.md).</span></span>
>
>

## <a name="scopes-and-permissions"></a><span data-ttu-id="353b4-109">Obory a oprávnění</span><span class="sxs-lookup"><span data-stu-id="353b4-109">Scopes and permissions</span></span>
<span data-ttu-id="353b4-110">Azure AD implementuje [OAuth 2.0](active-directory-v2-protocols.md) protokol autorizace.</span><span class="sxs-lookup"><span data-stu-id="353b4-110">Azure AD implements the [OAuth 2.0](active-directory-v2-protocols.md) authorization protocol.</span></span> <span data-ttu-id="353b4-111">OAuth 2.0 je metoda, pomocí kterého aplikace třetích stran mají přístup k webové hostované prostředkům jménem uživatele.</span><span class="sxs-lookup"><span data-stu-id="353b4-111">OAuth 2.0 is a method through which a third-party app can access web-hosted resources on behalf of a user.</span></span> <span data-ttu-id="353b4-112">Všechny webové hostované prostředek, který se integruje se službou Azure AD má identifikátor prostředku nebo *identifikátor ID URI aplikace*.</span><span class="sxs-lookup"><span data-stu-id="353b4-112">Any web-hosted resource that integrates with Azure AD has a resource identifier, or *Application ID URI*.</span></span> <span data-ttu-id="353b4-113">Například některé společnosti Microsoft hostuje webové prostředky zahrnují:</span><span class="sxs-lookup"><span data-stu-id="353b4-113">For example, some of Microsoft's web-hosted resources include:</span></span>

* <span data-ttu-id="353b4-114">Office 365 Unified e-mailu rozhraní API:`https://outlook.office.com`</span><span class="sxs-lookup"><span data-stu-id="353b4-114">The Office 365 Unified Mail API: `https://outlook.office.com`</span></span>
* <span data-ttu-id="353b4-115">Rozhraní Azure AD Graph API:`https://graph.windows.net`</span><span class="sxs-lookup"><span data-stu-id="353b4-115">The Azure AD Graph API: `https://graph.windows.net`</span></span>
* <span data-ttu-id="353b4-116">Microsoft Graph:`https://graph.microsoft.com`</span><span class="sxs-lookup"><span data-stu-id="353b4-116">Microsoft Graph: `https://graph.microsoft.com`</span></span>

<span data-ttu-id="353b4-117">Totéž platí pro všechny prostředky třetích stran, které mají integrované s Azure AD.</span><span class="sxs-lookup"><span data-stu-id="353b4-117">The same is true for any third-party resources that have integrated with Azure AD.</span></span> <span data-ttu-id="353b4-118">Kterýkoli z těchto prostředků také můžete definovat sadu oprávnění, které lze použít k rozdělení na menší bloky dat funkci prostředku.</span><span class="sxs-lookup"><span data-stu-id="353b4-118">Any of these resources also can define a set of permissions that can be used to divide the functionality of that resource into smaller chunks.</span></span> <span data-ttu-id="353b4-119">Jako příklad [Microsoft Graph](https://graph.microsoft.io) definovaných oprávnění k provést následující úlohy, mimo jiné:</span><span class="sxs-lookup"><span data-stu-id="353b4-119">As an example, [Microsoft Graph](https://graph.microsoft.io) has defined permissions to do the following tasks, among others:</span></span>

* <span data-ttu-id="353b4-120">Číst kalendář uživatele</span><span class="sxs-lookup"><span data-stu-id="353b4-120">Read a user's calendar</span></span>
* <span data-ttu-id="353b4-121">Zápis do kalendáře uživatele</span><span class="sxs-lookup"><span data-stu-id="353b4-121">Write to a user's calendar</span></span>
* <span data-ttu-id="353b4-122">Odesílání pošty jménem uživatele</span><span class="sxs-lookup"><span data-stu-id="353b4-122">Send mail as a user</span></span>

<span data-ttu-id="353b4-123">Definováním tyto typy oprávnění prostředek má jemně odstupňovanou kontrolu nad jeho data a jak je vystaven data.</span><span class="sxs-lookup"><span data-stu-id="353b4-123">By defining these types of permissions, the resource has fine-grained control over its data and how the data is exposed.</span></span> <span data-ttu-id="353b4-124">Aplikace jiných výrobců může požádat o oprávnění z aplikace uživatele.</span><span class="sxs-lookup"><span data-stu-id="353b4-124">A third-party app can request these permissions from an app user.</span></span> <span data-ttu-id="353b4-125">Uživatel aplikaci musí schválit oprávnění, než aplikace může fungovat jménem uživatele.</span><span class="sxs-lookup"><span data-stu-id="353b4-125">The app user must approve the permissions before the app can act on the user's behalf.</span></span> <span data-ttu-id="353b4-126">Podle rozdělování funkce prostředku do menší sady oprávnění, se dají vytvářet aplikace jiných výrobců s žádostí o pouze konkrétní oprávnění, které potřebují k provedení jejich funkce.</span><span class="sxs-lookup"><span data-stu-id="353b4-126">By chunking the resource's functionality into smaller permission sets, third-party apps can be built to request only the specific permissions that they need to perform their function.</span></span> <span data-ttu-id="353b4-127">Uživatelé aplikaci můžete věděli, přesně jak aplikace bude používat svá data, a může se jednat o větší jistotu, že aplikace není chovají se zlými úmysly.</span><span class="sxs-lookup"><span data-stu-id="353b4-127">App users can know exactly how an app will use their data, and they can be more confident that the app is not behaving with malicious intent.</span></span>

<span data-ttu-id="353b4-128">Ve službě Azure AD a OAuth, se nazývají tyto typy oprávnění *obory*.</span><span class="sxs-lookup"><span data-stu-id="353b4-128">In Azure AD and OAuth, these types of permissions are called *scopes*.</span></span> <span data-ttu-id="353b4-129">Taky někdy označují se jako *oAuth2Permissions*.</span><span class="sxs-lookup"><span data-stu-id="353b4-129">They also sometimes are referred to as *oAuth2Permissions*.</span></span> <span data-ttu-id="353b4-130">Obor představuje ve službě Azure AD hodnotu řetězce.</span><span class="sxs-lookup"><span data-stu-id="353b4-130">A scope is represented in Azure AD as a string value.</span></span> <span data-ttu-id="353b4-131">Pokračování příkladu Microsoft Graph s, je hodnota oboru pro každé oprávnění:</span><span class="sxs-lookup"><span data-stu-id="353b4-131">Continuing with the Microsoft Graph example, the scope value for each permission is:</span></span>

* <span data-ttu-id="353b4-132">Číst kalendář uživatele pomocí`Calendar.Read`</span><span class="sxs-lookup"><span data-stu-id="353b4-132">Read a user's calendar by using `Calendar.Read`</span></span>
* <span data-ttu-id="353b4-133">Zápis do kalendáře uživatele pomocí`Mail.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="353b4-133">Write to a user's calendar by using `Mail.ReadWrite`</span></span>
* <span data-ttu-id="353b4-134">Odesílat poštu jménem uživatele pomocí podle`Mail.Send`</span><span class="sxs-lookup"><span data-stu-id="353b4-134">Send mail as a user using by `Mail.Send`</span></span>

<span data-ttu-id="353b4-135">Aplikace může požádat o tato oprávnění zadáním obory v požadavcích na koncový bod v2.0.</span><span class="sxs-lookup"><span data-stu-id="353b4-135">An app can request these permissions by specifying the scopes in requests to the v2.0 endpoint.</span></span>

## <a name="openid-connect-scopes"></a><span data-ttu-id="353b4-136">OpenID Connect oborů</span><span class="sxs-lookup"><span data-stu-id="353b4-136">OpenID Connect scopes</span></span>
<span data-ttu-id="353b4-137">Implementace v2.0 OpenID Connect obsahuje několik dobře definovaný obory, které se nevztahují na konkrétní prostředek: `openid`, `email`, `profile`, a `offline_access`.</span><span class="sxs-lookup"><span data-stu-id="353b4-137">The v2.0 implementation of OpenID Connect has a few well-defined scopes that do not apply to a specific resource: `openid`, `email`, `profile`, and `offline_access`.</span></span>

### <a name="openid"></a><span data-ttu-id="353b4-138">openid</span><span class="sxs-lookup"><span data-stu-id="353b4-138">openid</span></span>
<span data-ttu-id="353b4-139">Pokud aplikace provede přihlášení pomocí [OpenID Connect](active-directory-v2-protocols.md), musíte požádat o `openid` oboru.</span><span class="sxs-lookup"><span data-stu-id="353b4-139">If an app performs sign-in by using [OpenID Connect](active-directory-v2-protocols.md), it must request the `openid` scope.</span></span> <span data-ttu-id="353b4-140">`openid` Oboru se zobrazuje na stránce pracovní účet souhlasu oprávnění "Přihlásit" a na stránku souhlasu účtu Microsoft osobní oprávnění "Zobrazit váš profil a připojení k aplikacím a službám pomocí účtu Microsoft".</span><span class="sxs-lookup"><span data-stu-id="353b4-140">The `openid` scope shows on the work account consent page as the "Sign you in" permission, and on the personal Microsoft account consent page as the "View your profile and connect to apps and services using your Microsoft account" permission.</span></span> <span data-ttu-id="353b4-141">Aplikace s tímto oprávněním může přijímat jedinečný identifikátor pro uživatele ve formě `sub` deklarací identity.</span><span class="sxs-lookup"><span data-stu-id="353b4-141">With this permission, an app can receive a unique identifier for the user in the form of the `sub` claim.</span></span> <span data-ttu-id="353b4-142">Také nabízí přístup k aplikaci koncovému uživateli.</span><span class="sxs-lookup"><span data-stu-id="353b4-142">It also gives the app access to the UserInfo endpoint.</span></span> <span data-ttu-id="353b4-143">`openid` Oboru lze použít na koncový bod tokenu v2.0 získat tokeny typu ID, které se dají použít k zabezpečení volání protokolu HTTP mezi různými součástmi aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-143">The `openid` scope can be used at the v2.0 token endpoint to acquire ID tokens, which can be used to secure HTTP calls between different components of an app.</span></span>

### <a name="email"></a><span data-ttu-id="353b4-144">E-mailu</span><span class="sxs-lookup"><span data-stu-id="353b4-144">email</span></span>
<span data-ttu-id="353b4-145">`email` Oboru lze použít s `openid` oboru a všechny další.</span><span class="sxs-lookup"><span data-stu-id="353b4-145">The `email` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="353b4-146">Nabízí přístup k aplikaci pro uživatele primární e-mailovou adresu ve tvaru `email` deklarací identity.</span><span class="sxs-lookup"><span data-stu-id="353b4-146">It gives the app access to the user's primary email address in the form of the `email` claim.</span></span> <span data-ttu-id="353b4-147">`email` Deklarace identity je součástí token pouze v případě, že uživatelský účet, který není vždy případě přidružen e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="353b4-147">The `email` claim is included in a token only if an email address is associated with the user account, which is not always the case.</span></span> <span data-ttu-id="353b4-148">Pokud se používá `email` oboru, vaše aplikace by měla připravte se na zpracovat případy, ve kterém `email` deklarace identity neexistuje v tokenu.</span><span class="sxs-lookup"><span data-stu-id="353b4-148">If it uses the `email` scope, your app should be prepared to handle a case in which the `email` claim does not exist in the token.</span></span>

### <a name="profile"></a><span data-ttu-id="353b4-149">Profil</span><span class="sxs-lookup"><span data-stu-id="353b4-149">profile</span></span>
<span data-ttu-id="353b4-150">`profile` Oboru lze použít s `openid` oboru a všechny další.</span><span class="sxs-lookup"><span data-stu-id="353b4-150">The `profile` scope can be used with the `openid` scope and any others.</span></span> <span data-ttu-id="353b4-151">Poskytuje přístup k aplikaci ke vyžadovat značné množství informací o uživateli.</span><span class="sxs-lookup"><span data-stu-id="353b4-151">It gives the app access to a substantial amount of information about the user.</span></span> <span data-ttu-id="353b4-152">Obsahuje informace, které má přístup, ale není omezen na uživatele křestní jméno, příjmení, upřednostňované uživatelské jméno a ID objektu.</span><span class="sxs-lookup"><span data-stu-id="353b4-152">The information it can access includes, but is not limited to, the user's given name, surname, preferred username, and object ID.</span></span> <span data-ttu-id="353b4-153">Úplný seznam profilu deklarace, který je k dispozici v parametru id_tokens pro konkrétního uživatele, najdete v článku [v2.0 tokeny odkaz](active-directory-v2-tokens.md).</span><span class="sxs-lookup"><span data-stu-id="353b4-153">For a complete list of the profile claims available in the id_tokens parameter for a specific user, see the [v2.0 tokens reference](active-directory-v2-tokens.md).</span></span>

### <a name="offlineaccess"></a><span data-ttu-id="353b4-154">offline_access</span><span class="sxs-lookup"><span data-stu-id="353b4-154">offline_access</span></span>
<span data-ttu-id="353b4-155">[ `offline_access` Oboru](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) poskytuje aplikaci přístup k prostředkům jménem uživatele po delší dobu.</span><span class="sxs-lookup"><span data-stu-id="353b4-155">The [`offline_access` scope](http://openid.net/specs/openid-connect-core-1_0.html#OfflineAccess) gives your app access to resources on behalf of the user for an extended time.</span></span> <span data-ttu-id="353b4-156">Na stránce pracovní účet souhlasu tento obor zobrazí jako "Přístup k datům kdykoli" oprávnění.</span><span class="sxs-lookup"><span data-stu-id="353b4-156">On the work account consent page, this scope appears as the "Access your data anytime" permission.</span></span> <span data-ttu-id="353b4-157">Na osobní stránku účtu Microsoft souhlasu zobrazí se jako "Přístup k informacím kdykoli" oprávnění.</span><span class="sxs-lookup"><span data-stu-id="353b4-157">On the personal Microsoft account consent page, it appears as the "Access your info anytime" permission.</span></span> <span data-ttu-id="353b4-158">Když uživatel schválí `offline_access` oboru, vaše aplikace může přijímat tokeny obnovení z koncového bodu v2.0 tokenu.</span><span class="sxs-lookup"><span data-stu-id="353b4-158">When a user approves the `offline_access` scope, your app can receive refresh tokens from the v2.0 token endpoint.</span></span> <span data-ttu-id="353b4-159">Tokeny obnovení je dlouhodobé.</span><span class="sxs-lookup"><span data-stu-id="353b4-159">Refresh tokens are long-lived.</span></span> <span data-ttu-id="353b4-160">Aplikaci můžete získat nové přístupové tokeny, protože platnost vyprší starší.</span><span class="sxs-lookup"><span data-stu-id="353b4-160">Your app can get new access tokens as older ones expire.</span></span>

<span data-ttu-id="353b4-161">Pokud vaše aplikace neuvede v požadavku `offline_access` oboru, neobdrží obnovovacích tokenů.</span><span class="sxs-lookup"><span data-stu-id="353b4-161">If your app does not request the `offline_access` scope, it won't receive refresh tokens.</span></span> <span data-ttu-id="353b4-162">To znamená, že když uplatnit autorizační kód v [toku kódu autorizace OAuth 2.0](active-directory-v2-protocols.md), dostanete pouze přístupový token z `/token` koncový bod.</span><span class="sxs-lookup"><span data-stu-id="353b4-162">This means that when you redeem an authorization code in the [OAuth 2.0 authorization code flow](active-directory-v2-protocols.md), you'll receive only an access token from the `/token` endpoint.</span></span> <span data-ttu-id="353b4-163">Přístupový token je platný po krátkou dobu.</span><span class="sxs-lookup"><span data-stu-id="353b4-163">The access token is valid for a short time.</span></span> <span data-ttu-id="353b4-164">Přístupový token se obvykle vyprší za jednu hodinu.</span><span class="sxs-lookup"><span data-stu-id="353b4-164">The access token usually expires in one hour.</span></span> <span data-ttu-id="353b4-165">AT, že bod, vaše aplikace musí přesměruje uživatele zpět na `/authorize` koncový bod pro získání nového kódu autorizace.</span><span class="sxs-lookup"><span data-stu-id="353b4-165">At that point, your app needs to redirect the user back to the `/authorize` endpoint to get a new authorization code.</span></span> <span data-ttu-id="353b4-166">Během této přesměrování, v závislosti na typu aplikace může uživatel muset znovu zadat své přihlašovací údaje nebo znovu souhlas oprávnění.</span><span class="sxs-lookup"><span data-stu-id="353b4-166">During this redirect, depending on the type of app, the user might need to enter their credentials again or consent again to permissions.</span></span>

<span data-ttu-id="353b4-167">Další informace o tom, jak získat a použít tokeny obnovení najdete v tématu [referenci na protokol v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="353b4-167">For more information about how to get and use refresh tokens, see the [v2.0 protocol reference](active-directory-v2-protocols.md).</span></span>

## <a name="requesting-individual-user-consent"></a><span data-ttu-id="353b4-168">Vyžaduje souhlas jednotlivé uživatele</span><span class="sxs-lookup"><span data-stu-id="353b4-168">Requesting individual user consent</span></span>
<span data-ttu-id="353b4-169">V [OpenID Connect nebo OAuth 2.0](active-directory-v2-protocols.md) požádat o autorizaci, aplikace můžete požádat o oprávnění, je nutné pomocí `scope` parametr dotazu.</span><span class="sxs-lookup"><span data-stu-id="353b4-169">In an [OpenID Connect or OAuth 2.0](active-directory-v2-protocols.md) authorization request, an app can request the permissions it needs by using the `scope` query parameter.</span></span> <span data-ttu-id="353b4-170">Když se uživatel přihlásí do aplikace, aplikace odešle požadavek jako v následujícím příkladu (pomocí konců řádků přidat pro čitelnost):</span><span class="sxs-lookup"><span data-stu-id="353b4-170">For example, when a user signs in to an app, the app sends a request like the following example (with line breaks added for legibility):</span></span>

```
GET https://login.microsoftonline.com/common/oauth2/v2.0/authorize?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&response_type=code
&redirect_uri=http%3A%2F%2Flocalhost%2Fmyapp%2F
&response_mode=query
&scope=
https%3A%2F%2Fgraph.microsoft.com%2Fcalendar.read%20
https%3A%2F%2Fgraph.microsoft.com%2Fmail.send
&state=12345
```

<span data-ttu-id="353b4-171">`scope` Parametr je seznam obory, které aplikace požaduje oddělených mezerami.</span><span class="sxs-lookup"><span data-stu-id="353b4-171">The `scope` parameter is a space-separated list of scopes that the app is requesting.</span></span> <span data-ttu-id="353b4-172">Každý obor je indikován hodnota oboru připojení k prostředku identifikátoru (ID URI aplikace).</span><span class="sxs-lookup"><span data-stu-id="353b4-172">Each scope is indicated by appending the scope value to the resource's identifier (the Application ID URI).</span></span> <span data-ttu-id="353b4-173">V příkladu žádosti o aplikace potřebuje oprávnění pro čtení kalendáře uživatele a odesílat poštu jménem uživatele.</span><span class="sxs-lookup"><span data-stu-id="353b4-173">In the request example, the app needs permission to read the user's calendar and send mail as the user.</span></span>

<span data-ttu-id="353b4-174">Poté, co uživatel zadá své přihlašovací údaje, koncový bod v2.0 vyhledává odpovídající záznam *souhlas uživatele*.</span><span class="sxs-lookup"><span data-stu-id="353b4-174">After the user enters their credentials, the v2.0 endpoint checks for a matching record of *user consent*.</span></span> <span data-ttu-id="353b4-175">Pokud uživatel nebyl žádný z požadovaných oprávnění přijata v minulosti, koncový bod v2.0 požádá uživatele a udělit požadovaná oprávnění.</span><span class="sxs-lookup"><span data-stu-id="353b4-175">If the user has not consented to any of the requested permissions in the past, the v2.0 endpoint asks the user to grant the requested permissions.</span></span>

![Pracovní účet souhlasu](../../media/active-directory-v2-flows/work_account_consent.png)

<span data-ttu-id="353b4-177">Když uživatel schválí oprávnění, souhlasu se zaznamenává tak, aby uživatel nemá k souhlas znovu na následující účet přihlášení.</span><span class="sxs-lookup"><span data-stu-id="353b4-177">When the user approves the permission, the consent is recorded so that the user doesn't have to consent again on subsequent account sign-ins.</span></span>

## <a name="requesting-consent-for-an-entire-tenant"></a><span data-ttu-id="353b4-178">Vyžaduje souhlas pro celý klienta</span><span class="sxs-lookup"><span data-stu-id="353b4-178">Requesting consent for an entire tenant</span></span>
<span data-ttu-id="353b4-179">Často organizace zakoupí licence nebo předplatné pro aplikaci, organizace chce plně zřídit aplikace pro své zaměstnance.</span><span class="sxs-lookup"><span data-stu-id="353b4-179">Often, when an organization purchases a license or subscription for an application, the organization wants to fully provision the application for its employees.</span></span> <span data-ttu-id="353b4-180">V rámci tohoto procesu můžete udělit správce pro aplikaci zastupovat každý zaměstnanec souhlas.</span><span class="sxs-lookup"><span data-stu-id="353b4-180">As part of this process, an administrator can grant consent for the application to act on behalf of any employee.</span></span> <span data-ttu-id="353b4-181">Pokud správce uděluje souhlas pro celý klienta, nebude organizace zaměstnanci zobrazit stránka s souhlasu pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="353b4-181">If the admin grants consent for the entire tenant, the organization's employees won't see a consent page for the application.</span></span>

<span data-ttu-id="353b4-182">Pro vyžádání souhlasu pro všechny uživatele v klientovi, může vaše aplikace používá koncový bod admin souhlasu.</span><span class="sxs-lookup"><span data-stu-id="353b4-182">To request consent for all users in a tenant, your app can use the admin consent endpoint.</span></span>

## <a name="admin-restricted-scopes"></a><span data-ttu-id="353b4-183">Správce omezený oborů</span><span class="sxs-lookup"><span data-stu-id="353b4-183">Admin-restricted scopes</span></span>
<span data-ttu-id="353b4-184">Některé vysoká oprávnění v ekosystému Microsoft může být nastaven na *omezený správce*.</span><span class="sxs-lookup"><span data-stu-id="353b4-184">Some high-privilege permissions in the Microsoft ecosystem can be set to *admin-restricted*.</span></span> <span data-ttu-id="353b4-185">Příklady těchto druhů obory jsou následující oprávnění:</span><span class="sxs-lookup"><span data-stu-id="353b4-185">Examples of these kinds of scopes include the following permissions:</span></span>

* <span data-ttu-id="353b4-186">Čtení dat adresáře organizace pomocí`Directory.Read`</span><span class="sxs-lookup"><span data-stu-id="353b4-186">Read an organization's directory data by using `Directory.Read`</span></span>
* <span data-ttu-id="353b4-187">Zapisovat data do adresáře organizace pomocí`Directory.ReadWrite`</span><span class="sxs-lookup"><span data-stu-id="353b4-187">Write data to an organization's directory by using `Directory.ReadWrite`</span></span>
* <span data-ttu-id="353b4-188">Číst pomocí skupin zabezpečení v adresáři organizace`Groups.Read.All`</span><span class="sxs-lookup"><span data-stu-id="353b4-188">Read security groups in an organization's directory by using `Groups.Read.All`</span></span>

<span data-ttu-id="353b4-189">I když uživatel příjemce může udělit přístup aplikace k tomuto typu dat, jsou omezené na organizační uživatele z udělení přístupu k stejnou sadu citlivá firemní data.</span><span class="sxs-lookup"><span data-stu-id="353b4-189">Although a consumer user might grant an application access to this kind of data, organizational users are restricted from granting access to the same set of sensitive company data.</span></span> <span data-ttu-id="353b4-190">Pokud vaše aplikace požaduje přístup k jednomu z těchto oprávnění od organizace uživatele, uživatel obdrží chybovou zprávu s upozorněním, že uživatel nemá oprávnění k souhlas oprávnění vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-190">If your application requests access to one of these permissions from an organizational user, the user receives an error message that says they are not authorized to consent to your app's permissions.</span></span>

<span data-ttu-id="353b4-191">Pokud vaše aplikace vyžaduje přístup k omezeným správce obory pro organizace, měli byste požádat o je přímo ze Správce společnosti, také pomocí koncového bodu souhlas správce, který je popsána dále.</span><span class="sxs-lookup"><span data-stu-id="353b4-191">If your app requires access to admin-restricted scopes for organizations, you should request them directly from a company administrator, also by using the admin consent endpoint, described next.</span></span>

<span data-ttu-id="353b4-192">Když správce uděluje oprávnění prostřednictvím koncový bod admin souhlasu, je pro všechny uživatele v klientovi udělen souhlas.</span><span class="sxs-lookup"><span data-stu-id="353b4-192">When an administrator grants these permissions via the admin consent endpoint, consent is granted for all users in the tenant.</span></span>

## <a name="using-the-admin-consent-endpoint"></a><span data-ttu-id="353b4-193">Pomocí koncový bod admin souhlasu</span><span class="sxs-lookup"><span data-stu-id="353b4-193">Using the admin consent endpoint</span></span>
<span data-ttu-id="353b4-194">Pokud budete postupovat podle těchto kroků, vaše aplikace může shromažďovat oprávnění pro všechny uživatele v klientovi, včetně správce omezený obory.</span><span class="sxs-lookup"><span data-stu-id="353b4-194">If you follow these steps, your app can gather permissions for all users in a tenant, including admin-restricted scopes.</span></span> <span data-ttu-id="353b4-195">Ukázka kódu, který implementuje kroky najdete v sekci [omezený správce obory ukázka](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span><span class="sxs-lookup"><span data-stu-id="353b4-195">To see a code sample that implements the steps, see the [admin-restricted scopes sample](https://github.com/Azure-Samples/active-directory-dotnet-admin-restricted-scopes-v2).</span></span>

### <a name="request-the-permissions-in-the-app-registration-portal"></a><span data-ttu-id="353b4-196">Žádostí o oprávnění v portálu pro registraci aplikace</span><span class="sxs-lookup"><span data-stu-id="353b4-196">Request the permissions in the app registration portal</span></span>
1. <span data-ttu-id="353b4-197">Přejděte do vaší aplikace v [portálu pro registraci aplikace](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), nebo [vytvořit aplikaci](active-directory-v2-app-registration.md) Pokud jste tak ještě neučinili.</span><span class="sxs-lookup"><span data-stu-id="353b4-197">Go to your application in the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList), or [create an app](active-directory-v2-app-registration.md) if you haven't already.</span></span>
2. <span data-ttu-id="353b4-198">Vyhledejte **Microsoft Graph oprávnění** části a poté přidejte oprávnění, která vaše aplikace vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="353b4-198">Locate the **Microsoft Graph Permissions** section, and then add the permissions that your app requires.</span></span>
3. <span data-ttu-id="353b4-199">Ověřte, že je **Uložit** registrace aplikací.</span><span class="sxs-lookup"><span data-stu-id="353b4-199">Make sure you **Save** the app registration.</span></span>

### <a name="recommended-sign-the-user-in-to-your-app"></a><span data-ttu-id="353b4-200">Doporučená: Uživatele přihlaste do aplikace</span><span class="sxs-lookup"><span data-stu-id="353b4-200">Recommended: Sign the user in to your app</span></span>
<span data-ttu-id="353b4-201">Obvykle když vytvoříte aplikaci, která používá koncový bod admin souhlasu, aplikace musí stránku nebo zobrazení, ve kterém můžete schválit správce oprávnění aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-201">Typically, when you build an application that uses the admin consent endpoint, the app needs a page or view in which the admin can approve the app's permissions.</span></span> <span data-ttu-id="353b4-202">Tato stránka může být součástí procesu registrace tok aplikace, součást aplikace nastavení, nebo může být vyhrazený "připojit" toku.</span><span class="sxs-lookup"><span data-stu-id="353b4-202">This page can be part of the app's sign-up flow, part of the app's settings, or it can be a dedicated "connect" flow.</span></span> <span data-ttu-id="353b4-203">V mnoha případech má smysl pro aplikaci Ukážeme vám to "připojit" Zobrazit pouze po je uživatel přihlášený pomocí pracovního nebo školního účtu Microsoft.</span><span class="sxs-lookup"><span data-stu-id="353b4-203">In many cases, it makes sense for the app to show this "connect" view only after a user has signed in with a work or school Microsoft account.</span></span>

<span data-ttu-id="353b4-204">Při přihlášení uživatele k aplikaci, můžete určit organizaci, ke kterému patří správce před výzvou ke schválení potřebná oprávnění.</span><span class="sxs-lookup"><span data-stu-id="353b4-204">When you sign the user in to your app, you can identify the organization to which the admin belongs before asking them to approve the necessary permissions.</span></span> <span data-ttu-id="353b4-205">I když je to nezbytně nutné, ho můžete vytvořit více intuitivní prostředí pro organizační uživatele.</span><span class="sxs-lookup"><span data-stu-id="353b4-205">Although not strictly necessary, it can help you create a more intuitive experience for your organizational users.</span></span> <span data-ttu-id="353b4-206">Při přihlášení uživatele ve, postupujte podle našich [v2.0 protokol kurzy](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="353b4-206">To sign the user in, follow our [v2.0 protocol tutorials](active-directory-v2-protocols.md).</span></span>

### <a name="request-the-permissions-from-a-directory-admin"></a><span data-ttu-id="353b4-207">Požádat správce directory oprávnění</span><span class="sxs-lookup"><span data-stu-id="353b4-207">Request the permissions from a directory admin</span></span>
<span data-ttu-id="353b4-208">Až budete připraveni s žádostí o oprávnění z správce vaší organizace, můžete přesměruje uživatele na v2.0 *koncový bod admin souhlasu*.</span><span class="sxs-lookup"><span data-stu-id="353b4-208">When you're ready to request permissions from your organization's admin, you can redirect the user to the v2.0 *admin consent endpoint*.</span></span>

```
// Line breaks are for legibility only.

GET https://login.microsoftonline.com/{tenant}/adminconsent?
client_id=6731de76-14a6-49ae-97bc-6eba6914391e
&state=12345
&redirect_uri=http://localhost/myapp/permissions
```

```
// Pro tip: Try pasting the below request in a browser!
```

```
https://login.microsoftonline.com/common/adminconsent?client_id=6731de76-14a6-49ae-97bc-6eba6914391e&state=12345&redirect_uri=http://localhost/myapp/permissions
```

| <span data-ttu-id="353b4-209">Parametr</span><span class="sxs-lookup"><span data-stu-id="353b4-209">Parameter</span></span> | <span data-ttu-id="353b4-210">Podmínka</span><span class="sxs-lookup"><span data-stu-id="353b4-210">Condition</span></span> | <span data-ttu-id="353b4-211">Popis</span><span class="sxs-lookup"><span data-stu-id="353b4-211">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="353b4-212">Klienta</span><span class="sxs-lookup"><span data-stu-id="353b4-212">tenant</span></span> |<span data-ttu-id="353b4-213">Požaduje se</span><span class="sxs-lookup"><span data-stu-id="353b4-213">Required</span></span> |<span data-ttu-id="353b4-214">Adresář klienta, který chcete, aby žádala o oprávnění z.</span><span class="sxs-lookup"><span data-stu-id="353b4-214">The directory tenant that you want to request permission from.</span></span> <span data-ttu-id="353b4-215">Lze zadat ve formátu popisný název nebo identifikátor GUID.</span><span class="sxs-lookup"><span data-stu-id="353b4-215">Can be provided in GUID or friendly name format.</span></span> |
| <span data-ttu-id="353b4-216">client_id</span><span class="sxs-lookup"><span data-stu-id="353b4-216">client_id</span></span> |<span data-ttu-id="353b4-217">Požaduje se</span><span class="sxs-lookup"><span data-stu-id="353b4-217">Required</span></span> |<span data-ttu-id="353b4-218">ID aplikace, která [portálu pro registraci aplikace](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) přiřazené vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="353b4-218">The Application ID that the [Application Registration Portal](https://apps.dev.microsoft.com/?referrer=https://azure.microsoft.com/documentation/articles&deeplink=/appList) assigned to your app.</span></span> |
| <span data-ttu-id="353b4-219">redirect_uri</span><span class="sxs-lookup"><span data-stu-id="353b4-219">redirect_uri</span></span> |<span data-ttu-id="353b4-220">Požaduje se</span><span class="sxs-lookup"><span data-stu-id="353b4-220">Required</span></span> |<span data-ttu-id="353b4-221">Identifikátor URI přesměrování místo odpověď k odeslání pro vaši aplikaci pro zpracování.</span><span class="sxs-lookup"><span data-stu-id="353b4-221">The redirect URI where you want the response to be sent for your app to handle.</span></span> <span data-ttu-id="353b4-222">Se musí přesně shodovat s jedním přesměrování identifikátory URI, který je zaregistrovaný v portálu pro registraci aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-222">It must exactly match one of the redirect URIs that you registered in the app registration portal.</span></span> |
| <span data-ttu-id="353b4-223">state</span><span class="sxs-lookup"><span data-stu-id="353b4-223">state</span></span> |<span data-ttu-id="353b4-224">Doporučené</span><span class="sxs-lookup"><span data-stu-id="353b4-224">Recommended</span></span> |<span data-ttu-id="353b4-225">Hodnota, zahrnuté v požadavku, který bude vrácen také v odpovědi tokenu.</span><span class="sxs-lookup"><span data-stu-id="353b4-225">A value included in the request that will also be returned in the token response.</span></span> <span data-ttu-id="353b4-226">Může být řetězec o délce požadovaný obsah.</span><span class="sxs-lookup"><span data-stu-id="353b4-226">It can be a string of any content you want.</span></span> <span data-ttu-id="353b4-227">Použijte ke kódování informace o stavu uživatele v aplikaci, než k žádosti o ověření, například stránky nebo zobrazení, které byly na stav.</span><span class="sxs-lookup"><span data-stu-id="353b4-227">Use the state to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |

<span data-ttu-id="353b4-228">V tomto okamžiku Azure AD vyžaduje správce klienta se přihlásit k dokončení požadavku.</span><span class="sxs-lookup"><span data-stu-id="353b4-228">At this point, Azure AD requires a tenant administrator to sign in to complete the request.</span></span> <span data-ttu-id="353b4-229">Správce se zobrazí výzva ke schválení všechna oprávnění, které jste požadovali pro aplikaci v portálu pro registraci aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-229">The administrator is asked to approve all the permissions that you have requested for your app in the app registration portal.</span></span>

#### <a name="successful-response"></a><span data-ttu-id="353b4-230">Úspěšná odpověď</span><span class="sxs-lookup"><span data-stu-id="353b4-230">Successful response</span></span>
<span data-ttu-id="353b4-231">Pokud správce schválí oprávnění pro vaši aplikaci, úspěšné odpovědi vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="353b4-231">If the admin approves the permissions for your app, the successful response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?tenant=a8990e1f-ff32-408a-9f8e-78d3b9139b95&state=state=12345&admin_consent=True
```

| <span data-ttu-id="353b4-232">Parametr</span><span class="sxs-lookup"><span data-stu-id="353b4-232">Parameter</span></span> | <span data-ttu-id="353b4-233">Popis</span><span class="sxs-lookup"><span data-stu-id="353b4-233">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="353b4-234">Klienta</span><span class="sxs-lookup"><span data-stu-id="353b4-234">tenant</span></span> |<span data-ttu-id="353b4-235">Adresář klienta, který udělena oprávnění, která byla požadována ve formátu GUID aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-235">The directory tenant that granted your application the permissions it requested, in GUID format.</span></span> |
| <span data-ttu-id="353b4-236">state</span><span class="sxs-lookup"><span data-stu-id="353b4-236">state</span></span> |<span data-ttu-id="353b4-237">Hodnota, zahrnuté v požadavku, který bude také vrácen v odpovědi tokenu.</span><span class="sxs-lookup"><span data-stu-id="353b4-237">A value included in the request that also will be returned in the token response.</span></span> <span data-ttu-id="353b4-238">Může být řetězec o délce požadovaný obsah.</span><span class="sxs-lookup"><span data-stu-id="353b4-238">It can be a string of any content you want.</span></span> <span data-ttu-id="353b4-239">Stav se používá ke kódování informace o stavu uživatele v aplikaci, než k žádosti o ověření, například stránky nebo zobrazení, které byly na.</span><span class="sxs-lookup"><span data-stu-id="353b4-239">The state is used to encode information about the user's state in the app before the authentication request occurred, such as the page or view they were on.</span></span> |
| <span data-ttu-id="353b4-240">admin_consent</span><span class="sxs-lookup"><span data-stu-id="353b4-240">admin_consent</span></span> |<span data-ttu-id="353b4-241">Bude nastavena pro **true**.</span><span class="sxs-lookup"><span data-stu-id="353b4-241">Will be set to **true**.</span></span> |

#### <a name="error-response"></a><span data-ttu-id="353b4-242">Chybové odpovědi</span><span class="sxs-lookup"><span data-stu-id="353b4-242">Error response</span></span>
<span data-ttu-id="353b4-243">Pokud správce nebude schvalovat oprávnění pro aplikace, se nezdařilo odpověď vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="353b4-243">If the admin does not approve the permissions for your app, the failed response looks like this:</span></span>

```
GET http://localhost/myapp/permissions?error=permission_denied&error_description=The+admin+canceled+the+request
```

| <span data-ttu-id="353b4-244">Parametr</span><span class="sxs-lookup"><span data-stu-id="353b4-244">Parameter</span></span> | <span data-ttu-id="353b4-245">Popis</span><span class="sxs-lookup"><span data-stu-id="353b4-245">Description</span></span> |
| --- | --- | --- |
| <span data-ttu-id="353b4-246">error</span><span class="sxs-lookup"><span data-stu-id="353b4-246">error</span></span> |<span data-ttu-id="353b4-247">Řetězec kódu chyby, který můžete použít ke klasifikaci typů chyb, ke kterým došlo a slouží k reagovat na chyby.</span><span class="sxs-lookup"><span data-stu-id="353b4-247">An error code string that can be used to classify types of errors that occur, and can be used to react to errors.</span></span> |
| <span data-ttu-id="353b4-248">error_description</span><span class="sxs-lookup"><span data-stu-id="353b4-248">error_description</span></span> |<span data-ttu-id="353b4-249">Konkrétní chybová zpráva, která může pomoci vývojář určit hlavní příčinu chyby.</span><span class="sxs-lookup"><span data-stu-id="353b4-249">A specific error message that can help a developer identify the root cause of an error.</span></span> |

<span data-ttu-id="353b4-250">Po přijetí úspěšná odpověď z koncového bodu souhlas správce má oprávnění, která byla požadována získávají aplikace.</span><span class="sxs-lookup"><span data-stu-id="353b4-250">After you've received a successful response from the admin consent endpoint, your app has gained the permissions it requested.</span></span> <span data-ttu-id="353b4-251">Dále může požádat o token pro prostředek, který chcete.</span><span class="sxs-lookup"><span data-stu-id="353b4-251">Next, you can request a token for the resource you want.</span></span>

## <a name="using-permissions"></a><span data-ttu-id="353b4-252">Použití oprávnění</span><span class="sxs-lookup"><span data-stu-id="353b4-252">Using permissions</span></span>
<span data-ttu-id="353b4-253">Jakmile uživatel souhlasí oprávnění pro vaši aplikaci, vaše aplikace můžete získat přístupové tokeny, které představují vaší aplikace oprávnění pro přístup k prostředkům v některé kapacity.</span><span class="sxs-lookup"><span data-stu-id="353b4-253">After the user consents to permissions for your app, your app can acquire access tokens that represent your app's permission to access a resource in some capacity.</span></span> <span data-ttu-id="353b4-254">Přístupový token lze použít pouze pro jediný zdroj, ale kódovaný uvnitř přístupový token je každý oprávnění, kterému byla udělena vaší aplikace pro tento prostředek.</span><span class="sxs-lookup"><span data-stu-id="353b4-254">An access token can be used only for a single resource, but encoded inside the access token is every permission that your app has been granted for that resource.</span></span> <span data-ttu-id="353b4-255">Získat přístupový token aplikace se obrátit na token koncový bod v2.0, například takto:</span><span class="sxs-lookup"><span data-stu-id="353b4-255">To acquire an access token, your app can make a request to the v2.0 token endpoint, like this:</span></span>

```
POST common/oauth2/v2.0/token HTTP/1.1
Host: https://login.microsoftonline.com
Content-Type: application/json

{
    "grant_type": "authorization_code",
    "client_id": "6731de76-14a6-49ae-97bc-6eba6914391e",
    "scope": "https://outlook.office.com/mail.read https://outlook.office.com/mail.send",
    "code": "AwABAAAAvPM1KaPlrEqdFSBzjqfTGBCmLdgfSTLEMPGYuNHSUYBrq..."
    "redirect_uri": "https://localhost/myapp",
    "client_secret": "zc53fwe80980293klaj9823"  // NOTE: Only required for web apps
}
```

<span data-ttu-id="353b4-256">Výsledný token přístupu můžete použít v požadavcích HTTP k prostředku.</span><span class="sxs-lookup"><span data-stu-id="353b4-256">You can use the resulting access token in HTTP requests to the resource.</span></span> <span data-ttu-id="353b4-257">Spolehlivě označuje k prostředku, že aplikace má správná oprávnění k provedení určitého úkolu.</span><span class="sxs-lookup"><span data-stu-id="353b4-257">It reliably indicates to the resource that your app has the proper permission to perform a specific task.</span></span>  

<span data-ttu-id="353b4-258">Další informace o protokolu OAuth 2.0 a jak získat přístupové tokeny, najdete v článku [referenci na protokol koncový bod v2.0](active-directory-v2-protocols.md).</span><span class="sxs-lookup"><span data-stu-id="353b4-258">For more information about the OAuth 2.0 protocol and how to get access tokens, see the [v2.0 endpoint protocol reference](active-directory-v2-protocols.md).</span></span>

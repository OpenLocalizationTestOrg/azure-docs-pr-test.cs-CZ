---
title: "Azure AD Connect: Jak omezit toorecover z LocalDB 10GB problém | Microsoft Docs"
description: "Toto téma popisuje, jak toorecover synchronizace Azure AD Connect služby zjistí LocalDB 10GB-li omezit problém."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 7b8ce6e19b68837639017bb0315eda4b924d525a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="azure-ad-connect-how-toorecover-from-localdb-10-gb-limit"></a><span data-ttu-id="e9472-103">Azure AD Connect: Jak toorecover z limitu LocalDB 10 GB</span><span class="sxs-lookup"><span data-stu-id="e9472-103">Azure AD Connect: How toorecover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="e9472-104">Azure AD Connect vyžaduje dat identity toostore databáze systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="e9472-104">Azure AD Connect requires a SQL Server database toostore identity data.</span></span> <span data-ttu-id="e9472-105">Můžete buď použít výchozí hello, SQL Server 2012 Express LocalDB nainstalované službou Azure AD Connect, nebo použijte vlastní úplné SQL.</span><span class="sxs-lookup"><span data-stu-id="e9472-105">You can either use hello default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="e9472-106">SQL Server Express má omezení velikosti 10 GB.</span><span class="sxs-lookup"><span data-stu-id="e9472-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="e9472-107">Pokud při použití LocalDB dosáhnete tohoto limitu, synchronizační služba Azure AD Connect se už nemůže spustit ani správně synchronizovat.</span><span class="sxs-lookup"><span data-stu-id="e9472-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="e9472-108">Tento článek obsahuje kroky obnovení hello.</span><span class="sxs-lookup"><span data-stu-id="e9472-108">This article provides hello recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="e9472-109">Příznaky</span><span class="sxs-lookup"><span data-stu-id="e9472-109">Symptoms</span></span>
<span data-ttu-id="e9472-110">Existují dvě běžné příznaky:</span><span class="sxs-lookup"><span data-stu-id="e9472-110">There are two common symptoms:</span></span>

* <span data-ttu-id="e9472-111">Služba Azure AD Connect synchronizace **běží** ale selže toosynchronize s *"zastavena database-disk-full (úplné)* chyby.</span><span class="sxs-lookup"><span data-stu-id="e9472-111">Azure AD Connect Synchronization Service **is running** but fails toosynchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="e9472-112">Služba Azure AD Connect synchronizace **je nelze toostart**.</span><span class="sxs-lookup"><span data-stu-id="e9472-112">Azure AD Connect Synchronization Service **is unable toostart**.</span></span> <span data-ttu-id="e9472-113">Když zkusíte toostart hello služby, se nezdaří s událostí 6323 a chybovou zprávou *"hello serveru došlo k chybě systému SQL Server je nedostatek místa na disku."*</span><span class="sxs-lookup"><span data-stu-id="e9472-113">When you attempt toostart hello service, it fails with event 6323 and error message *"hello server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="e9472-114">Postup pro krátkodobé obnovení</span><span class="sxs-lookup"><span data-stu-id="e9472-114">Short-term recovery steps</span></span>
<span data-ttu-id="e9472-115">Tato část obsahuje hello kroky tooreclaim DB místo požadované pro službu Azure AD Connect synchronizace tooresume operaci.</span><span class="sxs-lookup"><span data-stu-id="e9472-115">This section provides hello steps tooreclaim DB space required for Azure AD Connect Synchronization Service tooresume operation.</span></span> <span data-ttu-id="e9472-116">Hello krokům patří:</span><span class="sxs-lookup"><span data-stu-id="e9472-116">hello steps include:</span></span>
1. [<span data-ttu-id="e9472-117">Zjistit stav služby synchronizace hello</span><span class="sxs-lookup"><span data-stu-id="e9472-117">Determine hello Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="e9472-118">Zmenšení hello databáze</span><span class="sxs-lookup"><span data-stu-id="e9472-118">Shrink hello database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="e9472-119">Odstranění spustit data historie</span><span class="sxs-lookup"><span data-stu-id="e9472-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="e9472-120">Zkrátit dobu uchování historie spouštění dat</span><span class="sxs-lookup"><span data-stu-id="e9472-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-hello-synchronization-service-status"></a><span data-ttu-id="e9472-121">Zjistit stav služby synchronizace hello</span><span class="sxs-lookup"><span data-stu-id="e9472-121">Determine hello Synchronization Service status</span></span>
<span data-ttu-id="e9472-122">Nejdřív zjistěte, zda hello synchronizační služba je stále spuštěn, nebo není:</span><span class="sxs-lookup"><span data-stu-id="e9472-122">First, determine whether hello Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="e9472-123">Přihlaste se tooyour server Azure AD Connect jako správce.</span><span class="sxs-lookup"><span data-stu-id="e9472-123">Log in tooyour Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="e9472-124">Přejděte příliš**správce řízení služeb**.</span><span class="sxs-lookup"><span data-stu-id="e9472-124">Go too**Service Control Manager**.</span></span>

3. <span data-ttu-id="e9472-125">Zkontrolujte stav hello **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="e9472-125">Check hello status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="e9472-126">Pokud je spuštěná, zastavte nebo restartujte službu hello.</span><span class="sxs-lookup"><span data-stu-id="e9472-126">If it is running, do not stop or restart hello service.</span></span> <span data-ttu-id="e9472-127">Přeskočit [zmenšení hello databáze](#shrink-the-database) krok a přejděte příliš[odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="e9472-127">Skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="e9472-128">Pokud není spuštěna, zkuste toostart hello služby.</span><span class="sxs-lookup"><span data-stu-id="e9472-128">If it is not running, try toostart hello service.</span></span> <span data-ttu-id="e9472-129">Pokud služba hello spustí úspěšně, přeskočte [zmenšení hello databáze](#shrink-the-database) krok a přejděte příliš[odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="e9472-129">If hello service starts successfully, skip [Shrink hello database](#shrink-the-database) step and go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="e9472-130">Jinak, pokračujte [zmenšení hello databáze](#shrink-the-database) krok.</span><span class="sxs-lookup"><span data-stu-id="e9472-130">Otherwise, continue with [Shrink hello database](#shrink-the-database) step.</span></span>

### <a name="shrink-hello-database"></a><span data-ttu-id="e9472-131">Zmenšení hello databáze</span><span class="sxs-lookup"><span data-stu-id="e9472-131">Shrink hello database</span></span>
<span data-ttu-id="e9472-132">Použijte toofree operace zmenšení hello až dostatek DB místo toostart hello synchronizační služba.</span><span class="sxs-lookup"><span data-stu-id="e9472-132">Use hello Shrink operation toofree up enough DB space toostart hello Synchronization Service.</span></span> <span data-ttu-id="e9472-133">Se uvolní místo DB odebráním prázdné znaky v databázi hello.</span><span class="sxs-lookup"><span data-stu-id="e9472-133">It frees up DB space by removing whitespaces in hello database.</span></span> <span data-ttu-id="e9472-134">Tento krok je typu best effort, protože není zaručeno, lze vždy zotavit prostor.</span><span class="sxs-lookup"><span data-stu-id="e9472-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="e9472-135">toolearn Další informace o operaci zmenšení, přečtěte si tento článek [zmenšit databázi](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="e9472-135">toolearn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="e9472-136">Tento krok přeskočte, pokud vám toorun hello synchronizační služba.</span><span class="sxs-lookup"><span data-stu-id="e9472-136">Skip this step if you can get hello Synchronization Service toorun.</span></span> <span data-ttu-id="e9472-137">Jak může vést toopoor výkonu z důvodu tooincreased fragmentace se nedoporučuje tooshrink hello databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="e9472-137">It is not recommended tooshrink hello SQL DB as it can lead toopoor performance due tooincreased fragmentation.</span></span>

<span data-ttu-id="e9472-138">Název Hello hello databáze vytvořené pro Azure AD Connect je **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="e9472-138">hello name of hello database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="e9472-139">tooperform operace zmenšení, musíte být přihlášení jako hello sysadmin nebo vlastník databáze hello databáze.</span><span class="sxs-lookup"><span data-stu-id="e9472-139">tooperform a Shrink operation, you must log in either as hello sysadmin or DBO of hello database.</span></span> <span data-ttu-id="e9472-140">Během instalace služby Azure AD Connect hello následující účty jsou udělena práva správce systému:</span><span class="sxs-lookup"><span data-stu-id="e9472-140">During Azure AD Connect installation, hello following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="e9472-141">Místní správci</span><span class="sxs-lookup"><span data-stu-id="e9472-141">Local Administrators</span></span>
* <span data-ttu-id="e9472-142">Hello uživatelský účet, který byl instalace použité toorun Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="e9472-142">hello user account that was used toorun Azure AD Connect installation.</span></span>
* <span data-ttu-id="e9472-143">Hello účet synchronizační služby, který se používá jako hello operační kontext služby Azure AD Connect synchronizace.</span><span class="sxs-lookup"><span data-stu-id="e9472-143">hello Sync Service account that is used as hello operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="e9472-144">Hello místní skupiny ADSyncAdmins, který byl vytvořen během instalace.</span><span class="sxs-lookup"><span data-stu-id="e9472-144">hello local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="e9472-145">Zálohování databáze hello zkopírováním **ADSync.mdf** a **ADSync_log.ldf** soubory umístěné v `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa bezpečného umístění.</span><span class="sxs-lookup"><span data-stu-id="e9472-145">Back up hello database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` tooa safe location.</span></span>

2. <span data-ttu-id="e9472-146">Spusťte novou relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e9472-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="e9472-147">Přejděte toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="e9472-147">Navigate toofolder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="e9472-148">Spustit **sqlcmd** nástroj spuštěním příkazu hello `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, pomocí hello přihlašovací údaje správce systému nebo hello databáze DBO.</span><span class="sxs-lookup"><span data-stu-id="e9472-148">Start **sqlcmd** utility by running hello command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using hello credential of a sysadmin or hello database DBO.</span></span>

5. <span data-ttu-id="e9472-149">tooshrink hello databáze, v příkazovém řádku sqlcmd hello (1 >), zadejte `DBCC Shrinkdatabase(ADSync,1);`, za nímž následují `GO` v dalším řádku hello.</span><span class="sxs-lookup"><span data-stu-id="e9472-149">tooshrink hello database, at hello sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in hello next line.</span></span>

6. <span data-ttu-id="e9472-150">Pokud je hello operace úspěšná, opakujte toostart hello synchronizační služba.</span><span class="sxs-lookup"><span data-stu-id="e9472-150">If hello operation is successful, try toostart hello Synchronization Service again.</span></span> <span data-ttu-id="e9472-151">Pokud budete moct začít hello synchronizační služby, přejděte příliš[odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="e9472-151">If you can start hello Synchronization Service, go too[Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="e9472-152">Pokud ne, obraťte se na podporu.</span><span class="sxs-lookup"><span data-stu-id="e9472-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="e9472-153">Odstranění spustit data historie</span><span class="sxs-lookup"><span data-stu-id="e9472-153">Delete run history data</span></span>
<span data-ttu-id="e9472-154">Ve výchozím nastavení Azure AD Connect zachová až data historie spouštění za tooseven dnů.</span><span class="sxs-lookup"><span data-stu-id="e9472-154">By default, Azure AD Connect retains up tooseven days’ worth of run history data.</span></span> <span data-ttu-id="e9472-155">V tomto kroku jsme odstranit hello spustit místo tooreclaim DB data historie tak, aby služba Azure AD Connect synchronizaci můžete spustit synchronizaci opakovat.</span><span class="sxs-lookup"><span data-stu-id="e9472-155">In this step, we delete hello run history data tooreclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="e9472-156">Spustit **Synchronization Service Manager** podle přejdete → tooSTART synchronizační služba.</span><span class="sxs-lookup"><span data-stu-id="e9472-156">Start **Synchronization Service Manager** by going tooSTART → Synchronization Service.</span></span>

2.  <span data-ttu-id="e9472-157">Přejděte toohello **Operations** kartě.</span><span class="sxs-lookup"><span data-stu-id="e9472-157">Go toohello **Operations** tab.</span></span>

3.  <span data-ttu-id="e9472-158">V části **akce**, vyberte **zrušte spustí**...</span><span class="sxs-lookup"><span data-stu-id="e9472-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="e9472-159">Můžete buď zvolit **vymazat všechny spustí** nebo **Clear spuštěná před... <date>**  možnost.</span><span class="sxs-lookup"><span data-stu-id="e9472-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="e9472-160">Doporučuje se spustíte tak, že smažete spustit historie data, která jsou starší než dvou dnů.</span><span class="sxs-lookup"><span data-stu-id="e9472-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="e9472-161">Pokud budete pokračovat toorun do DB velikost problém, zvolte hello **vymazat všechny spustí** možnost.</span><span class="sxs-lookup"><span data-stu-id="e9472-161">If you continue toorun into DB size issue, then choose hello **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="e9472-162">Zkrátit dobu uchování historie spouštění dat</span><span class="sxs-lookup"><span data-stu-id="e9472-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="e9472-163">Tento krok je tooreduce hello pravděpodobnost vzniku hello k problému s limitem 10 GB po několik synchronizačních cyklů.</span><span class="sxs-lookup"><span data-stu-id="e9472-163">This step is tooreduce hello likelihood of running into hello 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="e9472-164">Otevřete novou relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="e9472-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="e9472-165">Spustit `Get-ADSyncScheduler` a poznamenejte si hello PurgeRunHistoryInterval vlastnosti, která určuje hello aktuální dobu uchování.</span><span class="sxs-lookup"><span data-stu-id="e9472-165">Run `Get-ADSyncScheduler` and take note of hello PurgeRunHistoryInterval property, which specifies hello current retention period.</span></span>

3. <span data-ttu-id="e9472-166">Spustit `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello uchování období tootwo dnů.</span><span class="sxs-lookup"><span data-stu-id="e9472-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` tooset hello retention period tootwo days.</span></span> <span data-ttu-id="e9472-167">Doba uchování hello podle potřeby upravte.</span><span class="sxs-lookup"><span data-stu-id="e9472-167">Adjust hello retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-toofull-sql"></a><span data-ttu-id="e9472-168">Dlouhodobé řešení – migrací toofull SQL</span><span class="sxs-lookup"><span data-stu-id="e9472-168">Long-term solution – Migrate toofull SQL</span></span>
<span data-ttu-id="e9472-169">Obecně platí, je problém hello naznačuje výslednou, že velikost 10 GB databáze již není dostatečná pro Azure AD Connect toosynchronize vaší místní služby Active Directory tooAzure AD.</span><span class="sxs-lookup"><span data-stu-id="e9472-169">In general, hello issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect toosynchronize your on-premises Active Directory tooAzure AD.</span></span> <span data-ttu-id="e9472-170">Doporučuje se, že jste přepnuli toousing hello plnou verzi systému SQL server.</span><span class="sxs-lookup"><span data-stu-id="e9472-170">It is recommended that you switch toousing hello full version of SQL server.</span></span> <span data-ttu-id="e9472-171">Hello LocalDB existujícího nasazení Azure AD Connect nelze nahradit přímo s databází hello hello úplné verze SQL.</span><span class="sxs-lookup"><span data-stu-id="e9472-171">You cannot directly replace hello LocalDB of an existing Azure AD Connect deployment with hello database of hello full version of SQL.</span></span> <span data-ttu-id="e9472-172">Místo toho je nutné nasadit nový server Azure AD Connect s hello plnou verzí systému SQL.</span><span class="sxs-lookup"><span data-stu-id="e9472-172">Instead, you must deploy a new Azure AD Connect server with hello full version of SQL.</span></span> <span data-ttu-id="e9472-173">Doporučuje se provést migraci dráha kde nasazení hello nový server Azure AD Connect (se databáze SQL) jako server pracovní další toohello existující server Azure AD Connect (se LocalDB).</span><span class="sxs-lookup"><span data-stu-id="e9472-173">It is recommended that you do a swing migration where hello new Azure AD Connect server (with SQL DB) is deployed as a staging server, next toohello existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="e9472-174">Pokyny k jak tooconfigure vzdálené SQL službou Azure AD Connect najdete tooarticle [vlastní instalace Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="e9472-174">For instruction on how tooconfigure remote SQL with Azure AD Connect, refer tooarticle [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="e9472-175">Pokyny pro migraci dráha pro upgrade Azure AD Connect, najdete v části tooarticle [Azure AD Connect: Upgrade z předchozí verze toohello nejnovější](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="e9472-175">For instructions on swing migration for Azure AD Connect upgrade, refer tooarticle [Azure AD Connect: Upgrade from a previous version toohello latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="e9472-176">Další kroky</span><span class="sxs-lookup"><span data-stu-id="e9472-176">Next steps</span></span>
<span data-ttu-id="e9472-177">Přečtěte si další informace o [Integrování místních identit do služby Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="e9472-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

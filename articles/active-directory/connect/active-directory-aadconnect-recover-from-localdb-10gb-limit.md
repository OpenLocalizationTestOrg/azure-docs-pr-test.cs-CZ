---
title: "Azure AD Connect: Jak obnovit LocalDB 10 GB limit problém | Microsoft Docs"
description: "Toto téma popisuje, jak obnovit službu Azure AD Connect synchronizace, pokud se setká s LocalDB 10GB omezit problém."
services: active-directory
documentationcenter: 
author: cychua
manager: femila
editor: 
ms.assetid: 41d081af-ed89-4e17-be34-14f7e80ae358
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/17/2017
ms.author: billmath
ms.openlocfilehash: 08e682c51b12d4506019d2f6b68e1eae0798b990
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="azure-ad-connect-how-to-recover-from-localdb-10-gb-limit"></a><span data-ttu-id="5afea-103">Azure AD Connect: Jak obnovit z limitu LocalDB 10 GB</span><span class="sxs-lookup"><span data-stu-id="5afea-103">Azure AD Connect: How to recover from LocalDB 10-GB limit</span></span>
<span data-ttu-id="5afea-104">Azure AD Connect vyžaduje k ukládání dat identity databázi SQL Serveru.</span><span class="sxs-lookup"><span data-stu-id="5afea-104">Azure AD Connect requires a SQL Server database to store identity data.</span></span> <span data-ttu-id="5afea-105">Můžete použít buď výchozí databázi SQL Server 2012 Express LocalDB nainstalovanou se službou Azure AD Connect, nebo vlastní plnou verzi SQL.</span><span class="sxs-lookup"><span data-stu-id="5afea-105">You can either use the default SQL Server 2012 Express LocalDB installed with Azure AD Connect or use your own full SQL.</span></span> <span data-ttu-id="5afea-106">SQL Server Express má omezení velikosti 10 GB.</span><span class="sxs-lookup"><span data-stu-id="5afea-106">SQL Server Express imposes a 10-GB size limit.</span></span> <span data-ttu-id="5afea-107">Pokud při použití LocalDB dosáhnete tohoto limitu, synchronizační služba Azure AD Connect se už nemůže spustit ani správně synchronizovat.</span><span class="sxs-lookup"><span data-stu-id="5afea-107">When using LocalDB and this limit is reached, Azure AD Connect Synchronization Service can no longer start or synchronize properly.</span></span> <span data-ttu-id="5afea-108">Tento článek obsahuje kroky obnovení.</span><span class="sxs-lookup"><span data-stu-id="5afea-108">This article provides the recovery steps.</span></span>

## <a name="symptoms"></a><span data-ttu-id="5afea-109">Příznaky</span><span class="sxs-lookup"><span data-stu-id="5afea-109">Symptoms</span></span>
<span data-ttu-id="5afea-110">Existují dvě běžné příznaky:</span><span class="sxs-lookup"><span data-stu-id="5afea-110">There are two common symptoms:</span></span>

* <span data-ttu-id="5afea-111">Služba Azure AD Connect synchronizace **běží** ale nepodaří synchronizovat s *"zastavena database-disk-full (úplné)* chyby.</span><span class="sxs-lookup"><span data-stu-id="5afea-111">Azure AD Connect Synchronization Service **is running** but fails to synchronize with *“stopped-database-disk-full”* error.</span></span>

* <span data-ttu-id="5afea-112">Služba Azure AD Connect synchronizace **nelze spustit**.</span><span class="sxs-lookup"><span data-stu-id="5afea-112">Azure AD Connect Synchronization Service **is unable to start**.</span></span> <span data-ttu-id="5afea-113">Při pokusu o spuštění služby nezdaří s událostí 6323 a chybovou zprávou *"serveru došlo k chybě systému SQL Server je nedostatek místa na disku."*</span><span class="sxs-lookup"><span data-stu-id="5afea-113">When you attempt to start the service, it fails with event 6323 and error message *"The server encountered an error because SQL Server is out of disk space."*</span></span>

## <a name="short-term-recovery-steps"></a><span data-ttu-id="5afea-114">Postup pro krátkodobé obnovení</span><span class="sxs-lookup"><span data-stu-id="5afea-114">Short-term recovery steps</span></span>
<span data-ttu-id="5afea-115">Tato část obsahuje kroky k uvolnění místa DB požadované pro službu Azure AD Connect synchronizace pro operace obnovení.</span><span class="sxs-lookup"><span data-stu-id="5afea-115">This section provides the steps to reclaim DB space required for Azure AD Connect Synchronization Service to resume operation.</span></span> <span data-ttu-id="5afea-116">Zahrnuje následující kroky:</span><span class="sxs-lookup"><span data-stu-id="5afea-116">The steps include:</span></span>
1. [<span data-ttu-id="5afea-117">Zjistit stav služby synchronizace</span><span class="sxs-lookup"><span data-stu-id="5afea-117">Determine the Synchronization Service status</span></span>](#determine-the-synchronization-service-status)
2. [<span data-ttu-id="5afea-118">Zmenšení databáze</span><span class="sxs-lookup"><span data-stu-id="5afea-118">Shrink the database</span></span>](#shrink-the-database)
3. [<span data-ttu-id="5afea-119">Odstranění spustit data historie</span><span class="sxs-lookup"><span data-stu-id="5afea-119">Delete run history data</span></span>](#delete-run-history-data)
4. [<span data-ttu-id="5afea-120">Zkrátit dobu uchování historie spouštění dat</span><span class="sxs-lookup"><span data-stu-id="5afea-120">Shorten retention period for run history data</span></span>](#shorten-retention-period-for-run-history-data)

### <a name="determine-the-synchronization-service-status"></a><span data-ttu-id="5afea-121">Zjistit stav služby synchronizace</span><span class="sxs-lookup"><span data-stu-id="5afea-121">Determine the Synchronization Service status</span></span>
<span data-ttu-id="5afea-122">Nejdřív zjistěte, zda je stále spuštěna služba synchronizace nebo není:</span><span class="sxs-lookup"><span data-stu-id="5afea-122">First, determine whether the Synchronization Service is still running or not:</span></span>

1. <span data-ttu-id="5afea-123">Přihlaste se k Azure AD Connect serveru jako správce.</span><span class="sxs-lookup"><span data-stu-id="5afea-123">Log in to your Azure AD Connect server as administrator.</span></span>

2. <span data-ttu-id="5afea-124">Přejděte na **správce řízení služeb**.</span><span class="sxs-lookup"><span data-stu-id="5afea-124">Go to **Service Control Manager**.</span></span>

3. <span data-ttu-id="5afea-125">Zkontrolujte stav **Microsoft Azure AD Sync**.</span><span class="sxs-lookup"><span data-stu-id="5afea-125">Check the status of **Microsoft Azure AD Sync**.</span></span>


4. <span data-ttu-id="5afea-126">Pokud je spuštěná, zastavte nebo restartujte službu.</span><span class="sxs-lookup"><span data-stu-id="5afea-126">If it is running, do not stop or restart the service.</span></span> <span data-ttu-id="5afea-127">Přeskočit [zmenšit databázi](#shrink-the-database) krok a přejděte na [odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="5afea-127">Skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span>

5. <span data-ttu-id="5afea-128">Pokud není spuštěný, pokuste se spustit službu.</span><span class="sxs-lookup"><span data-stu-id="5afea-128">If it is not running, try to start the service.</span></span> <span data-ttu-id="5afea-129">Pokud byla služba spuštěna úspěšně, přeskočte [zmenšit databázi](#shrink-the-database) krok a přejděte na [odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="5afea-129">If the service starts successfully, skip [Shrink the database](#shrink-the-database) step and go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="5afea-130">Jinak, pokračujte [zmenšit databázi](#shrink-the-database) krok.</span><span class="sxs-lookup"><span data-stu-id="5afea-130">Otherwise, continue with [Shrink the database](#shrink-the-database) step.</span></span>

### <a name="shrink-the-database"></a><span data-ttu-id="5afea-131">Zmenšení databáze</span><span class="sxs-lookup"><span data-stu-id="5afea-131">Shrink the database</span></span>
<span data-ttu-id="5afea-132">Pomocí operace zmenšení uvolní dostatek místa DB ke spuštění synchronizační služby.</span><span class="sxs-lookup"><span data-stu-id="5afea-132">Use the Shrink operation to free up enough DB space to start the Synchronization Service.</span></span> <span data-ttu-id="5afea-133">Se uvolní místo DB odebráním prázdné znaky v databázi.</span><span class="sxs-lookup"><span data-stu-id="5afea-133">It frees up DB space by removing whitespaces in the database.</span></span> <span data-ttu-id="5afea-134">Tento krok je typu best effort, protože není zaručeno, lze vždy zotavit prostor.</span><span class="sxs-lookup"><span data-stu-id="5afea-134">This step is best-effort as it is not guaranteed that you can always recover space.</span></span> <span data-ttu-id="5afea-135">Další informace o operaci zmenšení, přečtěte si tento článek [zmenšit databázi](https://msdn.microsoft.com/library/ms189035.aspx).</span><span class="sxs-lookup"><span data-stu-id="5afea-135">To learn more about Shrink operation, read this article [Shrink a database](https://msdn.microsoft.com/library/ms189035.aspx).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="5afea-136">Tento krok přeskočte, pokud vám synchronizační službu spustit.</span><span class="sxs-lookup"><span data-stu-id="5afea-136">Skip this step if you can get the Synchronization Service to run.</span></span> <span data-ttu-id="5afea-137">Není doporučeno zmenšit databázi SQL, protože může vést k nižšímu výkonu z důvodu vyšší fragmentace.</span><span class="sxs-lookup"><span data-stu-id="5afea-137">It is not recommended to shrink the SQL DB as it can lead to poor performance due to increased fragmentation.</span></span>

<span data-ttu-id="5afea-138">Název databáze vytvořené pro Azure AD Connect je **ADSync**.</span><span class="sxs-lookup"><span data-stu-id="5afea-138">The name of the database created for Azure AD Connect is **ADSync**.</span></span> <span data-ttu-id="5afea-139">K provedení operace zmenšení, musíte být přihlášení jako správce nebo vlastníka databáze.</span><span class="sxs-lookup"><span data-stu-id="5afea-139">To perform a Shrink operation, you must log in either as the sysadmin or DBO of the database.</span></span> <span data-ttu-id="5afea-140">Během instalace služby Azure AD Connect následující účty jsou udělena práva správce systému:</span><span class="sxs-lookup"><span data-stu-id="5afea-140">During Azure AD Connect installation, the following accounts are granted sysadmin rights:</span></span>
* <span data-ttu-id="5afea-141">Místní správci</span><span class="sxs-lookup"><span data-stu-id="5afea-141">Local Administrators</span></span>
* <span data-ttu-id="5afea-142">Uživatelský účet, který byl použit ke spuštění instalace služby Azure AD Connect.</span><span class="sxs-lookup"><span data-stu-id="5afea-142">The user account that was used to run Azure AD Connect installation.</span></span>
* <span data-ttu-id="5afea-143">Účet synchronizační služby, který se používá jako operační kontext služby Azure AD Connect synchronizace.</span><span class="sxs-lookup"><span data-stu-id="5afea-143">The Sync Service account that is used as the operating context of Azure AD Connect Synchronization Service.</span></span>
* <span data-ttu-id="5afea-144">Místní skupiny ADSyncAdmins, který byl vytvořen během instalace.</span><span class="sxs-lookup"><span data-stu-id="5afea-144">The local group ADSyncAdmins that was created during installation.</span></span>

1. <span data-ttu-id="5afea-145">Zálohovat databázi tak, že zkopírujete **ADSync.mdf** a **ADSync_log.ldf** soubory umístěné v `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` do bezpečného umístění.</span><span class="sxs-lookup"><span data-stu-id="5afea-145">Back up the database by copying **ADSync.mdf** and **ADSync_log.ldf** files located under `%ProgramFiles%\program files\Microsoft Azure AD Sync\Data` to a safe location.</span></span>

2. <span data-ttu-id="5afea-146">Spusťte novou relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5afea-146">Start a new PowerShell session.</span></span>

3. <span data-ttu-id="5afea-147">Přejděte do složky `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span><span class="sxs-lookup"><span data-stu-id="5afea-147">Navigate to folder `%ProgramFiles%\Program Files\Microsoft SQL Server\110\Tools\Binn`.</span></span>

4. <span data-ttu-id="5afea-148">Spustit **sqlcmd** nástroj spuštěním příkazu `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, pomocí přihlašovacích údajů správce systému nebo databázi DBO.</span><span class="sxs-lookup"><span data-stu-id="5afea-148">Start **sqlcmd** utility by running the command `./SQLCMD.EXE -S “(localdb)\.\ADSync” -U <Username> -P <Password>`, using the credential of a sysadmin or the database DBO.</span></span>

5. <span data-ttu-id="5afea-149">Zmenšení databáze příkazového řádku sqlcmd (1 >), zadejte `DBCC Shrinkdatabase(ADSync,1);`, za nímž následují `GO` v dalším řádku.</span><span class="sxs-lookup"><span data-stu-id="5afea-149">To shrink the database, at the sqlcmd prompt (1>), enter `DBCC Shrinkdatabase(ADSync,1);`, followed by `GO` in the next line.</span></span>

6. <span data-ttu-id="5afea-150">Pokud byla operace úspěšná, pokuste se znovu spustit službu synchronizace.</span><span class="sxs-lookup"><span data-stu-id="5afea-150">If the operation is successful, try to start the Synchronization Service again.</span></span> <span data-ttu-id="5afea-151">Pokud je možné spustit služba synchronizace, přejděte na [odstranění spustit data o historii](#delete-run-history-data) krok.</span><span class="sxs-lookup"><span data-stu-id="5afea-151">If you can start the Synchronization Service, go to [Delete run history data](#delete-run-history-data) step.</span></span> <span data-ttu-id="5afea-152">Pokud ne, obraťte se na podporu.</span><span class="sxs-lookup"><span data-stu-id="5afea-152">If not, contact Support.</span></span>

### <a name="delete-run-history-data"></a><span data-ttu-id="5afea-153">Odstranění spustit data historie</span><span class="sxs-lookup"><span data-stu-id="5afea-153">Delete run history data</span></span>
<span data-ttu-id="5afea-154">Ve výchozím nastavení Azure AD Connect zachová až do historie spouštění data za sedm dní.</span><span class="sxs-lookup"><span data-stu-id="5afea-154">By default, Azure AD Connect retains up to seven days’ worth of run history data.</span></span> <span data-ttu-id="5afea-155">V tomto kroku jsme odstranit data historie spouštění uvolnění místa DB tak, aby služba Azure AD Connect synchronizaci můžete spustit synchronizaci opakovat.</span><span class="sxs-lookup"><span data-stu-id="5afea-155">In this step, we delete the run history data to reclaim DB space so that Azure AD Connect Synchronization Service can start syncing again.</span></span>

1.  <span data-ttu-id="5afea-156">Spustit **Synchronization Service Manager** přechodem na spuštění → synchronizační služba.</span><span class="sxs-lookup"><span data-stu-id="5afea-156">Start **Synchronization Service Manager** by going to START → Synchronization Service.</span></span>

2.  <span data-ttu-id="5afea-157">Přejděte na **Operations** kartě.</span><span class="sxs-lookup"><span data-stu-id="5afea-157">Go to the **Operations** tab.</span></span>

3.  <span data-ttu-id="5afea-158">V části **akce**, vyberte **zrušte spustí**...</span><span class="sxs-lookup"><span data-stu-id="5afea-158">Under **Actions**, select **Clear Runs**…</span></span>

4.  <span data-ttu-id="5afea-159">Můžete buď zvolit **vymazat všechny spustí** nebo **Clear spuštěná před... <date>**  možnost.</span><span class="sxs-lookup"><span data-stu-id="5afea-159">You can either choose **Clear all runs** or **Clear runs before… <date>** option.</span></span> <span data-ttu-id="5afea-160">Doporučuje se spustíte tak, že smažete spustit historie data, která jsou starší než dvou dnů.</span><span class="sxs-lookup"><span data-stu-id="5afea-160">It is recommended that you start by clearing run history data that are older than two days.</span></span> <span data-ttu-id="5afea-161">Pokud budete pokračovat narazíte na problém velikost databáze, zvolte **vymazat všechny spustí** možnost.</span><span class="sxs-lookup"><span data-stu-id="5afea-161">If you continue to run into DB size issue, then choose the **Clear all runs** option.</span></span>

### <a name="shorten-retention-period-for-run-history-data"></a><span data-ttu-id="5afea-162">Zkrátit dobu uchování historie spouštění dat</span><span class="sxs-lookup"><span data-stu-id="5afea-162">Shorten retention period for run history data</span></span>
<span data-ttu-id="5afea-163">Tento krok je snížit pravděpodobnost vzniku problém 10 GB limit po několik cyklů synchronizace.</span><span class="sxs-lookup"><span data-stu-id="5afea-163">This step is to reduce the likelihood of running into the 10-GB limit issue after multiple sync cycles.</span></span>

1. <span data-ttu-id="5afea-164">Otevřete novou relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="5afea-164">Open a new PowerShell session.</span></span>

2. <span data-ttu-id="5afea-165">Spustit `Get-ADSyncScheduler` a poznamenejte si vlastnosti PurgeRunHistoryInterval, která určuje aktuální dobu uchování.</span><span class="sxs-lookup"><span data-stu-id="5afea-165">Run `Get-ADSyncScheduler` and take note of the PurgeRunHistoryInterval property, which specifies the current retention period.</span></span>

3. <span data-ttu-id="5afea-166">Spustit `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` nastavit dobu uchování do dvou dnů.</span><span class="sxs-lookup"><span data-stu-id="5afea-166">Run `Set-ADSyncScheduler -PurgeRunHistoryInterval 2.00:00:00` to set the retention period to two days.</span></span> <span data-ttu-id="5afea-167">Doba uchovávání informací podle potřeby upravte.</span><span class="sxs-lookup"><span data-stu-id="5afea-167">Adjust the retention period as appropriate.</span></span>

## <a name="long-term-solution--migrate-to-full-sql"></a><span data-ttu-id="5afea-168">Dlouhodobé řešení – migrace do úplné SQL</span><span class="sxs-lookup"><span data-stu-id="5afea-168">Long-term solution – Migrate to full SQL</span></span>
<span data-ttu-id="5afea-169">Problém je obecně naznačuje výslednou, že velikost 10 GB databáze již není dostatečná pro Azure AD Connect pro synchronizaci vaší místní služby Active Directory do Azure AD.</span><span class="sxs-lookup"><span data-stu-id="5afea-169">In general, the issue is indicative that 10-GB database size is no longer sufficient for Azure AD Connect to synchronize your on-premises Active Directory to Azure AD.</span></span> <span data-ttu-id="5afea-170">Doporučuje se, že přejdete na plnou verzi systému SQL server pomocí.</span><span class="sxs-lookup"><span data-stu-id="5afea-170">It is recommended that you switch to using the full version of SQL server.</span></span> <span data-ttu-id="5afea-171">Nemůžete LocalDB existujícího nasazení Azure AD Connect přímo nahradit databází plné verze SQL.</span><span class="sxs-lookup"><span data-stu-id="5afea-171">You cannot directly replace the LocalDB of an existing Azure AD Connect deployment with the database of the full version of SQL.</span></span> <span data-ttu-id="5afea-172">Místo toho je nutné nasadit nový server Azure AD Connect s plnou verzí SQL.</span><span class="sxs-lookup"><span data-stu-id="5afea-172">Instead, you must deploy a new Azure AD Connect server with the full version of SQL.</span></span> <span data-ttu-id="5afea-173">Doporučuje se provést postupnou migraci, kdy se nový server Azure AD Connect (s databází SQL) nasadí jako pracovní server vedle existujícího serveru Azure AD Connect (s LocalDB).</span><span class="sxs-lookup"><span data-stu-id="5afea-173">It is recommended that you do a swing migration where the new Azure AD Connect server (with SQL DB) is deployed as a staging server, next to the existing Azure AD Connect server (with LocalDB).</span></span> 
* <span data-ttu-id="5afea-174">Pokyny ke konfiguraci vzdáleného SQL se službou Azure AD Connect najdete v článku s popisem [vlastní instalace Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span><span class="sxs-lookup"><span data-stu-id="5afea-174">For instruction on how to configure remote SQL with Azure AD Connect, refer to article [Custom installation of Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-get-started-custom).</span></span>
* <span data-ttu-id="5afea-175">Pokyny k postupné migraci kvůli upgradu Azure AD Connect najdete v článku [Azure AD Connect: Upgrade z předchozí verze na nejnovější verzi](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span><span class="sxs-lookup"><span data-stu-id="5afea-175">For instructions on swing migration for Azure AD Connect upgrade, refer to article [Azure AD Connect: Upgrade from a previous version to the latest](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect-upgrade-previous-version#swing-migration).</span></span>

## <a name="next-steps"></a><span data-ttu-id="5afea-176">Další kroky</span><span class="sxs-lookup"><span data-stu-id="5afea-176">Next steps</span></span>
<span data-ttu-id="5afea-177">Přečtěte si další informace o [Integrování místních identit do služby Azure Active Directory](active-directory-aadconnect.md).</span><span class="sxs-lookup"><span data-stu-id="5afea-177">Learn more about [Integrating your on-premises identities with Azure Active Directory](active-directory-aadconnect.md).</span></span>

---
title: "Jednotné přihlašování pomocí Proxy aplikace | Microsoft Docs"
description: "Popisuje, jak poskytnout jednotné přihlašování pomocí proxy aplikace služby Azure AD."
services: active-directory
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: ded0d9c9-45f6-47d7-bd0f-3f7fd99ab621
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/25/2017
ms.author: kgremban
ms.reviewer: harshja
ms.custom: H1Hack27Feb2017, it-pro
ms.openlocfilehash: 149af1f68e574f78127a9c2de8a0e79ed8774d29
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="kerberos-constrained-delegation-for-single-sign-on-to-your-apps-with-application-proxy"></a><span data-ttu-id="95726-103">Omezené delegování Kerberos pro jednotné přihlašování pro vaše aplikace s Proxy aplikace</span><span class="sxs-lookup"><span data-stu-id="95726-103">Kerberos Constrained Delegation for single sign-on to your apps with Application Proxy</span></span>

<span data-ttu-id="95726-104">Můžete zadat jednotné přihlašování pro místní aplikace publikované prostřednictvím Proxy aplikace, které jsou zabezpečené integrované ověřování systému Windows.</span><span class="sxs-lookup"><span data-stu-id="95726-104">You can provide single sign-on for on-premises applications published through Application Proxy that are secured with Integrated Windows Authentication.</span></span> <span data-ttu-id="95726-105">Tyto aplikace vyžadují lístek protokolu Kerberos pro přístup.</span><span class="sxs-lookup"><span data-stu-id="95726-105">These applications require a Kerberos ticket for access.</span></span> <span data-ttu-id="95726-106">Proxy aplikací používá protokol Kerberos vynuceným delegování použitím (KCD) pro podporu těchto aplikací.</span><span class="sxs-lookup"><span data-stu-id="95726-106">Application Proxy uses Kerberos Constrained Delegation (KCD) to support these applications.</span></span> 

<span data-ttu-id="95726-107">Můžete povolit jednotné přihlašování pro vaše aplikace používá integrované ověřování systému Windows (IWA) tím, že oprávnění konektory Proxy aplikace ve službě Active Directory k zosobnění uživatelů.</span><span class="sxs-lookup"><span data-stu-id="95726-107">You can enable single sign-on to your applications using Integrated Windows Authentication (IWA) by giving Application Proxy connectors permission in Active Directory to impersonate users.</span></span> <span data-ttu-id="95726-108">Konektory použijte toto oprávnění posílat a přijímat tokeny jejich jménem.</span><span class="sxs-lookup"><span data-stu-id="95726-108">The connectors use this permission to send and receive tokens on their behalf.</span></span>

## <a name="how-single-sign-on-with-kcd-works"></a><span data-ttu-id="95726-109">Jak jednotné přihlašování s použitím KCD funguje</span><span class="sxs-lookup"><span data-stu-id="95726-109">How single sign-on with KCD works</span></span>
<span data-ttu-id="95726-110">Tento diagram popisuje tok, když se uživatel pokusí o přístup k místní aplikaci, která používá integrované ověřování systému Windows.</span><span class="sxs-lookup"><span data-stu-id="95726-110">This diagram explains the flow when a user attempts to access an on-prem application that uses IWA.</span></span>

![Microsoft AAD ověřování vývojový diagram](./media/active-directory-application-proxy-sso-using-kcd/AuthDiagram.png)

1. <span data-ttu-id="95726-112">Uživatel zadá adresu URL pro přístup k místní aplikaci prostřednictvím Proxy aplikace.</span><span class="sxs-lookup"><span data-stu-id="95726-112">The user enters the URL to access the on-prem application through Application Proxy.</span></span>
2. <span data-ttu-id="95726-113">Proxy aplikace přesměruje požadavek na službám Azure AD authentication preauthenticate.</span><span class="sxs-lookup"><span data-stu-id="95726-113">Application Proxy redirects the request to Azure AD authentication services to preauthenticate.</span></span> <span data-ttu-id="95726-114">V tomto okamžiku Azure AD platí všechny použitelné ověřování a zásady autorizace, jako například vícefaktorové ověřování.</span><span class="sxs-lookup"><span data-stu-id="95726-114">At this point, Azure AD applies any applicable authentication and authorization policies, such as multifactor authentication.</span></span> <span data-ttu-id="95726-115">Pokud je uživatel ověřen, Azure AD vytvoří token a odešle ji pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="95726-115">If the user is validated, Azure AD creates a token and sends it to the user.</span></span>
3. <span data-ttu-id="95726-116">Uživatel předá token Proxy aplikace.</span><span class="sxs-lookup"><span data-stu-id="95726-116">The user passes the token to Application Proxy.</span></span>
4. <span data-ttu-id="95726-117">Proxy aplikací ověří token a načte z něj hlavní název uživatele (UPN) a poté odešle požadavek, název UPN a hlavní název služby (SPN) do konektoru prostřednictvím obousměrně ověřené zabezpečeného kanálu.</span><span class="sxs-lookup"><span data-stu-id="95726-117">Application Proxy validates the token and retrieves the User Principal Name (UPN) from it, and then sends the request, the UPN, and the Service Principal Name (SPN) to the Connector through a dually authenticated secure channel.</span></span>
5. <span data-ttu-id="95726-118">Konektor provádí vyjednávání protokolu Kerberos vynuceným delegování použitím (KCD) se místní AD, zosobňování uživatele získat token protokolu Kerberos pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="95726-118">The Connector performs Kerberos Constrained Delegation (KCD) negotiation with the on-prem AD, impersonating the user to get a Kerberos token to the application.</span></span>
6. <span data-ttu-id="95726-119">Služby Active Directory odešle token protokolu Kerberos pro aplikaci do konektoru.</span><span class="sxs-lookup"><span data-stu-id="95726-119">Active Directory sends the Kerberos token for the application to the Connector.</span></span>
7. <span data-ttu-id="95726-120">Konektor odešle původní žádost na server aplikace pomocí protokolu Kerberos tokenu obdrženého ze služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="95726-120">The Connector sends the original request to the application server, using the Kerberos token it received from AD.</span></span>
8. <span data-ttu-id="95726-121">Aplikace odešle odpověď na tento konektor, který je pak vrácen do Proxy aplikace služby a v neposlední řadě pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="95726-121">The application sends the response to the Connector, which is then returned to the Application Proxy service and finally to the user.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="95726-122">Požadavky</span><span class="sxs-lookup"><span data-stu-id="95726-122">Prerequisites</span></span>
<span data-ttu-id="95726-123">Před zahájením práce s jednotné přihlašování pro aplikace, integrované ověřování systému Windows, zkontrolujte, zda že je prostředí připravené následující nastavení a konfigurace:</span><span class="sxs-lookup"><span data-stu-id="95726-123">Before you get started with single sign-on for IWA applications, make sure your environment is ready with the following settings and configurations:</span></span>

* <span data-ttu-id="95726-124">Aplikace, jako jsou aplikace webové služby SharePoint, nastaveny na používání integrovaného ověřování systému Windows.</span><span class="sxs-lookup"><span data-stu-id="95726-124">Your apps, like SharePoint Web apps, are set to use Integrated Windows Authentication.</span></span> <span data-ttu-id="95726-125">Další informace najdete v tématu [povolení podpory pro ověřování protokolem Kerberos](https://technet.microsoft.com/library/dd759186.aspx), nebo SharePoint najdete v tématu [plánování pro ověřování protokolem Kerberos v SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span><span class="sxs-lookup"><span data-stu-id="95726-125">For more information, see [Enable Support for Kerberos Authentication](https://technet.microsoft.com/library/dd759186.aspx), or for SharePoint see [Plan for Kerberos authentication in SharePoint 2013](https://technet.microsoft.com/library/ee806870.aspx).</span></span>
* <span data-ttu-id="95726-126">Všechny aplikace mají [hlavní názvy služby](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span><span class="sxs-lookup"><span data-stu-id="95726-126">All your apps have [Service Principal Names](https://social.technet.microsoft.com/wiki/contents/articles/717.service-principal-names-spns-setspn-syntax-setspn-exe.aspx).</span></span>
* <span data-ttu-id="95726-127">Server se službou konektoru a server se službou aplikace jsou připojené k doméně a součástí stejné domény nebo důvěryhodné domény.</span><span class="sxs-lookup"><span data-stu-id="95726-127">The server running the Connector and the server running the app are domain joined and part of the same domain or trusting domains.</span></span> <span data-ttu-id="95726-128">Další informace o připojení k doméně, najdete v části [připojit počítač k doméně](https://technet.microsoft.com/library/dd807102.aspx).</span><span class="sxs-lookup"><span data-stu-id="95726-128">For more information on domain join, see [Join a Computer to a Domain](https://technet.microsoft.com/library/dd807102.aspx).</span></span>
* <span data-ttu-id="95726-129">Serveru se spuštěným konektorem má přístup ke čtení atribut TokenGroupsGlobalAndUniversal pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="95726-129">The server running the Connector has access to read the TokenGroupsGlobalAndUniversal attribute for users.</span></span> <span data-ttu-id="95726-130">Toto výchozí nastavení může mít vliv zabezpečení posílení zabezpečení prostředí.</span><span class="sxs-lookup"><span data-stu-id="95726-130">This default setting might have been impacted by security hardening the environment.</span></span>

### <a name="configure-active-directory"></a><span data-ttu-id="95726-131">Konfigurace Active Directory</span><span class="sxs-lookup"><span data-stu-id="95726-131">Configure Active Directory</span></span>
<span data-ttu-id="95726-132">Konfigurace služby Active Directory se liší v závislosti na tom, jestli vaše konektor Proxy aplikace a aplikační servery jsou ve stejné doméně, nebo ne.</span><span class="sxs-lookup"><span data-stu-id="95726-132">The Active Directory configuration varies, depending on whether your Application Proxy connector and the application server are in the same domain or not.</span></span>

#### <a name="connector-and-application-server-in-the-same-domain"></a><span data-ttu-id="95726-133">Konektor a aplikační server ve stejné doméně</span><span class="sxs-lookup"><span data-stu-id="95726-133">Connector and application server in the same domain</span></span>
1. <span data-ttu-id="95726-134">Ve službě Active Directory, přejděte na **nástroje** > **uživatelé a počítače**.</span><span class="sxs-lookup"><span data-stu-id="95726-134">In Active Directory, go to **Tools** > **Users and Computers**.</span></span>
2. <span data-ttu-id="95726-135">Vyberte server se službou konektoru.</span><span class="sxs-lookup"><span data-stu-id="95726-135">Select the server running the connector.</span></span>
3. <span data-ttu-id="95726-136">Klikněte pravým tlačítkem a vyberte **vlastnosti** > **delegování**.</span><span class="sxs-lookup"><span data-stu-id="95726-136">Right-click and select **Properties** > **Delegation**.</span></span>
4. <span data-ttu-id="95726-137">Vyberte **důvěřovat tomuto počítači pro delegování pouze určeným službám**.</span><span class="sxs-lookup"><span data-stu-id="95726-137">Select **Trust this computer for delegation to specified services only**.</span></span> 
5. <span data-ttu-id="95726-138">V části **služby, ke kterým se tento účet může prokázat delegovanými přihlašovacími údaji** přidejte hodnotu pro identitu služby SPN aplikačního serveru.</span><span class="sxs-lookup"><span data-stu-id="95726-138">Under **Services to which this account can present delegated credentials** add the value for the SPN identity of the application server.</span></span> <span data-ttu-id="95726-139">To umožňuje konektoru Proxy aplikace k zosobnění uživatelů ve službě Active Directory před aplikací definované v seznamu.</span><span class="sxs-lookup"><span data-stu-id="95726-139">This enables the Application Proxy Connector to impersonate users in AD against the applications defined in the list.</span></span>

   ![Snímek obrazovky okna vlastností konektoru SVR](./media/active-directory-application-proxy-sso-using-kcd/Properties.jpg)

#### <a name="connector-and-application-server-in-different-domains"></a><span data-ttu-id="95726-141">Konektor a aplikační server v různých doménách</span><span class="sxs-lookup"><span data-stu-id="95726-141">Connector and application server in different domains</span></span>
1. <span data-ttu-id="95726-142">Seznam požadavků pro práci s použitím KCD napříč doménami, najdete v části [omezené delegování Kerberos mezi doménami](https://technet.microsoft.com/library/hh831477.aspx).</span><span class="sxs-lookup"><span data-stu-id="95726-142">For a list of prerequisites for working with KCD across domains, see [Kerberos Constrained Delegation across domains](https://technet.microsoft.com/library/hh831477.aspx).</span></span>
2. <span data-ttu-id="95726-143">Použití `principalsallowedtodelegateto` vlastnost na serveru konektoru pro povolení Proxy aplikace pro delegování pro Connector server.</span><span class="sxs-lookup"><span data-stu-id="95726-143">Use the `principalsallowedtodelegateto` property on the Connector server to enable the Application Proxy to delegate for the Connector server.</span></span> <span data-ttu-id="95726-144">Aplikační server `sharepointserviceaccount` a delegování server je `connectormachineaccount`.</span><span class="sxs-lookup"><span data-stu-id="95726-144">The application server is `sharepointserviceaccount` and the delegating server is `connectormachineaccount`.</span></span> <span data-ttu-id="95726-145">Pro systém Windows 2012 R2 tento kód použijte jako příklad:</span><span class="sxs-lookup"><span data-stu-id="95726-145">For Windows 2012 R2, use this code as an example:</span></span>

        $connector= Get-ADComputer -Identity connectormachineaccount -server dc.connectordomain.com

        Set-ADComputer -Identity sharepointserviceaccount -PrincipalsAllowedToDelegateToAccount $connector

        Get-ADComputer sharepointserviceaccount -Properties PrincipalsAllowedToDelegateToAccount

<span data-ttu-id="95726-146">Sharepointserviceaccount může být účet počítače aktualizace Service Pack nebo účet služby, pod kterým běží fond aplikací aktualizace Service Pack.</span><span class="sxs-lookup"><span data-stu-id="95726-146">Sharepointserviceaccount can be the SPS machine account or a service account under which the SPS app pool is running.</span></span>

## <a name="configure-single-sign-on"></a><span data-ttu-id="95726-147">Konfigurovat jednotné přihlašování</span><span class="sxs-lookup"><span data-stu-id="95726-147">Configure single sign-on</span></span> 
1. <span data-ttu-id="95726-148">Publikování aplikace podle pokynů v tématu [publikování aplikací pomocí Proxy aplikace](application-proxy-publish-azure-portal.md).</span><span class="sxs-lookup"><span data-stu-id="95726-148">Publish your application according to the instructions described in [Publish applications with Application Proxy](application-proxy-publish-azure-portal.md).</span></span> <span data-ttu-id="95726-149">Je nutné vybrat **Azure Active Directory** jako **metoda předběžného ověření**.</span><span class="sxs-lookup"><span data-stu-id="95726-149">Make sure to select **Azure Active Directory** as the **Preauthentication Method**.</span></span>
2. <span data-ttu-id="95726-150">Když vaše aplikace se zobrazí v seznamu podnikové aplikace, vyberte ho a klikněte na **jednotného přihlašování**.</span><span class="sxs-lookup"><span data-stu-id="95726-150">After your application appears in the list of enterprise applications, select it and click **Single sign-on**.</span></span>
3. <span data-ttu-id="95726-151">Nastavit režim přihlašování **integrované ověřování systému Windows**.</span><span class="sxs-lookup"><span data-stu-id="95726-151">Set the single sign-on mode to **Integrated Windows Authentication**.</span></span>  
4. <span data-ttu-id="95726-152">Zadejte **interní aplikace SPN** aplikačního serveru.</span><span class="sxs-lookup"><span data-stu-id="95726-152">Enter the **Internal Application SPN** of the application server.</span></span> <span data-ttu-id="95726-153">V tomto příkladu je název SPN pro naše publikovaná aplikace http/www.contoso.com. Tento hlavní název služby musí být v seznamu služeb, ke kterým můžete konektor prokázat delegovanými přihlašovacími údaji.</span><span class="sxs-lookup"><span data-stu-id="95726-153">In this example, the SPN for our published application is http/www.contoso.com. This SPN needs to be in the list of services to which the connector can present delegated credentials.</span></span> 
5. <span data-ttu-id="95726-154">Vyberte **delegované Identity přihlášení** pro konektor používat jménem uživatele.</span><span class="sxs-lookup"><span data-stu-id="95726-154">Choose the **Delegated Login Identity** for the connector to use on behalf of your users.</span></span> <span data-ttu-id="95726-155">Další informace najdete v tématu [práce s jinou místní a cloudové identity](#Working-with-different-on-premises-and-cloud-identities)</span><span class="sxs-lookup"><span data-stu-id="95726-155">For more information, see [Working with different on-premises and cloud identities](#Working-with-different-on-premises-and-cloud-identities)</span></span>

   ![Konfigurace pokročilé aplikace](./media/active-directory-application-proxy-sso-using-kcd/cwap_auth2.png)  


## <a name="sso-for-non-windows-apps"></a><span data-ttu-id="95726-157">Jednotné přihlašování pro aplikace systému Windows</span><span class="sxs-lookup"><span data-stu-id="95726-157">SSO for non-Windows apps</span></span>
<span data-ttu-id="95726-158">Tok delegování protokolu Kerberos v Azure AD Application Proxy spustí, když služba Azure AD ověřuje uživatele v cloudu.</span><span class="sxs-lookup"><span data-stu-id="95726-158">The Kerberos delegation flow in Azure AD Application Proxy starts when Azure AD authenticates the user in the cloud.</span></span> <span data-ttu-id="95726-159">Jakmile požadavek dorazí na místě, konektor proxy aplikace služby Azure AD vydá lístek protokolu Kerberos jménem uživatele interakcí s místní služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="95726-159">Once the request arrives on-premises, the Azure AD Application Proxy connector issues a Kerberos ticket on behalf of the user by interacting with the local Active Directory.</span></span> <span data-ttu-id="95726-160">Tento proces se označuje jako použitím protokolu Kerberos omezené delegování (KCD).</span><span class="sxs-lookup"><span data-stu-id="95726-160">This process is referred to as Kerberos Constrained Delegation (KCD).</span></span> <span data-ttu-id="95726-161">V další fázi posílá požadavek back-end aplikace s Tento lístek protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="95726-161">In the next phase, a request is sent to the backend application with this Kerberos ticket.</span></span> <span data-ttu-id="95726-162">Existuje několik protokolů, které definovat, jak k posílání takových požadavků.</span><span class="sxs-lookup"><span data-stu-id="95726-162">There are several protocols that define how to send such requests.</span></span> <span data-ttu-id="95726-163">Většina serverů jiný systém než Windows očekávat Negotiate/SPNego, který se teď podporuje v Azure AD Application Proxy.</span><span class="sxs-lookup"><span data-stu-id="95726-163">Most non-Windows servers expect Negotiate/SPNego that is now supported on Azure AD Application Proxy.</span></span>

<span data-ttu-id="95726-164">Další informace o protokolu Kerberos najdete v tématu [všechny budete chtít vědět o použitím protokolu Kerberos omezené delegování (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span><span class="sxs-lookup"><span data-stu-id="95726-164">For more information about Kerberos, see [All you want to know about Kerberos Constrained Delegation (KCD)](https://blogs.technet.microsoft.com/applicationproxyblog/2015/09/21/all-you-want-to-know-about-kerberos-constrained-delegation-kcd).</span></span>

<span data-ttu-id="95726-165">Aplikace pro Windows bez obvykle uživatelská jména uživatelů a názvy účtů SAM místo domény e-mailové adresy.</span><span class="sxs-lookup"><span data-stu-id="95726-165">Non-Windows apps typically user usernames or SAM account names instead of domain email addresses.</span></span> <span data-ttu-id="95726-166">Pokud se tato situace se vztahuje na aplikace, musíte nakonfigurovat pole identity delegované přihlášení pro připojení k vaší identity aplikace cloudové identity.</span><span class="sxs-lookup"><span data-stu-id="95726-166">If that situation applies to your applications, you need to configure the delegated login identity field to connect your cloud identities to your application identities.</span></span> 

## <a name="working-with-different-on-premises-and-cloud-identities"></a><span data-ttu-id="95726-167">Práce s jinou místní a cloudové identity</span><span class="sxs-lookup"><span data-stu-id="95726-167">Working with different on-premises and cloud identities</span></span>
<span data-ttu-id="95726-168">Proxy aplikací předpokládá, že uživatelé mají stejnou identitu v cloudu a místně.</span><span class="sxs-lookup"><span data-stu-id="95726-168">Application Proxy assumes that users have exactly the same identity in the cloud and on-premises.</span></span> <span data-ttu-id="95726-169">Pokud není tento případ, může stále můžete použitím KCD pro jednotné přihlašování.</span><span class="sxs-lookup"><span data-stu-id="95726-169">If that's not the case, you can can still use KCD for single sign-on.</span></span> <span data-ttu-id="95726-170">Konfigurace **delegované identity přihlášení** pro každou aplikaci, aby zadat identity, které má být použita při provádění jednotné přihlašování.</span><span class="sxs-lookup"><span data-stu-id="95726-170">Configure a **Delegated login identity** for each application to specify which identity should be used when performing single sign-on.</span></span>  

<span data-ttu-id="95726-171">Tato možnost umožňuje řada organizací, které mají různé místní a cloudové identity mít jednotného přihlašování z cloudu na místní aplikace bez nutnosti uživatelům zadat jiný uživatelských jmen a hesel.</span><span class="sxs-lookup"><span data-stu-id="95726-171">This capability allows many organizations that have different on-premises and cloud identities to have SSO from the cloud to on-premises apps without requiring the users to enter different usernames and passwords.</span></span> <span data-ttu-id="95726-172">To zahrnuje organizace který:</span><span class="sxs-lookup"><span data-stu-id="95726-172">This includes organizations that:</span></span>

* <span data-ttu-id="95726-173">Interně mají několik domén (joe@us.contoso.com, joe@eu.contoso.com) a jednu doménu v cloudu (joe@contoso.com).</span><span class="sxs-lookup"><span data-stu-id="95726-173">Have multiple domains internally (joe@us.contoso.com, joe@eu.contoso.com) and a single domain in the cloud (joe@contoso.com).</span></span>
* <span data-ttu-id="95726-174">Interně mít název směrovat domény (joe@contoso.usa) a právní jeden v cloudu.</span><span class="sxs-lookup"><span data-stu-id="95726-174">Have non-routable domain name internally (joe@contoso.usa) and a legal one in the cloud.</span></span>
* <span data-ttu-id="95726-175">Nepoužívejte názvy domén interně (Jan)</span><span class="sxs-lookup"><span data-stu-id="95726-175">Do not use domain names internally (joe)</span></span>
* <span data-ttu-id="95726-176">Použít různé aliasy místní i v cloudu.</span><span class="sxs-lookup"><span data-stu-id="95726-176">Use different aliases on-prem and in the cloud.</span></span> <span data-ttu-id="95726-177">Například joe-johns@contoso.com vs.joej@contoso.com</span><span class="sxs-lookup"><span data-stu-id="95726-177">For example, joe-johns@contoso.com vs. joej@contoso.com</span></span>  

<span data-ttu-id="95726-178">Pomocí Proxy aplikace můžete vybrat které identity používat k získání lístku protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="95726-178">With Application Proxy, you can select which identity to use to obtain the Kerberos ticket.</span></span> <span data-ttu-id="95726-179">Toto nastavení je na aplikaci.</span><span class="sxs-lookup"><span data-stu-id="95726-179">This setting is per application.</span></span> <span data-ttu-id="95726-180">Některé z těchto možností jsou vhodné pro systémy, které nepřijímá formát e-mailové adresy, jiné jsou navržené pro alternativní přihlášení.</span><span class="sxs-lookup"><span data-stu-id="95726-180">Some of these options are suitable for systems that do not accept email address format, others are designed for alternative login.</span></span>

![Snímek obrazovky parametr identity delegované přihlášení](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_upn.png)

<span data-ttu-id="95726-182">Pokud se používá k přihlášení delegované identity, nemusí být hodnota jedinečná napříč doménami nebo doménovými strukturami ve vaší organizaci.</span><span class="sxs-lookup"><span data-stu-id="95726-182">If delegated login identity is used, the value might not be unique across all the domains or forests in your organization.</span></span> <span data-ttu-id="95726-183">Tento problém se můžete vyhnout tím, že publikujete tyto aplikace dvakrát pomocí dvou různých skupin konektor.</span><span class="sxs-lookup"><span data-stu-id="95726-183">You can avoid this issue by publishing these applications twice using two different Connector groups.</span></span> <span data-ttu-id="95726-184">Vzhledem k tomu, že každá aplikace má cílovou skupinu jiného uživatele, můžete jeho konektory spojit do jiné domény.</span><span class="sxs-lookup"><span data-stu-id="95726-184">Since each application has a different user audience, you can join its Connectors to a different domain.</span></span>

### <a name="configure-sso-for-different-identities"></a><span data-ttu-id="95726-185">Konfigurovat jednotné přihlašování pro různé identity</span><span class="sxs-lookup"><span data-stu-id="95726-185">Configure SSO for different identities</span></span>
1. <span data-ttu-id="95726-186">Konfigurace nastavení Azure AD Connect, hlavní identita je e-mailovou adresu (e-mailu).</span><span class="sxs-lookup"><span data-stu-id="95726-186">Configure Azure AD Connect settings so the main identity is the email address (mail).</span></span> <span data-ttu-id="95726-187">Provádí se jako součást procesu přizpůsobit změnou **hlavní název uživatele** pole v nastavení synchronizace.</span><span class="sxs-lookup"><span data-stu-id="95726-187">This is done as part of the customize process, by changing the **User Principal Name** field in the sync settings.</span></span> <span data-ttu-id="95726-188">Tato nastavení taky určit, jak se uživatelé přihlásí k Office 365, Windows10 zařízení a dalších aplikací, které používají Azure AD jako své úložiště identit.</span><span class="sxs-lookup"><span data-stu-id="95726-188">These settings also determine how users log in to Office365, Windows10 devices, and other applications that use Azure AD as their identity store.</span></span>  
   <span data-ttu-id="95726-189">![Identifikace uživatelů – snímek obrazovky - rozevírací hlavní název uživatele](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span><span class="sxs-lookup"><span data-stu-id="95726-189">![Identifying users screenshot - User Principal Name dropdown](./media/active-directory-application-proxy-sso-using-kcd/app_proxy_sso_diff_id_connect_settings.png)</span></span>  
2. <span data-ttu-id="95726-190">V nastavení konfigurace aplikace pro aplikaci, kterou chcete upravit, vyberte **delegované Identity přihlášení** který se má použít:</span><span class="sxs-lookup"><span data-stu-id="95726-190">In the Application Configuration settings for the application you would like to modify, select the **Delegated Login Identity** to be used:</span></span>

   * <span data-ttu-id="95726-191">Hlavní název uživatele (například joe@contoso.com)</span><span class="sxs-lookup"><span data-stu-id="95726-191">User Principal Name (for example, joe@contoso.com)</span></span>
   * <span data-ttu-id="95726-192">Alternativní hlavní název uživatele (například joed@contoso.local)</span><span class="sxs-lookup"><span data-stu-id="95726-192">Alternate User Principal Name (for example, joed@contoso.local)</span></span>
   * <span data-ttu-id="95726-193">Uživatelské jméno součástí hlavní název uživatele (například Jan)</span><span class="sxs-lookup"><span data-stu-id="95726-193">Username part of User Principal Name (for example, joe)</span></span>
   * <span data-ttu-id="95726-194">Uživatelské jméno součástí alternativní hlavní název uživatele (například joed)</span><span class="sxs-lookup"><span data-stu-id="95726-194">Username part of Alternate User Principal Name (for example, joed)</span></span>
   * <span data-ttu-id="95726-195">Název účtu SAM místní (závisí na konfiguraci řadiče domény)</span><span class="sxs-lookup"><span data-stu-id="95726-195">On-premises SAM account name (depends on the domain controller configuration)</span></span>

### <a name="troubleshooting-sso-for-different-identities"></a><span data-ttu-id="95726-196">Řešení potíží s jednotného přihlašování pro různé identity</span><span class="sxs-lookup"><span data-stu-id="95726-196">Troubleshooting SSO for different identities</span></span>
<span data-ttu-id="95726-197">Pokud dojde k chybě při procesu jednotné přihlašování, zobrazí se v protokolu událostí počítače konektor jak je popsáno v [Poradce při potížích s](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span><span class="sxs-lookup"><span data-stu-id="95726-197">If there is an error in the SSO process, it appears in the connector machine event log as explained in [Troubleshooting](application-proxy-back-end-kerberos-constrained-delegation-how-to.md).</span></span>
<span data-ttu-id="95726-198">Ale v některých případech je požadavek úspěšně odeslán do back-end aplikace během této aplikace reaguje v různých dalších odpovědi HTTP.</span><span class="sxs-lookup"><span data-stu-id="95726-198">But, in some cases, the request is successfully sent to the backend application while this application replies in various other HTTP responses.</span></span> <span data-ttu-id="95726-199">Řešení potíží s těchto případech by se měl spustit tak, že prověří číslo události 24029 na počítači konektor v protokolu událostí relaci Proxy aplikace.</span><span class="sxs-lookup"><span data-stu-id="95726-199">Troubleshooting these cases should start by examining event number 24029 on the connector machine in the Application Proxy session event log.</span></span> <span data-ttu-id="95726-200">V poli "user" v rámci podrobnosti události se zobrazí identitu uživatele, která byla použita pro delegování.</span><span class="sxs-lookup"><span data-stu-id="95726-200">The user identity that was used for delegation appears in the “user” field within the event details.</span></span> <span data-ttu-id="95726-201">Chcete-li protokolu relace zapnout, vyberte **ukazují analytické a ladicí protokoly** v nabídce zobrazení Prohlížeč událostí.</span><span class="sxs-lookup"><span data-stu-id="95726-201">To turn on session log, select **Show analytic and debug logs** in the event viewer view menu.</span></span>

## <a name="next-steps"></a><span data-ttu-id="95726-202">Další kroky</span><span class="sxs-lookup"><span data-stu-id="95726-202">Next steps</span></span>

* [<span data-ttu-id="95726-203">Postup konfigurace aplikace Proxy aplikace pro použití omezeného delegování protokolu Kerberos</span><span class="sxs-lookup"><span data-stu-id="95726-203">How to configure an Application Proxy application to use Kerberos Constrained Delegation</span></span>](application-proxy-back-end-kerberos-constrained-delegation-how-to.md)
* [<span data-ttu-id="95726-204">Řešení problémů, které máte s pomocí Proxy aplikace</span><span class="sxs-lookup"><span data-stu-id="95726-204">Troubleshoot issues you're having with Application Proxy</span></span>](active-directory-application-proxy-troubleshoot.md)


<span data-ttu-id="95726-205">Nejnovější novinky a aktualizace naleznete na [blogu proxy aplikace](http://blogs.technet.com/b/applicationproxyblog/)</span><span class="sxs-lookup"><span data-stu-id="95726-205">For the latest news and updates, check out the [Application Proxy blog](http://blogs.technet.com/b/applicationproxyblog/)</span></span>


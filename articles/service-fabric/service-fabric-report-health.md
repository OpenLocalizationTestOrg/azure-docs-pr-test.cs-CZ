---
title: "sestavy stavu Service Fabric vlastní aaaAdd | Microsoft Docs"
description: "Popisuje, jak toosend vlastní stavu sestavy tooAzure entity stavu Service Fabric. Poskytuje doporučení pro navrhování a implementace sestav stavu kvality."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 0a00a7d2-510e-47d0-8aa8-24c851ea847f
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 12c9f664e2a457b4e1e8f340873ca60ebcefb097
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="add-custom-service-fabric-health-reports"></a><span data-ttu-id="1f300-104">Přidání vlastních stavových sestav Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1f300-104">Add custom Service Fabric health reports</span></span>
<span data-ttu-id="1f300-105">Představuje Azure Service Fabric [stavu modelu](service-fabric-health-introduction.md) určené tooflag není v pořádku, cluster a aplikace podmínek na konkrétní entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-105">Azure Service Fabric introduces a [health model](service-fabric-health-introduction.md) designed tooflag unhealthy cluster and application conditions on specific entities.</span></span> <span data-ttu-id="1f300-106">model stavu Hello používá **stavu reporters** (součásti systému a watchdogs).</span><span class="sxs-lookup"><span data-stu-id="1f300-106">hello health model uses **health reporters** (system components and watchdogs).</span></span> <span data-ttu-id="1f300-107">cílem Hello je rychlé a snadné diagnostiky a opravy.</span><span class="sxs-lookup"><span data-stu-id="1f300-107">hello goal is easy and fast diagnosis and repair.</span></span> <span data-ttu-id="1f300-108">Služba zapisovače potřebovat toothink předem o stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-108">Service writers need toothink upfront about health.</span></span> <span data-ttu-id="1f300-109">Všechny podmínku, která může mít vliv na stav by měl být zaznamenány na, zejména v případě, že může pomoci zavřete toohello kořenové problémy příznak.</span><span class="sxs-lookup"><span data-stu-id="1f300-109">Any condition that can impact health should be reported on, especially if it can help flag problems close toohello root.</span></span> <span data-ttu-id="1f300-110">informace o stavu Hello můžete ušetřit čas a úsilí na ladění a šetření.</span><span class="sxs-lookup"><span data-stu-id="1f300-110">hello health information can save time and effort on debugging and investigation.</span></span> <span data-ttu-id="1f300-111">Hello užitečnost je obzvláště zrušte po hello služba je spuštěná ve velkém měřítku v cloudu hello (privátní nebo Azure).</span><span class="sxs-lookup"><span data-stu-id="1f300-111">hello usefulness is especially clear once hello service is up and running at scale in hello cloud (private or Azure).</span></span>

<span data-ttu-id="1f300-112">monitorování reporters Service Fabric Hello identifikovat podmínky, které vás zajímají.</span><span class="sxs-lookup"><span data-stu-id="1f300-112">hello Service Fabric reporters monitor identified conditions of interest.</span></span> <span data-ttu-id="1f300-113">Sestavy budou tyto podmínky založené na jejich místní zobrazení.</span><span class="sxs-lookup"><span data-stu-id="1f300-113">They report on those conditions based on their local view.</span></span> <span data-ttu-id="1f300-114">Hello [úložiště stavu](service-fabric-health-introduction.md#health-store) agreguje data o stavu odeslaných všechny toodetermine reporters jestli entity jsou globální v pořádku.</span><span class="sxs-lookup"><span data-stu-id="1f300-114">hello [health store](service-fabric-health-introduction.md#health-store) aggregates health data sent by all reporters toodetermine whether entities are globally healthy.</span></span> <span data-ttu-id="1f300-115">Hello model je určený toobe bohaté, flexibilní a snadno toouse.</span><span class="sxs-lookup"><span data-stu-id="1f300-115">hello model is intended toobe rich, flexible, and easy toouse.</span></span> <span data-ttu-id="1f300-116">Hello kvalitu sestav stavu hello Určuje přesnost hello zobrazení stavu hello hello clusteru.</span><span class="sxs-lookup"><span data-stu-id="1f300-116">hello quality of hello health reports determines hello accuracy of hello health view of hello cluster.</span></span> <span data-ttu-id="1f300-117">Falešně pozitivních zjištění, které se nesprávně zobrazí není v pořádku problémy může mít negativní vliv na upgrady nebo jiné služby, které používají data o stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-117">False positives that wrongly show unhealthy issues can negatively impact upgrades or other services that use health data.</span></span> <span data-ttu-id="1f300-118">Příkladem takové služby jsou opravy služeb a mechanismy pro výstrahy.</span><span class="sxs-lookup"><span data-stu-id="1f300-118">Examples of such services are repair services and alerting mechanisms.</span></span> <span data-ttu-id="1f300-119">Proto některé myšlenku je potřebné tooprovide sestavy, které zaznamenat podmínky zájem o hello co nejlepší možný způsob.</span><span class="sxs-lookup"><span data-stu-id="1f300-119">Therefore, some thought is needed tooprovide reports that capture conditions of interest in hello best possible way.</span></span>

<span data-ttu-id="1f300-120">musí být toodesign a implementujte komponenty vytváření sestav, watchdogs a systému stavu:</span><span class="sxs-lookup"><span data-stu-id="1f300-120">toodesign and implement health reporting, watchdogs and system components must:</span></span>

* <span data-ttu-id="1f300-121">Definujte hello podmínku, kterou budou zajímat, hello způsobem, který je monitorován a hello vliv na funkčnost clusteru nebo aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-121">Define hello condition they are interested in, hello way it is monitored, and hello impact on hello cluster or application functionality.</span></span> <span data-ttu-id="1f300-122">Na základě těchto informací, rozhodněte o hello sestavy stavu a vlastnost stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-122">Based on this information, decide on hello health report property and health state.</span></span>
* <span data-ttu-id="1f300-123">Určení hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) hello sestavy, které se vztahují k.</span><span class="sxs-lookup"><span data-stu-id="1f300-123">Determine hello [entity](service-fabric-health-introduction.md#health-entities-and-hierarchy) that hello report applies to.</span></span>
* <span data-ttu-id="1f300-124">Určení, kde se provádí hello reporting, uvnitř hello sledovací služba nebo z interní nebo externí zařízení.</span><span class="sxs-lookup"><span data-stu-id="1f300-124">Determine where hello reporting is done, from within hello service or from an internal or external watchdog.</span></span>
* <span data-ttu-id="1f300-125">Definování zdroj použitý tooidentify hello ohlašování.</span><span class="sxs-lookup"><span data-stu-id="1f300-125">Define a source used tooidentify hello reporter.</span></span>
* <span data-ttu-id="1f300-126">Volba strategie vytváření sestav, pravidelně nebo na přechody.</span><span class="sxs-lookup"><span data-stu-id="1f300-126">Choose a reporting strategy, either periodically or on transitions.</span></span> <span data-ttu-id="1f300-127">Hello doporučuje způsob, jak je pravidelně jako se vyžaduje kód jednodušší a méně náchylná tooerrors.</span><span class="sxs-lookup"><span data-stu-id="1f300-127">hello recommended way is periodically, as it requires simpler code and is less prone tooerrors.</span></span>
* <span data-ttu-id="1f300-128">Určení jak dlouho hello sestavy není v pořádku podmínky by měla zůstat v hello health store a způsob, jakým má být vymazána.</span><span class="sxs-lookup"><span data-stu-id="1f300-128">Determine how long hello report for unhealthy conditions should stay in hello health store and how it should be cleared.</span></span> <span data-ttu-id="1f300-129">Na základě těchto informací rozhodněte, sestava hello čas toolive a odebrat na vypršení platnosti chování.</span><span class="sxs-lookup"><span data-stu-id="1f300-129">Using this information, decide hello report's time toolive and remove-on-expiration behavior.</span></span>

<span data-ttu-id="1f300-130">Jak je uvedeno, vytváření sestav můžete provést z:</span><span class="sxs-lookup"><span data-stu-id="1f300-130">As mentioned, reporting can be done from:</span></span>

* <span data-ttu-id="1f300-131">Hello sledovat repliky služby Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1f300-131">hello monitored Service Fabric service replica.</span></span>
* <span data-ttu-id="1f300-132">Interní watchdogs nasazené jako služba Service Fabric (například Service Fabric bezstavové služba, která monitoruje podmínky a vydá sestavy).</span><span class="sxs-lookup"><span data-stu-id="1f300-132">Internal watchdogs deployed as a Service Fabric service (for example, a Service Fabric stateless service that monitors conditions and issues reports).</span></span> <span data-ttu-id="1f300-133">Hello watchdogs může být nasazen všechny uzly nebo může být spřaženém toohello monitorované služby.</span><span class="sxs-lookup"><span data-stu-id="1f300-133">hello watchdogs can be deployed an all nodes or can be affinitized toohello monitored service.</span></span>
* <span data-ttu-id="1f300-134">Interní watchdogs, které spouštět na uzlech hello Service Fabric, ale jsou *není* implementovaný jako služby Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="1f300-134">Internal watchdogs that run on hello Service Fabric nodes but are *not* implemented as Service Fabric services.</span></span>
* <span data-ttu-id="1f300-135">Externí watchdogs prostředku hello testu z *mimo* hello cluster Service Fabric (například monitorování služby jako Gomez).</span><span class="sxs-lookup"><span data-stu-id="1f300-135">External watchdogs that probe hello resource from *outside* hello Service Fabric cluster (for example, monitoring service like Gomez).</span></span>

> [!NOTE]
> <span data-ttu-id="1f300-136">Předinstalované hello hello clusteru naplněný sestavy o stavu odeslaných hello komponent systému.</span><span class="sxs-lookup"><span data-stu-id="1f300-136">Out of hello box, hello cluster is populated with health reports sent by hello system components.</span></span> <span data-ttu-id="1f300-137">Další informace v [stavu systému pomocí sestav pro řešení potíží s](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span><span class="sxs-lookup"><span data-stu-id="1f300-137">Read more at [Using system health reports for troubleshooting](service-fabric-understand-and-troubleshoot-with-system-health-reports.md).</span></span> <span data-ttu-id="1f300-138">Hello uživatel sestavy, musí se poslat [entity stavu](service-fabric-health-introduction.md#health-entities-and-hierarchy) , již byly vytvořeny systémem hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-138">hello user reports must be sent on [health entities](service-fabric-health-introduction.md#health-entities-and-hierarchy) that have already been created by hello system.</span></span>
> 
> 

<span data-ttu-id="1f300-139">Jednou hello návrh sestav stavu je zřejmé, sestavy stavu lze snadno odeslat.</span><span class="sxs-lookup"><span data-stu-id="1f300-139">Once hello health reporting design is clear, health reports can be sent easily.</span></span> <span data-ttu-id="1f300-140">Můžete použít [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport stavu Pokud hello clusteru není [zabezpečené](service-fabric-cluster-security.md) nebo klienta fabric hello má oprávnění správce.</span><span class="sxs-lookup"><span data-stu-id="1f300-140">You can use [FabricClient](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient) tooreport health if hello cluster is not [secure](service-fabric-cluster-security.md) or if hello fabric client has admin privileges.</span></span> <span data-ttu-id="1f300-141">Vytváření sestav můžete provést prostřednictvím hello rozhraní API pomocí pomocí [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), pomocí prostředí PowerShell nebo prostřednictvím REST.</span><span class="sxs-lookup"><span data-stu-id="1f300-141">Reporting can be done through hello API by using [FabricClient.HealthManager.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth), through PowerShell, or through REST.</span></span> <span data-ttu-id="1f300-142">Konfigurace knoflíky dávky sestavy pro zlepšení výkonu.</span><span class="sxs-lookup"><span data-stu-id="1f300-142">Configuration knobs batch reports for improved performance.</span></span>

> [!NOTE]
> <span data-ttu-id="1f300-143">Sestava stavu je synchronní a představuje pouze pracovní hello ověření na straně klienta hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-143">Report health is synchronous, and it represents only hello validation work on hello client side.</span></span> <span data-ttu-id="1f300-144">Hello skutečnost, že hello sestavy je přijat hello stavu klienta nebo hello `Partition` nebo `CodePackageActivationContext` objekty neznamená, že se použije v úložišti hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-144">hello fact that hello report is accepted by hello health client or hello `Partition` or `CodePackageActivationContext` objects doesn't mean that it is applied in hello store.</span></span> <span data-ttu-id="1f300-145">Je odeslán asynchronně a které by mohly mít zpracovat v dávce s dalšími sestavami.</span><span class="sxs-lookup"><span data-stu-id="1f300-145">It is sent asynchronously and possibly batched with other reports.</span></span> <span data-ttu-id="1f300-146">stále může selhat Hello zpracování na serveru hello: hello pořadové číslo může být zastaralé, hello entity, na které hello se musí použít sestava byla odstraněna, atd.</span><span class="sxs-lookup"><span data-stu-id="1f300-146">hello processing on hello server may still fail: hello sequence number could be stale, hello entity on which hello report must be applied has been deleted, etc.</span></span>
> 
> 

## <a name="health-client"></a><span data-ttu-id="1f300-147">Stav klienta</span><span class="sxs-lookup"><span data-stu-id="1f300-147">Health client</span></span>
<span data-ttu-id="1f300-148">sestavy stavu Hello odešlou toohello health store prostřednictvím stavu klienta, které je umístěn uvnitř klienta fabric hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-148">hello health reports are sent toohello health store through a health client, which lives inside hello fabric client.</span></span> <span data-ttu-id="1f300-149">Hello stavu klienta se dá nakonfigurovat s hello následující nastavení:</span><span class="sxs-lookup"><span data-stu-id="1f300-149">hello health client can be configured with hello following settings:</span></span>

* <span data-ttu-id="1f300-150">**HealthReportSendInterval**: hello zpoždění mezi hello čas hello sestavy je čas klienta a hello přidané toohello odesláním toohello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-150">**HealthReportSendInterval**: hello delay between hello time hello report is added toohello client and hello time it is sent toohello health store.</span></span> <span data-ttu-id="1f300-151">Použít toobatch sestavy do jedné zprávy, místo odeslání jednu zprávu pro každý sestavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-151">Used toobatch reports into a single message, rather than sending one message for each report.</span></span> <span data-ttu-id="1f300-152">dávkování Hello zvyšuje výkon.</span><span class="sxs-lookup"><span data-stu-id="1f300-152">hello batching improves performance.</span></span> <span data-ttu-id="1f300-153">Výchozí hodnota: 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-153">Default: 30 seconds.</span></span>
* <span data-ttu-id="1f300-154">**HealthReportRetrySendInterval**: hello interval, ve které hello stavu klient znovu odešle Akumulovaná stavu sestavy toohello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-154">**HealthReportRetrySendInterval**: hello interval at which hello health client resends accumulated health reports toohello health store.</span></span> <span data-ttu-id="1f300-155">Výchozí hodnota: 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-155">Default: 30 seconds.</span></span>
* <span data-ttu-id="1f300-156">**HealthOperationTimeout**: hello časový limit pro sestavu zprávy odeslané toohello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-156">**HealthOperationTimeout**: hello timeout period for a report message sent toohello health store.</span></span> <span data-ttu-id="1f300-157">Pokud zprávu časového limitu, hello stavu klienta se opakuje, dokud hello health store potvrdí, že byla zpracována hello sestavy.</span><span class="sxs-lookup"><span data-stu-id="1f300-157">If a message times out, hello health client retries it until hello health store confirms that hello report has been processed.</span></span> <span data-ttu-id="1f300-158">Výchozí hodnota: dvě minuty.</span><span class="sxs-lookup"><span data-stu-id="1f300-158">Default: two minutes.</span></span>

> [!NOTE]
> <span data-ttu-id="1f300-159">Pokud jsou sestavy hello zpracovat v dávce, hello klienta fabric musí být udržovány zachování připojení pro alespoň hello tooensure HealthReportSendInterval, která se odešlou.</span><span class="sxs-lookup"><span data-stu-id="1f300-159">When hello reports are batched, hello fabric client must be kept alive for at least hello HealthReportSendInterval tooensure that they are sent.</span></span> <span data-ttu-id="1f300-160">Pokud dojde ke ztrátě uvítací zprávu nebo hello stav úložiště nelze použít z důvodu chyby tootransient, hello klienta fabric musí být udržovány zachování delší toogive ho tooretry příležitosti.</span><span class="sxs-lookup"><span data-stu-id="1f300-160">If hello message is lost or hello health store cannot apply them due tootransient errors, hello fabric client must be kept alive longer toogive it a chance tooretry.</span></span>
> 
> 

<span data-ttu-id="1f300-161">Hello ukládání do vyrovnávací paměti na klientovi hello trvá hello jedinečnosti hello sestav v úvahu.</span><span class="sxs-lookup"><span data-stu-id="1f300-161">hello buffering on hello client takes hello uniqueness of hello reports into consideration.</span></span> <span data-ttu-id="1f300-162">Například pokud konkrétní chybný ohlašování vykazování 100 sestav za sekundu na hello stejné vlastnosti hello stejné entity, hello sestavy jsou nahrazeny hello poslední verze.</span><span class="sxs-lookup"><span data-stu-id="1f300-162">For example, if a particular bad reporter is reporting 100 reports per second on hello same property of hello same entity, hello reports are replaced with hello last version.</span></span> <span data-ttu-id="1f300-163">Maximálně jeden takový sestavy existuje ve frontě hello klienta.</span><span class="sxs-lookup"><span data-stu-id="1f300-163">At most one such report exists in hello client queue.</span></span> <span data-ttu-id="1f300-164">Pokud dávkování nastaveno, hello počet sestav odeslané toohello stavu úložiště je pouze jeden intervalu odeslání.</span><span class="sxs-lookup"><span data-stu-id="1f300-164">If batching is configured, hello number of reports sent toohello health store is just one per send interval.</span></span> <span data-ttu-id="1f300-165">Tato sestava je hello poslední přidané zprávu, která odráží hello aktuálního stavu entity hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-165">This report is hello last added report, which reflects hello most current state of hello entity.</span></span>
<span data-ttu-id="1f300-166">Zadejte parametry konfigurace při `FabricClient` se vytvoří pomocí předání [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) s hello požadované hodnoty pro stav související položky.</span><span class="sxs-lookup"><span data-stu-id="1f300-166">Specify configuration parameters when `FabricClient` is created by passing [FabricClientSettings](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclientsettings) with hello desired values for health-related entries.</span></span>

<span data-ttu-id="1f300-167">Hello následující příklad vytvoří klienta fabric a určuje, že by měly být odeslány hello sestav při přidání.</span><span class="sxs-lookup"><span data-stu-id="1f300-167">hello following example creates a fabric client and specifies that hello reports should be sent when they are added.</span></span> <span data-ttu-id="1f300-168">V časových limitů a chyb, které můžete zkusit znovu opakování dojít každých 40 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-168">On timeouts and errors that can be retried, retries happen every 40 seconds.</span></span>

```csharp
var clientSettings = new FabricClientSettings()
{
    HealthOperationTimeout = TimeSpan.FromSeconds(120),
    HealthReportSendInterval = TimeSpan.FromSeconds(0),
    HealthReportRetrySendInterval = TimeSpan.FromSeconds(40),
};
var fabricClient = new FabricClient(clientSettings);
```

<span data-ttu-id="1f300-169">Doporučujeme zachovat fabric hello výchozí nastavení klienta, která nastavit `HealthReportSendInterval` too30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-169">We recommend keeping hello default fabric client settings, which set `HealthReportSendInterval` too30 seconds.</span></span> <span data-ttu-id="1f300-170">Toto nastavení zajistí optimální výkon kvůli toobatching.</span><span class="sxs-lookup"><span data-stu-id="1f300-170">This setting ensures optimal performance due toobatching.</span></span> <span data-ttu-id="1f300-171">Pro kritické sestavy, které musí být nejdříve poslat, použijte `HealthReportSendOptions` s Immediate `true` v [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="1f300-171">For critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true` in [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API.</span></span> <span data-ttu-id="1f300-172">Okamžitou sestavy nepoužívat hello dávkování intervalu.</span><span class="sxs-lookup"><span data-stu-id="1f300-172">Immediate reports bypass hello batching interval.</span></span> <span data-ttu-id="1f300-173">Pomocí tohoto příznaku dát pozor; Chceme tootake výhod hello stavu klienta dávkování kdykoli je to možné.</span><span class="sxs-lookup"><span data-stu-id="1f300-173">Use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span> <span data-ttu-id="1f300-174">Okamžité odeslání je také užitečné při zavírání hello klienta fabric (například hello proces bylo zjištěno neplatné stavu a je třeba tooshut dolů tooprevent vedlejší účinky).</span><span class="sxs-lookup"><span data-stu-id="1f300-174">Immediate send is also useful when hello fabric client is closing (for example, hello process has determined invalid state and needs tooshut down tooprevent side effects).</span></span> <span data-ttu-id="1f300-175">Zajišťuje best effort odesílání hello nahromadění sestav.</span><span class="sxs-lookup"><span data-stu-id="1f300-175">It ensures a best-effort send of hello accumulated reports.</span></span> <span data-ttu-id="1f300-176">Při přidání jednu sestavu s příznakem okamžitou hello stavu klienta dávek všechny sestavy hello shromážděných od posledního odeslání.</span><span class="sxs-lookup"><span data-stu-id="1f300-176">When one report is added with Immediate flag, hello health client batches all hello accumulated reports since last send.</span></span>

<span data-ttu-id="1f300-177">Stejnými parametry lze zadat, pokud cluster tooa připojení je vytvořený pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="1f300-177">Same parameters can be specified when a connection tooa cluster is created through PowerShell.</span></span> <span data-ttu-id="1f300-178">Hello následující ukázka spuštění místní cluster tooa připojení:</span><span class="sxs-lookup"><span data-stu-id="1f300-178">hello following example starts a connection tooa local cluster:</span></span>

```powershell
PS C:\> Connect-ServiceFabricCluster -HealthOperationTimeoutInSec 120 -HealthReportSendIntervalInSec 0 -HealthReportRetrySendIntervalInSec 40
True

ConnectionEndpoint   :
FabricClientSettings : {
                       ClientFriendlyName                   : PowerShell-1944858a-4c6d-465f-89c7-9021c12ac0bb
                       PartitionLocationCacheLimit          : 100000
                       PartitionLocationCacheBucketCount    : 1024
                       ServiceChangePollInterval            : 00:02:00
                       ConnectionInitializationTimeout      : 00:00:02
                       KeepAliveInterval                    : 00:00:20
                       HealthOperationTimeout               : 00:02:00
                       HealthReportSendInterval             : 00:00:00
                       HealthReportRetrySendInterval        : 00:00:40
                       NotificationGatewayConnectionTimeout : 00:00:00
                       NotificationCacheUpdateTimeout       : 00:00:00
                       }
GatewayInformation   : {
                       NodeAddress                          : localhost:19000
                       NodeId                               : 1880ec88a3187766a6da323399721f53
                       NodeInstanceId                       : 130729063464981219
                       NodeName                             : Node.1
                       }
```

<span data-ttu-id="1f300-179">Podobně tooAPI, sestavy lze zaslat pomocí `-Immediate` přepínač toobe odesílány okamžitě, bez ohledu na to hello `HealthReportSendInterval` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="1f300-179">Similarly tooAPI, reports can be sent using `-Immediate` switch toobe sent immediately, regardless of hello `HealthReportSendInterval` value.</span></span>

<span data-ttu-id="1f300-180">REST se odesílají sestavy hello brána toohello Service Fabric, která má klientem interní prostředků infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="1f300-180">For REST, hello reports are sent toohello Service Fabric gateway, which has an internal fabric client.</span></span> <span data-ttu-id="1f300-181">Tohoto klienta je ve výchozím nastavení nakonfigurované toosend sestavy zpracovat v dávce každých 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-181">By default, this client is configured toosend reports batched every 30 seconds.</span></span> <span data-ttu-id="1f300-182">Hello batch interval, můžete změnit pomocí nastavení konfigurace clusteru hello `HttpGatewayHealthReportSendInterval` na `HttpGateway`.</span><span class="sxs-lookup"><span data-stu-id="1f300-182">You can change hello batch interval with hello cluster configuration setting `HttpGatewayHealthReportSendInterval` on `HttpGateway`.</span></span> <span data-ttu-id="1f300-183">Jak je uvedeno, je lepší volbou toosend hello sestavy s `Immediate` hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="1f300-183">As mentioned, a better option is toosend hello reports with `Immediate` true.</span></span> 

> [!NOTE]
> <span data-ttu-id="1f300-184">tooensure, který Neautorizováno služby nelze sestavy stavu proti hello entity v hello clusteru, nakonfigurovat hello serveru tooaccept požadavky jenom z zabezpečené klientů.</span><span class="sxs-lookup"><span data-stu-id="1f300-184">tooensure that unauthorized services can't report health against hello entities in hello cluster, configure hello server tooaccept requests only from secured clients.</span></span> <span data-ttu-id="1f300-185">Hello `FabricClient` použité pro generování sestav, musí mít povolené zabezpečení toobe možné toocommunicate s clusterem hello (například pomocí protokolu Kerberos nebo ověření certifikátu).</span><span class="sxs-lookup"><span data-stu-id="1f300-185">hello `FabricClient` used for reporting must have security enabled toobe able toocommunicate with hello cluster (for example, with Kerberos or certificate authentication).</span></span> <span data-ttu-id="1f300-186">Další informace o [clusteru zabezpečení](service-fabric-cluster-security.md).</span><span class="sxs-lookup"><span data-stu-id="1f300-186">Read more about [cluster security](service-fabric-cluster-security.md).</span></span>
> 
> 

## <a name="report-from-within-low-privilege-services"></a><span data-ttu-id="1f300-187">Sestava z v rámci služby nízkou úrovní oprávnění</span><span class="sxs-lookup"><span data-stu-id="1f300-187">Report from within low privilege services</span></span>
<span data-ttu-id="1f300-188">Pokud služby Service Fabric nemají clusteru toohello přístupu správce, můžete sestavu stavu na entity z aktuálního kontextu hello prostřednictvím `Partition` nebo `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="1f300-188">If Service Fabric services do not have admin access toohello cluster, you can report health on entities from hello current context through `Partition` or `CodePackageActivationContext`.</span></span>

* <span data-ttu-id="1f300-189">Pro bezstavové služby použijte [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport na aktuální instanci služby hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-189">For stateless services, use [IStatelessServicePartition.ReportInstanceHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatelessservicepartition.reportinstancehealth) tooreport on hello current service instance.</span></span>
* <span data-ttu-id="1f300-190">Pro stavové služby, použijte [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport na aktuální repliky.</span><span class="sxs-lookup"><span data-stu-id="1f300-190">For stateful services, use [IStatefulServicePartition.ReportReplicaHealth](https://docs.microsoft.com/dotnet/api/system.fabric.istatefulservicepartition.reportreplicahealth) tooreport on current replica.</span></span>
* <span data-ttu-id="1f300-191">Použití [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport u hello aktuální oddíl entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-191">Use [IServicePartition.ReportPartitionHealth](https://docs.microsoft.com/dotnet/api/system.fabric.iservicepartition.reportpartitionhealth) tooreport on hello current partition entity.</span></span>
* <span data-ttu-id="1f300-192">Použití [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport v aktuální aplikaci.</span><span class="sxs-lookup"><span data-stu-id="1f300-192">Use [CodePackageActivationContext.ReportApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportapplicationhealth) tooreport on current application.</span></span>
* <span data-ttu-id="1f300-193">Použití [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport na hello aktuální aplikace nasazené na aktuálním uzlu hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-193">Use [CodePackageActivationContext.ReportDeployedApplicationHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedapplicationhealth) tooreport on hello current application deployed on hello current node.</span></span>
* <span data-ttu-id="1f300-194">Použití [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport na balíček služby hello aplikace nasazené na aktuálním uzlu hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-194">Use [CodePackageActivationContext.ReportDeployedServicePackageHealth](https://docs.microsoft.com/dotnet/api/system.fabric.codepackageactivationcontext.reportdeployedservicepackagehealth) tooreport on a service package for hello application deployed on hello current node.</span></span>

> [!NOTE]
> <span data-ttu-id="1f300-195">Interně hello `Partition` a hello `CodePackageActivationContext` uložení stavu klienta konfiguruje s výchozím nastavením.</span><span class="sxs-lookup"><span data-stu-id="1f300-195">Internally, hello `Partition` and hello `CodePackageActivationContext` hold a health client configured with default settings.</span></span> <span data-ttu-id="1f300-196">Jak je popsáno pro hello [stavu klienta](service-fabric-report-health.md#health-client), sestavy se dávkují a posílají časovače.</span><span class="sxs-lookup"><span data-stu-id="1f300-196">As explained for hello [health client](service-fabric-report-health.md#health-client), reports are batched and sent on a timer.</span></span> <span data-ttu-id="1f300-197">objekty Hello by měl být zachovány zachování toohave sestavy hello toosend příležitosti.</span><span class="sxs-lookup"><span data-stu-id="1f300-197">hello objects should be kept alive toohave a chance toosend hello report.</span></span>
> 
> 

<span data-ttu-id="1f300-198">Můžete zadat `HealthReportSendOptions` při odesílání sestavy prostřednictvím `Partition` a `CodePackageActivationContext` stavu rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="1f300-198">You can specify `HealthReportSendOptions` when sending reports through `Partition` and `CodePackageActivationContext` health APIs.</span></span> <span data-ttu-id="1f300-199">Pokud máte kritická sestavy, které musí být nejdříve poslat, použijte `HealthReportSendOptions` s Immediate `true`.</span><span class="sxs-lookup"><span data-stu-id="1f300-199">If you have critical reports that must be sent as soon as possible, use `HealthReportSendOptions` with Immediate `true`.</span></span> <span data-ttu-id="1f300-200">Okamžitou sestavy nepoužívat hello dávkování interval hello interní stavu klienta.</span><span class="sxs-lookup"><span data-stu-id="1f300-200">Immediate reports bypass hello batching interval of hello internal health client.</span></span> <span data-ttu-id="1f300-201">Jak je uvedeno nahoře, použijte tento příznak dát pozor; Chceme tootake výhod hello stavu klienta dávkování kdykoli je to možné.</span><span class="sxs-lookup"><span data-stu-id="1f300-201">As mentioned before, use this flag with care; we want tootake advantage of hello health client batching whenever possible.</span></span>

## <a name="design-health-reporting"></a><span data-ttu-id="1f300-202">Návrh, vytváření sestav stavu</span><span class="sxs-lookup"><span data-stu-id="1f300-202">Design health reporting</span></span>
<span data-ttu-id="1f300-203">Hello prvním krokem při generování sestav vysoce kvalitní je identifikace hello podmínky, které může mít vliv na stav hello hello služby.</span><span class="sxs-lookup"><span data-stu-id="1f300-203">hello first step in generating high-quality reports is identifying hello conditions that can impact hello health of hello service.</span></span> <span data-ttu-id="1f300-204">Všechny podmínku, která může pomoci příznak problémy v clusteru nebo hello služby při jeho spuštění--nebo i lepší, než se stane problém – můžete potenciálně uložit až miliardy dolarů.</span><span class="sxs-lookup"><span data-stu-id="1f300-204">Any condition that can help flag problems in hello service or cluster when it starts--or even better, before a problem happens--can potentially save billions of dollars.</span></span> <span data-ttu-id="1f300-205">Hello výhody patří menší výpadek, méně noci čas strávený příčin a opravu problémů a vyšší spokojenost zákazníků.</span><span class="sxs-lookup"><span data-stu-id="1f300-205">hello benefits include less down time, fewer night hours spent investigating and repairing issues, and higher customer satisfaction.</span></span>

<span data-ttu-id="1f300-206">Jakmile hello podmínky jsou určeny, zapisovače sledovací zařízení nutné toofigure out hello nejlepší způsob, jak toomonitor je rovnováha mezi režii a použitelnosti.</span><span class="sxs-lookup"><span data-stu-id="1f300-206">Once hello conditions are identified, watchdog writers need toofigure out hello best way toomonitor them for balance between overhead and usefulness.</span></span> <span data-ttu-id="1f300-207">Představte si třeba služba, která nemá komplexní výpočty, které používají některé dočasné soubory ve sdílené složce.</span><span class="sxs-lookup"><span data-stu-id="1f300-207">For example, consider a service that does complex calculations that use some temporary files on a share.</span></span> <span data-ttu-id="1f300-208">Sledovací zařízení může sledovat tooensure hello sdílenou složku, že je k dispozici dostatek místa.</span><span class="sxs-lookup"><span data-stu-id="1f300-208">A watchdog could monitor hello share tooensure that enough space is available.</span></span> <span data-ttu-id="1f300-209">Ho může čekat na oznámení změn v souboru nebo adresáře.</span><span class="sxs-lookup"><span data-stu-id="1f300-209">It could listen for notifications of file or directory changes.</span></span> <span data-ttu-id="1f300-210">Upozornění ho může sestavu, pokud předem prahová hodnota je dosaženo a zobrazovat chyby, pokud sdílenou složku hello je plný.</span><span class="sxs-lookup"><span data-stu-id="1f300-210">It could report a warning if an upfront threshold is reached, and report an error if hello share is full.</span></span> <span data-ttu-id="1f300-211">Oprava systému na upozornění, může spustit čištění starší soubory ve sdílené složce hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-211">On a warning, a repair system could start cleaning up older files on hello share.</span></span> <span data-ttu-id="1f300-212">Při chybě může oprava systému přesunout hello služby repliky tooanother uzel.</span><span class="sxs-lookup"><span data-stu-id="1f300-212">On an error, a repair system could move hello service replica tooanother node.</span></span> <span data-ttu-id="1f300-213">Všimněte si, jak jsou popsané podmínky stavy hello z hlediska stavu: hello stav hello podmínku, která lze považovat za v pořádku (ok) nebo není v pořádku (upozornění nebo chyby).</span><span class="sxs-lookup"><span data-stu-id="1f300-213">Note how hello condition states are described in terms of health: hello state of hello condition that can be considered healthy (ok) or unhealthy (warning or error).</span></span>

<span data-ttu-id="1f300-214">Jakmile hello monitorování podrobnosti jsou nastaveny, zapisovač sledovací zařízení musí toofigure na tom, jak tooimplement hello sledovací zařízení.</span><span class="sxs-lookup"><span data-stu-id="1f300-214">Once hello monitoring details are set, a watchdog writer needs toofigure out how tooimplement hello watchdog.</span></span> <span data-ttu-id="1f300-215">Pokud podmínky hello lze určit v rámci služby hello, hello sledovací zařízení můžou být součástí samotné hello monitorované služby.</span><span class="sxs-lookup"><span data-stu-id="1f300-215">If hello conditions can be determined from within hello service, hello watchdog can be part of hello monitored service itself.</span></span> <span data-ttu-id="1f300-216">Například můžete kódu služby hello zkontrolujte využití hello sdílenou složku a potom nahlásit pokaždé, když se pokusí o toowrite soubor.</span><span class="sxs-lookup"><span data-stu-id="1f300-216">For example, hello service code can check hello share usage, and then report every time it tries toowrite a file.</span></span> <span data-ttu-id="1f300-217">Hello výhodou tohoto přístupu je, že vytváření sestav je jednoduché.</span><span class="sxs-lookup"><span data-stu-id="1f300-217">hello advantage of this approach is that reporting is simple.</span></span> <span data-ttu-id="1f300-218">Musí být pozor tooprevent sledovací zařízení chyby z hello funkcí služby, které mají vliv.</span><span class="sxs-lookup"><span data-stu-id="1f300-218">Care must be taken tooprevent watchdog bugs from impacting hello service functionality.</span></span>

<span data-ttu-id="1f300-219">Generování sestav z v rámci hello monitorované služby není vždy možnost.</span><span class="sxs-lookup"><span data-stu-id="1f300-219">Reporting from within hello monitored service is not always an option.</span></span> <span data-ttu-id="1f300-220">Sledovací zařízení v rámci služby hello nemusí být možné toodetect hello podmínky.</span><span class="sxs-lookup"><span data-stu-id="1f300-220">A watchdog within hello service may not be able toodetect hello conditions.</span></span> <span data-ttu-id="1f300-221">Něj nemusí být hello logiku nebo data toomake hello rozhodnutí.</span><span class="sxs-lookup"><span data-stu-id="1f300-221">It may not have hello logic or data toomake hello determination.</span></span> <span data-ttu-id="1f300-222">Hello režii při sledování hello podmínek může být vysoká.</span><span class="sxs-lookup"><span data-stu-id="1f300-222">hello overhead of monitoring hello conditions may be high.</span></span> <span data-ttu-id="1f300-223">podmínky Hello také může nesmí být konkrétní tooa služby, ale místo toho ovlivnit interakce mezi službami.</span><span class="sxs-lookup"><span data-stu-id="1f300-223">hello conditions also may not be specific tooa service, but instead affect interactions between services.</span></span> <span data-ttu-id="1f300-224">Další možností je toohave watchdogs v clusteru hello jako samostatné procesy.</span><span class="sxs-lookup"><span data-stu-id="1f300-224">Another option is toohave watchdogs in hello cluster as separate processes.</span></span> <span data-ttu-id="1f300-225">Hello watchdogs monitorování hello podmínky a sestavy, aniž by to ovlivnilo hello hlavní služby žádným způsobem.</span><span class="sxs-lookup"><span data-stu-id="1f300-225">hello watchdogs monitor hello conditions and report, without affecting hello main services in any way.</span></span> <span data-ttu-id="1f300-226">Například může být tyto watchdogs implementovaný jako bezstavové služby v hello stejnou aplikaci, nasazené na všech uzlech nebo hello stejným uzlům jako služba hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-226">For example, these watchdogs could be implemented as stateless services in hello same application, deployed on all nodes or on hello same nodes as hello service.</span></span>

<span data-ttu-id="1f300-227">V některých případech sledovací zařízení spuštěna v clusteru hello není možnost buď.</span><span class="sxs-lookup"><span data-stu-id="1f300-227">Sometimes, a watchdog running in hello cluster is not an option either.</span></span> <span data-ttu-id="1f300-228">Pokud hello monitorovat stav dostupnosti hello nebo funkce služby hello jako uživatele nevidíte, je nejlepší watchdogs hello toohave v hello stejné umístění jako klienti hello uživatele.</span><span class="sxs-lookup"><span data-stu-id="1f300-228">If hello monitored condition is hello availability or functionality of hello service as users see it, it's best toohave hello watchdogs in hello same place as hello user clients.</span></span> <span data-ttu-id="1f300-229">Zde můžete otestovat hello operace v hello stejným uživatelům způsob, jak volat.</span><span class="sxs-lookup"><span data-stu-id="1f300-229">There, they can test hello operations in hello same way users call them.</span></span> <span data-ttu-id="1f300-230">Například můžete mít sledovací zařízení, který je umístěn mimo hello cluster, vydává žádosti o služby toohello a ověří hello latence a správnost hello výsledku.</span><span class="sxs-lookup"><span data-stu-id="1f300-230">For example, you can have a watchdog that lives outside hello cluster, issues requests toohello service, and checks hello latency and correctness of hello result.</span></span> <span data-ttu-id="1f300-231">(Pro službu kalkulačky, například 2 + 2 nevrátí 4 v přiměřené době?)</span><span class="sxs-lookup"><span data-stu-id="1f300-231">(For a calculator service, for example, does 2+2 return 4 in a reasonable amount of time?)</span></span>

<span data-ttu-id="1f300-232">Jakmile udrželi podrobnosti hello sledovací zařízení byste měli rozhodnout na ID zdroje, který jednoznačně identifikuje.</span><span class="sxs-lookup"><span data-stu-id="1f300-232">Once hello watchdog details have been finalized, you should decide on a source ID that uniquely identifies it.</span></span> <span data-ttu-id="1f300-233">Pokud více watchdogs hello stejného typu žijí v hello clusteru, se musí hlásit různých entit nebo, pokud budou hlásit hello stejné entity, použijte jiný zdroj ID nebo vlastnost.</span><span class="sxs-lookup"><span data-stu-id="1f300-233">If multiple watchdogs of hello same type are living in hello cluster, they must report on different entities, or, if they report on hello same entity, use different source ID or property.</span></span> <span data-ttu-id="1f300-234">Tímto způsobem jejich sestavy mohou existovat vedle sebe.</span><span class="sxs-lookup"><span data-stu-id="1f300-234">This way, their reports can coexist.</span></span> <span data-ttu-id="1f300-235">Vlastnost Hello sestava stavu hello měli zaznamenat hello monitorovat stav.</span><span class="sxs-lookup"><span data-stu-id="1f300-235">hello property of hello health report should capture hello monitored condition.</span></span> <span data-ttu-id="1f300-236">(Například hello výše, může být vlastnost hello **ShareSize**.) Pokud více sestav použít toohello stejné podmínky hello vlastnost by měla obsahovat některé dynamické informace, které umožňuje toocoexist sestavy.</span><span class="sxs-lookup"><span data-stu-id="1f300-236">(For hello example above, hello property could be **ShareSize**.) If multiple reports apply toohello same condition, hello property should contain some dynamic information that allows reports toocoexist.</span></span> <span data-ttu-id="1f300-237">Například pokud více sdílených složek potřebovat toobe monitorován, název vlastnosti hello může být **ShareSize sharename**.</span><span class="sxs-lookup"><span data-stu-id="1f300-237">For example, if multiple shares need toobe monitored, hello property name can be **ShareSize-sharename**.</span></span>

> [!NOTE]
> <span data-ttu-id="1f300-238">Proveďte *není* použít hello úložiště tookeep informace o stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-238">Do *not* use hello health store tookeep status information.</span></span> <span data-ttu-id="1f300-239">Pouze informace týkající se stavu musí uvádět jako stavu, jako tento informace ovlivňuje hello vyhodnocování stavu entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-239">Only health-related information should be reported as health, as this information impacts hello health evaluation of an entity.</span></span> <span data-ttu-id="1f300-240">úložiště stavu Hello nebyl navržen jako úložiště pro obecné účely.</span><span class="sxs-lookup"><span data-stu-id="1f300-240">hello health store was not designed as a general-purpose store.</span></span> <span data-ttu-id="1f300-241">Používá tooaggregate logiku vyhodnocení stavu všechna data do stavu hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-241">It uses health evaluation logic tooaggregate all data into hello health state.</span></span> <span data-ttu-id="1f300-242">Odesílání informací, že nesouvisejícími toohealth (jako je vytváření sestav stavu s stav OK) nebude mít vliv na hello Agregovat stav, ale může negativně ovlivnit výkon hello hello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-242">Sending information unrelated toohealth (like reporting status with a health state of OK) doesn't impact hello aggregated health state, but it can negatively affect hello performance of hello health store.</span></span>
> 
> 

<span data-ttu-id="1f300-243">Dalším kritériem při rozhodování Hello je které tooreport entity na.</span><span class="sxs-lookup"><span data-stu-id="1f300-243">hello next decision point is which entity tooreport on.</span></span> <span data-ttu-id="1f300-244">Většina hello času, podmínku hello jasně idetifies hello entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-244">Most of hello time, hello condition clearly idetifies hello entity.</span></span> <span data-ttu-id="1f300-245">Zvolte hello entity s rozlišením nejlepší možný.</span><span class="sxs-lookup"><span data-stu-id="1f300-245">Choose hello entity with best possible granularity.</span></span> <span data-ttu-id="1f300-246">Pokud stav má dopad na všechny repliky v oddílu, zprávu o hello oddílu, nikoli na hello služby.</span><span class="sxs-lookup"><span data-stu-id="1f300-246">If a condition impacts all replicas in a partition, report on hello partition, not on hello service.</span></span> <span data-ttu-id="1f300-247">Existují případy rohu, kde další myšlenku je potřeba, když.</span><span class="sxs-lookup"><span data-stu-id="1f300-247">There are corner cases where more thought is needed, though.</span></span> <span data-ttu-id="1f300-248">Pokud podmínky hello ovlivňuje entity, jako je například repliku, ale hello desire je podmínka hello toohave příznakem déle než hello doba života repliky, pak by měl být ohlášeny hello oddílu.</span><span class="sxs-lookup"><span data-stu-id="1f300-248">If hello condition impacts an entity, such as a replica, but hello desire is toohave hello condition flagged for more than hello duration of replica life, then it should be reported on hello partition.</span></span> <span data-ttu-id="1f300-249">Jinak při odstranění repliky hello úložiště stavu hello vyčistí její sestavy.</span><span class="sxs-lookup"><span data-stu-id="1f300-249">Otherwise, when hello replica is deleted, hello health store cleans up all its reports.</span></span> <span data-ttu-id="1f300-250">Sledovací zařízení zapisovače musí vzít v úvahu hello životnosti hello sestavy a hello entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-250">Watchdog writers must think about hello lifetimes of hello entity and hello report.</span></span> <span data-ttu-id="1f300-251">Musí být zrušte, pokud by měla být vyčištěna sestavy z úložiště (například při chybě oznámené entitu již nepoužívá.).</span><span class="sxs-lookup"><span data-stu-id="1f300-251">It must be clear when a report should be cleaned up from a store (for example, when an error reported on an entity no longer applies).</span></span>

<span data-ttu-id="1f300-252">Podívejme se na příklad, který převádí společně hello body, které I popsané.</span><span class="sxs-lookup"><span data-stu-id="1f300-252">Let's look at an example that puts together hello points I described.</span></span> <span data-ttu-id="1f300-253">Vezměte v úvahu, že aplikace Service Fabric se skládá z hlavní stavové služby trvalé a sekundární bezstavové služby nasazeni na všechny uzly (jeden typ sekundární služby pro každý typ úlohy).</span><span class="sxs-lookup"><span data-stu-id="1f300-253">Consider a Service Fabric application composed of a master stateful persistent service and secondary stateless services deployed on all nodes (one secondary service type for each type of task).</span></span> <span data-ttu-id="1f300-254">hlavní server Hello má zpracování fronty, který obsahuje příkazy toobe provedený sekundární repliky.</span><span class="sxs-lookup"><span data-stu-id="1f300-254">hello master has a processing queue that contains commands toobe executed by secondaries.</span></span> <span data-ttu-id="1f300-255">sekundární databáze Hello hello příchozích žádostí a odesílání signálů back potvrzení.</span><span class="sxs-lookup"><span data-stu-id="1f300-255">hello secondaries execute hello incoming requests and send back acknowledgement signals.</span></span> <span data-ttu-id="1f300-256">Jednu podmínku, která může sledovat je hello délka fronty hlavní zpracování hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-256">One condition that could be monitored is hello length of hello master processing queue.</span></span> <span data-ttu-id="1f300-257">Pokud délka fronty hlavní hello dosáhne prahové hodnoty, je uvedená upozornění.</span><span class="sxs-lookup"><span data-stu-id="1f300-257">If hello master queue length reaches a threshold, a warning is reported.</span></span> <span data-ttu-id="1f300-258">upozornění Hello označuje, že sekundární repliky hello nemůže zpracovat hello zatížení.</span><span class="sxs-lookup"><span data-stu-id="1f300-258">hello warning indicates that hello secondaries can't handle hello load.</span></span> <span data-ttu-id="1f300-259">Pokud hello fronty dosáhne hello maximální délku a příkazy jsou vyřadit, zobrazí se chybová zpráva, jako hello služby nelze obnovit.</span><span class="sxs-lookup"><span data-stu-id="1f300-259">If hello queue reaches hello maximum length and commands are dropped, an error is reported, as hello service can't recover.</span></span> <span data-ttu-id="1f300-260">Hello sestav lze u vlastnosti hello **QueueStatus**.</span><span class="sxs-lookup"><span data-stu-id="1f300-260">hello reports can be on hello property **QueueStatus**.</span></span> <span data-ttu-id="1f300-261">sledovací zařízení Hello je umístěn uvnitř hello služby a se pravidelně odesílají na hello hlavní primární repliky.</span><span class="sxs-lookup"><span data-stu-id="1f300-261">hello watchdog lives inside hello service, and it's sent periodically on hello master primary replica.</span></span> <span data-ttu-id="1f300-262">čas Hello toolive dvě minuty, a odesláním pravidelně každých 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-262">hello time toolive is two minutes, and it's sent periodically every 30 seconds.</span></span> <span data-ttu-id="1f300-263">Pokud primární hello přestane fungovat, sestava hello je automaticky vyčistí z úložiště.</span><span class="sxs-lookup"><span data-stu-id="1f300-263">If hello primary goes down, hello report is cleaned up automatically from store.</span></span> <span data-ttu-id="1f300-264">Pokud replika služby hello je zapnutý, ale je zablokována nebo jiné problémy s hello sestavy vyprší v hello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-264">If hello service replica is up, but it is deadlocked or having other issues, hello report expires in hello health store.</span></span> <span data-ttu-id="1f300-265">V takovém případě je hello entity vyhodnocovány v chybě.</span><span class="sxs-lookup"><span data-stu-id="1f300-265">In this case, hello entity is evaluated at error.</span></span>

<span data-ttu-id="1f300-266">Jiná podmínka, která se dá sledovat je čas spuštění úlohy.</span><span class="sxs-lookup"><span data-stu-id="1f300-266">Another condition that can be monitored is task execution time.</span></span> <span data-ttu-id="1f300-267">Hello hlavní distribuuje úkoly toohello sekundárních založený na typu úloh hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-267">hello master distributes tasks toohello secondaries based on hello task type.</span></span> <span data-ttu-id="1f300-268">V závislosti na hello návrhu může dotazovat hello hlavní hello sekundární databáze pro stav úlohy.</span><span class="sxs-lookup"><span data-stu-id="1f300-268">Depending on hello design, hello master could poll hello secondaries for task status.</span></span> <span data-ttu-id="1f300-269">Ho může také počkejte sekundárních toosend back potvrzení signály Pokud se provádí.</span><span class="sxs-lookup"><span data-stu-id="1f300-269">It could also wait for secondaries toosend back acknowledgement signals when they are done.</span></span> <span data-ttu-id="1f300-270">V druhém případě hello musí dát pozor toodetect situacích, kdy jsou ztraceny die sekundární repliky nebo zprávy.</span><span class="sxs-lookup"><span data-stu-id="1f300-270">In hello second case, care must be taken toodetect situations where secondaries die or messages are lost.</span></span> <span data-ttu-id="1f300-271">Jednou z možností je pro hlavní toosend hello toohello požadavku ping stejné sekundární, který odesílá zpět jeho stav.</span><span class="sxs-lookup"><span data-stu-id="1f300-271">One option is for hello master toosend a ping request toohello same secondary, which sends back its status.</span></span> <span data-ttu-id="1f300-272">Pokud není žádná stav, hlavní hello bude považovat za selhání a provádí změny plánu úlohy hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-272">If no status is received, hello master considers it a failure and reschedules hello task.</span></span> <span data-ttu-id="1f300-273">Toto chování předpokládá, že se úlohy hello idempotent.</span><span class="sxs-lookup"><span data-stu-id="1f300-273">This behavior assumes that hello tasks are idempotent.</span></span>

<span data-ttu-id="1f300-274">Hello monitorovat stav lze přeložit jako varování, pokud úloha hello neprobíhá v určitou dobu (**t1**, například 10 minut).</span><span class="sxs-lookup"><span data-stu-id="1f300-274">hello monitored condition can be translated as a warning if hello task is not done in a certain time (**t1**, for example 10 minutes).</span></span> <span data-ttu-id="1f300-275">Pokud hello úloha není dokončena v čase (**t2**, například 20 minut), podmínka hello monitorovat lze přeložit jako chyba.</span><span class="sxs-lookup"><span data-stu-id="1f300-275">If hello task is not completed in time (**t2**, for example 20 minutes), hello monitored condition can be translated as Error.</span></span> <span data-ttu-id="1f300-276">Vytváření těchto sestav lze provést několika způsoby:</span><span class="sxs-lookup"><span data-stu-id="1f300-276">This reporting can be done in multiple ways:</span></span>

* <span data-ttu-id="1f300-277">hlavní primární repliky Hello hlásí pravidelně sám na sobě.</span><span class="sxs-lookup"><span data-stu-id="1f300-277">hello master primary replica reports on itself periodically.</span></span> <span data-ttu-id="1f300-278">Může mít jednu vlastnost pro všechny úlohy čekající na vyřízení ve frontě hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-278">You can have one property for all pending tasks in hello queue.</span></span> <span data-ttu-id="1f300-279">Pokud alespoň jedna úloha trvá déle, hello zprávy o stavu u vlastnosti hello **PendingTasks** je upozornění nebo chyby, podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="1f300-279">If at least one task takes longer, hello report status on hello property **PendingTasks** is a warning or error, as appropriate.</span></span> <span data-ttu-id="1f300-280">Pokud neexistují žádné čekající úlohy nebo všech úloh spustil provádění, je hello zprávy o stavu v pořádku.</span><span class="sxs-lookup"><span data-stu-id="1f300-280">If there are no pending tasks or all tasks started execution, hello report status is OK.</span></span> <span data-ttu-id="1f300-281">Hello úlohy jsou trvalé.</span><span class="sxs-lookup"><span data-stu-id="1f300-281">hello tasks are persistent.</span></span> <span data-ttu-id="1f300-282">Pokud primární hello přestane fungovat, hello nově povýší primární můžete dál tooreport správně.</span><span class="sxs-lookup"><span data-stu-id="1f300-282">If hello primary goes down, hello newly promoted primary can continue tooreport properly.</span></span>
* <span data-ttu-id="1f300-283">Jiný proces sledovací zařízení (v cloudu hello nebo externí) kontroluje hello úlohy (z mimo, podle potřeby hello výsledek úlohy) toosee, pokud jejich dokončení.</span><span class="sxs-lookup"><span data-stu-id="1f300-283">Another watchdog process (in hello cloud or external) checks hello tasks (from outside, based on hello desired task result) toosee if they are completed.</span></span> <span data-ttu-id="1f300-284">Pokud nerespektují hello prahové hodnoty, sestavy se odesílají na hlavní služby hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-284">If they do not respect hello thresholds, a report is sent on hello master service.</span></span> <span data-ttu-id="1f300-285">Sestavy se také odesílají na každý úkol, který obsahuje identifikátor hello úlohy, jako je třeba **PendingTask + taskId**.</span><span class="sxs-lookup"><span data-stu-id="1f300-285">A report is also sent on each task that includes hello task identifier, like **PendingTask+taskId**.</span></span> <span data-ttu-id="1f300-286">Sestavy by měly být odeslány pouze na stavy není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="1f300-286">Reports should be sent only on unhealthy states.</span></span> <span data-ttu-id="1f300-287">Nastavte čas toolive tooa několik minut a označit toobe hello sestavy odebrány při vypršení jejich platnosti tooensure čištění.</span><span class="sxs-lookup"><span data-stu-id="1f300-287">Set time toolive tooa few minutes, and mark hello reports toobe removed when they expire tooensure cleanup.</span></span>
* <span data-ttu-id="1f300-288">Hello sekundární, který spouští úlohu nahlásí, když ho trvá déle než očekávané toorun ho.</span><span class="sxs-lookup"><span data-stu-id="1f300-288">hello secondary that is executing a task reports when it takes longer than expected toorun it.</span></span> <span data-ttu-id="1f300-289">Oznámí na instanci služby hello u vlastnosti hello **PendingTasks**.</span><span class="sxs-lookup"><span data-stu-id="1f300-289">It reports on hello service instance on hello property **PendingTasks**.</span></span> <span data-ttu-id="1f300-290">Sestava Hello zjišťuje hello instance služby, který má potíže, ale neukládá hello situaci, kdy kterou hello instance.</span><span class="sxs-lookup"><span data-stu-id="1f300-290">hello report pinpoints hello service instance that has issues, but it doesn't capture hello situation where hello instance dies.</span></span> <span data-ttu-id="1f300-291">Hello sestavy jsou pak vyčistit.</span><span class="sxs-lookup"><span data-stu-id="1f300-291">hello reports are cleaned up then.</span></span> <span data-ttu-id="1f300-292">Ho může zprávu o sekundární službu hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-292">It could report on hello secondary service.</span></span> <span data-ttu-id="1f300-293">Pokud hello sekundární dokončí úlohu hello, sekundární instance hello vymaže hello sestavy z úložiště hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-293">If hello secondary completes hello task, hello secondary instance clears hello report from hello store.</span></span> <span data-ttu-id="1f300-294">Hello sestavu neukládá hello situaci, kdy dojde ke ztrátě uvítací zprávu potvrzení a hello úkol není dokončen z hlediska hlavního hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-294">hello report doesn't capture hello situation where hello acknowledgement message is lost and hello task is not finished from hello master's point of view.</span></span>

<span data-ttu-id="1f300-295">Ale hello reporting se provádí v případech hello popsané výše, hello sestavy při vyhodnocování stavu zaznamenání ve stavu aplikace.</span><span class="sxs-lookup"><span data-stu-id="1f300-295">However hello reporting is done in hello cases described above, hello reports are captured in application health when health is evaluated.</span></span>

## <a name="report-periodically-vs-on-transition"></a><span data-ttu-id="1f300-296">Sestava pravidelně oproti na přechod</span><span class="sxs-lookup"><span data-stu-id="1f300-296">Report periodically vs. on transition</span></span>
<span data-ttu-id="1f300-297">Pomocí vykazování modelu stavu hello watchdogs sestavy můžete odesílat pravidelně nebo na přechody.</span><span class="sxs-lookup"><span data-stu-id="1f300-297">By using hello health reporting model, watchdogs can send reports periodically or on transitions.</span></span> <span data-ttu-id="1f300-298">Hello doporučoval způsob pro sledovací zařízení vytváření sestav je pravidelně, protože hello kód je mnohem jednodušší a méně náchylná tooerrors.</span><span class="sxs-lookup"><span data-stu-id="1f300-298">hello recommended way for watchdog reporting is periodically, because hello code is much simpler and less prone tooerrors.</span></span> <span data-ttu-id="1f300-299">Hello watchdogs musí zajistit toobe stejně jednoduché jako možné tooavoid chyby, které aktivují nesprávné sestavy.</span><span class="sxs-lookup"><span data-stu-id="1f300-299">hello watchdogs must strive toobe as simple as possible tooavoid bugs that trigger incorrect reports.</span></span> <span data-ttu-id="1f300-300">Nesprávný *není v pořádku* sestavy vliv vyhodnocení stavu a scénáře podle stavu, včetně upgrady.</span><span class="sxs-lookup"><span data-stu-id="1f300-300">Incorrect *unhealthy* reports impact health evaluations and scenarios based on health, including upgrades.</span></span> <span data-ttu-id="1f300-301">Nesprávný *pořádku* sestavy skrýt problémy v hello clusteru, což není žádoucí.</span><span class="sxs-lookup"><span data-stu-id="1f300-301">Incorrect *healthy* reports hide issues in hello cluster, which is not desired.</span></span>

<span data-ttu-id="1f300-302">Pro pravidelné vytváření sestav, se dá implementovat s časovačem hello sledovací zařízení.</span><span class="sxs-lookup"><span data-stu-id="1f300-302">For periodic reporting, hello watchdog can be implemented with a timer.</span></span> <span data-ttu-id="1f300-303">Na zpětné volání časovače můžete hello sledovací zařízení zkontrolujte stav hello a odesílat sestavy na základě aktuálního stavu hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-303">On a timer callback, hello watchdog can check hello state and send a report based on hello current state.</span></span> <span data-ttu-id="1f300-304">Neexistuje žádné toosee třeba která sestava byla odeslána dříve nebo se přesvědčte, žádné optimalizace z hlediska zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="1f300-304">There is no need toosee which report was sent previously or make any optimizations in terms of messaging.</span></span> <span data-ttu-id="1f300-305">Hello stavu klienta má dávkování logiku toohelp s výkonem.</span><span class="sxs-lookup"><span data-stu-id="1f300-305">hello health client has batching logic toohelp with performance.</span></span> <span data-ttu-id="1f300-306">Při hello stavu klienta je udržováno zachování připojení, se pokusí interně dokud hello sestavy je potvrzena hello stavu úložiště nebo sledovací zařízení hello vytváří novější sestavu s hello stejné entity, vlastnosti a zdroj.</span><span class="sxs-lookup"><span data-stu-id="1f300-306">While hello health client is kept alive, it retries internally until hello report is acknowledged by hello health store or hello watchdog generates a newer report with hello same entity, property, and source.</span></span>

<span data-ttu-id="1f300-307">Vytváření sestav na přechody vyžaduje pečlivě zpracování stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-307">Reporting on transitions requires careful handling of state.</span></span> <span data-ttu-id="1f300-308">sledovací zařízení Hello monitoruje některé podmínky a sestavy pouze v případě, že se změní stav hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-308">hello watchdog monitors some conditions and reports only when hello conditions change.</span></span> <span data-ttu-id="1f300-309">Hello vzhůru tohoto přístupu je, že jsou potřeba méně sestavy.</span><span class="sxs-lookup"><span data-stu-id="1f300-309">hello upside of this approach is that fewer reports are needed.</span></span> <span data-ttu-id="1f300-310">Nevýhodou Hello je komplexní logiku hello hello sledovací zařízení.</span><span class="sxs-lookup"><span data-stu-id="1f300-310">hello downside is that hello logic of hello watchdog is complex.</span></span> <span data-ttu-id="1f300-311">sledovací zařízení Hello musí zachovat hello podmínky nebo hello sestav tak, aby bylo možné je zkontrolovanou toodetermine změny stavu.</span><span class="sxs-lookup"><span data-stu-id="1f300-311">hello watchdog must maintain hello conditions or hello reports, so that they can be inspected toodetermine state changes.</span></span> <span data-ttu-id="1f300-312">Na převzetí služeb při selhání se musí dát pozor se sestavami, přidat, ale dosud nebyl odeslán toohello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-312">On failover, care must be taken with reports added, but not yet sent toohello health store.</span></span> <span data-ttu-id="1f300-313">Hello pořadové číslo musí být stále rostoucí.</span><span class="sxs-lookup"><span data-stu-id="1f300-313">hello sequence number must be ever-increasing.</span></span> <span data-ttu-id="1f300-314">Pokud ne, hello sestavy jsou odmítnuty jako zastaralé.</span><span class="sxs-lookup"><span data-stu-id="1f300-314">If not, hello reports are rejected as stale.</span></span> <span data-ttu-id="1f300-315">Ve výjimečných případech hello kde při ztrátě dat může být potřeba synchronizace mezi hello stav hello ohlašování a stav hello hello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-315">In hello rare cases where data loss is incurred, synchronization may be needed between hello state of hello reporter and hello state of hello health store.</span></span>

<span data-ttu-id="1f300-316">Zprávy o přechody smysl pro služby vytváření sestav na sami, prostřednictvím `Partition` nebo `CodePackageActivationContext`.</span><span class="sxs-lookup"><span data-stu-id="1f300-316">Reporting on transitions makes sense for services reporting on themselves, through `Partition` or `CodePackageActivationContext`.</span></span> <span data-ttu-id="1f300-317">Když hello místní objektu (repliky nebo nasazený balíček služby / nasazené aplikace) je odebrána, všechny její sestavy jsou také odebrány.</span><span class="sxs-lookup"><span data-stu-id="1f300-317">When hello local object (replica or deployed service package / deployed application) is removed, all its reports are also removed.</span></span> <span data-ttu-id="1f300-318">Toto automatické čištění zmírní hello potřebu synchronizace mezi ohlašování a health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-318">This automatic cleanup relaxes hello need for synchronization between reporter and health store.</span></span> <span data-ttu-id="1f300-319">Pokud sestava hello se nadřazený oddíl nebo nadřazená aplikace, musí dát pozor na převzetí služeb při selhání tooavoid zastaralé sestavy v hello health store.</span><span class="sxs-lookup"><span data-stu-id="1f300-319">If hello report is for parent partition or parent application, care must be taken on failover tooavoid stale reports in hello health store.</span></span> <span data-ttu-id="1f300-320">Logika je nutné přidat toomaintain hello správný stav a sestavy zrušte hello z úložiště, když už není potřeba.</span><span class="sxs-lookup"><span data-stu-id="1f300-320">Logic must be added toomaintain hello correct state and clear hello report from store when not needed anymore.</span></span>

## <a name="implement-health-reporting"></a><span data-ttu-id="1f300-321">Implementovat, vytváření sestav stavu</span><span class="sxs-lookup"><span data-stu-id="1f300-321">Implement health reporting</span></span>
<span data-ttu-id="1f300-322">Jakmile entity a sestavu Podrobnosti jsou hello jasné, odesílání sestav stavu lze provést prostřednictvím rozhraní API hello, prostředí PowerShell nebo REST.</span><span class="sxs-lookup"><span data-stu-id="1f300-322">Once hello entity and report details are clear, sending health reports can be done through hello API, PowerShell, or REST.</span></span>

### <a name="api"></a><span data-ttu-id="1f300-323">Rozhraní API</span><span class="sxs-lookup"><span data-stu-id="1f300-323">API</span></span>
<span data-ttu-id="1f300-324">tooreport prostřednictvím hello rozhraní API, musíte toocreate typ entity konkrétní toohello sestavy stavu, který chtějí tooreport na.</span><span class="sxs-lookup"><span data-stu-id="1f300-324">tooreport through hello API, you need toocreate a health report specific toohello entity type they want tooreport on.</span></span> <span data-ttu-id="1f300-325">Dejte hello sestavy tooa stavu klienta.</span><span class="sxs-lookup"><span data-stu-id="1f300-325">Give hello report tooa health client.</span></span> <span data-ttu-id="1f300-326">Alternativně vytvořte informace o stavu a předejte jej toocorrect reporting metody na `Partition` nebo `CodePackageActivationContext` tooreport na aktuální entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-326">Alternatively, create a health information and pass it toocorrect reporting methods on `Partition` or `CodePackageActivationContext` tooreport on current entities.</span></span>

<span data-ttu-id="1f300-327">Následující příklad ukazuje Hello pravidelné generování sestav z sledovací zařízení v rámci clusteru hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-327">hello following example shows periodic reporting from a watchdog within hello cluster.</span></span> <span data-ttu-id="1f300-328">sledovací zařízení Hello kontroluje, zda externí prostředek je přístupná z v rámci uzlu.</span><span class="sxs-lookup"><span data-stu-id="1f300-328">hello watchdog checks whether an external resource can be accessed from within a node.</span></span> <span data-ttu-id="1f300-329">Hello prostředků je potřeba manifest služby v rámci aplikace hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-329">hello resource is needed by a service manifest within hello application.</span></span> <span data-ttu-id="1f300-330">Pokud není k dispozici prostředek hello, hello jiných služeb v rámci aplikace hello můžete i nadále fungovat správně.</span><span class="sxs-lookup"><span data-stu-id="1f300-330">If hello resource is unavailable, hello other services within hello application can still function properly.</span></span> <span data-ttu-id="1f300-331">Proto hello sestavy se odesílají na hello nasazené služby balíček entity každých 30 sekund.</span><span class="sxs-lookup"><span data-stu-id="1f300-331">Therefore, hello report is sent on hello deployed service package entity every 30 seconds.</span></span>

```csharp
private static Uri ApplicationName = new Uri("fabric:/WordCount");
private static string ServiceManifestName = "WordCount.Service";
private static string NodeName = FabricRuntime.GetNodeContext().NodeName;
private static Timer ReportTimer = new Timer(new TimerCallback(SendReport), null, 30 * 1000, 30 * 1000);
private static FabricClient Client = new FabricClient(new FabricClientSettings() { HealthReportSendInterval = TimeSpan.FromSeconds(0) });

public static void SendReport(object obj)
{
    // Test whether hello resource can be accessed from hello node
    HealthState healthState = this.TestConnectivityToExternalResource();

    // Send report on deployed service package, as hello connectivity is needed by hello specific service manifest
    // and can be different on different nodes
    var deployedServicePackageHealthReport = new DeployedServicePackageHealthReport(
        ApplicationName,
        ServiceManifestName,
        NodeName,
        new HealthInformation("ExternalSourceWatcher", "Connectivity", healthState));

    // TODO: handle exception. Code omitted for snippet brevity.
    // Possible exceptions: FabricException with error codes
    // FabricHealthStaleReport (non-retryable, hello report is already queued on hello health client),
    // FabricHealthMaxReportsReached (retryable; user should retry with exponential delay until hello report is accepted).
    Client.HealthManager.ReportHealth(deployedServicePackageHealthReport);
}
```

### <a name="powershell"></a><span data-ttu-id="1f300-332">PowerShell</span><span class="sxs-lookup"><span data-stu-id="1f300-332">PowerShell</span></span>
<span data-ttu-id="1f300-333">Odesílat zprávy o stavu s  **odeslání ServiceFabric*EntityType*HealthReport **.</span><span class="sxs-lookup"><span data-stu-id="1f300-333">Send health reports with **Send-ServiceFabric*EntityType*HealthReport**.</span></span>

<span data-ttu-id="1f300-334">Následující příklad ukazuje Hello pravidelné vytváření sestav na hodnoty využití procesoru na uzlu.</span><span class="sxs-lookup"><span data-stu-id="1f300-334">hello following example shows periodic reporting on CPU values on a node.</span></span> <span data-ttu-id="1f300-335">sestavy Hello by měly být odeslány každých 30 sekund a mají čas toolive dvě minuty.</span><span class="sxs-lookup"><span data-stu-id="1f300-335">hello reports should be sent every 30 seconds, and they have a time toolive of two minutes.</span></span> <span data-ttu-id="1f300-336">Pokud vypršení jejich platnosti, hello zpravodaje, která má problémy, tak uzel hello je vyhodnocován v chybě.</span><span class="sxs-lookup"><span data-stu-id="1f300-336">If they expire, hello reporter has issues, so hello node is evaluated at error.</span></span> <span data-ttu-id="1f300-337">Když hello procesoru je nad prahovou hodnotou, hello sestava má stav varování.</span><span class="sxs-lookup"><span data-stu-id="1f300-337">When hello CPU is above a threshold, hello report has a health state of warning.</span></span> <span data-ttu-id="1f300-338">Pokud hello procesoru zůstává nad prahovou hodnotu pro více než čas hello nakonfigurované, uvede se jako chyba.</span><span class="sxs-lookup"><span data-stu-id="1f300-338">When hello CPU remains above a threshold for more than hello configured time, it's reported as an error.</span></span> <span data-ttu-id="1f300-339">V opačném hello zpravodaje, která odešle stav OK.</span><span class="sxs-lookup"><span data-stu-id="1f300-339">Otherwise, hello reporter sends a health state of OK.</span></span>

```powershell
PS C:\> Send-ServiceFabricNodeHealthReport -NodeName Node.1 -HealthState Warning -SourceId PowershellWatcher -HealthProperty CPU -Description "CPU is above 80% threshold" -TimeToLiveSec 120

PS C:\> Get-ServiceFabricNodeHealth -NodeName Node.1
NodeName              : Node.1
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='CPU', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.FM
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 5
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Fabric node is up.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : CPU
                        HealthState           : Warning
                        SequenceNumber        : 130741236814913394
                        SentAt                : 4/21/2015 9:01:21 PM
                        ReceivedAt            : 4/21/2015 9:01:21 PM
                        TTL                   : 00:02:00
                        Description           : CPU is above 80% threshold
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:01:21 PM
```

<span data-ttu-id="1f300-340">Hello následující příklad hlásí přechodný upozornění v replice.</span><span class="sxs-lookup"><span data-stu-id="1f300-340">hello following example reports a transient warning on a replica.</span></span> <span data-ttu-id="1f300-341">Nejdřív získá ID oddílu hello a pak hello ID repliky služby hello, kterou je zajímá.</span><span class="sxs-lookup"><span data-stu-id="1f300-341">It first gets hello partition ID and then hello replica ID for hello service it is interested in.</span></span> <span data-ttu-id="1f300-342">Pak odešle zprávu z **PowershellWatcher** u vlastnosti hello **ResourceDependency**.</span><span class="sxs-lookup"><span data-stu-id="1f300-342">It then sends a report from **PowershellWatcher** on hello property **ResourceDependency**.</span></span> <span data-ttu-id="1f300-343">Hello zprávy týkající se pouze dvě minuty, a automaticky odebrán z úložiště hello.</span><span class="sxs-lookup"><span data-stu-id="1f300-343">hello report is of interest for only two minutes, and it is removed from hello store automatically.</span></span>

```powershell
PS C:\> $partitionId = (Get-ServiceFabricPartition -ServiceName fabric:/WordCount/WordCount.Service).PartitionId

PS C:\> $replicaId = (Get-ServiceFabricReplica -PartitionId $partitionId | where {$_.ReplicaRole -eq "Primary"}).ReplicaId

PS C:\> Send-ServiceFabricReplicaHealthReport -PartitionId $partitionId -ReplicaId $replicaId -HealthState Warning -SourceId PowershellWatcher -HealthProperty ResourceDependency -Description "hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes." -TimeToLiveSec 120 -RemoveWhenExpired

PS C:\> Get-ServiceFabricReplicaHealth  -PartitionId $partitionId -ReplicaOrInstanceId $replicaId


PartitionId           : 8f82daff-eb68-4fd9-b631-7a37629e08c0
ReplicaId             : 130740415594605869
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='PowershellWatcher', Property='ResourceDependency', HealthState='Warning', ConsiderWarningAsError=false.

HealthEvents          :
                        SourceId              : System.RA
                        Property              : State
                        HealthState           : Ok
                        SequenceNumber        : 130740768777734943
                        SentAt                : 4/21/2015 8:01:17 AM
                        ReceivedAt            : 4/21/2015 8:02:12 AM
                        TTL                   : Infinite
                        Description           : Replica has been created.
                        RemoveWhenExpired     : False
                        IsExpired             : False
                        Transitions           : ->Ok = 4/21/2015 8:02:12 AM

                        SourceId              : PowershellWatcher
                        Property              : ResourceDependency
                        HealthState           : Warning
                        SequenceNumber        : 130741243777723555
                        SentAt                : 4/21/2015 9:12:57 PM
                        ReceivedAt            : 4/21/2015 9:12:57 PM
                        TTL                   : 00:02:00
                        Description           : hello external resource that hello primary is using has been rebooted at 4/21/2015 9:01:21 PM. Expect processing delays for a few minutes.
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : ->Warning = 4/21/2015 9:12:32 PM
```

### <a name="rest"></a><span data-ttu-id="1f300-344">REST</span><span class="sxs-lookup"><span data-stu-id="1f300-344">REST</span></span>
<span data-ttu-id="1f300-345">Odesílat zprávy o stavu pomocí požadavků POST, které přejděte toohello potřeby entity a mají popis sestavy stavu hello textu hello REST.</span><span class="sxs-lookup"><span data-stu-id="1f300-345">Send health reports using REST with POST requests that go toohello desired entity and have in hello body hello health report description.</span></span> <span data-ttu-id="1f300-346">Například v tématu Jak toosend REST [clusteru sestav stavu](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) nebo [sestav stavu služby](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span><span class="sxs-lookup"><span data-stu-id="1f300-346">For example, see how toosend REST [cluster health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-cluster) or [service health reports](https://docs.microsoft.com/rest/api/servicefabric/report-the-health-of-a-service).</span></span> <span data-ttu-id="1f300-347">Jsou podporovány všechny entity.</span><span class="sxs-lookup"><span data-stu-id="1f300-347">All entities are supported.</span></span>

## <a name="next-steps"></a><span data-ttu-id="1f300-348">Další kroky</span><span class="sxs-lookup"><span data-stu-id="1f300-348">Next steps</span></span>
<span data-ttu-id="1f300-349">Na základě hello stavu dat, služba zapisovače a Správce clusteru nebo aplikace si můžete představit způsoby tooconsume hello informace.</span><span class="sxs-lookup"><span data-stu-id="1f300-349">Based on hello health data, service writers and cluster/application administrators can think of ways tooconsume hello information.</span></span> <span data-ttu-id="1f300-350">Například můžete nastavit tak výstrahy podle stavu stav toocatch závažné problémy před jejich vyvolat výpadků.</span><span class="sxs-lookup"><span data-stu-id="1f300-350">For example, they can set up alerts based on health status toocatch severe issues before they provoke outages.</span></span> <span data-ttu-id="1f300-351">Správci můžete také nastavit tak oprava systémy toofix problémy automaticky.</span><span class="sxs-lookup"><span data-stu-id="1f300-351">Administrators can also set up repair systems toofix issues automatically.</span></span>

[<span data-ttu-id="1f300-352">Úvod tooService stav infrastruktury monitorování</span><span class="sxs-lookup"><span data-stu-id="1f300-352">Introduction tooService Fabric health Monitoring</span></span>](service-fabric-health-introduction.md)

[<span data-ttu-id="1f300-353">Zobrazit sestavy stavu Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1f300-353">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="1f300-354">Jak tooreport a zkontrolujte stav služby</span><span class="sxs-lookup"><span data-stu-id="1f300-354">How tooreport and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="1f300-355">Pomocí sestav o stavu systému pro řešení potíží</span><span class="sxs-lookup"><span data-stu-id="1f300-355">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="1f300-356">Monitorování a Diagnostika služby místně</span><span class="sxs-lookup"><span data-stu-id="1f300-356">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="1f300-357">Upgrade aplikace Service Fabric</span><span class="sxs-lookup"><span data-stu-id="1f300-357">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)


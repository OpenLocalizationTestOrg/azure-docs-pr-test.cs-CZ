---
title: "Pomocí Elasticsearch jako úložiště trasování aplikace Service Fabric | Microsoft Docs"
description: "Popisuje, jak můžou aplikace Service Fabric pomocí Elasticsearch a Kibana index, úložiště a hledání prostřednictvím trasování aplikací (protokoly)"
services: service-fabric
documentationcenter: .net
author: karolz-ms
manager: adegeo
editor: 
ms.assetid: e59b0c39-e468-4d9e-b453-d5f2a8ad20d8
ms.service: service-fabric
ms.devlang: dotNet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 04/07/2017
ms.author: karolz@microsoft.com
redirect_url: /azure/service-fabric/service-fabric-diagnostics-event-aggregation-eventflow
ms.openlocfilehash: 2d2ceceea131b41ad1a1735aaa2a859d035ab098
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="use-elasticsearch-as-a-service-fabric-application-trace-store"></a><span data-ttu-id="39de6-103">Uložení Elasticsearch použijte jako trasování aplikace Service Fabric</span><span class="sxs-lookup"><span data-stu-id="39de6-103">Use Elasticsearch as a Service Fabric application trace store</span></span>
## <a name="introduction"></a><span data-ttu-id="39de6-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="39de6-104">Introduction</span></span>
<span data-ttu-id="39de6-105">Tento článek popisuje, jak [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) aplikace můžete použít **Elasticsearch** a **Kibana** pro úložiště trasování aplikací, indexování a vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-105">This article describes how [Azure Service Fabric](https://azure.microsoft.com/documentation/services/service-fabric/) applications can use **Elasticsearch** and **Kibana** for application trace storage, indexing, and search.</span></span> <span data-ttu-id="39de6-106">[Elasticsearch](https://www.elastic.co/guide/index.html) open source, distribuované a škálovatelné v reálném čase vyhledávání a analýzy modul, který je vhodná pro tuto úlohu.</span><span class="sxs-lookup"><span data-stu-id="39de6-106">[Elasticsearch](https://www.elastic.co/guide/index.html) is an open-source, distributed, and scalable real-time search and analytics engine that is well-suited for this task.</span></span> <span data-ttu-id="39de6-107">Je můžete nainstalovat na Windows a Linux virtuální počítače běžící v Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="39de6-107">It can be installed on Windows and Linux virtual machines running in Microsoft Azure.</span></span> <span data-ttu-id="39de6-108">Elasticsearch efektivně zpracovávat *strukturovaných* trasování vytvořeného pomocí technologie, jako třeba **trasování událostí pro Windows (ETW)**.</span><span class="sxs-lookup"><span data-stu-id="39de6-108">Elasticsearch can efficiently process *structured* traces produced using technologies such as **Event Tracing for Windows (ETW)**.</span></span>

<span data-ttu-id="39de6-109">Trasování událostí pro Windows používá modulu runtime Service Fabric na zdroj diagnostické informace (trasování).</span><span class="sxs-lookup"><span data-stu-id="39de6-109">ETW is used by Service Fabric runtime to source diagnostic information (traces).</span></span> <span data-ttu-id="39de6-110">Je doporučené metody pro aplikace Service Fabric na příliš zdrojového jejich diagnostické informace.</span><span class="sxs-lookup"><span data-stu-id="39de6-110">It is the recommended method for Service Fabric applications to source their diagnostic information, too.</span></span> <span data-ttu-id="39de6-111">Pomocí stejného mechanismu umožňuje korelace mezi trasování zadaná runtime a zadané aplikace a díky při odstraňování problémů.</span><span class="sxs-lookup"><span data-stu-id="39de6-111">Using the same mechanism allows for correlation between runtime-supplied and application-supplied traces and makes troubleshooting easier.</span></span> <span data-ttu-id="39de6-112">Šablony projektu Service Fabric v sadě Visual Studio zahrnují protokolování API (podle .NET **EventSource** třída) který vysílá trasování ETW ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="39de6-112">Service Fabric project templates in Visual Studio include a logging API (based on the .NET **EventSource** class) that emits ETW traces by default.</span></span> <span data-ttu-id="39de6-113">Obecné informace o aplikace Service Fabric trasování pomocí trasování událostí pro Windows, najdete v části [monitorování a Diagnostika služby v instalačním programu místním počítači vývoj](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span><span class="sxs-lookup"><span data-stu-id="39de6-113">For a general overview of Service Fabric application tracing using ETW, see [Monitoring and diagnosing services in a local machine development setup](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md).</span></span>

<span data-ttu-id="39de6-114">Pro trasování objeví v Elasticsearch potřebují k zaznamenané v uzlech clusteru Service Fabric v reálném čase (když aplikace běží) a odesílají do Elasticsearch koncový bod.</span><span class="sxs-lookup"><span data-stu-id="39de6-114">For the traces to show up in Elasticsearch, they need to be captured at the Service Fabric cluster nodes in real time (while the application is running) and sent to an Elasticsearch endpoint.</span></span> <span data-ttu-id="39de6-115">Existují dvě hlavní možnosti pro zaznamenání trasování:</span><span class="sxs-lookup"><span data-stu-id="39de6-115">There are two major options for trace capturing:</span></span>

* <span data-ttu-id="39de6-116">**Proces zaznamenávání trasování**</span><span class="sxs-lookup"><span data-stu-id="39de6-116">**In-process trace capturing**</span></span>  
  <span data-ttu-id="39de6-117">Aplikace, nebo přesněji řečeno, proces služby je odpovědná za zasílání diagnostických dat trasování úložiště (Elasticsearch).</span><span class="sxs-lookup"><span data-stu-id="39de6-117">The application, or more precisely, service process, is responsible for sending out the diagnostic data to the trace store (Elasticsearch).</span></span>
* <span data-ttu-id="39de6-118">**Zaznamenání mimo proces trasování**</span><span class="sxs-lookup"><span data-stu-id="39de6-118">**Out-of-process trace capturing**</span></span>  
  <span data-ttu-id="39de6-119">Samostatným agentem je zaznamenání trasování z procesu služby nebo procesy a odesílá je do úložiště trasování.</span><span class="sxs-lookup"><span data-stu-id="39de6-119">A separate agent is capturing traces from the service process or processes and sending them to the trace store.</span></span>

<span data-ttu-id="39de6-120">Níže jsme popisují, jak nastavit Elasticsearch v Azure, popisují specialisté a cons pro obě možnosti zachycení a vysvětlují, jak nakonfigurovat službu Service Fabric k odesílání dat do Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="39de6-120">Below, we describe how to set up Elasticsearch on Azure, discuss the pros and cons for both capture options, and explain how to configure a Service Fabric service to send data to Elasticsearch.</span></span>

## <a name="set-up-elasticsearch-on-azure"></a><span data-ttu-id="39de6-121">Nastavit Elasticsearch v Azure</span><span class="sxs-lookup"><span data-stu-id="39de6-121">Set up Elasticsearch on Azure</span></span>
<span data-ttu-id="39de6-122">Nejjednodušší způsob, jak nastavit službu Elasticsearch v Azure je prostřednictvím [ **šablon Azure Resource Manageru**](../azure-resource-manager/resource-group-overview.md).</span><span class="sxs-lookup"><span data-stu-id="39de6-122">The most straightforward way to set up the Elasticsearch service on Azure is through [**Azure Resource Manager templates**](../azure-resource-manager/resource-group-overview.md).</span></span> <span data-ttu-id="39de6-123">O komplexní [šablony rychlý start Azure Resource Manageru pro Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) je k dispozici z úložiště Azure Quickstart šablony.</span><span class="sxs-lookup"><span data-stu-id="39de6-123">A comprehensive [Quickstart Azure Resource Manager template for Elasticsearch](https://github.com/Azure/azure-quickstart-templates/tree/master/elasticsearch) is available from Azure Quickstart templates repository.</span></span> <span data-ttu-id="39de6-124">Tato šablona používá samostatné úložiště účtů pro jednotky škálování (skupiny uzly).</span><span class="sxs-lookup"><span data-stu-id="39de6-124">This template uses separate storage accounts for scale units (groups of nodes).</span></span> <span data-ttu-id="39de6-125">Můžete také vytvářet, klienta a serveru uzly s různými konfiguracemi a různé počty datových disků připojených.</span><span class="sxs-lookup"><span data-stu-id="39de6-125">It can also provision separate client and server nodes with different configurations and various numbers of data disks attached.</span></span>

<span data-ttu-id="39de6-126">Tady používáme jinou šablonu, nazývá **ES MultiNode** z [úložiště Azure diagnostických nástrojů](https://github.com/Azure/azure-diagnostics-tools).</span><span class="sxs-lookup"><span data-stu-id="39de6-126">Here, we use another template, called **ES-MultiNode** from the [Azure diagnostic tools repository](https://github.com/Azure/azure-diagnostics-tools).</span></span> <span data-ttu-id="39de6-127">Tato šablona je jednodušší použít, a vytvoří cluster služby Elasticsearch chráněn základní ověřování protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="39de6-127">This template is easier to use, and it creates an Elasticsearch cluster protected by HTTP basic authentication.</span></span> <span data-ttu-id="39de6-128">Než budete pokračovat, stáhněte úložiště z Githubu k vašemu počítači (buď klonování úložiště nebo stažení souboru zip).</span><span class="sxs-lookup"><span data-stu-id="39de6-128">Before you proceed, download the repository from GitHub to your machine (by either cloning the repository or downloading a zip file).</span></span> <span data-ttu-id="39de6-129">ES-MultiNode šablony je umístěn ve složce se stejným názvem.</span><span class="sxs-lookup"><span data-stu-id="39de6-129">The ES-MultiNode template is located in the folder with the same name.</span></span>

### <a name="prepare-a-machine-to-run-elasticsearch-installation-scripts"></a><span data-ttu-id="39de6-130">Příprava počítačů ke spouštění skriptů instalace Elasticsearch</span><span class="sxs-lookup"><span data-stu-id="39de6-130">Prepare a machine to run Elasticsearch installation scripts</span></span>
<span data-ttu-id="39de6-131">Nejjednodušší způsob, jak používat šablony ES MultiNode je pomocí poskytnutého skriptu prostředí Azure PowerShell názvem `CreateElasticSearchCluster`.</span><span class="sxs-lookup"><span data-stu-id="39de6-131">The easiest way to use the ES-MultiNode template is through a provided Azure PowerShell script called `CreateElasticSearchCluster`.</span></span> <span data-ttu-id="39de6-132">Pokud chcete použít tento skript, musíte nainstalovat moduly prostředí PowerShell a nástroj nazvaný **openssl**.</span><span class="sxs-lookup"><span data-stu-id="39de6-132">To use this script, you need to install PowerShell modules and a tool called **openssl**.</span></span> <span data-ttu-id="39de6-133">K tomu je potřeba pro vytvoření klíč SSH, který můžete použít ke správě clusteru Elasticsearch vzdáleně.</span><span class="sxs-lookup"><span data-stu-id="39de6-133">The latter is needed for creating an SSH key that can be used to administer your Elasticsearch cluster remotely.</span></span>

<span data-ttu-id="39de6-134">`CreateElasticSearchCluster`skript je určená pro snadné použití se šablonou ES MultiNode z počítače s Windows.</span><span class="sxs-lookup"><span data-stu-id="39de6-134">`CreateElasticSearchCluster` script is designed for ease of use with the ES-MultiNode template from a Windows machine.</span></span> <span data-ttu-id="39de6-135">Je možné použít šablonu na počítač s jiným systémem než Windows, ale tento scénář je nad rámec tohoto článku.</span><span class="sxs-lookup"><span data-stu-id="39de6-135">It is possible to use the template on a non-Windows machine, but that scenario is beyond the scope of this article.</span></span>

1. <span data-ttu-id="39de6-136">Pokud jste nenainstalovali je již, nainstalujte [ **modulů prostředí Azure PowerShell**](http://aka.ms/webpi-azps).</span><span class="sxs-lookup"><span data-stu-id="39de6-136">If you haven't installed them already, install [**Azure PowerShell modules**](http://aka.ms/webpi-azps).</span></span> <span data-ttu-id="39de6-137">Po zobrazení výzvy klikněte na tlačítko **spustit**, pak **nainstalovat**.</span><span class="sxs-lookup"><span data-stu-id="39de6-137">When prompted, click **Run**, then **Install**.</span></span> <span data-ttu-id="39de6-138">Azure PowerShell 1.3 nebo novější je povinný.</span><span class="sxs-lookup"><span data-stu-id="39de6-138">Azure PowerShell 1.3 or newer is required.</span></span>
2. <span data-ttu-id="39de6-139">**Openssl** nástroj je součástí distribuce [ **Git pro Windows**](http://www.git-scm.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="39de6-139">The **openssl** tool is included in the distribution of [**Git for Windows**](http://www.git-scm.com/downloads).</span></span> <span data-ttu-id="39de6-140">Pokud jste tak ještě neučinili, nainstalujte [Git pro Windows](http://www.git-scm.com/downloads) nyní.</span><span class="sxs-lookup"><span data-stu-id="39de6-140">If you have not done so already, install [Git for Windows](http://www.git-scm.com/downloads) now.</span></span> <span data-ttu-id="39de6-141">(Výchozí možnosti instalace jsou OK).</span><span class="sxs-lookup"><span data-stu-id="39de6-141">(The default installation options are OK.)</span></span>
3. <span data-ttu-id="39de6-142">Za předpokladu, že Git byl nainstalován, ale není zahrnutý v systémové cestě, otevřete okno Microsoft Azure PowerShell a spusťte následující příkazy:</span><span class="sxs-lookup"><span data-stu-id="39de6-142">Assuming that Git has been installed but not included in the system path, open a Microsoft Azure PowerShell window and run the following commands:</span></span>
   
    ```powershell
    $ENV:PATH += ";<Git installation folder>\usr\bin"
    $ENV:OPENSSL_CONF = "<Git installation folder>\usr\ssl\openssl.cnf"
    ```
   
    <span data-ttu-id="39de6-143">Nahraďte `<Git installation folder>` Git umístění na počítači; výchozí hodnota je **"C:\Program Files\Git"**.</span><span class="sxs-lookup"><span data-stu-id="39de6-143">Replace the `<Git installation folder>` with the Git location on your machine; the default is **"C:\Program Files\Git"**.</span></span> <span data-ttu-id="39de6-144">Všimněte si středníkem na začátku první cesty.</span><span class="sxs-lookup"><span data-stu-id="39de6-144">Note the semicolon character at the beginning of the first path.</span></span>
4. <span data-ttu-id="39de6-145">Ujistěte se, že jste přihlášeni do Azure (prostřednictvím [ `Add-AzureRmAccount` ](https://msdn.microsoft.com/library/mt619267.aspx) rutiny) a že jste vybrali odběr, který se má použít k vytvoření clusteru elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-145">Ensure that you are logged on to Azure (via [`Add-AzureRmAccount`](https://msdn.microsoft.com/library/mt619267.aspx) cmdlet) and that you have selected the subscription that should be used to create your Elastic Search cluster.</span></span> <span data-ttu-id="39de6-146">Můžete ověřit, že je vybrané správné předplatné pomocí `Get-AzureRmContext` a `Get-AzureRmSubscription` rutiny.</span><span class="sxs-lookup"><span data-stu-id="39de6-146">You can verify that correct subscription is selected using `Get-AzureRmContext` and `Get-AzureRmSubscription` cmdlets.</span></span>
5. <span data-ttu-id="39de6-147">Pokud jste tak ještě neučinili, přejděte do složky ES MultiNode aktuální adresář.</span><span class="sxs-lookup"><span data-stu-id="39de6-147">If you haven't done so already, change the current directory to the ES-MultiNode folder.</span></span>

### <a name="run-the-createelasticsearchcluster-script"></a><span data-ttu-id="39de6-148">Spusťte skript CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="39de6-148">Run the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="39de6-149">Než spustíte skript, otevřete `azuredeploy-parameters.json` souboru a ověřte nebo zadejte hodnoty pro parametry skriptu.</span><span class="sxs-lookup"><span data-stu-id="39de6-149">Before you run the script, open the `azuredeploy-parameters.json` file and verify or provide values for the script parameters.</span></span> <span data-ttu-id="39de6-150">Jsou k dispozici následující parametry:</span><span class="sxs-lookup"><span data-stu-id="39de6-150">The following parameters are provided:</span></span>

| <span data-ttu-id="39de6-151">Název parametru</span><span class="sxs-lookup"><span data-stu-id="39de6-151">Parameter Name</span></span> | <span data-ttu-id="39de6-152">Popis</span><span class="sxs-lookup"><span data-stu-id="39de6-152">Description</span></span> |
| --- | --- |
| <span data-ttu-id="39de6-153">dnsNameForLoadBalancerIP</span><span class="sxs-lookup"><span data-stu-id="39de6-153">dnsNameForLoadBalancerIP</span></span> |<span data-ttu-id="39de6-154">Název, který se používá k vytvoření veřejně viditelný název DNS pro cluster elastické vyhledávání (přidáním domény oblast Azure pro zadaný název).</span><span class="sxs-lookup"><span data-stu-id="39de6-154">The name that is used to create the publicly visible DNS name for the Elastic Search cluster (by appending the Azure region domain to the provided name).</span></span> <span data-ttu-id="39de6-155">Například pokud je tato hodnota parametru "myBigCluster" a vybraný oblast Azure je západní USA, výsledný název DNS clusteru je myBigCluster.westus.cloudapp.azure.com.</span><span class="sxs-lookup"><span data-stu-id="39de6-155">For example, if this parameter value is "myBigCluster" and the chosen Azure region is West US, the resulting DNS name for the cluster is myBigCluster.westus.cloudapp.azure.com.</span></span> <br /><br /><span data-ttu-id="39de6-156">Tento název slouží také jako název kořenové pro mnoho artefakty přidružené clusteru elastické vyhledávání, například názvy uzlu data.</span><span class="sxs-lookup"><span data-stu-id="39de6-156">This name also serves as a root name for many artifacts associated with the Elastic Search cluster, such as data node names.</span></span> |
| <span data-ttu-id="39de6-157">adminUsername</span><span class="sxs-lookup"><span data-stu-id="39de6-157">adminUsername</span></span> |<span data-ttu-id="39de6-158">Název účtu správce pro správu clusteru elastické vyhledávání (odpovídající klíče SSH jsou automaticky generovány.).</span><span class="sxs-lookup"><span data-stu-id="39de6-158">The name of the administrator account for managing the Elastic Search cluster (corresponding SSH keys are generated automatically).</span></span> |
| <span data-ttu-id="39de6-159">dataNodeCount</span><span class="sxs-lookup"><span data-stu-id="39de6-159">dataNodeCount</span></span> |<span data-ttu-id="39de6-160">Počet uzlů v clusteru elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-160">The number of nodes in the Elastic Search cluster.</span></span> <span data-ttu-id="39de6-161">Aktuální verze skriptu nerozlišuje mezi uzly dat a dotazu. všechny uzly přehrát obě role.</span><span class="sxs-lookup"><span data-stu-id="39de6-161">The current version of the script does not distinguish between data and query nodes; all nodes play both roles.</span></span> <span data-ttu-id="39de6-162">Výchozí hodnota je 3 uzly.</span><span class="sxs-lookup"><span data-stu-id="39de6-162">Defaults to 3 nodes.</span></span> |
| <span data-ttu-id="39de6-163">dataDiskSize</span><span class="sxs-lookup"><span data-stu-id="39de6-163">dataDiskSize</span></span> |<span data-ttu-id="39de6-164">Velikost datových disků (v GB), který je přidělen pro každý uzel data.</span><span class="sxs-lookup"><span data-stu-id="39de6-164">The size of data disks (in GB) that is allocated for each data node.</span></span> <span data-ttu-id="39de6-165">Každý uzel přijme 4 datových disků, výhradně vyhrazený pro elastické vyhledávací službu.</span><span class="sxs-lookup"><span data-stu-id="39de6-165">Each node receives 4 data disks, exclusively dedicated to Elastic Search service.</span></span> |
| <span data-ttu-id="39de6-166">Oblast</span><span class="sxs-lookup"><span data-stu-id="39de6-166">region</span></span> |<span data-ttu-id="39de6-167">Název oblasti Azure, kde by měl být umístěn clusteru elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-167">The name of Azure region where the Elastic Search cluster should be located.</span></span> |
| <span data-ttu-id="39de6-168">esUserName</span><span class="sxs-lookup"><span data-stu-id="39de6-168">esUserName</span></span> |<span data-ttu-id="39de6-169">Uživatelské jméno uživatele, který je nakonfigurován tak, aby měl přístup ke clusteru ES (přičemž podléhá základní ověřování protokolem HTTP).</span><span class="sxs-lookup"><span data-stu-id="39de6-169">The user name of the user that is configured to have access to ES cluster (subject to HTTP basic authentication).</span></span> <span data-ttu-id="39de6-170">Heslo není součástí souboru parametrů a je třeba zadat při `CreateElasticSearchCluster` vyvolání skriptu.</span><span class="sxs-lookup"><span data-stu-id="39de6-170">The password is not part of parameters file and must be provided when `CreateElasticSearchCluster` script is invoked.</span></span> |
| <span data-ttu-id="39de6-171">vmSizeDataNodes</span><span class="sxs-lookup"><span data-stu-id="39de6-171">vmSizeDataNodes</span></span> |<span data-ttu-id="39de6-172">Velikost virtuálního počítače Azure pro uzly clusteru elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-172">The Azure virtual machine size for Elastic Search cluster nodes.</span></span> <span data-ttu-id="39de6-173">Výchozí hodnota je Standard_D2.</span><span class="sxs-lookup"><span data-stu-id="39de6-173">Defaults to Standard_D2.</span></span> |

<span data-ttu-id="39de6-174">Nyní jste připraveni ke spuštění skriptu.</span><span class="sxs-lookup"><span data-stu-id="39de6-174">Now you are ready to run the script.</span></span> <span data-ttu-id="39de6-175">Vydejte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="39de6-175">Issue the following command:</span></span>

```powershell
CreateElasticSearchCluster -ResourceGroupName <es-group-name> -Region <azure-region> -EsPassword <es-password>
```

<span data-ttu-id="39de6-176">kde</span><span class="sxs-lookup"><span data-stu-id="39de6-176">where</span></span> 

| <span data-ttu-id="39de6-177">Název parametru skriptu</span><span class="sxs-lookup"><span data-stu-id="39de6-177">Script Parameter Name</span></span> | <span data-ttu-id="39de6-178">Popis</span><span class="sxs-lookup"><span data-stu-id="39de6-178">Description</span></span> |
| --- | --- |
| `<es-group-name>` |<span data-ttu-id="39de6-179">Název skupiny prostředků Azure, která bude obsahovat všechny prostředky clusteru elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-179">The name of the Azure resource group that will contain all Elastic Search cluster resources.</span></span> |
| `<azure-region>` |<span data-ttu-id="39de6-180">Název oblasti Azure, kde by měl být vytvořen cluster elastické vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="39de6-180">The name of the Azure region where the Elastic Search cluster should be created.</span></span> |
| `<es-password>` |<span data-ttu-id="39de6-181">Heslo pro elastické hledat uživatele.</span><span class="sxs-lookup"><span data-stu-id="39de6-181">The password for the Elastic Search user.</span></span> |

> [!NOTE]
> <span data-ttu-id="39de6-182">Pokud dojde NullReferenceException z rutiny Test-AzureResourceGroup, jste zapomněli pro přihlášení k Azure (`Add-AzureRmAccount`).</span><span class="sxs-lookup"><span data-stu-id="39de6-182">If you get a NullReferenceException from the Test-AzureResourceGroup cmdlet, you have forgotten to log on to Azure (`Add-AzureRmAccount`).</span></span>
> 
> 

<span data-ttu-id="39de6-183">Pokud dojde k chybě z spouštění skriptu a zjistíte, že chyba způsobila hodnotu parametru nesprávný šablony, opravte soubor parametrů a znovu spusťte skript s názvem skupiny prostředků jiného.</span><span class="sxs-lookup"><span data-stu-id="39de6-183">If you get an error from running the script and you determine that the error was caused by a wrong template parameter value, correct the parameter file and run the script again with a different resource group name.</span></span> <span data-ttu-id="39de6-184">Můžete také použít stejný název skupiny prostředků a nechat skript vyčištění starý přidáním `-RemoveExistingResourceGroup` parametr vyvolání skriptu.</span><span class="sxs-lookup"><span data-stu-id="39de6-184">You can also reuse the same resource group name and have the script clean up the old one by adding the `-RemoveExistingResourceGroup` parameter to the script invocation.</span></span>

### <a name="result-of-running-the-createelasticsearchcluster-script"></a><span data-ttu-id="39de6-185">Výsledek skriptu CreateElasticSearchCluster</span><span class="sxs-lookup"><span data-stu-id="39de6-185">Result of running the CreateElasticSearchCluster script</span></span>
<span data-ttu-id="39de6-186">Po spuštění `CreateElasticSearchCluster` skriptu, bude vytvořena následující hlavní artefakty.</span><span class="sxs-lookup"><span data-stu-id="39de6-186">After you run the `CreateElasticSearchCluster` script, the following main artifacts will be created.</span></span> <span data-ttu-id="39de6-187">V tomto příkladu předpokládáme, že jste použili "myBigCluster" jako hodnotu `dnsNameForLoadBalancerIP` parametr a zda je oblast, kde jste vytvořili clusteru západní USA.</span><span class="sxs-lookup"><span data-stu-id="39de6-187">For this example we assume that you have used "myBigCluster" as the value of the `dnsNameForLoadBalancerIP` parameter and that the region where you created the cluster is West US.</span></span>

| <span data-ttu-id="39de6-188">Artefaktů</span><span class="sxs-lookup"><span data-stu-id="39de6-188">Artifact</span></span> | <span data-ttu-id="39de6-189">Název, umístění a poznámky</span><span class="sxs-lookup"><span data-stu-id="39de6-189">Name, location, and remarks</span></span> |
| --- | --- |
| <span data-ttu-id="39de6-190">Klíč SSH pro vzdálenou správu</span><span class="sxs-lookup"><span data-stu-id="39de6-190">SSH key for remote administration</span></span> |<span data-ttu-id="39de6-191">myBigCluster.key souboru (v adresáři, ze kterého se spouštěl CreateElasticSearchCluster).</span><span class="sxs-lookup"><span data-stu-id="39de6-191">myBigCluster.key file (in the directory from which the CreateElasticSearchCluster was run).</span></span> <br /><br /><span data-ttu-id="39de6-192">Tento soubor klíče slouží k připojení k uzlu správce a (prostřednictvím Správce uzel) pro data uzly v clusteru.</span><span class="sxs-lookup"><span data-stu-id="39de6-192">This key file can be used to connect to the admin node and (through the admin node) to data nodes in the cluster.</span></span> |
| <span data-ttu-id="39de6-193">Správce uzlu</span><span class="sxs-lookup"><span data-stu-id="39de6-193">Admin node</span></span> |<span data-ttu-id="39de6-194">myBigCluster admin.westus.cloudapp.azure.com</span><span class="sxs-lookup"><span data-stu-id="39de6-194">myBigCluster-admin.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="39de6-195">Vyhrazený virtuální počítač pro vzdálenou správu clusteru Elasticsearch – pouze ten, který umožňuje externí připojení SSH.</span><span class="sxs-lookup"><span data-stu-id="39de6-195">A dedicated VM for remote Elasticsearch cluster administration--the only one that allows external SSH connections.</span></span> <span data-ttu-id="39de6-196">Běží na stejné virtuální síti jako všechny uzly v clusteru Elasticsearch, ale nejde spustit žádné služby, Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="39de6-196">It runs on the same virtual network as all the Elasticsearch cluster nodes, but it does not run any Elasticsearch services.</span></span> |
| <span data-ttu-id="39de6-197">Datové uzly</span><span class="sxs-lookup"><span data-stu-id="39de6-197">Data nodes</span></span> |<span data-ttu-id="39de6-198">myBigCluster1...</span><span class="sxs-lookup"><span data-stu-id="39de6-198">myBigCluster1 …</span></span> <span data-ttu-id="39de6-199">myBigCluster*N*</span><span class="sxs-lookup"><span data-stu-id="39de6-199">myBigCluster*N*</span></span> <br /><br /><span data-ttu-id="39de6-200">Datové uzly, které jsou spuštěny služby Elasticsearch a Kibana.</span><span class="sxs-lookup"><span data-stu-id="39de6-200">Data nodes that are running Elasticsearch and Kibana services.</span></span> <span data-ttu-id="39de6-201">Můžete připojit pomocí protokolu SSH do každého uzlu, ale pouze prostřednictvím Správce uzlu.</span><span class="sxs-lookup"><span data-stu-id="39de6-201">You can connect via SSH to each node, but only via the admin node.</span></span> |
| <span data-ttu-id="39de6-202">Elasticsearch clusteru</span><span class="sxs-lookup"><span data-stu-id="39de6-202">Elasticsearch cluster</span></span> |<span data-ttu-id="39de6-203">http://myBigCluster.westus.cloudapp.Azure.com/ES/</span><span class="sxs-lookup"><span data-stu-id="39de6-203">http://myBigCluster.westus.cloudapp.azure.com/es/</span></span> <br /><br /><span data-ttu-id="39de6-204">Primární koncový bod clusteru Elasticsearch (Poznámka příponou /es).</span><span class="sxs-lookup"><span data-stu-id="39de6-204">The primary endpoint for the Elasticsearch cluster (note the /es suffix).</span></span> <span data-ttu-id="39de6-205">Je chráněn základní ověřování protokolu HTTP (přihlašovací údaje byly zadané parametry esUserName nebo esPassword ES MultiNode šablony).</span><span class="sxs-lookup"><span data-stu-id="39de6-205">It is protected by basic HTTP authentication (the credentials were the specified esUserName/esPassword parameters of the ES-MultiNode template).</span></span> <span data-ttu-id="39de6-206">Cluster má také hlavičky modulu plug-in nainstalovaný (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) pro správu základní cluster.</span><span class="sxs-lookup"><span data-stu-id="39de6-206">The cluster has also the head plug-in installed (http://myBigCluster.westus.cloudapp.azure.com/es/_plugin/head) for basic cluster administration.</span></span> |
| <span data-ttu-id="39de6-207">Kibana služby</span><span class="sxs-lookup"><span data-stu-id="39de6-207">Kibana service</span></span> |<span data-ttu-id="39de6-208">http://myBigCluster.westus.cloudapp.Azure.com</span><span class="sxs-lookup"><span data-stu-id="39de6-208">http://myBigCluster.westus.cloudapp.azure.com</span></span> <br /><br /><span data-ttu-id="39de6-209">Službu Kibana jsou nastaveny na zobrazení dat z vytvořený Elasticsearch cluster.</span><span class="sxs-lookup"><span data-stu-id="39de6-209">The Kibana service is set up to show data from the created Elasticsearch cluster.</span></span> <span data-ttu-id="39de6-210">Je chráněn stejné ověřovací pověření jako samotného clusteru.</span><span class="sxs-lookup"><span data-stu-id="39de6-210">It is protected by the same authentication credentials as the cluster itself.</span></span> |

## <a name="in-process-versus-out-of-process-trace-capturing"></a><span data-ttu-id="39de6-211">V procesu versus zaznamenávání mimo proces trasování</span><span class="sxs-lookup"><span data-stu-id="39de6-211">In-process versus out-of-process trace capturing</span></span>
<span data-ttu-id="39de6-212">V úvodu, jsme uvedených dva základní způsoby shromažďování diagnostických dat: v rámci procesu a mimo proces.</span><span class="sxs-lookup"><span data-stu-id="39de6-212">In the introduction, we mentioned two fundamental ways of collecting diagnostic data: in-process and out-of-process.</span></span> <span data-ttu-id="39de6-213">Každý má silné a slabé stránky.</span><span class="sxs-lookup"><span data-stu-id="39de6-213">Each has strengths and weaknesses.</span></span>

<span data-ttu-id="39de6-214">Výhody **proces zaznamenávání trasování** zahrnují:</span><span class="sxs-lookup"><span data-stu-id="39de6-214">Advantages of the **in-process trace capturing** include:</span></span>

1. <span data-ttu-id="39de6-215">*Jednoduchá konfigurace a nasazení*</span><span class="sxs-lookup"><span data-stu-id="39de6-215">*Easy configuration and deployment*</span></span>
   
   * <span data-ttu-id="39de6-216">Konfigurace shromažďování diagnostických dat je právě součástí konfigurace aplikace.</span><span class="sxs-lookup"><span data-stu-id="39de6-216">The configuration of diagnostic data collection is just part of the application configuration.</span></span> <span data-ttu-id="39de6-217">Je snadné vždy synchronizujte jej "" s zbývající aplikace.</span><span class="sxs-lookup"><span data-stu-id="39de6-217">It is easy to always keep it "in sync" with the rest of the application.</span></span>
   * <span data-ttu-id="39de6-218">Konfigurace pro aplikaci nebo službě,-je snadno dosažitelné.</span><span class="sxs-lookup"><span data-stu-id="39de6-218">Per-application or per-service configuration is easily achievable.</span></span>
   * <span data-ttu-id="39de6-219">Trasování mimo proces zaznamenávání obvykle vyžaduje samostatné nasazení a konfigurace diagnostiky agenta, který je velmi Správce úloh a potenciální příčinu chyby.</span><span class="sxs-lookup"><span data-stu-id="39de6-219">Out-of-process trace capturing usually requires a separate deployment and configuration of the diagnostic agent, which is an extra administrative task and a potential source of errors.</span></span> <span data-ttu-id="39de6-220">Technologie konkrétní agenta často umožňuje jenom jednu instanci agenta na virtuální počítač (uzel).</span><span class="sxs-lookup"><span data-stu-id="39de6-220">The particular agent technology often allows only one instance of the agent per virtual machine (node).</span></span> <span data-ttu-id="39de6-221">To znamená že konfigurace pro kolekci konfigurace diagnostiky sdílí všechny aplikace a služby spuštěné v tomto uzlu.</span><span class="sxs-lookup"><span data-stu-id="39de6-221">This means that configuration for the collection of the diagnostic configuration is shared among all applications and services running on that node.</span></span>
2. <span data-ttu-id="39de6-222">*Flexibilita*</span><span class="sxs-lookup"><span data-stu-id="39de6-222">*Flexibility*</span></span>
   
   * <span data-ttu-id="39de6-223">Aplikace může posílat data, bez ohledu na účelu, také je zde knihovna klienta, který podporuje systém cílových dat úložiště.</span><span class="sxs-lookup"><span data-stu-id="39de6-223">The application can send the data wherever it needs to go, as long as there is a client library that supports the targeted data storage system.</span></span> <span data-ttu-id="39de6-224">Můžete přidat nové jímky podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="39de6-224">New sinks can be added as desired.</span></span>
   * <span data-ttu-id="39de6-225">Komplexní zachycení, filtrování a agregace dat pravidla mohou být implementována.</span><span class="sxs-lookup"><span data-stu-id="39de6-225">Complex capture, filtering, and data-aggregation rules can be implemented.</span></span>
   * <span data-ttu-id="39de6-226">Trasování mimo proces zachycení je často omezena jímky dat, které podporuje agenta.</span><span class="sxs-lookup"><span data-stu-id="39de6-226">An out-of-process trace capturing is often limited by the data sinks that the agent supports.</span></span> <span data-ttu-id="39de6-227">Někteří agenti jsou extensible.</span><span class="sxs-lookup"><span data-stu-id="39de6-227">Some agents are extensible.</span></span>
3. <span data-ttu-id="39de6-228">*Přístup k datům interní aplikace a kontext*</span><span class="sxs-lookup"><span data-stu-id="39de6-228">*Access to internal application data and context*</span></span>
   
   * <span data-ttu-id="39de6-229">Subsystém diagnostiky běžících v rámci procesu aplikace nebo služba může snadno posílení trasování s kontextové informace.</span><span class="sxs-lookup"><span data-stu-id="39de6-229">The diagnostic subsystem running inside the application/service process can easily augment the traces with contextual information.</span></span>
   * <span data-ttu-id="39de6-230">V metodě mimo proces musí se poslat data agentu prostřednictvím některé mechanismus komunikace mezi procesy, jako je například trasování událostí pro Windows.</span><span class="sxs-lookup"><span data-stu-id="39de6-230">In the out-of-process approach, the data must be sent to an agent via some inter-process communication mechanism, such as Event Tracing for Windows.</span></span> <span data-ttu-id="39de6-231">Tento mechanismus může použít další omezení.</span><span class="sxs-lookup"><span data-stu-id="39de6-231">This mechanism could impose additional limitations.</span></span>

<span data-ttu-id="39de6-232">Výhody **trasování mimo proces zaznamenávání** zahrnují:</span><span class="sxs-lookup"><span data-stu-id="39de6-232">Advantages of the **out-of-process trace capturing** include:</span></span>

1. <span data-ttu-id="39de6-233">*Možnost monitorování výpisy stavu systému aplikaci a shromažďování*</span><span class="sxs-lookup"><span data-stu-id="39de6-233">*The ability to monitor the application and collect crash dumps*</span></span>
   
   * <span data-ttu-id="39de6-234">Trasování v procesu zachycení může neúspěšné, pokud se nepodaří spustit nebo dojde k chybě aplikace.</span><span class="sxs-lookup"><span data-stu-id="39de6-234">In-process trace capturing may be unsuccessful if the application fails to start or crashes.</span></span> <span data-ttu-id="39de6-235">Nezávislého agenta má mnohem větší šanci zachycení zásadní informace o odstraňování potíží.</span><span class="sxs-lookup"><span data-stu-id="39de6-235">An independent agent has a much better chance of capturing crucial troubleshooting information.</span></span><br /><br />
2. <span data-ttu-id="39de6-236">*Vyspělosti, odolné a principy výkonu*</span><span class="sxs-lookup"><span data-stu-id="39de6-236">*Maturity, robustness, and proven performance*</span></span>
   
   * <span data-ttu-id="39de6-237">Agenta vyvinuté dodavatelem platformy (například Microsoft Azure Diagnostics agent) byl souladu přísných testování a boj-posílení zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="39de6-237">An agent developed by a platform vendor (such as a Microsoft Azure Diagnostics agent) has been subject to rigorous testing and battle-hardening.</span></span>
   * <span data-ttu-id="39de6-238">Pomocí trasování v procesu zachycení se musí dát pozor na zkontrolujte, že aktivitu odesílání diagnostických dat z aplikační proces narušovat hlavní úlohy aplikace nebo nastat problémy načasování nebo výkonu.</span><span class="sxs-lookup"><span data-stu-id="39de6-238">With in-process trace capturing, care must be taken to ensure that the activity of sending diagnostic data from an application process does not interfere with the application's main tasks or introduce timing or performance problems.</span></span> <span data-ttu-id="39de6-239">Nezávisle spuštěné agenta je méně náchylná k těmto problémům a je určená speciálně pro omezení jeho dopad na systém.</span><span class="sxs-lookup"><span data-stu-id="39de6-239">An independently running agent is less prone to these issues and is specifically designed to limit its impact on the system.</span></span>

<span data-ttu-id="39de6-240">Je možné kombinovat a těžit z obou přístupů.</span><span class="sxs-lookup"><span data-stu-id="39de6-240">It is possible to combine and benefit from both approaches.</span></span> <span data-ttu-id="39de6-241">Ve skutečnosti může být nejlepším řešením pro mnoho aplikací.</span><span class="sxs-lookup"><span data-stu-id="39de6-241">Indeed, it might be the best solution for many applications.</span></span>

<span data-ttu-id="39de6-242">Tady používáme **Microsoft.Diagnostic.Listeners knihovny** a zachycení k odesílání dat z aplikace Service Fabric do clusteru Elasticsearch trasování v procesu.</span><span class="sxs-lookup"><span data-stu-id="39de6-242">Here, we use the **Microsoft.Diagnostic.Listeners library** and the in-process trace capturing to send data from a Service Fabric application to an Elasticsearch cluster.</span></span>

## <a name="use-the-listeners-library-to-send-diagnostic-data-to-elasticsearch"></a><span data-ttu-id="39de6-243">Posílat diagnostická data do Elasticsearch pomocí knihovny – moduly naslouchání</span><span class="sxs-lookup"><span data-stu-id="39de6-243">Use the Listeners library to send diagnostic data to Elasticsearch</span></span>
<span data-ttu-id="39de6-244">Knihovna Microsoft.Diagnostic.Listeners je součástí aplikace Service Fabric PartyCluster ukázka.</span><span class="sxs-lookup"><span data-stu-id="39de6-244">The Microsoft.Diagnostic.Listeners library is part of PartyCluster sample Service Fabric application.</span></span> <span data-ttu-id="39de6-245">Pro použití:</span><span class="sxs-lookup"><span data-stu-id="39de6-245">To use it:</span></span>

1. <span data-ttu-id="39de6-246">Stáhněte si [ukázka PartyCluster](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) z Githubu.</span><span class="sxs-lookup"><span data-stu-id="39de6-246">Download [the PartyCluster sample](https://github.com/Azure-Samples/service-fabric-dotnet-management-party-cluster) from GitHub.</span></span>
2. <span data-ttu-id="39de6-247">Zkopírujte projekty Microsoft.Diagnostics.Listeners a Microsoft.Diagnostics.Listeners.Fabric (celý složky) z adresáře ukázka PartyCluster ke složce řešení aplikace, která má posílat data do Elasticsearch.</span><span class="sxs-lookup"><span data-stu-id="39de6-247">Copy the Microsoft.Diagnostics.Listeners and Microsoft.Diagnostics.Listeners.Fabric projects (whole folders) from the PartyCluster sample directory to the solution folder of the application that is supposed to send the data to Elasticsearch.</span></span>
3. <span data-ttu-id="39de6-248">Otevřete řešení cíl, klikněte pravým tlačítkem na uzel řešení v Průzkumníku řešení a zvolte **přidat existující projekt**.</span><span class="sxs-lookup"><span data-stu-id="39de6-248">Open the target solution, right-click the solution node in the Solution Explorer, and choose **Add Existing Project**.</span></span> <span data-ttu-id="39de6-249">Přidáte projekt Microsoft.Diagnostics.Listeners k řešení.</span><span class="sxs-lookup"><span data-stu-id="39de6-249">Add the Microsoft.Diagnostics.Listeners project to the solution.</span></span> <span data-ttu-id="39de6-250">Opakujte stejný Microsoft.Diagnostics.Listeners.Fabric projektu.</span><span class="sxs-lookup"><span data-stu-id="39de6-250">Repeat the same for the Microsoft.Diagnostics.Listeners.Fabric project.</span></span>
4. <span data-ttu-id="39de6-251">Přidáte odkaz na projekt z vaší služby projekty do dvou přidané projektů.</span><span class="sxs-lookup"><span data-stu-id="39de6-251">Add a project reference from your service project(s) to the two added projects.</span></span> <span data-ttu-id="39de6-252">(Každá služba, která by měla při odesílání dat do Elasticsearch by měl odkazovat Microsoft.Diagnostics.EventListeners a Microsoft.Diagnostics.EventListeners.Fabric).</span><span class="sxs-lookup"><span data-stu-id="39de6-252">(Each service that is supposed to send data to Elasticsearch should reference Microsoft.Diagnostics.EventListeners and Microsoft.Diagnostics.EventListeners.Fabric).</span></span>
   
    ![Odkazy na projekt Microsoft.Diagnostics.EventListeners a Microsoft.Diagnostics.EventListeners.Fabric knihoven][1]

### <a name="service-fabric-general-availability-release-and-microsoftdiagnosticstracing-nuget-package"></a><span data-ttu-id="39de6-254">Verze služby Fabric obecné dostupnosti a balíček Microsoft.Diagnostics.Tracing Nuget</span><span class="sxs-lookup"><span data-stu-id="39de6-254">Service Fabric General Availability release and Microsoft.Diagnostics.Tracing Nuget package</span></span>
<span data-ttu-id="39de6-255">Aplikace sestavené s verzí Service Fabric obecné dostupnosti (2.0.135 vydané 31. března 2016) cílové **rozhraní .NET Framework 4.5.2**.</span><span class="sxs-lookup"><span data-stu-id="39de6-255">Applications built with Service Fabric General Availability release (2.0.135, released March 31, 2016) target **.NET Framework 4.5.2**.</span></span> <span data-ttu-id="39de6-256">Tato verze je nejvyšší verze rozhraní .NET Framework v době verze GA nepodporuje v Azure.</span><span class="sxs-lookup"><span data-stu-id="39de6-256">This version is the highest version of the .NET Framework supported by Azure at the time of the GA release.</span></span> <span data-ttu-id="39de6-257">Tato verze rozhraní bohužel chybí určité EventListener rozhraní API, která potřebuje Microsoft.Diagnostics.Listeners knihovny.</span><span class="sxs-lookup"><span data-stu-id="39de6-257">Unfortunately, this version of the framework lacks certain EventListener APIs that the Microsoft.Diagnostics.Listeners library needs.</span></span> <span data-ttu-id="39de6-258">Protože EventSource (komponenta, která je základem protokolování rozhraní API v aplikacích prostředků infrastruktury) a EventListener jsou úzce spojeny, každý projekt, který používá knihovnu Microsoft.Diagnostics.Listeners musíte použít alternativní implementace EventSource.</span><span class="sxs-lookup"><span data-stu-id="39de6-258">Because EventSource (the component that forms the basis of logging APIs in Fabric applications) and EventListener are tightly coupled, every project that uses the Microsoft.Diagnostics.Listeners library must use an alternative implementation of EventSource.</span></span> <span data-ttu-id="39de6-259">Tato implementace poskytuje **balíček Microsoft.Diagnostics.Tracing Nuget**, vytvořené společností Microsoft.</span><span class="sxs-lookup"><span data-stu-id="39de6-259">This implementation is provided by the **Microsoft.Diagnostics.Tracing Nuget package**, authored by Microsoft.</span></span> <span data-ttu-id="39de6-260">Balíček není plně zpětně kompatibilní s EventSource součástí rozhraní, takže beze změn kódu by měla být nutné než změny odkazované oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="39de6-260">The package is fully backward-compatible with EventSource included in the framework, so no code changes should be necessary other than referenced namespace changes.</span></span>

<span data-ttu-id="39de6-261">Pokud chcete začít používat Microsoft.Diagnostics.Tracing implementace třídy EventSource, postupujte podle těchto kroků pro každý projekt služby, který potřebuje k odesílání dat do Elasticsearch:</span><span class="sxs-lookup"><span data-stu-id="39de6-261">To start using the Microsoft.Diagnostics.Tracing implementation of the EventSource class, follow these steps for each service project that needs to send data to Elasticsearch:</span></span>

1. <span data-ttu-id="39de6-262">Klikněte pravým tlačítkem na projekt služby a zvolte **spravovat balíčky Nuget**.</span><span class="sxs-lookup"><span data-stu-id="39de6-262">Right-click on the service project and choose **Manage Nuget Packages**.</span></span>
2. <span data-ttu-id="39de6-263">Přepnout na nuget.org zdroj balíčku (Pokud již není vybrána) a vyhledejte "**Microsoft.Diagnostics.Tracing**".</span><span class="sxs-lookup"><span data-stu-id="39de6-263">Switch to the nuget.org package source (if it is not already selected) and search for "**Microsoft.Diagnostics.Tracing**".</span></span>
3. <span data-ttu-id="39de6-264">Nainstalujte `Microsoft.Diagnostics.Tracing.EventSource` balíčku (a její závislosti).</span><span class="sxs-lookup"><span data-stu-id="39de6-264">Install the `Microsoft.Diagnostics.Tracing.EventSource` package (and its dependencies).</span></span>
4. <span data-ttu-id="39de6-265">Otevřete **ServiceEventSource.cs** nebo **ActorEventSource.cs** souborů ve vašem projektu service a nahraďte `using System.Diagnostics.Tracing` direktivy nad soubor s `using Microsoft.Diagnostics.Tracing` – direktiva.</span><span class="sxs-lookup"><span data-stu-id="39de6-265">Open the **ServiceEventSource.cs** or **ActorEventSource.cs** file in your service project and replace the `using System.Diagnostics.Tracing` directive on top of the file with the `using Microsoft.Diagnostics.Tracing` directive.</span></span>

<span data-ttu-id="39de6-266">Tyto kroky nebude nutné jednou **rozhraní .NET Framework 4.6** podporuje Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="39de6-266">These steps will not be necessary once the **.NET Framework 4.6** is supported by Microsoft Azure.</span></span>

### <a name="elasticsearch-listener-instantiation-and-configuration"></a><span data-ttu-id="39de6-267">Vytváření instancí Elasticsearch naslouchací proces a konfigurace</span><span class="sxs-lookup"><span data-stu-id="39de6-267">Elasticsearch listener instantiation and configuration</span></span>
<span data-ttu-id="39de6-268">Poslední krok pro odesílání diagnostických dat do Elasticsearch je vytvoření instance `ElasticSearchListener` a nakonfigurujte ho s Elasticsearch data připojení.</span><span class="sxs-lookup"><span data-stu-id="39de6-268">The final step for sending diagnostic data to Elasticsearch is to create an instance of `ElasticSearchListener` and configure it with Elasticsearch connection data.</span></span> <span data-ttu-id="39de6-269">Naslouchací proces automaticky zaznamená všechny události vyvolané prostřednictvím EventSource tříd definovaných v projektu služby.</span><span class="sxs-lookup"><span data-stu-id="39de6-269">The listener automatically captures all events raised via EventSource classes defined in the service project.</span></span> <span data-ttu-id="39de6-270">Je nutné aktivní po dobu životnosti služby, takže je nejlepší místo k jeho vytvoření v kódu inicializace služby.</span><span class="sxs-lookup"><span data-stu-id="39de6-270">It needs to be alive during the lifetime of the service, so the best place to create it is in the service initialization code.</span></span> <span data-ttu-id="39de6-271">Zde je, jak může vypadat kód inicializace pro bezstavové služby po potřebné změny (přidání zdůraznit v komentářích počínaje `****`):</span><span class="sxs-lookup"><span data-stu-id="39de6-271">Here is how the initialization code for a stateless service could look after the necessary changes (additions pointed out in comments starting with `****`):</span></span>

```csharp
using System;
using System.Diagnostics;
using System.Fabric;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.ServiceFabric.Services.Runtime;

// **** Add the following directives
using Microsoft.Diagnostics.EventListeners;
using Microsoft.Diagnostics.EventListeners.Fabric;

namespace Stateless1
{
    internal static class Program
    {
        /// <summary>
        /// This is the entry point of the service host process.
        /// </summary>        
        private static void Main()
        {
            try
            {
                // **** Instantiate ElasticSearchListener
                var configProvider = new FabricConfigurationProvider("ElasticSearchEventListener");
                ElasticSearchListener esListener = null;
                if (configProvider.HasConfiguration)
                {
                    esListener = new ElasticSearchListener(configProvider, new FabricHealthReporter("ElasticSearchEventListener"));
                }

                // The ServiceManifest.XML file defines one or more service type names.
                // Registering a service maps a service type name to a .NET type.
                // When Service Fabric creates an instance of this service type,
                // an instance of the class is created in this host process.

                ServiceRuntime.RegisterServiceAsync("Stateless1Type", 
                    context => new Stateless1(context)).GetAwaiter().GetResult();

                ServiceEventSource.Current.ServiceTypeRegistered(Process.GetCurrentProcess().Id, typeof(Stateless1).Name);

                // Prevents this host process from terminating so services keep running.
                Thread.Sleep(Timeout.Infinite);

                // **** Ensure that the ElasticSearchListner instance is not garbage-collected prematurely
                GC.KeepAlive(esListener);
            }
            catch (Exception e)
            {
                ServiceEventSource.Current.ServiceHostInitializationFailed(e);
                throw;
            }
        }
    }
}
```

<span data-ttu-id="39de6-272">Data připojení Elasticsearch by mělo být uvedeno v samostatném oddílu v konfiguračním souboru služby (**PackageRoot\Config\Settings.xml**).</span><span class="sxs-lookup"><span data-stu-id="39de6-272">Elasticsearch connection data should be put in a separate section in the service configuration file (**PackageRoot\Config\Settings.xml**).</span></span> <span data-ttu-id="39de6-273">Název oddílu musí odpovídat hodnotě předaný `FabricConfigurationProvider` konstruktoru, například:</span><span class="sxs-lookup"><span data-stu-id="39de6-273">The name of the section must correspond to the value passed to the `FabricConfigurationProvider` constructor, for example:</span></span>

```xml
<Section Name="ElasticSearchEventListener">
  <Parameter Name="serviceUri" Value="http://myBigCluster.westus.cloudapp.azure.com/es/" />
  <Parameter Name="userName" Value="(ES user name)" />
  <Parameter Name="password" Value="(ES user password)" />
  <Parameter Name="indexNamePrefix" Value="myapp" />
</Section>
```
<span data-ttu-id="39de6-274">Hodnoty `serviceUri`, `userName` a `password` parametry odpovídají adresa koncového bodu clusteru Elasticsearch, Elasticsearch uživatelské jméno a heslo, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="39de6-274">The values of `serviceUri`, `userName` and `password` parameters correspond to the Elasticsearch cluster endpoint address, Elasticsearch user name, and password, respectively.</span></span> <span data-ttu-id="39de6-275">`indexNamePrefix`je předpona pro indexy Elasticsearch; Knihovna Microsoft.Diagnostics.Listeners denně vytvoří nový index pro svoje data.</span><span class="sxs-lookup"><span data-stu-id="39de6-275">`indexNamePrefix` is the prefix for Elasticsearch indexes; the Microsoft.Diagnostics.Listeners library creates a new index for its data daily.</span></span>

### <a name="verification"></a><span data-ttu-id="39de6-276">Ověření</span><span class="sxs-lookup"><span data-stu-id="39de6-276">Verification</span></span>
<span data-ttu-id="39de6-277">A to je vše!</span><span class="sxs-lookup"><span data-stu-id="39de6-277">That's it!</span></span> <span data-ttu-id="39de6-278">Nyní vždy, když je služba spuštěna, spustí odesílání trasování ke službě Elasticsearch zadaný v konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="39de6-278">Now, whenever the service is run, it starts sending traces to the Elasticsearch service specified in the configuration.</span></span> <span data-ttu-id="39de6-279">Můžete ověřit, že to tak, že otevřete uživatelské rozhraní Kibana přidružený k instanci Elasticsearch cíl.</span><span class="sxs-lookup"><span data-stu-id="39de6-279">You can verify this by opening the Kibana UI associated with the target Elasticsearch instance.</span></span> <span data-ttu-id="39de6-280">V našem příkladu je adresu stránky http://myBigCluster.westus.cloudapp.azure.com/.</span><span class="sxs-lookup"><span data-stu-id="39de6-280">In our example, the page address is http://myBigCluster.westus.cloudapp.azure.com/.</span></span> <span data-ttu-id="39de6-281">Zkontrolujte, zda indexy s předponou názvu zvolené pro `ElasticSearchListener` instance skutečně byly vytvořeny a naplněny s daty.</span><span class="sxs-lookup"><span data-stu-id="39de6-281">Check that indexes with the name prefix chosen for the `ElasticSearchListener` instance have indeed been created and populated with data.</span></span>

![Zobrazuje Kibana PartyCluster aplikace události][2]

## <a name="next-steps"></a><span data-ttu-id="39de6-283">Další kroky</span><span class="sxs-lookup"><span data-stu-id="39de6-283">Next steps</span></span>
* [<span data-ttu-id="39de6-284">Další informace o diagnostice a monitorování služby Service Fabric</span><span class="sxs-lookup"><span data-stu-id="39de6-284">Learn more about diagnosing and monitoring a Service Fabric service</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

<!--Image references-->
[1]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/listener-lib-references.png
[2]: ./media/service-fabric-diagnostics-how-to-use-elasticsearch/kibana.png

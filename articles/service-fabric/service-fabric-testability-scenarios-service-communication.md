---
title: "Testovatelnosti: Komunikace služby | Microsoft Docs"
description: "Komunikace služby služby je důležité integrační bod aplikace Service Fabric. Tento článek popisuje aspekty návrhu a testování techniky."
services: service-fabric
documentationcenter: .net
author: vturecek
manager: timlt
editor: 
ms.assetid: 017557df-fb59-4e4a-a65d-2732f29255b8
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 06/29/2017
ms.author: vturecek
ms.openlocfilehash: 4a8f941c1e8e641384a9ee3a1149dabaaf9983cc
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="service-fabric-testability-scenarios-service-communication"></a><span data-ttu-id="ac04a-104">Service Fabric testovatelnosti scénáře: komunikace služby</span><span class="sxs-lookup"><span data-stu-id="ac04a-104">Service Fabric testability scenarios: Service communication</span></span>
<span data-ttu-id="ac04a-105">Prostor orientované na služby architektury styly přirozeně v Azure Service Fabric a Mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="ac04a-105">Microservices and service-oriented architectural styles surface naturally in Azure Service Fabric.</span></span> <span data-ttu-id="ac04a-106">V těchto typech distribuované architektury se komponentizované mikroslužbu aplikace obvykle skládají z více služeb, které je třeba tootalk tooeach jiné.</span><span class="sxs-lookup"><span data-stu-id="ac04a-106">In these types of distributed architectures, componentized microservice applications are typically composed of multiple services that need tootalk tooeach other.</span></span> <span data-ttu-id="ac04a-107">V nejjednodušší případech i hello obecně mít alespoň bezstavové webové služby a služba úložiště stavová data, která potřebují toocommunicate.</span><span class="sxs-lookup"><span data-stu-id="ac04a-107">In even hello simplest cases, you generally have at least a stateless web service and a stateful data storage service that need toocommunicate.</span></span>

<span data-ttu-id="ac04a-108">Komunikace Service-to-service je důležité integrační bod aplikace, protože každá služba zpřístupní vzdálené tooother rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="ac04a-108">Service-to-service communication is a critical integration point of an application, because each service exposes a remote API tooother services.</span></span> <span data-ttu-id="ac04a-109">Práce s sadu rozhraní API hranice, která zahrnuje vstupně-výstupních operací obvykle vyžaduje některé pozor, s dobrou množstvím testování a ověření.</span><span class="sxs-lookup"><span data-stu-id="ac04a-109">Working with a set of API boundaries that involves I/O generally requires some care, with a good amount of testing and validation.</span></span>

<span data-ttu-id="ac04a-110">Pokud tyto služby hranice představují kabelová dohromady v distribuovaného systému existují množství toomake aspekty:</span><span class="sxs-lookup"><span data-stu-id="ac04a-110">There are numerous considerations toomake when these service boundaries are wired together in a distributed system:</span></span>

* <span data-ttu-id="ac04a-111">*Přenosový protokol*.</span><span class="sxs-lookup"><span data-stu-id="ac04a-111">*Transport protocol*.</span></span> <span data-ttu-id="ac04a-112">Použijete pro maximální propustnost HTTP pro vyšší interoperabilitu nebo vlastní binární protokol?</span><span class="sxs-lookup"><span data-stu-id="ac04a-112">Will you use HTTP for increased interoperability, or a custom binary protocol for maximum throughput?</span></span>
* <span data-ttu-id="ac04a-113">*Zpracování chyb*.</span><span class="sxs-lookup"><span data-stu-id="ac04a-113">*Error handling*.</span></span> <span data-ttu-id="ac04a-114">Jak se budou trvalý a přechodné chyby zpracovávat?</span><span class="sxs-lookup"><span data-stu-id="ac04a-114">How will permanent and transient errors be handled?</span></span> <span data-ttu-id="ac04a-115">Co se stane, když služba přesune tooa jiný uzel?</span><span class="sxs-lookup"><span data-stu-id="ac04a-115">What will happen when a service moves tooa different node?</span></span>
* <span data-ttu-id="ac04a-116">*Vypršení časových limitů a latence*.</span><span class="sxs-lookup"><span data-stu-id="ac04a-116">*Timeouts and latency*.</span></span> <span data-ttu-id="ac04a-117">V aplikacích možných jak budou jednotlivé úrovně služby zpracovávat latence prostřednictvím hello zásobníku a toohello uživatele?</span><span class="sxs-lookup"><span data-stu-id="ac04a-117">In multitiered applications, how will each service layer handle latency through hello stack and toohello user?</span></span>

<span data-ttu-id="ac04a-118">Ať už použijete jednu z poskytované Service Fabric součásti pro komunikaci hello integrovanou službu nebo můžete vytvořit vlastní, testování hello interakce mezi vaší služby je důležité tooensuring odolnosti ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="ac04a-118">Whether you use one of hello built-in service communication components provided by Service Fabric or you build your own, testing hello interactions between your services is critical tooensuring resiliency in your application.</span></span>

## <a name="prepare-for-services-toomove"></a><span data-ttu-id="ac04a-119">Příprava pro toomove služby</span><span class="sxs-lookup"><span data-stu-id="ac04a-119">Prepare for services toomove</span></span>
<span data-ttu-id="ac04a-120">Instance služby může pohybovat v čase.</span><span class="sxs-lookup"><span data-stu-id="ac04a-120">Service instances may move around over time.</span></span> <span data-ttu-id="ac04a-121">To platí hlavně když jsou nakonfigurované s vlastní přizpůsobit optimální prostředků Vyrovnávání zatížení metriky.</span><span class="sxs-lookup"><span data-stu-id="ac04a-121">This is especially true when they are configured with load metrics for custom-tailored optimal resource balancing.</span></span> <span data-ttu-id="ac04a-122">Service Fabric přesune jejich dostupnost vaší toomaximize instancí služby i během upgradu, převzetí služeb při selhání, Škálováním na více systémů a jiné situace, ke kterým došlo v průběhu životnosti hello distribuovaného systému.</span><span class="sxs-lookup"><span data-stu-id="ac04a-122">Service Fabric moves your service instances toomaximize their availability even during upgrades, failovers, scale-out, and other situations that occur over hello lifetime of a distributed system.</span></span>

<span data-ttu-id="ac04a-123">Jak služby pohyb v clusteru hello, klienty a další služby musí být připravené toohandle dva scénáře při jejich komunikovat tooa služby:</span><span class="sxs-lookup"><span data-stu-id="ac04a-123">As services move around in hello cluster, your clients and other services should be prepared toohandle two scenarios when they talk tooa service:</span></span>

* <span data-ttu-id="ac04a-124">Hello služby instance nebo oddíl repliky se přesunul od hello naposledy mluvili tooit.</span><span class="sxs-lookup"><span data-stu-id="ac04a-124">hello service instance or partition replica has moved since hello last time you talked tooit.</span></span> <span data-ttu-id="ac04a-125">To je normální součást životního cyklu služby a očekávané toohappen musí být během doby života hello vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="ac04a-125">This is a normal part of a service lifecycle, and it should be expected toohappen during hello lifetime of your application.</span></span>
* <span data-ttu-id="ac04a-126">Hello služby instance nebo oddíl replika je v hello procesu přesunu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-126">hello service instance or partition replica is in hello process of moving.</span></span> <span data-ttu-id="ac04a-127">I když v Service Fabric, dojde k velmi rychle převzetí služeb při selhání služby z jednoho uzlu tooanother, může mít zpoždění v dostupnosti hello komunikace součástí služby je pomalé toostart.</span><span class="sxs-lookup"><span data-stu-id="ac04a-127">Although failover of a service from one node tooanother occurs very quickly in Service Fabric, there may be a delay in availability if hello communication component of your service is slow toostart.</span></span>

<span data-ttu-id="ac04a-128">Pohodlné zpracování těchto scénářů je důležité pro protokol smooth spuštění systému.</span><span class="sxs-lookup"><span data-stu-id="ac04a-128">Handling these scenarios gracefully is important for a smooth-running system.</span></span> <span data-ttu-id="ac04a-129">toodo Ano, mějte na paměti:</span><span class="sxs-lookup"><span data-stu-id="ac04a-129">toodo so, keep in mind that:</span></span>

* <span data-ttu-id="ac04a-130">Všechny služby, která může být připojené toohas *adresu* která naslouchá na (například HTTP nebo objekty WebSockets).</span><span class="sxs-lookup"><span data-stu-id="ac04a-130">Every service that can be connected toohas an *address* that it listens on (for example, HTTP or WebSockets).</span></span> <span data-ttu-id="ac04a-131">Pokud se přesune instance služby nebo oddíl, změní jeho adresa koncového bodu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-131">When a service instance or partition moves, its address endpoint changes.</span></span> <span data-ttu-id="ac04a-132">(Ji přesune tooa jiného uzlu s jinou IP adresu.) Pokud používáte integrované komunikační součásti hello, že bude zpracovávat znovu řešení adresy služby pro vás.</span><span class="sxs-lookup"><span data-stu-id="ac04a-132">(It moves tooa different node with a different IP address.) If you're using hello built-in communication components, they will handle re-resolving service addresses for you.</span></span>
* <span data-ttu-id="ac04a-133">Může být dočasné zvýšení latence služby jako spuštění instance služby hello si jeho naslouchací proces znovu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-133">There may be a temporary increase in service latency as hello service instance starts up its listener again.</span></span> <span data-ttu-id="ac04a-134">To závisí na tom, jak rychle hello služby otevře naslouchací proces hello po přesunutí hello instance služby.</span><span class="sxs-lookup"><span data-stu-id="ac04a-134">This depends on how quickly hello service opens hello listener after hello service instance is moved.</span></span>
* <span data-ttu-id="ac04a-135">Všech existujících připojení potřebovat toobe zavřít a znovu otevřít, když se otevře okno služby hello na nový uzel.</span><span class="sxs-lookup"><span data-stu-id="ac04a-135">Any existing connections need toobe closed and reopened after hello service opens on a new node.</span></span> <span data-ttu-id="ac04a-136">Uzel řádné vypnutí nebo restartování umožňuje dobu pro existující připojení toobe korektně vypnout.</span><span class="sxs-lookup"><span data-stu-id="ac04a-136">A graceful node shutdown or restart allows time for existing connections toobe shut down gracefully.</span></span>

### <a name="test-it-move-service-instances"></a><span data-ttu-id="ac04a-137">Test se: přesunout instance služby</span><span class="sxs-lookup"><span data-stu-id="ac04a-137">Test it: Move service instances</span></span>
<span data-ttu-id="ac04a-138">Pomocí nástroje Service Fabric testovatelnosti můžete vytvářet testovací scénáře tootest těchto situacích různými způsoby:</span><span class="sxs-lookup"><span data-stu-id="ac04a-138">By using Service Fabric's testability tools, you can author a test scenario tootest these situations in different ways:</span></span>

1. <span data-ttu-id="ac04a-139">Přesuňte stavové služby primární repliky.</span><span class="sxs-lookup"><span data-stu-id="ac04a-139">Move a stateful service's primary replica.</span></span>
   
    <span data-ttu-id="ac04a-140">primární repliky oddílu stavové služby Hello můžete přesunout pro libovolný počet důvodů.</span><span class="sxs-lookup"><span data-stu-id="ac04a-140">hello primary replica of a stateful service partition can be moved for any number of reasons.</span></span> <span data-ttu-id="ac04a-141">Pomocí této tootarget hello primární repliky konkrétní oddíl toosee, jak přesunout vaší služby reagují toohello velmi kontrolovaně.</span><span class="sxs-lookup"><span data-stu-id="ac04a-141">Use this tootarget hello primary replica of a specific partition toosee how your services react toohello move in a very controlled manner.</span></span>
   
    ```powershell
   
    PS > Move-ServiceFabricPrimaryReplica -PartitionId 6faa4ffa-521a-44e9-8351-dfca0f7e0466 -ServiceName fabric:/MyApplication/MyService
   
    ```
2. <span data-ttu-id="ac04a-142">Zastavení uzlu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-142">Stop a node.</span></span>
   
    <span data-ttu-id="ac04a-143">Pokud uzel je zastavená, hello Service Fabric přesune všechny hello služby instance nebo oddíly, které byly na tento uzel tooone z jiných dostupných uzlů v clusteru hello.</span><span class="sxs-lookup"><span data-stu-id="ac04a-143">When a node is stopped, Service Fabric moves all of hello service instances or partitions that were on that node tooone of hello other available nodes in hello cluster.</span></span> <span data-ttu-id="ac04a-144">Pomocí této tootest situaci, kdy dojde ke ztrátě z clusteru s uzlem a mít toomove všechny instance služby hello a repliky na tomto uzlu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-144">Use this tootest a situation where a node is lost from your cluster and all of hello service instances and replicas on that node have toomove.</span></span>
   
    <span data-ttu-id="ac04a-145">Uzel můžete zastavit pomocí prostředí PowerShell hello **Stop-ServiceFabricNode** rutiny:</span><span class="sxs-lookup"><span data-stu-id="ac04a-145">You can stop a node by using hello PowerShell **Stop-ServiceFabricNode** cmdlet:</span></span>
   
    ```powershell
   
    PS > Restart-ServiceFabricNode -NodeName Node_1
   
    ```

## <a name="maintain-service-availability"></a><span data-ttu-id="ac04a-146">Zachovat dostupnost služeb</span><span class="sxs-lookup"><span data-stu-id="ac04a-146">Maintain service availability</span></span>
<span data-ttu-id="ac04a-147">Jako platformu Service Fabric je navrženou tooprovide vysokou dostupnost vašich služeb.</span><span class="sxs-lookup"><span data-stu-id="ac04a-147">As a platform, Service Fabric is designed tooprovide high availability of your services.</span></span> <span data-ttu-id="ac04a-148">Ale ve výjimečných případech může způsobit problémy s základní infrastrukturou stále nedostupnosti.</span><span class="sxs-lookup"><span data-stu-id="ac04a-148">But in extreme cases, underlying infrastructure problems can still cause unavailability.</span></span> <span data-ttu-id="ac04a-149">Je důležité tootest pro tyto scénáře příliš.</span><span class="sxs-lookup"><span data-stu-id="ac04a-149">It is important tootest for these scenarios, too.</span></span>

<span data-ttu-id="ac04a-150">Stavové služby používat tooreplicate stavu systému kvora pro vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="ac04a-150">Stateful services use a quorum-based system tooreplicate state for high availability.</span></span> <span data-ttu-id="ac04a-151">To znamená, že kvorum repliky se musí operace zápisu toobe tooperform k dispozici.</span><span class="sxs-lookup"><span data-stu-id="ac04a-151">This means that a quorum of replicas needs toobe available tooperform write operations.</span></span> <span data-ttu-id="ac04a-152">Ve výjimečných případech, například k poruše hardwaru rozšířeným nemusí být k dispozici kvorum repliky.</span><span class="sxs-lookup"><span data-stu-id="ac04a-152">In rare cases, such as a widespread hardware failure, a quorum of replicas may not be available.</span></span> <span data-ttu-id="ac04a-153">V těchto případech nebudete moct tooperform operace zápisu, ale stále budete moct tooperform operace čtení.</span><span class="sxs-lookup"><span data-stu-id="ac04a-153">In these cases, you will not be able tooperform write operations, but you will still be able tooperform read operations.</span></span>

### <a name="test-it-write-operation-unavailability"></a><span data-ttu-id="ac04a-154">Test se: nedostupnosti operace zápisu</span><span class="sxs-lookup"><span data-stu-id="ac04a-154">Test it: Write operation unavailability</span></span>
<span data-ttu-id="ac04a-155">Pomocí nástrojů testovatelnosti hello v Service Fabric, můžete vložit chybu, která indukuje ztrátě kvora jako testu.</span><span class="sxs-lookup"><span data-stu-id="ac04a-155">By using hello testability tools in Service Fabric, you can inject a fault that induces quorum loss as a test.</span></span> <span data-ttu-id="ac04a-156">I když takové situaci je taková situace vzácná, je důležité, že služby, které jsou závislé na stavové služby a klienti jsou připraveny toohandle situacích, kde budou nelze provádět zápis tooit požadavky.</span><span class="sxs-lookup"><span data-stu-id="ac04a-156">Although such a scenario is rare, it is important that clients and services that depend on a stateful service are prepared toohandle situations where they cannot make write requests tooit.</span></span> <span data-ttu-id="ac04a-157">Je také důležité hello stavové služby, samotné si je vědoma tuto možnost a můžete řádně sdělit toocallers.</span><span class="sxs-lookup"><span data-stu-id="ac04a-157">It is also important that hello stateful service itself is aware of this possibility and can gracefully communicate it toocallers.</span></span>

<span data-ttu-id="ac04a-158">Ztrátě kvora může být nutné pomocí prostředí PowerShell hello **Invoke-ServiceFabricPartitionQuorumLoss** rutiny:</span><span class="sxs-lookup"><span data-stu-id="ac04a-158">You can induce quorum loss by using hello PowerShell **Invoke-ServiceFabricPartitionQuorumLoss** cmdlet:</span></span>

```powershell

PS > Invoke-ServiceFabricPartitionQuorumLoss -ServiceName fabric:/Myapplication/MyService -QuorumLossMode QuorumReplicas -QuorumLossDurationInSeconds 20

```

<span data-ttu-id="ac04a-159">V tomto příkladu jsme nastavený `QuorumLossMode` příliš`QuorumReplicas` tooindicate, který chceme ztrátě kvora tooinduce bez nutnosti převádět dolů všechny repliky.</span><span class="sxs-lookup"><span data-stu-id="ac04a-159">In this example, we set `QuorumLossMode` too`QuorumReplicas` tooindicate that we want tooinduce quorum loss without taking down all replicas.</span></span> <span data-ttu-id="ac04a-160">Tímto způsobem operace čtení jsou stále možné.</span><span class="sxs-lookup"><span data-stu-id="ac04a-160">This way, read operations are still possible.</span></span> <span data-ttu-id="ac04a-161">tootest scénář, kde celý oddíl není k dispozici, můžete nastavit tento přepínač také`AllReplicas`.</span><span class="sxs-lookup"><span data-stu-id="ac04a-161">tootest a scenario where an entire partition is unavailable, you can set this switch too`AllReplicas`.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ac04a-162">Další kroky</span><span class="sxs-lookup"><span data-stu-id="ac04a-162">Next steps</span></span>
[<span data-ttu-id="ac04a-163">Další informace o akcích testovatelnosti</span><span class="sxs-lookup"><span data-stu-id="ac04a-163">Learn more about testability actions</span></span>](service-fabric-testability-actions.md)

[<span data-ttu-id="ac04a-164">Další informace o scénářích testovatelnosti</span><span class="sxs-lookup"><span data-stu-id="ac04a-164">Learn more about testability scenarios</span></span>](service-fabric-testability-scenarios.md)


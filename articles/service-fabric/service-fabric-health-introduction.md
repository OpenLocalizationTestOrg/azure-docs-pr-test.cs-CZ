---
title: "Sledování stavu v Service Fabric | Microsoft Docs"
description: "Úvod do Azure Service Fabric stav monitorování model, který poskytuje sledování clusteru a příslušné aplikace a služby."
services: service-fabric
documentationcenter: .net
author: oanapl
manager: timlt
editor: 
ms.assetid: 1d979210-b1eb-4022-be24-799fd9d8e003
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/19/2017
ms.author: oanapl
ms.openlocfilehash: 598a4d35faebb592f840b1bec7e77c7a091ea2de
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="introduction-to-service-fabric-health-monitoring"></a><span data-ttu-id="8d235-103">Úvod do monitorování stavu Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8d235-103">Introduction to Service Fabric health monitoring</span></span>
<span data-ttu-id="8d235-104">Azure Service Fabric zavádí stavu model, který poskytuje bohatý, flexibilní a rozšiřitelný stavu vyhodnocení a vytváření sestav.</span><span class="sxs-lookup"><span data-stu-id="8d235-104">Azure Service Fabric introduces a health model that provides rich, flexible, and extensible health evaluation and reporting.</span></span> <span data-ttu-id="8d235-105">Model umožňuje téměř v reálném čase monitorování stavu clusteru a služby spuštěné v ní.</span><span class="sxs-lookup"><span data-stu-id="8d235-105">The model allows near-real-time monitoring of the state of the cluster and the services running in it.</span></span> <span data-ttu-id="8d235-106">Můžete snadno získat informace o stavu a opravte potenciální problémy předtím, než v kaskádě a způsobit masivní výpadků.</span><span class="sxs-lookup"><span data-stu-id="8d235-106">You can easily obtain health information and correct potential issues before they cascade and cause massive outages.</span></span> <span data-ttu-id="8d235-107">V typické modelu služby odesílat sestavy založené na jejich místní zobrazení, a že informace se shromažďují zajistit celkovou clusteru úrovni zobrazení.</span><span class="sxs-lookup"><span data-stu-id="8d235-107">In the typical model, services send reports based on their local views, and that information is aggregated to provide an overall cluster-level view.</span></span>

<span data-ttu-id="8d235-108">Komponenty Service Fabric pomocí tohoto bohaté stavu modelu sestavy jejich aktuálního stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-108">Service Fabric components use this rich health model to report their current state.</span></span> <span data-ttu-id="8d235-109">Můžete použít stejný mechanismus stav sestavy z aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-109">You can use the same mechanism to report health from your applications.</span></span> <span data-ttu-id="8d235-110">Pokud jste investovat do stavu vysoce kvalitní reporting shromažďuje vaše vlastní podmínky, můžete zjistit a opravit problémy mnohem snadněji pro běžící aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8d235-110">If you invest in high-quality health reporting that captures your custom conditions, you can detect and fix issues for your running application much more easily.</span></span>

<span data-ttu-id="8d235-111">V následujícím videu Microsoft Virtual Academy také popisuje model stavu Service Fabric a jak se používají:<center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span><span class="sxs-lookup"><span data-stu-id="8d235-111">The following Microsoft Virtual Academy video also describes the Service Fabric health model and how it's used: <center><a target="_blank" href="https://mva.microsoft.com/training-courses/building-microservices-applications-on-azure-service-fabric-16747?l=tevZw56yC_1906218965">
<img src="./media/service-fabric-health-introduction/HealthIntroVid.png" WIDTH="360" HEIGHT="244">
</a></center></span></span>

> [!NOTE]
> <span data-ttu-id="8d235-112">Spuštění subsystém stavu vyřešit potřebu monitorovaných upgrady.</span><span class="sxs-lookup"><span data-stu-id="8d235-112">We started the health subsystem to address a need for monitored upgrades.</span></span> <span data-ttu-id="8d235-113">Service Fabric nabízí monitorovaných aplikací a cluster upgrady, které zajistit úplnou dostupnost, nedojde k žádnému výpadku a minimální na žádný zásah uživatele.</span><span class="sxs-lookup"><span data-stu-id="8d235-113">Service Fabric provides monitored application and cluster upgrades that ensure full availability, no downtime and minimal to no user intervention.</span></span> <span data-ttu-id="8d235-114">K dosažení těchto cílů, zkontroluje upgradu stavu, v závislosti na nakonfigurovaných zásadách upgradu.</span><span class="sxs-lookup"><span data-stu-id="8d235-114">To achieve these goals, the upgrade checks health based on configured upgrade policies.</span></span> <span data-ttu-id="8d235-115">Upgrade můžete pokračovat jenom v případě, že stav respektuje požadované prahové hodnoty.</span><span class="sxs-lookup"><span data-stu-id="8d235-115">An upgrade can proceed only when health respects desired thresholds.</span></span> <span data-ttu-id="8d235-116">Jinak upgrade buď automaticky vrácena nebo pozastavení a poskytuje správcům možnost opravit problémy.</span><span class="sxs-lookup"><span data-stu-id="8d235-116">Otherwise, the upgrade is either automatically rolled back or paused to give administrators a chance to fix the issues.</span></span> <span data-ttu-id="8d235-117">Další informace o upgradu aplikace naleznete v tématu [v tomto článku](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="8d235-117">To learn more about application upgrades, see [this article](service-fabric-application-upgrade.md).</span></span>
> 
> 

## <a name="health-store"></a><span data-ttu-id="8d235-118">Úložiště stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-118">Health store</span></span>
<span data-ttu-id="8d235-119">Úložiště stavu zajišťuje zdravotních informací o entitách clusteru pro snadné načítání a vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="8d235-119">The health store keeps health-related information about entities in the cluster for easy retrieval and evaluation.</span></span> <span data-ttu-id="8d235-120">Jsou implementované jako Service Fabric trvalé stavové služby zajistit vysokou dostupnost a škálovatelnost.</span><span class="sxs-lookup"><span data-stu-id="8d235-120">It is implemented as a Service Fabric persisted stateful service to ensure high availability and scalability.</span></span> <span data-ttu-id="8d235-121">Úložiště stavu je součástí **fabric: / systému** aplikace a je k dispozici, pokud je cluster v provozu a spuštěná.</span><span class="sxs-lookup"><span data-stu-id="8d235-121">The health store is part of the **fabric:/System** application, and it is available when the cluster is up and running.</span></span>

## <a name="health-entities-and-hierarchy"></a><span data-ttu-id="8d235-122">Stav entity a hierarchie</span><span class="sxs-lookup"><span data-stu-id="8d235-122">Health entities and hierarchy</span></span>
<span data-ttu-id="8d235-123">Stav entity, které jsou uspořádány do logických hierarchie, která zaznamená interakce a závislosti mezi různými entitami.</span><span class="sxs-lookup"><span data-stu-id="8d235-123">The health entities are organized in a logical hierarchy that captures interactions and dependencies among different entities.</span></span> <span data-ttu-id="8d235-124">Úložiště stavu automaticky vytvoří entity stavu a hierarchie, které jsou založené na zprávách přijaté z komponenty Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="8d235-124">The health store automatically builds health entities and hierarchy based on reports received from Service Fabric components.</span></span>

<span data-ttu-id="8d235-125">Stav entity zrcadlení entity Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="8d235-125">The health entities mirror the Service Fabric entities.</span></span> <span data-ttu-id="8d235-126">(Například **stavu aplikace entity** odpovídá instance aplikace nasazené v clusteru, při **stavu uzlu entity** odpovídá uzlem clusteru Service Fabric.) Hierarchie stavu zaznamená interakce systémových entit a je základem pro vyhodnocení pokročilé stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-126">(For example, **health application entity** matches an application instance deployed in the cluster, while **health node entity** matches a Service Fabric cluster node.) The health hierarchy captures the interactions of the system entities, and it is the basis for advanced health evaluation.</span></span> <span data-ttu-id="8d235-127">Informace o klíčové koncepty Service Fabric najdete [Service Fabric technický přehled](service-fabric-technical-overview.md).</span><span class="sxs-lookup"><span data-stu-id="8d235-127">You can learn about key Service Fabric concepts in [Service Fabric technical overview](service-fabric-technical-overview.md).</span></span> <span data-ttu-id="8d235-128">Další informace o aplikaci, najdete v části [model aplikace Service Fabric](service-fabric-application-model.md).</span><span class="sxs-lookup"><span data-stu-id="8d235-128">For more on application, see [Service Fabric application model](service-fabric-application-model.md).</span></span>

<span data-ttu-id="8d235-129">Stav entity a hierarchii povolit cluster a aplikace se efektivně hlášené, ladit a sledovat.</span><span class="sxs-lookup"><span data-stu-id="8d235-129">The health entities and hierarchy allow the cluster and applications to be effectively reported, debugged, and monitored.</span></span> <span data-ttu-id="8d235-130">Health model poskytuje přesný, *granulární* reprezentace stavu mnoho přesunutí součásti v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-130">The health model provides an accurate, *granular* representation of the health of the many moving pieces in the cluster.</span></span>

<span data-ttu-id="8d235-131">![Stav entity.][1]</span><span class="sxs-lookup"><span data-stu-id="8d235-131">![Health entities.][1]</span></span>
<span data-ttu-id="8d235-132">Entity stavu uspořádány v hierarchii podle vztahů nadřazenosti a podřízenosti.</span><span class="sxs-lookup"><span data-stu-id="8d235-132">The health entities, organized in a hierarchy based on parent-child relationships.</span></span>

[1]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy.png

<span data-ttu-id="8d235-133">Stav entity, které jsou:</span><span class="sxs-lookup"><span data-stu-id="8d235-133">The health entities are:</span></span>

* <span data-ttu-id="8d235-134">**Cluster**.</span><span class="sxs-lookup"><span data-stu-id="8d235-134">**Cluster**.</span></span> <span data-ttu-id="8d235-135">Představuje stav clusteru Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="8d235-135">Represents the health of a Service Fabric cluster.</span></span> <span data-ttu-id="8d235-136">Sestavy stavu clusteru popisují podmínky, které ovlivňují celý cluster.</span><span class="sxs-lookup"><span data-stu-id="8d235-136">Cluster health reports describe conditions that affect the entire cluster.</span></span> <span data-ttu-id="8d235-137">Tyto podmínky ovlivňují více entit v clusteru nebo samotného clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-137">These conditions affect multiple entities in the cluster or the cluster itself.</span></span> <span data-ttu-id="8d235-138">Podle stavu, nelze zpravodaje upřesněte problém na jeden nebo více není v pořádku, děti.</span><span class="sxs-lookup"><span data-stu-id="8d235-138">Based on the condition, the reporter can't narrow the issue down to one or more unhealthy children.</span></span> <span data-ttu-id="8d235-139">Mezi příklady patří mozku rozdělení kvůli problémům se sítí rozdělení do oddílů nebo komunikaci clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-139">Examples include the brain of the cluster splitting due to network partitioning or communication issues.</span></span>
* <span data-ttu-id="8d235-140">**Uzel**.</span><span class="sxs-lookup"><span data-stu-id="8d235-140">**Node**.</span></span> <span data-ttu-id="8d235-141">Reprezentuje stav uzlu Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="8d235-141">Represents the health of a Service Fabric node.</span></span> <span data-ttu-id="8d235-142">Sestavy stavu uzlu popisují podmínky, které ovlivňují funkci uzlu.</span><span class="sxs-lookup"><span data-stu-id="8d235-142">Node health reports describe conditions that affect the node functionality.</span></span> <span data-ttu-id="8d235-143">Obvykle mají vliv na všechny nasazené entity v rámci něj spuštěna.</span><span class="sxs-lookup"><span data-stu-id="8d235-143">They typically affect all the deployed entities running on it.</span></span> <span data-ttu-id="8d235-144">Mezi příklady patří uzlu nedostatek místa na disku (nebo jiných vlastností celého systému, jako je například paměť, připojení) a po uzlu.</span><span class="sxs-lookup"><span data-stu-id="8d235-144">Examples include node out of disk space (or other machine-wide properties, such as memory, connections) and when a node is down.</span></span> <span data-ttu-id="8d235-145">Entity uzlu je identifikována název uzlu (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-145">The node entity is identified by the node name (string).</span></span>
* <span data-ttu-id="8d235-146">**Aplikace**.</span><span class="sxs-lookup"><span data-stu-id="8d235-146">**Application**.</span></span> <span data-ttu-id="8d235-147">Reprezentuje stav instance aplikace spuštěná v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-147">Represents the health of an application instance running in the cluster.</span></span> <span data-ttu-id="8d235-148">Sestavy o stavu aplikace popisují podmínky, které ovlivňují celkový stav aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-148">Application health reports describe conditions that affect the overall health of the application.</span></span> <span data-ttu-id="8d235-149">Nemůže být zúžit jednotlivých podřízených objektů (služby nebo aplikace nasazené).</span><span class="sxs-lookup"><span data-stu-id="8d235-149">They can't be narrowed down to individual children (services or deployed applications).</span></span> <span data-ttu-id="8d235-150">Mezi příklady patří začátku do konce interakce mezi různými službami v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8d235-150">Examples include the end-to-end interaction among different services in the application.</span></span> <span data-ttu-id="8d235-151">Je aplikace identifikován podle názvu aplikace (URI).</span><span class="sxs-lookup"><span data-stu-id="8d235-151">The application entity is identified by the application name (URI).</span></span>
* <span data-ttu-id="8d235-152">**Služba**.</span><span class="sxs-lookup"><span data-stu-id="8d235-152">**Service**.</span></span> <span data-ttu-id="8d235-153">Reprezentuje stav služby spuštěné v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-153">Represents the health of a service running in the cluster.</span></span> <span data-ttu-id="8d235-154">Sestavy o stavu služby popisují podmínky, které ovlivňují celkový stav služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-154">Service health reports describe conditions that affect the overall health of the service.</span></span> <span data-ttu-id="8d235-155">Zpravodaje, která nelze zúžit problém na není v pořádku, oddíl nebo repliky.</span><span class="sxs-lookup"><span data-stu-id="8d235-155">The reporter can't narrow down the issue to an unhealthy partition or replica.</span></span> <span data-ttu-id="8d235-156">Mezi příklady patří konfigurace služby (například port nebo externí sdílené složky), která způsobuje problémy pro všechny oddíly.</span><span class="sxs-lookup"><span data-stu-id="8d235-156">Examples include a service configuration (such as port or external file share) that is causing issues for all partitions.</span></span> <span data-ttu-id="8d235-157">Entita služby je identifikována názvu služby (URI).</span><span class="sxs-lookup"><span data-stu-id="8d235-157">The service entity is identified by the service name (URI).</span></span>
* <span data-ttu-id="8d235-158">**Oddíl**.</span><span class="sxs-lookup"><span data-stu-id="8d235-158">**Partition**.</span></span> <span data-ttu-id="8d235-159">Reprezentuje stav oddílu služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-159">Represents the health of a service partition.</span></span> <span data-ttu-id="8d235-160">Sestavy stavu oddíl popisuje podmínky, které ovlivňují celé sadě replik.</span><span class="sxs-lookup"><span data-stu-id="8d235-160">Partition health reports describe conditions that affect the entire replica set.</span></span> <span data-ttu-id="8d235-161">Mezi příklady patří, kdy počet replik nedosahuje počtu cílových a oddíl je ve ztrátě kvora.</span><span class="sxs-lookup"><span data-stu-id="8d235-161">Examples include when the number of replicas is below target count and when a partition is in quorum loss.</span></span> <span data-ttu-id="8d235-162">Je oddíl identifikován oddílem ID (GUID).</span><span class="sxs-lookup"><span data-stu-id="8d235-162">The partition entity is identified by the partition ID (GUID).</span></span>
* <span data-ttu-id="8d235-163">**Repliky**.</span><span class="sxs-lookup"><span data-stu-id="8d235-163">**Replica**.</span></span> <span data-ttu-id="8d235-164">Představuje stav repliky stavové služby nebo instance bezstavové služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-164">Represents the health of a stateful service replica or a stateless service instance.</span></span> <span data-ttu-id="8d235-165">Replika je nejmenší jednotka, ve které watchdogs a součástí systému můžete sestavy pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8d235-165">The replica is the smallest unit that watchdogs and system components can report on for an application.</span></span> <span data-ttu-id="8d235-166">Pro stavové služby příklady primární repliky, která nelze replikovat operations do sekundární databáze a pomalé replikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-166">For stateful services, examples include a primary replica that can't replicate operations to secondaries and slow replication.</span></span> <span data-ttu-id="8d235-167">Navíc bezstavové instance může hlásit, pokud je dostatek prostředků nebo má problémy s připojením.</span><span class="sxs-lookup"><span data-stu-id="8d235-167">Also, a stateless instance can report when it is running out of resources or has connectivity issues.</span></span> <span data-ttu-id="8d235-168">Entita repliky je identifikován oddílu ID (GUID) a ID replik nebo instancí (long).</span><span class="sxs-lookup"><span data-stu-id="8d235-168">The replica entity is identified by the partition ID (GUID) and the replica or instance ID (long).</span></span>
* <span data-ttu-id="8d235-169">**DeployedApplication**.</span><span class="sxs-lookup"><span data-stu-id="8d235-169">**DeployedApplication**.</span></span> <span data-ttu-id="8d235-170">Představuje stav *aplikace běží na uzlu s*.</span><span class="sxs-lookup"><span data-stu-id="8d235-170">Represents the health of an *application running on a node*.</span></span> <span data-ttu-id="8d235-171">Sestavy o stavu nasazení aplikace popisují podmínky, které jsou specifické pro aplikaci na uzlu, který nemůže být zúžit balíčky služeb, které jsou nasazené na stejném uzlu.</span><span class="sxs-lookup"><span data-stu-id="8d235-171">Deployed application health reports describe conditions specific to the application on the node that can't be narrowed down to service packages deployed on the same node.</span></span> <span data-ttu-id="8d235-172">Mezi příklady patří chyby, pokud v tomto uzlu nelze stáhnout balíček aplikace a problémy nastavení aplikace objekty zabezpečení na uzlu.</span><span class="sxs-lookup"><span data-stu-id="8d235-172">Examples include errors when application package can't be downloaded on that node and issues setting up application security principals on the node.</span></span> <span data-ttu-id="8d235-173">Nasazené aplikace je identifikován název aplikace (URI) a název uzlu (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-173">The deployed application is identified by application name (URI) and node name (string).</span></span>
* <span data-ttu-id="8d235-174">**DeployedServicePackage**.</span><span class="sxs-lookup"><span data-stu-id="8d235-174">**DeployedServicePackage**.</span></span> <span data-ttu-id="8d235-175">Reprezentuje stav balíčku service běží na uzlu v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-175">Represents the health of a service package running on a node in the cluster.</span></span> <span data-ttu-id="8d235-176">Popisuje podmínky specifické pro balíček služby, které nemají vliv na ostatní služby balíčky na stejném uzlu pro stejnou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8d235-176">It describes conditions specific to a service package that do not affect the other service packages on the same node for the same application.</span></span> <span data-ttu-id="8d235-177">Mezi příklady patří balíček kódu v balíčku služby, který nelze spustit a konfigurační balíček, který nelze číst.</span><span class="sxs-lookup"><span data-stu-id="8d235-177">Examples include a code package in the service package that cannot be started and a configuration package that cannot be read.</span></span> <span data-ttu-id="8d235-178">Balíček nasazené služby je určen název aplikace (URI), název uzlu (string), manifestu název služby (string) a ID aktivace balíčku služby (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-178">The deployed service package is identified by application name (URI), node name (string), service manifest name (string), and service package activation ID (string).</span></span>

<span data-ttu-id="8d235-179">Členitost health model umožňuje snadno zjistit a opravit problémy.</span><span class="sxs-lookup"><span data-stu-id="8d235-179">The granularity of the health model makes it easy to detect and correct issues.</span></span> <span data-ttu-id="8d235-180">Například pokud služba nereaguje, je vhodná pro hlášení, že je instance aplikace na není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-180">For example, if a service is not responding, it is feasible to report that the application instance is unhealthy.</span></span> <span data-ttu-id="8d235-181">Vytváření sestav v, úroveň není ideální, ale protože nemusí být problém ovlivňuje všechny služby v rámci této aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-181">Reporting at that level is not ideal, however, because the issue might not be affecting all the services within that application.</span></span> <span data-ttu-id="8d235-182">Sestava bude použito ke službě není v pořádku nebo konkrétní podřízeného oddílu, pokud informace odkazuje na tento oddíl.</span><span class="sxs-lookup"><span data-stu-id="8d235-182">The report should be applied to the unhealthy service or to a specific child partition, if more information points to that partition.</span></span> <span data-ttu-id="8d235-183">Data automaticky povrchy prostřednictvím hierarchie a není v pořádku oddílu je dostupná na úrovni služby a aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-183">The data automatically surfaces through the hierarchy, and an unhealthy partition is made visible at service and application levels.</span></span> <span data-ttu-id="8d235-184">Tato agregace pomůže přesně určit a vyřešte příčinu problému rychleji.</span><span class="sxs-lookup"><span data-stu-id="8d235-184">This aggregation helps to pinpoint and resolve the root cause of the issue more quickly.</span></span>

<span data-ttu-id="8d235-185">Hierarchie stavu se skládá z vztahů nadřazenosti a podřízenosti.</span><span class="sxs-lookup"><span data-stu-id="8d235-185">The health hierarchy is composed of parent-child relationships.</span></span> <span data-ttu-id="8d235-186">Cluster se skládá z uzlů a aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-186">A cluster is composed of nodes and applications.</span></span> <span data-ttu-id="8d235-187">Aplikací mít služeb a nasazené aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-187">Applications have services and deployed applications.</span></span> <span data-ttu-id="8d235-188">Nasazených aplikací mít nasazené balíčky služeb.</span><span class="sxs-lookup"><span data-stu-id="8d235-188">Deployed applications have deployed service packages.</span></span> <span data-ttu-id="8d235-189">Služby mají oddíly a každý oddíl má jednu nebo více replik.</span><span class="sxs-lookup"><span data-stu-id="8d235-189">Services have partitions, and each partition has one or more replicas.</span></span> <span data-ttu-id="8d235-190">Je speciální vztah mezi uzly a nasazené entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-190">There is a special relationship between nodes and deployed entities.</span></span> <span data-ttu-id="8d235-191">Není v pořádku uzlu vykazované součást systému autority, službu Failover Manager ovlivňuje nasazené aplikace, balíčky služeb a repliky na něm nasazené.</span><span class="sxs-lookup"><span data-stu-id="8d235-191">An unhealthy node as reported by its authority system component, the Failover Manager service, affects the deployed applications, service packages, and replicas deployed on it.</span></span>

<span data-ttu-id="8d235-192">Hierarchie stavu představuje nejnovější stav systému, na základě na nejnovější sestav stavu, což je téměř v reálném čase.</span><span class="sxs-lookup"><span data-stu-id="8d235-192">The health hierarchy represents the latest state of the system based on the latest health reports, which is almost real-time information.</span></span>
<span data-ttu-id="8d235-193">Vnitřní a vnější watchdogs může hlásit na stejných entit na základě logiky specifické pro aplikaci nebo vlastní monitorovaných podmínky.</span><span class="sxs-lookup"><span data-stu-id="8d235-193">Internal and external watchdogs can report on the same entities based on application-specific logic or custom monitored conditions.</span></span> <span data-ttu-id="8d235-194">Uživatel sestavy souběžnou existenci s sestav systému.</span><span class="sxs-lookup"><span data-stu-id="8d235-194">User reports coexist with the system reports.</span></span>

<span data-ttu-id="8d235-195">Naplánujte investovat do sestavy a reakce na stav během návrhu velké cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-195">Plan to invest in how to report and respond to health during the design of a large cloud service.</span></span> <span data-ttu-id="8d235-196">Tento počáteční investiční usnadňuje službu k ladění, monitorování a činnosti.</span><span class="sxs-lookup"><span data-stu-id="8d235-196">This up-front investement makes the service easier to debug, monitor, and operate.</span></span>

## <a name="health-states"></a><span data-ttu-id="8d235-197">Stavy</span><span class="sxs-lookup"><span data-stu-id="8d235-197">Health states</span></span>
<span data-ttu-id="8d235-198">Service Fabric používá tři stavy popsat, zda entita je nebo není v pořádku: OK, upozornění a chyb.</span><span class="sxs-lookup"><span data-stu-id="8d235-198">Service Fabric uses three health states to describe whether an entity is healthy or not: OK, warning, and error.</span></span> <span data-ttu-id="8d235-199">Všechny sestavy odeslané k úložišti stavu musíte zadat jednu z těchto stavů.</span><span class="sxs-lookup"><span data-stu-id="8d235-199">Any report sent to the health store must specify one of these states.</span></span> <span data-ttu-id="8d235-200">Výsledek vyhodnocení stavu je jedním z těchto stavů.</span><span class="sxs-lookup"><span data-stu-id="8d235-200">The health evaluation result is one of these states.</span></span>

<span data-ttu-id="8d235-201">Možné [stavů](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) jsou:</span><span class="sxs-lookup"><span data-stu-id="8d235-201">The possible [health states](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthstate) are:</span></span>

* <span data-ttu-id="8d235-202">**OK**.</span><span class="sxs-lookup"><span data-stu-id="8d235-202">**OK**.</span></span> <span data-ttu-id="8d235-203">Entita je v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-203">The entity is healthy.</span></span> <span data-ttu-id="8d235-204">Neexistují žádné známé problémy, které jsou ohlášeny ho nebo jejích podřízených objektech (v případě potřeby).</span><span class="sxs-lookup"><span data-stu-id="8d235-204">There are no known issues reported on it or its children (when applicable).</span></span>
* <span data-ttu-id="8d235-205">**Upozornění**.</span><span class="sxs-lookup"><span data-stu-id="8d235-205">**Warning**.</span></span> <span data-ttu-id="8d235-206">Entita, která má některé problémy, ale mohou i nadále fungovat správně.</span><span class="sxs-lookup"><span data-stu-id="8d235-206">The entity has some issues, but it can still function correctly.</span></span> <span data-ttu-id="8d235-207">Například je, ale nezpůsobí ještě všechny funkční problémy.</span><span class="sxs-lookup"><span data-stu-id="8d235-207">For example, there are delays, but they do not cause any functional issues yet.</span></span> <span data-ttu-id="8d235-208">V některých případech může opravit podmínky upozornění bez zásahu externí sám sebe.</span><span class="sxs-lookup"><span data-stu-id="8d235-208">In some cases, the warning condition may fix itself without external intervention.</span></span> <span data-ttu-id="8d235-209">V těchto případech sestav stavu zvýšení povědomí a poskytují přehled o co se děje.</span><span class="sxs-lookup"><span data-stu-id="8d235-209">In these cases, health reports raise awareness and provide visibility into what is going on.</span></span> <span data-ttu-id="8d235-210">V jiných případech může snížit podmínky upozornění do k závažnému problému bez zásahu uživatele.</span><span class="sxs-lookup"><span data-stu-id="8d235-210">In other cases, the warning condition may degrade into a severe problem without user intervention.</span></span>
* <span data-ttu-id="8d235-211">**Chyba**.</span><span class="sxs-lookup"><span data-stu-id="8d235-211">**Error**.</span></span> <span data-ttu-id="8d235-212">Entita není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-212">The entity is unhealthy.</span></span> <span data-ttu-id="8d235-213">Chcete-li vyřešit stav entity, by měla provedena akce, protože nemůže správně fungovat.</span><span class="sxs-lookup"><span data-stu-id="8d235-213">Action should be taken to fix the state of the entity, because it can't function properly.</span></span>
* <span data-ttu-id="8d235-214">**Neznámý**.</span><span class="sxs-lookup"><span data-stu-id="8d235-214">**Unknown**.</span></span> <span data-ttu-id="8d235-215">Entita neexistuje v health store.</span><span class="sxs-lookup"><span data-stu-id="8d235-215">The entity doesn't exist in the health store.</span></span> <span data-ttu-id="8d235-216">Tento výsledek je možné získat z distribuované dotazy, které sloučení výsledky z několika součástí.</span><span class="sxs-lookup"><span data-stu-id="8d235-216">This result can be obtained from the distributed queries that merge results from multiple components.</span></span> <span data-ttu-id="8d235-217">Například dotaz get uzel přejde k **FailoverManager**, **ClusterManager**, a **HealthManager**; získat aplikaci dotaz přejde na **ClusterManager** a **HealthManager**.</span><span class="sxs-lookup"><span data-stu-id="8d235-217">For example, the get node list query goes to **FailoverManager**, **ClusterManager**, and **HealthManager**; get application list query goes to **ClusterManager** and **HealthManager**.</span></span> <span data-ttu-id="8d235-218">Tyto dotazy sloučení výsledky z několika komponent systému.</span><span class="sxs-lookup"><span data-stu-id="8d235-218">These queries merge results from multiple system components.</span></span> <span data-ttu-id="8d235-219">Pokud součást jiného systému vrací entity, která se nenachází v health store, výsledného má neznámý stav.</span><span class="sxs-lookup"><span data-stu-id="8d235-219">If another system component returns an entity that is not present in health store, the merged result has unknown health state.</span></span> <span data-ttu-id="8d235-220">Entity není v úložišti, protože stav sestavy nebyly dosud zpracovány nebo entita byla vyčištěna po jeho odstranění.</span><span class="sxs-lookup"><span data-stu-id="8d235-220">An entity is not in store because health reports have not yet been processed or the entity has been cleaned up after deletion.</span></span>

## <a name="health-policies"></a><span data-ttu-id="8d235-221">Zásady stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-221">Health policies</span></span>
<span data-ttu-id="8d235-222">Úložiště stavu platí zásady stavu k určení, zda entita je v pořádku, na základě jeho sestavy a její podřízené položky.</span><span class="sxs-lookup"><span data-stu-id="8d235-222">The health store applies health policies to determine whether an entity is healthy based on its reports and its children.</span></span>

> [!NOTE]
> <span data-ttu-id="8d235-223">Zásady stavu mohou být zadané v manifestu clusteru (pro vyhodnocení stavu clusteru a uzel) nebo v manifestu aplikace (pro vyhodnocení aplikace a všech jeho podřízených položek).</span><span class="sxs-lookup"><span data-stu-id="8d235-223">Health policies can be specified in the cluster manifest (for cluster and node health evaluation) or in the application manifest (for application evaluation and any of its children).</span></span> <span data-ttu-id="8d235-224">Žádosti o vyhodnocení stavu můžete předat také v vlastní stavu vyhodnocení zásady, které se používají pouze pro vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="8d235-224">Health evaluation requests can also pass in custom health evaluation policies, which are used only for that evaluation.</span></span>
> 
> 

<span data-ttu-id="8d235-225">Ve výchozím nastavení Service Fabric používá striktní pravidla (vše, co musí být v pořádku) pro nadřazený podřízený hierarchický vztah.</span><span class="sxs-lookup"><span data-stu-id="8d235-225">By default, Service Fabric applies strict rules (everything must be healthy) for the parent-child hierarchical relationship.</span></span> <span data-ttu-id="8d235-226">Pokud ani jeden z podřízených má jednu událost není v pořádku, považuje za nadřazený není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-226">If even one of the children has one unhealthy event, the parent is considered unhealthy.</span></span>

### <a name="cluster-health-policy"></a><span data-ttu-id="8d235-227">Zásady stavu clusteru</span><span class="sxs-lookup"><span data-stu-id="8d235-227">Cluster health policy</span></span>
<span data-ttu-id="8d235-228">[Clusteru zásady stavu](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) se používá k vyhodnocení stavu clusteru a stavů uzlu.</span><span class="sxs-lookup"><span data-stu-id="8d235-228">The [cluster health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy) is used to evaluate the cluster health state and node health states.</span></span> <span data-ttu-id="8d235-229">Zásady lze definovat v manifestu clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-229">The policy can be defined in the cluster manifest.</span></span> <span data-ttu-id="8d235-230">Pokud není přítomen, použije se výchozí zásady (nula. povolená počet selhání).</span><span class="sxs-lookup"><span data-stu-id="8d235-230">If it is not present, the default policy (zero tolerated failures) is used.</span></span>
<span data-ttu-id="8d235-231">Zásady stavu clusteru obsahuje:</span><span class="sxs-lookup"><span data-stu-id="8d235-231">The cluster health policy contains:</span></span>

* <span data-ttu-id="8d235-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span><span class="sxs-lookup"><span data-stu-id="8d235-232">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.considerwarningaserror).</span></span> <span data-ttu-id="8d235-233">Určuje, zda považovat upozornění stavu sestav jako chyby během vyhodnocení stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-233">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="8d235-234">Výchozí: false.</span><span class="sxs-lookup"><span data-stu-id="8d235-234">Default: false.</span></span>
* <span data-ttu-id="8d235-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span><span class="sxs-lookup"><span data-stu-id="8d235-235">[MaxPercentUnhealthyApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthyapplications).</span></span> <span data-ttu-id="8d235-236">Určuje maximální procento. povolená aplikací, které může být není v pořádku, než clusteru považován za chybu.</span><span class="sxs-lookup"><span data-stu-id="8d235-236">Specifies the maximum tolerated percentage of applications that can be unhealthy before the cluster is considered in error.</span></span>
* <span data-ttu-id="8d235-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span><span class="sxs-lookup"><span data-stu-id="8d235-237">[MaxPercentUnhealthyNodes](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.maxpercentunhealthynodes).</span></span> <span data-ttu-id="8d235-238">Určuje maximální procento. povolená uzlů, které může být není v pořádku, než clusteru považován za chybu.</span><span class="sxs-lookup"><span data-stu-id="8d235-238">Specifies the maximum tolerated percentage of nodes that can be unhealthy before the cluster is considered in error.</span></span> <span data-ttu-id="8d235-239">Ve velkých clusterech některé uzly jsou vždy mimo provoz nebo se pro opravy, takže toto procento by měl být nakonfigurovaný pro tolerovat možnost, která.</span><span class="sxs-lookup"><span data-stu-id="8d235-239">In large clusters, some nodes are always down or out for repairs, so this percentage should be configured to tolerate that.</span></span>
* <span data-ttu-id="8d235-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="8d235-240">[ApplicationTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.clusterhealthpolicy.applicationtypehealthpolicymap).</span></span> <span data-ttu-id="8d235-241">Mapy zásady stavu typ aplikace lze během vyhodnocení stavu clusteru popisují typy speciální aplikací.</span><span class="sxs-lookup"><span data-stu-id="8d235-241">The application type health policy map can be used during cluster health evaluation to describe special application types.</span></span> <span data-ttu-id="8d235-242">Ve výchozím nastavení jsou všechny aplikace umístit do fondu a vyhodnotit s MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="8d235-242">By default, all applications are put into a pool and evaluated with MaxPercentUnhealthyApplications.</span></span> <span data-ttu-id="8d235-243">Pokud některé typy aplikací by měly zpracovávat odděleně, může být přijata mimo globální fond.</span><span class="sxs-lookup"><span data-stu-id="8d235-243">If some application types should be treated differently, they can be taken out of the global pool.</span></span> <span data-ttu-id="8d235-244">Místo toho se vyhodnocují proti procenta přidružené k jejich název typu aplikace v mapě.</span><span class="sxs-lookup"><span data-stu-id="8d235-244">Instead, they are evaluated against the percentages associated with their application type name in the map.</span></span> <span data-ttu-id="8d235-245">Například v clusteru s podporou existují tisíce různých typů aplikací a několik instancí aplikace ovládacího prvku typu speciální aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-245">For example, in a cluster there are thousands of applications of different types, and a few control application instances of a special application type.</span></span> <span data-ttu-id="8d235-246">Řízení aplikace by měly být nikdy chyby.</span><span class="sxs-lookup"><span data-stu-id="8d235-246">The control applications should never be in error.</span></span> <span data-ttu-id="8d235-247">Můžete určit globální MaxPercentUnhealthyApplications na 20 % a tolerovat některé chyby, ale pro typ aplikace, které "ControlApplicationType" nastavena MaxPercentUnhealthyApplications na hodnotu 0.</span><span class="sxs-lookup"><span data-stu-id="8d235-247">You can specify global MaxPercentUnhealthyApplications to 20% to tolerate some failures, but for the application type "ControlApplicationType" set the MaxPercentUnhealthyApplications to 0.</span></span> <span data-ttu-id="8d235-248">Tímto způsobem, pokud jsou některé z mnoha aplikací není v pořádku, ale pod globální procento není v pořádku, cluster bude vyhodnocena jako upozornění.</span><span class="sxs-lookup"><span data-stu-id="8d235-248">This way, if some of the many applications are unhealthy, but below the global unhealthy percentage, the cluster would be evaluated to Warning.</span></span> <span data-ttu-id="8d235-249">Stav varování nemá negativní vliv na upgrade clusteru nebo jiných monitorování aktivovány chybového stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-249">A warning health state does not impact cluster upgrade or other monitoring triggered by Error health state.</span></span> <span data-ttu-id="8d235-250">Ale aplikace i jeden ovládací prvek v chybě by clusteru není v pořádku, která aktivuje vrácení nebo pozastaví upgrade clusteru, v závislosti na konfiguraci upgradu.</span><span class="sxs-lookup"><span data-stu-id="8d235-250">But even one control application in error would make cluster unhealthy, which triggers roll back or pauses the cluster upgrade, depending on the upgrade configuration.</span></span>
  <span data-ttu-id="8d235-251">Pro aplikace typů front definovaných v mapě všechny instance aplikace se vyjímají z globální fond aplikací.</span><span class="sxs-lookup"><span data-stu-id="8d235-251">For the application types defined in the map, all application instances are taken out of the global pool of applications.</span></span> <span data-ttu-id="8d235-252">Jsou vyhodnocovány na základě celkového počtu aplikací typu aplikace, pomocí konkrétní MaxPercentUnhealthyApplications z mapování.</span><span class="sxs-lookup"><span data-stu-id="8d235-252">They are evaluated based on the total number of applications of the application type, using the specific MaxPercentUnhealthyApplications from the map.</span></span> <span data-ttu-id="8d235-253">Všechny ostatní aplikace zůstanou globálního fondu a vyhodnocují se MaxPercentUnhealthyApplications.</span><span class="sxs-lookup"><span data-stu-id="8d235-253">All the rest of the applications remain in the global pool and are evaluated with MaxPercentUnhealthyApplications.</span></span>

<span data-ttu-id="8d235-254">Následující příklad je výňatek ze manifestu clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-254">The following example is an excerpt from a cluster manifest.</span></span> <span data-ttu-id="8d235-255">K definování položky v mapě typu aplikace, zadejte před název parametru "ApplicationTypeMaxPercentUnhealthyApplications-", za nímž následuje název typu aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-255">To define entries in the application type map, prefix the parameter name with "ApplicationTypeMaxPercentUnhealthyApplications-", followed by the application type name.</span></span>

```xml
<FabricSettings>
  <Section Name="HealthManager/ClusterHealthPolicy">
    <Parameter Name="ConsiderWarningAsError" Value="False" />
    <Parameter Name="MaxPercentUnhealthyApplications" Value="20" />
    <Parameter Name="MaxPercentUnhealthyNodes" Value="20" />
    <Parameter Name="ApplicationTypeMaxPercentUnhealthyApplications-ControlApplicationType" Value="0" />
  </Section>
</FabricSettings>
```

### <a name="application-health-policy"></a><span data-ttu-id="8d235-256">Zásady stavu aplikace</span><span class="sxs-lookup"><span data-stu-id="8d235-256">Application health policy</span></span>
<span data-ttu-id="8d235-257">[Zásady stavu aplikace](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) popisuje, jak se provádí vyhodnocení události a podřízené stavy agregace pro aplikace a jejich podřízené položky.</span><span class="sxs-lookup"><span data-stu-id="8d235-257">The [application health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy) describes how the evaluation of events and child-states aggregation is done for applications and their children.</span></span> <span data-ttu-id="8d235-258">V manifestu aplikace, lze definovat **ApplicationManifest.xml**, v balíčku aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-258">It can be defined in the application manifest, **ApplicationManifest.xml**, in the application package.</span></span> <span data-ttu-id="8d235-259">Pokud nejsou zadány žádné zásady, Service Fabric předpokládá, že je entita není v pořádku, pokud má sestavy stavu, nebo podřízenou položku ve stavu upozornění nebo chyby.</span><span class="sxs-lookup"><span data-stu-id="8d235-259">If no policies are specified, Service Fabric assumes that the entity is unhealthy if it has a health report or a child at the warning or error health state.</span></span>
<span data-ttu-id="8d235-260">Konfigurovat zásady, jsou:</span><span class="sxs-lookup"><span data-stu-id="8d235-260">The configurable policies are:</span></span>

* <span data-ttu-id="8d235-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span><span class="sxs-lookup"><span data-stu-id="8d235-261">[ConsiderWarningAsError](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.considerwarningaserror.aspx).</span></span> <span data-ttu-id="8d235-262">Určuje, zda považovat upozornění stavu sestav jako chyby během vyhodnocení stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-262">Specifies whether to treat warning health reports as errors during health evaluation.</span></span> <span data-ttu-id="8d235-263">Výchozí: false.</span><span class="sxs-lookup"><span data-stu-id="8d235-263">Default: false.</span></span>
* <span data-ttu-id="8d235-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span><span class="sxs-lookup"><span data-stu-id="8d235-264">[MaxPercentUnhealthyDeployedApplications](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.maxpercentunhealthydeployedapplications).</span></span> <span data-ttu-id="8d235-265">Určuje maximální procento. povolená nasazené aplikace, které se dají není v pořádku, než aplikace je považována za chybu.</span><span class="sxs-lookup"><span data-stu-id="8d235-265">Specifies the maximum tolerated percentage of deployed applications that can be unhealthy before the application is considered in error.</span></span> <span data-ttu-id="8d235-266">Se počítá vydělením počtu není v pořádku nasazené aplikace přes počet uzlů, které aplikace jsou aktuálně nasazená v v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-266">This percentage is calculated by dividing the number of unhealthy deployed applications over the number of nodes that the applications are currently deployed on in the cluster.</span></span> <span data-ttu-id="8d235-267">Výpočet zaokrouhlí na tolerovat jeden selhání na malém počtu uzlů.</span><span class="sxs-lookup"><span data-stu-id="8d235-267">The computation rounds up to tolerate one failure on small numbers of nodes.</span></span> <span data-ttu-id="8d235-268">Výchozí procento: nula.</span><span class="sxs-lookup"><span data-stu-id="8d235-268">Default percentage: zero.</span></span>
* <span data-ttu-id="8d235-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span><span class="sxs-lookup"><span data-stu-id="8d235-269">[DefaultServiceTypeHealthPolicy](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.defaultservicetypehealthpolicy).</span></span> <span data-ttu-id="8d235-270">Určuje výchozí služby typu zásad stavu, která nahradí výchozí zásady stavu pro všechny typy služeb v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="8d235-270">Specifies the default service type health policy, which replaces the default health policy for all service types in the application.</span></span>
* <span data-ttu-id="8d235-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span><span class="sxs-lookup"><span data-stu-id="8d235-271">[ServiceTypeHealthPolicyMap](https://docs.microsoft.com/dotnet/api/system.fabric.health.applicationhealthpolicy.servicetypehealthpolicymap).</span></span> <span data-ttu-id="8d235-272">Obsahuje mapování zásad stavu service podle typu služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-272">Provides a map of service health policies per service type.</span></span> <span data-ttu-id="8d235-273">Tyto zásady nahradí výchozí zásady stavu typ služby pro každý typ zadaná služba.</span><span class="sxs-lookup"><span data-stu-id="8d235-273">These policies replace the default service type health policies for each specified service type.</span></span> <span data-ttu-id="8d235-274">Pokud aplikace má typ služby bezstavové brány a service type stavový stroj, můžete je třeba nakonfigurovat zásady stavu pro jejich hodnocení jinak.</span><span class="sxs-lookup"><span data-stu-id="8d235-274">For example, if an application has a stateless gateway service type and a stateful engine service type, you can configure the health policies for their evaluation differently.</span></span> <span data-ttu-id="8d235-275">Když zadáte zásady, za typ služby, můžete získat podrobnější řízení stavu služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-275">When you specify policy per service type, you can gain more granular control of the health of the service.</span></span>

### <a name="service-type-health-policy"></a><span data-ttu-id="8d235-276">Zásady stavu typ služby</span><span class="sxs-lookup"><span data-stu-id="8d235-276">Service type health policy</span></span>
<span data-ttu-id="8d235-277">[Služby typu zásady stavu](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) Určuje, jak k vyhodnocení a agregovat služeb a podřízené položky služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-277">The [service type health policy](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy) specifies how to evaluate and aggregate the services and the children of services.</span></span> <span data-ttu-id="8d235-278">Zásady obsahuje:</span><span class="sxs-lookup"><span data-stu-id="8d235-278">The policy contains:</span></span>

* <span data-ttu-id="8d235-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span><span class="sxs-lookup"><span data-stu-id="8d235-279">[MaxPercentUnhealthyPartitionsPerService](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthypartitionsperservice).</span></span> <span data-ttu-id="8d235-280">Určuje maximální procento. povolená oddílů není v pořádku, než služba není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-280">Specifies the maximum tolerated percentage of unhealthy partitions before a service is considered unhealthy.</span></span> <span data-ttu-id="8d235-281">Výchozí procento: nula.</span><span class="sxs-lookup"><span data-stu-id="8d235-281">Default percentage: zero.</span></span>
* <span data-ttu-id="8d235-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span><span class="sxs-lookup"><span data-stu-id="8d235-282">[MaxPercentUnhealthyReplicasPerPartition](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyreplicasperpartition).</span></span> <span data-ttu-id="8d235-283">Určuje maximální procento. povolená repliky není v pořádku, než oddíl není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-283">Specifies the maximum tolerated percentage of unhealthy replicas before a partition is considered unhealthy.</span></span> <span data-ttu-id="8d235-284">Výchozí procento: nula.</span><span class="sxs-lookup"><span data-stu-id="8d235-284">Default percentage: zero.</span></span>
* <span data-ttu-id="8d235-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span><span class="sxs-lookup"><span data-stu-id="8d235-285">[MaxPercentUnhealthyServices](https://docs.microsoft.com/dotnet/api/system.fabric.health.servicetypehealthpolicy.maxpercentunhealthyservices).</span></span> <span data-ttu-id="8d235-286">Určuje maximální procento. povolená služby není v pořádku, než aplikace není v pořádku.</span><span class="sxs-lookup"><span data-stu-id="8d235-286">Specifies the maximum tolerated percentage of unhealthy services before the application is considered unhealthy.</span></span> <span data-ttu-id="8d235-287">Výchozí procento: nula.</span><span class="sxs-lookup"><span data-stu-id="8d235-287">Default percentage: zero.</span></span>

<span data-ttu-id="8d235-288">Následující příklad je výňatek ze manifest aplikace:</span><span class="sxs-lookup"><span data-stu-id="8d235-288">The following example is an excerpt from an application manifest:</span></span>

```xml
    <Policies>
        <HealthPolicy ConsiderWarningAsError="true" MaxPercentUnhealthyDeployedApplications="20">
            <DefaultServiceTypeHealthPolicy
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="10"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="FrontEndServiceType"
                   MaxPercentUnhealthyServices="0"
                   MaxPercentUnhealthyPartitionsPerService="20"
                   MaxPercentUnhealthyReplicasPerPartition="0"/>
            <ServiceTypeHealthPolicy ServiceTypeName="BackEndServiceType"
                   MaxPercentUnhealthyServices="20"
                   MaxPercentUnhealthyPartitionsPerService="0"
                   MaxPercentUnhealthyReplicasPerPartition="0">
            </ServiceTypeHealthPolicy>
        </HealthPolicy>
    </Policies>
```

## <a name="health-evaluation"></a><span data-ttu-id="8d235-289">Vyhodnocení stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-289">Health evaluation</span></span>
<span data-ttu-id="8d235-290">Uživatele a automatizované služby můžete kdykoli vyhodnocení stavu pro všechny entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-290">Users and automated services can evaluate health for any entity at any time.</span></span> <span data-ttu-id="8d235-291">K vyhodnocení stavu entity, agregace úložiště stavu všechny stavy hlásí u entity a vyhodnocuje všechny její podřízené položky (v případě potřeby).</span><span class="sxs-lookup"><span data-stu-id="8d235-291">To evaluate an entity's health, the health store aggregates all health reports on the entity and evaluates all its children (when applicable).</span></span> <span data-ttu-id="8d235-292">Algoritmus agregace stavu používá zásady stavu, které určují, jak vyhodnotit sestavy o stavu a jak k agregaci podřízené stavů (v případě potřeby).</span><span class="sxs-lookup"><span data-stu-id="8d235-292">The health aggregation algorithm uses health policies that specify how to evaluate health reports and how to aggregate child health states (when applicable).</span></span>

### <a name="health-report-aggregation"></a><span data-ttu-id="8d235-293">Agregace sestav stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-293">Health report aggregation</span></span>
<span data-ttu-id="8d235-294">Jedna entita může mít několik sestav stavu poslal jiný reporters (součásti systému nebo watchdogs) na jiné vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="8d235-294">One entity can have multiple health reports sent by different reporters (system components or watchdogs) on different properties.</span></span> <span data-ttu-id="8d235-295">Agregace používá zásady přidružené stavu, zejména ConsiderWarningAsError členem zásady stavu aplikace nebo clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-295">The aggregation uses the associated health policies, in particular the ConsiderWarningAsError member of application or cluster health policy.</span></span> <span data-ttu-id="8d235-296">ConsiderWarningAsError Určuje, jak vyhodnotit upozornění.</span><span class="sxs-lookup"><span data-stu-id="8d235-296">ConsiderWarningAsError specifies how to evaluate warnings.</span></span>

<span data-ttu-id="8d235-297">Agregovaný stav je aktivován *nejhorší* sestavy stavu u entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-297">The aggregated health state is triggered by the *worst* health reports on the entity.</span></span> <span data-ttu-id="8d235-298">Pokud je sestava stavu alespoň jednu chybu, agregovaný stav je chyba.</span><span class="sxs-lookup"><span data-stu-id="8d235-298">If there is at least one error health report, the aggregated health state is an error.</span></span>

![Agregace sestavy stavu s zprávu o chybách.][2]

<span data-ttu-id="8d235-300">Stav entity, který má jeden nebo více sestav stavu chyby je vyhodnocena jako chyba.</span><span class="sxs-lookup"><span data-stu-id="8d235-300">A health entity that has one or more error health reports is evaluated as Error.</span></span> <span data-ttu-id="8d235-301">Totéž platí pro zprávu o stavu s ukončenou platností, bez ohledu na jeho stav.</span><span class="sxs-lookup"><span data-stu-id="8d235-301">The same is true for an expired health report, regardless of its health state.</span></span>

[2]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-error.png

<span data-ttu-id="8d235-302">Pokud nejsou žádné zprávy o chybách a jedno či více varování, je agregovaný stav upozornění nebo chyby, v závislosti na příznak ConsiderWarningAsError zásad.</span><span class="sxs-lookup"><span data-stu-id="8d235-302">If there are no error reports and one or more warnings, the aggregated health state is either warning or error, depending on the ConsiderWarningAsError policy flag.</span></span>

![Agregace sestavy stavu se sestava upozornění a ConsiderWarningAsError false.][3]

<span data-ttu-id="8d235-304">Agregace sestavy stavu se sestava upozornění a ConsiderWarningAsError nastavena na hodnotu false (výchozí).</span><span class="sxs-lookup"><span data-stu-id="8d235-304">Health report aggregation with warning report and ConsiderWarningAsError set to false (default).</span></span>

[3]: ./media/service-fabric-health-introduction/servicefabric-health-report-eval-warning.png

### <a name="child-health-aggregation"></a><span data-ttu-id="8d235-305">Podřízená položka stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-305">Child health aggregation</span></span>
<span data-ttu-id="8d235-306">Agregovaný stav entity odráží stav podřízených (v případě potřeby).</span><span class="sxs-lookup"><span data-stu-id="8d235-306">The aggregated health state of an entity reflects the child health states (when applicable).</span></span> <span data-ttu-id="8d235-307">Algoritmus pro souhrn stavů podřízené používá stavu zásady použitelné na základě typu entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-307">The algorithm for aggregating child health states uses the health policies applicable based on the entity type.</span></span>

![Podřízená položka stavu entity.][4]

<span data-ttu-id="8d235-309">Podřízená položka na základě zásad stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-309">Child aggregation based on health policies.</span></span>

[4]: ./media/service-fabric-health-introduction/servicefabric-health-hierarchy-eval.png

<span data-ttu-id="8d235-310">Po vyhodnotit všechny podřízené objekty úložiště zdravotní agreguje jejich stavů podle nakonfigurované maximální procento není v pořádku, děti.</span><span class="sxs-lookup"><span data-stu-id="8d235-310">After the health store has evaluated all the children, it aggregates their health states based on the configured maximum percentage of unhealthy children.</span></span> <span data-ttu-id="8d235-311">Toto procento je převzat ze zásad na základě typu entity a podřízené.</span><span class="sxs-lookup"><span data-stu-id="8d235-311">This percentage is taken from the policy based on the entity and child type.</span></span>

* <span data-ttu-id="8d235-312">Pokud všechny podřízené objekty mají OK stavy, stav podřízených agregovat je OK.</span><span class="sxs-lookup"><span data-stu-id="8d235-312">If all children have OK states, the child aggregated health state is OK.</span></span>
* <span data-ttu-id="8d235-313">Pokud podřízené objekty mají OK a upozornění stavy stav podřízených agregovat je upozornění.</span><span class="sxs-lookup"><span data-stu-id="8d235-313">If children have both OK and warning states, the child aggregated health state is warning.</span></span>
* <span data-ttu-id="8d235-314">Pokud existují podřízené objekty s chybové stavy, které neodpovídají maximální povolené procento není v pořádku, děti, agregovaný stav je chyba.</span><span class="sxs-lookup"><span data-stu-id="8d235-314">If there are children with error states that do not respect the maximum allowed percentage of unhealthy children, the aggregated health state is an error.</span></span>
* <span data-ttu-id="8d235-315">Pokud podřízených objektů se stavy chyba respektují maximální povolené procento není v pořádku, děti, agregovaný stav je upozornění.</span><span class="sxs-lookup"><span data-stu-id="8d235-315">If the children with error states respect the maximum allowed percentage of unhealthy children, the aggregated health state is warning.</span></span>

## <a name="health-reporting"></a><span data-ttu-id="8d235-316">Vytváření sestav stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-316">Health reporting</span></span>
<span data-ttu-id="8d235-317">Součásti systému, aplikace systému prostředků infrastruktury a interní/externí watchdogs může hlásit proti Service Fabric entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-317">System components, System Fabric applications, and internal/external watchdogs can report against Service Fabric entities.</span></span> <span data-ttu-id="8d235-318">Ujistěte se, reporters *místní* stanovení stavu monitorovaných entit, na základě podmínek, že monitorování.</span><span class="sxs-lookup"><span data-stu-id="8d235-318">The reporters make *local* determinations of the health of the monitored entities, based on the conditions they are monitoring.</span></span> <span data-ttu-id="8d235-319">Nemusí se podívat na všechny globální stav nebo agregovaná data.</span><span class="sxs-lookup"><span data-stu-id="8d235-319">They don't need to look at any global state or aggregate data.</span></span> <span data-ttu-id="8d235-320">Toto chování žádoucí je jednoduchý reporters a ne s komplexními organismy, které je potřeba, podívejte se na celou řadu věcí odvodit informacích k odeslání.</span><span class="sxs-lookup"><span data-stu-id="8d235-320">The desired behavior is to have simple reporters, and not complex organisms that need to look at many things to infer what information to send.</span></span>

<span data-ttu-id="8d235-321">Zpravodaje, která pokud chcete odeslat data o stavu k úložišti stavů, musí identifikovat ovlivněné entity a vytvoření sestavy stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-321">To send health data to the health store, a reporter needs to identify the affected entity and create a health report.</span></span> <span data-ttu-id="8d235-322">Chcete-li odeslat zprávu o, použijte [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) rozhraní API, sestava stavu rozhraní API zveřejněné na `Partition` nebo `CodePackageActivationContext` objekty, rutiny prostředí PowerShell nebo REST.</span><span class="sxs-lookup"><span data-stu-id="8d235-322">To send the report, use the [FabricClient.HealthClient.ReportHealth](https://docs.microsoft.com/dotnet/api/system.fabric.fabricclient.healthclient.reporthealth) API, report health APIs exposed on the `Partition` or `CodePackageActivationContext` objects, PowerShell cmdlets, or REST.</span></span>

### <a name="health-reports"></a><span data-ttu-id="8d235-323">Sestavy o stavu</span><span class="sxs-lookup"><span data-stu-id="8d235-323">Health reports</span></span>
<span data-ttu-id="8d235-324">[Sestav stavu](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) pro každou z entit v clusteru obsahovat tyto informace:</span><span class="sxs-lookup"><span data-stu-id="8d235-324">The [health reports](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthreport) for each of the entities in the cluster contain the following information:</span></span>

* <span data-ttu-id="8d235-325">**SourceId**.</span><span class="sxs-lookup"><span data-stu-id="8d235-325">**SourceId**.</span></span> <span data-ttu-id="8d235-326">Řetězec, který jednoznačně identifikuje ohlašování stavu události.</span><span class="sxs-lookup"><span data-stu-id="8d235-326">A string that uniquely identifies the reporter of the health event.</span></span>
* <span data-ttu-id="8d235-327">**Identifikátor entity**.</span><span class="sxs-lookup"><span data-stu-id="8d235-327">**Entity identifier**.</span></span> <span data-ttu-id="8d235-328">Identifikuje entity, kde je použito sestavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-328">Identifies the entity where the report is applied.</span></span> <span data-ttu-id="8d235-329">Liší se i na základě [typ entity](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span><span class="sxs-lookup"><span data-stu-id="8d235-329">It differs based on the [entity type](service-fabric-health-introduction.md#health-entities-and-hierarchy):</span></span>
  
  * <span data-ttu-id="8d235-330">Cluster.</span><span class="sxs-lookup"><span data-stu-id="8d235-330">Cluster.</span></span> <span data-ttu-id="8d235-331">Žádné.</span><span class="sxs-lookup"><span data-stu-id="8d235-331">None.</span></span>
  * <span data-ttu-id="8d235-332">Uzel.</span><span class="sxs-lookup"><span data-stu-id="8d235-332">Node.</span></span> <span data-ttu-id="8d235-333">Název uzlu (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-333">Node name  (string).</span></span>
  * <span data-ttu-id="8d235-334">Aplikace.</span><span class="sxs-lookup"><span data-stu-id="8d235-334">Application.</span></span> <span data-ttu-id="8d235-335">Název aplikace (URI).</span><span class="sxs-lookup"><span data-stu-id="8d235-335">Application name (URI).</span></span> <span data-ttu-id="8d235-336">Představuje název instance aplikace nasazené v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-336">Represents the name of the application instance deployed in the cluster.</span></span>
  * <span data-ttu-id="8d235-337">Služba.</span><span class="sxs-lookup"><span data-stu-id="8d235-337">Service.</span></span> <span data-ttu-id="8d235-338">Název služby (URI).</span><span class="sxs-lookup"><span data-stu-id="8d235-338">Service name (URI).</span></span> <span data-ttu-id="8d235-339">Představuje název instance služby, který je nasazen v clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-339">Represents the name of the service instance deployed in the cluster.</span></span>
  * <span data-ttu-id="8d235-340">Oddíl.</span><span class="sxs-lookup"><span data-stu-id="8d235-340">Partition.</span></span> <span data-ttu-id="8d235-341">Oddíl ID (GUID).</span><span class="sxs-lookup"><span data-stu-id="8d235-341">Partition ID (GUID).</span></span> <span data-ttu-id="8d235-342">Představuje jedinečný identifikátor oddílu.</span><span class="sxs-lookup"><span data-stu-id="8d235-342">Represents the partition unique identifier.</span></span>
  * <span data-ttu-id="8d235-343">Replika.</span><span class="sxs-lookup"><span data-stu-id="8d235-343">Replica.</span></span> <span data-ttu-id="8d235-344">ID repliky stavové služby nebo ID instance bezstavové služby (INT64).</span><span class="sxs-lookup"><span data-stu-id="8d235-344">The stateful service replica ID or the stateless service instance ID (INT64).</span></span>
  * <span data-ttu-id="8d235-345">DeployedApplication.</span><span class="sxs-lookup"><span data-stu-id="8d235-345">DeployedApplication.</span></span> <span data-ttu-id="8d235-346">Název aplikace (URI) a název uzlu (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-346">Application name (URI) and node name (string).</span></span>
  * <span data-ttu-id="8d235-347">DeployedServicePackage.</span><span class="sxs-lookup"><span data-stu-id="8d235-347">DeployedServicePackage.</span></span> <span data-ttu-id="8d235-348">Název aplikace (URI), název uzlu (string) a service manifest název (string).</span><span class="sxs-lookup"><span data-stu-id="8d235-348">Application name (URI), node name (string), and service manifest name (string).</span></span>
* <span data-ttu-id="8d235-349">**Vlastnost**.</span><span class="sxs-lookup"><span data-stu-id="8d235-349">**Property**.</span></span> <span data-ttu-id="8d235-350">A *řetězec* (ne na pevnou výčet), která umožňuje zpravodaje zařadit do kategorií událost stavu pro určité vlastnosti entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-350">A *string* (not a fixed enumeration) that allows the reporter to categorize the health event for a specific property of the entity.</span></span> <span data-ttu-id="8d235-351">Například můžete ohlašování A hlášení stavu Node01 vlastnost "Úložiště" a ohlašování B mohou zasílat zprávy o stavu Node01 vlastnost "Připojení".</span><span class="sxs-lookup"><span data-stu-id="8d235-351">For example, reporter A can report the health of the Node01 "Storage" property and reporter B can report the health of the Node01 "Connectivity" property.</span></span> <span data-ttu-id="8d235-352">V health store tyto sestavy jsou považovány za události samostatné stavu pro entitu Node01.</span><span class="sxs-lookup"><span data-stu-id="8d235-352">In the health store, these reports are treated as separate health events for the Node01 entity.</span></span>
* <span data-ttu-id="8d235-353">**Popis**.</span><span class="sxs-lookup"><span data-stu-id="8d235-353">**Description**.</span></span> <span data-ttu-id="8d235-354">Řetězec, který umožňuje ohlašování poskytnout podrobné informace o stavu události.</span><span class="sxs-lookup"><span data-stu-id="8d235-354">A string that allows a reporter to provide detailed information about the health event.</span></span> <span data-ttu-id="8d235-355">**SourceId**, **vlastnost**, a **HealthState** by měl plně popisují sestavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-355">**SourceId**, **Property**, and **HealthState** should fully describe the report.</span></span> <span data-ttu-id="8d235-356">Popis přidá čitelná pro člověka informace o sestavě.</span><span class="sxs-lookup"><span data-stu-id="8d235-356">The description adds human-readable information about the report.</span></span> <span data-ttu-id="8d235-357">Text usnadňuje správcům a uživatelům pochopit sestava stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-357">The text makes it easier for administrators and users to understand the health report.</span></span>
* <span data-ttu-id="8d235-358">**Stav HealthState**.</span><span class="sxs-lookup"><span data-stu-id="8d235-358">**HealthState**.</span></span> <span data-ttu-id="8d235-359">[Výčtu](service-fabric-health-introduction.md#health-states) stav sestavy, který popisuje.</span><span class="sxs-lookup"><span data-stu-id="8d235-359">An [enumeration](service-fabric-health-introduction.md#health-states) that describes the health state of the report.</span></span> <span data-ttu-id="8d235-360">Možné hodnoty jsou OK, upozornění a chyby.</span><span class="sxs-lookup"><span data-stu-id="8d235-360">The accepted values are OK, Warning, and Error.</span></span>
* <span data-ttu-id="8d235-361">**TimeToLive**.</span><span class="sxs-lookup"><span data-stu-id="8d235-361">**TimeToLive**.</span></span> <span data-ttu-id="8d235-362">Časový interval, která určuje, jak dlouho sestava stavu je platný.</span><span class="sxs-lookup"><span data-stu-id="8d235-362">A timespan that indicates how long the health report is valid.</span></span> <span data-ttu-id="8d235-363">Kombinaci s **RemoveWhenExpired**, umožňuje úložiště zdravotní vědět, jak vyhodnotit vypršela platnost události.</span><span class="sxs-lookup"><span data-stu-id="8d235-363">Coupled with **RemoveWhenExpired**, it lets the health store know how to evaluate expired events.</span></span> <span data-ttu-id="8d235-364">Ve výchozím nastavení hodnota je nekonečno a sestava je stále platný.</span><span class="sxs-lookup"><span data-stu-id="8d235-364">By default, the value is infinite, and the report is valid forever.</span></span>
* <span data-ttu-id="8d235-365">**RemoveWhenExpired**.</span><span class="sxs-lookup"><span data-stu-id="8d235-365">**RemoveWhenExpired**.</span></span> <span data-ttu-id="8d235-366">Logická hodnota.</span><span class="sxs-lookup"><span data-stu-id="8d235-366">A Boolean.</span></span> <span data-ttu-id="8d235-367">Pokud je nastaven na hodnotu true, sestava vypršela platnost stavu je automaticky odstraněna z health store a sestavy nebude mít vliv vyhodnocení stavu entity.</span><span class="sxs-lookup"><span data-stu-id="8d235-367">If set to true, the expired health report is automatically removed from the health store, and the report doesn't impact entity health evaluation.</span></span> <span data-ttu-id="8d235-368">Použít, když sestava je platný pro zadaný časový úsek pouze, a zpravodaje, která není nutné explicitně vyčistit. Používá se také k odstranění z health store sestav (například sledovací zařízení se změní a zastaví zasílání sestav se předchozí zdrojem a vlastnosti).</span><span class="sxs-lookup"><span data-stu-id="8d235-368">Used when the report is valid for a specified period of time only, and the reporter doesn't need to explicitly clear it out. It's also used to delete reports from the health store (for example, a watchdog is changed and stops sending reports with previous source and property).</span></span> <span data-ttu-id="8d235-369">Může poslat zprávu s krátkou TimeToLive společně s RemoveWhenExpired zrušte všechny předchozí stav z health store.</span><span class="sxs-lookup"><span data-stu-id="8d235-369">It can send a report with a brief TimeToLive along with RemoveWhenExpired to clear up any previous state from the health store.</span></span> <span data-ttu-id="8d235-370">Pokud je hodnota nastavena na hodnotu false, kterým vyprší platnost sestavy je považovat za chybu na vyhodnocení stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-370">If the value is set to false, the expired report is treated as an error on the health evaluation.</span></span> <span data-ttu-id="8d235-371">Hodnota false signály k úložišti stavu, který zdroj by měl pravidelně zprávu o tuto vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8d235-371">The false value signals to the health store that the source should report periodically on this property.</span></span> <span data-ttu-id="8d235-372">Pokud tomu tak není, pak musí existovat problém se sledovací zařízení.</span><span class="sxs-lookup"><span data-stu-id="8d235-372">If it doesn't, then there must be something wrong with the watchdog.</span></span> <span data-ttu-id="8d235-373">Sledovací zařízení stavu zachycenou s událostí za chybu.</span><span class="sxs-lookup"><span data-stu-id="8d235-373">The watchdog's health is captured by considering the event as an error.</span></span>
* <span data-ttu-id="8d235-374">**SequenceNumber**.</span><span class="sxs-lookup"><span data-stu-id="8d235-374">**SequenceNumber**.</span></span> <span data-ttu-id="8d235-375">Kladné celé číslo, které musí být stále rostoucí, představuje pořadí sestavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-375">A positive integer that needs to be ever-increasing, it represents the order of the reports.</span></span> <span data-ttu-id="8d235-376">Slouží podle stavu úložiště ke zjištění zastaralé sestavy, které byly přijaty opožděně z důvodu zpoždění sítě nebo jiných problémů.</span><span class="sxs-lookup"><span data-stu-id="8d235-376">It is used by the health store to detect stale reports that are received late because of network delays or other issues.</span></span> <span data-ttu-id="8d235-377">Sestava je zamítnut, když pořadové číslo je že menší než nebo rovna nejvíc nedávno aplikovat číslo pro stejnou entitu, zdroje a vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8d235-377">A report is rejected if the sequence number is less than or equal to the most recently applied number for the same entity, source, and property.</span></span> <span data-ttu-id="8d235-378">Pokud není zadaný, vygeneruje se automaticky pořadové číslo.</span><span class="sxs-lookup"><span data-stu-id="8d235-378">If it is not specified, the sequence number is generated automatically.</span></span> <span data-ttu-id="8d235-379">Je nutné uvést do pořadové číslo jenom v případě, že zprávy o přechodů mezi stavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-379">It is necessary to put in the sequence number only when reporting on state transitions.</span></span> <span data-ttu-id="8d235-380">V takovém případě musí zdroj mějte na paměti, které sestavy je odeslána a uchovávat informace pro obnovení na převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="8d235-380">In this situation, the source needs to remember which reports it sent and keep the information for recovery on failover.</span></span>

<span data-ttu-id="8d235-381">Tyto čtyři části informací – SourceId, identifikátor entity, vlastnosti a elementu HealthState – jsou vyžadovány pro každý sestava stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-381">These four pieces of information--SourceId, entity identifier, Property, and HealthState--are required for every health report.</span></span> <span data-ttu-id="8d235-382">SourceId řetězec nesmí začínat předponu "**systému.**", který je vyhrazený pro sestavy systému.</span><span class="sxs-lookup"><span data-stu-id="8d235-382">The SourceId string is not allowed to start with the prefix "**System.**", which is reserved for system reports.</span></span> <span data-ttu-id="8d235-383">Pro stejnou entitu je pouze jednu sestavu pro stejný zdroj a vlastnost.</span><span class="sxs-lookup"><span data-stu-id="8d235-383">For the same entity, there is only one report for the same source and property.</span></span> <span data-ttu-id="8d235-384">Několik sestav pro stejný zdroj a vlastnost přepíší navzájem, buď na straně klienta stavu (pokud jsou se dávkově) nebo na stav ukládání straně.</span><span class="sxs-lookup"><span data-stu-id="8d235-384">Multiple reports for the same source and property override each other, either on the health client side (if they are batched) or on the health store side.</span></span> <span data-ttu-id="8d235-385">Pokud chcete nahrazení podle pořadových čísel; novější sestavy (s vyšším pořadová čísla) nahraďte starší sestavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-385">The replacement is based on sequence numbers; newer reports (with higher sequence numbers) replace older reports.</span></span>

### <a name="health-events"></a><span data-ttu-id="8d235-386">Stav události</span><span class="sxs-lookup"><span data-stu-id="8d235-386">Health events</span></span>
<span data-ttu-id="8d235-387">Interně úložiště zdravotní udržuje [události stavu](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), které obsahují všechny informace ze sestav a dalších metadat.</span><span class="sxs-lookup"><span data-stu-id="8d235-387">Internally, the health store keeps [health events](https://docs.microsoft.com/dotnet/api/system.fabric.health.healthevent), which contain all the information from the reports, and additional metadata.</span></span> <span data-ttu-id="8d235-388">Metadata zahrnují době sestavy nebyl uveden do stavu klienta a čas, kdy se změnil na straně serveru.</span><span class="sxs-lookup"><span data-stu-id="8d235-388">The metadata includes the time the report was given to the health client and the time it was modified on the server side.</span></span> <span data-ttu-id="8d235-389">Události stavu se vrátí pomocí [dotazů na stav](service-fabric-view-entities-aggregated-health.md#health-queries).</span><span class="sxs-lookup"><span data-stu-id="8d235-389">The health events are returned by [health queries](service-fabric-view-entities-aggregated-health.md#health-queries).</span></span>

<span data-ttu-id="8d235-390">Přidání metadat obsahuje:</span><span class="sxs-lookup"><span data-stu-id="8d235-390">The added metadata contains:</span></span>

* <span data-ttu-id="8d235-391">**SourceUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="8d235-391">**SourceUtcTimestamp**.</span></span> <span data-ttu-id="8d235-392">Čas sestavy byl zadán do stavu klienta (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="8d235-392">The time the report was given to the health client (Coordinated Universal Time).</span></span>
* <span data-ttu-id="8d235-393">**LastModifiedUtcTimestamp**.</span><span class="sxs-lookup"><span data-stu-id="8d235-393">**LastModifiedUtcTimestamp**.</span></span> <span data-ttu-id="8d235-394">Čas, kdy sestavy, které bylo naposledy změněno na straně serveru (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="8d235-394">The time the report was last modified on the server side (Coordinated Universal Time).</span></span>
* <span data-ttu-id="8d235-395">**IsExpired**.</span><span class="sxs-lookup"><span data-stu-id="8d235-395">**IsExpired**.</span></span> <span data-ttu-id="8d235-396">Příznak označující, zda sestava byla při dotaz byl provedený úložiště zdravotní vypršelo.</span><span class="sxs-lookup"><span data-stu-id="8d235-396">A flag to indicate whether the report was expired when the query was executed by the health store.</span></span> <span data-ttu-id="8d235-397">Událost můžete platnost pouze v případě RemoveWhenExpired je false.</span><span class="sxs-lookup"><span data-stu-id="8d235-397">An event can be expired only if RemoveWhenExpired is false.</span></span> <span data-ttu-id="8d235-398">Událost, jinak hodnota není vrácených dotazem a bude odebrán z úložiště.</span><span class="sxs-lookup"><span data-stu-id="8d235-398">Otherwise, the event is not returned by query and is removed from the store.</span></span>
* <span data-ttu-id="8d235-399">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span><span class="sxs-lookup"><span data-stu-id="8d235-399">**LastOkTransitionAt**, **LastWarningTransitionAt**, **LastErrorTransitionAt**.</span></span> <span data-ttu-id="8d235-400">Čas poslední přechody OK, upozornění nebo chyby.</span><span class="sxs-lookup"><span data-stu-id="8d235-400">The last time for OK/warning/error transitions.</span></span> <span data-ttu-id="8d235-401">Tato pole poskytnout historii stavu přechodů mezi stavy pro událost.</span><span class="sxs-lookup"><span data-stu-id="8d235-401">These fields give the history of the health state transitions for the event.</span></span>

<span data-ttu-id="8d235-402">Pole přechod stavu lze chytřejší výstrahy nebo informace o stavu "historických".</span><span class="sxs-lookup"><span data-stu-id="8d235-402">The state transition fields can be used for smarter alerts or "historical" health event information.</span></span> <span data-ttu-id="8d235-403">Umožňují scénáře, jako:</span><span class="sxs-lookup"><span data-stu-id="8d235-403">They enable scenarios such as:</span></span>

* <span data-ttu-id="8d235-404">Upozornit, když vlastnost byla v upozornění nebo chyby pro více než X minut.</span><span class="sxs-lookup"><span data-stu-id="8d235-404">Alert when a property has been at warning/error for more than X minutes.</span></span> <span data-ttu-id="8d235-405">Kontrola podmínky pro určitou dobu zabraňuje výstrahy na dočasné stavy.</span><span class="sxs-lookup"><span data-stu-id="8d235-405">Checking the condition for a period of time avoids alerts on temporary conditions.</span></span> <span data-ttu-id="8d235-406">Například můžete výstrahu, pokud stav má byl upozornění pro více než pět minut přeložit na (stav HealthState == upozornění a nyní - LastWarningTransitionTime > 5 minut).</span><span class="sxs-lookup"><span data-stu-id="8d235-406">For example, an alert if the health state has been warning for more than five minutes can be translated into (HealthState == Warning and Now - LastWarningTransitionTime > 5 minutes).</span></span>
* <span data-ttu-id="8d235-407">Výstrahy pouze na podmínky, které se změnily v posledních X minut.</span><span class="sxs-lookup"><span data-stu-id="8d235-407">Alert only on conditions that have changed in the last X minutes.</span></span> <span data-ttu-id="8d235-408">Pokud sestavu již byla v chybě než určený čas, může být ignorována, protože byl již signalizovala dříve.</span><span class="sxs-lookup"><span data-stu-id="8d235-408">If a report was already at error before the specified time, it can be ignored because it was already signaled previously.</span></span>
* <span data-ttu-id="8d235-409">Pokud vlastnost je při přepínání mezi upozornění a chyb, zjistěte, jak dlouho byla není v pořádku (to znamená, není OK).</span><span class="sxs-lookup"><span data-stu-id="8d235-409">If a property is toggling between warning and error, determine how long it has been unhealthy (that is, not OK).</span></span> <span data-ttu-id="8d235-410">Například můžete výstrahu, pokud vlastnost nebyla v pořádku po dobu více než pět minut přeložit na (stav HealthState! = Ok a teď - LastOkTransitionTime > 5 minut).</span><span class="sxs-lookup"><span data-stu-id="8d235-410">For example, an alert if the property hasn't been healthy for more than five minutes can be translated into (HealthState != Ok and Now - LastOkTransitionTime > 5 minutes).</span></span>

## <a name="example-report-and-evaluate-application-health"></a><span data-ttu-id="8d235-411">Příklad: Vytvoření sestavy a vyhodnocování stavu aplikace</span><span class="sxs-lookup"><span data-stu-id="8d235-411">Example: Report and evaluate application health</span></span>
<span data-ttu-id="8d235-412">Následující příklad odešle zprávu o stavu pomocí prostředí PowerShell na aplikaci **fabric: / WordCount** ze zdroje **MyWatchdog**.</span><span class="sxs-lookup"><span data-stu-id="8d235-412">The following example sends a health report through PowerShell on the application **fabric:/WordCount** from the source **MyWatchdog**.</span></span> <span data-ttu-id="8d235-413">Sestava stavu obsahuje informace o stavu vlastnost "dostupnosti" v chybového stavu, s neomezenou TimeToLive.</span><span class="sxs-lookup"><span data-stu-id="8d235-413">The health report contains information about the health property "availability" in an error health state, with infinite TimeToLive.</span></span> <span data-ttu-id="8d235-414">Následně dotazuje stavu aplikací, která vrátí agregovat stavu stav chyby a události hlášené stavu v seznamu události stavu.</span><span class="sxs-lookup"><span data-stu-id="8d235-414">Then it queries the application health, which returns aggregated health state errors and the reported health events in the list of health events.</span></span>

```powershell
PS C:\> Send-ServiceFabricApplicationHealthReport –ApplicationName fabric:/WordCount –SourceId "MyWatchdog" –HealthProperty "Availability" –HealthState Error

PS C:\> Get-ServiceFabricApplicationHealth fabric:/WordCount -ExcludeHealthStatistics


ApplicationName                 : fabric:/WordCount
AggregatedHealthState           : Error
UnhealthyEvaluations            :
                                  Error event: SourceId='MyWatchdog', Property='Availability'.

ServiceHealthStates             :
                                  ServiceName           : fabric:/WordCount/WordCountService
                                  AggregatedHealthState : Error

                                  ServiceName           : fabric:/WordCount/WordCountWebService
                                  AggregatedHealthState : Ok

DeployedApplicationHealthStates :
                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_0
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_2
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_3
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_4
                                  AggregatedHealthState : Ok

                                  ApplicationName       : fabric:/WordCount
                                  NodeName              : _Node_1
                                  AggregatedHealthState : Ok

HealthEvents                    :
                                  SourceId              : System.CM
                                  Property              : State
                                  HealthState           : Ok
                                  SequenceNumber        : 360
                                  SentAt                : 3/22/2016 7:56:53 PM
                                  ReceivedAt            : 3/22/2016 7:56:53 PM
                                  TTL                   : Infinite
                                  Description           : Application has been created.
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Error->Ok = 3/22/2016 7:56:53 PM, LastWarning = 1/1/0001 12:00:00 AM

                                  SourceId              : MyWatchdog
                                  Property              : Availability
                                  HealthState           : Error
                                  SequenceNumber        : 131032204762818013
                                  SentAt                : 3/23/2016 3:27:56 PM
                                  ReceivedAt            : 3/23/2016 3:27:56 PM
                                  TTL                   : Infinite
                                  Description           :
                                  RemoveWhenExpired     : False
                                  IsExpired             : False
                                  Transitions           : Ok->Error = 3/23/2016 3:27:56 PM, LastWarning = 1/1/0001 12:00:00 AM
```

## <a name="health-model-usage"></a><span data-ttu-id="8d235-415">Použití stavu modelu</span><span class="sxs-lookup"><span data-stu-id="8d235-415">Health model usage</span></span>
<span data-ttu-id="8d235-416">Health model umožňuje cloudové služby a základní platformy Service Fabric chcete použít škálování, protože stanovení stavu a monitorování jsou rozděleny do různých monitorování v rámci clusteru.</span><span class="sxs-lookup"><span data-stu-id="8d235-416">The health model allows cloud services and the underlying Service Fabric platform to scale, because monitoring and health determinations are distributed among the different monitors within the cluster.</span></span>
<span data-ttu-id="8d235-417">Jiné systémy musí mít jedinou, centralizovanou služby na úrovni clusteru, která analyzuje všechny *potenciálně* užitečné informace, které služby.</span><span class="sxs-lookup"><span data-stu-id="8d235-417">Other systems have a single, centralized service at the cluster level that parses all the *potentially* useful information emitted by services.</span></span> <span data-ttu-id="8d235-418">Tento přístup omezuje jejich škálovatelnost.</span><span class="sxs-lookup"><span data-stu-id="8d235-418">This approach hinders their scalability.</span></span> <span data-ttu-id="8d235-419">Je také nedovoluje shromažďovat konkrétní informace usnadňují identifikaci problémů a s potenciálními problémy jako blízko příčiny nejblíže.</span><span class="sxs-lookup"><span data-stu-id="8d235-419">It also doesn't allow them to collect specific information to help identify issues and potential issues as close to the root cause as possible.</span></span>

<span data-ttu-id="8d235-420">Health model se používá výraznou pro monitorování a diagnostiku pro vyhodnocení stavu cluster a aplikace a monitorovaných upgrady.</span><span class="sxs-lookup"><span data-stu-id="8d235-420">The health model is used heavily for monitoring and diagnosis, for evaluating cluster and application health, and for monitored upgrades.</span></span> <span data-ttu-id="8d235-421">Jiné služby stavu data použít k provedení automatické opravy, sestavení historie stavu clusteru a vydání výstrahy na určité podmínky.</span><span class="sxs-lookup"><span data-stu-id="8d235-421">Other services use health data to perform automatic repairs, build cluster health history, and issue alerts on certain conditions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="8d235-422">Další kroky</span><span class="sxs-lookup"><span data-stu-id="8d235-422">Next steps</span></span>
[<span data-ttu-id="8d235-423">Zobrazit sestavy stavu Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8d235-423">View Service Fabric health reports</span></span>](service-fabric-view-entities-aggregated-health.md)

[<span data-ttu-id="8d235-424">Pomocí sestav o stavu systému pro řešení potíží</span><span class="sxs-lookup"><span data-stu-id="8d235-424">Use system health reports for troubleshooting</span></span>](service-fabric-understand-and-troubleshoot-with-system-health-reports.md)

[<span data-ttu-id="8d235-425">Postup vytvoření sestavy a zkontrolujte stav služby</span><span class="sxs-lookup"><span data-stu-id="8d235-425">How to report and check service health</span></span>](service-fabric-diagnostics-how-to-report-and-check-service-health.md)

[<span data-ttu-id="8d235-426">Přidat vlastní sestavy stavu Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8d235-426">Add custom Service Fabric health reports</span></span>](service-fabric-report-health.md)

[<span data-ttu-id="8d235-427">Monitorování a Diagnostika služby místně</span><span class="sxs-lookup"><span data-stu-id="8d235-427">Monitor and diagnose services locally</span></span>](service-fabric-diagnostics-how-to-monitor-and-diagnose-services-locally.md)

[<span data-ttu-id="8d235-428">Upgrade aplikace Service Fabric</span><span class="sxs-lookup"><span data-stu-id="8d235-428">Service Fabric application upgrade</span></span>](service-fabric-application-upgrade.md)


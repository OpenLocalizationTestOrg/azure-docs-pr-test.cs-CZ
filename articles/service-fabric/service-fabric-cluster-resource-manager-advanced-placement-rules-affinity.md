---
title: "aaaService správce prostředků infrastruktury Cluster - spřažení | Microsoft Docs"
description: "Přehled konfigurace spřažení pro služby Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 7dc9b6d9c18d9d615d39cff7de9d7cba1c040474
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="266c9-103">Konfigurace a použití spřažení služby v Service Fabric</span><span class="sxs-lookup"><span data-stu-id="266c9-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="266c9-104">Spřažení je ovládací prvek, který je k dispozici především toohelp snadné hello přechod větší monolitický aplikace do cloudu a mikroslužeb world hello.</span><span class="sxs-lookup"><span data-stu-id="266c9-104">Affinity is a control that is provided mainly toohelp ease hello transition of larger monolithic applications into hello cloud and microservices world.</span></span> <span data-ttu-id="266c9-105">Také slouží jako optimalizace pro zlepšení výkonu hello služeb, i když to může mít vedlejší účinky.</span><span class="sxs-lookup"><span data-stu-id="266c9-105">It is also used as an optimization for improving hello performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="266c9-106">Řekněme, že jste přináší větší aplikace, nebo ten, který právě nebyl navržen s mikroslužeb v paměti, tooService prostředků infrastruktury (nebo všechny distribuovaném prostředí).</span><span class="sxs-lookup"><span data-stu-id="266c9-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, tooService Fabric (or any distributed environment).</span></span> <span data-ttu-id="266c9-107">Tento typ přechodu je běžné.</span><span class="sxs-lookup"><span data-stu-id="266c9-107">This type of transition is common.</span></span> <span data-ttu-id="266c9-108">Můžete začít zrušení celá aplikace hello do prostředí hello, balení a ujistěte se, že je plynulý chod.</span><span class="sxs-lookup"><span data-stu-id="266c9-108">You start by lifting hello entire app into hello environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="266c9-109">Potom spusťte jej rozdělit do různých menší služeb, že všechny komunikovat tooeach jiné.</span><span class="sxs-lookup"><span data-stu-id="266c9-109">Then you start breaking it down into different smaller services that all talk tooeach other.</span></span>

<span data-ttu-id="266c9-110">Nakonec můžete zjistit, že aplikace hello dochází k problémům.</span><span class="sxs-lookup"><span data-stu-id="266c9-110">Eventually you may find that hello application is experiencing some issues.</span></span> <span data-ttu-id="266c9-111">Hello problémů obvykle spadají do jedné z těchto kategorií:</span><span class="sxs-lookup"><span data-stu-id="266c9-111">hello issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="266c9-112">Některé součásti X hello monolitický aplikace měla nedokumentovanými závislost na součásti Y a právě převedena tyto součásti na samostatné služby.</span><span class="sxs-lookup"><span data-stu-id="266c9-112">Some component X in hello monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="266c9-113">Vzhledem k tomu, že tyto služby běží v rozdílných uzlech v clusteru hello, jsou poškozená.</span><span class="sxs-lookup"><span data-stu-id="266c9-113">Since these services are now running on different nodes in hello cluster, they're broken.</span></span>
2. <span data-ttu-id="266c9-114">Tyto součásti komunikovat přes (místní pojmenované kanály | sdílené paměti | soubory na disku) a skutečně potřebují toobe možné toowrite tooa sdílet místní prostředek z důvodů výkonu hned teď.</span><span class="sxs-lookup"><span data-stu-id="266c9-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need toobe able toowrite tooa shared local resource for performance reasons right now.</span></span> <span data-ttu-id="266c9-115">Že pevné závislostí získá později odebral, možná.</span><span class="sxs-lookup"><span data-stu-id="266c9-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="266c9-116">Všechno, co je v pořádku, ale ukazuje se, že tyto dvě součásti jsou ve skutečnosti chatty a výkonu citlivé.</span><span class="sxs-lookup"><span data-stu-id="266c9-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="266c9-117">Při jejich přesunu do samostatné služby celkového výkonu aplikace tanked nebo latenci vyšší.</span><span class="sxs-lookup"><span data-stu-id="266c9-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="266c9-118">V důsledku toho hello celkové aplikace není splnění očekávání.</span><span class="sxs-lookup"><span data-stu-id="266c9-118">As a result, hello overall application is not meeting expectations.</span></span>

<span data-ttu-id="266c9-119">V těchto případech jsme nechcete, aby toolose naše refaktoringu pracovní a nechcete, aby toogo back toohello monolitu.</span><span class="sxs-lookup"><span data-stu-id="266c9-119">In these cases, we don’t want toolose our refactoring work, and don’t want toogo back toohello monolith.</span></span> <span data-ttu-id="266c9-120">poslední podmínka Hello může být i žádoucí jako prostý optimalizace.</span><span class="sxs-lookup"><span data-stu-id="266c9-120">hello last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="266c9-121">Ale dokud jsme můžete změnit návrh hello součásti toowork přirozeně jako služby (nebo dokud jsme může pomoct vyřešit očekávaný výkon hello nějakým způsobem) vytvoříme tooneed některé smysl polohu.</span><span class="sxs-lookup"><span data-stu-id="266c9-121">However, until we can redesign hello components toowork naturally as services (or until we can solve hello performance expectations some other way) we're going tooneed some sense of locality.</span></span>

<span data-ttu-id="266c9-122">Jaké toodo?</span><span class="sxs-lookup"><span data-stu-id="266c9-122">What toodo?</span></span> <span data-ttu-id="266c9-123">Dobře mohou zkuste zapnete spřažení.</span><span class="sxs-lookup"><span data-stu-id="266c9-123">Well, you could try turning on affinity.</span></span>

## <a name="how-tooconfigure-affinity"></a><span data-ttu-id="266c9-124">Jak tooconfigure spřažení</span><span class="sxs-lookup"><span data-stu-id="266c9-124">How tooconfigure affinity</span></span>
<span data-ttu-id="266c9-125">tooset až spřažení, můžete definovat relaci spřažení mezi dva různé služby.</span><span class="sxs-lookup"><span data-stu-id="266c9-125">tooset up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="266c9-126">Si můžete představit spřažení jako "ukazující" jedné služby v jiné a informacemi o tom, "tuto službu spustit pouze kde běží služba."</span><span class="sxs-lookup"><span data-stu-id="266c9-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="266c9-127">Někdy tooaffinity označujeme jako relaci nadřazený podřízený (kde je bod hello podřízené v nadřazené hello).</span><span class="sxs-lookup"><span data-stu-id="266c9-127">Sometimes we refer tooaffinity as a parent/child relationship (where you point hello child at hello parent).</span></span> <span data-ttu-id="266c9-128">Spřažení zajišťuje, že hello replik nebo instancí jedné služby budou umístěny v hello stejné uzly jako jiné služby.</span><span class="sxs-lookup"><span data-stu-id="266c9-128">Affinity ensures that hello replicas or instances of one service are placed on hello same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="266c9-129">Služba podřízené jenom účastnit vztahu jeden spřažení.</span><span class="sxs-lookup"><span data-stu-id="266c9-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="266c9-130">Pokud byste chtěli hello podřízené toobe spřažené tootwo nadřazené služby najednou máte několik možností:</span><span class="sxs-lookup"><span data-stu-id="266c9-130">If you wanted hello child toobe affinitized tootwo parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="266c9-131">Reverse hello relace (mají parentService1 a parentService2, přejděte na aktuální službu podřízené hello), nebo</span><span class="sxs-lookup"><span data-stu-id="266c9-131">Reverse hello relationships (have parentService1 and parentService2 point at hello current child service), or</span></span>
> - <span data-ttu-id="266c9-132">Určete jeden z nadřazené položky hello jako rozbočovač podle konvence a mít všechny služby, přejděte na tuto službu.</span><span class="sxs-lookup"><span data-stu-id="266c9-132">Designate one of hello parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="266c9-133">Hello výsledná chování umístění v clusteru hello by měl být hello stejné.</span><span class="sxs-lookup"><span data-stu-id="266c9-133">hello resulting placement behavior in hello cluster should be hello same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="266c9-134">Možnosti různých spřažení</span><span class="sxs-lookup"><span data-stu-id="266c9-134">Different affinity options</span></span>
<span data-ttu-id="266c9-135">Spřažení je reprezentována prostřednictvím jedním z několika korelace schémata a má dva různé režimy.</span><span class="sxs-lookup"><span data-stu-id="266c9-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="266c9-136">Hello nejběžnější režim spřažení nazýváme NonAlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="266c9-136">hello most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="266c9-137">V NonAlignedAffinity, hello replik nebo instancí hello různé služby jsou umístěny na hello stejné uzly.</span><span class="sxs-lookup"><span data-stu-id="266c9-137">In NonAlignedAffinity, hello replicas or instances of hello different services are placed on hello same nodes.</span></span> <span data-ttu-id="266c9-138">Hello jiných režim je AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="266c9-138">hello other mode is AlignedAffinity.</span></span> <span data-ttu-id="266c9-139">Zarovnaný spřažení je užitečný jenom v případě stavové služby.</span><span class="sxs-lookup"><span data-stu-id="266c9-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="266c9-140">Konfigurace dvou stateful spřažení toohave zarovnán služeb zajišťuje, že základní barvy hello těchto služeb jsou uvedeny na hello stejným uzlům, jako každé jiné.</span><span class="sxs-lookup"><span data-stu-id="266c9-140">Configuring two stateful services toohave aligned affinity ensures that hello primaries of those services are placed on hello same nodes as each other.</span></span> <span data-ttu-id="266c9-141">Také způsobuje, že každý pár sekundárních databází pro tyto služby toobe umístit na hello stejné uzly.</span><span class="sxs-lookup"><span data-stu-id="266c9-141">It also causes each pair of secondaries for those services toobe placed on hello same nodes.</span></span> <span data-ttu-id="266c9-142">Je také možné tooconfigure NonAlignedAffinity (přestože méně častých) pro stavové služby.</span><span class="sxs-lookup"><span data-stu-id="266c9-142">It is also possible (though less common) tooconfigure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="266c9-143">Pro NonAlignedAffinity hello hello dvě stavové služby běžet na různých repliky hello stejným uzlům, ale jejich základní barvy, může dojít v různých uzlech.</span><span class="sxs-lookup"><span data-stu-id="266c9-143">For NonAlignedAffinity, hello different replicas of hello two stateful services would run on hello same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="266c9-144"><center>
![Režimy spřažení a jejich důsledky][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="266c9-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="266c9-145">Nejlepší stav úsilí potřeby</span><span class="sxs-lookup"><span data-stu-id="266c9-145">Best effort desired state</span></span>
<span data-ttu-id="266c9-146">Relaci spřažení je nejlepší úsilí.</span><span class="sxs-lookup"><span data-stu-id="266c9-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="266c9-147">Neposkytuje hello stejné záruky společné umístění nebo spolehlivost, která spuštěná v hello nemá stejné spustitelného souboru procesu.</span><span class="sxs-lookup"><span data-stu-id="266c9-147">It does not provide hello same guarantees of collocation or reliability that running in hello same executable process does.</span></span> <span data-ttu-id="266c9-148">Hello služby v relaci spřažení se podstatně liší entit, které můžou selhat a přesunování nezávisle.</span><span class="sxs-lookup"><span data-stu-id="266c9-148">hello services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="266c9-149">Relaci spřažení může také zalomit, i když jsou tyto konce dočasné.</span><span class="sxs-lookup"><span data-stu-id="266c9-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="266c9-150">Například omezení kapacity může znamenat, že jenom některé z hello služby objekty v relaci spřažení hello vejde na daný uzel.</span><span class="sxs-lookup"><span data-stu-id="266c9-150">For example, capacity limitations may mean that only some of hello service objects in hello affinity relationship can fit on a given node.</span></span> <span data-ttu-id="266c9-151">V těchto případech i když je vztah spřažení na místě, se nedá vynutit kvůli toohello jiná omezení.</span><span class="sxs-lookup"><span data-stu-id="266c9-151">In these cases even though there's an affinity relationship in place, it can't be enforced due toohello other constraints.</span></span> <span data-ttu-id="266c9-152">Pokud je možné toodo tak, porušení hello je automaticky opraven později.</span><span class="sxs-lookup"><span data-stu-id="266c9-152">If it is possible toodo so, hello violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="266c9-153">Řetězy oproti hvězdičkami</span><span class="sxs-lookup"><span data-stu-id="266c9-153">Chains vs. stars</span></span>
<span data-ttu-id="266c9-154">Dnes hello správce prostředků clusteru není možné toomodel řetězy spřažení relací.</span><span class="sxs-lookup"><span data-stu-id="266c9-154">Today hello Cluster Resource Manager isn't able toomodel chains of affinity relationships.</span></span> <span data-ttu-id="266c9-155">Co to znamená, který je služba, která je podřízená v jednom vztahu spřažení nemůže být nadřízený prvek v jiné relace spřažení.</span><span class="sxs-lookup"><span data-stu-id="266c9-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="266c9-156">Pokud chcete tento typ vztahu toomodel, máte efektivně toomodel jej jako hvězdu, nikoli řetězec.</span><span class="sxs-lookup"><span data-stu-id="266c9-156">If you want toomodel this type of relationship, you effectively have toomodel it as a star, rather than a chain.</span></span> <span data-ttu-id="266c9-157">toomove z řetězu tooa hvězdu, nejspodnějších podřízené hello místo toho by nadřazeným prvkem toohello první podřízený objekt Nadřazený objekt.</span><span class="sxs-lookup"><span data-stu-id="266c9-157">toomove from a chain tooa star, hello bottommost child would be parented toohello first child’s parent instead.</span></span> <span data-ttu-id="266c9-158">V závislosti na hello uspořádání vašich služeb může mít toodo několikrát.</span><span class="sxs-lookup"><span data-stu-id="266c9-158">Depending on hello arrangement of your services, you may have toodo this multiple times.</span></span> <span data-ttu-id="266c9-159">Pokud není k dispozici žádná fyzická nadřazená služba, bude pravděpodobně toocreate jeden, který slouží jako zástupný znak.</span><span class="sxs-lookup"><span data-stu-id="266c9-159">If there's no natural parent service, you may have toocreate one that serves as a placeholder.</span></span> <span data-ttu-id="266c9-160">V závislosti na požadavcích, můžete také toolook do [skupin aplikací](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="266c9-160">Depending on your requirements, you may also want toolook into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="266c9-161"><center>
![Řetězy vs. Hvězdičky v hello kontextu spřažení relace][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="266c9-161"><center>
![Chains vs. Stars in hello Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="266c9-162">Jiné toonote věc o spřažení relace dnes je, že jsou směrovou.</span><span class="sxs-lookup"><span data-stu-id="266c9-162">Another thing toonote about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="266c9-163">To znamená, že daného pravidla spřažení hello pouze vynucuje podřazených hello umístěn nadřazené hello.</span><span class="sxs-lookup"><span data-stu-id="266c9-163">This means that hello affinity rule only enforces that hello child placed with hello parent.</span></span> <span data-ttu-id="266c9-164">Nezajišťuje se, že tento nadřazený hello je umístěn v podřízené hello.</span><span class="sxs-lookup"><span data-stu-id="266c9-164">It does not ensure that hello parent is located with hello child.</span></span> <span data-ttu-id="266c9-165">Je také důležité toonote, který hello vztah spřažení nelze vynikající nebo okamžitě vynutit, protože různé služby s jinou životní cykly a může selhat a přesunout nezávisle.</span><span class="sxs-lookup"><span data-stu-id="266c9-165">It is also important toonote that hello affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="266c9-166">Řekněme například, že hello nadřazený uzel tooanother najednou převezme, protože ho došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="266c9-166">For example, let's say hello parent suddenly fails over tooanother node because it crashed.</span></span> <span data-ttu-id="266c9-167">Hello správce prostředků clusteru a převzetí služeb při selhání Manager popisovač hello převzetí služeb při selhání nejprve vzhledem k tomu, že zachování hello služby, konzistentní a k dispozici je priorita hello.</span><span class="sxs-lookup"><span data-stu-id="266c9-167">hello Cluster Resource Manager and Failover Manager handle hello failover first, since keeping hello services up, consistent, and available is hello priority.</span></span> <span data-ttu-id="266c9-168">Po dokončení převzetí služeb při selhání hello vztah spřažení hello je poškozený, ale hello správce prostředků clusteru předpokládá, že všechno, co je vhodná, dokud se oznámení podřazených hello není umístěný hello nadřazený.</span><span class="sxs-lookup"><span data-stu-id="266c9-168">Once hello failover completes, hello affinity relationship is broken, but hello Cluster Resource Manager thinks everything is fine until it notices that hello child is not located with hello parent.</span></span> <span data-ttu-id="266c9-169">Tyto řazení kontrol se provádí pravidelně.</span><span class="sxs-lookup"><span data-stu-id="266c9-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="266c9-170">Další informace o tom, jak hello správce prostředků clusteru vyhodnotí omezení je k dispozici v [v tomto článku](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), a [tato](service-fabric-cluster-resource-manager-balancing.md) komunikuje informace o tom, jak tooconfigure hello cadence, na kterém jsou tato omezení vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="266c9-170">More information on how hello Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how tooconfigure hello cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="266c9-171">Vytváření oddílů podpory</span><span class="sxs-lookup"><span data-stu-id="266c9-171">Partitioning support</span></span>
<span data-ttu-id="266c9-172">Hello poslední věcí toonotice o spřažení je, že spřažení relace nejsou podporované hello nadřazené kde je rozdělena na oddíly.</span><span class="sxs-lookup"><span data-stu-id="266c9-172">hello final thing toonotice about affinity is that affinity relationships aren’t supported where hello parent is partitioned.</span></span> <span data-ttu-id="266c9-173">Nakonec může podporovány oddílů nadřazené služby, ale ještě dnes není povoleno.</span><span class="sxs-lookup"><span data-stu-id="266c9-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="266c9-174">Další kroky</span><span class="sxs-lookup"><span data-stu-id="266c9-174">Next steps</span></span>
- <span data-ttu-id="266c9-175">Další informace o konfiguraci služby [Další informace o konfiguraci služby](service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="266c9-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="266c9-176">toolimit služeb tooa malého počítačů nebo totožný hello zatížení služeb, použijte [skupin aplikací](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="266c9-176">toolimit services tooa small set of machines or aggregating hello load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png
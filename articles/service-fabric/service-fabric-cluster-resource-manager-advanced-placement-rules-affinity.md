---
title: "Správce prostředků clusteru Service Fabric - spřažení | Microsoft Docs"
description: "Přehled konfigurace spřažení pro služby Service Fabric"
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 678073e1-d08d-46c4-a811-826e70aba6c4
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 3efda4ee4016245668e5da431d7b8868a21c790e
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="configuring-and-using-service-affinity-in-service-fabric"></a><span data-ttu-id="0d1f8-103">Konfigurace a použití spřažení služby v Service Fabric</span><span class="sxs-lookup"><span data-stu-id="0d1f8-103">Configuring and using service affinity in Service Fabric</span></span>
<span data-ttu-id="0d1f8-104">Spřažení je ovládací prvek, který je k dispozici především ke zjednodušení přechodu větší monolitický aplikací do cloudu a mikroslužeb world.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-104">Affinity is a control that is provided mainly to help ease the transition of larger monolithic applications into the cloud and microservices world.</span></span> <span data-ttu-id="0d1f8-105">Používá se také jako optimalizace pro zlepšení výkonu služeb, i když tak může mít vedlejší účinky.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-105">It is also used as an optimization for improving the performance of services, although doing so can have side effects.</span></span>

<span data-ttu-id="0d1f8-106">Řekněme, že jste přináší větší aplikace, nebo ten, který právě nebyl navržen s mikroslužeb pamatovat na Service Fabric (nebo všechny distribuovaném prostředí).</span><span class="sxs-lookup"><span data-stu-id="0d1f8-106">Let’s say you’re bringing a larger app, or one that just wasn’t designed with microservices in mind, to Service Fabric (or any distributed environment).</span></span> <span data-ttu-id="0d1f8-107">Tento typ přechodu je běžné.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-107">This type of transition is common.</span></span> <span data-ttu-id="0d1f8-108">Můžete začít zrušení celá aplikace do prostředí, balení a zkontrolování, zda je spuštěna bez problémů.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-108">You start by lifting the entire app into the environment, packaging it, and making sure it is running smoothly.</span></span> <span data-ttu-id="0d1f8-109">Potom spusťte jej rozdělit do různých menší služby všechny komunikovat navzájem.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-109">Then you start breaking it down into different smaller services that all talk to each other.</span></span>

<span data-ttu-id="0d1f8-110">Nakonec můžete zjistit, že aplikace dochází k problémům.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-110">Eventually you may find that the application is experiencing some issues.</span></span> <span data-ttu-id="0d1f8-111">Problémy se obvykle spadají do jedné z těchto kategorií:</span><span class="sxs-lookup"><span data-stu-id="0d1f8-111">The issues usually fall into one of these categories:</span></span>

1. <span data-ttu-id="0d1f8-112">Některé součásti X monolitický aplikace měla nedokumentovanými závislost na součásti Y a právě převedena tyto součásti na samostatné služby.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-112">Some component X in the monolithic app had an undocumented dependency on component Y, and you just turned those components into separate services.</span></span> <span data-ttu-id="0d1f8-113">Vzhledem k tomu, že tyto služby běží v rozdílných uzlech v clusteru, jsou poškozená.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-113">Since these services are now running on different nodes in the cluster, they're broken.</span></span>
2. <span data-ttu-id="0d1f8-114">Tyto součásti komunikovat přes (místní pojmenované kanály | sdílené paměti | soubory na disku) a skutečně potřebují k dát zapisovat do sdíleného místního prostředku z důvodů výkonu hned teď.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-114">These components communicate via (local named pipes | shared memory | files on disk) and they really need to be able to write to a shared local resource for performance reasons right now.</span></span> <span data-ttu-id="0d1f8-115">Že pevné závislostí získá později odebral, možná.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-115">That hard dependency gets removed later, maybe.</span></span>
3. <span data-ttu-id="0d1f8-116">Všechno, co je v pořádku, ale ukazuje se, že tyto dvě součásti jsou ve skutečnosti chatty a výkonu citlivé.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-116">Everything is fine, but it turns out that these two components are actually chatty/performance sensitive.</span></span> <span data-ttu-id="0d1f8-117">Při jejich přesunu do samostatné služby celkového výkonu aplikace tanked nebo latenci vyšší.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-117">When they moved them into separate services overall application performance tanked or latency increased.</span></span> <span data-ttu-id="0d1f8-118">V důsledku toho není celkové aplikace splnění očekávání.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-118">As a result, the overall application is not meeting expectations.</span></span>

<span data-ttu-id="0d1f8-119">V těchto případech jsme nechcete ztratit naše refaktoringu pracovní a nechcete, aby se vrátíte k monolitu.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-119">In these cases, we don’t want to lose our refactoring work, and don’t want to go back to the monolith.</span></span> <span data-ttu-id="0d1f8-120">Poslední stav může být i žádoucí jako prostý optimalizace.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-120">The last condition may even be desirable as a plain optimization.</span></span> <span data-ttu-id="0d1f8-121">Ale dokud jsme můžete změnit návrh součásti, které budou fungovat přirozeně jako služby (nebo dokud jsme může pomoct vyřešit očekávaný výkon nějakým způsobem) vytvoříme potřebovat některé smysl polohu.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-121">However, until we can redesign the components to work naturally as services (or until we can solve the performance expectations some other way) we're going to need some sense of locality.</span></span>

<span data-ttu-id="0d1f8-122">Co dělat?</span><span class="sxs-lookup"><span data-stu-id="0d1f8-122">What to do?</span></span> <span data-ttu-id="0d1f8-123">Dobře mohou zkuste zapnete spřažení.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-123">Well, you could try turning on affinity.</span></span>

## <a name="how-to-configure-affinity"></a><span data-ttu-id="0d1f8-124">Postup konfigurace spřažení</span><span class="sxs-lookup"><span data-stu-id="0d1f8-124">How to configure affinity</span></span>
<span data-ttu-id="0d1f8-125">Pokud chcete nastavit spřažení, definovat relaci spřažení mezi dva různé služby.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-125">To set up affinity, you define an affinity relationship between two different services.</span></span> <span data-ttu-id="0d1f8-126">Si můžete představit spřažení jako "ukazující" jedné služby v jiné a informacemi o tom, "tuto službu spustit pouze kde běží služba."</span><span class="sxs-lookup"><span data-stu-id="0d1f8-126">You can think of affinity as “pointing” one service at another and saying “This service can only run where that service is running.”</span></span> <span data-ttu-id="0d1f8-127">Někdy označujeme spřažení relaci nadřazený podřízený (kde je bod podřízených v nadřazené).</span><span class="sxs-lookup"><span data-stu-id="0d1f8-127">Sometimes we refer to affinity as a parent/child relationship (where you point the child at the parent).</span></span> <span data-ttu-id="0d1f8-128">Spřažení zajišťuje, že replik nebo instancí jedné služby budou umístěny v uzlu stejné jako jiné služby.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-128">Affinity ensures that the replicas or instances of one service are placed on the same nodes as those of another service.</span></span>

```csharp
ServiceCorrelationDescription affinityDescription = new ServiceCorrelationDescription();
affinityDescription.Scheme = ServiceCorrelationScheme.Affinity;
affinityDescription.ServiceName = new Uri("fabric:/otherApplication/parentService");
serviceDescription.Correlations.Add(affinityDescription);
await fabricClient.ServiceManager.CreateServiceAsync(serviceDescription);
```

> [!NOTE]
> <span data-ttu-id="0d1f8-129">Služba podřízené jenom účastnit vztahu jeden spřažení.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-129">A child service can only participate in a single affinity relationship.</span></span> <span data-ttu-id="0d1f8-130">Pokud byste chtěli podřízené spřáhnout s dvě nadřazené služby najednou máte několik možností:</span><span class="sxs-lookup"><span data-stu-id="0d1f8-130">If you wanted the child to be affinitized to two parent services at once you have a couple options:</span></span>
> - <span data-ttu-id="0d1f8-131">Reverse vztahy (mají parentService1 a přejděte na aktuální službu podřízené parentService2), nebo</span><span class="sxs-lookup"><span data-stu-id="0d1f8-131">Reverse the relationships (have parentService1 and parentService2 point at the current child service), or</span></span>
> - <span data-ttu-id="0d1f8-132">Určete jeden z rodičů jako rozbočovač podle konvence a mít všechny služby, přejděte na tuto službu.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-132">Designate one of the parents as a hub by convention and have all services point at that service.</span></span> 
>
> <span data-ttu-id="0d1f8-133">Výsledné chování umístění v clusteru musí být stejná.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-133">The resulting placement behavior in the cluster should be the same.</span></span>
>

## <a name="different-affinity-options"></a><span data-ttu-id="0d1f8-134">Možnosti různých spřažení</span><span class="sxs-lookup"><span data-stu-id="0d1f8-134">Different affinity options</span></span>
<span data-ttu-id="0d1f8-135">Spřažení je reprezentována prostřednictvím jedním z několika korelace schémata a má dva různé režimy.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-135">Affinity is represented via one of several correlation schemes, and has two different modes.</span></span> <span data-ttu-id="0d1f8-136">Nejběžnější režim spřažení nazýváme NonAlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-136">The most common mode of affinity is what we call NonAlignedAffinity.</span></span> <span data-ttu-id="0d1f8-137">V NonAlignedAffinity replik nebo instancí různé služby jsou umístěny na stejném uzlu.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-137">In NonAlignedAffinity, the replicas or instances of the different services are placed on the same nodes.</span></span> <span data-ttu-id="0d1f8-138">Další režim je AlignedAffinity.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-138">The other mode is AlignedAffinity.</span></span> <span data-ttu-id="0d1f8-139">Zarovnaný spřažení je užitečný jenom v případě stavové služby.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-139">Aligned Affinity is useful only with stateful services.</span></span> <span data-ttu-id="0d1f8-140">Konfigurace dvě stavové služby do mají zarovnán spřažení zajišťuje, že základní barvy těchto služeb budou umístěny v uzlu stejné jako navzájem.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-140">Configuring two stateful services to have aligned affinity ensures that the primaries of those services are placed on the same nodes as each other.</span></span> <span data-ttu-id="0d1f8-141">Také způsobuje, že každý pár sekundárních databází pro tyto služby má být umístěn do stejným uzlům.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-141">It also causes each pair of secondaries for those services to be placed on the same nodes.</span></span> <span data-ttu-id="0d1f8-142">Také je možné (i když méně běžné) ke konfiguraci NonAlignedAffinity pro stavové služby.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-142">It is also possible (though less common) to configure NonAlignedAffinity for stateful services.</span></span> <span data-ttu-id="0d1f8-143">Pro NonAlignedAffinity jiné repliky dvě stavové služby běžet na stejné uzly, ale jejich základní barvy, může dojít v různých uzlech.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-143">For NonAlignedAffinity, the different replicas of the two stateful services would run on the same nodes, but their primaries could end up on different nodes.</span></span>

<span data-ttu-id="0d1f8-144"><center>
![Režimy spřažení a jejich důsledky][Image1]
</center></span><span class="sxs-lookup"><span data-stu-id="0d1f8-144"><center>
![Affinity Modes and Their Effects][Image1]
</center></span></span>

### <a name="best-effort-desired-state"></a><span data-ttu-id="0d1f8-145">Nejlepší stav úsilí potřeby</span><span class="sxs-lookup"><span data-stu-id="0d1f8-145">Best effort desired state</span></span>
<span data-ttu-id="0d1f8-146">Relaci spřažení je nejlepší úsilí.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-146">An affinity relationship is best effort.</span></span> <span data-ttu-id="0d1f8-147">Neposkytuje stejné záruky společné umístění nebo spolehlivosti spuštěná ve stejném nemá spustitelný proces.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-147">It does not provide the same guarantees of collocation or reliability that running in the same executable process does.</span></span> <span data-ttu-id="0d1f8-148">Služeb v relaci spřažení se podstatně liší entit, které můžou selhat a přesunování nezávisle.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-148">The services in an affinity relationship are fundamentally different entities that can fail and be moved independently.</span></span> <span data-ttu-id="0d1f8-149">Relaci spřažení může také zalomit, i když jsou tyto konce dočasné.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-149">An affinity relationship could also break, though these breaks are temporary.</span></span> <span data-ttu-id="0d1f8-150">Například omezení kapacity může znamenat, že jenom některé objekty služby v relaci spřažení vejde na daný uzel.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-150">For example, capacity limitations may mean that only some of the service objects in the affinity relationship can fit on a given node.</span></span> <span data-ttu-id="0d1f8-151">V těchto případech i v případě, že je na místě, vztah spřažení ji nelze vynutit z důvodu další omezení.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-151">In these cases even though there's an affinity relationship in place, it can't be enforced due to the other constraints.</span></span> <span data-ttu-id="0d1f8-152">Pokud je možné provést, porušení automaticky opraven později.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-152">If it is possible to do so, the violation is automatically corrected later.</span></span>

### <a name="chains-vs-stars"></a><span data-ttu-id="0d1f8-153">Řetězy oproti hvězdičkami</span><span class="sxs-lookup"><span data-stu-id="0d1f8-153">Chains vs. stars</span></span>
<span data-ttu-id="0d1f8-154">Správce prostředků clusteru není ještě dnes moct modelu řetězy spřažení relací.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-154">Today the Cluster Resource Manager isn't able to model chains of affinity relationships.</span></span> <span data-ttu-id="0d1f8-155">Co to znamená, který je služba, která je podřízená v jednom vztahu spřažení nemůže být nadřízený prvek v jiné relace spřažení.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-155">What this means is that a service that is a child in one affinity relationship can’t be a parent in another affinity relationship.</span></span> <span data-ttu-id="0d1f8-156">Pokud chcete tento typ vztahu modelu, máte efektivně model jako hvězdu, nikoli řetězec.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-156">If you want to model this type of relationship, you effectively have to model it as a star, rather than a chain.</span></span> <span data-ttu-id="0d1f8-157">Pokud chcete přesunout z řetěz hvězdu, by být nadřazena nejspodnějších podřízené prvním podřízeným objektem nadřazené místo.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-157">To move from a chain to a star, the bottommost child would be parented to the first child’s parent instead.</span></span> <span data-ttu-id="0d1f8-158">V závislosti na uspořádání vašim službám budete muset provést několikrát.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-158">Depending on the arrangement of your services, you may have to do this multiple times.</span></span> <span data-ttu-id="0d1f8-159">Pokud není žádná služba přirozené nadřazené, máte může vytvořit jeden, který slouží jako zástupný znak.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-159">If there's no natural parent service, you may have to create one that serves as a placeholder.</span></span> <span data-ttu-id="0d1f8-160">V závislosti na požadavcích, můžete také chtít viděl [skupin aplikací](service-fabric-cluster-resource-manager-application-groups.md).</span><span class="sxs-lookup"><span data-stu-id="0d1f8-160">Depending on your requirements, you may also want to look into [Application Groups](service-fabric-cluster-resource-manager-application-groups.md).</span></span>

<span data-ttu-id="0d1f8-161"><center>
![Řetězy vs. Počet hvězdiček v kontextu relace spřažení][Image2]
</center></span><span class="sxs-lookup"><span data-stu-id="0d1f8-161"><center>
![Chains vs. Stars in the Context of Affinity Relationships][Image2]
</center></span></span>

<span data-ttu-id="0d1f8-162">Další fakt, který ještě dnes Poznámka o spřažení relace je, že jsou směrovou.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-162">Another thing to note about affinity relationships today is that they are directional.</span></span> <span data-ttu-id="0d1f8-163">To znamená, že pravidlo spřažení pouze vynucuje, že podřízená umístěn nadřazený.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-163">This means that the affinity rule only enforces that the child placed with the parent.</span></span> <span data-ttu-id="0d1f8-164">Ji není zajistí, že k nadřazené umístěné se podřízené.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-164">It does not ensure that the parent is located with the child.</span></span> <span data-ttu-id="0d1f8-165">Je také důležité si uvědomit, že vztah spřažení nelze vynikající nebo okamžitě vynutit, protože různé služby s jinou životní cykly a může selhat a přesunout nezávisle.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-165">It is also important to note that the affinity relationship can't be perfect or instantly enforced since different services have with different lifecycles and can fail and move independently.</span></span> <span data-ttu-id="0d1f8-166">Řekněme například, že nadřazený najednou převezme jiný uzel vzhledem k tomu, že ho došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-166">For example, let's say the parent suddenly fails over to another node because it crashed.</span></span> <span data-ttu-id="0d1f8-167">Správce prostředků clusteru a převzetí služeb při selhání správce zpracování převzetí služeb při selhání nejprve od udržování služeb, konzistentní, a k dispozici je priorita.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-167">The Cluster Resource Manager and Failover Manager handle the failover first, since keeping the services up, consistent, and available is the priority.</span></span> <span data-ttu-id="0d1f8-168">Po dokončení převzetí vztah spřažení je poškozený, ale správce prostředků clusteru předpokládá, že všechno, co je vhodná, dokud se oznámení, že podřízená není umístěný se nadřazenou položkou.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-168">Once the failover completes, the affinity relationship is broken, but the Cluster Resource Manager thinks everything is fine until it notices that the child is not located with the parent.</span></span> <span data-ttu-id="0d1f8-169">Tyto řazení kontrol se provádí pravidelně.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-169">These sorts of checks are performed periodically.</span></span> <span data-ttu-id="0d1f8-170">Další informace o tom, jak správce prostředků clusteru vyhodnotí omezení je k dispozici v [v tomto článku](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), a [tato](service-fabric-cluster-resource-manager-balancing.md) komunikuje Další informace o tom, jak nakonfigurovat cadence, na které se vyhodnocují těchto omezení.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-170">More information on how the Cluster Resource Manager evaluates constraints is available in [this article](service-fabric-cluster-resource-manager-management-integration.md#constraint-types), and [this one](service-fabric-cluster-resource-manager-balancing.md) talks more about how to configure the cadence on which these constraints are evaluated.</span></span>   


### <a name="partitioning-support"></a><span data-ttu-id="0d1f8-171">Vytváření oddílů podpory</span><span class="sxs-lookup"><span data-stu-id="0d1f8-171">Partitioning support</span></span>
<span data-ttu-id="0d1f8-172">Poslední věcí Všimněte o spřažení je tento spřažení relace nejsou podporované, kde je nadřazená rozdělena na oddíly.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-172">The final thing to notice about affinity is that affinity relationships aren’t supported where the parent is partitioned.</span></span> <span data-ttu-id="0d1f8-173">Nakonec může podporovány oddílů nadřazené služby, ale ještě dnes není povoleno.</span><span class="sxs-lookup"><span data-stu-id="0d1f8-173">Partitioned parent services may be supported eventually, but today it is not allowed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0d1f8-174">Další kroky</span><span class="sxs-lookup"><span data-stu-id="0d1f8-174">Next steps</span></span>
- <span data-ttu-id="0d1f8-175">Další informace o konfiguraci služby [Další informace o konfiguraci služby](service-fabric-cluster-resource-manager-configure-services.md)</span><span class="sxs-lookup"><span data-stu-id="0d1f8-175">For more information on configuring services, [Learn about configuring Services](service-fabric-cluster-resource-manager-configure-services.md)</span></span>
- <span data-ttu-id="0d1f8-176">Omezení služby pro malou skupinu počítačů nebo agregování zatížení služeb, použijte [skupin aplikací](service-fabric-cluster-resource-manager-application-groups.md)</span><span class="sxs-lookup"><span data-stu-id="0d1f8-176">To limit services to a small set of machines or aggregating the load of services, use [Application Groups](service-fabric-cluster-resource-manager-application-groups.md)</span></span>

[Image1]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resrouce-manager-affinity-modes.png
[Image2]:./media/service-fabric-cluster-resource-manager-advanced-placement-rules-affinity/cluster-resource-manager-chains-vs-stars.png
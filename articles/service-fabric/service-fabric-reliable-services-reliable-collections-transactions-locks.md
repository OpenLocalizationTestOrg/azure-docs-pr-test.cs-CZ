---
title: "aaaTransactions a režim zámku Azure Service Fabric spolehlivé kolekce | Microsoft Docs"
description: "Azure Service Fabric spolehlivé stavu Manager a spolehlivé kolekce transakce a uzamyká."
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/1/2017
ms.author: mcoskun
ms.openlocfilehash: 340e029aa98f43ad6e46b48f687dad01f9d96f69
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="transactions-and-lock-modes-in-azure-service-fabric-reliable-collections"></a><span data-ttu-id="871cc-103">Transakce a uzamčení režimy v Azure Service Fabric spolehlivé kolekce</span><span class="sxs-lookup"><span data-stu-id="871cc-103">Transactions and lock modes in Azure Service Fabric Reliable Collections</span></span>

## <a name="transaction"></a><span data-ttu-id="871cc-104">Transakce</span><span class="sxs-lookup"><span data-stu-id="871cc-104">Transaction</span></span>
<span data-ttu-id="871cc-105">Transakce je posloupnost operací provést jako jednu logickou jednotku práce.</span><span class="sxs-lookup"><span data-stu-id="871cc-105">A transaction is a sequence of operations performed as a single logical unit of work.</span></span>
<span data-ttu-id="871cc-106">Transakce musí mít květy hello následující ACID vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="871cc-106">A transaction must exhibit hello following ACID properties.</span></span> <span data-ttu-id="871cc-107">(viz: https://technet.microsoft.com/en-us/library/ms190612)</span><span class="sxs-lookup"><span data-stu-id="871cc-107">(see: https://technet.microsoft.com/en-us/library/ms190612)</span></span>
* <span data-ttu-id="871cc-108">**Nedělitelnost**: transakce musí být atomické jednotky práce.</span><span class="sxs-lookup"><span data-stu-id="871cc-108">**Atomicity**: A transaction must be an atomic unit of work.</span></span> <span data-ttu-id="871cc-109">Jinými slovy se provádí jeho změny dat, nebo žádná z nich probíhá.</span><span class="sxs-lookup"><span data-stu-id="871cc-109">In other words, either all its data modifications are performed, or none of them is performed.</span></span>
* <span data-ttu-id="871cc-110">**Konzistence**: Po dokončení transakce musí zůstat všechna data v konzistentním stavu.</span><span class="sxs-lookup"><span data-stu-id="871cc-110">**Consistency**: When completed, a transaction must leave all data in a consistent state.</span></span> <span data-ttu-id="871cc-111">Všechny interních datových strukturách musí být správné na konci hello hello transakce.</span><span class="sxs-lookup"><span data-stu-id="871cc-111">All internal data structures must be correct at hello end of hello transaction.</span></span>
* <span data-ttu-id="871cc-112">**Izolace**: úpravy provedené souběžných transakcí musí být izolované od hello změny provedené při dalších souběžných transakcí.</span><span class="sxs-lookup"><span data-stu-id="871cc-112">**Isolation**: Modifications made by concurrent transactions must be isolated from hello modifications made by any other concurrent transactions.</span></span> <span data-ttu-id="871cc-113">úroveň izolace Hello používá pro operace v rámci ITransaction je určen podle hello IReliableState provádění operace hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-113">hello isolation level used for an operation within an ITransaction is determined by hello IReliableState performing hello operation.</span></span>
* <span data-ttu-id="871cc-114">**Odolnost**: Po dokončení transakce jeho účinky jsou trvale zavedené v systému hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-114">**Durability**: After a transaction has completed, its effects are permanently in place in hello system.</span></span> <span data-ttu-id="871cc-115">úpravy Hello zachovat ani v případě selhání systému hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-115">hello modifications persist even in hello event of a system failure.</span></span>

### <a name="isolation-levels"></a><span data-ttu-id="871cc-116">Úrovně izolace</span><span class="sxs-lookup"><span data-stu-id="871cc-116">Isolation levels</span></span>
<span data-ttu-id="871cc-117">Definuje úroveň hello úroveň izolace transakce hello toowhich musí být izolované od změny provedené při dalších transakcí.</span><span class="sxs-lookup"><span data-stu-id="871cc-117">Isolation level defines hello degree toowhich hello transaction must be isolated from modifications made by other transactions.</span></span>
<span data-ttu-id="871cc-118">Existují dvě úrovně izolace, které jsou podporovány v spolehlivé kolekce:</span><span class="sxs-lookup"><span data-stu-id="871cc-118">There are two isolation levels that are supported in Reliable Collections:</span></span>

* <span data-ttu-id="871cc-119">**Opakovatelných čtení**: Určuje, že příkazy nelze číst data, která byla upravena, ale ještě nebyly potvrzeny podle dalších transakcí a že žádné další transakce můžete upravit data, která byla přečtena hello aktuální transakce až do aktuálního hello dokončení transakce.</span><span class="sxs-lookup"><span data-stu-id="871cc-119">**Repeatable Read**: Specifies that statements cannot read data that has been modified but not yet committed by other transactions and that no other transactions can modify data that has been read by hello current transaction until hello current transaction finishes.</span></span> <span data-ttu-id="871cc-120">Další podrobnosti najdete v tématu [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="871cc-120">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>
* <span data-ttu-id="871cc-121">**Snímek**: Určuje, že data načtená žádné příkazem v transakci je hello stavu transakční konzistence verzi hello data, která byla při spuštění hello hello transakce.</span><span class="sxs-lookup"><span data-stu-id="871cc-121">**Snapshot**: Specifies that data read by any statement in a transaction is hello transactionally consistent version of hello data that existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="871cc-122">transakce Hello poznáte pouze změny dat, které nebyly potvrzeny před hello začátku transakce hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-122">hello transaction can recognize only data modifications that were committed before hello start of hello transaction.</span></span>
  <span data-ttu-id="871cc-123">Změny dat provedené dalších transakcí po hello začátek hello aktuální transakce nejsou viditelné toostatements provádění v aktuální transakci hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-123">Data modifications made by other transactions after hello start of hello current transaction are not visible toostatements executing in hello current transaction.</span></span>
  <span data-ttu-id="871cc-124">Hello efekt působí, jako kdyby hello příkazy v transakci získat snímek hello potvrzené dat tak, jak byly hello začátku transakce hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-124">hello effect is as if hello statements in a transaction get a snapshot of hello committed data as it existed at hello start of hello transaction.</span></span>
  <span data-ttu-id="871cc-125">Snímky jsou konzistentní v rámci spolehlivé kolekce.</span><span class="sxs-lookup"><span data-stu-id="871cc-125">Snapshots are consistent across Reliable Collections.</span></span>
  <span data-ttu-id="871cc-126">Další podrobnosti najdete v tématu [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span><span class="sxs-lookup"><span data-stu-id="871cc-126">For more details, see [https://msdn.microsoft.com/library/ms173763.aspx](https://msdn.microsoft.com/library/ms173763.aspx).</span></span>

<span data-ttu-id="871cc-127">Spolehlivé kolekce automaticky zvolte hello toouse úroveň izolace pro danou operaci čtení v závislosti na operaci hello a hello role repliky hello v době vytvoření transakce hello.</span><span class="sxs-lookup"><span data-stu-id="871cc-127">Reliable Collections automatically choose hello isolation level toouse for a given read operation depending on hello operation and hello role of hello replica at hello time of transaction's creation.</span></span>
<span data-ttu-id="871cc-128">Následuje hello tabulku, která znázorňuje úrovni výchozí nastavení izolace pro operace spolehlivé slovník a fronty.</span><span class="sxs-lookup"><span data-stu-id="871cc-128">Following is hello table that depicts isolation level defaults for Reliable Dictionary and Queue operations.</span></span>

| <span data-ttu-id="871cc-129">Operace \ Role</span><span class="sxs-lookup"><span data-stu-id="871cc-129">Operation \ Role</span></span> | <span data-ttu-id="871cc-130">Primární</span><span class="sxs-lookup"><span data-stu-id="871cc-130">Primary</span></span> | <span data-ttu-id="871cc-131">Sekundární</span><span class="sxs-lookup"><span data-stu-id="871cc-131">Secondary</span></span> |
| --- |:--- |:--- |
| <span data-ttu-id="871cc-132">Čtení jedné Entity</span><span class="sxs-lookup"><span data-stu-id="871cc-132">Single Entity Read</span></span> |<span data-ttu-id="871cc-133">Opakovatelných pro čtení</span><span class="sxs-lookup"><span data-stu-id="871cc-133">Repeatable Read</span></span> |<span data-ttu-id="871cc-134">Snímek</span><span class="sxs-lookup"><span data-stu-id="871cc-134">Snapshot</span></span> |
| <span data-ttu-id="871cc-135">Výčet, počet</span><span class="sxs-lookup"><span data-stu-id="871cc-135">Enumeration, Count</span></span> |<span data-ttu-id="871cc-136">Snímek</span><span class="sxs-lookup"><span data-stu-id="871cc-136">Snapshot</span></span> |<span data-ttu-id="871cc-137">Snímek</span><span class="sxs-lookup"><span data-stu-id="871cc-137">Snapshot</span></span> |

> [!NOTE]
> <span data-ttu-id="871cc-138">Běžných příkladů pro jednu entitu operace jsou `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span><span class="sxs-lookup"><span data-stu-id="871cc-138">Common examples for Single Entity Operations are `IReliableDictionary.TryGetValueAsync`, `IReliableQueue.TryPeekAsync`.</span></span>
> 

<span data-ttu-id="871cc-139">Hello spolehlivé slovník i hello spolehlivé fronty podporují vaše zapíše pro čtení.</span><span class="sxs-lookup"><span data-stu-id="871cc-139">Both hello Reliable Dictionary and hello Reliable Queue support Read Your Writes.</span></span>
<span data-ttu-id="871cc-140">Jinými slovy, všechny zápisu v rámci transakce budou viditelné tooa následující číst, patří toohello stejné transakci.</span><span class="sxs-lookup"><span data-stu-id="871cc-140">In other words, any write within a transaction will be visible tooa following read that belongs toohello same transaction.</span></span>

## <a name="locks"></a><span data-ttu-id="871cc-141">Zámky</span><span class="sxs-lookup"><span data-stu-id="871cc-141">Locks</span></span>
<span data-ttu-id="871cc-142">V kolekcích spolehlivé, všechny transakce implementace přísných dvě fáze uzamčení: transakce není uvolnit zámky hello získala dokud neskončí hello transakce s přerušení nebo potvrzení.</span><span class="sxs-lookup"><span data-stu-id="871cc-142">In Reliable Collections, all transactions implement rigorous two phase locking: a transaction does not release hello locks it has acquired until hello transaction terminates with either an abort or a commit.</span></span>

<span data-ttu-id="871cc-143">Spolehlivé slovník používá uzamčení pro všechny operace jedné entity na úrovni řádků.</span><span class="sxs-lookup"><span data-stu-id="871cc-143">Reliable Dictionary uses row level locking for all single entity operations.</span></span>
<span data-ttu-id="871cc-144">Spolehlivé fronty ztrátách souběžnosti pro striktní transakční FIFO vlastnost.</span><span class="sxs-lookup"><span data-stu-id="871cc-144">Reliable Queue trades off concurrency for strict transactional FIFO property.</span></span>
<span data-ttu-id="871cc-145">Spolehlivé fronty používá úrovně zámky operace povolení jednu transakci s `TryPeekAsync` nebo `TryDequeueAsync` a jednu transakci s `EnqueueAsync` najednou.</span><span class="sxs-lookup"><span data-stu-id="871cc-145">Reliable Queue uses operation level locks allowing one transaction with `TryPeekAsync` and/or `TryDequeueAsync` and one transaction with `EnqueueAsync` at a time.</span></span>
<span data-ttu-id="871cc-146">Všimněte si, že toopreserve FIFO, pokud `TryPeekAsync` nebo `TryDequeueAsync` někdy zjistí, že hello spolehlivé fronty je prázdný, budou také zamknout `EnqueueAsync`.</span><span class="sxs-lookup"><span data-stu-id="871cc-146">Note that toopreserve FIFO, if a `TryPeekAsync` or `TryDequeueAsync` ever observes that hello Reliable Queue is empty, they will also lock `EnqueueAsync`.</span></span>

<span data-ttu-id="871cc-147">Zápisu operace vždy provést výhradní zámky.</span><span class="sxs-lookup"><span data-stu-id="871cc-147">Write operations always take Exclusive locks.</span></span>
<span data-ttu-id="871cc-148">Pro operace čtení uzamčení hello závisí na několika faktorech.</span><span class="sxs-lookup"><span data-stu-id="871cc-148">For read operations, hello locking depends on a couple of factors.</span></span>
<span data-ttu-id="871cc-149">Všechny operace čtení provádí pomocí izolace snímku je zamykání.</span><span class="sxs-lookup"><span data-stu-id="871cc-149">Any read operation done using Snapshot isolation is lock free.</span></span>
<span data-ttu-id="871cc-150">Všechny operace čtení opakovatelných ve výchozím nastavení trvá sdílené zámky.</span><span class="sxs-lookup"><span data-stu-id="871cc-150">Any Repeatable Read operation by default takes Shared locks.</span></span>
<span data-ttu-id="871cc-151">Pro všechny operace čtení, podporující opakovatelných pro čtení, ale hello uživatele můžete požádat o aktualizační zámek místo hello Sdílený zámek.</span><span class="sxs-lookup"><span data-stu-id="871cc-151">However, for any read operation that supports Repeatable Read, hello user can ask for an Update lock instead of hello Shared lock.</span></span>
<span data-ttu-id="871cc-152">Aktualizační Zámek znamená že zámek asymetrické používaných tooprevent běžnou zablokování, který nastane, když více transakcí zamknutí prostředků pro potenciální aktualizace později.</span><span class="sxs-lookup"><span data-stu-id="871cc-152">An Update lock is an asymmetric lock used tooprevent a common form of deadlock that occurs when multiple transactions lock resources for potential updates at a later time.</span></span>

<span data-ttu-id="871cc-153">Matice kompatibility zámku Hello lze nalézt v hello následující tabulka:</span><span class="sxs-lookup"><span data-stu-id="871cc-153">hello lock compatibility matrix can be found in hello following table:</span></span>

| <span data-ttu-id="871cc-154">Žádosti o \ udělena</span><span class="sxs-lookup"><span data-stu-id="871cc-154">Request \ Granted</span></span> | <span data-ttu-id="871cc-155">Žádný</span><span class="sxs-lookup"><span data-stu-id="871cc-155">None</span></span> | <span data-ttu-id="871cc-156">Shared</span><span class="sxs-lookup"><span data-stu-id="871cc-156">Shared</span></span> | <span data-ttu-id="871cc-157">Aktualizace</span><span class="sxs-lookup"><span data-stu-id="871cc-157">Update</span></span> | <span data-ttu-id="871cc-158">Exkluzivní</span><span class="sxs-lookup"><span data-stu-id="871cc-158">Exclusive</span></span> |
| --- |:--- |:--- |:--- |:--- |
| <span data-ttu-id="871cc-159">Shared</span><span class="sxs-lookup"><span data-stu-id="871cc-159">Shared</span></span> |<span data-ttu-id="871cc-160">Ke konfliktu</span><span class="sxs-lookup"><span data-stu-id="871cc-160">No conflict</span></span> |<span data-ttu-id="871cc-161">Ke konfliktu</span><span class="sxs-lookup"><span data-stu-id="871cc-161">No conflict</span></span> |<span data-ttu-id="871cc-162">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-162">Conflict</span></span> |<span data-ttu-id="871cc-163">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-163">Conflict</span></span> |
| <span data-ttu-id="871cc-164">Aktualizace</span><span class="sxs-lookup"><span data-stu-id="871cc-164">Update</span></span> |<span data-ttu-id="871cc-165">Ke konfliktu</span><span class="sxs-lookup"><span data-stu-id="871cc-165">No conflict</span></span> |<span data-ttu-id="871cc-166">Ke konfliktu</span><span class="sxs-lookup"><span data-stu-id="871cc-166">No conflict</span></span> |<span data-ttu-id="871cc-167">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-167">Conflict</span></span> |<span data-ttu-id="871cc-168">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-168">Conflict</span></span> |
| <span data-ttu-id="871cc-169">Exkluzivní</span><span class="sxs-lookup"><span data-stu-id="871cc-169">Exclusive</span></span> |<span data-ttu-id="871cc-170">Ke konfliktu</span><span class="sxs-lookup"><span data-stu-id="871cc-170">No conflict</span></span> |<span data-ttu-id="871cc-171">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-171">Conflict</span></span> |<span data-ttu-id="871cc-172">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-172">Conflict</span></span> |<span data-ttu-id="871cc-173">Konflikt</span><span class="sxs-lookup"><span data-stu-id="871cc-173">Conflict</span></span> |

<span data-ttu-id="871cc-174">Časový limit argument hello spolehlivé rozhraní API kolekce se používá pro zjišťování zablokování.</span><span class="sxs-lookup"><span data-stu-id="871cc-174">Time-out argument in hello Reliable Collections APIs is used for deadlock detection.</span></span>
<span data-ttu-id="871cc-175">Například dvě transakce (T1 a T2) se snažíte tooread a aktualizovat K1.</span><span class="sxs-lookup"><span data-stu-id="871cc-175">For example, two transactions (T1 and T2) are trying tooread and update K1.</span></span>
<span data-ttu-id="871cc-176">Je možné, že je toodeadlock, protože obě skončili s hello Sdílený zámek.</span><span class="sxs-lookup"><span data-stu-id="871cc-176">It is possible for them toodeadlock, because they both end up having hello Shared lock.</span></span>
<span data-ttu-id="871cc-177">Jedna nebo obě hello operací v tomto případě bude časový limit.</span><span class="sxs-lookup"><span data-stu-id="871cc-177">In this case, one or both of hello operations will time out.</span></span>

<span data-ttu-id="871cc-178">Tento scénář vzájemného zablokování je skvělým příkladem jak aktualizační zámek může zabránit zablokování.</span><span class="sxs-lookup"><span data-stu-id="871cc-178">This deadlock scenario is a great example of how an Update lock can prevent deadlocks.</span></span>

## <a name="next-steps"></a><span data-ttu-id="871cc-179">Další kroky</span><span class="sxs-lookup"><span data-stu-id="871cc-179">Next steps</span></span>
* [<span data-ttu-id="871cc-180">Práce s Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="871cc-180">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="871cc-181">Spolehlivé služby oznámení</span><span class="sxs-lookup"><span data-stu-id="871cc-181">Reliable Services notifications</span></span>](service-fabric-reliable-services-notifications.md)
* [<span data-ttu-id="871cc-182">Spolehlivé služby zálohování a obnovení (zotavení po havárii)</span><span class="sxs-lookup"><span data-stu-id="871cc-182">Reliable Services backup and restore (disaster recovery)</span></span>](service-fabric-reliable-services-backup-restore.md)
* [<span data-ttu-id="871cc-183">Configuration Manager spolehlivé stavu</span><span class="sxs-lookup"><span data-stu-id="871cc-183">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* [<span data-ttu-id="871cc-184">Referenční informace pro vývojáře pro spolehlivé kolekce</span><span class="sxs-lookup"><span data-stu-id="871cc-184">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)


---
title: "aaaOverview životního cyklu hello služby Azure Service Fabric spolehlivé | Microsoft Docs"
description: "Další informace o události různých životního cyklu hello v Service Fabric spolehlivé služby"
services: Service-Fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: vturecek;
ms.assetid: 
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 0d75ed5ee7cda85ac9af6a02e160727277804a2b
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="reliable-services-lifecycle-overview"></a><span data-ttu-id="c84d7-103">Přehled životního cyklu spolehlivé služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-103">Reliable services lifecycle overview</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="c84d7-104">C# v systému Windows</span><span class="sxs-lookup"><span data-stu-id="c84d7-104">C# on Windows</span></span>](service-fabric-reliable-services-lifecycle.md)
> * [<span data-ttu-id="c84d7-105">Java v Linuxu</span><span class="sxs-lookup"><span data-stu-id="c84d7-105">Java on Linux</span></span>](service-fabric-reliable-services-lifecycle-java.md)
>
>

<span data-ttu-id="c84d7-106">Pokud přemýšlíte o životních hello spolehlivé služeb, jsou hello základy životního cyklu hello hello nejdůležitější.</span><span class="sxs-lookup"><span data-stu-id="c84d7-106">When thinking about hello lifecycles of Reliable Services, hello basics of hello lifecycle are hello most important.</span></span> <span data-ttu-id="c84d7-107">Obecně platí:</span><span class="sxs-lookup"><span data-stu-id="c84d7-107">In general:</span></span>

- <span data-ttu-id="c84d7-108">Při spuštění</span><span class="sxs-lookup"><span data-stu-id="c84d7-108">During Startup</span></span>
  - <span data-ttu-id="c84d7-109">Služby se vytvářejí.</span><span class="sxs-lookup"><span data-stu-id="c84d7-109">Services are constructed</span></span>
  - <span data-ttu-id="c84d7-110">Nemají tooconstruct příležitostí a vrátit nula nebo více – moduly naslouchání</span><span class="sxs-lookup"><span data-stu-id="c84d7-110">They have an opportunity tooconstruct and return zero or more listeners</span></span>
  - <span data-ttu-id="c84d7-111">Jsou otevřené žádné vrácený naslouchací procesy, povolení komunikace se službou hello</span><span class="sxs-lookup"><span data-stu-id="c84d7-111">Any returned listeners are opened, allowing communication with hello service</span></span>
  - <span data-ttu-id="c84d7-112">Povolit hello RunAsync Hello služby, které metoda je volána, služba toodo dlouho spuštěný nebo práce na pozadí</span><span class="sxs-lookup"><span data-stu-id="c84d7-112">hello Service's RunAsync method is called, allowing hello service toodo long running or background work</span></span>
- <span data-ttu-id="c84d7-113">Při vypnutí</span><span class="sxs-lookup"><span data-stu-id="c84d7-113">During shutdown</span></span>
  - <span data-ttu-id="c84d7-114">Hello zrušení token předaný tooRunAsync se zruší, a jsou uzavřeny hello – moduly naslouchání</span><span class="sxs-lookup"><span data-stu-id="c84d7-114">hello cancellation token passed tooRunAsync is canceled, and hello listeners are closed</span></span>
  - <span data-ttu-id="c84d7-115">Po který je dokončena, je destructed samotného objektu služby hello</span><span class="sxs-lookup"><span data-stu-id="c84d7-115">Once that is complete, hello service object itself is destructed</span></span>

<span data-ttu-id="c84d7-116">Přesný řazení tyto události jsou podrobnosti kolem hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-116">There are details around hello exact ordering of these events.</span></span> <span data-ttu-id="c84d7-117">Konkrétně hello pořadí událostí se může v závislosti na tom, jestli je hello spolehlivá služba Stateless nebo Stateful mírně změnit.</span><span class="sxs-lookup"><span data-stu-id="c84d7-117">In particular, hello order of events may change slightly depending on whether hello Reliable Service is Stateless or Stateful.</span></span> <span data-ttu-id="c84d7-118">Kromě toho pro stavové služby, máme toodeal se scénářem primárních prohození hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-118">In addition, for stateful services, we have toodeal with hello Primary swap scenario.</span></span> <span data-ttu-id="c84d7-119">Během tohoto pořadí hello role primární replikou přenášená tooanother (nebo zpátky) bez hello vypnutí služby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-119">During this sequence, hello role of Primary is transferred tooanother replica (or comes back) without hello service shutting down.</span></span> <span data-ttu-id="c84d7-120">Nakonec máme toothink o podmínkách chyb nebo selhání.</span><span class="sxs-lookup"><span data-stu-id="c84d7-120">Finally, we have toothink about error or failure conditions.</span></span>

## <a name="stateless-service-startup"></a><span data-ttu-id="c84d7-121">Spuštění bezstavové služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-121">Stateless service startup</span></span>
<span data-ttu-id="c84d7-122">životní cyklus Hello bezstavové služby je poměrně jednoduché.</span><span class="sxs-lookup"><span data-stu-id="c84d7-122">hello lifecycle of a stateless service is fairly straightforward.</span></span> <span data-ttu-id="c84d7-123">Tady je hello pořadí událostí:</span><span class="sxs-lookup"><span data-stu-id="c84d7-123">Here's hello order of events:</span></span>

1. <span data-ttu-id="c84d7-124">Hello služby je vytvořený</span><span class="sxs-lookup"><span data-stu-id="c84d7-124">hello Service is constructed</span></span>
2. <span data-ttu-id="c84d7-125">Potom v paralelní dvě věci situace:</span><span class="sxs-lookup"><span data-stu-id="c84d7-125">Then, in parallel two things happen:</span></span>
    - <span data-ttu-id="c84d7-126">`StatelessService.CreateServiceInstanceListeners()`je voláno, a jsou otevřené žádné vrácený naslouchací procesy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-126">`StatelessService.CreateServiceInstanceListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="c84d7-127">`ICommunicationListener.OpenAsync()`je volána v každé naslouchací proces</span><span class="sxs-lookup"><span data-stu-id="c84d7-127">`ICommunicationListener.OpenAsync()` is called on each listener</span></span>
    - <span data-ttu-id="c84d7-128">Hello služby `StatelessService.RunAsync()` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-128">hello service's `StatelessService.RunAsync()` method is called</span></span>
3. <span data-ttu-id="c84d7-129">Pokud je k dispozici, hello služby `StatelessService.OnOpenAsync()` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-129">If present, hello service's `StatelessService.OnOpenAsync()` method is called.</span></span> <span data-ttu-id="c84d7-130">Toto je neobvyklé přepsání, ale je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="c84d7-130">This is an uncommon override, but it is available.</span></span>

<span data-ttu-id="c84d7-131">Je důležité toonote se žádné řazení mezi hello volání toocreate a otevřete hello naslouchací procesy a RunAsync.</span><span class="sxs-lookup"><span data-stu-id="c84d7-131">It is important toonote that there is no ordering between hello calls toocreate and open hello listeners and RunAsync.</span></span> <span data-ttu-id="c84d7-132">moduly pro naslouchání Hello může zobrazit před zahájením RunAsync.</span><span class="sxs-lookup"><span data-stu-id="c84d7-132">hello listeners may open before RunAsync is started.</span></span> <span data-ttu-id="c84d7-133">Podobně RunAsync může stát volána před naslouchací procesy komunikace hello jsou otevřené nebo i byla vytvořená.</span><span class="sxs-lookup"><span data-stu-id="c84d7-133">Similarly, RunAsync may end up invoked before hello communication listeners are open or have even been constructed.</span></span> <span data-ttu-id="c84d7-134">Pokud žádné synchronizace je vyžadována, je ponechán jako implementátora toohello cvičení.</span><span class="sxs-lookup"><span data-stu-id="c84d7-134">If any synchronization is required, it is left as an exercise toohello implementer.</span></span> <span data-ttu-id="c84d7-135">Běžná řešení:</span><span class="sxs-lookup"><span data-stu-id="c84d7-135">Common solutions:</span></span>

  - <span data-ttu-id="c84d7-136">Někdy naslouchací procesy nemůže fungovat, dokud některé další informace se vytvoří nebo fungovat Hotovo.</span><span class="sxs-lookup"><span data-stu-id="c84d7-136">Sometimes listeners can't function until some other information is created or work done.</span></span> <span data-ttu-id="c84d7-137">Pro bezstavové služby, které pracovní obvykle stačí v jiných umístěních, jako například:</span><span class="sxs-lookup"><span data-stu-id="c84d7-137">For stateless services that work can usually be done in other locations, such as:</span></span> 
    - <span data-ttu-id="c84d7-138">v konstruktoru hello služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-138">in hello service's constructor</span></span>
    - <span data-ttu-id="c84d7-139">během hello `CreateServiceInstanceListeners()` volání</span><span class="sxs-lookup"><span data-stu-id="c84d7-139">during hello `CreateServiceInstanceListeners()` call</span></span>
    - <span data-ttu-id="c84d7-140">jako součást hello konstrukce naslouchací proces hello sám sebe</span><span class="sxs-lookup"><span data-stu-id="c84d7-140">as a part of hello construction of hello listener itself</span></span>
  - <span data-ttu-id="c84d7-141">Někdy hello kód v RunAsync nechce toostart dokud hello moduly pro naslouchání jsou otevřené.</span><span class="sxs-lookup"><span data-stu-id="c84d7-141">Sometimes hello code in RunAsync does not want toostart until hello listeners are open.</span></span> <span data-ttu-id="c84d7-142">V takovém případě je nutné další spolupráce.</span><span class="sxs-lookup"><span data-stu-id="c84d7-142">In this case additional coordination is necessary.</span></span> <span data-ttu-id="c84d7-143">Běžným řešením je některé příznak v rámci hello naslouchací procesy, která určuje, že dokončily.</span><span class="sxs-lookup"><span data-stu-id="c84d7-143">One common solution is some flag within hello listeners indicating when they have completed.</span></span> <span data-ttu-id="c84d7-144">Tento příznak se pak změnami RunAsync před pokračováním tooactual práci.</span><span class="sxs-lookup"><span data-stu-id="c84d7-144">This flag is then checked in RunAsync before continuing tooactual work.</span></span>

## <a name="stateless-service-shutdown"></a><span data-ttu-id="c84d7-145">Vypnutí bezstavové služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-145">Stateless service shutdown</span></span>
<span data-ttu-id="c84d7-146">Při vypínání bezstavové služby, hello stejného vzoru je pak, právě obráceným:</span><span class="sxs-lookup"><span data-stu-id="c84d7-146">When shutting down a stateless service, hello same pattern is followed, just in reverse:</span></span>

1. <span data-ttu-id="c84d7-147">Paralelní</span><span class="sxs-lookup"><span data-stu-id="c84d7-147">In parallel</span></span>
    - <span data-ttu-id="c84d7-148">Jsou zavřeny všechny otevřené naslouchací procesy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-148">Any open listeners are Closed.</span></span> <span data-ttu-id="c84d7-149">`ICommunicationListener.CloseAsync()`je volána v každé naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="c84d7-149">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="c84d7-150">token zrušení Hello předán příliš`RunAsync()` je zrušená.</span><span class="sxs-lookup"><span data-stu-id="c84d7-150">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="c84d7-151">Kontrola, zda text hello token zrušení pro `IsCancellationRequested` vlastnost vrací hodnotu true a pokud volána hello token `ThrowIfCancellationRequested` metoda vrátí `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-151">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="c84d7-152">Jednou `CloseAsync()` dokončení na každý naslouchací proces a `RunAsync()` také dokončení hello služby `StatelessService.OnCloseAsync()` metoda je volána, pokud je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="c84d7-152">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatelessService.OnCloseAsync()` method is called, if present.</span></span> <span data-ttu-id="c84d7-153">Je neobvyklé toooverride `StatelessService.OnCloseAsync()`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-153">It is uncommon toooverride `StatelessService.OnCloseAsync()`.</span></span>
3. <span data-ttu-id="c84d7-154">Po `StatelessService.OnCloseAsync()` dokončí, je destructed objekt služby hello</span><span class="sxs-lookup"><span data-stu-id="c84d7-154">After `StatelessService.OnCloseAsync()` completes, hello service object is destructed</span></span>

## <a name="stateful-service-startup"></a><span data-ttu-id="c84d7-155">Stavové služby spuštění</span><span class="sxs-lookup"><span data-stu-id="c84d7-155">Stateful service Startup</span></span>
<span data-ttu-id="c84d7-156">Stavové služby máte podobné služby toostateless vzor, s několik změn.</span><span class="sxs-lookup"><span data-stu-id="c84d7-156">Stateful services have a similar pattern toostateless services, with a few changes.</span></span> <span data-ttu-id="c84d7-157">Při spuštění stavové služby, hello pořadí událostí je následující:</span><span class="sxs-lookup"><span data-stu-id="c84d7-157">When starting up a stateful service, hello order of events is as follows:</span></span>

1. <span data-ttu-id="c84d7-158">Hello služby je vytvořený</span><span class="sxs-lookup"><span data-stu-id="c84d7-158">hello Service is constructed</span></span>
2. <span data-ttu-id="c84d7-159">`StatefulServiceBase.OnOpenAsync()`je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-159">`StatefulServiceBase.OnOpenAsync()` is called.</span></span> <span data-ttu-id="c84d7-160">To je uncommonly přepsat ve službě hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-160">This is uncommonly overridden in hello service.</span></span>
3. <span data-ttu-id="c84d7-161">Hello následující umět poradit paralelně</span><span class="sxs-lookup"><span data-stu-id="c84d7-161">hello following things happen in parallel</span></span>
    - <span data-ttu-id="c84d7-162">`StatefulServiceBase.CreateServiceReplicaListeners()`vyvolání</span><span class="sxs-lookup"><span data-stu-id="c84d7-162">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked</span></span> 
      - <span data-ttu-id="c84d7-163">Pokud je služba hello primární všechny vrácený naslouchací procesy jsou otevřené.</span><span class="sxs-lookup"><span data-stu-id="c84d7-163">If hello service is a Primary all returned listeners are Opened.</span></span> <span data-ttu-id="c84d7-164">`ICommunicationListener.OpenAsync()`je volána v každé naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="c84d7-164">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
      - <span data-ttu-id="c84d7-165">Pokud je služba hello sekundární, pouze tyto moduly pro naslouchání označen jako `ListenOnSecondary = true` jsou otevřené.</span><span class="sxs-lookup"><span data-stu-id="c84d7-165">If hello service is a Secondary, only those listeners marked as `ListenOnSecondary = true` are opened.</span></span> <span data-ttu-id="c84d7-166">Naslouchací procesy, které jsou otevřené na sekundárních hodnot je méně častých.</span><span class="sxs-lookup"><span data-stu-id="c84d7-166">Having listeners that are open on Secondaries is less common.</span></span>
    - <span data-ttu-id="c84d7-167">text Hello, pokud hello služba je aktuálně primární, služba hello `StatefulServiceBase.RunAsync()` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-167">hello if hello Service is currently a Primary, hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
4. <span data-ttu-id="c84d7-168">Jakmile se všechny hello naslouchací proces repliky `OpenAsync()` dokončení volání a `RunAsync()` je volána, `StatefulServiceBase.OnChangeRoleAsync()` je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-168">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` is called, `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="c84d7-169">To je uncommonly přepsat ve službě hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-169">This is uncommonly overridden in hello service.</span></span>

<span data-ttu-id="c84d7-170">Podobně toostateless služby, neexistuje žádný koordinovat hello pořadí, ve které hello naslouchací procesy vytvořil a spustil a kdy se nazývá RunAsync.</span><span class="sxs-lookup"><span data-stu-id="c84d7-170">Similarly toostateless services, there's no coordination between hello order in which hello listeners are created and opened and when RunAsync is called.</span></span> <span data-ttu-id="c84d7-171">Pokud potřebujete koordinaci, jsou mnohem hello řešení hello stejné.</span><span class="sxs-lookup"><span data-stu-id="c84d7-171">If you need coordination, hello solutions are much hello same.</span></span> <span data-ttu-id="c84d7-172">Je zde jeden další případ: Řekněme, že volání hello přicházejících u naslouchací procesy komunikace hello vyžadovat informace uložené v produktu některé [spolehlivé kolekce](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="c84d7-172">THere is one additional case: say that hello calls arriving at hello communication listeners require information kept inside some [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="c84d7-173">Protože naslouchací procesy komunikace hello by bylo možné otevřít před hello spolehlivé kolekce jsou z něj číst nebo zapisovat, a než může začít RunAsync, je nutné některé další spolupráce.</span><span class="sxs-lookup"><span data-stu-id="c84d7-173">Because hello communication listeners could open before hello reliable collections are readable or writeable, and before RunAsync could start, some additional coordination is necessary.</span></span> <span data-ttu-id="c84d7-174">Hello nejjednodušší a nejběžnější řešení je pro tooreturn naslouchací procesy komunikace hello některé kód chyby, který hello klienta používá tooknow tooretry hello požadavku.</span><span class="sxs-lookup"><span data-stu-id="c84d7-174">hello simplest and most common solution is for hello communication listeners tooreturn some error code that hello client uses tooknow tooretry hello request.</span></span>

## <a name="stateful-service-shutdown"></a><span data-ttu-id="c84d7-175">Stavové služby vypnutí</span><span class="sxs-lookup"><span data-stu-id="c84d7-175">Stateful service Shutdown</span></span>
<span data-ttu-id="c84d7-176">Podobně služby tooStateless události životního cyklu hello během vypnutí jsou hello stejný jako při spuštění, ale vrátit zpět.</span><span class="sxs-lookup"><span data-stu-id="c84d7-176">Similarly tooStateless services, hello lifecycle events during shutdown are hello same as during startup, but reversed.</span></span> <span data-ttu-id="c84d7-177">Když se právě vypíná stavové služby, hello k následujícím událostem:</span><span class="sxs-lookup"><span data-stu-id="c84d7-177">When a stateful service is being shut down, hello following events occur:</span></span>

1. <span data-ttu-id="c84d7-178">Paralelní</span><span class="sxs-lookup"><span data-stu-id="c84d7-178">In parallel</span></span>
    - <span data-ttu-id="c84d7-179">Jsou zavřeny všechny otevřené naslouchací procesy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-179">Any open listeners are Closed.</span></span> <span data-ttu-id="c84d7-180">`ICommunicationListener.CloseAsync()`je volána v každé naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="c84d7-180">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="c84d7-181">token zrušení Hello předán příliš`RunAsync()` je zrušená.</span><span class="sxs-lookup"><span data-stu-id="c84d7-181">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="c84d7-182">Kontrola, zda text hello token zrušení pro `IsCancellationRequested` vlastnost vrací hodnotu true a pokud volána hello token `ThrowIfCancellationRequested` metoda vrátí `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-182">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="c84d7-183">Jednou `CloseAsync()` dokončení na každý naslouchací proces a `RunAsync()` také dokončení hello služby `StatefulServiceBase.OnChangeRoleAsync()` je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-183">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="c84d7-184">(To je uncommonly přepsat v hello service.)</span><span class="sxs-lookup"><span data-stu-id="c84d7-184">(This is uncommonly overridden in hello service.)</span></span>
    - <span data-ttu-id="c84d7-185">Čekání na RunAsync toocomplete je nutné pouze pokud byl primární repliky této služby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-185">Waiting for RunAsync toocomplete is only necessary if this service replica was a Primary.</span></span>
3. <span data-ttu-id="c84d7-186">Jednou hello `StatefulServiceBase.OnChangeRoleAsync()` Metoda dokončení hello `StatefulServiceBase.OnCloseAsync()` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-186">Once hello `StatefulServiceBase.OnChangeRoleAsync()` method completes, hello `StatefulServiceBase.OnCloseAsync()` method is called.</span></span> <span data-ttu-id="c84d7-187">Toto je neobvyklé přepsání, ale je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="c84d7-187">This is an uncommon override, but it is available.</span></span>
3. <span data-ttu-id="c84d7-188">Po `StatefulServiceBase.OnCloseAsync()` dokončí, je destructed objekt služby hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-188">After `StatefulServiceBase.OnCloseAsync()` completes, hello service object is destructed.</span></span>

## <a name="stateful-service-primary-swaps"></a><span data-ttu-id="c84d7-189">Primární záměna stavové služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-189">Stateful service primary swaps</span></span>
<span data-ttu-id="c84d7-190">Když je spuštěný stavové služby, hello primární repliky této stavové služby mít pouze jejich naslouchací procesy komunikace otevřít a jejich RunAsync metodu s názvem.</span><span class="sxs-lookup"><span data-stu-id="c84d7-190">While a stateful service is running, only hello Primary replicas of that stateful services have their communication listeners opened and their RunAsync method called.</span></span> <span data-ttu-id="c84d7-191">Sekundární se vytvářejí ale zobrazit žádná další volání.</span><span class="sxs-lookup"><span data-stu-id="c84d7-191">Secondary are constructed but see no further calls.</span></span> <span data-ttu-id="c84d7-192">Ale průběhu stavové služby, které replika je právě hello primární můžete změnit.</span><span class="sxs-lookup"><span data-stu-id="c84d7-192">While a stateful service is running however, which replica is currently hello Primary can change.</span></span> <span data-ttu-id="c84d7-193">Co to znamená v podmínkách hello životního cyklu události, které můžete zobrazit repliku? Hello chování hello stavová repliky vidí závisí na tom, jestli je hello repliky se degradaci nebo povýší během hello swap.</span><span class="sxs-lookup"><span data-stu-id="c84d7-193">What does this mean in terms of hello lifecycle events that a replica can see? hello behavior hello stateful replica sees depends on whether it is hello replica being demoted or promoted during hello swap.</span></span>

### <a name="for-hello-primary-being-demoted"></a><span data-ttu-id="c84d7-194">Primární hello se nesníží úroveň</span><span class="sxs-lookup"><span data-stu-id="c84d7-194">For hello primary being demoted</span></span>
<span data-ttu-id="c84d7-195">Service Fabric musí tato replika toostop zpracování zpráv a ukončete všechny pozadí práce, kterou její probíhající činnosti.</span><span class="sxs-lookup"><span data-stu-id="c84d7-195">Service Fabric needs this replica toostop processing messages and quit any background work it is doing.</span></span> <span data-ttu-id="c84d7-196">V důsledku toho se právě vypíná tento krok vypadá podobně jako toowhen hello služby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-196">As a result, this step looks similar toowhen hello service is being shut down.</span></span> <span data-ttu-id="c84d7-197">Jeden rozdílem je, že hello služby není destructed nebo uzavřeny vzhledem k tomu, že zůstane jako sekundární.</span><span class="sxs-lookup"><span data-stu-id="c84d7-197">One difference is that hello Service isn't destructed or closed since it remains as a Secondary.</span></span> <span data-ttu-id="c84d7-198">Hello následující rozhraní API se označují jako:</span><span class="sxs-lookup"><span data-stu-id="c84d7-198">hello following APIs are called:</span></span>

1. <span data-ttu-id="c84d7-199">Paralelní</span><span class="sxs-lookup"><span data-stu-id="c84d7-199">In parallel</span></span>
    - <span data-ttu-id="c84d7-200">Jsou zavřeny všechny otevřené naslouchací procesy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-200">Any open listeners are Closed.</span></span> <span data-ttu-id="c84d7-201">`ICommunicationListener.CloseAsync()`je volána v každé naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="c84d7-201">`ICommunicationListener.CloseAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="c84d7-202">token zrušení Hello předán příliš`RunAsync()` je zrušená.</span><span class="sxs-lookup"><span data-stu-id="c84d7-202">hello cancellation token passed too`RunAsync()` is canceled.</span></span> <span data-ttu-id="c84d7-203">Kontrola, zda text hello token zrušení pro `IsCancellationRequested` vlastnost vrací hodnotu true a pokud volána hello token `ThrowIfCancellationRequested` metoda vrátí `OperationCanceledException`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-203">Checking hello cancellation token's `IsCancellationRequested` property returns true, and if called hello token's `ThrowIfCancellationRequested` method throws an `OperationCanceledException`.</span></span>
2. <span data-ttu-id="c84d7-204">Jednou `CloseAsync()` dokončení na každý naslouchací proces a `RunAsync()` také dokončení hello služby `StatefulServiceBase.OnChangeRoleAsync()` je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-204">Once `CloseAsync()` completes on each listener and `RunAsync()` also completes, hello service's `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="c84d7-205">To je uncommonly přepsat ve službě hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-205">This is uncommonly overridden in hello service.</span></span>

### <a name="for-hello-secondary-being-promoted"></a><span data-ttu-id="c84d7-206">Pro sekundární, jejíž úroveň zvyšujete hello</span><span class="sxs-lookup"><span data-stu-id="c84d7-206">For hello secondary being promoted</span></span>
<span data-ttu-id="c84d7-207">Podobně Service Fabric musí tato replika toostart naslouchání zpráv na hello přenosu a spusťte úlohy na pozadí, které ho záleží.</span><span class="sxs-lookup"><span data-stu-id="c84d7-207">Similarly, Service Fabric needs this replica toostart listening for messages on hello wire and start any background tasks it cares about.</span></span> <span data-ttu-id="c84d7-208">V důsledku toho, tento proces vypadá podobně jako služba hello toowhen je vytvořena, s výjimkou repliky hello samotné již existuje.</span><span class="sxs-lookup"><span data-stu-id="c84d7-208">As a result, this process looks similar toowhen hello service is created, except that hello replica itself already exists.</span></span> <span data-ttu-id="c84d7-209">Hello následující rozhraní API se označují jako:</span><span class="sxs-lookup"><span data-stu-id="c84d7-209">hello following APIs are called:</span></span>

1. <span data-ttu-id="c84d7-210">Paralelní</span><span class="sxs-lookup"><span data-stu-id="c84d7-210">In parallel</span></span>
    - <span data-ttu-id="c84d7-211">`StatefulServiceBase.CreateServiceReplicaListeners()`je voláno, a jsou otevřené žádné vrácený naslouchací procesy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-211">`StatefulServiceBase.CreateServiceReplicaListeners()` is invoked and any returned listeners are Opened.</span></span> <span data-ttu-id="c84d7-212">`ICommunicationListener.OpenAsync()`je volána v každé naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="c84d7-212">`ICommunicationListener.OpenAsync()` is called on each listener.</span></span>
    - <span data-ttu-id="c84d7-213">Hello služby `StatefulServiceBase.RunAsync()` metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-213">hello service's `StatefulServiceBase.RunAsync()` method is called</span></span>
2. <span data-ttu-id="c84d7-214">Jakmile se všechny hello naslouchací proces repliky `OpenAsync()` dokončení volání a `RunAsync()` byla volána, `StatefulServiceBase.OnChangeRoleAsync()` je volána.</span><span class="sxs-lookup"><span data-stu-id="c84d7-214">Once all hello replica listener's `OpenAsync()` calls complete and `RunAsync()` has been called,  `StatefulServiceBase.OnChangeRoleAsync()` is called.</span></span> <span data-ttu-id="c84d7-215">To je uncommonly přepsat ve službě hello.</span><span class="sxs-lookup"><span data-stu-id="c84d7-215">This is uncommonly overridden in hello service.</span></span>

### <a name="common-issues-during-stateful-service-shutdown-and-primary-demotion"></a><span data-ttu-id="c84d7-216">Běžné problémy při vypnutí stavové služby a primární snížení úrovně</span><span class="sxs-lookup"><span data-stu-id="c84d7-216">Common issues during stateful service shutdown and primary demotion</span></span>
<span data-ttu-id="c84d7-217">Změny Service Fabric hello primární stavové služby z různých důvodů.</span><span class="sxs-lookup"><span data-stu-id="c84d7-217">Service Fabric changes hello Primary of a stateful service for a variety of reasons.</span></span> <span data-ttu-id="c84d7-218">jsou technologie Hello nejčastějším [clusteru vyrovnává](service-fabric-cluster-resource-manager-balancing.md) a [upgradu aplikace](service-fabric-application-upgrade.md).</span><span class="sxs-lookup"><span data-stu-id="c84d7-218">hello most common are [cluster rebalancing](service-fabric-cluster-resource-manager-balancing.md) and [application upgrade](service-fabric-application-upgrade.md).</span></span> <span data-ttu-id="c84d7-219">Během těchto operací (i během vypnutí normální služby, jako by se zobrazí, pokud byla odstraněna hello služby), je důležité, že hello služby ohledem hello `CancellationToken`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-219">During these operations (as well as during normal service shutdown, like you'd see if hello service was deleted), it is important that hello service respect hello `CancellationToken`.</span></span> <span data-ttu-id="c84d7-220">Služby, které zpracovávají zrušení řádně bude mít několik problémy.</span><span class="sxs-lookup"><span data-stu-id="c84d7-220">Services that do not handle cancellation cleanly will experience several issues.</span></span> <span data-ttu-id="c84d7-221">Konkrétně tyto operace bude pomalé, vzhledem k tomu, že Service Fabric hello služby toostop čeká řádně.</span><span class="sxs-lookup"><span data-stu-id="c84d7-221">In particular, these operations will be slow since Service Fabric waits for hello services toostop gracefully.</span></span> <span data-ttu-id="c84d7-222">Nakonec to může vést toofailed upgrady tohoto časového limitu a vrátit zpět.</span><span class="sxs-lookup"><span data-stu-id="c84d7-222">This can ultimately lead toofailed upgrades that time out and roll back.</span></span> <span data-ttu-id="c84d7-223">Token zrušení hello toohonor selhání může také způsobit imbalanced clustery, protože uzly získat aktivní, ale hello služby nemůže být znovu vyrovnána vzhledem k tomu, jak dlouho trvá příliš dlouho toomove je jinde.</span><span class="sxs-lookup"><span data-stu-id="c84d7-223">Failure toohonor hello cancellation token can also cause imbalanced clusters because nodes get hot but hello services can't be rebalanced since it takes too long toomove them elsewhere.</span></span> 

<span data-ttu-id="c84d7-224">Vzhledem k tomu, že jsou stavové služby hello, je také pravděpodobné, že používají hello [spolehlivé kolekce](service-fabric-reliable-services-reliable-collections.md).</span><span class="sxs-lookup"><span data-stu-id="c84d7-224">Since hello services are stateful, it is also likely that they are using hello [Reliable Collections](service-fabric-reliable-services-reliable-collections.md).</span></span> <span data-ttu-id="c84d7-225">V Service Fabric při snížení úrovně primární jedním hello první věcí, které se stane, je zruší se oprávnění k zápisu toohello základní stavu.</span><span class="sxs-lookup"><span data-stu-id="c84d7-225">In Service Fabric, when a Primary is demoted, one of hello first things that happens is that write access toohello underlying state is revoked.</span></span> <span data-ttu-id="c84d7-226">To vede tooa druhé sadě problémy, které můžou mít vliv hello služby životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="c84d7-226">This leads tooa second set of issues that can impact hello service lifecycle.</span></span> <span data-ttu-id="c84d7-227">kolekce Hello návratový výjimky založené na hello načasování a jestli přesouvá hello repliky nebo vypnutí.</span><span class="sxs-lookup"><span data-stu-id="c84d7-227">hello collections return Exceptions based on hello timing and whether hello replica is being moved or shut down.</span></span> <span data-ttu-id="c84d7-228">Tyto výjimky by měl být správně zpracovat.</span><span class="sxs-lookup"><span data-stu-id="c84d7-228">These exceptions should be handled correctly.</span></span> <span data-ttu-id="c84d7-229">Výjimky vyvolané Service Fabric spadají do trvalého [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) a přechodný [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) kategorií.</span><span class="sxs-lookup"><span data-stu-id="c84d7-229">Exceptions thrown by Service Fabric fall into permanent [(`FabricException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabricexception?view=azure-dotnet) and transient [(`FabricTransientException`)](https://docs.microsoft.com/en-us/dotnet/api/system.fabric.fabrictransientexception?view=azure-dotnet) categories.</span></span> <span data-ttu-id="c84d7-230">Trvalé výjimky by měl zaznamenána a vyvolána, zatímco hello přechodné výjimky může opakována na základě logiky některé opakování.</span><span class="sxs-lookup"><span data-stu-id="c84d7-230">Permanent exceptions should be logged and thrown, while hello transient exceptions may be retried based on some retry logic.</span></span>

<span data-ttu-id="c84d7-231">Zpracování výjimek hello, které pocházejí z použití hello `ReliableCollections` ve spojení s událostmi služby životního cyklu, je důležitou součástí testování a ověření spolehlivě.</span><span class="sxs-lookup"><span data-stu-id="c84d7-231">Handling hello exceptions that come from use of hello `ReliableCollections` in conjunction with service lifecycle events is an important part of testing and validating a Reliable Service.</span></span> <span data-ttu-id="c84d7-232">Hello doporučení je vždy toorun služby zatížení při provádění upgradu a [chaos testování](service-fabric-controlled-chaos.md) před nasazením někdy tooproduction.</span><span class="sxs-lookup"><span data-stu-id="c84d7-232">hello recommendation is always toorun your service under load while performing upgrades and [chaos testing](service-fabric-controlled-chaos.md) before ever deploying tooproduction.</span></span> <span data-ttu-id="c84d7-233">Tyto základní postup pomůže, zajistěte, aby služby je implementovaná správně a zpracovává události životního cyklu správně.</span><span class="sxs-lookup"><span data-stu-id="c84d7-233">These basic steps help ensure that your service is correctly implemented and handles lifecycle events correctly.</span></span>


## <a name="notes-on-service-lifecycle"></a><span data-ttu-id="c84d7-234">Poznámky k služby životního cyklu</span><span class="sxs-lookup"><span data-stu-id="c84d7-234">Notes on service lifecycle</span></span>
  - <span data-ttu-id="c84d7-235">Obě hello `RunAsync()` metoda a hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` volání jsou volitelné.</span><span class="sxs-lookup"><span data-stu-id="c84d7-235">Both hello `RunAsync()` method and hello `CreateServiceReplicaListeners/CreateServiceInstanceListeners` calls are optional.</span></span> <span data-ttu-id="c84d7-236">Služby může mít jeden z nich, obě nebo ani jeden z nich.</span><span class="sxs-lookup"><span data-stu-id="c84d7-236">A service may have one of them, both, or neither.</span></span> <span data-ttu-id="c84d7-237">Například pokud hello služba nemá svou práci v odpovědi toouser volání, není třeba pro něj tooimplement `RunAsync()`.</span><span class="sxs-lookup"><span data-stu-id="c84d7-237">For example, if hello service does all its work in response toouser calls, there is no need for it tooimplement `RunAsync()`.</span></span> <span data-ttu-id="c84d7-238">Pouze naslouchací procesy komunikace hello a jejich přidružené kód jsou nezbytné.</span><span class="sxs-lookup"><span data-stu-id="c84d7-238">Only hello communication listeners and their associated code are necessary.</span></span> <span data-ttu-id="c84d7-239">Podobně je nepovinný hello služby může mít pouze pozadí pracovní toodo vytváření a vrácení naslouchací procesy komunikace a proto stačí tooimplement`RunAsync()`</span><span class="sxs-lookup"><span data-stu-id="c84d7-239">Similarly, creating and returning communication listeners is optional, as hello service may have only background work toodo, and so only needs tooimplement `RunAsync()`</span></span>
  - <span data-ttu-id="c84d7-240">Je platná pro služby toocomplete `RunAsync()` úspěšně a zpět z něj.</span><span class="sxs-lookup"><span data-stu-id="c84d7-240">It is valid for a service toocomplete `RunAsync()` successfully and return from it.</span></span> <span data-ttu-id="c84d7-241">Dokončení není podmínce chyby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-241">Completing is not a failure condition.</span></span> <span data-ttu-id="c84d7-242">Dokončení `RunAsync()` označuje, že práce pozadí hello hello služby byla dokončena.</span><span class="sxs-lookup"><span data-stu-id="c84d7-242">Completing `RunAsync()` indicates that hello background work of hello service has completed.</span></span> <span data-ttu-id="c84d7-243">Pro stavové služby spolehlivé `RunAsync()` nebude volán znovu, pokud došlo k degradaci z primární tooSecondary hello repliky a poté vyzval back tooPrimary.</span><span class="sxs-lookup"><span data-stu-id="c84d7-243">For stateful reliable services, `RunAsync()` is called again if hello replica were demoted from Primary tooSecondary and then promoted back tooPrimary.</span></span>
  - <span data-ttu-id="c84d7-244">Pokud služba ukončí z `RunAsync()` po vyvolání výjimky neočekávané výjimce, to se považuje za selhání.</span><span class="sxs-lookup"><span data-stu-id="c84d7-244">If a service exits from `RunAsync()` by throwing some unexpected exception, this constitutes a failure.</span></span> <span data-ttu-id="c84d7-245">objekt služby Hello se vypne a oznámila Chyba stavu.</span><span class="sxs-lookup"><span data-stu-id="c84d7-245">hello service object is shut down and a health error reported.</span></span>
  - <span data-ttu-id="c84d7-246">Když žádný časový limit na vrácení z těchto metod, okamžitě ztratit hello možnost toowrite tooReliable kolekcí a proto nelze dokončit všechna skutečná práce.</span><span class="sxs-lookup"><span data-stu-id="c84d7-246">While there is no time limit on returning from these methods, you immediately lose hello ability toowrite tooReliable Collections and therefore cannot complete any real work.</span></span> <span data-ttu-id="c84d7-247">Doporučuje se vrátíte co nejrychleji po přijetí hello žádost o zrušení.</span><span class="sxs-lookup"><span data-stu-id="c84d7-247">It is recommended that you return as quickly as possible upon receiving hello cancellation request.</span></span> <span data-ttu-id="c84d7-248">Pokud vaše služba neodpovídá volání toothese rozhraní API v přiměřené době Service Fabric může vynucené ukončení služby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-248">If your service does not respond toothese API calls in a reasonable amount of time Service Fabric may forcibly terminate your service.</span></span> <span data-ttu-id="c84d7-249">Obvykle tato situace nastane pouze během upgradu aplikace nebo když se odstraňuje služby.</span><span class="sxs-lookup"><span data-stu-id="c84d7-249">Usually this only happens during application upgrades or when a service is being deleted.</span></span> <span data-ttu-id="c84d7-250">Tento časový limit je 15 minut ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="c84d7-250">This timeout is 15 minutes by default.</span></span>
  - <span data-ttu-id="c84d7-251">Selhání v hello `OnCloseAsync()` cesta povede `OnAbort()` volané, což je možnost best effort poslední chance pro hello služby tooclean nahoru a uvolnění prostředků, které budou požadovaly.</span><span class="sxs-lookup"><span data-stu-id="c84d7-251">Failures in hello `OnCloseAsync()` path result in `OnAbort()` being called which is a last-chance best-effort opportunity for hello service tooclean up and release any resources that they have claimed.</span></span>

## <a name="next-steps"></a><span data-ttu-id="c84d7-252">Další kroky</span><span class="sxs-lookup"><span data-stu-id="c84d7-252">Next steps</span></span>
- [<span data-ttu-id="c84d7-253">Úvod tooReliable služby</span><span class="sxs-lookup"><span data-stu-id="c84d7-253">Introduction tooReliable Services</span></span>](service-fabric-reliable-services-introduction.md)
- [<span data-ttu-id="c84d7-254">Spolehlivé služby rychlý start</span><span class="sxs-lookup"><span data-stu-id="c84d7-254">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
- [<span data-ttu-id="c84d7-255">Spolehlivé služby advanced využití</span><span class="sxs-lookup"><span data-stu-id="c84d7-255">Reliable Services advanced usage</span></span>](service-fabric-reliable-services-advanced-usage.md)

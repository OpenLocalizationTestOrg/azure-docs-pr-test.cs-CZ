---
title: "Pokyny a doporučení pro spolehlivé kolekce v Azure Service Fabric | Microsoft Docs"
description: "Pokyny a doporučení pro používání služby Fabric spolehlivé kolekce"
services: service-fabric
documentationcenter: .net
author: mcoskun
manager: timlt
editor: masnider,rajak
ms.assetid: 62857523-604b-434e-bd1c-2141ea4b00d1
ms.service: service-fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: required
ms.date: 5/3/2017
ms.author: mcoskun
ms.openlocfilehash: 053a7bca76362035e428fc11806b3e4f83d00946
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="guidelines-and-recommendations-for-reliable-collections-in-azure-service-fabric"></a><span data-ttu-id="23693-103">Pokyny a doporučení pro spolehlivé kolekce v Azure Service Fabric</span><span class="sxs-lookup"><span data-stu-id="23693-103">Guidelines and recommendations for Reliable Collections in Azure Service Fabric</span></span>
<span data-ttu-id="23693-104">Tato část obsahuje pokyny pro použití spolehlivé správce stavu a spolehlivé kolekce.</span><span class="sxs-lookup"><span data-stu-id="23693-104">This section provides guidelines for using Reliable State Manager and Reliable Collections.</span></span> <span data-ttu-id="23693-105">Cílem je pomoct uživatelům vyhnout se běžné nástrahy.</span><span class="sxs-lookup"><span data-stu-id="23693-105">The goal is to help users avoid common pitfalls.</span></span>

<span data-ttu-id="23693-106">Pokyny jsou uspořádána jako jednoduchý doporučení předponu s podmínkami *provést*, *zvažte*, *nepoužívejte* a *nepodporují*.</span><span class="sxs-lookup"><span data-stu-id="23693-106">The guidelines are organized as simple recommendations prefixed with the terms *Do*, *Consider*, *Avoid* and *Do not*.</span></span>

* <span data-ttu-id="23693-107">Nelze změnit objekt typu vlastní vrácené operací čtení (například `TryPeekAsync` nebo `TryGetValueAsync`).</span><span class="sxs-lookup"><span data-stu-id="23693-107">Do not modify an object of custom type returned by read operations (for example, `TryPeekAsync` or `TryGetValueAsync`).</span></span> <span data-ttu-id="23693-108">Spolehlivé kolekcí, stejně jako souběžných kolekcí, vrátí odkaz na objekty a nelze zkopírovat.</span><span class="sxs-lookup"><span data-stu-id="23693-108">Reliable Collections, just like Concurrent Collections, return a reference to the objects and not a copy.</span></span>
* <span data-ttu-id="23693-109">Proveďte hloubkové kopie vráceného objektu vlastního typu před změnou ho.</span><span class="sxs-lookup"><span data-stu-id="23693-109">Do deep copy the returned object of a custom type before modifying it.</span></span> <span data-ttu-id="23693-110">Vzhledem k tomu, že struktury a vestavěné typy jsou průchodu hodnotu, není potřeba provést hloubkové kopie na ně.</span><span class="sxs-lookup"><span data-stu-id="23693-110">Since structs and built-in types are pass-by-value, you do not need to do a deep copy on them.</span></span>
* <span data-ttu-id="23693-111">Nepoužívejte `TimeSpan.MaxValue` časových limitů.</span><span class="sxs-lookup"><span data-stu-id="23693-111">Do not use `TimeSpan.MaxValue` for time-outs.</span></span> <span data-ttu-id="23693-112">Vypršení časových limitů se má použít k detekci zablokování.</span><span class="sxs-lookup"><span data-stu-id="23693-112">Time-outs should be used to detect deadlocks.</span></span>
* <span data-ttu-id="23693-113">Nepoužívejte transakce po bylo potvrzeno, byl zrušen nebo zlikvidován.</span><span class="sxs-lookup"><span data-stu-id="23693-113">Do not use a transaction after it has been committed, aborted, or disposed.</span></span>
* <span data-ttu-id="23693-114">Nepoužívejte výčet mimo, který byl vytvořen v oboru transakce.</span><span class="sxs-lookup"><span data-stu-id="23693-114">Do not use an enumeration outside of the transaction scope it was created in.</span></span>
* <span data-ttu-id="23693-115">Nevytvářejte transakce v rámci jiné transakci `using` příkaz vzhledem k tomu může dojít k zablokování.</span><span class="sxs-lookup"><span data-stu-id="23693-115">Do not create a transaction within another transaction’s `using` statement because it can cause deadlocks.</span></span>
* <span data-ttu-id="23693-116">Ujistěte se, že vaše `IComparable<TKey>` implementace je správný.</span><span class="sxs-lookup"><span data-stu-id="23693-116">Do ensure that your `IComparable<TKey>` implementation is correct.</span></span> <span data-ttu-id="23693-117">Systém má závislost `IComparable<TKey>` ke sloučení kontrolních bodů a řádky.</span><span class="sxs-lookup"><span data-stu-id="23693-117">The system takes dependency on `IComparable<TKey>` for merging checkpoints and rows.</span></span>
* <span data-ttu-id="23693-118">Použití aktualizační zámek při čtení položky s záměr aktualizujte, aby se zabránilo třídu zablokování.</span><span class="sxs-lookup"><span data-stu-id="23693-118">Do use Update lock when reading an item with an intention to update it to prevent a certain class of deadlocks.</span></span>
* <span data-ttu-id="23693-119">Zvažte zachování položek (například TKey + TValue pro spolehlivé slovník) nižší než 80 kB: menší tím lépe.</span><span class="sxs-lookup"><span data-stu-id="23693-119">Consider keeping your items (for example, TKey + TValue for Reliable Dictionary) below 80 KBytes: smaller the better.</span></span> <span data-ttu-id="23693-120">Tím se snižuje množství velkého objektu haldy využití a také diskových a síťových vstupně-VÝSTUPNÍMI požadavky.</span><span class="sxs-lookup"><span data-stu-id="23693-120">This reduces the amount of Large Object Heap usage as well as disk and network IO requirements.</span></span> <span data-ttu-id="23693-121">Často snižuje replikace duplicitních dat, je-li aktualizován pouze jeden malou část hodnoty.</span><span class="sxs-lookup"><span data-stu-id="23693-121">Often, it reduces replicating duplicate data when only one small part of the value is being updated.</span></span> <span data-ttu-id="23693-122">Běžným způsobem to můžete udělat ve slovníku spolehlivé, je proniknout vaší řádky do více řádků.</span><span class="sxs-lookup"><span data-stu-id="23693-122">Common way to achieve this in Reliable Dictionary, is to break your rows in to multiple rows.</span></span>
* <span data-ttu-id="23693-123">Zvažte použití zálohování a obnovení funkce tak, aby měl zotavení po havárii.</span><span class="sxs-lookup"><span data-stu-id="23693-123">Consider using backup and restore functionality to have disaster recovery.</span></span>
* <span data-ttu-id="23693-124">Vyhněte se kombinování jedné entity operací a operací s více entit (např `GetCountAsync`, `CreateEnumerableAsync`) v rámci jedné transakce z důvodu izolace různé úrovně.</span><span class="sxs-lookup"><span data-stu-id="23693-124">Avoid mixing single entity operations and multi-entity operations (e.g `GetCountAsync`, `CreateEnumerableAsync`) in the same transaction due to the different isolation levels.</span></span>
* <span data-ttu-id="23693-125">Zpracování výjimkou InvalidOperationException.</span><span class="sxs-lookup"><span data-stu-id="23693-125">Do handle InvalidOperationException.</span></span> <span data-ttu-id="23693-126">Uživatelské transakce může být přerušil systému různých důvodů.</span><span class="sxs-lookup"><span data-stu-id="23693-126">User transactions can be aborted by the system for variety of reasons.</span></span> <span data-ttu-id="23693-127">Například když spolehlivé správce stavu mění jeho roli z primární nebo když dlouhotrvající transakci blokuje zkrácení protokolu transakcí.</span><span class="sxs-lookup"><span data-stu-id="23693-127">For example, when the Reliable State Manager is changing its role out of Primary or when a long-running transaction is blocking truncation of the transactional log.</span></span> <span data-ttu-id="23693-128">V takových případech uživatel obdržet InvalidOperationException, která určuje, že jejich transakce již byla ukončena.</span><span class="sxs-lookup"><span data-stu-id="23693-128">In such cases, user may receive InvalidOperationException indicating that their transaction has already been terminated.</span></span> <span data-ttu-id="23693-129">Za předpokladu, ukončení transakce nebyla požadované uživatelem, je nejlepší způsob, jak zpracovat výjimku k uvolnění transakce, zkontrolujte, jestli nesignalizuje token zrušení (nebo se změnily role repliky) a pokud není vytvořit novou transakci a zkuste to znovu.</span><span class="sxs-lookup"><span data-stu-id="23693-129">Assuming, the termination of the transaction was not requested by the user, best way to handle this exception is to dispose the transaction, check if the cancellation token has been signaled (or the role of the replica has been changed), and if not create a new transaction and retry.</span></span>  

<span data-ttu-id="23693-130">Zde jsou některé věci, třeba vzít v úvahu:</span><span class="sxs-lookup"><span data-stu-id="23693-130">Here are some things to keep in mind:</span></span>

* <span data-ttu-id="23693-131">Výchozí časový limit je čtyři sekund pro všechny spolehlivé kolekce rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="23693-131">The default time-out is four seconds for all the Reliable Collection APIs.</span></span> <span data-ttu-id="23693-132">Většina uživatelů měli používat výchozí časový limit.</span><span class="sxs-lookup"><span data-stu-id="23693-132">Most users should use the default time-out.</span></span>
* <span data-ttu-id="23693-133">Výchozí token zrušení je `CancellationToken.None` v všechna rozhraní API spolehlivé kolekce.</span><span class="sxs-lookup"><span data-stu-id="23693-133">The default cancellation token is `CancellationToken.None` in all Reliable Collections APIs.</span></span>
* <span data-ttu-id="23693-134">Parametr typ klíče (*TKey*) pro slovník spolehlivé musí správně implementovat `GetHashCode()` a `Equals()`.</span><span class="sxs-lookup"><span data-stu-id="23693-134">The key type parameter (*TKey*) for a Reliable Dictionary must correctly implement `GetHashCode()` and `Equals()`.</span></span> <span data-ttu-id="23693-135">Klíče musí být neměnitelný.</span><span class="sxs-lookup"><span data-stu-id="23693-135">Keys must be immutable.</span></span>
* <span data-ttu-id="23693-136">K dosažení vysoké dostupnosti pro spolehlivé kolekce, každá služba měli aspoň cíle a minimální repliky nastavit velikost 3.</span><span class="sxs-lookup"><span data-stu-id="23693-136">To achieve high availability for the Reliable Collections, each service should have at least a target and minimum replica set size of 3.</span></span>
* <span data-ttu-id="23693-137">Operace čtení na sekundárním lze číst verze, které nejsou kvora potvrzené.</span><span class="sxs-lookup"><span data-stu-id="23693-137">Read operations on the secondary may read versions that are not quorum committed.</span></span>
  <span data-ttu-id="23693-138">To znamená, že může být verzi data, která je pro čtení z jedné sekundární false zvýšily.</span><span class="sxs-lookup"><span data-stu-id="23693-138">This means that a version of data that is read from a single secondary might be false progressed.</span></span>
  <span data-ttu-id="23693-139">Čtení z primární jsou vždycky stabilní: můžete nikdy být false zvýšily.</span><span class="sxs-lookup"><span data-stu-id="23693-139">Reads from Primary are always stable: can never be false progressed.</span></span>

### <a name="next-steps"></a><span data-ttu-id="23693-140">Další kroky</span><span class="sxs-lookup"><span data-stu-id="23693-140">Next steps</span></span>
* [<span data-ttu-id="23693-141">Práce s Reliable Collections</span><span class="sxs-lookup"><span data-stu-id="23693-141">Working with Reliable Collections</span></span>](service-fabric-work-with-reliable-collections.md)
* [<span data-ttu-id="23693-142">Transakce a zámky.</span><span class="sxs-lookup"><span data-stu-id="23693-142">Transactions and Locks</span></span>](service-fabric-reliable-services-reliable-collections-transactions-locks.md)
* [<span data-ttu-id="23693-143">Správce spolehlivé stavu a interní informace o kolekci</span><span class="sxs-lookup"><span data-stu-id="23693-143">Reliable State Manager and Collection Internals</span></span>](service-fabric-reliable-services-reliable-collections-internals.md)
* <span data-ttu-id="23693-144">Správa dat</span><span class="sxs-lookup"><span data-stu-id="23693-144">Managing Data</span></span>
  * [<span data-ttu-id="23693-145">Zálohování a obnovení</span><span class="sxs-lookup"><span data-stu-id="23693-145">Backup and Restore</span></span>](service-fabric-reliable-services-backup-restore.md)
  * [<span data-ttu-id="23693-146">Oznámení</span><span class="sxs-lookup"><span data-stu-id="23693-146">Notifications</span></span>](service-fabric-reliable-services-notifications.md)
  * [<span data-ttu-id="23693-147">Serializace a Upgrade</span><span class="sxs-lookup"><span data-stu-id="23693-147">Serialization and Upgrade</span></span>](service-fabric-application-upgrade-data-serialization.md)
  * [<span data-ttu-id="23693-148">Configuration Manager spolehlivé stavu</span><span class="sxs-lookup"><span data-stu-id="23693-148">Reliable State Manager configuration</span></span>](service-fabric-reliable-services-configuration.md)
* <span data-ttu-id="23693-149">Ostatní</span><span class="sxs-lookup"><span data-stu-id="23693-149">Others</span></span>
  * [<span data-ttu-id="23693-150">Spolehlivé služby rychlý start</span><span class="sxs-lookup"><span data-stu-id="23693-150">Reliable Services quick start</span></span>](service-fabric-reliable-services-quick-start.md)
  * [<span data-ttu-id="23693-151">Referenční informace pro vývojáře pro spolehlivé kolekce</span><span class="sxs-lookup"><span data-stu-id="23693-151">Developer reference for Reliable Collections</span></span>](https://msdn.microsoft.com/library/azure/microsoft.servicefabric.data.collections.aspx)

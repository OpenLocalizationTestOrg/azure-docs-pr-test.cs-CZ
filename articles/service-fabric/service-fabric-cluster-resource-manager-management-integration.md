---
title: "aaaService správce prostředků infrastruktury Cluster - integraci správy | Microsoft Docs"
description: "Přehled integrace hello body mezi hello správce prostředků clusteru a správu prostředků infrastruktury služby."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 956cd0b8-b6e3-4436-a224-8766320e8cd7
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 9a24c9de121fbe2e8e5e8e4d117e64686918936a
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="cluster-resource-manager-integration-with-service-fabric-cluster-management"></a><span data-ttu-id="76650-103">Integrace manager prostředek clusteru s Správa clusteru Service Fabric</span><span class="sxs-lookup"><span data-stu-id="76650-103">Cluster resource manager integration with Service Fabric cluster management</span></span>
<span data-ttu-id="76650-104">Hello správce prostředků clusteru Service Fabric není disk upgradů Service Fabric, ale je zahrnuta.</span><span class="sxs-lookup"><span data-stu-id="76650-104">hello Service Fabric Cluster Resource Manager doesn't drive upgrades in Service Fabric, but it is involved.</span></span> <span data-ttu-id="76650-105">Hello první tak, aby hello clusteru Resource Manager pomůže se správou je sledování hello požadovaného stavu hello clusteru a hello služeb uvnitř ho.</span><span class="sxs-lookup"><span data-stu-id="76650-105">hello first way that hello Cluster Resource Manager helps with management is by tracking hello desired state of hello cluster and hello services inside it.</span></span> <span data-ttu-id="76650-106">Hello správce prostředků clusteru odesílá sestav stavu, když ji nemůžete uvést do požadované konfigurace hello hello clusteru.</span><span class="sxs-lookup"><span data-stu-id="76650-106">hello Cluster Resource Manager sends out health reports when it cannot put hello cluster into hello desired configuration.</span></span> <span data-ttu-id="76650-107">Například pokud je nedostatečné kapacity hello správce prostředků clusteru rozešle stav varování a chyby naznačující hello problém.</span><span class="sxs-lookup"><span data-stu-id="76650-107">For example, if there is insufficient capacity hello Cluster Resource Manager sends out health warnings and errors indicating hello problem.</span></span> <span data-ttu-id="76650-108">Další část integrace má toodo s fungování upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-108">Another piece of integration has toodo with how upgrades work.</span></span> <span data-ttu-id="76650-109">Hello clusteru Resource Manager mírně mění své chování během upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-109">hello Cluster Resource Manager alters its behavior slightly during upgrades.</span></span>  

## <a name="health-integration"></a><span data-ttu-id="76650-110">Integrace stavu</span><span class="sxs-lookup"><span data-stu-id="76650-110">Health integration</span></span>
<span data-ttu-id="76650-111">Hello správce prostředků clusteru neustále sleduje hello pravidla, která jste definovali k umístění vaší služby.</span><span class="sxs-lookup"><span data-stu-id="76650-111">hello Cluster Resource Manager constantly tracks hello rules you have defined for placing your services.</span></span> <span data-ttu-id="76650-112">Také sleduje hello zbývající kapacity pro jednotlivé metriky na uzlech hello a v hello clusteru a clusteru hello jako celek.</span><span class="sxs-lookup"><span data-stu-id="76650-112">It also tracks hello remaining capacity for each metric on hello nodes and in hello cluster and in hello cluster as a whole.</span></span> <span data-ttu-id="76650-113">Pokud ji nemůže splnit tato pravidla nebo pokud není dostatečná kapacita, jsou vydávány stav varování a chyby.</span><span class="sxs-lookup"><span data-stu-id="76650-113">If it can't satisfy those rules or if there is insufficient capacity, health warnings and errors are emitted.</span></span> <span data-ttu-id="76650-114">Například pokud uzel je nad kapacitu a hello správce prostředků clusteru pokusí toofix hello situaci přesunutím služby.</span><span class="sxs-lookup"><span data-stu-id="76650-114">For example, if a node is over capacity and hello Cluster Resource Manager will try toofix hello situation by moving services.</span></span> <span data-ttu-id="76650-115">Pokud jej nelze opravit hello situaci vysílá stavu varování, uzel, který je přes kapacity a pro které metriky.</span><span class="sxs-lookup"><span data-stu-id="76650-115">If it can't correct hello situation it emits a health warning indicating which node is over capacity, and for which metrics.</span></span>

<span data-ttu-id="76650-116">Dalším příkladem upozornění stavu hello Resource Manager je porušení omezení umístění.</span><span class="sxs-lookup"><span data-stu-id="76650-116">Another example of hello Resource Manager's health warnings is violations of placement constraints.</span></span> <span data-ttu-id="76650-117">Například, pokud jste definovali omezení umístění (například `“NodeColor == Blue”`) a hello Resource Manager zjistí porušení omezení, se vydá upozornění stavu.</span><span class="sxs-lookup"><span data-stu-id="76650-117">For example, if you have defined a placement constraint (such as `“NodeColor == Blue”`) and hello Resource Manager detects a violation of that constraint, it emits a health warning.</span></span> <span data-ttu-id="76650-118">To platí pro vlastní omezení a hello výchozí omezení (např. hello omezení domény selhání a upgradu domény).</span><span class="sxs-lookup"><span data-stu-id="76650-118">This is true for custom constraints and hello default constraints (like hello Fault Domain and Upgrade Domain constraints).</span></span>

<span data-ttu-id="76650-119">Tady je příklad jeden takové zprávy stavu.</span><span class="sxs-lookup"><span data-stu-id="76650-119">Here’s an example of one such health report.</span></span> <span data-ttu-id="76650-120">Sestava stavu hello v takovém případě je pro jeden z oddílů služby system hello.</span><span class="sxs-lookup"><span data-stu-id="76650-120">In this case, hello health report is for one of hello system service’s partitions.</span></span> <span data-ttu-id="76650-121">zpráva stavu Hello znamená hello repliky tohoto oddílu jsou dočasně zabalit do příliš málo upgradu domén.</span><span class="sxs-lookup"><span data-stu-id="76650-121">hello health message indicates hello replicas of that partition are temporarily packed into too few Upgrade Domains.</span></span>

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_UpgradeDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_UpgradeDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : hello Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating hello Constraint: UpgradeDomain Details: UpgradeDomain ID -- 4, Replica on NodeName -- Node.8 Currently Upgrading -- false Distribution Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

<span data-ttu-id="76650-122">Tady je co tato zpráva stavu nám oznamuje je:</span><span class="sxs-lookup"><span data-stu-id="76650-122">Here's what this health message is telling us is:</span></span>

1. <span data-ttu-id="76650-123">Všechny repliky hello sami jsou v pořádku: každá z nich má AggregatedHealthState: Ok</span><span class="sxs-lookup"><span data-stu-id="76650-123">All hello replicas themselves are healthy: Each has AggregatedHealthState : Ok</span></span>
2. <span data-ttu-id="76650-124">aktuálně probíhá porušení Hello doména Upgrade distribučního omezení.</span><span class="sxs-lookup"><span data-stu-id="76650-124">hello Upgrade Domain distribution constraint is currently being violated.</span></span> <span data-ttu-id="76650-125">To znamená, že konkrétní upgradu domény má další repliky z tohoto oddílu, než by měl.</span><span class="sxs-lookup"><span data-stu-id="76650-125">This means a particular Upgrade Domain has more replicas from this partition than it should.</span></span>
3. <span data-ttu-id="76650-126">Uzel obsahuje hello repliky což způsobilo hello porušení.</span><span class="sxs-lookup"><span data-stu-id="76650-126">Which node contains hello replica causing hello violation.</span></span> <span data-ttu-id="76650-127">V takovém případě je hello uzel s názvem hello "Node.8"</span><span class="sxs-lookup"><span data-stu-id="76650-127">In this case it's hello node with hello name "Node.8"</span></span>
4. <span data-ttu-id="76650-128">Jestli upgradu se právě děje pro toto oddílu ("aktuálně upgrade--false")</span><span class="sxs-lookup"><span data-stu-id="76650-128">Whether an upgrade is currently happening for this partition ("Currently Upgrading -- false")</span></span>
5. <span data-ttu-id="76650-129">Hello zásady distribuce pro tuto službu: "Distribuční zásady – okolních".</span><span class="sxs-lookup"><span data-stu-id="76650-129">hello distribution policy for this service: "Distribution Policy -- Packing".</span></span> <span data-ttu-id="76650-130">Toto se řídí hello `RequireDomainDistribution` [umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="76650-130">This is governed by hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="76650-131">"Balení" znamená, že v tomto případě DomainDistribution byla _není_ potřeby, abychom věděli, že umístění zásady nebyl zadán pro tuto službu.</span><span class="sxs-lookup"><span data-stu-id="76650-131">"Packing" indicates that in this case DomainDistribution was _not_ required, so we know that placement policy was not specified for this service.</span></span> 
6. <span data-ttu-id="76650-132">Když se stalo hello sestavy - 8/10/2015 19:13:02: 00</span><span class="sxs-lookup"><span data-stu-id="76650-132">When hello report happened - 8/10/2015 7:13:02 PM</span></span>

<span data-ttu-id="76650-133">Informace, jako tento výstrahy zajišťuje, že ještě efektivněji v produkční toolet, které znáte něco nepovede a zároveň používat toodetect a zastaví chybný upgrady.</span><span class="sxs-lookup"><span data-stu-id="76650-133">Information like this powers alerts that fire in production toolet you know something has gone wrong and is also used toodetect and halt bad upgrades.</span></span> <span data-ttu-id="76650-134">V takovém případě by chceme toosee Pokud jsme můžete zjistit, proč hello Resource Manager měl toopack hello repliky do hello upgradu domény.</span><span class="sxs-lookup"><span data-stu-id="76650-134">In this case, we’d want toosee if we can figure out why hello Resource Manager had toopack hello replicas into hello Upgrade Domain.</span></span> <span data-ttu-id="76650-135">Obvykle balení je přechodný, protože hello uzly v hello jiných domén upgradu byly dolů, např.</span><span class="sxs-lookup"><span data-stu-id="76650-135">Usually packing is transient because hello nodes in hello other Upgrade Domains were down, for example.</span></span>

<span data-ttu-id="76650-136">Řekněme, že hello clusteru Resource Manager se pokouší tooplace některé služby, ale nejsou k dispozici žádné řešení, které pracují.</span><span class="sxs-lookup"><span data-stu-id="76650-136">Let’s say hello Cluster Resource Manager is trying tooplace some services, but there aren't any solutions that work.</span></span> <span data-ttu-id="76650-137">Pokud nemůže být umístěn služby, je obvykle pro jednu z následujících důvodů hello:</span><span class="sxs-lookup"><span data-stu-id="76650-137">When services can't be placed, it is usually for one of hello following reasons:</span></span>

1. <span data-ttu-id="76650-138">Některé přechodného stavu udělal, je možné tooplace této instance služby nebo repliky správně</span><span class="sxs-lookup"><span data-stu-id="76650-138">Some transient condition has made it impossible tooplace this service instance or replica correctly</span></span>
2. <span data-ttu-id="76650-139">požadavky na umístění Hello služby jsou unsatisfiable.</span><span class="sxs-lookup"><span data-stu-id="76650-139">hello service’s placement requirements are unsatisfiable.</span></span>

<span data-ttu-id="76650-140">V těchto případech sestav stavu z hello clusteru Resource Manager vám pomohou zjistit, proč nelze umístit hello služby.</span><span class="sxs-lookup"><span data-stu-id="76650-140">In these cases, health reports from hello Cluster Resource Manager help you determine why hello service can’t be placed.</span></span> <span data-ttu-id="76650-141">Říkáme tohoto procesu hello omezení odstranění pořadí.</span><span class="sxs-lookup"><span data-stu-id="76650-141">We call this process hello constraint elimination sequence.</span></span> <span data-ttu-id="76650-142">Během, provede hello systému hello nakonfigurovat omezení ovlivňující hello služby a záznamy se vyhnete.</span><span class="sxs-lookup"><span data-stu-id="76650-142">During it, hello system walks through hello configured constraints affecting hello service and records what they eliminate.</span></span> <span data-ttu-id="76650-143">Tímto způsobem v případě, že služby nejsou možné toobe umístěny, uvidíte uzlů, které byly odstraněny a proč.</span><span class="sxs-lookup"><span data-stu-id="76650-143">This way when services aren’t able toobe placed, you can see which nodes were eliminated and why.</span></span>

## <a name="constraint-types"></a><span data-ttu-id="76650-144">Omezení typů</span><span class="sxs-lookup"><span data-stu-id="76650-144">Constraint types</span></span>
<span data-ttu-id="76650-145">Budeme mluvit o každé z různých omezení hello v těchto sestavách stavu.</span><span class="sxs-lookup"><span data-stu-id="76650-145">Let’s talk about each of hello different constraints in these health reports.</span></span> <span data-ttu-id="76650-146">Omezení související toothese zprávy stavu se zobrazí, když repliky nemůže být umístěn.</span><span class="sxs-lookup"><span data-stu-id="76650-146">You will see health messages related toothese constraints when replicas can't be placed.</span></span>

* <span data-ttu-id="76650-147">**ReplicaExclusionStatic** a **ReplicaExclusionDynamic**: těchto omezení označuje, že řešení byla odmítnuta, protože dva objekty služby z hello stejného oddílu by toobe umístili na hello stejný uzel.</span><span class="sxs-lookup"><span data-stu-id="76650-147">**ReplicaExclusionStatic** and **ReplicaExclusionDynamic**: These constraints indicates that a solution was rejected because two service objects from hello same partition would have toobe placed on hello same node.</span></span> <span data-ttu-id="76650-148">Toto není povolená, protože pak selhání tohoto uzlu by zbytečně ovlivnit oddílu.</span><span class="sxs-lookup"><span data-stu-id="76650-148">This isn’t allowed because then failure of that node would overly impact that partition.</span></span> <span data-ttu-id="76650-149">ReplicaExclusionStatic a ReplicaExclusionDynamic jsou téměř stejné pravidlo a hello rozdíly nejsou důležité skutečnosti hello.</span><span class="sxs-lookup"><span data-stu-id="76650-149">ReplicaExclusionStatic and ReplicaExclusionDynamic are almost hello same rule and hello differences don't really matter.</span></span> <span data-ttu-id="76650-150">Pokud vidíte, že odstranění posloupnost omezení obsahující buď hello ReplicaExclusionStatic nebo ReplicaExclusionDynamic omezení, hello správce prostředků clusteru se domnívá, že není dostatek uzlů.</span><span class="sxs-lookup"><span data-stu-id="76650-150">If you are seeing a constraint elimination sequence containing either hello ReplicaExclusionStatic or ReplicaExclusionDynamic constraint, hello Cluster Resource Manager thinks that there aren’t enough nodes.</span></span> <span data-ttu-id="76650-151">To vyžaduje, zbývající řešení toouse tyto neplatné umísťováním, které nejsou povoleny.</span><span class="sxs-lookup"><span data-stu-id="76650-151">This requires remaining solutions toouse these invalid placements which are disallowed.</span></span> <span data-ttu-id="76650-152">Hello jiná omezení v pořadí hello bude obvykle Řekněte nám, proč uzly jsou se eliminovala ve nejdřív hello.</span><span class="sxs-lookup"><span data-stu-id="76650-152">hello other constraints in hello sequence will usually tell us why nodes are being eliminated in hello first place.</span></span>
* <span data-ttu-id="76650-153">**PlacementConstraint**: Pokud se zobrazí tato zpráva, znamená to, jsme vyloučit některé uzly, protože neodpovídají omezení umístění služby hello.</span><span class="sxs-lookup"><span data-stu-id="76650-153">**PlacementConstraint**: If you see this message, it means that we eliminated some nodes because they didn’t match hello service’s placement constraints.</span></span> <span data-ttu-id="76650-154">Jsme trasování se omezení umístění hello aktuálně nakonfigurovaný jako součást této zprávy.</span><span class="sxs-lookup"><span data-stu-id="76650-154">We trace out hello currently configured placement constraints as a part of this message.</span></span> <span data-ttu-id="76650-155">To je normální, pokud máte definované omezení umístění.</span><span class="sxs-lookup"><span data-stu-id="76650-155">This is normal if you have a placement constraint defined.</span></span> <span data-ttu-id="76650-156">Ale pokud omezení umístění je nesprávně příčinou příliš mnoho toobe uzly eliminovat Toto je, jak by si všimnete.</span><span class="sxs-lookup"><span data-stu-id="76650-156">However, if placement constraint is incorrectly causing too many nodes toobe eliminated this is how you would notice.</span></span>
* <span data-ttu-id="76650-157">**NodeCapacity**: Toto omezení znamená, že hello clusteru Resource Manager nemohl umístit hello repliky na hello uvedené uzly vzhledem k tomu, který by put přes kapacity.</span><span class="sxs-lookup"><span data-stu-id="76650-157">**NodeCapacity**: This constraint means that hello Cluster Resource Manager couldn’t place hello replicas on hello indicated nodes because that would put them over capacity.</span></span>
* <span data-ttu-id="76650-158">**Spřažení**: Toto omezení označuje, že jsme nemohl umístit hello repliky na uzlech hello vliv vzhledem k tomu, že by to způsobilo porušení omezení spřažení hello.</span><span class="sxs-lookup"><span data-stu-id="76650-158">**Affinity**: This constraint indicates that we couldn’t place hello replica on hello affected nodes since it would cause a violation of hello affinity constraint.</span></span> <span data-ttu-id="76650-159">Další informace o spřažení je v [v tomto článku](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span><span class="sxs-lookup"><span data-stu-id="76650-159">More information on affinity is in [this article](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span></span>
* <span data-ttu-id="76650-160">**FaultDomain** a **UpgradeDomain**: Toto omezení eliminuje uzly, pokud uvádění hello repliky na hello uvedené uzly by způsobilo balení v konkrétní chyby nebo doméně pro upgrade.</span><span class="sxs-lookup"><span data-stu-id="76650-160">**FaultDomain** and **UpgradeDomain**: This constraint eliminates nodes if placing hello replica on hello indicated nodes would cause packing in a particular fault or upgrade domain.</span></span> <span data-ttu-id="76650-161">Několik příkladů hovoříte o toto omezení jsou uvedeny v tématu hello na [selhání a upgradu omezení domény a výsledné chování](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="76650-161">Several examples discussing this constraint are presented in hello topic on [fault and upgrade domain constraints and resulting behavior](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
* <span data-ttu-id="76650-162">**PreferredLocation**: byste neměli vidět normálně toto omezení, protože je ve výchozím nastavení spustí jako optimalizace odstranění uzlů z hello řešení.</span><span class="sxs-lookup"><span data-stu-id="76650-162">**PreferredLocation**: You shouldn’t normally see this constraint removing nodes from hello solution since it runs as an optimization by default.</span></span> <span data-ttu-id="76650-163">Hello upřednostňovaná, že omezení umístění je také během upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-163">hello preferred location constraint is also present during upgrades.</span></span> <span data-ttu-id="76650-164">Během upgradu je služby používané toomove back se toowhere, které byly při spuštění upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="76650-164">During upgrade it is used toomove services back toowhere they were when hello upgrade started.</span></span>

## <a name="blocklisting-nodes"></a><span data-ttu-id="76650-165">Blocklisting uzly</span><span class="sxs-lookup"><span data-stu-id="76650-165">Blocklisting Nodes</span></span>
<span data-ttu-id="76650-166">Jiný správce prostředků clusteru sestav stavu zprávy hello je, když jsou blocklisted uzly.</span><span class="sxs-lookup"><span data-stu-id="76650-166">Another health message hello Cluster Resource Manager reports is when nodes are blocklisted.</span></span> <span data-ttu-id="76650-167">Blocklisting si můžete představit jako dočasné omezení, která je automaticky použita pro vás.</span><span class="sxs-lookup"><span data-stu-id="76650-167">You can think of blocklisting as a temporary constraint that is automatically applied for you.</span></span> <span data-ttu-id="76650-168">Uzly získat blocklisted opakovaných neúspěšných dojde při spuštění instance tohoto typu služby.</span><span class="sxs-lookup"><span data-stu-id="76650-168">Nodes get blocklisted when they experience repeated failures when launching instances of that service type.</span></span> <span data-ttu-id="76650-169">Uzly jsou blocklisted na základě typu za služby.</span><span class="sxs-lookup"><span data-stu-id="76650-169">Nodes are blocklisted on a per-service-type basis.</span></span> <span data-ttu-id="76650-170">Uzlem může být blocklisted pro typ jedna služba, ale ne jiné.</span><span class="sxs-lookup"><span data-stu-id="76650-170">A node may be blocklisted for one service type but not another.</span></span> 

<span data-ttu-id="76650-171">Zobrazí se nové často během vývoje blocklisting: Některé chyby způsobí, že vaše toocrash hostitele služby při spuštění.</span><span class="sxs-lookup"><span data-stu-id="76650-171">You'll see blocklisting kick in often during development: some bug causes your service host toocrash on startup.</span></span> <span data-ttu-id="76650-172">Service Fabric pokusí hostitele služby hello toocreate několikrát, a vyskytuje opakovaně hello selhání.</span><span class="sxs-lookup"><span data-stu-id="76650-172">Service Fabric tries toocreate hello service host a few times, and hello failure keeps occurring.</span></span> <span data-ttu-id="76650-173">Po několika pokusech hello uzlu získá blocklisted a hello správce prostředků clusteru pokusí toocreate hello jinde služby.</span><span class="sxs-lookup"><span data-stu-id="76650-173">After a few attempts, hello node gets blocklisted, and hello Cluster Resource Manager will try toocreate hello service elsewhere.</span></span> <span data-ttu-id="76650-174">Pokud ve více uzlech udržuje nedošlo k této chybě, je možné všechny hello platný uzly v clusteru end hello se zablokuje.</span><span class="sxs-lookup"><span data-stu-id="76650-174">If that failure keeps happening on multiple nodes, it's possible that all of hello valid nodes in hello cluster end up blocked.</span></span> <span data-ttu-id="76650-175">Blocklisting rovněž můžete odebrat mnoho uzly, že není dostatek úspěšně spustit hello služby toomeet hello potřeby škálování.</span><span class="sxs-lookup"><span data-stu-id="76650-175">Blocklisting cna also remove so many nodes that not enough can successfully launch hello service toomeet hello desired scale.</span></span> <span data-ttu-id="76650-176">Obvykle se zobrazí další chyby nebo upozornění hello správce prostředků clusteru označující, zda je služba hello níže hello požadované repliky nebo počet instancí, stejně jako zprávy stavu udávající neúspěch jaké hello je vznikají toohello blocklisting na prvním místě hello.</span><span class="sxs-lookup"><span data-stu-id="76650-176">You'll typically see additional errors or warnings from hello Cluster Resource Manager indicating that hello service is below hello desired replica or instance count, as well as health messages indicating what hello failure is that's leading toohello blocklisting in hello first place.</span></span>

<span data-ttu-id="76650-177">Blocklisting není trvalé podmínce.</span><span class="sxs-lookup"><span data-stu-id="76650-177">Blocklisting is not a permanent condition.</span></span> <span data-ttu-id="76650-178">Po několika minutách hello uzel je odebrán z hello blocklist a Service Fabric může znovu aktivujte hello služeb v tomto uzlu.</span><span class="sxs-lookup"><span data-stu-id="76650-178">After a few minutes, hello node is removed from hello blocklist and Service Fabric may activate hello services on that node again.</span></span> <span data-ttu-id="76650-179">Pokud služby pokračovat toofail, hello uzel je blocklisted pro daný typ služby znovu.</span><span class="sxs-lookup"><span data-stu-id="76650-179">If services continue toofail, hello node is blocklisted for that service type again.</span></span> 

### <a name="constraint-priorities"></a><span data-ttu-id="76650-180">Omezení priority</span><span class="sxs-lookup"><span data-stu-id="76650-180">Constraint priorities</span></span>

> [!WARNING]
> <span data-ttu-id="76650-181">Změna omezení priority se nedoporučuje a může mít významný negativní vliv na clusteru.</span><span class="sxs-lookup"><span data-stu-id="76650-181">Changing constraint priorities is not recommended and may have significant adverse effects on your cluster.</span></span> <span data-ttu-id="76650-182">Hello níže uvedené informace se poskytuje odkaz hello výchozí omezení priority a jejich chování.</span><span class="sxs-lookup"><span data-stu-id="76650-182">hello below information is provided for reference of hello default constraint priorities and their behavior.</span></span> 
>

<span data-ttu-id="76650-183">Se všemi těchto omezení vám může mít byla myslím "Hey – myslím, že jsou omezení domény selhání hello je třeba mít v systému.</span><span class="sxs-lookup"><span data-stu-id="76650-183">With all of these constraints, you may have been thinking “Hey – I think that fault domain constraints are hello most important thing in my system.</span></span> <span data-ttu-id="76650-184">V pořadí tooensure hello omezení domény selhání není došlo k porušení, jsem ochoten tooviolate jiná omezení. "</span><span class="sxs-lookup"><span data-stu-id="76650-184">In order tooensure hello fault domain constraint isn't violated, I’m willing tooviolate other constraints.”</span></span>

<span data-ttu-id="76650-185">Omezení lze konfigurovat různých úrovní priority.</span><span class="sxs-lookup"><span data-stu-id="76650-185">Constraints can be configured with different priority levels.</span></span> <span data-ttu-id="76650-186">Jsou to:</span><span class="sxs-lookup"><span data-stu-id="76650-186">These are:</span></span>

   - <span data-ttu-id="76650-187">"pevné" (0)</span><span class="sxs-lookup"><span data-stu-id="76650-187">“hard” (0)</span></span>
   - <span data-ttu-id="76650-188">"soft" (1)</span><span class="sxs-lookup"><span data-stu-id="76650-188">“soft” (1)</span></span>
   - <span data-ttu-id="76650-189">"optimalizace" (2)</span><span class="sxs-lookup"><span data-stu-id="76650-189">“optimization” (2)</span></span>
   - <span data-ttu-id="76650-190">"off" (-1).</span><span class="sxs-lookup"><span data-stu-id="76650-190">“off” (-1).</span></span> 
   
<span data-ttu-id="76650-191">Většinu hello omezení jsou ve výchozím nastavení nakonfigurované jako pevný omezení.</span><span class="sxs-lookup"><span data-stu-id="76650-191">Most of hello constraints are configured as hard constraints by default.</span></span>

<span data-ttu-id="76650-192">Změna hello prioritu omezení neobvyklé.</span><span class="sxs-lookup"><span data-stu-id="76650-192">Changing hello priority of constraints is uncommon.</span></span> <span data-ttu-id="76650-193">Byly časy kde priority omezení potřeby toochange, obvykle toowork kolem některé chyb nebo chování, které vliv hello prostředí.</span><span class="sxs-lookup"><span data-stu-id="76650-193">There have been times where constraint priorities needed toochange, usually toowork around some other bug or behavior that was impacting hello environment.</span></span> <span data-ttu-id="76650-194">Obecně velmi dobře fungovala hello flexibilitu hello omezení s prioritou infrastruktury, ale nebyla často potřeba.</span><span class="sxs-lookup"><span data-stu-id="76650-194">Generally hello flexibility of hello constraint priority infrastructure has worked very well, but it isn't needed often.</span></span> <span data-ttu-id="76650-195">Většina hello času, vše, co je umístěn na jejich výchozí priority.</span><span class="sxs-lookup"><span data-stu-id="76650-195">Most of hello time everything sits at their default priorities.</span></span> 

<span data-ttu-id="76650-196">úrovně priority Hello nemáte znamenají, že dané omezení _bude_ být došlo k porušení, ani se vždy splnit.</span><span class="sxs-lookup"><span data-stu-id="76650-196">hello priority levels don't mean that a given constraint _will_ be violated, nor that it will always be met.</span></span> <span data-ttu-id="76650-197">Omezení priority definovat pořadí, ve kterém jsou vynucena omezení.</span><span class="sxs-lookup"><span data-stu-id="76650-197">Constraint priorities define an order in which constraints are enforced.</span></span> <span data-ttu-id="76650-198">Priority definovat hello kompromisy případě, že je možné toosatisfy všechna omezení.</span><span class="sxs-lookup"><span data-stu-id="76650-198">Priorities define hello tradeoffs when it is impossible toosatisfy all constraints.</span></span> <span data-ttu-id="76650-199">Všechna omezení hello obvykle může obsloužit, pokud má něco jinak se děje v prostředí hello.</span><span class="sxs-lookup"><span data-stu-id="76650-199">Usually all hello constraints can be satisfied unless there's something else going on in hello environment.</span></span> <span data-ttu-id="76650-200">Příklady scénářů, které povede tooconstraint porušení jsou konfliktní omezení, nebo velkého počtu souběžných selhání.</span><span class="sxs-lookup"><span data-stu-id="76650-200">Some examples of scenarios that will lead tooconstraint violations are conflicting constraints, or large numbers of concurrent failures.</span></span>

<span data-ttu-id="76650-201">V situacích, rozšířené můžete změnit hello omezení priority.</span><span class="sxs-lookup"><span data-stu-id="76650-201">In advanced situations, you can change hello constraint priorities.</span></span> <span data-ttu-id="76650-202">Řekněme například, chtěli tooensure spřažení by porušila vždy v když vydá nezbytné toosolve uzlu kapacity.</span><span class="sxs-lookup"><span data-stu-id="76650-202">For example, say you wanted tooensure that affinity would always be violated when necessary toosolve node capacity issues.</span></span> <span data-ttu-id="76650-203">tooachieve, můžete nastavit prioritu hello hello spřažení omezení příliš "soft" (1) a nechte hello kapacity nastavené omezení příliš "pevný" (0).</span><span class="sxs-lookup"><span data-stu-id="76650-203">tooachieve this, you could set hello priority of hello affinity constraint too“soft” (1) and leave hello capacity constraint set too“hard” (0).</span></span>

<span data-ttu-id="76650-204">Hello výchozí hodnoty priority pro různé omezení hello jsou určené v hello následující konfigurace:</span><span class="sxs-lookup"><span data-stu-id="76650-204">hello default priority values for hello different constraints are specified in hello following config:</span></span>

<span data-ttu-id="76650-205">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="76650-205">ClusterManifest.xml</span></span>

```xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PlacementConstraintPriority" Value="0" />
            <Parameter Name="CapacityConstraintPriority" Value="0" />
            <Parameter Name="AffinityConstraintPriority" Value="0" />
            <Parameter Name="FaultDomainConstraintPriority" Value="0" />
            <Parameter Name="UpgradeDomainConstraintPriority" Value="1" />
            <Parameter Name="PreferredLocationConstraintPriority" Value="2" />
        </Section>
```

<span data-ttu-id="76650-206">pomocí souboru ClusterConfig.json pro samostatné nasazení nebo Template.json pro Azure hostované clustery:</span><span class="sxs-lookup"><span data-stu-id="76650-206">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PlacementConstraintPriority",
          "value": "0"
      },
      {
          "name": "CapacityConstraintPriority",
          "value": "0"
      },
      {
          "name": "AffinityConstraintPriority",
          "value": "0"
      },
      {
          "name": "FaultDomainConstraintPriority",
          "value": "0"
      },
      {
          "name": "UpgradeDomainConstraintPriority",
          "value": "1"
      },
      {
          "name": "PreferredLocationConstraintPriority",
          "value": "2"
      }
    ]
  }
]
```

## <a name="fault-domain-and-upgrade-domain-constraints"></a><span data-ttu-id="76650-207">Omezení domény selhání domény a upgrade</span><span class="sxs-lookup"><span data-stu-id="76650-207">Fault domain and upgrade domain constraints</span></span>
<span data-ttu-id="76650-208">Hello správce prostředků clusteru chce tookeep služby šíření mezi doménách selhání a upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-208">hello Cluster Resource Manager wants tookeep services spread out among fault and upgrade domains.</span></span> <span data-ttu-id="76650-209">Modely to jako omezení uvnitř modul hello clusteru správce prostředků.</span><span class="sxs-lookup"><span data-stu-id="76650-209">It models this as a constraint inside hello Cluster Resource Manager’s engine.</span></span> <span data-ttu-id="76650-210">Další informace o tom, jak se používají a jejich konkrétní chování, projděte si článek hello na [konfigurace clusteru](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span><span class="sxs-lookup"><span data-stu-id="76650-210">For more information on how they are used and their specific behavior, check out hello article on [cluster configuration](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span></span>

<span data-ttu-id="76650-211">Hello správce prostředků clusteru může být nutné toopack několik repliky do upgradu domény v pořadí toodeal s upgrady, chyby nebo další narušení omezení.</span><span class="sxs-lookup"><span data-stu-id="76650-211">hello Cluster Resource Manager may need toopack a couple replicas into an upgrade domain in order toodeal with upgrades, failures, or other constraint violations.</span></span> <span data-ttu-id="76650-212">Balení do domén selhání nebo upgradu obvykle dochází jenom v případě, že existuje několik selhání nebo dalších změn v systému hello brání správné umístění.</span><span class="sxs-lookup"><span data-stu-id="76650-212">Packing into fault or upgrade domains normally happens only when there are several failures or other churn in hello system preventing correct placement.</span></span> <span data-ttu-id="76650-213">Pokud chcete tooprevent balení i v těchto situacích, můžete využít hello `RequireDomainDistribution` [umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="76650-213">If you wish tooprevent packing even during these situations, you can utilize hello `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="76650-214">Všimněte si, že to může mít vliv na dostupnost služeb a spolehlivost jako vedlejším účinkem proto pečlivě zvažte.</span><span class="sxs-lookup"><span data-stu-id="76650-214">Note that this may affect service availability and reliability as a side effect, so consider it carefully.</span></span>

<span data-ttu-id="76650-215">Pokud hello prostředí je správně nakonfigurována, všechna omezení jsou dodržení i během upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-215">If hello environment is configured correctly, all constraints are fully respected, even during upgrades.</span></span> <span data-ttu-id="76650-216">klíče věc Hello je tento Cluster Resource Manager sleduje pro vaše omezení hello.</span><span class="sxs-lookup"><span data-stu-id="76650-216">hello key thing is that hello Cluster Resource Manager is watching out for your constraints.</span></span> <span data-ttu-id="76650-217">Když zjistí narušení okamžitě sestavy ji a pokusí toocorrect hello problém.</span><span class="sxs-lookup"><span data-stu-id="76650-217">When it detects a violation it immediately reports it and tries toocorrect hello issue.</span></span>

## <a name="hello-preferred-location-constraint"></a><span data-ttu-id="76650-218">omezení umístění Hello preferované</span><span class="sxs-lookup"><span data-stu-id="76650-218">hello preferred location constraint</span></span>
<span data-ttu-id="76650-219">Hello PreferredLocation omezení je trochu liší, protože má dva různé používá.</span><span class="sxs-lookup"><span data-stu-id="76650-219">hello PreferredLocation constraint is a little different, as it has two different uses.</span></span> <span data-ttu-id="76650-220">Jedno použití tohoto omezení je během upgradu aplikace.</span><span class="sxs-lookup"><span data-stu-id="76650-220">One use of this constraint is during application upgrades.</span></span> <span data-ttu-id="76650-221">Hello clusteru Resource Manager automaticky spravuje toto omezení při upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-221">hello Cluster Resource Manager automatically manages this constraint during upgrades.</span></span> <span data-ttu-id="76650-222">Je použité tooensure který po upgradu se dokončí, vraťte repliky tootheir počáteční umístění.</span><span class="sxs-lookup"><span data-stu-id="76650-222">It is used tooensure that when upgrades are complete that replicas return tootheir initial locations.</span></span> <span data-ttu-id="76650-223">Hello jiné použití hello PreferredLocation omezení je pro hello [ `PreferredPrimaryDomain` umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span><span class="sxs-lookup"><span data-stu-id="76650-223">hello other use of hello PreferredLocation constraint is for hello [`PreferredPrimaryDomain` placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span></span> <span data-ttu-id="76650-224">Obě tyto optimalizace a proto je hello PreferredLocation omezení hello pouze omezení nastavit také "Optimalizace" ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="76650-224">Both of these are optimizations, and hence hello PreferredLocation constraint is hello only constraint set too"Optimization" by default.</span></span>

## <a name="upgrades"></a><span data-ttu-id="76650-225">Upgrady</span><span class="sxs-lookup"><span data-stu-id="76650-225">Upgrades</span></span>
<span data-ttu-id="76650-226">Hello správce prostředků clusteru také pomáhá při aplikace a upgrady clusteru, za které má dvě úlohy:</span><span class="sxs-lookup"><span data-stu-id="76650-226">hello Cluster Resource Manager also helps during application and cluster upgrades, during which it has two jobs:</span></span>

* <span data-ttu-id="76650-227">Ujistěte se, že nejsou ohrožená hello pravidla hello clusteru</span><span class="sxs-lookup"><span data-stu-id="76650-227">ensure that hello rules of hello cluster are not compromised</span></span>
* <span data-ttu-id="76650-228">Zkuste upgrade přejděte hello toohelp bez problémů</span><span class="sxs-lookup"><span data-stu-id="76650-228">try toohelp hello upgrade go smoothly</span></span>

### <a name="keep-enforcing-hello-rules"></a><span data-ttu-id="76650-229">Zachovat vynucování pravidel hello</span><span class="sxs-lookup"><span data-stu-id="76650-229">Keep enforcing hello rules</span></span>
<span data-ttu-id="76650-230">Hello hlavní věc toobe vědět, je, že pravidla hello – striktní omezení pro hello jako omezení umístění a kapacity - prosazují stále během upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-230">hello main thing toobe aware of is that hello rules – hello strict constraints like placement constraints and capacities - are still enforced during upgrades.</span></span> <span data-ttu-id="76650-231">Omezení umístění zkontrolujte, zda úlohy pouze spustili, kde mohou, i během upgradu.</span><span class="sxs-lookup"><span data-stu-id="76650-231">Placement constraints ensure that your workloads only run where they are allowed to, even during upgrades.</span></span> <span data-ttu-id="76650-232">Když jsou vysoce omezené služby, upgrade může trvat déle.</span><span class="sxs-lookup"><span data-stu-id="76650-232">When services are highly constrained, upgrades can take longer.</span></span> <span data-ttu-id="76650-233">Pokud je služba hello nebo hello uzlu, který je spuštěn na snížila o aktualizaci, může být několik možností pro kde můžete přejít.</span><span class="sxs-lookup"><span data-stu-id="76650-233">When hello service or hello node it is running on is brought down for an update there may be few options for where it can go.</span></span>

### <a name="smart-replacements"></a><span data-ttu-id="76650-234">Inteligentní nahrazení</span><span class="sxs-lookup"><span data-stu-id="76650-234">Smart replacements</span></span>
<span data-ttu-id="76650-235">Při spuštění upgradu hello Resource Manager pořídí snímek aktuální uspořádání hello hello clusteru.</span><span class="sxs-lookup"><span data-stu-id="76650-235">When an upgrade starts, hello Resource Manager takes a snapshot of hello current arrangement of hello cluster.</span></span> <span data-ttu-id="76650-236">Protože každá doména upgradu se dokončí, pokusí tooreturn hello služby, které existovaly v původní uspořádání tohoto upgradu domény tootheir.</span><span class="sxs-lookup"><span data-stu-id="76650-236">As each Upgrade Domain completes, it attempts tooreturn hello services that were in that Upgrade Domain tootheir original arrangement.</span></span> <span data-ttu-id="76650-237">Tímto způsobem existují maximálně dvě přechody pro službu během upgradu hello.</span><span class="sxs-lookup"><span data-stu-id="76650-237">This way there are at most two transitions for a service during hello upgrade.</span></span> <span data-ttu-id="76650-238">Neexistuje jeden přesunout na uzlu hello vliv a jeden přesunout zpět.</span><span class="sxs-lookup"><span data-stu-id="76650-238">There is one move out of hello affected node and one move back in.</span></span> <span data-ttu-id="76650-239">Vrácení toohow hello pro cluster nebo služby, který byl předtím, než hello upgrade také zajistí hello upgrade nebude mít vliv na rozložení hello hello clusteru.</span><span class="sxs-lookup"><span data-stu-id="76650-239">Returning hello cluster or service toohow it was before hello upgrade also ensures hello upgrade doesn’t impact hello layout of hello cluster.</span></span> 

### <a name="reduced-churn"></a><span data-ttu-id="76650-240">Snížené změn</span><span class="sxs-lookup"><span data-stu-id="76650-240">Reduced churn</span></span>
<span data-ttu-id="76650-241">Jiné z věcí, které se stane při upgradech je tento hello vypne Správce prostředků clusteru služby Vyrovnávání.</span><span class="sxs-lookup"><span data-stu-id="76650-241">Another thing that happens during upgrades is that hello Cluster Resource Manager turns off balancing.</span></span> <span data-ttu-id="76650-242">Brání vyrovnávání zabraňuje zbytečným reakce toohello upgradu, samostatně, jako přesun služby do uzlů, které byly vyprázdněny pro hello upgrade.</span><span class="sxs-lookup"><span data-stu-id="76650-242">Preventing balancing prevents unnecessary reactions toohello upgrade itself, like moving services into nodes that were emptied for hello upgrade.</span></span> <span data-ttu-id="76650-243">Je-li upgrade hello dotyčném upgrade clusteru, není během upgradu hello vyvážit hello celý cluster.</span><span class="sxs-lookup"><span data-stu-id="76650-243">If hello upgrade in question is a Cluster upgrade, then hello entire cluster is not balanced during hello upgrade.</span></span> <span data-ttu-id="76650-244">Omezení kontroly zůstane aktivní, pouze přesun podle proaktivní vyrovnávání hello metrik je zakázána.</span><span class="sxs-lookup"><span data-stu-id="76650-244">Constraint checks stay active, only movement based on hello proactive balancing of metrics is disabled.</span></span>

### <a name="buffered-capacity--upgrade"></a><span data-ttu-id="76650-245">Ve vyrovnávací paměti kapacity & upgradu</span><span class="sxs-lookup"><span data-stu-id="76650-245">Buffered Capacity & Upgrade</span></span>
<span data-ttu-id="76650-246">Obecně chcete hello upgradu toocomplete i v případě, že hello cluster je omezené nebo ukončení toofull.</span><span class="sxs-lookup"><span data-stu-id="76650-246">Generally you want hello upgrade toocomplete even if hello cluster is constrained or close toofull.</span></span> <span data-ttu-id="76650-247">Správa hello kapacity hello clusteru je důležitější-při upgradech než obvykle.</span><span class="sxs-lookup"><span data-stu-id="76650-247">Managing hello capacity of hello cluster is even more important during upgrades than usual.</span></span> <span data-ttu-id="76650-248">Počet domén upgradu mezi 5 a 20 procent kapacity v závislosti na hello je potřeba migrovat jako hello upgradu vrátí prostřednictvím hello clusteru.</span><span class="sxs-lookup"><span data-stu-id="76650-248">Depending on hello number of upgrade domains, between 5 and 20 percent of capacity must be migrated as hello upgrade rolls through hello cluster.</span></span> <span data-ttu-id="76650-249">Které pracují má toogo místo.</span><span class="sxs-lookup"><span data-stu-id="76650-249">That work has toogo somewhere.</span></span> <span data-ttu-id="76650-250">Kde to je hello představu o [uložená do vyrovnávací paměti kapacity](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) je užitečné.</span><span class="sxs-lookup"><span data-stu-id="76650-250">This is where hello notion of [buffered capacities](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) is useful.</span></span> <span data-ttu-id="76650-251">Kapacita ve vyrovnávací paměti je dodržena při běžném provozu.</span><span class="sxs-lookup"><span data-stu-id="76650-251">Buffered capacity is respected during normal operation.</span></span> <span data-ttu-id="76650-252">Hello správce prostředků clusteru může během upgradu v případě potřeby zadejte uzly až tootheir celkové kapacity (využívání hello vyrovnávací paměti).</span><span class="sxs-lookup"><span data-stu-id="76650-252">hello Cluster Resource Manager may fill nodes up tootheir total capacity (consuming hello buffer) during upgrades if necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="76650-253">Další kroky</span><span class="sxs-lookup"><span data-stu-id="76650-253">Next steps</span></span>
* <span data-ttu-id="76650-254">Začít od začátku hello a [získat Úvod toohello správce prostředků clusteru Service Fabric](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="76650-254">Start from hello beginning and [get an Introduction toohello Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>

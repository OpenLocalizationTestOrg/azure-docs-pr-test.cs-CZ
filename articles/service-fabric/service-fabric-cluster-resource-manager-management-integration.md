---
title: "Správce prostředků clusteru Service Fabric - integraci správy | Microsoft Docs"
description: "Přehled integrace body mezi správce prostředků clusteru a správu prostředků infrastruktury služby."
services: service-fabric
documentationcenter: .net
author: masnider
manager: timlt
editor: 
ms.assetid: 956cd0b8-b6e3-4436-a224-8766320e8cd7
ms.service: Service-Fabric
ms.devlang: dotnet
ms.topic: article
ms.tgt_pltfrm: NA
ms.workload: NA
ms.date: 08/18/2017
ms.author: masnider
ms.openlocfilehash: 9601e758e1033b4e2f86c2c230d4f49479fe6f45
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="cluster-resource-manager-integration-with-service-fabric-cluster-management"></a><span data-ttu-id="0a713-103">Integrace manager prostředek clusteru s Správa clusteru Service Fabric</span><span class="sxs-lookup"><span data-stu-id="0a713-103">Cluster resource manager integration with Service Fabric cluster management</span></span>
<span data-ttu-id="0a713-104">Správce prostředků clusteru Service Fabric není disk upgradů Service Fabric, ale je zahrnuta.</span><span class="sxs-lookup"><span data-stu-id="0a713-104">The Service Fabric Cluster Resource Manager doesn't drive upgrades in Service Fabric, but it is involved.</span></span> <span data-ttu-id="0a713-105">První způsob, jakým clusteru Resource Manager pomůže se správou je sledování požadovaný stav clusteru a služby je uvnitř.</span><span class="sxs-lookup"><span data-stu-id="0a713-105">The first way that the Cluster Resource Manager helps with management is by tracking the desired state of the cluster and the services inside it.</span></span> <span data-ttu-id="0a713-106">Správce prostředků clusteru rozešle sestav stavu, když ji nemůžete uvést do požadovanou konfiguraci clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-106">The Cluster Resource Manager sends out health reports when it cannot put the cluster into the desired configuration.</span></span> <span data-ttu-id="0a713-107">Například pokud není dostatečná kapacita správce prostředků clusteru rozešle stavu upozornění a chyby naznačující problém.</span><span class="sxs-lookup"><span data-stu-id="0a713-107">For example, if there is insufficient capacity the Cluster Resource Manager sends out health warnings and errors indicating the problem.</span></span> <span data-ttu-id="0a713-108">Další část integrace souvisí se fungování upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-108">Another piece of integration has to do with how upgrades work.</span></span> <span data-ttu-id="0a713-109">Správce prostředků clusteru mění své chování mírně během upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-109">The Cluster Resource Manager alters its behavior slightly during upgrades.</span></span>  

## <a name="health-integration"></a><span data-ttu-id="0a713-110">Integrace stavu</span><span class="sxs-lookup"><span data-stu-id="0a713-110">Health integration</span></span>
<span data-ttu-id="0a713-111">Správce prostředků clusteru neustále sleduje pravidla, která jste definovali k umístění vaší služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-111">The Cluster Resource Manager constantly tracks the rules you have defined for placing your services.</span></span> <span data-ttu-id="0a713-112">Je také sleduje zbývající kapacity pro jednotlivé metriky na uzlech a v clusteru a v clusteru jako celek.</span><span class="sxs-lookup"><span data-stu-id="0a713-112">It also tracks the remaining capacity for each metric on the nodes and in the cluster and in the cluster as a whole.</span></span> <span data-ttu-id="0a713-113">Pokud ji nemůže splnit tato pravidla nebo pokud není dostatečná kapacita, jsou vydávány stav varování a chyby.</span><span class="sxs-lookup"><span data-stu-id="0a713-113">If it can't satisfy those rules or if there is insufficient capacity, health warnings and errors are emitted.</span></span> <span data-ttu-id="0a713-114">Například pokud uzel je nad kapacitu a správce prostředků clusteru se pokusí opravit situaci přesunutím služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-114">For example, if a node is over capacity and the Cluster Resource Manager will try to fix the situation by moving services.</span></span> <span data-ttu-id="0a713-115">Pokud nemůže ji napravit situaci vysílá stavu varování, uzel, který je přes kapacity a pro které metriky.</span><span class="sxs-lookup"><span data-stu-id="0a713-115">If it can't correct the situation it emits a health warning indicating which node is over capacity, and for which metrics.</span></span>

<span data-ttu-id="0a713-116">Dalším příkladem upozornění stavu Správce prostředků je porušení omezení umístění.</span><span class="sxs-lookup"><span data-stu-id="0a713-116">Another example of the Resource Manager's health warnings is violations of placement constraints.</span></span> <span data-ttu-id="0a713-117">Například, pokud jste definovali omezení umístění (například `“NodeColor == Blue”`) a Resource Manager zjistí porušení omezení, se vydá upozornění stavu.</span><span class="sxs-lookup"><span data-stu-id="0a713-117">For example, if you have defined a placement constraint (such as `“NodeColor == Blue”`) and the Resource Manager detects a violation of that constraint, it emits a health warning.</span></span> <span data-ttu-id="0a713-118">To platí pro vlastní omezení a výchozí omezení (např. omezení domény selhání a upgradu domény).</span><span class="sxs-lookup"><span data-stu-id="0a713-118">This is true for custom constraints and the default constraints (like the Fault Domain and Upgrade Domain constraints).</span></span>

<span data-ttu-id="0a713-119">Tady je příklad jeden takové zprávy stavu.</span><span class="sxs-lookup"><span data-stu-id="0a713-119">Here’s an example of one such health report.</span></span> <span data-ttu-id="0a713-120">V takovém případě je sestava stavu pro jeden z oddílů systému služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-120">In this case, the health report is for one of the system service’s partitions.</span></span> <span data-ttu-id="0a713-121">Zpráva stav označuje, že repliky tohoto oddílu jsou dočasně zabalit do příliš málo upgradu domén.</span><span class="sxs-lookup"><span data-stu-id="0a713-121">The health message indicates the replicas of that partition are temporarily packed into too few Upgrade Domains.</span></span>

```posh
PS C:\Users\User > Get-WindowsFabricPartitionHealth -PartitionId '00000000-0000-0000-0000-000000000001'


PartitionId           : 00000000-0000-0000-0000-000000000001
AggregatedHealthState : Warning
UnhealthyEvaluations  :
                        Unhealthy event: SourceId='System.PLB', Property='ReplicaConstraintViolation_UpgradeDomain', HealthState='Warning', ConsiderWarningAsError=false.

ReplicaHealthStates   :
                        ReplicaId             : 130766528804733380
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577821
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528854889931
                        AggregatedHealthState : Ok

                        ReplicaId             : 130766528804577822
                        AggregatedHealthState : Ok

                        ReplicaId             : 130837073190680024
                        AggregatedHealthState : Ok

HealthEvents          :
                        SourceId              : System.PLB
                        Property              : ReplicaConstraintViolation_UpgradeDomain
                        HealthState           : Warning
                        SequenceNumber        : 130837100116930204
                        SentAt                : 8/10/2015 7:53:31 PM
                        ReceivedAt            : 8/10/2015 7:53:33 PM
                        TTL                   : 00:01:05
                        Description           : The Load Balancer has detected a Constraint Violation for this Replica: fabric:/System/FailoverManagerService Secondary Partition 00000000-0000-0000-0000-000000000001 is
                        violating the Constraint: UpgradeDomain Details: UpgradeDomain ID -- 4, Replica on NodeName -- Node.8 Currently Upgrading -- false Distribution Policy -- Packing
                        RemoveWhenExpired     : True
                        IsExpired             : False
                        Transitions           : Ok->Warning = 8/10/2015 7:13:02 PM, LastError = 1/1/0001 12:00:00 AM
```

<span data-ttu-id="0a713-122">Tady je co tato zpráva stavu nám oznamuje je:</span><span class="sxs-lookup"><span data-stu-id="0a713-122">Here's what this health message is telling us is:</span></span>

1. <span data-ttu-id="0a713-123">Všechny repliky sami jsou v pořádku: každá z nich má AggregatedHealthState: Ok</span><span class="sxs-lookup"><span data-stu-id="0a713-123">All the replicas themselves are healthy: Each has AggregatedHealthState : Ok</span></span>
2. <span data-ttu-id="0a713-124">Je aktuálně probíhá došlo k porušení omezení distribuční upgradu domény.</span><span class="sxs-lookup"><span data-stu-id="0a713-124">The Upgrade Domain distribution constraint is currently being violated.</span></span> <span data-ttu-id="0a713-125">To znamená, že konkrétní upgradu domény má další repliky z tohoto oddílu, než by měl.</span><span class="sxs-lookup"><span data-stu-id="0a713-125">This means a particular Upgrade Domain has more replicas from this partition than it should.</span></span>
3. <span data-ttu-id="0a713-126">Uzel obsahuje repliku, která způsobila porušení zásady.</span><span class="sxs-lookup"><span data-stu-id="0a713-126">Which node contains the replica causing the violation.</span></span> <span data-ttu-id="0a713-127">V takovém případě je uzel s názvem "Node.8"</span><span class="sxs-lookup"><span data-stu-id="0a713-127">In this case it's the node with the name "Node.8"</span></span>
4. <span data-ttu-id="0a713-128">Jestli upgradu se právě děje pro toto oddílu ("aktuálně upgrade--false")</span><span class="sxs-lookup"><span data-stu-id="0a713-128">Whether an upgrade is currently happening for this partition ("Currently Upgrading -- false")</span></span>
5. <span data-ttu-id="0a713-129">Zásady distribuce pro tuto službu: "Distribuční zásady – okolních".</span><span class="sxs-lookup"><span data-stu-id="0a713-129">The distribution policy for this service: "Distribution Policy -- Packing".</span></span> <span data-ttu-id="0a713-130">Toto se řídí `RequireDomainDistribution` [umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="0a713-130">This is governed by the `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="0a713-131">"Balení" znamená, že v tomto případě DomainDistribution byla _není_ potřeby, abychom věděli, že umístění zásady nebyl zadán pro tuto službu.</span><span class="sxs-lookup"><span data-stu-id="0a713-131">"Packing" indicates that in this case DomainDistribution was _not_ required, so we know that placement policy was not specified for this service.</span></span> 
6. <span data-ttu-id="0a713-132">Když se stalo sestavu - 8/10/2015 19:13:02: 00</span><span class="sxs-lookup"><span data-stu-id="0a713-132">When the report happened - 8/10/2015 7:13:02 PM</span></span>

<span data-ttu-id="0a713-133">Údaje, jako tento zajišťuje výstrahy, které aktivují v produkčním prostředí, který vám oznamuje něco nepovede a slouží ke zjišťování a zastaví chybný upgrady.</span><span class="sxs-lookup"><span data-stu-id="0a713-133">Information like this powers alerts that fire in production to let you know something has gone wrong and is also used to detect and halt bad upgrades.</span></span> <span data-ttu-id="0a713-134">V takovém případě by chceme zobrazit, pokud jsme můžete zjistit, proč museli pack repliky do domény upgradu Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="0a713-134">In this case, we’d want to see if we can figure out why the Resource Manager had to pack the replicas into the Upgrade Domain.</span></span> <span data-ttu-id="0a713-135">Obvykle balení je přechodný, protože uzlů v jiných doménách upgradu byly dolů, např.</span><span class="sxs-lookup"><span data-stu-id="0a713-135">Usually packing is transient because the nodes in the other Upgrade Domains were down, for example.</span></span>

<span data-ttu-id="0a713-136">Řekněme, že se pokouší o umístit některé služby Správce prostředků clusteru, ale nejsou k dispozici žádné řešení, které pracují.</span><span class="sxs-lookup"><span data-stu-id="0a713-136">Let’s say the Cluster Resource Manager is trying to place some services, but there aren't any solutions that work.</span></span> <span data-ttu-id="0a713-137">Při služby nelze umístit, je obvykle pro jednu z následujících důvodů:</span><span class="sxs-lookup"><span data-stu-id="0a713-137">When services can't be placed, it is usually for one of the following reasons:</span></span>

1. <span data-ttu-id="0a713-138">Některé dočasný stav má nebylo možné správně umístit této instance služby nebo repliky</span><span class="sxs-lookup"><span data-stu-id="0a713-138">Some transient condition has made it impossible to place this service instance or replica correctly</span></span>
2. <span data-ttu-id="0a713-139">Požadavky na umístění služby jsou unsatisfiable.</span><span class="sxs-lookup"><span data-stu-id="0a713-139">The service’s placement requirements are unsatisfiable.</span></span>

<span data-ttu-id="0a713-140">V těchto případech sestavy o stavu ze Správce prostředků clusteru můžete zjistit, proč nelze umístit služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-140">In these cases, health reports from the Cluster Resource Manager help you determine why the service can’t be placed.</span></span> <span data-ttu-id="0a713-141">Tento proces říkáme pořadí odstranění omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-141">We call this process the constraint elimination sequence.</span></span> <span data-ttu-id="0a713-142">Během, provede systému nakonfigurované omezení týkající se služby a záznamy se vyhnete.</span><span class="sxs-lookup"><span data-stu-id="0a713-142">During it, the system walks through the configured constraints affecting the service and records what they eliminate.</span></span> <span data-ttu-id="0a713-143">Tímto způsobem, pokud nejsou služby moci umístit, uvidíte uzlů, které byly odstraněny a proč.</span><span class="sxs-lookup"><span data-stu-id="0a713-143">This way when services aren’t able to be placed, you can see which nodes were eliminated and why.</span></span>

## <a name="constraint-types"></a><span data-ttu-id="0a713-144">Omezení typů</span><span class="sxs-lookup"><span data-stu-id="0a713-144">Constraint types</span></span>
<span data-ttu-id="0a713-145">Budeme mluvit o každé z různých omezení v těchto sestavách stavu.</span><span class="sxs-lookup"><span data-stu-id="0a713-145">Let’s talk about each of the different constraints in these health reports.</span></span> <span data-ttu-id="0a713-146">Zobrazí se stav zprávy týkající se těchto omezení, pokud nemůže být umístěn repliky.</span><span class="sxs-lookup"><span data-stu-id="0a713-146">You will see health messages related to these constraints when replicas can't be placed.</span></span>

* <span data-ttu-id="0a713-147">**ReplicaExclusionStatic** a **ReplicaExclusionDynamic**: těchto omezení označuje, že řešení byla odmítnuta, protože dva objekty služby ze stejného oddílu by musel být umístěny na stejném uzlu.</span><span class="sxs-lookup"><span data-stu-id="0a713-147">**ReplicaExclusionStatic** and **ReplicaExclusionDynamic**: These constraints indicates that a solution was rejected because two service objects from the same partition would have to be placed on the same node.</span></span> <span data-ttu-id="0a713-148">Toto není povolená, protože pak selhání tohoto uzlu by zbytečně ovlivnit oddílu.</span><span class="sxs-lookup"><span data-stu-id="0a713-148">This isn’t allowed because then failure of that node would overly impact that partition.</span></span> <span data-ttu-id="0a713-149">ReplicaExclusionStatic a ReplicaExclusionDynamic jsou téměř stejného pravidla a rozdíly nejsou opravdu důležité.</span><span class="sxs-lookup"><span data-stu-id="0a713-149">ReplicaExclusionStatic and ReplicaExclusionDynamic are almost the same rule and the differences don't really matter.</span></span> <span data-ttu-id="0a713-150">Pokud se zobrazuje sekvenci odstranění omezení obsahující buď ReplicaExclusionStatic nebo ReplicaExclusionDynamic omezení, správce prostředků clusteru se domnívá, že není dostatek uzlů.</span><span class="sxs-lookup"><span data-stu-id="0a713-150">If you are seeing a constraint elimination sequence containing either the ReplicaExclusionStatic or ReplicaExclusionDynamic constraint, the Cluster Resource Manager thinks that there aren’t enough nodes.</span></span> <span data-ttu-id="0a713-151">To vyžaduje zbývající řešení použít tyto neplatné umísťováním, které nejsou povoleny.</span><span class="sxs-lookup"><span data-stu-id="0a713-151">This requires remaining solutions to use these invalid placements which are disallowed.</span></span> <span data-ttu-id="0a713-152">Jiná omezení v pořadí bude obvykle Řekněte nám, proč se právě uzly na prvním místě vyloučí.</span><span class="sxs-lookup"><span data-stu-id="0a713-152">The other constraints in the sequence will usually tell us why nodes are being eliminated in the first place.</span></span>
* <span data-ttu-id="0a713-153">**PlacementConstraint**: Pokud se zobrazí tato zpráva, znamená to, jsme vyloučit některé uzly, protože neodpovídají omezení umístění služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-153">**PlacementConstraint**: If you see this message, it means that we eliminated some nodes because they didn’t match the service’s placement constraints.</span></span> <span data-ttu-id="0a713-154">Jsme trasování se omezení umístění aktuálně nakonfigurovaný jako součást této zprávy.</span><span class="sxs-lookup"><span data-stu-id="0a713-154">We trace out the currently configured placement constraints as a part of this message.</span></span> <span data-ttu-id="0a713-155">To je normální, pokud máte definované omezení umístění.</span><span class="sxs-lookup"><span data-stu-id="0a713-155">This is normal if you have a placement constraint defined.</span></span> <span data-ttu-id="0a713-156">Ale pokud omezení umístění je nesprávně by příliš mnoho uzly eliminace Toto je, jak by si všimnete.</span><span class="sxs-lookup"><span data-stu-id="0a713-156">However, if placement constraint is incorrectly causing too many nodes to be eliminated this is how you would notice.</span></span>
* <span data-ttu-id="0a713-157">**NodeCapacity**: Toto omezení znamená, že clusteru Resource Manager nemohl umístit repliky na uvedené uzly, protože který by put přes kapacity.</span><span class="sxs-lookup"><span data-stu-id="0a713-157">**NodeCapacity**: This constraint means that the Cluster Resource Manager couldn’t place the replicas on the indicated nodes because that would put them over capacity.</span></span>
* <span data-ttu-id="0a713-158">**Spřažení**: Toto omezení označuje, že jsme nemohl umístit repliky na ovlivněných uzly vzhledem k tomu, že by to způsobilo porušení omezení spřažení.</span><span class="sxs-lookup"><span data-stu-id="0a713-158">**Affinity**: This constraint indicates that we couldn’t place the replica on the affected nodes since it would cause a violation of the affinity constraint.</span></span> <span data-ttu-id="0a713-159">Další informace o spřažení je v [v tomto článku](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span><span class="sxs-lookup"><span data-stu-id="0a713-159">More information on affinity is in [this article](service-fabric-cluster-resource-manager-advanced-placement-rules-affinity.md)</span></span>
* <span data-ttu-id="0a713-160">**FaultDomain** a **UpgradeDomain**: Toto omezení eliminuje uzly, pokud umístění repliky na uvedené uzly by způsobilo balení v konkrétní chyby nebo doméně pro upgrade.</span><span class="sxs-lookup"><span data-stu-id="0a713-160">**FaultDomain** and **UpgradeDomain**: This constraint eliminates nodes if placing the replica on the indicated nodes would cause packing in a particular fault or upgrade domain.</span></span> <span data-ttu-id="0a713-161">Několik příkladů hovoříte o toto omezení jsou uvedeny v tomto tématu na [selhání a upgradu omezení domény a výsledné chování](service-fabric-cluster-resource-manager-cluster-description.md)</span><span class="sxs-lookup"><span data-stu-id="0a713-161">Several examples discussing this constraint are presented in the topic on [fault and upgrade domain constraints and resulting behavior](service-fabric-cluster-resource-manager-cluster-description.md)</span></span>
* <span data-ttu-id="0a713-162">**PreferredLocation**: byste neměli vidět normálně toto omezení, protože je ve výchozím nastavení spustí jako optimalizace odstranění uzlů z řešení.</span><span class="sxs-lookup"><span data-stu-id="0a713-162">**PreferredLocation**: You shouldn’t normally see this constraint removing nodes from the solution since it runs as an optimization by default.</span></span> <span data-ttu-id="0a713-163">Omezení upřednostňované umístění je také dostupný při upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-163">The preferred location constraint is also present during upgrades.</span></span> <span data-ttu-id="0a713-164">Během upgradu se používá pro přesun služby zpět do které byly při spuštění upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-164">During upgrade it is used to move services back to where they were when the upgrade started.</span></span>

## <a name="blocklisting-nodes"></a><span data-ttu-id="0a713-165">Blocklisting uzly</span><span class="sxs-lookup"><span data-stu-id="0a713-165">Blocklisting Nodes</span></span>
<span data-ttu-id="0a713-166">Další zprávu stavu sestavy správce prostředků clusteru je, když jsou blocklisted uzly.</span><span class="sxs-lookup"><span data-stu-id="0a713-166">Another health message the Cluster Resource Manager reports is when nodes are blocklisted.</span></span> <span data-ttu-id="0a713-167">Blocklisting si můžete představit jako dočasné omezení, která je automaticky použita pro vás.</span><span class="sxs-lookup"><span data-stu-id="0a713-167">You can think of blocklisting as a temporary constraint that is automatically applied for you.</span></span> <span data-ttu-id="0a713-168">Uzly získat blocklisted opakovaných neúspěšných dojde při spuštění instance tohoto typu služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-168">Nodes get blocklisted when they experience repeated failures when launching instances of that service type.</span></span> <span data-ttu-id="0a713-169">Uzly jsou blocklisted na základě typu za služby.</span><span class="sxs-lookup"><span data-stu-id="0a713-169">Nodes are blocklisted on a per-service-type basis.</span></span> <span data-ttu-id="0a713-170">Uzlem může být blocklisted pro typ jedna služba, ale ne jiné.</span><span class="sxs-lookup"><span data-stu-id="0a713-170">A node may be blocklisted for one service type but not another.</span></span> 

<span data-ttu-id="0a713-171">Zobrazí se nové často během vývoje blocklisting: Některé chyby způsobí, že váš hostitel služby došlo k chybě při spuštění.</span><span class="sxs-lookup"><span data-stu-id="0a713-171">You'll see blocklisting kick in often during development: some bug causes your service host to crash on startup.</span></span> <span data-ttu-id="0a713-172">Service Fabric se pokusí vytvořit hostitele služby několikrát, a vyskytuje opakovaně selhání.</span><span class="sxs-lookup"><span data-stu-id="0a713-172">Service Fabric tries to create the service host a few times, and the failure keeps occurring.</span></span> <span data-ttu-id="0a713-173">Po několika pokusech uzlu získá blocklisted a správce prostředků clusteru se pokusí vytvořit službu jinde.</span><span class="sxs-lookup"><span data-stu-id="0a713-173">After a few attempts, the node gets blocklisted, and the Cluster Resource Manager will try to create the service elsewhere.</span></span> <span data-ttu-id="0a713-174">Pokud ve více uzlech udržuje nedošlo k této chybě, je možné všechny platné uzly v clusteru end až zablokuje.</span><span class="sxs-lookup"><span data-stu-id="0a713-174">If that failure keeps happening on multiple nodes, it's possible that all of the valid nodes in the cluster end up blocked.</span></span> <span data-ttu-id="0a713-175">Blocklisting rovněž můžete odebrat mnoho uzly, že není dostatek úspěšně spustit službu ke splnění požadovaných měřítka.</span><span class="sxs-lookup"><span data-stu-id="0a713-175">Blocklisting cna also remove so many nodes that not enough can successfully launch the service to meet the desired scale.</span></span> <span data-ttu-id="0a713-176">Obvykle uvidíte další chyby nebo upozornění od uvádí správce prostředků clusteru, která služba je nižší než požadovaný repliky nebo počet instancí, jak jako stavu zprávy, která určuje, co je selhání, které vznikají blocklisting v prvním místní.</span><span class="sxs-lookup"><span data-stu-id="0a713-176">You'll typically see additional errors or warnings from the Cluster Resource Manager indicating that the service is below the desired replica or instance count, as well as health messages indicating what the failure is that's leading to the blocklisting in the first place.</span></span>

<span data-ttu-id="0a713-177">Blocklisting není trvalé podmínce.</span><span class="sxs-lookup"><span data-stu-id="0a713-177">Blocklisting is not a permanent condition.</span></span> <span data-ttu-id="0a713-178">Po několika minutách bude uzel odebrán z blocklist a Service Fabric může znovu aktivujte služeb v tomto uzlu.</span><span class="sxs-lookup"><span data-stu-id="0a713-178">After a few minutes, the node is removed from the blocklist and Service Fabric may activate the services on that node again.</span></span> <span data-ttu-id="0a713-179">Pokud služby dále nezdaří, je uzel blocklisted pro daný typ služby znovu.</span><span class="sxs-lookup"><span data-stu-id="0a713-179">If services continue to fail, the node is blocklisted for that service type again.</span></span> 

### <a name="constraint-priorities"></a><span data-ttu-id="0a713-180">Omezení priority</span><span class="sxs-lookup"><span data-stu-id="0a713-180">Constraint priorities</span></span>

> [!WARNING]
> <span data-ttu-id="0a713-181">Změna omezení priority se nedoporučuje a může mít významný negativní vliv na clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-181">Changing constraint priorities is not recommended and may have significant adverse effects on your cluster.</span></span> <span data-ttu-id="0a713-182">Níže uvedené informace slouží pro odkaz na výchozí omezení priority a jejich chování.</span><span class="sxs-lookup"><span data-stu-id="0a713-182">The below information is provided for reference of the default constraint priorities and their behavior.</span></span> 
>

<span data-ttu-id="0a713-183">Se všemi těchto omezení vám může mít byla myslím "Hey – myslím, že jsou omezení domény selhání je třeba mít v systému.</span><span class="sxs-lookup"><span data-stu-id="0a713-183">With all of these constraints, you may have been thinking “Hey – I think that fault domain constraints are the most important thing in my system.</span></span> <span data-ttu-id="0a713-184">Aby se zajistilo, že není došlo k porušení omezení domény selhání, chci se porušování jiná omezení."</span><span class="sxs-lookup"><span data-stu-id="0a713-184">In order to ensure the fault domain constraint isn't violated, I’m willing to violate other constraints.”</span></span>

<span data-ttu-id="0a713-185">Omezení lze konfigurovat různých úrovní priority.</span><span class="sxs-lookup"><span data-stu-id="0a713-185">Constraints can be configured with different priority levels.</span></span> <span data-ttu-id="0a713-186">Jsou to:</span><span class="sxs-lookup"><span data-stu-id="0a713-186">These are:</span></span>

   - <span data-ttu-id="0a713-187">"pevné" (0)</span><span class="sxs-lookup"><span data-stu-id="0a713-187">“hard” (0)</span></span>
   - <span data-ttu-id="0a713-188">"soft" (1)</span><span class="sxs-lookup"><span data-stu-id="0a713-188">“soft” (1)</span></span>
   - <span data-ttu-id="0a713-189">"optimalizace" (2)</span><span class="sxs-lookup"><span data-stu-id="0a713-189">“optimization” (2)</span></span>
   - <span data-ttu-id="0a713-190">"off" (-1).</span><span class="sxs-lookup"><span data-stu-id="0a713-190">“off” (-1).</span></span> 
   
<span data-ttu-id="0a713-191">Většina omezení jsou nakonfigurovány jako pevný omezení ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="0a713-191">Most of the constraints are configured as hard constraints by default.</span></span>

<span data-ttu-id="0a713-192">Změna prioritu omezení neobvyklé.</span><span class="sxs-lookup"><span data-stu-id="0a713-192">Changing the priority of constraints is uncommon.</span></span> <span data-ttu-id="0a713-193">Byly časy kde omezení priority třeba chcete změnit, obvykle obejít některé chyb nebo chování, které vliv prostředí.</span><span class="sxs-lookup"><span data-stu-id="0a713-193">There have been times where constraint priorities needed to change, usually to work around some other bug or behavior that was impacting the environment.</span></span> <span data-ttu-id="0a713-194">Obecně velmi dobře fungovala pružnost infrastruktury s prioritou omezení, ale nebyla často potřeba.</span><span class="sxs-lookup"><span data-stu-id="0a713-194">Generally the flexibility of the constraint priority infrastructure has worked very well, but it isn't needed often.</span></span> <span data-ttu-id="0a713-195">Ve většině případů, vše, co je umístěn na jejich výchozí priority.</span><span class="sxs-lookup"><span data-stu-id="0a713-195">Most of the time everything sits at their default priorities.</span></span> 

<span data-ttu-id="0a713-196">Úrovně priority nemáte znamenají, že dané omezení _bude_ být došlo k porušení, ani se vždy splnit.</span><span class="sxs-lookup"><span data-stu-id="0a713-196">The priority levels don't mean that a given constraint _will_ be violated, nor that it will always be met.</span></span> <span data-ttu-id="0a713-197">Omezení priority definovat pořadí, ve kterém jsou vynucena omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-197">Constraint priorities define an order in which constraints are enforced.</span></span> <span data-ttu-id="0a713-198">Priority definovat nevýhody v případě, že je nelze vyhovět všechna omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-198">Priorities define the tradeoffs when it is impossible to satisfy all constraints.</span></span> <span data-ttu-id="0a713-199">Všechna omezení obvykle může obsloužit, pokud má něco jinak se děje v daném prostředí.</span><span class="sxs-lookup"><span data-stu-id="0a713-199">Usually all the constraints can be satisfied unless there's something else going on in the environment.</span></span> <span data-ttu-id="0a713-200">Příklady scénářů, které povede k porušení omezení jsou konfliktní omezení, nebo velkého počtu souběžných selhání.</span><span class="sxs-lookup"><span data-stu-id="0a713-200">Some examples of scenarios that will lead to constraint violations are conflicting constraints, or large numbers of concurrent failures.</span></span>

<span data-ttu-id="0a713-201">V situacích, rozšířené můžete změnit prioritu omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-201">In advanced situations, you can change the constraint priorities.</span></span> <span data-ttu-id="0a713-202">Řekněme například, že chcete zajistit spřažení by porušila vždy v případě potřeby řešit problémy kapacita uzlu.</span><span class="sxs-lookup"><span data-stu-id="0a713-202">For example, say you wanted to ensure that affinity would always be violated when necessary to solve node capacity issues.</span></span> <span data-ttu-id="0a713-203">Jak toho docílit, můžete nastavit prioritu spřažení omezení a "soft" (1) a nechte omezení kapacity nastavena na "pevný" (0).</span><span class="sxs-lookup"><span data-stu-id="0a713-203">To achieve this, you could set the priority of the affinity constraint to “soft” (1) and leave the capacity constraint set to “hard” (0).</span></span>

<span data-ttu-id="0a713-204">Výchozí hodnoty priority pro různé omezení jsou zadány v následující konfigurace:</span><span class="sxs-lookup"><span data-stu-id="0a713-204">The default priority values for the different constraints are specified in the following config:</span></span>

<span data-ttu-id="0a713-205">ClusterManifest.xml</span><span class="sxs-lookup"><span data-stu-id="0a713-205">ClusterManifest.xml</span></span>

```xml
        <Section Name="PlacementAndLoadBalancing">
            <Parameter Name="PlacementConstraintPriority" Value="0" />
            <Parameter Name="CapacityConstraintPriority" Value="0" />
            <Parameter Name="AffinityConstraintPriority" Value="0" />
            <Parameter Name="FaultDomainConstraintPriority" Value="0" />
            <Parameter Name="UpgradeDomainConstraintPriority" Value="1" />
            <Parameter Name="PreferredLocationConstraintPriority" Value="2" />
        </Section>
```

<span data-ttu-id="0a713-206">pomocí souboru ClusterConfig.json pro samostatné nasazení nebo Template.json pro Azure hostované clustery:</span><span class="sxs-lookup"><span data-stu-id="0a713-206">via ClusterConfig.json for Standalone deployments or Template.json for Azure hosted clusters:</span></span>

```json
"fabricSettings": [
  {
    "name": "PlacementAndLoadBalancing",
    "parameters": [
      {
          "name": "PlacementConstraintPriority",
          "value": "0"
      },
      {
          "name": "CapacityConstraintPriority",
          "value": "0"
      },
      {
          "name": "AffinityConstraintPriority",
          "value": "0"
      },
      {
          "name": "FaultDomainConstraintPriority",
          "value": "0"
      },
      {
          "name": "UpgradeDomainConstraintPriority",
          "value": "1"
      },
      {
          "name": "PreferredLocationConstraintPriority",
          "value": "2"
      }
    ]
  }
]
```

## <a name="fault-domain-and-upgrade-domain-constraints"></a><span data-ttu-id="0a713-207">Omezení domény selhání domény a upgrade</span><span class="sxs-lookup"><span data-stu-id="0a713-207">Fault domain and upgrade domain constraints</span></span>
<span data-ttu-id="0a713-208">Správce prostředků clusteru chce ponechat služby šíření mezi doménách selhání a upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-208">The Cluster Resource Manager wants to keep services spread out among fault and upgrade domains.</span></span> <span data-ttu-id="0a713-209">Modely to jako omezení uvnitř modul Správce prostředků clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-209">It models this as a constraint inside the Cluster Resource Manager’s engine.</span></span> <span data-ttu-id="0a713-210">Další informace o tom, jak se používají a jejich konkrétní chování, najdete v článku na [konfigurace clusteru](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span><span class="sxs-lookup"><span data-stu-id="0a713-210">For more information on how they are used and their specific behavior, check out the article on [cluster configuration](service-fabric-cluster-resource-manager-cluster-description.md#fault-and-upgrade-domain-constraints-and-resulting-behavior).</span></span>

<span data-ttu-id="0a713-211">Správce prostředků clusteru možná muset pack několik repliky do upgradu domény, aby bylo možné čelit upgrady, chyby nebo další narušení omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-211">The Cluster Resource Manager may need to pack a couple replicas into an upgrade domain in order to deal with upgrades, failures, or other constraint violations.</span></span> <span data-ttu-id="0a713-212">Balení do domén selhání nebo upgradu obvykle dochází jenom v případě, že existuje několik selhání nebo dalších změn v systému, které brání správné umístění.</span><span class="sxs-lookup"><span data-stu-id="0a713-212">Packing into fault or upgrade domains normally happens only when there are several failures or other churn in the system preventing correct placement.</span></span> <span data-ttu-id="0a713-213">Pokud chcete, aby se zabránilo okolních i v těchto situacích, můžete využít `RequireDomainDistribution` [umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span><span class="sxs-lookup"><span data-stu-id="0a713-213">If you wish to prevent packing even during these situations, you can utilize the `RequireDomainDistribution` [placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md#requiring-replica-distribution-and-disallowing-packing).</span></span> <span data-ttu-id="0a713-214">Všimněte si, že to může mít vliv na dostupnost služeb a spolehlivost jako vedlejším účinkem proto pečlivě zvažte.</span><span class="sxs-lookup"><span data-stu-id="0a713-214">Note that this may affect service availability and reliability as a side effect, so consider it carefully.</span></span>

<span data-ttu-id="0a713-215">Pokud prostředí je správně nakonfigurována, všechna omezení jsou dodržení i během upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-215">If the environment is configured correctly, all constraints are fully respected, even during upgrades.</span></span> <span data-ttu-id="0a713-216">Klíče věc je, že správce prostředků clusteru sleduje pro vaše omezení.</span><span class="sxs-lookup"><span data-stu-id="0a713-216">The key thing is that the Cluster Resource Manager is watching out for your constraints.</span></span> <span data-ttu-id="0a713-217">Když zjistí narušení okamžitě sestavy ji a pokusí se tento problém opravili.</span><span class="sxs-lookup"><span data-stu-id="0a713-217">When it detects a violation it immediately reports it and tries to correct the issue.</span></span>

## <a name="the-preferred-location-constraint"></a><span data-ttu-id="0a713-218">Omezení upřednostňované umístění</span><span class="sxs-lookup"><span data-stu-id="0a713-218">The preferred location constraint</span></span>
<span data-ttu-id="0a713-219">Omezení PreferredLocation je trochu liší, protože má dva různé používá.</span><span class="sxs-lookup"><span data-stu-id="0a713-219">The PreferredLocation constraint is a little different, as it has two different uses.</span></span> <span data-ttu-id="0a713-220">Jedno použití tohoto omezení je během upgradu aplikace.</span><span class="sxs-lookup"><span data-stu-id="0a713-220">One use of this constraint is during application upgrades.</span></span> <span data-ttu-id="0a713-221">Správce prostředků clusteru automaticky spravuje toto omezení při upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-221">The Cluster Resource Manager automatically manages this constraint during upgrades.</span></span> <span data-ttu-id="0a713-222">Použije se zajistit, aby po dokončení, že repliky vrátit k jejich počáteční umístění upgrady.</span><span class="sxs-lookup"><span data-stu-id="0a713-222">It is used to ensure that when upgrades are complete that replicas return to their initial locations.</span></span> <span data-ttu-id="0a713-223">Použití omezení PreferredLocation je pro [ `PreferredPrimaryDomain` umístění zásady](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span><span class="sxs-lookup"><span data-stu-id="0a713-223">The other use of the PreferredLocation constraint is for the [`PreferredPrimaryDomain` placement policy](service-fabric-cluster-resource-manager-advanced-placement-rules-placement-policies.md).</span></span> <span data-ttu-id="0a713-224">Obě tyto optimalizace a proto je omezení PreferredLocation pouze omezení ve výchozím nastavení má "Optimalizace".</span><span class="sxs-lookup"><span data-stu-id="0a713-224">Both of these are optimizations, and hence the PreferredLocation constraint is the only constraint set to "Optimization" by default.</span></span>

## <a name="upgrades"></a><span data-ttu-id="0a713-225">Upgrady</span><span class="sxs-lookup"><span data-stu-id="0a713-225">Upgrades</span></span>
<span data-ttu-id="0a713-226">Správce prostředků clusteru také pomáhá při aplikace a upgrady clusteru, za které má dvě úlohy:</span><span class="sxs-lookup"><span data-stu-id="0a713-226">The Cluster Resource Manager also helps during application and cluster upgrades, during which it has two jobs:</span></span>

* <span data-ttu-id="0a713-227">Ujistěte se, že nejsou ohrožená pravidla clusteru</span><span class="sxs-lookup"><span data-stu-id="0a713-227">ensure that the rules of the cluster are not compromised</span></span>
* <span data-ttu-id="0a713-228">Pokuste se upgrade bezproblémové pomoci</span><span class="sxs-lookup"><span data-stu-id="0a713-228">try to help the upgrade go smoothly</span></span>

### <a name="keep-enforcing-the-rules"></a><span data-ttu-id="0a713-229">Zachovat vynucování pravidel</span><span class="sxs-lookup"><span data-stu-id="0a713-229">Keep enforcing the rules</span></span>
<span data-ttu-id="0a713-230">Hlavní věc zajímat je, že se pravidla – striktní omezení jako omezení umístění a kapacity - stále vynucují během upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-230">The main thing to be aware of is that the rules – the strict constraints like placement constraints and capacities - are still enforced during upgrades.</span></span> <span data-ttu-id="0a713-231">Omezení umístění zkontrolujte, zda úlohy pouze spustili, kde mohou, i během upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-231">Placement constraints ensure that your workloads only run where they are allowed to, even during upgrades.</span></span> <span data-ttu-id="0a713-232">Když jsou vysoce omezené služby, upgrade může trvat déle.</span><span class="sxs-lookup"><span data-stu-id="0a713-232">When services are highly constrained, upgrades can take longer.</span></span> <span data-ttu-id="0a713-233">Pokud služba nebo na uzel, který je spuštěn na se snížila pro aktualizaci může být několik možností pro kde můžete přejít.</span><span class="sxs-lookup"><span data-stu-id="0a713-233">When the service or the node it is running on is brought down for an update there may be few options for where it can go.</span></span>

### <a name="smart-replacements"></a><span data-ttu-id="0a713-234">Inteligentní nahrazení</span><span class="sxs-lookup"><span data-stu-id="0a713-234">Smart replacements</span></span>
<span data-ttu-id="0a713-235">Když se spustí se upgrade, správce prostředků pořídí snímek aktuální uspořádání clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-235">When an upgrade starts, the Resource Manager takes a snapshot of the current arrangement of the cluster.</span></span> <span data-ttu-id="0a713-236">Protože každá doména upgradu se dokončí, pokusí se vrátí služby, které byly v této doméně upgradu do jejich původního uspořádání.</span><span class="sxs-lookup"><span data-stu-id="0a713-236">As each Upgrade Domain completes, it attempts to return the services that were in that Upgrade Domain to their original arrangement.</span></span> <span data-ttu-id="0a713-237">Tímto způsobem existují maximálně dvě přechody pro službu během upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-237">This way there are at most two transitions for a service during the upgrade.</span></span> <span data-ttu-id="0a713-238">Neexistuje jeden Přesun na příslušném uzlu a jeden přesuňte zpět.</span><span class="sxs-lookup"><span data-stu-id="0a713-238">There is one move out of the affected node and one move back in.</span></span> <span data-ttu-id="0a713-239">Vrátí do původního stavu před upgradem clusteru nebo služby zajišťuje, že upgrade nebude mít vliv na rozložení clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-239">Returning the cluster or service to how it was before the upgrade also ensures the upgrade doesn’t impact the layout of the cluster.</span></span> 

### <a name="reduced-churn"></a><span data-ttu-id="0a713-240">Snížené změn</span><span class="sxs-lookup"><span data-stu-id="0a713-240">Reduced churn</span></span>
<span data-ttu-id="0a713-241">Jiné z věcí, které se stane při upgradech je, že správce prostředků clusteru vypne vyrovnávání.</span><span class="sxs-lookup"><span data-stu-id="0a713-241">Another thing that happens during upgrades is that the Cluster Resource Manager turns off balancing.</span></span> <span data-ttu-id="0a713-242">Brání vyrovnávání zabraňuje zbytečným reakce upgrade samostatně, například přesun služby do uzlů, které byly vyprázdněny pro upgrade.</span><span class="sxs-lookup"><span data-stu-id="0a713-242">Preventing balancing prevents unnecessary reactions to the upgrade itself, like moving services into nodes that were emptied for the upgrade.</span></span> <span data-ttu-id="0a713-243">Pokud dotyčném upgrade je upgrade clusteru, není během upgradu vyvážit celý cluster.</span><span class="sxs-lookup"><span data-stu-id="0a713-243">If the upgrade in question is a Cluster upgrade, then the entire cluster is not balanced during the upgrade.</span></span> <span data-ttu-id="0a713-244">Omezení kontroly zůstane aktivní, pouze přesun podle proaktivní vyrovnávání metriky je zakázána.</span><span class="sxs-lookup"><span data-stu-id="0a713-244">Constraint checks stay active, only movement based on the proactive balancing of metrics is disabled.</span></span>

### <a name="buffered-capacity--upgrade"></a><span data-ttu-id="0a713-245">Ve vyrovnávací paměti kapacity & upgradu</span><span class="sxs-lookup"><span data-stu-id="0a713-245">Buffered Capacity & Upgrade</span></span>
<span data-ttu-id="0a713-246">Obecně je vhodné na dokončení i v případě, že je omezené clusteru nebo blízko úplné upgradu.</span><span class="sxs-lookup"><span data-stu-id="0a713-246">Generally you want the upgrade to complete even if the cluster is constrained or close to full.</span></span> <span data-ttu-id="0a713-247">Správa kapacitu clusteru je důležitější-při upgradech než obvykle.</span><span class="sxs-lookup"><span data-stu-id="0a713-247">Managing the capacity of the cluster is even more important during upgrades than usual.</span></span> <span data-ttu-id="0a713-248">V závislosti na počet domén upgradu mezi 5 a 20 procent kapacity je potřeba migrovat po upgradu prostřednictvím clusteru.</span><span class="sxs-lookup"><span data-stu-id="0a713-248">Depending on the number of upgrade domains, between 5 and 20 percent of capacity must be migrated as the upgrade rolls through the cluster.</span></span> <span data-ttu-id="0a713-249">Které pracují se má přejít někde.</span><span class="sxs-lookup"><span data-stu-id="0a713-249">That work has to go somewhere.</span></span> <span data-ttu-id="0a713-250">To je, kdy představu o [uložená do vyrovnávací paměti kapacity](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) je užitečné.</span><span class="sxs-lookup"><span data-stu-id="0a713-250">This is where the notion of [buffered capacities](service-fabric-cluster-resource-manager-cluster-description.md#buffered-capacity) is useful.</span></span> <span data-ttu-id="0a713-251">Kapacita ve vyrovnávací paměti je dodržena při běžném provozu.</span><span class="sxs-lookup"><span data-stu-id="0a713-251">Buffered capacity is respected during normal operation.</span></span> <span data-ttu-id="0a713-252">Správce prostředků clusteru můžou vyplní uzly až jejich celkové kapacity (využívání vyrovnávací paměti) během upgradu v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="0a713-252">The Cluster Resource Manager may fill nodes up to their total capacity (consuming the buffer) during upgrades if necessary.</span></span>

## <a name="next-steps"></a><span data-ttu-id="0a713-253">Další kroky</span><span class="sxs-lookup"><span data-stu-id="0a713-253">Next steps</span></span>
* <span data-ttu-id="0a713-254">Začít od začátku a [získejte Úvod do Service Fabric clusteru správce prostředků](service-fabric-cluster-resource-manager-introduction.md)</span><span class="sxs-lookup"><span data-stu-id="0a713-254">Start from the beginning and [get an Introduction to the Service Fabric Cluster Resource Manager](service-fabric-cluster-resource-manager-introduction.md)</span></span>

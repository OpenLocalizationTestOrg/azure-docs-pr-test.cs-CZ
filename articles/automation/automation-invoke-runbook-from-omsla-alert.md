---
title: "aaaCalling Runbook služby Azure Automation z protokolu analýzy oznámení na | Microsoft Docs"
description: "Tento článek obsahuje přehled o tooinvoke runbook služby automatizace Microsoft OMS Log Analytics výstraze."
services: automation
documentationcenter: 
author: mgoedtel
manager: jwhit
editor: 
ms.assetid: 
ms.service: automation
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 01/31/2017
ms.author: magoedte
ms.openlocfilehash: 8b745d6e6c2b0294d676e010f52855cd51741cf9
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="calling-an-azure-automation-runbook-from-an-oms-log-analytics-alert"></a><span data-ttu-id="57dff-103">Volání runbooku Azure Automation z upozornění OMS Log Analytics</span><span class="sxs-lookup"><span data-stu-id="57dff-103">Calling an Azure Automation runbook from an OMS Log Analytics alert</span></span>

<span data-ttu-id="57dff-104">Při výstraha je nakonfigurovaný v toocreate analýzy protokolů selže záznam výstrahy, pokud se výsledky shodují konkrétní kritéria, například provozu v případě delších Špička při využití procesoru nebo je určitá aplikace proces kritické toohello funkce obchodní aplikace a zapíše je odpovídající událost v protokolu událostí systému Windows hello, tuto výstrahu můžete automaticky spustit runbook služby automatizace v tooauto pokusu o-opravit problém hello.</span><span class="sxs-lookup"><span data-stu-id="57dff-104">When an alert is configured in Log Analytics toocreate an alert record if results match a particular criteria, such as a prolonged spike in processor utilization or a particular application process critical toohello functionality of a business application fails and writes a corresponding event in hello Windows event log, that alert can automatically run an Automation runbook in an attempt tooauto-remediate hello issue.</span></span>  

<span data-ttu-id="57dff-105">Existují dvě možnosti toocall sady runbook při konfiguraci hello výstrahy.</span><span class="sxs-lookup"><span data-stu-id="57dff-105">There are two options toocall a runbook when configuring hello alert.</span></span>  <span data-ttu-id="57dff-106">Konkrétně:</span><span class="sxs-lookup"><span data-stu-id="57dff-106">Specifically,</span></span>

1. <span data-ttu-id="57dff-107">Pomocí webhooku.</span><span class="sxs-lookup"><span data-stu-id="57dff-107">Using a Webhook.</span></span>
   * <span data-ttu-id="57dff-108">Toto je hello pouze možnost k dispozici, pokud vaším pracovním prostorem OMS není propojené tooan účet Automation.</span><span class="sxs-lookup"><span data-stu-id="57dff-108">This is hello only option available if your OMS workspace is not linked tooan Automation account.</span></span>
   * <span data-ttu-id="57dff-109">Pokud už máte pracovní prostor služby Automation účet propojené tooan OMS, tato možnost je stále k dispozici.</span><span class="sxs-lookup"><span data-stu-id="57dff-109">If you already have an Automation account linked tooan OMS workspace, this option is still available.</span></span>  

2. <span data-ttu-id="57dff-110">Přímým výběrem runbooku.</span><span class="sxs-lookup"><span data-stu-id="57dff-110">Select a runbook directly.</span></span>
   * <span data-ttu-id="57dff-111">Tato možnost je dostupná jenom v případě, že je pracovní prostor OMS hello propojené tooan účet Automation.</span><span class="sxs-lookup"><span data-stu-id="57dff-111">This option is available only when hello OMS workspace is linked tooan Automation account.</span></span>  

## <a name="calling-a-runbook-using-a-webhook"></a><span data-ttu-id="57dff-112">Volání runbooku pomocí webhooku</span><span class="sxs-lookup"><span data-stu-id="57dff-112">Calling a runbook using a webhook</span></span>

<span data-ttu-id="57dff-113">Webhook, jehož vám umožní toostart konkrétní runbook ve službě Azure Automation prostřednictvím jedné žádosti HTTP.</span><span class="sxs-lookup"><span data-stu-id="57dff-113">A webhook allows you toostart a particular runbook in Azure Automation through a single HTTP request.</span></span>  <span data-ttu-id="57dff-114">Před konfigurací hello [analýzy protokolů výstraha](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbooku pomocí webhook, jehož jako výstrah akce, budete potřebovat toofirst vytvoření webhooku hello sady runbook, který bude volán pomocí této metody.</span><span class="sxs-lookup"><span data-stu-id="57dff-114">Before configuring hello [Log Analytics alert](../log-analytics/log-analytics-alerts.md#alert-rules) toocall hello runbook using a webhook as an alert action, you will need toofirst create a webhook for hello runbook that will be called using this method.</span></span>  <span data-ttu-id="57dff-115">Zkontrolujte a postupujte podle kroků hello v hello [vytvořit webhook, jehož](automation-webhooks.md#creating-a-webhook) článek a zapamatovat si adresa URL webhooku hello toorecord tak, aby můžete použít při konfiguraci hello pravidlo výstrahy.</span><span class="sxs-lookup"><span data-stu-id="57dff-115">Review and follow hello steps in hello [create a webhook](automation-webhooks.md#creating-a-webhook) article and remember toorecord hello webhook URL so that you can reference it while configuring hello alert rule.</span></span>   

## <a name="calling-a-runbook-directly"></a><span data-ttu-id="57dff-116">Přímé volání runbooku</span><span class="sxs-lookup"><span data-stu-id="57dff-116">Calling a runbook directly</span></span>

<span data-ttu-id="57dff-117">Pokud máte hello automatizace & ovládacího prvku nabídka nainstalován a nakonfigurován v vaším pracovním prostorem OMS při konfiguraci hello Runbook akce možnost hello výstrahy, můžete zobrazit všechny sady runbook z hello **vyberte sadu runbook** rozevíracího seznamu a vyberte hello konkrétní sady runbook, chcete toorun v odpovědi toohello výstrahy.</span><span class="sxs-lookup"><span data-stu-id="57dff-117">If you have hello Automation & Control offering installed and configured in your OMS workspace, when configuring hello Runbook actions option for hello alert, you can view all runbooks from hello **Select a runbook** dropdown list and select hello specific runbook you want toorun in response toohello alert.</span></span>  <span data-ttu-id="57dff-118">Hello vybrané sady runbook můžete spustit v pracovním prostoru v hello cloudu Azure nebo na hybridní pracovní proces runbooku.</span><span class="sxs-lookup"><span data-stu-id="57dff-118">hello selected runbook can run in a workspace in hello Azure cloud or on a hybrid runbook worker.</span></span>  <span data-ttu-id="57dff-119">Při hello výstraha je vytvořený pomocí hello runbook možnost, vytvoří webhook, jehož hello sady runbook.</span><span class="sxs-lookup"><span data-stu-id="57dff-119">When hello alert is created using hello runbook option, a webhook will be created for hello runbook.</span></span>  <span data-ttu-id="57dff-120">Hello webhooku můžete zobrazit, pokud přejdete toohello účet Automation a přejděte toohello webhooku okno hello vybrané sady runbook.</span><span class="sxs-lookup"><span data-stu-id="57dff-120">You can see hello webhook if you go toohello Automation account and navigate toohello webhook blade of hello selected runbook.</span></span>  <span data-ttu-id="57dff-121">Pokud odstraníte hello výstrahu, není odstranit hello webhook, ale hello uživatele můžete ručně odstranit hello webhook.</span><span class="sxs-lookup"><span data-stu-id="57dff-121">If you delete hello alert, hello webhook is not deleted, but hello user can delete hello webhook manually.</span></span>  <span data-ttu-id="57dff-122">Ho se nejedná o problém, pokud hello webhooku se neodstraní, je, že právě osamocené položku, která bude případně nutné toobe v pořadí toomaintain uspořádány účet Automation.</span><span class="sxs-lookup"><span data-stu-id="57dff-122">It is not a problem if hello webhook is not deleted, it is just an orphaned item that will eventually need toobe deleted in order toomaintain an organized Automation account.</span></span>  

## <a name="characteristics-of-a-runbook-for-both-options"></a><span data-ttu-id="57dff-123">Vlastnosti runbooku (pro obě možnosti)</span><span class="sxs-lookup"><span data-stu-id="57dff-123">Characteristics of a runbook (for both options)</span></span>

<span data-ttu-id="57dff-124">Obě metody pro volání hello runbooku z hello analýzy protokolů výstrahy mají různé chování charakteristiky, které je třeba toobe rozumí před konfigurací pravidel výstrah.</span><span class="sxs-lookup"><span data-stu-id="57dff-124">Both methods for calling hello runbook from hello Log Analytics alert have different behavior characteristics that need toobe understood before you configure your alert rules.</span></span>  

* <span data-ttu-id="57dff-125">Musíte mít vstupní parametr runbooku s názvem **WebhookData**, který je typu **Objekt**.</span><span class="sxs-lookup"><span data-stu-id="57dff-125">You must have a runbook input parameter called **WebhookData** that is **Object** type.</span></span>  <span data-ttu-id="57dff-126">Může být povinný nebo volitelný.</span><span class="sxs-lookup"><span data-stu-id="57dff-126">It can be mandatory or optional.</span></span>  <span data-ttu-id="57dff-127">Výstraha Hello předá hello vyhledávání výsledky toohello runbooku pomocí tento vstupní parametr.</span><span class="sxs-lookup"><span data-stu-id="57dff-127">hello alert passes hello search results toohello runbook using this input parameter.</span></span>

        param  
         (  
          [Parameter (Mandatory=$true)]  
          [object] $WebhookData  
         )

*  <span data-ttu-id="57dff-128">Musíte mít kód tooconvert hello WebhookData tooa prostředí PowerShell objekt.</span><span class="sxs-lookup"><span data-stu-id="57dff-128">You must have code tooconvert hello WebhookData tooa PowerShell object.</span></span>

    `$SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value`

    <span data-ttu-id="57dff-129">*$SearchResults* bude pole objektů; každého objektu obsahuje pole hello hodnotami z výsledek jeden hledání</span><span class="sxs-lookup"><span data-stu-id="57dff-129">*$SearchResults* will be an array of objects; each object contains hello fields with values from one search result</span></span>

### <a name="webhookdata-inconsistencies-between-hello-webhook-option-and-runbook-option"></a><span data-ttu-id="57dff-130">WebhookData nekonzistence mezi hello webhooku možnost a možnost sady runbook</span><span class="sxs-lookup"><span data-stu-id="57dff-130">WebhookData inconsistencies between hello webhook option and runbook option</span></span>

* <span data-ttu-id="57dff-131">Při konfiguraci výstrah toocall Webhook, jehož, zadejte adresu URL webhooku jste vytvořili pro sady runbook a klikněte na tlačítko hello **Test Webhooku** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="57dff-131">When configuring an alert toocall a Webhook, enter a webhook URL you created for a runbook, and click hello **Test Webhook** button.</span></span>  <span data-ttu-id="57dff-132">Hello výsledné WebhookData odeslané toohello runbook buď neobsahuje *. SearchResult* nebo *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="57dff-132">hello resulting WebhookData sent toohello runbook does not contain either *.SearchResult* or *.SearchResults*.</span></span>

*  <span data-ttu-id="57dff-133">Pokud uložíte výstrahy, když hello výstraha aktivuje a volá hello webhooku, obsahuje hello WebhookData odeslané toohello runbook *. SearchResult*.</span><span class="sxs-lookup"><span data-stu-id="57dff-133">If you save that alert, when hello alert triggers and calls hello webhook, hello WebhookData sent toohello runbook contains *.SearchResult*.</span></span>
* <span data-ttu-id="57dff-134">Pokud vytvoříte výstrahu a nakonfigurovat ji toocall runbook (které také vytvoří webhook, jehož), když hello výstrahy aktivačních událostí, odešle WebhookData toohello runbook, která obsahuje *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="57dff-134">If you create an alert, and configure it toocall a runbook (which also creates a webhook), when hello alert triggers it sends WebhookData toohello runbook that contains *.SearchResults*.</span></span>

<span data-ttu-id="57dff-135">Proto v předchozím příkladu kódu hello, budete potřebovat tooget *. SearchResult* Pokud hello výstrahu vyvolá webhook, jehož a bude nutné tooget *. SearchResults* Pokud hello výstraha přímo volá sadu runbook.</span><span class="sxs-lookup"><span data-stu-id="57dff-135">Thus in hello code example above, you will need tooget *.SearchResult* if hello alert calls a webhook, and will need tooget *.SearchResults* if hello alert calls a runbook directly.</span></span>

## <a name="example-walkthrough"></a><span data-ttu-id="57dff-136">Ukázka podrobného postupu</span><span class="sxs-lookup"><span data-stu-id="57dff-136">Example walkthrough</span></span>

<span data-ttu-id="57dff-137">Popisuje, jak to funguje s použitím následujících grafický runbook příklad, který spouští službu systému Windows hello.</span><span class="sxs-lookup"><span data-stu-id="57dff-137">We will demonstrate how this works by using hello following example graphical runbook, which starts a Windows service.</span></span><br><br> ![Spuštění grafického runbooku služby pro Windows](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice.png)<br>

<span data-ttu-id="57dff-139">Sada runbook Hello má jeden vstupní parametr typu **objekt** který je volán **WebhookData** a zahrnuje data webhooku hello předat z výstrahy obsahující hello *. SearchResults*.</span><span class="sxs-lookup"><span data-stu-id="57dff-139">hello runbook has one input parameter of type **Object** that is called **WebhookData** and includes hello webhook data passed from hello alert containing *.SearchResults*.</span></span><br><br> <span data-ttu-id="57dff-140">![Vstupní parametry runbooku](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span><span class="sxs-lookup"><span data-stu-id="57dff-140">![Runbook input parameters](media/automation-invoke-runbook-from-omsla-alert/automation-runbook-restartservice-inputparameter.png)</span></span><br>

<span data-ttu-id="57dff-141">V tomto příkladu v analýzy protokolů jsme vytvořili dva vlastní pole, *SvcDisplayName_CF* a *SvcState_CF*, hello tooextract služby zobrazovaný název a hello stavu služby hello (tj. spuštěná nebo zastavená) z událostí hello zapisují toohello protokolu událostí systému.</span><span class="sxs-lookup"><span data-stu-id="57dff-141">For this example, in Log Analytics we created two custom fields, *SvcDisplayName_CF* and *SvcState_CF*, tooextract hello service display name and hello state of hello service (i.e. running or stopped) from hello event written toohello System event log.</span></span>  <span data-ttu-id="57dff-142">Potom jsme hello následující vyhledávací dotaz vytvořit pravidlo výstrahy: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` tak, aby jsme můžete zjistit při zastavení hello službu zařazování tisku v systému Windows hello.</span><span class="sxs-lookup"><span data-stu-id="57dff-142">We then create an alert rule with hello following search query: `Type=Event SvcDisplayName_CF="Print Spooler" SvcState_CF="stopped"` so that we can detect when hello Print Spooler service is stopped on hello Windows system.</span></span>  <span data-ttu-id="57dff-143">Může být jakoukoli službu, které vás zajímají, ale v tomto příkladu jsme odkazují na jednu z hello existující služby, které jsou součástí operačního systému Windows hello.</span><span class="sxs-lookup"><span data-stu-id="57dff-143">It can be any service of interest, but for this example we are referencing one of hello pre-existing services that are included with hello Windows OS.</span></span>  <span data-ttu-id="57dff-144">výstrahy akce Hello je nakonfigurované tooexecute náš runbook použité v tomto příkladu a spustit na hello hybridní pracovní proces Runbooku, které jsou povolené na hello cílových systémů.</span><span class="sxs-lookup"><span data-stu-id="57dff-144">hello alert action is configured tooexecute our runbook used in this example and run on hello Hybrid Runbook Worker, which are enabled on hello target systems.</span></span>   

<span data-ttu-id="57dff-145">Hello kód aktivity sady runbook **získat název služby z LA** převede hello řetězec ve formátu JSON do služby typ objektu a na položku hello filtr *SvcDisplayName_CF* tooextract hello zobrazovaný název hello Windows služby a to předat do hello další aktivitu, která ověří hello služba je zastavena před pokusem o toorestart ho.</span><span class="sxs-lookup"><span data-stu-id="57dff-145">hello runbook code activity **Get Service Name from LA** will convert hello JSON-formatted string into an object type and filter on hello item *SvcDisplayName_CF* tooextract hello display name of hello Windows service and pass this onto hello next activity which will verify hello service is stopped before attempting toorestart it.</span></span>  <span data-ttu-id="57dff-146">*SvcDisplayName_CF* je [vlastní pole](../log-analytics/log-analytics-custom-fields.md) vytvořené v toodemonstrate analýzy protokolů v tomto příkladu.</span><span class="sxs-lookup"><span data-stu-id="57dff-146">*SvcDisplayName_CF* is a [custom field](../log-analytics/log-analytics-custom-fields.md) created in Log Analytics toodemonstrate this example.</span></span>

    $SearchResults = (ConvertFrom-Json $WebhookData.RequestBody).SearchResults.value
    $SearchResults.SvcDisplayName_CF  

<span data-ttu-id="57dff-147">Při zastavení služby hello, pravidlo výstrahy hello v analýzy protokolů zjištění shody a aktivovat sadu runbook hello a odeslat runbook toohello hello kontext výstrahy.</span><span class="sxs-lookup"><span data-stu-id="57dff-147">When hello service stops, hello alert rule in Log Analytics will detect a match and trigger hello runbook and send hello alert context toohello runbook.</span></span> <span data-ttu-id="57dff-148">Hello runbook bude trvat akce tooverify hello služba zastavena, a pokud tak pokus o toorestart hello služby a ověřte ji správně spuštěna a výstup hello výsledků.</span><span class="sxs-lookup"><span data-stu-id="57dff-148">hello runbook will take action tooverify hello service is stopped, and if so attempt toorestart hello service and verify it started correctly and output hello results.</span></span>     

<span data-ttu-id="57dff-149">Případně pokud nemáte pracovní prostor OMS tooyour propojený účet Automation, můžete by nakonfigurovat pravidlo výstrahy hello webhooku akce tootrigger hello runbooku a nakonfigurovat hello runbook tooconvert hello řetězec ve formátu JSON a filtr na *. SearchResult* pokynů hello již bylo zmíněno dříve.</span><span class="sxs-lookup"><span data-stu-id="57dff-149">Alternatively if you don't have your Automation account linked tooyour OMS workspace, you would configure hello alert rule with a webhook action tootrigger hello runbook and configure hello runbook tooconvert hello JSON-formatted string and filter on *.SearchResult* following hello guidance mentioned earlier.</span></span>    

## <a name="next-steps"></a><span data-ttu-id="57dff-150">Další kroky</span><span class="sxs-lookup"><span data-stu-id="57dff-150">Next steps</span></span>

* <span data-ttu-id="57dff-151">Další informace o výstrahy v analýzy protokolů toolearn a jak toocreate, najdete v části [výstrahy v analýzy protokolů](../log-analytics/log-analytics-alerts.md).</span><span class="sxs-lookup"><span data-stu-id="57dff-151">toolearn more about alerts in Log Analytics and how toocreate one, see [Alerts in Log Analytics](../log-analytics/log-analytics-alerts.md).</span></span>

* <span data-ttu-id="57dff-152">jak zjistit, tootrigger sady runbook pomocí webhooku, toounderstand [Azure Automation webhooky](automation-webhooks.md).</span><span class="sxs-lookup"><span data-stu-id="57dff-152">toounderstand how tootrigger runbooks using a webhook, see [Azure Automation webhooks](automation-webhooks.md).</span></span>

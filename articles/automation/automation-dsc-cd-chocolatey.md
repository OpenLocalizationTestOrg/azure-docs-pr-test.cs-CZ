---
title: "Průběžné nasazování služby Azure Automation DSC s Chocolatey | Microsoft Docs"
description: "DevOps průběžné nasazování pomocí Azure Automation DSC a správce Chocolatey balíčků.  Příklad s kompletní šablonou JSON ARM a zdroj PowerShell."
services: automation
documentationcenter: 
author: eslesar
manager: carmonm
editor: tysonn
ms.assetid: c0baa411-eb76-4f91-8d14-68f68b4805b6
ms.service: automation
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: na
ms.date: 10/29/2016
ms.author: golive
ms.openlocfilehash: f23d7374a8954a0a95853fa9e00b54a8d9c468c4
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="usage-example-continuous-deployment-to-virtual-machines-using-automation-dsc-and-chocolatey"></a><span data-ttu-id="c8335-104">Příklad použití: Průběžné nasazování pro virtuální počítače pomocí Automation DSC a Chocolatey</span><span class="sxs-lookup"><span data-stu-id="c8335-104">Usage Example: Continuous deployment to Virtual Machines using Automation DSC and Chocolatey</span></span>
<span data-ttu-id="c8335-105">Ve světě DevOps jsou celou řadu nástrojů pro pomoc s různými body v kanálu nepřetržité integrace.</span><span class="sxs-lookup"><span data-stu-id="c8335-105">In a DevOps world there are many tools to assist with various points in the Continuous Integration pipeline.</span></span>  <span data-ttu-id="c8335-106">Konfigurace Azure Automation žádaný stavu (DSC) je úvodní nové přidání možnosti, které můžete použít DevOps týmy.</span><span class="sxs-lookup"><span data-stu-id="c8335-106">Azure Automation Desired State Configuration (DSC) is a welcome new addition to the options that DevOps teams can employ.</span></span>  <span data-ttu-id="c8335-107">Tento článek ukazuje nastavení nahoru průběžné nasazení (CD) pro počítač se systémem Windows.</span><span class="sxs-lookup"><span data-stu-id="c8335-107">This article demonstrates setting up Continuous Deployment (CD) for a Windows computer.</span></span>  <span data-ttu-id="c8335-108">Můžete snadno rozšířit techniku, například jako v mnoha počítače se systémem Windows v případě potřeby v roli (webový server, např.) a z ní také další rolí.</span><span class="sxs-lookup"><span data-stu-id="c8335-108">You can easily extend the technique to include as many Windows computers as necessary in the role (a web site, for example), and from there to additional roles as well.</span></span>

![Průběžné nasazování pro virtuální počítače IaaS](./media/automation-dsc-cd-chocolatey/cdforiaasvm.png)

## <a name="at-a-high-level"></a><span data-ttu-id="c8335-110">Na vysoké úrovni</span><span class="sxs-lookup"><span data-stu-id="c8335-110">At a high level</span></span>
<span data-ttu-id="c8335-111">Je celkem chvilku přechodem sem, ale naštěstí možné ho rozdělit do dvou hlavních procesů:</span><span class="sxs-lookup"><span data-stu-id="c8335-111">There is quite a bit going on here, but fortunately it can be broken into two main processes:</span></span> 

* <span data-ttu-id="c8335-112">Psaní kódu a jeho otestováním, pak vytváření a publikování instalační balíčky pro hlavní verze a podverze systému.</span><span class="sxs-lookup"><span data-stu-id="c8335-112">Writing code and testing it, then creating and publishing installation packages for major and minor versions of the system.</span></span> 
* <span data-ttu-id="c8335-113">Vytváření a správa virtuálních počítačů, které budou nainstalovány a spouštění kódu v balíčcích.</span><span class="sxs-lookup"><span data-stu-id="c8335-113">Creating and managing VMs that will install and execute the code in the packages.</span></span>  

<span data-ttu-id="c8335-114">Jakmile jsou obě tyto klíčové procesy v místě, je krátký krok automaticky aktualizovat balíček systémem žádné konkrétní virtuální počítače, jako jsou vytvoření a nasazení nových verzí.</span><span class="sxs-lookup"><span data-stu-id="c8335-114">Once both of these core processes are in place, it’s a short step to automatically update the package running on any particular VM as new versions are created and deployed.</span></span>

## <a name="component-overview"></a><span data-ttu-id="c8335-115">– Přehled komponenty</span><span class="sxs-lookup"><span data-stu-id="c8335-115">Component overview</span></span>
<span data-ttu-id="c8335-116">Balíček správce například [výstižný get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) jsou poměrně dobře známé v celém světě Linux, ale není tak většinu na světě systému Windows.</span><span class="sxs-lookup"><span data-stu-id="c8335-116">Package managers such as [apt-get](https://en.wikipedia.org/wiki/Advanced_Packaging_Tool) are pretty well known in the Linux world, but not so much in the Windows world.</span></span>  <span data-ttu-id="c8335-117">[Chocolatey](https://chocolatey.org/) je taková věc a Scott Hanselman [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) v tomto tématu je skvělým úvod.</span><span class="sxs-lookup"><span data-stu-id="c8335-117">[Chocolatey](https://chocolatey.org/) is such a thing, and Scott Hanselman’s [blog](http://www.hanselman.com/blog/IsTheWindowsUserReadyForAptget.aspx) on the topic is a great intro.</span></span>  <span data-ttu-id="c8335-118">Stručně řečeno Chocolatey umožňuje instalovat balíčky z centrální úložiště balíčků do systému Windows pomocí příkazového řádku.</span><span class="sxs-lookup"><span data-stu-id="c8335-118">In a nutshell, Chocolatey allows you to install packages from a central repository of packages into a Windows system using the command line.</span></span>  <span data-ttu-id="c8335-119">Můžete vytvořit a spravovat vlastní úložiště, a Chocolatey mohou instalovat balíčky z libovolný počet úložiště, které určíte.</span><span class="sxs-lookup"><span data-stu-id="c8335-119">You can create and manage your own repository, and Chocolatey can install packages from any number of repositories that you designate.</span></span>

<span data-ttu-id="c8335-120">Požadovaného konfigurace stavu (DSC) ([přehled](https://technet.microsoft.com/library/dn249912.aspx)) je nástroj prostředí PowerShell, který umožňuje konfiguraci, kterou chcete použít pro počítače s deklarovat.</span><span class="sxs-lookup"><span data-stu-id="c8335-120">Desired State Configuration (DSC) ([overview](https://technet.microsoft.com/library/dn249912.aspx)) is a PowerShell tool that allows you to declare the configuration that you want for a machine.</span></span>  <span data-ttu-id="c8335-121">Řekněme například, je možné, "Chci, aby byla nainstalována Chocolatey, chci, aby byla nainstalována služba IIS, má být otevřený port 80, chci, aby byla verze 1.0.0 svého webu."</span><span class="sxs-lookup"><span data-stu-id="c8335-121">For example, you can say, “I want Chocolatey installed, I want IIS installed, I want port 80 opened, I want version 1.0.0 of my website installed.”</span></span>  <span data-ttu-id="c8335-122">DSC správce pro místní konfigurace (LCM) implementuje tuto konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="c8335-122">The DSC Local Configuration Manager (LCM) implements that configuration.</span></span> <span data-ttu-id="c8335-123">DSC pro vyžádání obsahu Server obsahuje úložiště konfigurace pro počítače.</span><span class="sxs-lookup"><span data-stu-id="c8335-123">A DSC Pull Server holds a repository of configurations for your machines.</span></span> <span data-ttu-id="c8335-124">LCM na každém počítači zkontroluje pravidelně Pokud odpovídá jeho konfigurace uložené konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="c8335-124">The LCM on each machine checks in periodically to see if its configuration matches the stored configuration.</span></span> <span data-ttu-id="c8335-125">Můžete buď sestavy stavu nebo pokus o přeneste počítač zpět do zarovnání uložené konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="c8335-125">It can either report status or attempt to bring the machine back into alignment with the stored configuration.</span></span> <span data-ttu-id="c8335-126">Můžete upravit konfiguraci uložené na tomto serveru způsobí počítače nebo sada počítačů začalo zarovnání změněné konfigurace.</span><span class="sxs-lookup"><span data-stu-id="c8335-126">You can edit the stored configuration on the pull server to cause a machine or set of machines to come into alignment with the changed configuration.</span></span>

<span data-ttu-id="c8335-127">Služby Azure Automation je spravovaná služba ve službě Microsoft Azure, který umožňuje automatizovat různé úlohy pomocí sady runbook, uzly, přihlašovací údaje, prostředky a prostředky, jako je například plány a globální proměnné.</span><span class="sxs-lookup"><span data-stu-id="c8335-127">Azure Automation is a managed service in Microsoft Azure that allows you to automate various tasks using runbooks, nodes, credentials, resources and assets such as schedules and global variables.</span></span> <span data-ttu-id="c8335-128">Azure Automation DSC rozšiřuje tyto schopnosti automation DSC prostředí PowerShell nástroje.</span><span class="sxs-lookup"><span data-stu-id="c8335-128">Azure Automation DSC extends this automation capability to include PowerShell DSC tools.</span></span>  <span data-ttu-id="c8335-129">Tady je skvělá [přehled](automation-dsc-overview.md).</span><span class="sxs-lookup"><span data-stu-id="c8335-129">Here’s a great [overview](automation-dsc-overview.md).</span></span>

<span data-ttu-id="c8335-130">Prostředek DSC je modul kódu, který má specifické možnosti, jako je například Správa sítě služby Active Directory nebo SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c8335-130">A DSC Resource is a module of code that has specific capabilities, such as managing networking, Active Directory, or SQL Server.</span></span>  <span data-ttu-id="c8335-131">Chocolatey prostředek DSC umí přístup k serveru NuGet (mimo jiné), stáhněte balíčky, instalovat balíčky a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c8335-131">The Chocolatey DSC Resource knows how to access a NuGet Server (among others), download packages, install packages, and so on.</span></span>  <span data-ttu-id="c8335-132">Existuje mnoho dalších prostředky DSC v [Galerie prostředí PowerShell](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span><span class="sxs-lookup"><span data-stu-id="c8335-132">There are many other DSC Resources in the [PowerShell Gallery](http://www.powershellgallery.com/packages?q=dsc+resources&prerelease=&sortOrder=package-title).</span></span>  <span data-ttu-id="c8335-133">Tyto moduly jsou nainstalovány do Azure Automation DSC pro vyžádání obsahu serveru (které jste), je možné použít vaše konfigurace.</span><span class="sxs-lookup"><span data-stu-id="c8335-133">These modules are installed into your Azure Automation DSC Pull Server (by you) so they can be used by your configurations.</span></span>

<span data-ttu-id="c8335-134">Šablony Resource Manageru poskytnout deklarativní způsob generování infrastruktury - věcmi, jako jsou sítě, podsítě, zabezpečení sítě a směrování, zatížení nástroje pro vyrovnávání, síťové adaptéry, virtuální počítače a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c8335-134">Resource Manager templates provide a declarative way of generating your infrastructure - things like networks, subnets, network security and routing, load balancers, NICs, VMs, and so on.</span></span>  <span data-ttu-id="c8335-135">Tady je [článku](../azure-resource-manager/resource-manager-deployment-model.md) který porovná modelu nasazení Resource Manager (deklarativní) s Azure Service Management (ASM nebo classic) nasazení modelu (imperativní) a popisuje zprostředkovatelé prostředků jádra, výpočty, úložiště a sítě.</span><span class="sxs-lookup"><span data-stu-id="c8335-135">Here’s an [article](../azure-resource-manager/resource-manager-deployment-model.md) that compares the Resource Manager deployment model (declarative) with the Azure Service Management (ASM, or classic) deployment model (imperative), and discusses the core resource providers, compute, storage and network.</span></span>

<span data-ttu-id="c8335-136">Klíčovou vlastností šablony správce prostředků je schopnost nainstalovat rozšíření virtuálního počítače do virtuálního počítače, jako je zřízený.</span><span class="sxs-lookup"><span data-stu-id="c8335-136">One key feature of an Resource Manager template is its ability to install a VM extension into the VM as it’s provisioned.</span></span>  <span data-ttu-id="c8335-137">Rozšíření virtuálního počítače má specifické možnosti, například při spuštění vlastního skriptu, instalaci antivirového softwaru nebo spouštění skriptu konfigurace DSC.</span><span class="sxs-lookup"><span data-stu-id="c8335-137">A VM extension has specific capabilities such as running a custom script, installing anti-virus software, or running a DSC configuration script.</span></span>  <span data-ttu-id="c8335-138">Existuje mnoho dalších typů rozšíření virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="c8335-138">There are many other types of VM extensions.</span></span>

## <a name="quick-trip-around-the-diagram"></a><span data-ttu-id="c8335-139">Rychlá cesta kolem diagramu</span><span class="sxs-lookup"><span data-stu-id="c8335-139">Quick trip around the diagram</span></span>
<span data-ttu-id="c8335-140">Spouštění v horní části, psaní kódu, sestavení a testování a pak vytvořit instalační balíček.</span><span class="sxs-lookup"><span data-stu-id="c8335-140">Starting at the top, you write your code, build and test, then create an installation package.</span></span>  <span data-ttu-id="c8335-141">Chocolatey může zpracovávat různých typů instalačních balíčků, jako je například MSI, MSU, ZIP.</span><span class="sxs-lookup"><span data-stu-id="c8335-141">Chocolatey can handle various types of installation packages, such as MSI, MSU, ZIP.</span></span>  <span data-ttu-id="c8335-142">A budete mít úplnou prostředí PowerShell pro případ Chocolatey na nativní funkce nejsou poměrně až vlastní instalace.</span><span class="sxs-lookup"><span data-stu-id="c8335-142">And you have the full power of PowerShell to do the actual installation if Chocolatey’s native capabilities aren’t quite up to it.</span></span>  <span data-ttu-id="c8335-143">Uvést balíček do někde dosažitelný – úložiště balíčků.</span><span class="sxs-lookup"><span data-stu-id="c8335-143">Put the package into someplace reachable – a package repository.</span></span>  <span data-ttu-id="c8335-144">Tento příklad použití používá do veřejné složky v účtu úložiště objektů blob v Azure, ale může být kdekoli.</span><span class="sxs-lookup"><span data-stu-id="c8335-144">This usage example uses a public folder in an Azure blob storage account, but it can be anywhere.</span></span>  <span data-ttu-id="c8335-145">Chocolatey funguje nativně se servery NuGet a některých jiných pro správu metadata balíčků.</span><span class="sxs-lookup"><span data-stu-id="c8335-145">Chocolatey works natively with NuGet servers and a few others for management of package metadata.</span></span>  <span data-ttu-id="c8335-146">[Tento článek](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) popisuje možnosti.</span><span class="sxs-lookup"><span data-stu-id="c8335-146">[This article](https://github.com/chocolatey/choco/wiki/How-To-Host-Feed) describes the options.</span></span>  <span data-ttu-id="c8335-147">Tento příklad použití používá NuGet.</span><span class="sxs-lookup"><span data-stu-id="c8335-147">This usage example uses NuGet.</span></span>  <span data-ttu-id="c8335-148">Nuspec je metadata o vašich balíčků.</span><span class="sxs-lookup"><span data-stu-id="c8335-148">A Nuspec is metadata about your packages.</span></span>  <span data-ttu-id="c8335-149">Nuspec jsou "zkompilovat" do na NuPkg a uloženo na serveru NuGet.</span><span class="sxs-lookup"><span data-stu-id="c8335-149">The Nuspec’s are “compiled” into NuPkg’s and stored in a NuGet server.</span></span>  <span data-ttu-id="c8335-150">Při konfiguraci požadavky balíček podle názvu a odkazuje na NuGet server, získá balíček Chocolatey prostředek DSC (nyní ve virtuálním počítači) a nainstaluje za vás.</span><span class="sxs-lookup"><span data-stu-id="c8335-150">When your configuration requests a package by name, and references a NuGet server, the Chocolatey DSC Resource (now on the VM) grabs the package and installs it for you.</span></span>  <span data-ttu-id="c8335-151">Také můžete vyžádat na konkrétní verzi balíčku.</span><span class="sxs-lookup"><span data-stu-id="c8335-151">You can also request a specific version of a package.</span></span>

<span data-ttu-id="c8335-152">V dolní části levého obrázku je šablonu Azure Resource Manager (ARM).</span><span class="sxs-lookup"><span data-stu-id="c8335-152">In the bottom left portion of the picture, there is an Azure Resource Manager (ARM) template.</span></span>  <span data-ttu-id="c8335-153">V tomto příkladu využití zaregistruje rozšíření virtuálního počítače virtuální počítač s Server Azure Automation DSC za (tedy vyžádání obsahu server) jako uzel.</span><span class="sxs-lookup"><span data-stu-id="c8335-153">In this usage example, the VM extension registers the VM with the Azure Automation DSC Pull Server (that is, a pull server) as a Node.</span></span>  <span data-ttu-id="c8335-154">Konfigurace je uložena na serveru vyžádané replikace.</span><span class="sxs-lookup"><span data-stu-id="c8335-154">The configuration is stored in the pull server.</span></span>  <span data-ttu-id="c8335-155">Ve skutečnosti, uloží se dvakrát: jednou jako prostý text a jakmile zkompilován jako soubor MOF (pro ty, které vědět o takové věci.)  Na portálu je MOF "konfigurace uzlu" (na rozdíl od jednoduše "konfigurace").</span><span class="sxs-lookup"><span data-stu-id="c8335-155">Actually, it’s stored twice: once as plain text and once compiled as an MOF file (for those that know about such things.)  In the portal, the MOF is a “node configuration” (as opposed to simply “configuration”).</span></span>  <span data-ttu-id="c8335-156">Je artefaktu, který je spojen s uzlem, tak uzel věděli, její konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="c8335-156">It’s the artifact that’s associated with a Node so the node will know its configuration.</span></span>  <span data-ttu-id="c8335-157">Níže uvedené podrobnosti ukazují, jak přiřadit konfigurace uzlu do uzlu.</span><span class="sxs-lookup"><span data-stu-id="c8335-157">Details below show how to assign the node configuration to the node.</span></span>

<span data-ttu-id="c8335-158">Pravděpodobně již provádíte bit v horní části nebo většinu ho.</span><span class="sxs-lookup"><span data-stu-id="c8335-158">Presumably you’re already doing the bit at the top, or most of it.</span></span>  <span data-ttu-id="c8335-159">Soubor nuspec vytváření, kompilace a ukládání na serveru NuGet je malý věcí.</span><span class="sxs-lookup"><span data-stu-id="c8335-159">Creating the nuspec, compiling and storing it in a NuGet server is a small thing.</span></span>  <span data-ttu-id="c8335-160">A už spravujete virtuální počítače.</span><span class="sxs-lookup"><span data-stu-id="c8335-160">And you’re already managing VMs.</span></span>  <span data-ttu-id="c8335-161">Provedením dalšího kroku k průběžné nasazování vyžaduje nastavení (jednou) načítacího serveru, registrace uzly s ním (jednou) a vytváření a ukládání konfigurace došlo (původně).</span><span class="sxs-lookup"><span data-stu-id="c8335-161">Taking the next step to continuous deployment requires setting up the pull server (once), registering your nodes with it (once), and creating and storing the configuration there (initially).</span></span>  <span data-ttu-id="c8335-162">Potom jako balíčky jsou upgradovány a nasazeny do úložiště aktualizujte konfiguraci a konfigurace uzlu na vyžádání serveru (opakování podle potřeby).</span><span class="sxs-lookup"><span data-stu-id="c8335-162">Then as packages are upgraded and deployed to the repository, refresh the Configuration and Node Configuration in the pull server (repeat as needed).</span></span>

<span data-ttu-id="c8335-163">Pokud nejsou od verze šablony ARM, který je také OK.</span><span class="sxs-lookup"><span data-stu-id="c8335-163">If you’re not starting with an ARM template, that’s also OK.</span></span>  <span data-ttu-id="c8335-164">Jsou navržené tak, aby vám pomůže registrovat virtuální počítače se serverem pro vyžádání obsahu a všechny ostatní rutiny prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8335-164">There are PowerShell cmdlets designed to help you register your VMs with the pull server and all of the rest.</span></span> <span data-ttu-id="c8335-165">Další podrobnosti najdete v tématu v tomto článku: [registrace počítačů pro správu Azure Automation DSC.](automation-dsc-onboarding.md)</span><span class="sxs-lookup"><span data-stu-id="c8335-165">For more details, see this article: [Onboarding machines for management by Azure Automation DSC](automation-dsc-onboarding.md)</span></span>

## <a name="step-1-setting-up-the-pull-server-and-automation-account"></a><span data-ttu-id="c8335-166">Krok 1: Vytvoření uživatelského účtu pro server a automatizace vyžádání obsahu</span><span class="sxs-lookup"><span data-stu-id="c8335-166">Step 1: Setting up the pull server and automation account</span></span>
<span data-ttu-id="c8335-167">V příkazovém řádku prostředí PowerShell (Add-AzureRmAccount) ověření: (může trvat několik minut vyžádání obsahu server je nastavený)</span><span class="sxs-lookup"><span data-stu-id="c8335-167">At an authenticated (Add-AzureRmAccount) PowerShell command line:  (can take a few minutes while the pull server is set up)</span></span>

    New-AzureRmResourceGroup –Name MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES
    New-AzureRmAutomationAccount –ResourceGroupName MY-AUTOMATION-RG –Location MY-RG-LOCATION-IN-QUOTES –Name MY-AUTOMATION-ACCOUNT 

<span data-ttu-id="c8335-168">Můžete vložit účtu automation do některé z následujících oblastí (neboli umístění): východní USA 2, Jižní střední USA, Virginia nám verze pro státní správu, západní Evropa, jihovýchodní Asie, Japonsko – východ, Indie centrální a Austrálie – jihovýchod, Střední Kanada, Severní Evropa.</span><span class="sxs-lookup"><span data-stu-id="c8335-168">You can put your automation account into any of the following regions (aka location):  East US 2, South Central US, US Gov Virginia, West Europe, Southeast Asia, Japan East, Central India and Australia Southeast, Canada Central, North Europe.</span></span>

## <a name="step-2-vm-extension-tweaks-to-the-arm-template"></a><span data-ttu-id="c8335-169">Krok 2: Virtuálního počítače rozšíření vylepšení do šablony ARM</span><span class="sxs-lookup"><span data-stu-id="c8335-169">Step 2: VM extension tweaks to the ARM template</span></span>
<span data-ttu-id="c8335-170">Podrobnosti registrace virtuálních počítačů (pomocí rozšíření virtuálního počítače DSC prostředí PowerShell) zadaný v tomto [šablony rychlý start Azure](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span><span class="sxs-lookup"><span data-stu-id="c8335-170">Details for VM registration (using the PowerShell DSC VM extension) provided in this [Azure Quickstart Template](https://github.com/Azure/azure-quickstart-templates/tree/master/dsc-extension-azure-automation-pullserver).</span></span>  <span data-ttu-id="c8335-171">Tento krok zaregistruje nový virtuální počítač se serverem pro vyžádání obsahu v seznamu uzlů DSC.</span><span class="sxs-lookup"><span data-stu-id="c8335-171">This step registers your new VM with the pull server in the list of DSC Nodes.</span></span>  <span data-ttu-id="c8335-172">Součástí této registrace je zadání konfigurace uzlu, který bude použit na uzlu.</span><span class="sxs-lookup"><span data-stu-id="c8335-172">Part of this registration is specifying the node configuration to be applied to the node.</span></span>  <span data-ttu-id="c8335-173">Tato konfigurace uzlu nemusí být ještě neexistuje na serveru vyžádané replikace, takže je OK, který krok 4 je, kde je to provést první.</span><span class="sxs-lookup"><span data-stu-id="c8335-173">This node configuration doesn't have to exist yet in the pull server, so it's OK that Step 4 is where this is done for the first time.</span></span>  <span data-ttu-id="c8335-174">Ale zde v kroku 2 je potřeba jste se rozhodli název uzlu a názvu konfigurace.</span><span class="sxs-lookup"><span data-stu-id="c8335-174">But here in Step 2 you do need to have decided the name of the node and the name of the configuration.</span></span>  <span data-ttu-id="c8335-175">V tomto příkladu využití uzlu je 'isvbox' a 'ISVBoxConfig' je v konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="c8335-175">In this usage example, the node is 'isvbox' and the configuration is 'ISVBoxConfig'.</span></span>  <span data-ttu-id="c8335-176">Proto se název konfigurace uzlu (Chcete-li být zadané v DeploymentTemplate.json) 'ISVBoxConfig.isvbox'.</span><span class="sxs-lookup"><span data-stu-id="c8335-176">So the node configuration name (to be specified in DeploymentTemplate.json) is 'ISVBoxConfig.isvbox'.</span></span>  

## <a name="step-3-adding-required-dsc-resources-to-the-pull-server"></a><span data-ttu-id="c8335-177">Krok 3: Přidání požadované prostředky DSC na server vyžádané replikace</span><span class="sxs-lookup"><span data-stu-id="c8335-177">Step 3: Adding required DSC resources to the pull server</span></span>
<span data-ttu-id="c8335-178">Galerie prostředí PowerShell je instrumentována instalace prostředků DSC do účtu Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="c8335-178">The PowerShell Gallery is instrumented to install DSC resources into your Azure Automation account.</span></span>  <span data-ttu-id="c8335-179">Přejděte k prostředku a klikněte na tlačítko "Nasadit do Azure Automation".</span><span class="sxs-lookup"><span data-stu-id="c8335-179">Navigate to the resource you want and click the “Deploy to Azure Automation” button.</span></span>

![Příklad galerie prostředí PowerShell](./media/automation-dsc-cd-chocolatey/xNetworking.PNG)

<span data-ttu-id="c8335-181">Jiné technika naposledy přidaný do portálu Azure můžete stáhnout nové moduly nebo aktualizovat existující moduly.</span><span class="sxs-lookup"><span data-stu-id="c8335-181">Another technique recently added to the Azure Portal allows you to pull in new modules or update existing modules.</span></span> <span data-ttu-id="c8335-182">Proklikejte se prostřednictvím prostředků účtu Automation, dlaždici prostředky a nakonec na dlaždici moduly.</span><span class="sxs-lookup"><span data-stu-id="c8335-182">Click through the Automation Account resource, the Assets tile, and finally the Modules tile.</span></span>  <span data-ttu-id="c8335-183">Ikona procházet galerii umožňuje zobrazit seznam modulů v galerii, Rozbalit podrobnosti a nakonec naimportovat do vašeho účtu Automation.</span><span class="sxs-lookup"><span data-stu-id="c8335-183">The Browse Gallery icon allows you to see the list of modules in the gallery, drill down into details and ultimately import into your Automation Account.</span></span> <span data-ttu-id="c8335-184">Toto je skvělý způsob, jak udržovat moduly aktuální čas od času.</span><span class="sxs-lookup"><span data-stu-id="c8335-184">This is a great way to keep your modules up to date from time to time.</span></span> <span data-ttu-id="c8335-185">A funkce importu zkontroluje závislosti s zajistit, že nic získá synchronizované z ostatních modulů.</span><span class="sxs-lookup"><span data-stu-id="c8335-185">And, the import feature checks dependencies with other modules to ensure nothing gets out of sync.</span></span>

<span data-ttu-id="c8335-186">Nebo je ruční metodu.</span><span class="sxs-lookup"><span data-stu-id="c8335-186">Or, there’s the manual approach.</span></span>  <span data-ttu-id="c8335-187">Struktura složek modulu integrace prostředí PowerShell pro počítač se systémem Windows se mírně liší od struktura složek očekávanou Azure Automation.</span><span class="sxs-lookup"><span data-stu-id="c8335-187">The folder structure of a PowerShell Integration Module for a Windows computer is a little different from the folder structure expected by the Azure Automation.</span></span>  <span data-ttu-id="c8335-188">To vyžaduje trochu postupně je upravujte z vaší strany.</span><span class="sxs-lookup"><span data-stu-id="c8335-188">This requires a little tweaking on your part.</span></span>  <span data-ttu-id="c8335-189">Ale není pevný a jeho se provádí jenom jednou za prostředků (Pokud chcete upgradovat v budoucnosti.)  Další informace o vytváření moduly integrace prostředí PowerShell, najdete v tomto článku: [vytváření modulů integrace pro Azure Automation.](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span><span class="sxs-lookup"><span data-stu-id="c8335-189">But it’s not hard, and it’s done only once per resource (unless you want to upgrade it in future.)  For more information on authoring PowerShell Integration Modules, see this article: [Authoring Integration Modules for Azure Automation](https://azure.microsoft.com/blog/authoring-integration-modules-for-azure-automation/)</span></span>

* <span data-ttu-id="c8335-190">Nainstalujte modul, který je nutné na pracovní stanici, následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c8335-190">Install the module that you need on your workstation, as follows:</span></span>
  * <span data-ttu-id="c8335-191">Nainstalujte [Windows Management Framework, verze 5](http://aka.ms/wmf5latest) (nejsou potřeba pro Windows 10)</span><span class="sxs-lookup"><span data-stu-id="c8335-191">Install [Windows Management Framework, v5](http://aka.ms/wmf5latest) (not needed for Windows 10)</span></span>
  * <span data-ttu-id="c8335-192">`Install-Module –Name MODULE-NAME`< – získá modul z Galerie Powershellu</span><span class="sxs-lookup"><span data-stu-id="c8335-192">`Install-Module –Name MODULE-NAME`    <—grabs the module from the PowerShell Gallery</span></span> 
* <span data-ttu-id="c8335-193">Zkopírujte složku modul z `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` do dočasné složky</span><span class="sxs-lookup"><span data-stu-id="c8335-193">Copy the module folder from `c:\Program Files\WindowsPowerShell\Modules\MODULE-NAME` to a temp folder</span></span> 
* <span data-ttu-id="c8335-194">Ukázky a dokumentace odstranit z hlavní složky</span><span class="sxs-lookup"><span data-stu-id="c8335-194">Delete samples and documentation from the main folder</span></span> 
* <span data-ttu-id="c8335-195">ZIP složce hlavní názvy souboru ZIP, stejně jako složka</span><span class="sxs-lookup"><span data-stu-id="c8335-195">Zip the main folder, naming the ZIP file exactly the same as the folder</span></span> 
* <span data-ttu-id="c8335-196">Soubor ZIP uvést do dosažitelný umístění HTTP, jako je například úložiště objektů blob v účtu úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="c8335-196">Put the ZIP file into a reachable HTTP location, such as blob storage in an Azure Storage Account.</span></span>
* <span data-ttu-id="c8335-197">Spusťte tuto prostředí PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c8335-197">Run this PowerShell:</span></span>
  
      New-AzureRmAutomationModule `
          -ResourceGroupName MY-AUTOMATION-RG -AutomationAccountName MY-AUTOMATION-ACCOUNT `
          -Name MODULE-NAME –ContentLink "https://STORAGE-URI/CONTAINERNAME/MODULE-NAME.zip"

<span data-ttu-id="c8335-198">Zahrnuté příklad provádí tyto kroky pro cChoco a xNetworking.</span><span class="sxs-lookup"><span data-stu-id="c8335-198">The included example performs these steps for cChoco and xNetworking.</span></span> <span data-ttu-id="c8335-199">Najdete v článku [poznámky](#notes) pro zvláštní zpracování pro cChoco.</span><span class="sxs-lookup"><span data-stu-id="c8335-199">See the [Notes](#notes) for special handling for cChoco.</span></span>

## <a name="step-4-adding-the-node-configuration-to-the-pull-server"></a><span data-ttu-id="c8335-200">Krok 4: Přidání konfigurace uzlu na server vyžádané replikace</span><span class="sxs-lookup"><span data-stu-id="c8335-200">Step 4: Adding the node configuration to the pull server</span></span>
<span data-ttu-id="c8335-201">Není co speciální o prvním importovat konfiguraci na vyžádání obsahu server a kompilaci.</span><span class="sxs-lookup"><span data-stu-id="c8335-201">There’s nothing special about the first time you import your configuration into the pull server and compile.</span></span>  <span data-ttu-id="c8335-202">Všechny následné importu/zkompiluje se stejnou konfigurací vypadat přesně stejně.</span><span class="sxs-lookup"><span data-stu-id="c8335-202">All subsequent import/compiles of the same configuration look exactly the same.</span></span>  <span data-ttu-id="c8335-203">Pokaždé, když vaše balíček aktualizace a muset poslat ho do produkčního prostředí proveďte tento krok, poté, co ověříte, že je konfigurační soubor správný – včetně novou verzi vašeho balíčku.</span><span class="sxs-lookup"><span data-stu-id="c8335-203">Each time you update your package and need to push it out to production you do this step after ensuring the configuration file is correct – including the new version of your package.</span></span>  <span data-ttu-id="c8335-204">Tady je konfigurační soubor a prostředí PowerShell:</span><span class="sxs-lookup"><span data-stu-id="c8335-204">Here’s the configuration file and PowerShell:</span></span>

<span data-ttu-id="c8335-205">ISVBoxConfig.ps1:</span><span class="sxs-lookup"><span data-stu-id="c8335-205">ISVBoxConfig.ps1:</span></span>

    Configuration ISVBoxConfig 
    { 
        Import-DscResource -ModuleName cChoco 
        Import-DscResource -ModuleName xNetworking

        Node "isvbox" {   

            cChocoInstaller installChoco 
            { 
                InstallDir = "C:\choco" 
            }

            WindowsFeature installIIS 
            { 
                Ensure="Present" 
                Name="Web-Server" 
            }

            xFirewall WebFirewallRule 
            { 
                Direction = "Inbound" 
                Name = "Web-Server-TCP-In" 
                DisplayName = "Web Server (TCP-In)" 
                Description = "IIS allow incoming web site traffic." 
                DisplayGroup = "IIS Incoming Traffic" 
                State = "Enabled" 
                Access = "Allow" 
                Protocol = "TCP" 
                LocalPort = "80" 
                Ensure = "Present" 
            }

            cChocoPackageInstaller trivialWeb 
            {            
                Name = "trivialweb" 
                Version = "1.0.0" 
                Source = “MY-NUGET-V2-SERVER-ADDRESS” 
                DependsOn = "[cChocoInstaller]installChoco", 
                "[WindowsFeature]installIIS" 
            } 
        }    
    }

<span data-ttu-id="c8335-206">Nový-ConfigurationScript.ps1:</span><span class="sxs-lookup"><span data-stu-id="c8335-206">New-ConfigurationScript.ps1:</span></span>

    Import-AzureRmAutomationDscConfiguration ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -SourcePath C:\temp\AzureAutomationDsc\ISVBoxConfig.ps1 ` 
        -Published –Force

    $jobData = Start-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -ConfigurationName ISVBoxConfig 

    $compilationJobId = $jobData.Id

    Get-AzureRmAutomationDscCompilationJob ` 
        -ResourceGroupName MY-AUTOMATION-RG –AutomationAccountName MY-AUTOMATION-ACCOUNT ` 
        -Id $compilationJobId

<span data-ttu-id="c8335-207">Tyto kroky výsledek v konfiguraci se nový uzel s názvem "ISVBoxConfig.isvbox" je uskutečnění na tomto serveru.</span><span class="sxs-lookup"><span data-stu-id="c8335-207">These steps result in a new node configuration named “ISVBoxConfig.isvbox” being placed on the pull server.</span></span>  <span data-ttu-id="c8335-208">Název konfigurace uzlu je vytvořena jako "configurationName.nodeName".</span><span class="sxs-lookup"><span data-stu-id="c8335-208">The node configuration name is built as “configurationName.nodeName”.</span></span>

## <a name="step-5-creating-and-maintaining-package-metadata"></a><span data-ttu-id="c8335-209">Krok 5: Vytvoření a údržbu metadata balíčků</span><span class="sxs-lookup"><span data-stu-id="c8335-209">Step 5: Creating and maintaining package metadata</span></span>
<span data-ttu-id="c8335-210">Pro každý balíček, který vložíte do úložiště balíčků budete potřebovat soubor nuspec, s popisem.</span><span class="sxs-lookup"><span data-stu-id="c8335-210">For each package that you put into the package repository, you need a nuspec that describes it.</span></span>  <span data-ttu-id="c8335-211">Tento soubor nuspec, je nutné zkompilovat a uložit na vašem serveru NuGet.</span><span class="sxs-lookup"><span data-stu-id="c8335-211">That nuspec must be compiled and stored in your NuGet server.</span></span> <span data-ttu-id="c8335-212">Tento proces je popsán [zde](http://docs.nuget.org/create/creating-and-publishing-a-package).</span><span class="sxs-lookup"><span data-stu-id="c8335-212">This process is described [here](http://docs.nuget.org/create/creating-and-publishing-a-package).</span></span>  <span data-ttu-id="c8335-213">MyGet.org slouží jako NuGet server.</span><span class="sxs-lookup"><span data-stu-id="c8335-213">You can use MyGet.org as a NuGet server.</span></span>  <span data-ttu-id="c8335-214">Prodeje této služby, ale mají starter SKU, které je právě volné.</span><span class="sxs-lookup"><span data-stu-id="c8335-214">They sell this service, but have a starter SKU that’s free.</span></span>  <span data-ttu-id="c8335-215">V NuGet.org najdete pokyny k instalaci NuGet server pro soukromé balíčky.</span><span class="sxs-lookup"><span data-stu-id="c8335-215">At NuGet.org you’ll find instructions on installing your own NuGet server for your private packages.</span></span>

## <a name="step-6-tying-it-all-together"></a><span data-ttu-id="c8335-216">Krok 6: Příkazů je všechny najednou</span><span class="sxs-lookup"><span data-stu-id="c8335-216">Step 6: Tying it all together</span></span>
<span data-ttu-id="c8335-217">Pokaždé, když na verzi předá QA a je schválená pro nasazení, balíček je vytvořen, nuspec a nupkg aktualizován a nasazeny na server NuGet.</span><span class="sxs-lookup"><span data-stu-id="c8335-217">Each time a version passes QA and is approved for deployment, the package is created, nuspec and nupkg updated and deployed to the NuGet server.</span></span>  <span data-ttu-id="c8335-218">Kromě toho konfigurace (kroku 4 výše) musí být aktualizovány na Souhlasím s nimi nové číslo verze.</span><span class="sxs-lookup"><span data-stu-id="c8335-218">In addition, the configuration (Step 4 above) must be updated to agree with the new version number.</span></span>  <span data-ttu-id="c8335-219">Musí být odeslány na server vyžádané replikace a zkompilovat.</span><span class="sxs-lookup"><span data-stu-id="c8335-219">It must be sent to the pull server and compiled.</span></span>  <span data-ttu-id="c8335-220">Od tohoto okamžiku je to na virtuální počítače, které závisí na tato konfigurace aktualizace pro vyžádání obsahu a nainstalujte ji.</span><span class="sxs-lookup"><span data-stu-id="c8335-220">From that point on, it's up to the VMs that depend on that configuration to pull the update and install it.</span></span>  <span data-ttu-id="c8335-221">Všechny tyto aktualizace jsou jednoduché - právě řádku nebo dva prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="c8335-221">Each of these updates are simple - just a line or two of PowerShell.</span></span>  <span data-ttu-id="c8335-222">V případě Visual Studio Team Services některé z nich zapouzdřené v sestavení úlohy, které může být zřetězen dohromady v sestavení.</span><span class="sxs-lookup"><span data-stu-id="c8335-222">In the case of Visual Studio Team Services, some of them are encapsulated in build tasks that can be chained together in a build.</span></span>  <span data-ttu-id="c8335-223">To [článku](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) obsahuje další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="c8335-223">This [article](https://www.visualstudio.com/en-us/docs/alm-devops-feature-index#continuous-delivery) provides more details.</span></span>  <span data-ttu-id="c8335-224">To [úložiště GitHub](https://github.com/Microsoft/vso-agent-tasks) podrobnosti různé úlohy dostupné sestavení.</span><span class="sxs-lookup"><span data-stu-id="c8335-224">This [GitHub repo](https://github.com/Microsoft/vso-agent-tasks) details the various available build tasks.</span></span>

## <a name="notes"></a><span data-ttu-id="c8335-225">Poznámky</span><span class="sxs-lookup"><span data-stu-id="c8335-225">Notes</span></span>
<span data-ttu-id="c8335-226">Tento příklad použití začíná virtuální počítač z bitové kopie obecné Windows Server 2012 R2 z Galerie Azure.</span><span class="sxs-lookup"><span data-stu-id="c8335-226">This usage example starts with a VM from a generic Windows Server 2012 R2 image from the Azure gallery.</span></span>  <span data-ttu-id="c8335-227">Můžete spustit z jakékoli uložené image a pak upravit odtud s konfigurací DSC.</span><span class="sxs-lookup"><span data-stu-id="c8335-227">You can start from any stored image and then tweak from there with the DSC configuration.</span></span>  <span data-ttu-id="c8335-228">Změna konfigurace, která je zaručená do bitové kopie, je však mnohem složitější než dynamicky aktualizuje se konfigurace pomocí DSC.</span><span class="sxs-lookup"><span data-stu-id="c8335-228">However, changing configuration that is baked into an image is much harder than dynamically updating the configuration using DSC.</span></span>

<span data-ttu-id="c8335-229">Nemáte pomocí šablony ARM a rozšíření virtuálního počítače můžete použít tento postup pomocí vašich virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="c8335-229">You don’t have to use an ARM template and the VM extension to use this technique with your VMs.</span></span>  <span data-ttu-id="c8335-230">A virtuální počítače nemusí být v Azure jako v části Správa disku CD.</span><span class="sxs-lookup"><span data-stu-id="c8335-230">And your VMs don’t have to be on Azure to be under CD management.</span></span>  <span data-ttu-id="c8335-231">Všechno, co je potřeba je nainstalované Chocolatey a LCM nakonfigurovaný na virtuálním počítači, takže bude vědět, kde je server pro vyžádání obsahu.</span><span class="sxs-lookup"><span data-stu-id="c8335-231">All that’s necessary is that Chocolatey be installed and the LCM configured on the VM so it knows where the pull server is.</span></span>  

<span data-ttu-id="c8335-232">Samozřejmě když aktualizujete balíček ve virtuálním počítači, který je v produkčním prostředí, budete muset provést tohoto virtuálního počítače mimo otočení při instalaci aktualizace.</span><span class="sxs-lookup"><span data-stu-id="c8335-232">Of course, when you update a package on a VM that’s in production, you need to take that VM out of rotation while the update is installed.</span></span>  <span data-ttu-id="c8335-233">Tento postup se výrazně liší.</span><span class="sxs-lookup"><span data-stu-id="c8335-233">How you do this varies widely.</span></span>  <span data-ttu-id="c8335-234">Například v případě virtuálních počítačů za pro vyrovnávání zatížení Azure, můžete přidat vlastní Probe.</span><span class="sxs-lookup"><span data-stu-id="c8335-234">For example, with a VM behind an Azure Load Balancer, you can add a Custom Probe.</span></span>  <span data-ttu-id="c8335-235">Při aktualizaci virtuálního počítače, mají koncový bod testu vrátit 400.</span><span class="sxs-lookup"><span data-stu-id="c8335-235">While updating the VM, have the probe endpoint return a 400.</span></span>  <span data-ttu-id="c8335-236">TweakUI potřeba způsobit, že tato změna může být v konfiguraci, jakou TweakUI přepnout zpět na vrácení 200 až po dokončení aktualizace.</span><span class="sxs-lookup"><span data-stu-id="c8335-236">The tweak necessary to cause this change can be inside your configuration, as can the tweak to switch it back to returning a 200 once the update is complete.</span></span>

<span data-ttu-id="c8335-237">Úplný zdrojový v tomto příkladu využití je v [tento projekt sady Visual Studio](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) na Githubu.</span><span class="sxs-lookup"><span data-stu-id="c8335-237">Full source for this usage example is in [this Visual Studio project](https://github.com/sebastus/ARM/tree/master/CDIaaSVM) on GitHub.</span></span>

## <a name="related-articles"></a><span data-ttu-id="c8335-238">Související články</span><span class="sxs-lookup"><span data-stu-id="c8335-238">Related Articles</span></span>
* [<span data-ttu-id="c8335-239">Přehled služby Azure Automation DSC</span><span class="sxs-lookup"><span data-stu-id="c8335-239">Azure Automation DSC Overview</span></span>](automation-dsc-overview.md)
* [<span data-ttu-id="c8335-240">Rutiny Azure Automation DSC</span><span class="sxs-lookup"><span data-stu-id="c8335-240">Azure Automation DSC cmdlets</span></span>](https://msdn.microsoft.com/library/mt244122.aspx)
* [<span data-ttu-id="c8335-241">Registrace počítačů pro správu Azure Automation DSC.</span><span class="sxs-lookup"><span data-stu-id="c8335-241">Onboarding machines for management by Azure Automation DSC</span></span>](automation-dsc-onboarding.md)


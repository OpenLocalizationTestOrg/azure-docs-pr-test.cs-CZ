---
title: "Zálohování SAP HANA Azure podle úložiště snímků | Microsoft Docs"
description: "Existují dvě hlavní zálohování možnosti pro SAP HANA na virtuálních počítačích Azure, tento článek se zabývá SAP HANA zálohování podle úložiště snímků"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: f332b8ac091b75a23489ac27f15ad1fd10d24ec6
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="67782-103">Zálohování SAP HANA založené na snímcích úložiště</span><span class="sxs-lookup"><span data-stu-id="67782-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="67782-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="67782-104">Introduction</span></span>

<span data-ttu-id="67782-105">Toto je část třemi částmi řady související články v záloze SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="67782-106">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md) poskytuje přehled a informace o začátcích, a [SAP HANA Azure Backup na úrovni souborů](sap-hana-backup-file-level.md) popisuje možnost zálohování na základě souborů.</span><span class="sxs-lookup"><span data-stu-id="67782-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>

<span data-ttu-id="67782-107">Při použití funkce zálohování virtuálních počítačů pro jednoduchou vše v jednom ukázku systém, jeden zvažte provedení zálohy virtuálního počítače místo Správa HANA zálohování na úrovni operačního systému.</span><span class="sxs-lookup"><span data-stu-id="67782-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at the OS level.</span></span> <span data-ttu-id="67782-108">Alternativou je k pořízení snímků objektů blob v Azure k vytvoření kopie jednotlivé virtuální disky, které jsou připojeny k virtuálnímu počítači, a zachovat HANA datových souborů.</span><span class="sxs-lookup"><span data-stu-id="67782-108">An alternative is to take Azure blob snapshots to create copies of individual virtual disks, which are attached to a virtual machine, and keep the HANA data files.</span></span> <span data-ttu-id="67782-109">Ale kritický bod konzistence aplikace při vytváření snímku zálohy nebo disk virtuálního počítače, zatímco systém zapnutý a spouštění.</span><span class="sxs-lookup"><span data-stu-id="67782-109">But a critical point is app consistency when creating a VM backup or disk snapshot while the system is up and running.</span></span> <span data-ttu-id="67782-110">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="67782-110">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="67782-111">SAP HANA obsahuje funkce, která podporuje tyto typy úložiště snímků.</span><span class="sxs-lookup"><span data-stu-id="67782-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="67782-112">Snímky SAP HANA</span><span class="sxs-lookup"><span data-stu-id="67782-112">SAP HANA snapshots</span></span>

<span data-ttu-id="67782-113">V SAP HANA, který podporuje pořizování snímku úložiště je funkce.</span><span class="sxs-lookup"><span data-stu-id="67782-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="67782-114">Od prosince 2016, je však omezení pro systémy jeden kontejner.</span><span class="sxs-lookup"><span data-stu-id="67782-114">However, as of December 2016, there is a restriction to single-container systems.</span></span> <span data-ttu-id="67782-115">Víceklientské kontejneru konfigurace nepodporují tento druh snímek databáze (viz [vytvořit úložiště snímků (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="67782-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="67782-116">Funguje takto:</span><span class="sxs-lookup"><span data-stu-id="67782-116">It works as follows:</span></span>

- <span data-ttu-id="67782-117">Příprava pro vytvoření snímku úložiště pomocí inicializace snímku SAP HANA</span><span class="sxs-lookup"><span data-stu-id="67782-117">Prepare for a storage snapshot by initiating the SAP HANA snapshot</span></span>
- <span data-ttu-id="67782-118">Spustit úložiště snímků (objektů blob v Azure vytvořit snímek, například)</span><span class="sxs-lookup"><span data-stu-id="67782-118">Run the storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="67782-119">Potvrďte snímku SAP HANA</span><span class="sxs-lookup"><span data-stu-id="67782-119">Confirm the SAP HANA snapshot</span></span>

![Tento snímek obrazovky ukazuje, že SAP HANA data snímku lze vytvořit pomocí příkazu jazyka SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="67782-121">Tento snímek obrazovky ukazuje, že SAP HANA data snímku lze vytvořit pomocí příkazu jazyka SQL.</span><span class="sxs-lookup"><span data-stu-id="67782-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Snímek pak se zobrazí také v katalogu zálohování v SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="67782-123">Snímek pak se zobrazí také v katalogu zálohování v SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="67782-123">The snapshot then also appears in the backup catalog in SAP HANA Studio.</span></span>

![Na disku snímku se zobrazí v adresáři data SAP HANA](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="67782-125">Na disku snímku se zobrazí v adresáři data SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-125">On disk, the snapshot shows up in the SAP HANA data directory.</span></span>

<span data-ttu-id="67782-126">Jeden má zajistit, aby konzistence systému souborů je také garantované před spuštěním úložiště snímku, zatímco SAP HANA je v režimu přípravy snímku.</span><span class="sxs-lookup"><span data-stu-id="67782-126">One has to ensure that the file system consistency is also guaranteed before running the storage snapshot while SAP HANA is in the snapshot preparation mode.</span></span> <span data-ttu-id="67782-127">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="67782-127">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="67782-128">Po dokončení úložiště snímků je důležité pro potvrzení snímku SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-128">Once the storage snapshot is done, it is critical to confirm the SAP HANA snapshot.</span></span> <span data-ttu-id="67782-129">Neexistuje odpovídající ke spuštění příkazu jazyka SQL: zavřít SNÍMKU zálohování dat (v tématu [dat zavřít SNÍMKU příkaz BACKUP (zálohování a obnovení)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="67782-129">There is a corresponding SQL statement to run: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="67782-130">Potvrďte HANA snímku.</span><span class="sxs-lookup"><span data-stu-id="67782-130">Confirm the HANA snapshot.</span></span> <span data-ttu-id="67782-131">Z důvodu &quot;kopie při zápisu,&quot; SAP HANA může vyžadovat další místo na disku v Příprava snímku režimu, a není možné spustit nové zálohování, dokud je potvrzen snímku SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-131">Due to &quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible to start new backups until the SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="67782-132">Zálohování virtuálních počítačů HANA prostřednictvím služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="67782-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="67782-133">Od prosince 2016 zálohování agent služby Azure Backup není k dispozici pro virtuální počítače s Linuxem.</span><span class="sxs-lookup"><span data-stu-id="67782-133">As of December 2016, the backup agent of the Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="67782-134">Chcete-li používat Azure zálohování na úrovni soubor nebo adresář, jeden by zkopírujte SAP HANA záložní soubory pro virtuální počítač s Windows a potom pomocí agenta zálohování.</span><span class="sxs-lookup"><span data-stu-id="67782-134">To make use of Azure backup on the file/directory level, one would copy SAP HANA backup files to a Windows VM and then use the backup agent.</span></span> <span data-ttu-id="67782-135">Pouze úplná záloha virtuálního počítače s Linuxem, jinak je možné pomocí služby zálohování Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-135">Otherwise, only a full Linux VM backup is possible via the Azure Backup service.</span></span> <span data-ttu-id="67782-136">V tématu [přehled funkcí zálohování Azure](../../../backup/backup-introduction-to-azure-backup.md) Další.</span><span class="sxs-lookup"><span data-stu-id="67782-136">See [Overview of the features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) to find out more.</span></span>

<span data-ttu-id="67782-137">Služba Azure Backup nabízí možnost pro zálohování a obnovení virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="67782-137">The Azure Backup service offers an option to back up and restore a VM.</span></span> <span data-ttu-id="67782-138">Další informace o této služby a jak to funguje najdete v článku [plánování vaší infrastruktury zálohování virtuálních počítačů v Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="67782-138">More information about this service and how it works can be found in the article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="67782-139">Existují dvě důležité aspekty podle tohoto článku:</span><span class="sxs-lookup"><span data-stu-id="67782-139">There are two important considerations according to that article:</span></span>

<span data-ttu-id="67782-140">_&quot;Pro virtuální počítače s Linuxem je možné, pouze konzistentními soubory zálohy, protože Linux není má ekvivalentní platformu pro službu VSS.&quot;_</span><span class="sxs-lookup"><span data-stu-id="67782-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform to VSS.&quot;_</span></span>

<span data-ttu-id="67782-141">_&quot;Aplikace je třeba implementovat vlastní &quot;opravu&quot; mechanismus na obnovená data.&quot;_</span><span class="sxs-lookup"><span data-stu-id="67782-141">_&quot;Applications need to implement their own &quot;fix-up&quot; mechanism on the restored data.&quot;_</span></span>

<span data-ttu-id="67782-142">Proto jeden má zajistěte, aby byl SAP HANA v konzistentním stavu na disku při spuštění zálohování.</span><span class="sxs-lookup"><span data-stu-id="67782-142">Therefore, one has to make sure SAP HANA is in a consistent state on disk when the backup starts.</span></span> <span data-ttu-id="67782-143">V tématu _SAP HANA snímky_ popsané dříve v dokumentu.</span><span class="sxs-lookup"><span data-stu-id="67782-143">See _SAP HANA snapshots_ described earlier in the document.</span></span> <span data-ttu-id="67782-144">Ale existuje potenciální problém při SAP HANA zůstane v tomto režimu přípravy snímku.</span><span class="sxs-lookup"><span data-stu-id="67782-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="67782-145">V tématu [vytvořit úložiště snímků (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) Další informace.</span><span class="sxs-lookup"><span data-stu-id="67782-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="67782-146">Tento článek stavy:</span><span class="sxs-lookup"><span data-stu-id="67782-146">That article states:</span></span>

<span data-ttu-id="67782-147">_&quot;Důrazně doporučujeme k potvrzení, nebo zrušte snímku úložiště co nejdříve po jeho vytvoření. Když se snímek úložiště připravené nebo vytvořili, snímek příslušných dat nereaguje. Při současném zachování ukotvené snímek příslušných dat, může stále provádět změny v databázi. Tyto změny nezpůsobí ukotvené snímek příslušných dat se musí změnit. Místo toho změny se zapisují do pozice v datové oblasti, které jsou oddělené od snímku úložiště. Změny se zapisují taky do protokolu. Ale tím déle snímek příslušných dat je udržováno ukotvené, čím můžou růst datový svazek.&quot;_</span><span class="sxs-lookup"><span data-stu-id="67782-147">_&quot;It is strongly recommended to confirm or abandon a storage snapshot as soon as possible after it has been created. While the storage snapshot is being prepared or created, the snapshot-relevant data is frozen. While the snapshot-relevant data remains frozen, changes can still be made in the database. Such changes will not cause the frozen snapshot-relevant data to be changed. Instead, the changes are written to positions in the data area that are separate from the storage snapshot. Changes are also written to the log. However, the longer the snapshot-relevant data is kept frozen, the more the data volume can grow.&quot;_</span></span>

<span data-ttu-id="67782-148">Zálohování Azure má na starosti konzistence systému souborů prostřednictvím rozšíření virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-148">Azure Backup takes care of the file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="67782-149">Tato rozšíření nejsou k dispozici samostatná a fungovat pouze v kombinaci s služby zálohování Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="67782-150">Je však stále požadavek na správu SAP HANA snímku zaručit konzistenci aplikace.</span><span class="sxs-lookup"><span data-stu-id="67782-150">Nevertheless, it is still a requirement to manage an SAP HANA snapshot to guarantee app consistency.</span></span>

<span data-ttu-id="67782-151">Zálohování Azure má dva hlavní fáze:</span><span class="sxs-lookup"><span data-stu-id="67782-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="67782-152">Pořízení snímku</span><span class="sxs-lookup"><span data-stu-id="67782-152">Take Snapshot</span></span>
- <span data-ttu-id="67782-153">Přenos dat do trezoru</span><span class="sxs-lookup"><span data-stu-id="67782-153">Transfer data to vault</span></span>

<span data-ttu-id="67782-154">Po dokončení fázi služby Azure Backup pořízení snímku apod. může potvrďte snímku SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-154">So one could confirm the SAP HANA snapshot once the Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="67782-155">Může trvat několik minut, pokud chcete zobrazit na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-155">It might take several minutes to see in the Azure portal.</span></span>

![Následující obrázek ukazuje součást úlohy zálohování seznamu služby Azure Backup](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="67782-157">Následující obrázek ukazuje části seznamu úlohu zálohování Azure Backup služby, který byl použit k zálohování HANA testovací virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="67782-157">This figure shows part of the backup job list of an Azure Backup service, which was used to back up the HANA test VM.</span></span>

![Chcete-li zobrazit podrobnosti úlohy, klikněte na úlohu zálohování na portálu Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="67782-159">Chcete-li zobrazit podrobnosti úlohy, klikněte na úlohu zálohování na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-159">To show the job details, click the backup job in the Azure portal.</span></span> <span data-ttu-id="67782-160">Zde jeden můžete vidět dvě fáze.</span><span class="sxs-lookup"><span data-stu-id="67782-160">Here, one can see the two phases.</span></span> <span data-ttu-id="67782-161">Může trvat několik minut, dokud se zobrazí fázi snímků jako dokončenou.</span><span class="sxs-lookup"><span data-stu-id="67782-161">It might take a few minutes until it shows the snapshot phase as completed.</span></span> <span data-ttu-id="67782-162">Ve většině případů je stráví ve fázi data.</span><span class="sxs-lookup"><span data-stu-id="67782-162">Most of the time is spent in the data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="67782-163">Zálohování automatizace HANA virtuálních počítačů pomocí služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="67782-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="67782-164">SAP HANA snímku jeden může potvrdit, ručně po dokončení fázi Azure Backup snímku, jak je popsáno výše, ale je vhodné zvážit automatizace, protože správce nemusí monitorování seznamu úlohu zálohování na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-164">One could manually confirm the SAP HANA snapshot once the Azure Backup snapshot phase is completed, as described earlier, but it is helpful to consider automation because an admin might not monitor the backup job list in the Azure portal.</span></span>

<span data-ttu-id="67782-165">Následuje vysvětlení, jak je možné dosáhnout pomocí rutin prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="67782-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Služby Azure Backup byl vytvořen s názvem hana--úložiště záloh](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="67782-167">Služby Azure Backup byl vytvořen s názvem &quot;hana úložiště záloh.&quot; Příkaz PS **Get AzureRmRecoveryServicesVault-název úložiště záloh hana** načte odpovídající objekt.</span><span class="sxs-lookup"><span data-stu-id="67782-167">An Azure Backup service was created with the name &quot;hana-backup-vault.&quot; The PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves the corresponding object.</span></span> <span data-ttu-id="67782-168">Tento objekt se pak používá nastavit kontext zálohování, jak je vidět na následující obrázek.</span><span class="sxs-lookup"><span data-stu-id="67782-168">This object is then used to set the backup context as seen on the next figure.</span></span>

![Jeden můžete zkontrolovat pro aktuálně probíhá úloha zálohování](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="67782-170">Po nastavení správný kontext, jeden kontrolovat aktuálně probíhá úloha zálohování a potom vyhledejte jeho podrobnosti úlohy.</span><span class="sxs-lookup"><span data-stu-id="67782-170">After setting the correct context, one can check for the backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="67782-171">V seznamu dílčí úlohy uvedena, pokud je již dokončeno fázi snímku Azure úlohy zálohování:</span><span class="sxs-lookup"><span data-stu-id="67782-171">The subtask list shows if the snapshot phase of the Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Dotazování hodnota ve smyčce, dokud se změní na dokončeno](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="67782-173">Jakmile podrobnosti úlohy jsou uložené v proměnné, je jednoduše PS syntaxe mít přístup k první vstupní pole a načíst hodnotu stavu.</span><span class="sxs-lookup"><span data-stu-id="67782-173">Once the job details are stored in a variable, it is simply PS syntax to get to the first array entry and retrieve the status value.</span></span> <span data-ttu-id="67782-174">K dokončení skriptu pro automatizaci, dotazování hodnota ve smyčce, dokud se změní &quot;dokončeno.&quot;</span><span class="sxs-lookup"><span data-stu-id="67782-174">To complete the automation script, poll the value in a loop until it turns to &quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="67782-175">Licenční klíč HANA a virtuální počítač obnovit pomocí služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="67782-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="67782-176">Služba Azure Backup je určené k vytvoření nového virtuálního počítače během obnovení.</span><span class="sxs-lookup"><span data-stu-id="67782-176">The Azure Backup service is designed to create a new VM during restore.</span></span> <span data-ttu-id="67782-177">Neexistuje žádný plán teď chcete &quot;na místě&quot; obnovení existující virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-177">There is no plan right now to do an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Následující obrázek ukazuje možnost obnovení služby Azure na portálu Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="67782-179">Následující obrázek ukazuje možnost obnovení služby Azure na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-179">This figure shows the restore option of the Azure service in the Azure portal.</span></span> <span data-ttu-id="67782-180">Jeden můžete vybrat mezi vytvoření virtuálního počítače během obnovení nebo při obnovování disky.</span><span class="sxs-lookup"><span data-stu-id="67782-180">One can choose between creating a VM during restore or restoring the disks.</span></span> <span data-ttu-id="67782-181">Po obnovení disků, je stále nutné vytvořit nový virtuální počítač nad ho.</span><span class="sxs-lookup"><span data-stu-id="67782-181">After restoring the disks, it is still necessary to create a new VM on top of it.</span></span> <span data-ttu-id="67782-182">Při každém vytvoření nového virtuálního počítače se vytvoří v Azure jedinečné ID virtuálního počítače změní (viz [zpřístupnění a pomocí jedinečné ID virtuálního počítače Azure](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="67782-182">Whenever a new VM gets created on Azure the unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Následující obrázek ukazuje jedinečné ID virtuálního počítače Azure před a po obnovení pomocí služby zálohování Azure](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="67782-184">Následující obrázek ukazuje jedinečné ID virtuálního počítače Azure, před a po obnovení pomocí služby zálohování Azure.</span><span class="sxs-lookup"><span data-stu-id="67782-184">This figure shows the Azure VM unique ID before and after the restore via Azure Backup service.</span></span> <span data-ttu-id="67782-185">Klíč hardwaru SAP, který se používá pro SAP licencování, používá tato jedinečné ID virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="67782-185">The SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="67782-186">V důsledku toho novou licenci SAP musí být nainstalovaná po obnovení virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="67782-186">As a consequence, a new SAP license has to be installed after a VM restore.</span></span>

<span data-ttu-id="67782-187">Nová funkce Azure Backup se zobrazí v režimu náhledu při vytváření této příručce zálohování.</span><span class="sxs-lookup"><span data-stu-id="67782-187">A new Azure Backup feature was presented in preview mode during the creation of this backup guide.</span></span> <span data-ttu-id="67782-188">To umožňuje obnovení souboru úrovně založené na snímku virtuálního počítače, která byla provedena pro virtuální počítač zálohování.</span><span class="sxs-lookup"><span data-stu-id="67782-188">It allows a file level restore based on the VM snapshot that was taken for the VM backup.</span></span> <span data-ttu-id="67782-189">Díky tomu není nutné k nasazení nového virtuálního počítače a proto jedinečné ID virtuálního počítače zůstane stejný a není třeba žádný nový licenční klíč SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="67782-189">This avoids the need to deploy a new VM, and therefore the unique VM ID stays the same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="67782-190">Další dokumentaci k této funkce bude poskytnuta po je plně testována.</span><span class="sxs-lookup"><span data-stu-id="67782-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="67782-191">Zálohování Azure vám umožní nakonec zálohování Azure jednotlivé virtuální disky, a soubory a adresáře z ve virtuálním počítači.</span><span class="sxs-lookup"><span data-stu-id="67782-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside the VM.</span></span> <span data-ttu-id="67782-192">Hlavní výhodou Azure Backup je jeho správu všechny zálohy, ukládání zákazník muset provést.</span><span class="sxs-lookup"><span data-stu-id="67782-192">A major advantage of Azure Backup is its management of all the backups, saving the customer from having to do it.</span></span> <span data-ttu-id="67782-193">Pokud obnovení je nutné, bude zálohování Azure vyberte správné zálohu pro případ.</span><span class="sxs-lookup"><span data-stu-id="67782-193">If a restore becomes necessary, Azure Backup will select the correct backup to use.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="67782-194">Zálohování virtuálních počítačů SAP HANA prostřednictvím snímku ruční disku</span><span class="sxs-lookup"><span data-stu-id="67782-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="67782-195">Místo použití služba Azure Backup, jeden může konfigurovat jednotlivých řešení zálohování vytváření snímků objektu blob Azure virtuální pevné disky ručně pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="67782-195">Instead of using the Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="67782-196">V tématu [snímky použití objektů blob v prostředí PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) popis kroků.</span><span class="sxs-lookup"><span data-stu-id="67782-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of the steps.</span></span>

<span data-ttu-id="67782-197">Poskytuje větší flexibilitu, ale nevyřeší problémy popsané výše v tomto dokumentu:</span><span class="sxs-lookup"><span data-stu-id="67782-197">It provides more flexibility but does not resolve the issues explained earlier in this document:</span></span>

- <span data-ttu-id="67782-198">Jeden stále musí Ujistěte se, že SAP HANA je v konzistentním stavu</span><span class="sxs-lookup"><span data-stu-id="67782-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="67782-199">Disk operačního systému nelze přepsat, i když je virtuální počítač navrácený z důvodu chyby s oznámením, že existuje zapůjčení.</span><span class="sxs-lookup"><span data-stu-id="67782-199">The OS disk cannot be overwritten even if the VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="67782-200">Funguje pouze po odstranění virtuálního počítače, což by vedlo k nové jedinečné ID virtuálního počítače a není nutné nainstalovat novou licenci SAP.</span><span class="sxs-lookup"><span data-stu-id="67782-200">It only works after deleting the VM, which would lead to a new unique VM ID and the need to install a new SAP license.</span></span>

![Je možné obnovit pouze datových disků virtuálního počítače Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="67782-202">Je možné obnovit pouze datových disků virtuálního počítače Azure, zabraňující problém získávání nové jedinečné ID virtuálního počítače a, proto zrušena SAP licencí:</span><span class="sxs-lookup"><span data-stu-id="67782-202">It is possible to restore only the data disks of an Azure VM, avoiding the problem of getting a new unique VM ID and, therefore, invalidated the SAP license:</span></span>

- <span data-ttu-id="67782-203">Pro test dva disky dat Azure byla připojena k virtuálnímu počítači a použít jako byl definován softwaru diskového pole RAID</span><span class="sxs-lookup"><span data-stu-id="67782-203">For the test, two Azure data disks were attached to a VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="67782-204">Funkce snímku SAP HANA bylo potvrzeno, že SAP HANA bylo v konzistentním stavu</span><span class="sxs-lookup"><span data-stu-id="67782-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="67782-205">Freeze – systém souborů (v tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="67782-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="67782-206">Objekt BLOB snímky byly odebrány z obou datových disků</span><span class="sxs-lookup"><span data-stu-id="67782-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="67782-207">Uvolní systému souborů</span><span class="sxs-lookup"><span data-stu-id="67782-207">File system unfreeze</span></span>
- <span data-ttu-id="67782-208">Potvrzení snímku SAP HANA</span><span class="sxs-lookup"><span data-stu-id="67782-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="67782-209">Pokud chcete obnovit datové disky, byl virtuální počítač vypnout a odpojit oba disky</span><span class="sxs-lookup"><span data-stu-id="67782-209">To restore the data disks, the VM was shut down and both disks detached</span></span>
- <span data-ttu-id="67782-210">Po odpojení disky, měla přepsat se snímky bývalé objektů blob</span><span class="sxs-lookup"><span data-stu-id="67782-210">After detaching the disks, they were overwritten with the former blob snapshots</span></span>
- <span data-ttu-id="67782-211">Pak se obnovený virtuálních disků připojených znovu k virtuálnímu počítači</span><span class="sxs-lookup"><span data-stu-id="67782-211">Then the restored virtual disks were attached again to the VM</span></span>
- <span data-ttu-id="67782-212">Po spuštění virtuálního počítače, vše na softwaru diskového pole RAID fungovala bez problémů a byla nastavena zpět na čas snímku objektů blob</span><span class="sxs-lookup"><span data-stu-id="67782-212">After starting the VM, everything on the software RAID worked fine and was set back to the blob snapshot time</span></span>
- <span data-ttu-id="67782-213">HANA se nastaví zpět na snímku HANA</span><span class="sxs-lookup"><span data-stu-id="67782-213">HANA was set back to the HANA snapshot</span></span>

<span data-ttu-id="67782-214">Pokud bylo možné vypnout SAP HANA před snímky objektů blob, bude postup méně složitých.</span><span class="sxs-lookup"><span data-stu-id="67782-214">If it was possible to shut down SAP HANA before the blob snapshots, the procedure would be less complex.</span></span> <span data-ttu-id="67782-215">V takovém případě jeden může přeskočit HANA snímku a, pokud nic jiného se děje v systému, také přeskočit zablokování systému souborů.</span><span class="sxs-lookup"><span data-stu-id="67782-215">In that case, one could skip the HANA snapshot and, if nothing else is going on in the system, also skip the file system freeze.</span></span> <span data-ttu-id="67782-216">Náročnost dodává do obrázku, pokud je potřeba udělat snímky, zatímco všechno, co je online.</span><span class="sxs-lookup"><span data-stu-id="67782-216">Added complexity comes into the picture when it is necessary to do snapshots while everything is online.</span></span> <span data-ttu-id="67782-217">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="67782-217">See _SAP HANA data consistency when taking storage snapshots_ in the related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="67782-218">Další kroky</span><span class="sxs-lookup"><span data-stu-id="67782-218">Next steps</span></span>
* <span data-ttu-id="67782-219">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md) nabízí přehled a informace o zahájení práce.</span><span class="sxs-lookup"><span data-stu-id="67782-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="67782-220">[Na základě SAP HANA zálohování na úrovni souborů](sap-hana-backup-file-level.md) popisuje možnost zálohování na základě souborů.</span><span class="sxs-lookup"><span data-stu-id="67782-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers the file-based backup option.</span></span>
* <span data-ttu-id="67782-221">Další informace o vytvoření vysoké dostupnosti a plán pro zotavení po havárii SAP HANA v Azure (velké instance) naleznete v tématu [SAP HANA (velké instance) vysoké dostupnosti a zotavení po havárii v Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="67782-221">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

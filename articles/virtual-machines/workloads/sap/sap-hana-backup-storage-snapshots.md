---
title: "zálohování HANA Azure aaaSAP podle úložiště snímků | Microsoft Docs"
description: "Existují dvě hlavní zálohování možnosti pro SAP HANA na virtuálních počítačích Azure, tento článek se zabývá SAP HANA zálohování podle úložiště snímků"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 32bb80f5a928a2cf63699bfe4f4cf5bbad81e6fe
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="sap-hana-backup-based-on-storage-snapshots"></a><span data-ttu-id="cf3a7-103">Zálohování SAP HANA založené na snímcích úložiště</span><span class="sxs-lookup"><span data-stu-id="cf3a7-103">SAP HANA backup based on storage snapshots</span></span>

## <a name="introduction"></a><span data-ttu-id="cf3a7-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="cf3a7-104">Introduction</span></span>

<span data-ttu-id="cf3a7-105">Toto je část třemi částmi řady související články v záloze SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="cf3a7-106">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md) poskytuje přehled a informace o začátcích, a [SAP HANA Azure Backup na úrovni souborů](sap-hana-backup-file-level.md) zahrnuje hello možnost zálohování na základě souborů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-106">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA Azure Backup on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>

<span data-ttu-id="cf3a7-107">Při použití funkce zálohování virtuálních počítačů pro jednoduchou vše v jednom ukázku systém, jeden zvažte provedení zálohy virtuálního počítače místo Správa HANA zálohy v hello úroveň operačního systému.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-107">When using a VM backup feature for a single-instance all-in-one demo system, one should consider doing a VM backup instead of managing HANA backups at hello OS level.</span></span> <span data-ttu-id="cf3a7-108">Alternativou je tootake objektů blob v Azure snímky toocreate kopie jednotlivé virtuální disky, které jsou připojené tooa virtuálního počítače a udržovat hello HANA datových souborů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-108">An alternative is tootake Azure blob snapshots toocreate copies of individual virtual disks, which are attached tooa virtual machine, and keep hello HANA data files.</span></span> <span data-ttu-id="cf3a7-109">Ale kritický bod konzistence aplikace při vytváření snímku zálohy nebo disk virtuálního počítače při hello systém zapnutý a spouštění.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-109">But a critical point is app consistency when creating a VM backup or disk snapshot while hello system is up and running.</span></span> <span data-ttu-id="cf3a7-110">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku hello [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-110">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span> <span data-ttu-id="cf3a7-111">SAP HANA obsahuje funkce, která podporuje tyto typy úložiště snímků.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-111">SAP HANA has a feature that supports these kinds of storage snapshots.</span></span>

## <a name="sap-hana-snapshots"></a><span data-ttu-id="cf3a7-112">Snímky SAP HANA</span><span class="sxs-lookup"><span data-stu-id="cf3a7-112">SAP HANA snapshots</span></span>

<span data-ttu-id="cf3a7-113">V SAP HANA, který podporuje pořizování snímku úložiště je funkce.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-113">There is a feature in SAP HANA that supports taking a storage snapshot.</span></span> <span data-ttu-id="cf3a7-114">Od prosince 2016, je však omezení systémy toosingle kontejneru.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-114">However, as of December 2016, there is a restriction toosingle-container systems.</span></span> <span data-ttu-id="cf3a7-115">Víceklientské kontejneru konfigurace nepodporují tento druh snímek databáze (viz [vytvořit úložiště snímků (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-115">Multitenant container configurations do not support this kind of database snapshot (see [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm)).</span></span>

<span data-ttu-id="cf3a7-116">Funguje takto:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-116">It works as follows:</span></span>

- <span data-ttu-id="cf3a7-117">Příprava pro vytvoření snímku úložiště pomocí inicializace snímku hello SAP HANA</span><span class="sxs-lookup"><span data-stu-id="cf3a7-117">Prepare for a storage snapshot by initiating hello SAP HANA snapshot</span></span>
- <span data-ttu-id="cf3a7-118">Spustit hello úložiště snímků (objektů blob v Azure vytvořit snímek, například)</span><span class="sxs-lookup"><span data-stu-id="cf3a7-118">Run hello storage snapshot (Azure blob snapshot, for example)</span></span>
- <span data-ttu-id="cf3a7-119">Potvrďte snímku hello SAP HANA</span><span class="sxs-lookup"><span data-stu-id="cf3a7-119">Confirm hello SAP HANA snapshot</span></span>

![Tento snímek obrazovky ukazuje, že SAP HANA data snímku lze vytvořit pomocí příkazu jazyka SQL](media/sap-hana-backup-storage-snapshots/image011.png)

<span data-ttu-id="cf3a7-121">Tento snímek obrazovky ukazuje, že SAP HANA data snímku lze vytvořit pomocí příkazu jazyka SQL.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-121">This screenshot shows that an SAP HANA data snapshot can be created via a SQL statement.</span></span>

![Hello snímku pak se zobrazí také v hello zálohování katalogu v nástroji SAP HANA Studio](media/sap-hana-backup-storage-snapshots/image012.png)

<span data-ttu-id="cf3a7-123">Hello snímku pak se zobrazí také v hello zálohování katalogu v nástroji SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-123">hello snapshot then also appears in hello backup catalog in SAP HANA Studio.</span></span>

![Na disku hello snímku se zobrazí v adresáři data hello SAP HANA](media/sap-hana-backup-storage-snapshots/image013.png)

<span data-ttu-id="cf3a7-125">Na disku hello snímku se objeví v adresáři data hello SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-125">On disk, hello snapshot shows up in hello SAP HANA data directory.</span></span>

<span data-ttu-id="cf3a7-126">Jeden má tooensure, který před spuštěním hello úložiště snímků během SAP HANA režim přípravy snímku hello také zaručeně hello konzistence systému souborů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-126">One has tooensure that hello file system consistency is also guaranteed before running hello storage snapshot while SAP HANA is in hello snapshot preparation mode.</span></span> <span data-ttu-id="cf3a7-127">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku hello [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-127">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

<span data-ttu-id="cf3a7-128">Po dokončení hello úložiště snímků je důležité tooconfirm hello SAP HANA snímku.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-128">Once hello storage snapshot is done, it is critical tooconfirm hello SAP HANA snapshot.</span></span> <span data-ttu-id="cf3a7-129">Neexistuje odpovídající toorun příkaz SQL: zavřít SNÍMKU dat zálohy (v tématu [dat zavřít SNÍMKU příkaz BACKUP (zálohování a obnovení)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-129">There is a corresponding SQL statement toorun: BACKUP DATA CLOSE SNAPSHOT (see [BACKUP DATA CLOSE SNAPSHOT Statement (Backup and Recovery)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/c3/9739966f7f4bd5818769ad4ce6a7f8/content.htm)).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="cf3a7-130">Potvrďte hello HANA snímku.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-130">Confirm hello HANA snapshot.</span></span> <span data-ttu-id="cf3a7-131">Kvůli příliš&quot;kopie při zápisu,&quot; SAP HANA může vyžadovat další místo na disku v Příprava snímku režimu, a není možné toostart nových záloh. dokud hello SAP HANA snímku je potvrzen.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-131">Due too&quot;Copy-on-Write,&quot; SAP HANA might require additional disk space in snapshot-prepare mode, and it is not possible toostart new backups until hello SAP HANA snapshot is confirmed.</span></span>

## <a name="hana-vm-backup-via-azure-backup-service"></a><span data-ttu-id="cf3a7-132">Zálohování virtuálních počítačů HANA prostřednictvím služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="cf3a7-132">HANA VM backup via Azure Backup service</span></span>

<span data-ttu-id="cf3a7-133">Od prosince 2016 hello agenta zálohování hello služba Azure Backup není k dispozici pro virtuální počítače s Linuxem.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-133">As of December 2016, hello backup agent of hello Azure Backup service is not available for Linux VMs.</span></span> <span data-ttu-id="cf3a7-134">toomake použití zálohování Azure na úrovni souboru nebo adresáře hello se jeden by zkopírujte tooa SAP HANA záložní soubory virtuálního počítače s Windows a pak použijte agenta zálohování hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-134">toomake use of Azure backup on hello file/directory level, one would copy SAP HANA backup files tooa Windows VM and then use hello backup agent.</span></span> <span data-ttu-id="cf3a7-135">Pouze úplná záloha virtuálního počítače s Linuxem, jinak je možné prostřednictvím hello služba Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-135">Otherwise, only a full Linux VM backup is possible via hello Azure Backup service.</span></span> <span data-ttu-id="cf3a7-136">V tématu [přehled hello funkce ve službě Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind Další.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-136">See [Overview of hello features in Azure Backup](../../../backup/backup-introduction-to-azure-backup.md) toofind out more.</span></span>

<span data-ttu-id="cf3a7-137">Hello služby Azure Backup nabízí tooback možnost až a obnovte virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-137">hello Azure Backup service offers an option tooback up and restore a VM.</span></span> <span data-ttu-id="cf3a7-138">Další informace o této služby a jak to funguje najdete v článku hello [plánování vaší infrastruktury zálohování virtuálních počítačů v Azure](../../../backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-138">More information about this service and how it works can be found in hello article [Plan your VM backup infrastructure in Azure](../../../backup/backup-azure-vms-introduction.md).</span></span>

<span data-ttu-id="cf3a7-139">Existují dvě důležité aspekty podle článku toothat:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-139">There are two important considerations according toothat article:</span></span>

<span data-ttu-id="cf3a7-140">_&quot;Pro virtuální počítače s Linuxem je možné, pouze konzistentními soubory zálohy, protože Linux nemá tooVSS ekvivalentní platformy.&quot;_</span><span class="sxs-lookup"><span data-stu-id="cf3a7-140">_&quot;For Linux virtual machines, only file-consistent backups are possible, since Linux does not have an equivalent platform tooVSS.&quot;_</span></span>

<span data-ttu-id="cf3a7-141">_&quot;Aplikace potřebují tooimplement vlastní &quot;opravu&quot; mechanismus na hello obnovit data.&quot;_</span><span class="sxs-lookup"><span data-stu-id="cf3a7-141">_&quot;Applications need tooimplement their own &quot;fix-up&quot; mechanism on hello restored data.&quot;_</span></span>

<span data-ttu-id="cf3a7-142">Proto má jeden toomake se, že SAP HANA v konzistentním stavu na disku při spuštění zálohování hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-142">Therefore, one has toomake sure SAP HANA is in a consistent state on disk when hello backup starts.</span></span> <span data-ttu-id="cf3a7-143">V tématu _SAP HANA snímky_ popsané výše v dokumentu hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-143">See _SAP HANA snapshots_ described earlier in hello document.</span></span> <span data-ttu-id="cf3a7-144">Ale existuje potenciální problém při SAP HANA zůstane v tomto režimu přípravy snímku.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-144">But there is a potential issue when SAP HANA stays in this snapshot preparation mode.</span></span> <span data-ttu-id="cf3a7-145">V tématu [vytvořit úložiště snímků (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) Další informace.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-145">See [Create a Storage Snapshot (SAP HANA Studio)](https://help.sap.com/saphelp_hanaplatform/helpdata/en/a0/3f8f08501e44d89115db3c5aa08e3f/content.htm) for more information.</span></span>

<span data-ttu-id="cf3a7-146">Tento článek stavy:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-146">That article states:</span></span>

<span data-ttu-id="cf3a7-147">_&quot;Je důrazně doporučujeme tooconfirm nebo zrušte snímku úložiště co nejdříve po jeho vytvoření. Při hello úložiště snímků připraveném nebo vytvoření hello snímek příslušných dat nereaguje. Při současném zachování ukotvené hello snímek příslušných dat, může stále provádět změny v databázi hello. Tyto změny nezpůsobí hello pozastaveny toobe snímek příslušných dat změnit. Místo toho hello změny jsou zapsány toopositions ve hello datové oblasti, které jsou oddělené od hello úložiště snímků. Změny se zapisují také toohello protokolu. Ale hello delší hello snímku relevantní data se ukládají ukotvené, hello další hello, které můžou růst datový svazek.&quot;_</span><span class="sxs-lookup"><span data-stu-id="cf3a7-147">_&quot;It is strongly recommended tooconfirm or abandon a storage snapshot as soon as possible after it has been created. While hello storage snapshot is being prepared or created, hello snapshot-relevant data is frozen. While hello snapshot-relevant data remains frozen, changes can still be made in hello database. Such changes will not cause hello frozen snapshot-relevant data toobe changed. Instead, hello changes are written toopositions in hello data area that are separate from hello storage snapshot. Changes are also written toohello log. However, hello longer hello snapshot-relevant data is kept frozen, hello more hello data volume can grow.&quot;_</span></span>

<span data-ttu-id="cf3a7-148">Zálohování Azure má na starosti hello konzistence systému souborů prostřednictvím rozšíření virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-148">Azure Backup takes care of hello file system consistency via Azure VM extensions.</span></span> <span data-ttu-id="cf3a7-149">Tato rozšíření nejsou k dispozici samostatná a fungovat pouze v kombinaci s služby zálohování Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-149">These extensions are not available standalone, and work only in combination with Azure Backup service.</span></span> <span data-ttu-id="cf3a7-150">Je však stále požadavek toomanage SAP HANA snímku tooguarantee aplikace konzistence.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-150">Nevertheless, it is still a requirement toomanage an SAP HANA snapshot tooguarantee app consistency.</span></span>

<span data-ttu-id="cf3a7-151">Zálohování Azure má dva hlavní fáze:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-151">Azure Backup has two major phases:</span></span>

- <span data-ttu-id="cf3a7-152">Pořízení snímku</span><span class="sxs-lookup"><span data-stu-id="cf3a7-152">Take Snapshot</span></span>
- <span data-ttu-id="cf3a7-153">Přenos dat toovault</span><span class="sxs-lookup"><span data-stu-id="cf3a7-153">Transfer data toovault</span></span>

<span data-ttu-id="cf3a7-154">Po dokončení fáze služby Azure Backup hello pořízení snímku apod. může potvrďte hello SAP HANA snímku.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-154">So one could confirm hello SAP HANA snapshot once hello Azure Backup service phase of taking a snapshot is completed.</span></span> <span data-ttu-id="cf3a7-155">Může to trvat několik minut toosee v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-155">It might take several minutes toosee in hello Azure portal.</span></span>

![Následující obrázek ukazuje součástí hello úlohu zálohování seznam služby Azure Backup](media/sap-hana-backup-storage-snapshots/image014.png)

<span data-ttu-id="cf3a7-157">Následující obrázek ukazuje součástí hello úlohu zálohování seznam služby Azure Backup, která byla použité tooback až hello HANA testovací virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-157">This figure shows part of hello backup job list of an Azure Backup service, which was used tooback up hello HANA test VM.</span></span>

![Podrobnosti úlohy hello tooshow, klikněte na úlohu zálohování hello v hello portálu Azure](media/sap-hana-backup-storage-snapshots/image015.png)

<span data-ttu-id="cf3a7-159">Podrobnosti úlohy hello tooshow, klikněte na úlohu zálohování hello v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-159">tooshow hello job details, click hello backup job in hello Azure portal.</span></span> <span data-ttu-id="cf3a7-160">Zde jeden můžete zobrazit hello dvě fáze.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-160">Here, one can see hello two phases.</span></span> <span data-ttu-id="cf3a7-161">Může trvat několik minut, dokud zobrazuje hello snímku fáze jako dokončenou.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-161">It might take a few minutes until it shows hello snapshot phase as completed.</span></span> <span data-ttu-id="cf3a7-162">Většinu hello doba strávená ve fázi přenos dat hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-162">Most of hello time is spent in hello data transfer phase.</span></span>

## <a name="hana-vm-backup-automation-via-azure-backup-service"></a><span data-ttu-id="cf3a7-163">Zálohování automatizace HANA virtuálních počítačů pomocí služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="cf3a7-163">HANA VM backup automation via Azure Backup service</span></span>

<span data-ttu-id="cf3a7-164">Hello SAP HANA snímku jeden ručně může potvrdit, jakmile hello Azure Backup snímku fáze je hotová, jak je popsáno výše, ale je užitečné tooconsider automatizace, protože správce nemusí monitorování hello úlohu zálohování seznamu v hello portál Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-164">One could manually confirm hello SAP HANA snapshot once hello Azure Backup snapshot phase is completed, as described earlier, but it is helpful tooconsider automation because an admin might not monitor hello backup job list in hello Azure portal.</span></span>

<span data-ttu-id="cf3a7-165">Následuje vysvětlení, jak je možné dosáhnout pomocí rutin prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-165">Here is an explanation how it could be accomplished via Azure PowerShell cmdlets.</span></span>

![Služby Azure Backup byl vytvořen s hello název hana--úložiště záloh](media/sap-hana-backup-storage-snapshots/image016.png)

<span data-ttu-id="cf3a7-167">Služby Azure Backup byl vytvořen s názvem hello &quot;hana-zálohování-trezoru.&quot; hello PS příkaz **Get AzureRmRecoveryServicesVault-název úložiště záloh hana** načte hello odpovídající objekt.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-167">An Azure Backup service was created with hello name &quot;hana-backup-vault.&quot; hello PS command **Get-AzureRmRecoveryServicesVault -Name hana-backup-vault** retrieves hello corresponding object.</span></span> <span data-ttu-id="cf3a7-168">Tento objekt je pak použít tooset hello zálohování kontextu, jak je vidět na následující obrázek hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-168">This object is then used tooset hello backup context as seen on hello next figure.</span></span>

![Jeden můžete zkontrolovat pro úlohu zálohování hello aktuálně probíhá](media/sap-hana-backup-storage-snapshots/image017.png)

<span data-ttu-id="cf3a7-170">Po nastavení hello správný kontext jednu úlohu zálohování hello právě probíhající kontrolovat a potom vyhledejte jeho podrobnosti úlohy.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-170">After setting hello correct context, one can check for hello backup job currently in progress, and then look for its job details.</span></span> <span data-ttu-id="cf3a7-171">Hello dílčí úlohy seznam obsahuje, pokud je již dokončeno hello snímku fázi hello Azure úlohy zálohování:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-171">hello subtask list shows if hello snapshot phase of hello Azure backup job is already completed:</span></span>

```
$ars = Get-AzureRmRecoveryServicesVault -Name hana-backup-vault
Set-AzureRmRecoveryServicesVaultContext -Vault $ars
$jid = Get-AzureRmRecoveryServicesBackupJob -Status InProgress | select -ExpandProperty jobid
Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
```

![Hodnota hello dotazování ve smyčce, dokud se změní tooCompleted](media/sap-hana-backup-storage-snapshots/image018.png)

<span data-ttu-id="cf3a7-173">Jakmile hello podrobnosti úlohy jsou uložené v proměnné, je jednoduše PS syntaxe tooget toohello první položkou pole a načíst hodnotu stavu hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-173">Once hello job details are stored in a variable, it is simply PS syntax tooget toohello first array entry and retrieve hello status value.</span></span> <span data-ttu-id="cf3a7-174">změní skriptu pro automatizaci hello toocomplete, dotazování hello hodnotu ve smyčce dokud příliš&quot;dokončeno.&quot;</span><span class="sxs-lookup"><span data-stu-id="cf3a7-174">toocomplete hello automation script, poll hello value in a loop until it turns too&quot;Completed.&quot;</span></span>

```
$st = Get-AzureRmRecoveryServicesBackupJobDetails -Jobid $jid | select -ExpandProperty subtasks
$st[0] | select -ExpandProperty status
```

## <a name="hana-license-key-and-vm-restore-via-azure-backup-service"></a><span data-ttu-id="cf3a7-175">Licenční klíč HANA a virtuální počítač obnovit pomocí služby zálohování Azure</span><span class="sxs-lookup"><span data-stu-id="cf3a7-175">HANA license key and VM restore via Azure Backup service</span></span>

<span data-ttu-id="cf3a7-176">Hello služby Azure Backup je navrženou toocreate nový virtuální počítač během obnovení.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-176">hello Azure Backup service is designed toocreate a new VM during restore.</span></span> <span data-ttu-id="cf3a7-177">Neexistuje žádný plán teď správné toodo &quot;na místě&quot; obnovení existující virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-177">There is no plan right now toodo an &quot;in-place&quot; restore of an existing Azure VM.</span></span>

![Následující obrázek ukazuje možnost obnovení hello hello služby Azure v hello portálu Azure](media/sap-hana-backup-storage-snapshots/image019.png)

<span data-ttu-id="cf3a7-179">Následující obrázek ukazuje možnost obnovení hello hello služby Azure v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-179">This figure shows hello restore option of hello Azure service in hello Azure portal.</span></span> <span data-ttu-id="cf3a7-180">Jeden můžete vybrat mezi vytvoření virtuálního počítače během obnovení nebo při obnovování hello disky.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-180">One can choose between creating a VM during restore or restoring hello disks.</span></span> <span data-ttu-id="cf3a7-181">Po obnovení hello disků, je stále nutné toocreate nový virtuální počítač nad ho.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-181">After restoring hello disks, it is still necessary toocreate a new VM on top of it.</span></span> <span data-ttu-id="cf3a7-182">Vždy, když se vytvoří nový virtuální počítač na změny, jedinečné ID virtuálního počítače Azure hello (viz [zpřístupnění a pomocí jedinečné ID virtuálního počítače Azure](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-182">Whenever a new VM gets created on Azure hello unique VM ID changes (see [Accessing and Using Azure VM Unique ID](https://azure.microsoft.com/blog/accessing-and-using-azure-vm-unique-id/)).</span></span>

![Následující obrázek ukazuje jedinečné ID virtuálního počítače Azure hello před a po obnovení hello prostřednictvím služby Azure Backup](media/sap-hana-backup-storage-snapshots/image020.png)

<span data-ttu-id="cf3a7-184">Následující obrázek ukazuje jedinečné ID virtuálního počítače Azure hello před a po obnovení hello prostřednictvím služby Azure Backup.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-184">This figure shows hello Azure VM unique ID before and after hello restore via Azure Backup service.</span></span> <span data-ttu-id="cf3a7-185">Hello SAP hardwaru klíč, který se používá pro SAP licencování, používá tato jedinečné ID virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-185">hello SAP hardware key, which is used for SAP licensing, is using this unique VM ID.</span></span> <span data-ttu-id="cf3a7-186">V důsledku toho novou licenci SAP má toobe nainstalovali až po obnovení virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-186">As a consequence, a new SAP license has toobe installed after a VM restore.</span></span>

<span data-ttu-id="cf3a7-187">Nová funkce Azure Backup se zobrazí v režimu preview během vytváření hello této příručce zálohování.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-187">A new Azure Backup feature was presented in preview mode during hello creation of this backup guide.</span></span> <span data-ttu-id="cf3a7-188">To umožňuje obnovení souboru úrovně podle hello snímku virtuálního počítače, který nebyla provedena pro hello virtuálních počítačů zálohování.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-188">It allows a file level restore based on hello VM snapshot that was taken for hello VM backup.</span></span> <span data-ttu-id="cf3a7-189">Tím předejdete hello nutné toodeploy nový virtuální počítač a proto hello hello jedinečné ID virtuálního počítače zůstane stejný a není třeba žádný nový licenční klíč SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-189">This avoids hello need toodeploy a new VM, and therefore hello unique VM ID stays hello same and no new SAP HANA license key is required.</span></span> <span data-ttu-id="cf3a7-190">Další dokumentaci k této funkce bude poskytnuta po je plně testována.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-190">More documentation on this feature will be provided after it is fully tested.</span></span>

<span data-ttu-id="cf3a7-191">Zálohování Azure se nakonec povolit zálohování Azure jednotlivé virtuální disky a soubory a adresáře z uvnitř hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-191">Azure Backup will eventually allow backup of individual Azure virtual disks, plus files and directories from inside hello VM.</span></span> <span data-ttu-id="cf3a7-192">Hlavní výhodou Azure Backup je jeho správu všechny zálohy hello ukládání hello zákazníka odpadne toodo ho.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-192">A major advantage of Azure Backup is its management of all hello backups, saving hello customer from having toodo it.</span></span> <span data-ttu-id="cf3a7-193">Pokud obnovení je nutné, bude zálohování Azure vyberte správné zálohování toouse hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-193">If a restore becomes necessary, Azure Backup will select hello correct backup toouse.</span></span>

## <a name="sap-hana-vm-backup-via-manual-disk-snapshot"></a><span data-ttu-id="cf3a7-194">Zálohování virtuálních počítačů SAP HANA prostřednictvím snímku ruční disku</span><span class="sxs-lookup"><span data-stu-id="cf3a7-194">SAP HANA VM backup via manual disk snapshot</span></span>

<span data-ttu-id="cf3a7-195">Místo použití hello služba Azure Backup, jeden může nakonfigurovat do jednotlivých řešení pro zálohování vytváření snímků objektu blob Azure virtuální pevné disky ručně pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-195">Instead of using hello Azure Backup service, one could configure an individual backup solution by creating blob snapshots of Azure VHDs manually via PowerShell.</span></span> <span data-ttu-id="cf3a7-196">V tématu [snímky použití objektů blob v prostředí PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) popis kroků hello.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-196">See [Using blob snapshots with PowerShell](https://blogs.msdn.microsoft.com/cie/2016/05/17/using-blob-snapshots-with-powershell/) for a description of hello steps.</span></span>

<span data-ttu-id="cf3a7-197">Poskytuje větší flexibilitu, ale nevyřeší hello problémy popsané výše v tomto dokumentu:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-197">It provides more flexibility but does not resolve hello issues explained earlier in this document:</span></span>

- <span data-ttu-id="cf3a7-198">Jeden stále musí Ujistěte se, že SAP HANA je v konzistentním stavu</span><span class="sxs-lookup"><span data-stu-id="cf3a7-198">One still must make sure that SAP HANA is in a consistent state</span></span>
- <span data-ttu-id="cf3a7-199">disk s operačním systémem Hello nelze přepsat, i když existuje hello virtuální počítač navrácený chyba oznamující, že zapůjčení.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-199">hello OS disk cannot be overwritten even if hello VM is deallocated because of an error stating that a lease exists.</span></span> <span data-ttu-id="cf3a7-200">Funguje pouze po odstranění hello virtuálních počítačů, což by vedlo tooa nové jedinečné ID virtuálního počítače a hello nutné tooinstall novou licenci SAP.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-200">It only works after deleting hello VM, which would lead tooa new unique VM ID and hello need tooinstall a new SAP license.</span></span>

![Je možné toorestore pouze hello datové disky virtuálního počítače Azure](media/sap-hana-backup-storage-snapshots/image021.png)

<span data-ttu-id="cf3a7-202">Je možné toorestore pouze hello datových disků z virtuálního počítače Azure, zabraňující hello problém získávání nové jedinečné ID virtuálního počítače a, proto zrušena hello SAP licencí:</span><span class="sxs-lookup"><span data-stu-id="cf3a7-202">It is possible toorestore only hello data disks of an Azure VM, avoiding hello problem of getting a new unique VM ID and, therefore, invalidated hello SAP license:</span></span>

- <span data-ttu-id="cf3a7-203">Pro hello test dva disky dat Azure byly připojené tooa virtuálních počítačů a softwaru diskového pole RAID byl definován nad je</span><span class="sxs-lookup"><span data-stu-id="cf3a7-203">For hello test, two Azure data disks were attached tooa VM and software RAID was defined on top of them</span></span> 
- <span data-ttu-id="cf3a7-204">Funkce snímku SAP HANA bylo potvrzeno, že SAP HANA bylo v konzistentním stavu</span><span class="sxs-lookup"><span data-stu-id="cf3a7-204">It was confirmed that SAP HANA was in a consistent state by SAP HANA snapshot feature</span></span>
- <span data-ttu-id="cf3a7-205">Freeze – systém souborů (v tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku hello [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md))</span><span class="sxs-lookup"><span data-stu-id="cf3a7-205">File system freeze (see _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md))</span></span>
- <span data-ttu-id="cf3a7-206">Objekt BLOB snímky byly odebrány z obou datových disků</span><span class="sxs-lookup"><span data-stu-id="cf3a7-206">Blob snapshots were taken from both data disks</span></span>
- <span data-ttu-id="cf3a7-207">Uvolní systému souborů</span><span class="sxs-lookup"><span data-stu-id="cf3a7-207">File system unfreeze</span></span>
- <span data-ttu-id="cf3a7-208">Potvrzení snímku SAP HANA</span><span class="sxs-lookup"><span data-stu-id="cf3a7-208">SAP HANA snapshot confirmation</span></span>
- <span data-ttu-id="cf3a7-209">toorestore hello datových disků, hello virtuální počítač byl vypnut a oba disky odpojit</span><span class="sxs-lookup"><span data-stu-id="cf3a7-209">toorestore hello data disks, hello VM was shut down and both disks detached</span></span>
- <span data-ttu-id="cf3a7-210">Po odpojení hello disky, měla přepsat s hello bývalé blob snímky</span><span class="sxs-lookup"><span data-stu-id="cf3a7-210">After detaching hello disks, they were overwritten with hello former blob snapshots</span></span>
- <span data-ttu-id="cf3a7-211">Pak byly připojené virtuální disky hello obnovit znovu toohello virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="cf3a7-211">Then hello restored virtual disks were attached again toohello VM</span></span>
- <span data-ttu-id="cf3a7-212">Po počáteční hello virtuálních počítačů, vše na hello softwaru diskového pole RAID fungovala bez problémů a byla nastavena zpět toohello blob snímku čas</span><span class="sxs-lookup"><span data-stu-id="cf3a7-212">After starting hello VM, everything on hello software RAID worked fine and was set back toohello blob snapshot time</span></span>
- <span data-ttu-id="cf3a7-213">HANA byl nastaven zpět toohello HANA snímku</span><span class="sxs-lookup"><span data-stu-id="cf3a7-213">HANA was set back toohello HANA snapshot</span></span>

<span data-ttu-id="cf3a7-214">Pokud bylo možné tooshut dolů SAP HANA před hello blob snímky, bude postup hello méně složitých.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-214">If it was possible tooshut down SAP HANA before hello blob snapshots, hello procedure would be less complex.</span></span> <span data-ttu-id="cf3a7-215">V takovém případě jeden může přeskočit hello HANA snímku a, pokud nic jiného se děje v systému hello také přeskočit hello souboru systému ukotvit.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-215">In that case, one could skip hello HANA snapshot and, if nothing else is going on in hello system, also skip hello file system freeze.</span></span> <span data-ttu-id="cf3a7-216">Náročnost hello obrázek stává, když je nezbytné toodo snímky, zatímco všechno, co je online.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-216">Added complexity comes into hello picture when it is necessary toodo snapshots while everything is online.</span></span> <span data-ttu-id="cf3a7-217">V tématu _konzistenci dat SAP HANA při pořizování snímků úložiště_ v souvisejícím článku hello [zálohování Průvodce pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-217">See _SAP HANA data consistency when taking storage snapshots_ in hello related article [Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="cf3a7-218">Další kroky</span><span class="sxs-lookup"><span data-stu-id="cf3a7-218">Next steps</span></span>
* <span data-ttu-id="cf3a7-219">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md) nabízí přehled a informace o zahájení práce.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-219">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="cf3a7-220">[Na základě SAP HANA zálohování na úrovni souborů](sap-hana-backup-file-level.md) zahrnuje hello možnost zálohování na základě souborů.</span><span class="sxs-lookup"><span data-stu-id="cf3a7-220">[SAP HANA backup based on file level](sap-hana-backup-file-level.md) covers hello file-based backup option.</span></span>
* <span data-ttu-id="cf3a7-221">jak tooestablish vysokou dostupnost a plán pro zotavení po havárii SAP HANA v Azure (velké instance), najdete v části toolearn [SAP HANA (velké instance) vysoké dostupnosti a zotavení po havárii v Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="cf3a7-221">toolearn how tooestablish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

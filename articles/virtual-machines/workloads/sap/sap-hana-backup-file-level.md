---
title: "SAP HANA Azure Backup na úrovni souborů | Microsoft Docs"
description: "Existují dvě hlavní zálohování možnosti pro SAP HANA na virtuálních počítačích Azure, tento článek se zabývá SAP HANA Azure Backup na úrovni souborů"
services: virtual-machines-linux
documentationcenter: 
author: hermanndms
manager: timlt
editor: 
ms.service: virtual-machines-linux
ms.devlang: NA
ms.topic: article
ums.tgt_pltfrm: vm-linux
ms.workload: infrastructure-services
ms.date: 3/13/2017
ms.author: rclaus
ms.openlocfilehash: 5db0ceb1648b5afa278e1cbe1c42fce8033bfdc1
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="sap-hana-azure-backup-on-file-level"></a><span data-ttu-id="643b6-103">SAP HANA Azure Backup na úrovni souborů</span><span class="sxs-lookup"><span data-stu-id="643b6-103">SAP HANA Azure Backup on file level</span></span>

## <a name="introduction"></a><span data-ttu-id="643b6-104">Úvod</span><span class="sxs-lookup"><span data-stu-id="643b6-104">Introduction</span></span>

<span data-ttu-id="643b6-105">Toto je část třemi částmi řady související články v záloze SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-105">This is part of a three-part series of related articles on SAP HANA backup.</span></span> <span data-ttu-id="643b6-106">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](./sap-hana-backup-guide.md) poskytuje přehled a informace o začátcích, a [SAP HANA zálohování podle úložiště snímků](./sap-hana-backup-storage-snapshots.md) popisuje zálohování možnosti založené na snímku úložiště.</span><span class="sxs-lookup"><span data-stu-id="643b6-106">[Backup guide for SAP HANA on Azure Virtual Machines](./sap-hana-backup-guide.md) provides an overview and information on getting started, and [SAP HANA backup based on storage snapshots](./sap-hana-backup-storage-snapshots.md) covers the storage snapshot-based backup option.</span></span>

<span data-ttu-id="643b6-107">Prohlížení velikosti virtuálního počítače Azure, jeden můžete vidět, že GS5 umožňuje 64 disků připojených datových.</span><span class="sxs-lookup"><span data-stu-id="643b6-107">Looking at the Azure VM sizes, one can see that a GS5 allows 64 attached data disks.</span></span> <span data-ttu-id="643b6-108">U systémů SAP HANA může být velký počet disků už používá pro data a soubory protokolu, které by mohly mít v kombinaci s softwaru diskového pole RAID pro optimální disk propustnost vstupně-výstupní operace.</span><span class="sxs-lookup"><span data-stu-id="643b6-108">For large SAP HANA systems, a significant number of disks might already be taken for data and log files, possibly in combination with software RAID for optimal disk IO throughput.</span></span> <span data-ttu-id="643b6-109">Poté dotaz je pro uložení SAP HANA zálohování souborů, které může zaplnit připojené datové disky v čase?</span><span class="sxs-lookup"><span data-stu-id="643b6-109">The question then is where to store SAP HANA backup files, which could fill up the attached data disks over time?</span></span> <span data-ttu-id="643b6-110">V tématu [velikostí pro virtuální počítače s Linuxem v Azure](../../linux/sizes.md) pro tabulky velikost virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-110">See [Sizes for Linux virtual machines in Azure](../../linux/sizes.md) for the Azure VM size tables.</span></span>

<span data-ttu-id="643b6-111">V tuto chvíli není k dispozici u služby zálohování Azure bez integrace zálohování SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-111">There is no SAP HANA backup integration available with Azure Backup service at this time.</span></span> <span data-ttu-id="643b6-112">Standardní způsob, jak spravovat zálohování a obnovení na úrovni souborů je s zálohu na základě souborů prostřednictvím SAP HANA Studio nebo pomocí příkazů SAP HANA SQL.</span><span class="sxs-lookup"><span data-stu-id="643b6-112">The standard way to manage backup/restore at the file level is with a file-based backup via SAP HANA Studio or via SAP HANA SQL statements.</span></span> <span data-ttu-id="643b6-113">V tématu [SAP HANA SQL a Reference zobrazení systému](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) Další informace.</span><span class="sxs-lookup"><span data-stu-id="643b6-113">See [SAP HANA SQL and System Views Reference](https://help.sap.com/hana/SAP_HANA_SQL_and_System_Views_Reference_en.pdf) for more information.</span></span>

![Na tomto obrázku je dialogové okno položky zálohování nabídky v SAP HANA Studio](media/sap-hana-backup-file-level/image022.png)

<span data-ttu-id="643b6-115">Následující obrázek ukazuje dialogové okno položky zálohování nabídky v SAP HANA Studio.</span><span class="sxs-lookup"><span data-stu-id="643b6-115">This figure shows the dialog of the backup menu item in SAP HANA Studio.</span></span> <span data-ttu-id="643b6-116">Při výběru typu &quot;souboru&quot; jeden má v systému souborů zadejte cestu, kam SAP HANA zapisuje záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-116">When choosing type &quot;file,&quot; one has to specify a path in the file system where SAP HANA writes the backup files.</span></span> <span data-ttu-id="643b6-117">Obnovení funguje stejným způsobem.</span><span class="sxs-lookup"><span data-stu-id="643b6-117">Restore works the same way.</span></span>

<span data-ttu-id="643b6-118">Když tato volba vyznívá jednoduché a rovnou předat dál, existují některé aspekty.</span><span class="sxs-lookup"><span data-stu-id="643b6-118">While this choice sounds simple and straight forward, there are some considerations.</span></span> <span data-ttu-id="643b6-119">Jak je uvedeno nahoře, virtuální počítač Azure má omezenou na počet datových disků, které je možné připojit.</span><span class="sxs-lookup"><span data-stu-id="643b6-119">As mentioned before, an Azure VM has a limitation of number of data disks that can be attached.</span></span> <span data-ttu-id="643b6-120">Nemusí být kapacitou pro ukládání záložních souborů SAP HANA v systémech souborů virtuálního počítače, v závislosti na velikosti databáze a disku požadavky propustnost, které mohou zahrnovat softwaru RAID pomocí prokládání napříč více dat disky.</span><span class="sxs-lookup"><span data-stu-id="643b6-120">There might not be capacity to store SAP HANA backup files on the file systems of the VM, depending on the size of the database and disk throughput requirements, which might involve software RAID using striping across multiple data disks.</span></span> <span data-ttu-id="643b6-121">Různé možnosti pro přesunutí těchto záložních souborů a správu omezení velikosti souborů a výkon při zpracování terabajtů dat, jsou uvedeny dále v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="643b6-121">Various options for moving these backup files, and managing file size restrictions and performance when handling terabytes of data, are provided later in this article.</span></span>

<span data-ttu-id="643b6-122">Další možnost, která nabízí dává větší svobodu týkající se celkové kapacity, je úložiště objektů blob Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-122">Another option, which offers more freedom regarding total capacity, is Azure blob storage.</span></span> <span data-ttu-id="643b6-123">Zatímco jediného objektu blob je také omezen na 1 TB, právě 500 TB celkové kapacity jediného objektu blob kontejneru.</span><span class="sxs-lookup"><span data-stu-id="643b6-123">While a single blob is also restricted to 1 TB, the total capacity of a single blob container is currently 500 TB.</span></span> <span data-ttu-id="643b6-124">Kromě toho nabízí zákazníkům možnost vybrat takzvané &quot;nástrojů&quot; úložiště objektů blob, který má výhody náklady.</span><span class="sxs-lookup"><span data-stu-id="643b6-124">Additionally, it gives customers the choice to select so-called &quot;cool&quot; blob storage, which has a cost benefit.</span></span> <span data-ttu-id="643b6-125">V tématu [Azure Blob Storage: za provozu a cool vrstvy úložiště](../../../storage/blobs/storage-blob-storage-tiers.md) podrobnosti o úložiště na studených objektů blob.</span><span class="sxs-lookup"><span data-stu-id="643b6-125">See [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md) for details about cool blob storage.</span></span>

<span data-ttu-id="643b6-126">Pro dodatečné zabezpečení použijte účet geograficky replikované úložiště pro ukládání záloh SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-126">For additional safety, use a geo-replicated storage account to store the SAP HANA backups.</span></span> <span data-ttu-id="643b6-127">V tématu [replikace Azure Storage](../../../storage/common/storage-redundancy.md) podrobnosti o replikaci účet úložiště.</span><span class="sxs-lookup"><span data-stu-id="643b6-127">See [Azure Storage replication](../../../storage/common/storage-redundancy.md) for details about storage account replication.</span></span>

<span data-ttu-id="643b6-128">V účtu vyhrazeného zálohování úložiště, který je geograficky replikované jeden by mohlo způsobit vyhrazené virtuální pevné disky pro SAP HANA zálohy.</span><span class="sxs-lookup"><span data-stu-id="643b6-128">One could place dedicated VHDs for SAP HANA backups in a dedicated backup storage account that is geo-replicated.</span></span> <span data-ttu-id="643b6-129">Jinak jeden zkopírovat virtuální pevné disky, které udržují SAP HANA zálohy na účet geograficky replikované úložiště nebo na účet úložiště, který je v jiné oblasti.</span><span class="sxs-lookup"><span data-stu-id="643b6-129">Or else one could copy the VHDs that keep the SAP HANA backups to a geo-replicated storage account, or to a storage account that is in a different region.</span></span>

## <a name="azure-backup-agent"></a><span data-ttu-id="643b6-130">Azure backup agent</span><span class="sxs-lookup"><span data-stu-id="643b6-130">Azure backup agent</span></span>

<span data-ttu-id="643b6-131">Zálohování Azure nabízí možnost nejen zálohovat dokončení virtuálních počítačů, ale také soubory a adresáře prostřednictvím agenta zálohování, které musí být nainstalovaná na hostovaný operační systém.</span><span class="sxs-lookup"><span data-stu-id="643b6-131">Azure backup offers the option to not only back up complete VMs, but also files and directories via the backup agent, which has to be installed on the guest OS.</span></span> <span data-ttu-id="643b6-132">Ale od prosince 2016 tohoto agenta je podporována pouze v systému Windows (viz [zálohování Windows serveru nebo klienta do Azure pomocí modelu nasazení Resource Manager](../../../backup/backup-configure-vault.md)).</span><span class="sxs-lookup"><span data-stu-id="643b6-132">But as of December 2016, this agent is only supported on Windows (see [Back up a Windows Server or client to Azure using the Resource Manager deployment model](../../../backup/backup-configure-vault.md)).</span></span>

<span data-ttu-id="643b6-133">Alternativní řešení, je nejdříve zkopírovat SAP HANA záložní soubory pro virtuální počítač s Windows v Azure (například prostřednictvím SAMBA sdílené složky) a potom pomocí aplikace Azure backup agent z ní.</span><span class="sxs-lookup"><span data-stu-id="643b6-133">A workaround is to first copy SAP HANA backup files to a Windows VM on Azure (for example, via SAMBA share) and then use the Azure backup agent from there.</span></span> <span data-ttu-id="643b6-134">I když je technicky možné, ho by přidání složitosti a zpomalit zálohování nebo procesu obnovení odlišují kvůli kopírování mezi sady Linux a Windows virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="643b6-134">While it is technically possible, it would add complexity and slow down the backup or restore process quite a bit due to the copy between the Linux and the Windows VM.</span></span> <span data-ttu-id="643b6-135">Není doporučeno postupujte podle tohoto přístupu.</span><span class="sxs-lookup"><span data-stu-id="643b6-135">It is not recommended to follow this approach.</span></span>

## <a name="azure-blobxfer-utility-details"></a><span data-ttu-id="643b6-136">Podrobnosti nástroj Azure blobxfer</span><span class="sxs-lookup"><span data-stu-id="643b6-136">Azure blobxfer utility details</span></span>

<span data-ttu-id="643b6-137">K uložení adresářů a souborů na úložiště Azure, jeden může používat rozhraní příkazového řádku nebo prostředí PowerShell nebo vytvořte nástroj, pomocí jedné z [sady Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="643b6-137">To store directories and files on Azure storage, one could use CLI or PowerShell, or develop a tool using one of the [Azure SDKs](https://azure.microsoft.com/downloads/).</span></span> <span data-ttu-id="643b6-138">Pro kopírování dat do úložiště Azure je také nástroj připravené k použití, AzCopy, ale je Windows jenom (viz [přenos dat pomocí nástroje příkazového řádku Azcopy](../../../storage/common/storage-use-azcopy.md)).</span><span class="sxs-lookup"><span data-stu-id="643b6-138">There is also a ready-to-use utility, AzCopy, for copying data to Azure storage, but it is Windows only (see [Transfer data with the AzCopy Command-Line Utility](../../../storage/common/storage-use-azcopy.md)).</span></span>

<span data-ttu-id="643b6-139">Proto blobxfer byl použit pro kopírování SAP HANA záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-139">Therefore blobxfer was used for copying SAP HANA backup files.</span></span> <span data-ttu-id="643b6-140">Je open source mnoho zákazníků v produkčním prostředí, dostupná a použitá na [Githubu](https://github.com/Azure/blobxfer).</span><span class="sxs-lookup"><span data-stu-id="643b6-140">It is open source, used by many customers in production environments, and available on [GitHub](https://github.com/Azure/blobxfer).</span></span> <span data-ttu-id="643b6-141">Tento nástroj umožňuje jeden ke zkopírování dat přímo do úložiště objektů blob v Azure nebo sdílenou složku Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-141">This tool allows one to copy data directly to either Azure blob storage or Azure file share.</span></span> <span data-ttu-id="643b6-142">Také nabízí celou řadu užitečných funkcí, jako je hodnota hash md5 nebo automatické paralelismus při kopírování adresáře s více soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-142">It also offers a range of useful features, like md5 hash or automatic parallelism when copying a directory with multiple files.</span></span>

## <a name="sap-hana-backup-performance"></a><span data-ttu-id="643b6-143">Výkon zálohování SAP HANA</span><span class="sxs-lookup"><span data-stu-id="643b6-143">SAP HANA backup performance</span></span>

![Je tento snímek zálohy konzoly SAP HANA ve SAP HANA Studio](media/sap-hana-backup-file-level/image023.png)

<span data-ttu-id="643b6-145">Zálohování konzoly SAP HANA ve SAP HANA Studio je tento snímek.</span><span class="sxs-lookup"><span data-stu-id="643b6-145">This screenshot is of the SAP HANA backup console in SAP HANA Studio.</span></span> <span data-ttu-id="643b6-146">Proveďte zálohu 230 GB na disku jednoho Azure standardní úložiště připojené k virtuálnímu počítači HANA používající systém souborů XFS trvalo asi 42 minut.</span><span class="sxs-lookup"><span data-stu-id="643b6-146">It took about 42 minutes to do the backup of the 230 GB on a single Azure standard storage disk attached to the HANA VM using XFS file system.</span></span>

![Tomto snímku obrazovky je YaST SAP HANA testovacího virtuálního počítače](media/sap-hana-backup-file-level/image024.png)

<span data-ttu-id="643b6-148">Tomto snímku obrazovky je YaST SAP HANA testovacího virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="643b6-148">This screenshot is of YaST on the SAP HANA test VM.</span></span> <span data-ttu-id="643b6-149">Jediný disk 1 TB pro SAP HANA zálohování jeden můžete vidět, jak je uvedeno nahoře.</span><span class="sxs-lookup"><span data-stu-id="643b6-149">One can see the 1-TB single disk for SAP HANA backup as mentioned before.</span></span> <span data-ttu-id="643b6-150">Trvalo asi 42 minut zálohování 230 GB.</span><span class="sxs-lookup"><span data-stu-id="643b6-150">It took about 42 minutes to backup 230 GB.</span></span> <span data-ttu-id="643b6-151">Kromě toho byla připojena pět disků 200 GB a vytvořit md0 softwaru diskového pole RAID, s proložení na základě těchto pět disků dat Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-151">In addition, five 200-GB disks were attached and software RAID md0 created, with striping on top of these five Azure data disks.</span></span>

![Opakující se stejnou zálohování na softwaru diskového pole RAID s proložení mezi pěti připojenými disky dat úložiště Azure úrovně standard](media/sap-hana-backup-file-level/image025.png)

<span data-ttu-id="643b6-153">Opakující se stejnou zálohování na softwaru diskového pole RAID s proložení mezi pěti připojit standardní úložiště Azure datových disků brzy čas zálohování z 42 minut do 10 minut.</span><span class="sxs-lookup"><span data-stu-id="643b6-153">Repeating the same backup on software RAID with striping across five attached Azure standard storage data disks brought the backup time from 42 minutes down to 10 minutes.</span></span> <span data-ttu-id="643b6-154">Disky byla připojena bez ukládání do mezipaměti na virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="643b6-154">The disks were attached without caching to the VM.</span></span> <span data-ttu-id="643b6-155">Proto je zřejmé jak důležité rychlost zapisování na disk se pro čas zálohování.</span><span class="sxs-lookup"><span data-stu-id="643b6-155">So it is obvious how important disk write throughput is for the backup time.</span></span> <span data-ttu-id="643b6-156">Jeden může přepnout na Azure premium úložiště na další urychlit proces pro optimální výkon.</span><span class="sxs-lookup"><span data-stu-id="643b6-156">One could then switch to Azure premium storage to further accelerate the process for optimal performance.</span></span> <span data-ttu-id="643b6-157">Obecně platí Azure premium storage je třeba použít pro produkční systémy.</span><span class="sxs-lookup"><span data-stu-id="643b6-157">In general, Azure premium storage should be used for production systems.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-blob-storage"></a><span data-ttu-id="643b6-158">Zkopírujte záložní soubory SAP HANA do Azure blob storage</span><span class="sxs-lookup"><span data-stu-id="643b6-158">Copy SAP HANA backup files to Azure blob storage</span></span>

<span data-ttu-id="643b6-159">Od prosince 2016 je nejlepší možnost rychle ukládání záložních souborů SAP HANA úložiště objektů blob Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-159">As of December 2016, the best option to quickly store SAP HANA backup files is Azure blob storage.</span></span> <span data-ttu-id="643b6-160">Jednoho kontejneru typu jediného objektu blob může obsahovat maximálně 500 TB, dostatek většina systémů SAP HANA spuštěné ve virtuálním počítači GS5 v Azure, aby dostatečná zálohy SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-160">One single blob container has a limit of 500 TB, enough for most SAP HANA systems, running in a GS5 VM on Azure, to keep sufficient SAP HANA backups.</span></span> <span data-ttu-id="643b6-161">Volba mezi mají zákazníci &quot;aktivní&quot; a &quot;studenou&quot; úložiště objektů blob (najdete v části [Azure Blob Storage: za provozu a cool vrstvy úložiště](../../../storage/blobs/storage-blob-storage-tiers.md)).</span><span class="sxs-lookup"><span data-stu-id="643b6-161">Customers have the choice between &quot;hot&quot; and &quot;cold&quot; blob storage (see [Azure Blob Storage: Hot and cool storage tiers](../../../storage/blobs/storage-blob-storage-tiers.md)).</span></span>

<span data-ttu-id="643b6-162">Pomocí nástroje blobxfer je snadné zkopírujte záložní soubory SAP HANA přímo do Azure blob storage.</span><span class="sxs-lookup"><span data-stu-id="643b6-162">With the blobxfer tool, it is easy to copy the SAP HANA backup files directly to Azure blob storage.</span></span>

![Zde jeden uvidí soubory úplné zálohování souboru SAP HANA](media/sap-hana-backup-file-level/image026.png)

<span data-ttu-id="643b6-164">Zde jeden můžete zobrazit soubory úplné zálohování souboru SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-164">Here one can see the files of a full SAP HANA file backup.</span></span> <span data-ttu-id="643b6-165">Existují čtyři soubory a největších jeden má zhruba 230 GB.</span><span class="sxs-lookup"><span data-stu-id="643b6-165">There are four files and the biggest one has roughly 230 GB.</span></span>

![Trvalo zhruba 3000 sekund pro kopírování 230 GB na kontejner objektů blob účet úložiště Azure úrovně standard](media/sap-hana-backup-file-level/image027.png)

<span data-ttu-id="643b6-167">Hodnota hash md5 není v počátečním testu, trvalo zhruba 3000 sekund pro kopírování 230 GB na kontejner objektů blob účet úložiště Azure úrovně standard.</span><span class="sxs-lookup"><span data-stu-id="643b6-167">Not using md5 hash in the initial test, it took roughly 3000 seconds to copy the 230 GB to an Azure standard storage account blob container.</span></span>

![Na tomto snímku obrazovky jeden viděli, jak vypadá na portálu Azure](media/sap-hana-backup-file-level/image028.png)

<span data-ttu-id="643b6-169">Na tomto snímku obrazovky jeden můžete zobrazit, jak vypadá na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-169">In this screenshot, one can see how it looks on the Azure portal.</span></span> <span data-ttu-id="643b6-170">Kontejner objektů blob s názvem &quot;sap hana zálohování&quot; byl vytvořen a zahrnuje čtyři objekty BLOB, které představují záložní soubory SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-170">A blob container named &quot;sap-hana-backups&quot; was created and includes the four blobs, which represent the SAP HANA backup files.</span></span> <span data-ttu-id="643b6-171">Jeden z nich má velikost přibližně 230 GB.</span><span class="sxs-lookup"><span data-stu-id="643b6-171">One of them has a size of roughly 230 GB.</span></span>

<span data-ttu-id="643b6-172">Konzole zálohování HANA Studio umožňuje jednu pro omezení maximální velikost HANA záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-172">The HANA Studio backup console allows one to restrict the max file size of HANA backup files.</span></span> <span data-ttu-id="643b6-173">V prostředí ukázka zvýšení výkonu tím, že je možné, že několik menších souborů zálohování, místo jednoho velkého souboru 230 GB.</span><span class="sxs-lookup"><span data-stu-id="643b6-173">In the sample environment, it improved performance by making it possible to have multiple smaller backup files, instead of one large 230-GB file.</span></span>

![Nastavení omezení velikosti záložní soubor nemá straně HANA & č. 39; t zlepšit čas zálohování](media/sap-hana-backup-file-level/image029.png)

<span data-ttu-id="643b6-175">Nastavení omezení velikosti záložní soubor nemá straně HANA & č. 39; t zlepšit čas zálohování, protože soubory jsou zapsány postupně, jak je vidět na tomto obrázku.</span><span class="sxs-lookup"><span data-stu-id="643b6-175">Setting the backup file size limit on the HANA side doesn&#39;t improve the backup time, because the files are written sequentially as shown in this figure.</span></span> <span data-ttu-id="643b6-176">Limit velikosti souborů byla nastavena na 60 GB, proto zálohování vytvořit čtyři velké datové soubory místo 230 GB jeden soubor.</span><span class="sxs-lookup"><span data-stu-id="643b6-176">The file size limit was set to 60 GB, so the backup created four large data files instead of the 230-GB single file.</span></span>

![K testování paralelismus nástroj blobxfer, byla maximální velikost souboru pro zálohování HANA pak nastavena na 15 GB](media/sap-hana-backup-file-level/image030.png)

<span data-ttu-id="643b6-178">K testování paralelismus blobxfer nástroje, maximální velikost souboru pro zálohování HANA pak byla nastavena na 15 GB, což vedlo 19 záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-178">To test parallelism of the blobxfer tool, the max file size for HANA backups was then set to 15 GB, which resulted in 19 backup files.</span></span> <span data-ttu-id="643b6-179">Tato konfigurace začlenění dobu blobxfer zkopírujte 230 GB do Azure blob storage z 3000 sekund dolů 875 sekund.</span><span class="sxs-lookup"><span data-stu-id="643b6-179">This configuration brought the time for blobxfer to copy the 230 GB to Azure blob storage from 3000 seconds down to 875 seconds.</span></span>

<span data-ttu-id="643b6-180">Tento výsledek je z důvodu limit 60 MB/s pro zápis objektů blob Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-180">This result is due to the limit of 60 MB/sec for writing an Azure blob.</span></span> <span data-ttu-id="643b6-181">Paralelismus prostřednictvím více objektů BLOB řeší problémové místo, ale je nevýhodou: zvýšení výkonu blobxfer nástroj a zkopírujte všechny tyto HANA záložní soubory do Azure blob storage dochází zatížení HANA virtuálního počítače a sítě.</span><span class="sxs-lookup"><span data-stu-id="643b6-181">Parallelism via multiple blobs solves the bottleneck, but there is a downside: increasing performance of the blobxfer tool to copy all these HANA backup files to Azure blob storage puts load on both the HANA VM and the network.</span></span> <span data-ttu-id="643b6-182">Operace systému HANA stane dopad.</span><span class="sxs-lookup"><span data-stu-id="643b6-182">Operation of HANA system becomes impacted.</span></span>

## <a name="blob-copy-of-dedicated-azure-data-disks-in-backup-software-raid"></a><span data-ttu-id="643b6-183">Objekt BLOB kopii vyhrazené Azure datové disky v zálohování softwaru diskového pole RAID</span><span class="sxs-lookup"><span data-stu-id="643b6-183">Blob copy of dedicated Azure data disks in backup software RAID</span></span>

<span data-ttu-id="643b6-184">Na rozdíl od ručního virtuálních počítačů data zálohování disku v tomto přístupu jeden zálohovat všechny datové disky na virtuálním počítači k uložení celého zařízení SAP HANA data, včetně HANA neprotokoluje soubory a soubory konfigurace.</span><span class="sxs-lookup"><span data-stu-id="643b6-184">Unlike the manual VM data disk backup, in this approach one does not back up all the data disks on a VM to save the whole SAP installation, including HANA data, HANA log files, and config files.</span></span> <span data-ttu-id="643b6-185">Místo toho na nápad je mít vyhrazený softwaru diskového pole RAID s proložení napříč více dat Azure virtuální pevné disky pro ukládání úplné zálohování souboru SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-185">Instead, the idea is to have dedicated software RAID with striping across multiple Azure data VHDs for storing a full SAP HANA file backup.</span></span> <span data-ttu-id="643b6-186">Jeden zkopíruje pouze tyto disky, které mají zálohování SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-186">One copies only these disks, which have the SAP HANA backup.</span></span> <span data-ttu-id="643b6-187">Můžou snadno se uchovává se v vyhrazený účet úložiště pro zálohy HANA, nebo připojené k vyhrazená &quot;zálohování správu virtuálních počítačů&quot; pro další zpracování.</span><span class="sxs-lookup"><span data-stu-id="643b6-187">They could easily be kept in a dedicated HANA backup storage account, or attached to a dedicated &quot;backup management VM&quot; for further processing.</span></span>

![Všechny virtuální pevné disky související se situací byly zkopírovány pomocí ** start-azurestorageblobcopy ** příkaz prostředí PowerShell](media/sap-hana-backup-file-level/image031.png)

<span data-ttu-id="643b6-189">Po dokončení zálohování na místní softwaru diskového pole RAID, byly zkopírovány všechny virtuální pevné disky související se situací pomocí **start-azurestorageblobcopy** příkaz prostředí PowerShell (najdete v části [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span><span class="sxs-lookup"><span data-stu-id="643b6-189">After the backup to the local software RAID was completed, all VHDs involved were copied using the **start-azurestorageblobcopy** PowerShell command (see [Start-AzureStorageBlobCopy](/powershell/module/azure.storage/start-azurestorageblobcopy)).</span></span> <span data-ttu-id="643b6-190">Jak ovlivňuje pouze systému souborů vyhrazené pro udržování záložní soubory, neexistují žádné pochybnostmi SAP HANA dat či protokolu konzistence souborů na disku.</span><span class="sxs-lookup"><span data-stu-id="643b6-190">As it only affects the dedicated file system for keeping the backup files, there are no concerns about SAP HANA data or log file consistency on the disk.</span></span> <span data-ttu-id="643b6-191">Výhodou tohoto příkazu je, že funguje při virtuální počítač zůstane online.</span><span class="sxs-lookup"><span data-stu-id="643b6-191">A benefit of this command is that it works while the VM stays online.</span></span> <span data-ttu-id="643b6-192">Ujistěte se, že žádný proces zapíše do sady zálohování stripe, nezapomeňte odpojit před kopírováním objektů blob a připojit ji znovu později.</span><span class="sxs-lookup"><span data-stu-id="643b6-192">To be certain that no process writes to the backup stripe set, be sure to unmount it before the blob copy, and mount it again afterwards.</span></span> <span data-ttu-id="643b6-193">Nebo jeden použít vhodný způsob k &quot;freeze&quot; systému souborů.</span><span class="sxs-lookup"><span data-stu-id="643b6-193">Or one could use an appropriate way to &quot;freeze&quot; the file system.</span></span> <span data-ttu-id="643b6-194">Například prostřednictvím xfs\_freeze pro systém souborů XFS.</span><span class="sxs-lookup"><span data-stu-id="643b6-194">For example, via xfs\_freeze for the XFS file system.</span></span>

![Tento snímek obrazovky ukazuje seznam objektů BLOB v kontejneru virtuální pevné disky na portálu Azure](media/sap-hana-backup-file-level/image032.png)

<span data-ttu-id="643b6-196">Zobrazí seznam objektů BLOB v tomto snímku obrazovky &quot;virtuální pevné disky&quot; kontejneru na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="643b6-196">This screenshot shows the list of blobs in the &quot;vhds&quot; container on the Azure portal.</span></span> <span data-ttu-id="643b6-197">Na snímku obrazovky vidíte pět virtuální pevné disky, které byly připojené k serveru SAP HANA virtuálních počítačů, která bude sloužit jako softwaru diskového pole RAID zachovat SAP HANA záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-197">The screenshot shows the five VHDs, which were attached to the SAP HANA server VM to serve as the software RAID to keep SAP HANA backup files.</span></span> <span data-ttu-id="643b6-198">Také ukazuje pět kopií, které byly provedeny prostřednictvím příkazu Kopírovat objekt blob.</span><span class="sxs-lookup"><span data-stu-id="643b6-198">It also shows the five copies, which were taken via the blob copy command.</span></span>

![Pro účely testování byla připojena kopie disků RAID SAP HANA zálohovací software na aplikační server virtuálního počítače](media/sap-hana-backup-file-level/image033.png)

<span data-ttu-id="643b6-200">Pro účely testování byla připojena kopie disků RAID SAP HANA zálohovací software na aplikační server virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="643b6-200">For testing purposes, the copies of the SAP HANA backup software RAID disks were attached to the app server VM.</span></span>

![Zkopíruje na aplikační server, virtuální počítač byl vypnut připojit disk](media/sap-hana-backup-file-level/image034.png)

<span data-ttu-id="643b6-202">Server aplikace virtuální počítač byl vypnut připojit disk zkopíruje.</span><span class="sxs-lookup"><span data-stu-id="643b6-202">The app server VM was shut down to attach the disk copies.</span></span> <span data-ttu-id="643b6-203">Po spuštění virtuálního počítače, disky a jednotky RAID byly zjištěny správně (připojené prostřednictvím UUID).</span><span class="sxs-lookup"><span data-stu-id="643b6-203">After starting the VM, the disks and the RAID were discovered correctly (mounted via UUID).</span></span> <span data-ttu-id="643b6-204">Pouze přípojný bod nebyl nalezen, který se vytvořil prostřednictvím YaST dělicí metody.</span><span class="sxs-lookup"><span data-stu-id="643b6-204">Only the mount point was missing, which was created via the YaST partitioner.</span></span> <span data-ttu-id="643b6-205">Kopie záložní soubor SAP HANA stala později viditelné na úrovni operačního systému.</span><span class="sxs-lookup"><span data-stu-id="643b6-205">Afterwards the SAP HANA backup file copies became visible on OS level.</span></span>

## <a name="copy-sap-hana-backup-files-to-nfs-share"></a><span data-ttu-id="643b6-206">Zkopírujte SAP HANA záložní soubory do sdílené složky NFS</span><span class="sxs-lookup"><span data-stu-id="643b6-206">Copy SAP HANA backup files to NFS share</span></span>

<span data-ttu-id="643b6-207">Pokud chcete snížit potenciální dopad v systému SAP HANA z hlediska místa na disku nebo výkonu, jeden zvážit ukládání záložních souborů SAP HANA na sdílené složky NFS.</span><span class="sxs-lookup"><span data-stu-id="643b6-207">To lessen the potential impact on the SAP HANA system from a performance or disk space perspective, one might consider storing the SAP HANA backup files on an NFS share.</span></span> <span data-ttu-id="643b6-208">Technicky funguje, ale znamená použití druhý virtuální počítač Azure jako hostitele sdílené složky NFS.</span><span class="sxs-lookup"><span data-stu-id="643b6-208">Technically it works, but it means using a second Azure VM as the host of the NFS share.</span></span> <span data-ttu-id="643b6-209">Neměl by být malá velikost virtuálního počítače, z důvodu šířku pásma sítě virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="643b6-209">It should not be a small VM size, due to the VM network bandwidth.</span></span> <span data-ttu-id="643b6-210">Ho by smysl pak tento vypnout &quot;zálohování virtuálních počítačů&quot; a převeďte ho pouze pro provádění zálohování SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-210">It would make sense then to shut down this &quot;backup VM&quot; and only bring it up for executing the SAP HANA backup.</span></span> <span data-ttu-id="643b6-211">Zápis v systému souborů NFS sdílené složky vloží zatížení v síti a má to dopad SAP HANA systému, ale jenom správu později na zálohování souborů &quot;zálohování virtuálních počítačů&quot; nebude vůbec ovlivnit systému SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-211">Writing on an NFS share puts load on the network and impacts the SAP HANA system, but merely managing the backup files afterwards on the &quot;backup VM&quot; would not influence the SAP HANA system at all.</span></span>

![Sdílené složky NFS z jiného virtuálního počítače Azure byla připojena k serveru SAP HANA virtuálních počítačů](media/sap-hana-backup-file-level/image035.png)

<span data-ttu-id="643b6-213">Pokud chcete ověřit, že případ použití systému souborů NFS, sdílené složky NFS z jiného virtuálního počítače Azure byla připojena k serveru SAP HANA virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="643b6-213">To verify the NFS use case, an NFS share from another Azure VM was mounted to the SAP HANA server VM.</span></span> <span data-ttu-id="643b6-214">Došlo k dispozici žádné zvláštní systému souborů NFS ladění použít.</span><span class="sxs-lookup"><span data-stu-id="643b6-214">There was no special NFS tuning applied.</span></span>

![Trvalo 1 hodinu a 46 minut provedete zálohování přímo](media/sap-hana-backup-file-level/image036.png)

<span data-ttu-id="643b6-216">Sdílené složky NFS byl sadu rychlého stripe jako ten, na serveru SAP HANA.</span><span class="sxs-lookup"><span data-stu-id="643b6-216">The NFS share was a fast stripe set, like the one on the SAP HANA server.</span></span> <span data-ttu-id="643b6-217">Nicméně trvalo 1 hodinu a 46 minut zálohy přímo na místo 10 minut, pokud nastavíte zápis do místní stripe sdílené složky systému souborů NFS.</span><span class="sxs-lookup"><span data-stu-id="643b6-217">Nevertheless, it took 1 hour and 46 minutes to do the backup directly on the NFS share instead of 10 minutes, when writing to a local stripe set.</span></span>

![Alternativním se mnohem rychlejší v 1 a hod](media/sap-hana-backup-file-level/image037.png)

<span data-ttu-id="643b6-219">Alternativní provádění zálohování do sady místní stripe a kopírování do sdílené složky NFS na úrovni operačního systému (jednoduchou **cp - avr** příkaz) nebyla mnohem rychlejší.</span><span class="sxs-lookup"><span data-stu-id="643b6-219">The alternative of doing a backup to a local stripe set and copying to the NFS share on OS level (a simple **cp -avr** command) wasn't much quicker.</span></span> <span data-ttu-id="643b6-220">Trvalo 1 a hod.</span><span class="sxs-lookup"><span data-stu-id="643b6-220">It took 1 hour and 43 minutes.</span></span>

<span data-ttu-id="643b6-221">Proto funguje, ale nebyla výkonu vhodné pro testovací zálohování 230 GB.</span><span class="sxs-lookup"><span data-stu-id="643b6-221">So it works, but performance wasn't good for the 230-GB backup test.</span></span> <span data-ttu-id="643b6-222">Aby vypadal i zhoršení pro více terabajtů.</span><span class="sxs-lookup"><span data-stu-id="643b6-222">It would look even worse for multi terabytes.</span></span>

## <a name="copy-sap-hana-backup-files-to-azure-file-service"></a><span data-ttu-id="643b6-223">Zkopírujte záložní soubory SAP HANA do služby Azure souborů</span><span class="sxs-lookup"><span data-stu-id="643b6-223">Copy SAP HANA backup files to Azure file service</span></span>

<span data-ttu-id="643b6-224">Je možné připojit sdílenou složku Azure uvnitř virtuálního počítače Azure Linux.</span><span class="sxs-lookup"><span data-stu-id="643b6-224">It is possible to mount an Azure file share inside an Azure Linux VM.</span></span> <span data-ttu-id="643b6-225">Článek [postup používání Azure File storage s Linuxem](../../../storage/files/storage-how-to-use-files-linux.md) obsahuje podrobné informace o tom, jak to provést.</span><span class="sxs-lookup"><span data-stu-id="643b6-225">The article [How to use Azure File storage with Linux](../../../storage/files/storage-how-to-use-files-linux.md) provides details on how to do it.</span></span> <span data-ttu-id="643b6-226">Uvědomte si, že je aktuálně 5 TB kvótu jednu sdílenou složku Azure a maximální velikost souboru 1 TB na soubor.</span><span class="sxs-lookup"><span data-stu-id="643b6-226">Keep in mind that there is currently a 5-TB quota limit of one Azure file share, and a file size limit of 1 TB per file.</span></span> <span data-ttu-id="643b6-227">V tématu [a cíle výkonnosti služby Azure Storage Scalability](../../../storage/common/storage-scalability-targets.md) informace o omezení úložiště.</span><span class="sxs-lookup"><span data-stu-id="643b6-227">See [Azure Storage Scalability and Performance Targets](../../../storage/common/storage-scalability-targets.md) for information on storage limits.</span></span>

<span data-ttu-id="643b6-228">Testy ukázaly, však, že zálohování nemá SAP HANA & č. 39; t aktuálně pracovat přímo s Tento druh CIFS připojení.</span><span class="sxs-lookup"><span data-stu-id="643b6-228">Tests have shown, however, that SAP HANA backup doesn&#39;t currently work directly with this kind of CIFS mount.</span></span> <span data-ttu-id="643b6-229">Je také uvádí [1820529 Poznámka SAP](https://launchpad.support.sap.com/#/notes/1820529) , CIFS se nedoporučuje.</span><span class="sxs-lookup"><span data-stu-id="643b6-229">It is also stated in [SAP Note 1820529](https://launchpad.support.sap.com/#/notes/1820529) that CIFS is not recommended.</span></span>

![Tento obrázek ukazuje chybu, v dialogovém okně Zálohování v SAP HANA Studio](media/sap-hana-backup-file-level/image038.png)

<span data-ttu-id="643b6-231">Následující obrázek ukazuje chybu v dialogovém okně Zálohování v nástroji SAP HANA Studio při pokusu o zálohovat přímo na připojený CIFS Azure sdílené složky.</span><span class="sxs-lookup"><span data-stu-id="643b6-231">This figure shows an error in the backup dialog in SAP HANA Studio, when trying to back up directly to a CIFS-mounted Azure file share.</span></span> <span data-ttu-id="643b6-232">Proto je nutné nejprve provést standardní SAP HANA zálohování do systému souborů virtuálních počítačů a poté zkopírujte záložní soubory z ní do služby Azure souborů.</span><span class="sxs-lookup"><span data-stu-id="643b6-232">So one has to do a standard SAP HANA backup into a VM file system first, and then copy the backup files from there to Azure file service.</span></span>

![Následující obrázek ukazuje, že trvalo sekundám 929 zkopírujte záložní soubory 19 SAP HANA](media/sap-hana-backup-file-level/image039.png)

<span data-ttu-id="643b6-234">Následující obrázek ukazuje, že trvalo sekundám 929 zkopírujte záložní soubory 19 SAP HANA s celkovou velikost přibližně 230 GB do Azure sdílené složky.</span><span class="sxs-lookup"><span data-stu-id="643b6-234">This figure shows that it took about 929 seconds to copy 19 SAP HANA backup files with a total size of roughly 230 GB to the Azure file share.</span></span>

![Struktura adresáře zdroje ve virtuálním počítači SAP HANA byla zkopírována do Azure sdílené složky](media/sap-hana-backup-file-level/image040.png)

<span data-ttu-id="643b6-236">Na tomto snímku obrazovky jeden uvidí, že zdroj strukturu adresáře na virtuální počítač SAP HANA jste zkopírovali do sdílené složky Azure file: jeden adresář (hana\_zálohování\_fsl\_15 gb) a 19 jednotlivých záložní soubory.</span><span class="sxs-lookup"><span data-stu-id="643b6-236">In this screenshot, one can see that the source directory structure on the SAP HANA VM was copied to the Azure file share: one directory (hana\_backup\_fsl\_15gb) and 19 individual backup files.</span></span>

<span data-ttu-id="643b6-237">Ukládání záložních souborů SAP HANA na soubory Azure může být zajímavé možnost v budoucnu, pokud přímo záloh souboru SAP HANA ho podporují.</span><span class="sxs-lookup"><span data-stu-id="643b6-237">Storing SAP HANA backup files on Azure files could be an interesting option in the future when SAP HANA file backups support it directly.</span></span> <span data-ttu-id="643b6-238">Nebo pokud bude možné soubory Azure připojení prostřednictvím systému souborů NFS a limit maximální kvóty je podstatně vyšší než 5 TB.</span><span class="sxs-lookup"><span data-stu-id="643b6-238">Or when it becomes possible to mount Azure files via NFS and the maximum quota limit is considerably higher than 5 TB.</span></span>

## <a name="next-steps"></a><span data-ttu-id="643b6-239">Další kroky</span><span class="sxs-lookup"><span data-stu-id="643b6-239">Next steps</span></span>
* <span data-ttu-id="643b6-240">[Příručce zálohování pro SAP HANA ve virtuálních počítačích Azure](sap-hana-backup-guide.md) nabízí přehled a informace o zahájení práce.</span><span class="sxs-lookup"><span data-stu-id="643b6-240">[Backup guide for SAP HANA on Azure Virtual Machines](sap-hana-backup-guide.md) gives an overview and information on getting started.</span></span>
* <span data-ttu-id="643b6-241">[SAP HANA zálohování podle úložiště snímků](sap-hana-backup-storage-snapshots.md) popisuje zálohování možnosti založené na snímku úložiště.</span><span class="sxs-lookup"><span data-stu-id="643b6-241">[SAP HANA backup based on storage snapshots](sap-hana-backup-storage-snapshots.md) describes the storage snapshot-based backup option.</span></span>
* <span data-ttu-id="643b6-242">Další informace o vytvoření vysoké dostupnosti a plán pro zotavení po havárii SAP HANA v Azure (velké instance) naleznete v tématu [SAP HANA (velké instance) vysoké dostupnosti a zotavení po havárii v Azure](hana-overview-high-availability-disaster-recovery.md).</span><span class="sxs-lookup"><span data-stu-id="643b6-242">To learn how to establish high availability and plan for disaster recovery of SAP HANA on Azure (large instances), see [SAP HANA (large instances) high availability and disaster recovery on Azure](hana-overview-high-availability-disaster-recovery.md).</span></span>

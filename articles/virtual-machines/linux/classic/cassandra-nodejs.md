---
title: "Spouštět Cassandra s Linuxem v Azure | Microsoft Docs"
description: "Jak spustit Cassandra clusteru v systému Linux v Azure Virtual Machines z aplikace Node.js"
services: virtual-machines-linux
documentationcenter: nodejs
author: tomarcher
manager: routlaw
editor: 
tags: azure-service-management
ms.assetid: 30de1f29-e97d-492f-ae34-41ec83488de0
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 08/17/2017
ms.author: tarcher
ms.openlocfilehash: 1ff3d77ced6c9d90029b251490c05e52d9b43515
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="running-cassandra-with-linux-on-azure-and-accessing-it-from-nodejs"></a><span data-ttu-id="e4ab0-103">Spuštění Cassandry s Linuxem v Azure a přístup pomocí Node.js</span><span class="sxs-lookup"><span data-stu-id="e4ab0-103">Running Cassandra with Linux on Azure and Accessing it from Node.js</span></span>
> [!IMPORTANT] 
> <span data-ttu-id="e4ab0-104">Azure má dva různé modely nasazení pro vytváření a práci s prostředky: [Resource Manager a klasický](../../../resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="e4ab0-104">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../resource-manager-deployment-model.md).</span></span> <span data-ttu-id="e4ab0-105">Tento článek se zabývá pomocí modelu nasazení Classic.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-105">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="e4ab0-106">Microsoft doporučuje, aby byl ve většině nových nasazení použit model Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-106">Microsoft recommends that most new deployments use the Resource Manager model.</span></span> <span data-ttu-id="e4ab0-107">Zobrazit šablony Resource Manageru pro [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) a [Spark clusteru a Cassandra na CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span><span class="sxs-lookup"><span data-stu-id="e4ab0-107">See Resource Manager templates for [Datastax Enterprise](https://azure.microsoft.com/documentation/templates/datastax) and [Spark cluster and Cassandra on CentOS](https://azure.microsoft.com/documentation/templates/spark-and-cassandra-on-centos/).</span></span>

## <a name="overview"></a><span data-ttu-id="e4ab0-108">Přehled</span><span class="sxs-lookup"><span data-stu-id="e4ab0-108">Overview</span></span>
<span data-ttu-id="e4ab0-109">Microsoft Azure je platforma otevřete cloudu, která spouští obou Microsoft jako i v jiných společností než Microsoft software, který zahrnuje operační systémy, aplikační servery, zasílání zpráv middleware, jakož i databází SQL a NoSQL z obou modelů komerční s otevřeným zdrojem.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-109">Microsoft Azure is an open cloud platform that runs both Microsoft as well as non-Microsoft software which  includes operating systems, application servers, messaging middleware as well as SQL and NoSQL databases from both commercial and open source models.</span></span> <span data-ttu-id="e4ab0-110">Vytváření odolné služeb na veřejných cloudů, včetně Azure vyžaduje pečlivé plánování a architektura záměrné pro oba servery aplikace jako dobře úložiště vrstvy.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-110">Building resilient services on public clouds including Azure requires careful planning and deliberate architecture for both applications servers as well storage layers.</span></span> <span data-ttu-id="e4ab0-111">Architektura distribuovaného úložiště pro Cassandra přirozeně pomáhá při vytváření vysoce dostupných systémy, které jsou odolné proti chybám pro selhání clusteru.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-111">Cassandra’s distributed storage architecture naturally helps in building highly available systems that are fault tolerant for cluster failures.</span></span> <span data-ttu-id="e4ab0-112">Cassandra je cloudové škálování databáze NoSQL udržovat Apache Software Foundation cassandra.apache.org; Cassandra je napsán v jazyce Java a proto běží na obou v systému Windows a Linux platformy.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-112">Cassandra is a cloud scale NoSQL database maintained by Apache Software Foundation at cassandra.apache.org; Cassandra is written in Java and hence runs on both on Windows as well as Linux platforms.</span></span>

<span data-ttu-id="e4ab0-113">Cílem tohoto článku je zobrazit Cassandra nasazení na Ubuntu jako cluster s podporou jeden a více data center využívat virtuální počítače Microsoft Azure a virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-113">The focus of this article is to show Cassandra deployment on Ubuntu as a single and multi-data center cluster leveraging Microsoft Azure Virtual Machines and Virtual Networks.</span></span> <span data-ttu-id="e4ab0-114">Nasazení clusteru pro úlohy v produkčním prostředí optimalizované je mimo rámec tohoto článku jako vyžaduje konfigurace uzlu více disku, příslušné kruhová topologie návrh a modelování na podporu potřebné replikace, konzistenci dat, propustnosti a vysokou dat požadavky na dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-114">The cluster deployment for production optimized workloads is out of scope of this article as it requires multi-disk node configuration, appropriate ring topology design and data modeling to support the needed replication, data consistency, throughput and high availability requirements.</span></span>

<span data-ttu-id="e4ab0-115">Tento článek má základní přístup, zobrazit, co je součástí vytváření clusteru Cassandra porovná Docker, Chef nebo Puppet, které můžete provést nasazení infrastruktury bylo mnohem snazší.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-115">This article takes a fundamental approach to show what is involved in building the Cassandra cluster compared Docker, Chef or Puppet which can make the infrastructure deployment a lot easier.</span></span>  

## <a name="the-deployment-models"></a><span data-ttu-id="e4ab0-116">Modely nasazení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-116">The Deployment Models</span></span>
<span data-ttu-id="e4ab0-117">Microsoft Azure sítě umožňuje nasazení izolované privátní clusterů přístupu, které může být s omezeným přístupem, aby bylo možné zabezpečení podrobné sítě.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-117">Microsoft Azure networking allows the deployment of isolated private clusters, the access of which can be restricted to attain fine grained network security.</span></span>  <span data-ttu-id="e4ab0-118">Vzhledem k tomu, že tento článek se týká zobrazující Cassandra nasazení na základní úrovni, zaměříme nebude na úroveň konzistence a návrh úložiště optimální propustnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-118">Since this article is about showing the Cassandra deployment at a fundamental level, we will not focus on the consistency level and the optimal storage design for throughput.</span></span> <span data-ttu-id="e4ab0-119">Tady je seznam sítí požadavky pro naše hypotetický clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-119">Here is the list of networking requirements for our hypothetical cluster:</span></span>

* <span data-ttu-id="e4ab0-120">Externí systémy nelze získat přístup k Cassandra databáze z uvnitř nebo vně Azure</span><span class="sxs-lookup"><span data-stu-id="e4ab0-120">External systems can’t access Cassandra database from within or outside Azure</span></span>
* <span data-ttu-id="e4ab0-121">Cassandra clusteru musí být za službou Vyrovnávání zatížení pro provoz thrift</span><span class="sxs-lookup"><span data-stu-id="e4ab0-121">Cassandra cluster has to be behind a load balancer for thrift traffic</span></span>
* <span data-ttu-id="e4ab0-122">Nasazení Cassandra uzly ve dvou skupinách v každé datové centrum pro rozšířené clusteru dostupnosti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-122">Deploy Cassandra nodes in two groups in each data center for an enhanced cluster availability</span></span>
* <span data-ttu-id="e4ab0-123">Zamknout clusteru, který jen aplikace serveru farmy, měl přístup k databázi přímo</span><span class="sxs-lookup"><span data-stu-id="e4ab0-123">Lock down the cluster so that only application server farm has access to the database directly</span></span>
* <span data-ttu-id="e4ab0-124">Žádné veřejné sítě koncové body než SSH</span><span class="sxs-lookup"><span data-stu-id="e4ab0-124">No public networking endpoints other than SSH</span></span>
* <span data-ttu-id="e4ab0-125">Každý uzel Cassandra musí pevnou interní IP adresu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-125">Each Cassandra node needs a fixed internal IP address</span></span>

<span data-ttu-id="e4ab0-126">Cassandra lze nasadit do jedné oblasti Azure nebo do několika oblastí podle distribuovaná povaha zatížení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-126">Cassandra can be deployed to a single Azure region or to multiple regions based on the distributed nature of the workload.</span></span> <span data-ttu-id="e4ab0-127">Modelu nasazení s více oblasti můžete využít k obsluze koncovým uživatelům blíže konkrétní geografický prostřednictvím stejné infrastruktury, Cassandra.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-127">Multi-region deployment model can be leveraged to serve end users closer to a particular geography through the same Cassandra infrastructure.</span></span> <span data-ttu-id="e4ab0-128">Cassandra pro předdefinovaný uzel replikace trvá stará se o synchronizaci s více hlavní zapíše pocházející z několika datových centrech a představuje konzistentní zobrazení dat do aplikace.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-128">Cassandra’s built-in node replication takes care of the synchronization of multi-master writes originating from multiple data centers and presents a consistent view of the data to applications.</span></span> <span data-ttu-id="e4ab0-129">Nasazení s více oblast může také pomoci s zmírnění rizik širší výpadků služby Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-129">Multi-region deployment can also help with the risk mitigation of the broader Azure service outages.</span></span> <span data-ttu-id="e4ab0-130">Přizpůsobitelné konzistence na Cassandra a replikační topologie usnadní pokrývat různých plánovaný bod obnovení z aplikace.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-130">Cassandra’s tunable consistency and replication topology will help in meeting diverse RPO needs of applications.</span></span>

### <a name="single-region-deployment"></a><span data-ttu-id="e4ab0-131">Nasazení jedné oblasti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-131">Single Region Deployment</span></span>
<span data-ttu-id="e4ab0-132">Jsme bude začínat nasazení jedné oblasti a shromažďovat learnings při vytváření více oblast modelu.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-132">We will start with a single region deployment and harvest the learnings in creating a multi-region model.</span></span> <span data-ttu-id="e4ab0-133">Azure virtuální sítě se použije pro vytvoření izolované podsítí tak, aby lze splnit požadavky na zabezpečení sítě uvedených výše.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-133">Azure virtual networking will be used to create isolated subnets so that the network security requirements mentioned above can be met.</span></span>  <span data-ttu-id="e4ab0-134">Proces popsaný v vytvořením nasazení jedné oblasti používá Ubuntu 14.04 LTS a Cassandra 2.08; proces však můžete snadno přijímají na jiné Linux varianty.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-134">The process described in creating the single region deployment uses Ubuntu 14.04 LTS and Cassandra 2.08; however, the process can easily be adopted to the other Linux variants.</span></span> <span data-ttu-id="e4ab0-135">Následují některé systémové charakteristiky nasazení jedné oblasti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-135">The following are some of the systemic characteristics of the single region deployment.</span></span>  

<span data-ttu-id="e4ab0-136">**Vysoká dostupnost:** Cassandra uzly na obrázku 1 se nasadí do dvou sad dostupnosti tak, aby uzly se šíří mezi více domén selhání pro zajištění vysoké dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-136">**High Availability:** The Cassandra nodes shown in the Figure 1 are deployed to two availability sets so that the nodes are spread between multiple fault domains for high availability.</span></span> <span data-ttu-id="e4ab0-137">Poznámky s každou skupinu dostupnosti virtuálních počítačů je namapována na 2 domén selhání.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-137">VMs annotated with each availability set is mapped to 2 fault domains.</span></span>  <span data-ttu-id="e4ab0-138">Koncept doména selhání ke správě neplánované dolů čas (např. selhání hardwaru nebo softwaru) při koncept upgradu domény (např. hostitele nebo hosta OS opravy a upgrady, upgrady aplikací) se používá pro správu naplánované výpadek používá Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-138">Microsoft Azure uses the concept of fault domain to manage unplanned down time (e.g. hardware or software failures) while the concept of upgrade domain (e.g. host or guest OS patching/upgrades, application upgrades) is used for managing scheduled down time.</span></span> <span data-ttu-id="e4ab0-139">Najdete v tématu [zotavení po havárii a vysoká dostupnost pro aplikací Azure](http://msdn.microsoft.com/library/dn251004.aspx) pro roli selhání a upgradu domén v dosažení vysoké dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-139">Please see [Disaster Recovery and High Availability for Azure Applications](http://msdn.microsoft.com/library/dn251004.aspx) for the role of fault and upgrade domains in attaining high availability.</span></span>

![Nasazení jedné oblasti](./media/cassandra-nodejs/cassandra-linux1.png)

<span data-ttu-id="e4ab0-141">Obrázek 1: Nasazení jedné oblasti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-141">Figure 1: Single region deployment</span></span>

<span data-ttu-id="e4ab0-142">Všimněte si, že v době psaní tohoto textu, Azure neumožňuje explicitní mapování skupiny virtuálních počítačů k doméně konkrétní chyby; v důsledku toho i s modelem nasazení na obrázku 1 je statisticky pravděpodobné, že všechny virtuální počítače mohou být namapovány na dvě domény selhání místo čtyři.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-142">Note that at the time of this writing, Azure doesn’t allow the explicit mapping of a group of VMs to a specific fault domain; consequently, even with the deployment model shown in Figure 1, it is statistically probable that all the virtual machines may be mapped to two fault domains instead of four.</span></span>

<span data-ttu-id="e4ab0-143">**Přenosy Thrift Vyrovnávání zatížení:** Thrift klientské knihovny uvnitř webový server připojení ke clusteru prostřednictvím interní nástroj.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-143">**Load Balancing Thrift Traffic:** Thrift client libraries inside the web server connect to the cluster through an internal load balancer.</span></span> <span data-ttu-id="e4ab0-144">To vyžaduje proces přidávání nástroje pro vyrovnávání zatížení pro vnitřní k podsíti "data" (viz obrázek 1) v rámci cloudové služby hostování Cassandra clusteru.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-144">This requires the process of adding the internal load balancer to the “data” subnet (refer Figure 1) in the context of the cloud service hosting the Cassandra cluster.</span></span> <span data-ttu-id="e4ab0-145">Jakmile je definována pro vyrovnávání zatížení interní, vyžaduje každý uzel koncový bod skupinu s vyrovnáváním zatížení přidávaného s poznámky skupinu s vyrovnáváním zatížení s názvem služby Vyrovnávání zatížení dříve definovaném.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-145">Once the internal load balancer is defined, each node requires the load balanced endpoint to be added with the annotations of a load balanced set with previously defined load balancer name.</span></span> <span data-ttu-id="e4ab0-146">V tématu [interní Vyrovnávání zatížení Azure ](../../../load-balancer/load-balancer-internal-overview.md)další podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-146">See [Azure Internal Load Balancing ](../../../load-balancer/load-balancer-internal-overview.md)for more details.</span></span>

<span data-ttu-id="e4ab0-147">**Cluster semen:** je důležité vybrat Většina uzlů vysoce dostupný pro semena jako nové uzly budou komunikovat s uzly počáteční hodnoty pro zjišťování topologie clusteru.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-147">**Cluster Seeds:** It is important to select the most highly available nodes for seeds as the new nodes will communicate with seed nodes to discover the topology of the cluster.</span></span> <span data-ttu-id="e4ab0-148">Jeden uzel z každé skupiny dostupnosti je určený jako uzly počáteční hodnoty předejdete jediný bod selhání.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-148">One node from each availability set is designated as seed nodes to avoid single point of failure.</span></span>

<span data-ttu-id="e4ab0-149">**Zařízení a úroveň konzistence replikace:** Cassandra na sestavení v vysokou dostupnost a data odolnost je charakterizovaná replikace faktor (RF - počet kopií každého řádku uložené v clusteru) a úroveň konzistence (počet replik být číst nebo zapisovat před vrácením výsledku volající).</span><span class="sxs-lookup"><span data-stu-id="e4ab0-149">**Replication Factor and Consistency Level:** Cassandra’s build-in high-availability and data durability is characterized by the Replication Factor (RF - number of copies of each row stored on the cluster) and Consistency Level (number of replicas to be read/written before returning the result to the caller).</span></span> <span data-ttu-id="e4ab0-150">Faktor replikace je zadán během vytváření KEYSPACE (podobně jako relační databáze), zatímco úroveň konzistence je zadána při vydání CRUD dotaz.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-150">Replication factor is specified during the KEYSPACE (similar to a relational database) creation whereas the consistency level is specified while issuing the CRUD query.</span></span> <span data-ttu-id="e4ab0-151">Naleznete v dokumentaci k Cassandra v [konfigurace pro konzistence](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) konzistence podrobnosti a vzorec pro výpočty kvora.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-151">See Cassandra documentation at [Configuring for Consistency](http://www.datastax.com/documentation/cassandra/2.0/cassandra/dml/dml_config_consistency_c.html) for consistency details and the formula for quorum computation.</span></span>

<span data-ttu-id="e4ab0-152">Cassandra podporuje dva typy modelů integrity dat – konzistence a konzistence typu případné; Faktor replikace a úroveň konzistence společně určí, pokud budou data konzistentní při dokončení operace zápisu nebo bude nakonec byl konzistentní.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-152">Cassandra supports two types of data integrity models – Consistency and Eventual Consistency; the Replication Factor and Consistency Level will together determine if the data will be consistent as soon as a write operation is complete or it will be eventually consistent.</span></span> <span data-ttu-id="e4ab0-153">Například zadání KVORA jako úroveň konzistence bude vždy zajišťuje konzistenci dat při všechny úrovně konzistence, nižší než počet replik k zapsání tak, aby bylo možné KVORA (například jeden) výsledkem data se nakonec byl konzistentní.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-153">For example, specifying QUORUM as the Consistency Level will always ensures data Consistency while any consistency level, below the number of replicas to be written as needed to attain QUORUM (e.g. ONE) results in data being eventually consistent.</span></span>

<span data-ttu-id="e4ab0-154">8 uzlů clusteru s faktorem replikace 3 a KVORA zobrazeno výše, (2 uzly jsou číst nebo zapisovat konzistenci) pro čtení a zápis úroveň konzistence, přežijí teoretické ztrátu nejvýše 1 uzel na skupinu replikace před vašeho povšimnutí aplikace spustit došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-154">The 8-node cluster shown above, with a replication factor of 3 and QUORUM (2 nodes are read or written for consistency) read/write consistency level, can survive the theoretical loss of at the most 1 node per replication group before the application start noticing the failure.</span></span> <span data-ttu-id="e4ab0-155">Předpokladem je, že všechny klíče prostory mají dobře vyrovnáváním čtení/zápisu požadavků.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-155">This assumes that all the key spaces have well balanced read/write requests.</span></span>  <span data-ttu-id="e4ab0-156">Tady jsou parametry, které budeme používat nasazené clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-156">The following are the parameters we will use for the deployed cluster:</span></span>

<span data-ttu-id="e4ab0-157">Konfigurace clusteru Cassandra jedné oblasti:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-157">Single region Cassandra cluster configuration:</span></span>

| <span data-ttu-id="e4ab0-158">Parametr clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-158">Cluster Parameter</span></span> | <span data-ttu-id="e4ab0-159">Hodnota</span><span class="sxs-lookup"><span data-stu-id="e4ab0-159">Value</span></span> | <span data-ttu-id="e4ab0-160">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-160">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e4ab0-161">Počet uzlů (ne)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-161">Number of Nodes (N)</span></span> |<span data-ttu-id="e4ab0-162">8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-162">8</span></span> |<span data-ttu-id="e4ab0-163">Celkový počet uzlů v clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-163">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="e4ab0-164">Replikace faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-164">Replication Factor (RF)</span></span> |<span data-ttu-id="e4ab0-165">3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-165">3</span></span> |<span data-ttu-id="e4ab0-166">Počet replik daného řádku</span><span class="sxs-lookup"><span data-stu-id="e4ab0-166">Number of replicas of a given row</span></span> |
| <span data-ttu-id="e4ab0-167">Úroveň konzistence (zápisu)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-167">Consistency Level (Write)</span></span> |<span data-ttu-id="e4ab0-168">QUORUM[(RF/2) +1) = 2] výsledek vzorec se zaokrouhlí směrem dolů</span><span class="sxs-lookup"><span data-stu-id="e4ab0-168">QUORUM[(RF/2) +1) = 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="e4ab0-169">Zapíše maximálně 2 repliky předtím, než odešle odpověď na volajícího; 3. replika se zapíše nakonec byl konzistentní způsobem.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-169">Writes at the most 2 replicas before the response is sent to the caller; 3rd replica is written in an eventually consistent manner.</span></span> |
| <span data-ttu-id="e4ab0-170">Úroveň konzistence (čtení)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-170">Consistency Level (Read)</span></span> |<span data-ttu-id="e4ab0-171">KVORA [(RF/2) + 1 = 2] výsledek vzorec se zaokrouhlí směrem dolů</span><span class="sxs-lookup"><span data-stu-id="e4ab0-171">QUORUM [(RF/2) +1= 2] The result of the formula is rounded down</span></span> |<span data-ttu-id="e4ab0-172">Přečte 2 repliky před odesláním odpověď na volajícího.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-172">Reads 2 replicas before sending response to the caller.</span></span> |
| <span data-ttu-id="e4ab0-173">Strategie replikace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-173">Replication Strategy</span></span> |<span data-ttu-id="e4ab0-174">Viz NetworkTopologyStrategy [replikaci dat](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) v dokumentaci k Cassandra pro další informace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-174">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="e4ab0-175">Jste srozuměni s tím topologie nasazení a umístí repliky na uzlech, aby všechny repliky není skončili na stejné racku</span><span class="sxs-lookup"><span data-stu-id="e4ab0-175">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="e4ab0-176">Snitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-176">Snitch</span></span> |<span data-ttu-id="e4ab0-177">Viz GossipingPropertyFileSnitch [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) v dokumentaci k Cassandra pro další informace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-177">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="e4ab0-178">NetworkTopologyStrategy používá koncept snitch zjistit topologii.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-178">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="e4ab0-179">GossipingPropertyFileSnitch poskytuje lepší kontrolu mapování každý uzel datového centra a racku.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-179">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="e4ab0-180">Cluster použije povídání potřebný k šíření tyto informace.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-180">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="e4ab0-181">To je mnohem jednodušší v dynamické nastavení protokolu IP relativně k PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-181">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

<span data-ttu-id="e4ab0-182">**Azure aspekty pro Cassandra Cluster:** funkce Microsoft Azure Virtual Machines používá úložiště objektů Blob v Azure disku trvalosti; Úložiště Azure uloží 3 repliky každého disku pro vysokou odolnost.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-182">**Azure Considerations for Cassandra Cluster:** Microsoft Azure Virtual Machines capability uses Azure Blob storage for disk persistence; Azure Storage saves 3 replicas of each disk for high durability.</span></span> <span data-ttu-id="e4ab0-183">To znamená, že každý řádek dat vloženy do tabulky Cassandra je již uložen v 3 repliky, a proto konzistenci dat je již postaráno i v případě, že replikace faktor (RF) je 1.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-183">That means each row of data inserted into a Cassandra table is already stored in 3 replicas and hence data consistency is already taken care of even if the Replication Factor (RF) is 1.</span></span> <span data-ttu-id="e4ab0-184">Hlavní problém s Multi-Factor replikace se 1 je, zda bude aplikace i v případě selhání jednoho uzlu Cassandra prostředí výpadek.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-184">The main problem with Replication Factor being 1 is that the application will experience downtime even if a single Cassandra node fails.</span></span> <span data-ttu-id="e4ab0-185">Ale pokud uzel je vypnutý problémy (např. hardwaru, softwaru selhání systému) rozpoznáno Kontroleru prostředků infrastruktury Azure, bude zřídit nový uzel na jeho místo pomocí stejné jednotky úložiště.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-185">However, if a node is down for the problems (e.g. hardware, system software failures) recognized by Azure Fabric Controller, it will provision a new node in its place using the same storage drives.</span></span> <span data-ttu-id="e4ab0-186">Zřizování nový uzel nahradit starou může trvat několik minut.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-186">Provisioning a new node to replace the old one may take a few minutes.</span></span>  <span data-ttu-id="e4ab0-187">Pro plánované údržby činnosti, jako například změny hostovaného operačního systému, podobně jako Cassandra upgraduje a změny aplikace Kontroleru prostředků infrastruktury Azure provádí vrácení upgrady z uzlů v clusteru.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-187">Similarly for planned maintenance activities like guest OS changes, Cassandra upgrades and application changes Azure Fabric Controller performs rolling upgrades of the nodes in the cluster.</span></span>  <span data-ttu-id="e4ab0-188">Vrácení upgradu také může trvat dolů několika uzlů najednou a proto clusteru setkat s krátkou prodlevou mezi migrací pro několik oddílů.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-188">Rolling upgrades also may take down a few nodes at a time and hence the cluster may experience brief downtime for a few partitions.</span></span> <span data-ttu-id="e4ab0-189">Data však nebudou ztraceno v důsledku vestavěná redundance úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-189">However, the data will not be lost due to the built-in Azure Storage redundancy.</span></span>  

<span data-ttu-id="e4ab0-190">Pro systémy nasadit do Azure, která nevyžaduje vysokou dostupnost (například přibližně 99,9 což je totéž jako 8.76 hodin/rok; viz [vysokou dostupnost](http://en.wikipedia.org/wiki/High_availability) podrobnosti) může být možné ji spustit s RF = 1 a úroveň konzistence = jeden.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-190">For systems deployed to Azure that doesn’t require high availability (e.g. around 99.9 which is equivalent to 8.76 hrs/year; see [High Availability](http://en.wikipedia.org/wiki/High_availability) for details) you may be able to run with RF=1 and Consistency Level=ONE.</span></span>  <span data-ttu-id="e4ab0-191">Pro aplikace s požadavky na vysokou dostupnost, RF = 3 a úroveň konzistence = KVORA budou tolerovat výpadkům jednoho z uzlů z replik.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-191">For applications with high availability requirements, RF=3 and Consistency Level=QUORUM will tolerate the down time of one of the nodes one of the replicas.</span></span> <span data-ttu-id="e4ab0-192">RF = 1 v tradiční nasazení (například místní) nelze použít kvůli ztrátě dat. výsledkem problémy, jako je selhání disku.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-192">RF=1 in traditional deployments (e.g. on-premises) can’t be used due to the possible data loss resulting from problems like disk failures.</span></span>   

## <a name="multi-region-deployment"></a><span data-ttu-id="e4ab0-193">Nasazení s více oblast</span><span class="sxs-lookup"><span data-stu-id="e4ab0-193">Multi-region Deployment</span></span>
<span data-ttu-id="e4ab0-194">Model pro replikaci a konzistence datového centra s deklaracemi na Cassandra je popsané výše pomáhá při nasazení několika oblast předinstalované bez nutnosti žádné externí nástroje.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-194">Cassandra’s data-center-aware replication and consistency model described above helps with the multi-region deployment out of the box without the need for any external tooling.</span></span> <span data-ttu-id="e4ab0-195">Toto je výrazně lišit od tradičních relačních databází, kde může být poměrně složité nastavení pro zrcadlení databáze pro více hlavních zápisy.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-195">This is quite different from the traditional relational databases where the setup for database mirroring for multi-master writes can be quite complex.</span></span> <span data-ttu-id="e4ab0-196">Cassandra v několika oblasti nastavit můžou pomoct s scénáře použití, včetně následujících:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-196">Cassandra in a multi-region set up can help with the usage scenarios including the following:</span></span>

<span data-ttu-id="e4ab0-197">**Bezkontaktní komunikace na základě nasazení:** víceklientským aplikacím s zrušte mapování uživatelů klienta-na-oblast, můžete prospěch ve více oblastech clusteru nízkou latenci.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-197">**Proximity based deployment:** Multi-tenant applications, with clear mapping of tenant users -to-region, can be benefited by the multi-region cluster’s low latencies.</span></span> <span data-ttu-id="e4ab0-198">Například správy učení systémy pro vzdělávací instituce můžete nasadit cluster distribuované v oblasti Východ USA a západní USA k obsluze příslušných univerzity pro transakční i analytics.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-198">For example a learning management systems for educational institutions can deploy a distributed cluster in East US and West US regions to serve the respective campuses for transactional as well as analytics.</span></span> <span data-ttu-id="e4ab0-199">Data lze místně konzistentní čas čtení a zápisu a může být v obou oblastech nakonec byl konzistentní.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-199">The data can be locally consistent at the time reads and writes and can be eventually consistent across both the regions.</span></span> <span data-ttu-id="e4ab0-200">Existují další příklady jako distribuční média, elektronické obchodování a nic a všechno, co se uživatel geograficky soustředí slouží základní je případ vhodné využít pro tento model nasazení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-200">There are other examples like media distribution, e-commerce and anything and everything that serves geo concentrated user base is a good use case for this deployment model.</span></span>

<span data-ttu-id="e4ab0-201">**Vysoká dostupnost:** redundance je klíčovým faktorem k dosažení vysoké dostupnosti softwaru a hardwaru; podrobnosti najdete v části vytváření spolehlivé cloudové systémy v Microsoft Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-201">**High Availability:** Redundancy is a key factor in attaining high availability of software and hardware; see Building Reliable Cloud Systems on Microsoft Azure for details.</span></span> <span data-ttu-id="e4ab0-202">Pouze spolehlivé způsobem dosáhnout true redundance v Microsoft Azure, je nasazení clusteru s podporou více oblast.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-202">On Microsoft Azure, the only reliable way of achieving true redundancy is by deploying a multi-region cluster.</span></span> <span data-ttu-id="e4ab0-203">Mohou být aplikace nasazeny v režimu aktivní aktivní nebo aktivní – pasivní, a pokud jeden z oblastí je vypnutý, můžete Azure Traffic Manager přesměrování provozu na aktivní oblasti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-203">Applications can be deployed in an active-active or active-passive mode and if one of the regions is down, Azure Traffic Manager can redirect traffic to the active region.</span></span>  <span data-ttu-id="e4ab0-204">Při nasazení jedné oblasti dostupnost 99,9, je-li dva oblast nasazení můžete zajistit s dostupností 99.9999 vypočítanou ze vzorce: (1-(1-0.999) * (1-0,999)) * 100); viz výše dokumentu podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-204">With the single region deployment, if the availability is 99.9, a two-region deployment can attain an availability of 99.9999 computed by the formula: (1-(1-0.999) * (1-0.999))*100); see the above paper for details.</span></span>

<span data-ttu-id="e4ab0-205">**Zotavení po havárii:** Cassandra více oblast clusteru, pokud správně navržená tak, odolat závažné data center výpadků.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-205">**Disaster Recovery:** Multi-region Cassandra cluster, if properly designed, can withstand catastrophic data center outages.</span></span> <span data-ttu-id="e4ab0-206">Pokud jedné oblasti je vypnutý, můžete aplikaci nasadit do jiných oblastí spustit obsluhující koncoví uživatelé.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-206">If one region is down, the application deployed to other regions can start serving the end users.</span></span> <span data-ttu-id="e4ab0-207">Podobně jako jakékoli jiné firmy kontinuity implementace aplikace musí být odolný vůči chybám pro ztrátu dat, která je výsledkem dat v asynchronní kanál.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-207">Like any other business continuity implementations, the application has to be tolerant for some data loss resulting from the data in the asynchronous pipeline.</span></span> <span data-ttu-id="e4ab0-208">Ale Cassandra umožňuje obnovení mnohem rychlejší, než doba, za kterou procesy tradiční databáze obnovení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-208">However, Cassandra makes the recovery much swifter than the time taken by traditional database recovery processes.</span></span> <span data-ttu-id="e4ab0-209">Obrázek 2 ukazuje model typické nasazení s více oblasti s osmi uzlů v každé oblasti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-209">Figure 2 shows the typical multi-region deployment model with eight nodes in each region.</span></span> <span data-ttu-id="e4ab0-210">Obě oblasti jsou Image zrcadlení vzájemně pro stejný symetrie; skutečných návrhů závisí na typu úlohy (např. transakční nebo analytical), plánovaný bod obnovení, RTO, konzistenci dat a požadavky na dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-210">Both regions are mirror images of each other for the same of symmetry; real world designs depend on the workload type (e.g. transactional or analytical), RPO, RTO, data consistency and availability requirements.</span></span>

![Nasazení více oblast](./media/cassandra-nodejs/cassandra-linux2.png)

<span data-ttu-id="e4ab0-212">Obrázek 2: Nasazení s více oblast Cassandra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-212">Figure 2: Multi-region Cassandra deployment</span></span>

### <a name="network-integration"></a><span data-ttu-id="e4ab0-213">Integrace sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-213">Network Integration</span></span>
<span data-ttu-id="e4ab0-214">Nastaví virtuální počítače nasazené na soukromých sítích, které se nachází na dvou oblastí komunikuje se navzájem pomocí tunelového připojení sítě VPN.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-214">Sets of virtual machines deployed to private networks located on two regions communicates with each other using a VPN tunnel.</span></span> <span data-ttu-id="e4ab0-215">Tunelové propojení VPN se připojí dvě brány softwaru zřízenou během procesu nasazení sítě.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-215">The VPN tunnel connects two software gateways provisioned during the network deployment process.</span></span> <span data-ttu-id="e4ab0-216">Obě oblasti mají podobné síťovou architekturu z hlediska podsítě "web" a "data"; Azure sítě umožňuje vytvoření tolik podsítě podle potřeby a použít seznamy řízení přístupu podle potřeb zabezpečení sítě.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-216">Both regions have similar network architecture in terms of “web” and “data” subnets; Azure networking allows the creation of as many subnets as needed and apply ACLs as needed by network security.</span></span> <span data-ttu-id="e4ab0-217">Při navrhování mimo topologie clusteru pro latence při komunikaci datového centra a hospodářského dopad síťového provozu je potřeba zvážit.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-217">While designing the cluster topology inter data center communication latency and the economic impact of the network traffic need to be considered.</span></span>

### <a name="data-consistency-for-multi-data-center-deployment"></a><span data-ttu-id="e4ab0-218">Konzistence dat pro nasazení s více datového centra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-218">Data Consistency for Multi-Data Center Deployment</span></span>
<span data-ttu-id="e4ab0-219">Distribuované nasazení je potřeba mít na paměti clusteru topologie dopad na propustnost a vysokou dostupnost.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-219">Distributed deployments need to be aware of the cluster topology impact on throughput and high availability.</span></span> <span data-ttu-id="e4ab0-220">RF a úroveň konzistence musí být vybrána tak, že kvora nezávisí na dostupnost datových centrech.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-220">The RF and Consistency Level need to be selected in such way that the quorum doesn’t depend on the availability of all the data centers.</span></span>
<span data-ttu-id="e4ab0-221">Pro systém, který potřebuje vysokou konzistence bude LOCAL_QUORUM pro úroveň konzistence (pro čtení a zápisy) ujistěte se, že místní čtení a zápisu jsou splněny z místní uzlů při data se replikují asynchronně vzdálené datových střediscích.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-221">For a system that needs high consistency, a LOCAL_QUORUM for consistency level (for reads and writes) will make sure that the local reads and writes are satisfied from the local nodes while data is replicated asynchronously to the remote data centers.</span></span>  <span data-ttu-id="e4ab0-222">Tabulka 2 shrnuje podrobnosti konfigurace clusteru více oblast uvedených v zápisu až později.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-222">Table 2 summarizes the configuration details for the multi-region cluster outlined later in the write up.</span></span>

<span data-ttu-id="e4ab0-223">**Konfigurace clusteru Cassandra dva oblast**</span><span class="sxs-lookup"><span data-stu-id="e4ab0-223">**Two-region Cassandra cluster configuration**</span></span>

| <span data-ttu-id="e4ab0-224">Parametr clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-224">Cluster Parameter</span></span> | <span data-ttu-id="e4ab0-225">Hodnota</span><span class="sxs-lookup"><span data-stu-id="e4ab0-225">Value</span></span> | <span data-ttu-id="e4ab0-226">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-226">Remarks</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e4ab0-227">Počet uzlů (ne)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-227">Number of Nodes (N)</span></span> |<span data-ttu-id="e4ab0-228">8 + 8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-228">8 + 8</span></span> |<span data-ttu-id="e4ab0-229">Celkový počet uzlů v clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-229">Total number of nodes in the cluster</span></span> |
| <span data-ttu-id="e4ab0-230">Replikace faktor (RF)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-230">Replication Factor (RF)</span></span> |<span data-ttu-id="e4ab0-231">3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-231">3</span></span> |<span data-ttu-id="e4ab0-232">Počet replik daného řádku</span><span class="sxs-lookup"><span data-stu-id="e4ab0-232">Number of replicas of a given row</span></span> |
| <span data-ttu-id="e4ab0-233">Úroveň konzistence (zápisu)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-233">Consistency Level (Write)</span></span> |<span data-ttu-id="e4ab0-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] výsledek vzorec se zaokrouhlí směrem dolů</span><span class="sxs-lookup"><span data-stu-id="e4ab0-234">LOCAL_QUORUM [(sum(RF)/2) +1) = 4] The result of the formula is rounded down</span></span> |<span data-ttu-id="e4ab0-235">2 uzly budou zapisovat do první datového centra synchronně; Další 2 uzly, které jsou potřebné pro kvorum se asynchronně zapíše do 2 datového centra.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-235">2 nodes will be written to the first data center synchronously; the additional 2 nodes needed for quorum will be written asynchronously to the 2nd data center.</span></span> |
| <span data-ttu-id="e4ab0-236">Úroveň konzistence (čtení)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-236">Consistency Level (Read)</span></span> |<span data-ttu-id="e4ab0-237">LOCAL_QUORUM ((RF/2) + 1) = 2, výsledek vzorec se zaokrouhlí směrem dolů</span><span class="sxs-lookup"><span data-stu-id="e4ab0-237">LOCAL_QUORUM ((RF/2) +1) = 2 The result of the formula is rounded down</span></span> |<span data-ttu-id="e4ab0-238">Požadavky pro čtení jsou splnit v pouze jedna oblast; 2 uzly se čtou předtím, než odešle odpověď zpět klientovi.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-238">Read requests are satisfied from only one region; 2 nodes are read before the response is sent back to the client.</span></span> |
| <span data-ttu-id="e4ab0-239">Strategie replikace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-239">Replication Strategy</span></span> |<span data-ttu-id="e4ab0-240">Viz NetworkTopologyStrategy [replikaci dat](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) v dokumentaci k Cassandra pro další informace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-240">NetworkTopologyStrategy see [Data Replication](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureDataDistributeReplication_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="e4ab0-241">Jste srozuměni s tím topologie nasazení a umístí repliky na uzlech, aby všechny repliky není skončili na stejné racku</span><span class="sxs-lookup"><span data-stu-id="e4ab0-241">Understands the deployment topology and places replicas on nodes so that all the replicas don’t end up on the same rack</span></span> |
| <span data-ttu-id="e4ab0-242">Snitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-242">Snitch</span></span> |<span data-ttu-id="e4ab0-243">Viz GossipingPropertyFileSnitch [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) v dokumentaci k Cassandra pro další informace</span><span class="sxs-lookup"><span data-stu-id="e4ab0-243">GossipingPropertyFileSnitch see [Snitches](http://www.datastax.com/documentation/cassandra/2.0/cassandra/architecture/architectureSnitchesAbout_c.html) in Cassandra documentation for more information</span></span> |<span data-ttu-id="e4ab0-244">NetworkTopologyStrategy používá koncept snitch zjistit topologii.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-244">NetworkTopologyStrategy uses a concept of snitch to understand the topology.</span></span> <span data-ttu-id="e4ab0-245">GossipingPropertyFileSnitch poskytuje lepší kontrolu mapování každý uzel datového centra a racku.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-245">GossipingPropertyFileSnitch gives better control in mapping each node to data center and rack.</span></span> <span data-ttu-id="e4ab0-246">Cluster použije povídání potřebný k šíření tyto informace.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-246">The cluster then uses gossip to propagate this information.</span></span> <span data-ttu-id="e4ab0-247">To je mnohem jednodušší v dynamické nastavení protokolu IP relativně k PropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-247">This is much simpler in dynamic IP setting relative to PropertyFileSnitch</span></span> |

## <a name="the-software-configuration"></a><span data-ttu-id="e4ab0-248">KONFIGURACE SOFTWARU</span><span class="sxs-lookup"><span data-stu-id="e4ab0-248">THE SOFTWARE CONFIGURATION</span></span>
<span data-ttu-id="e4ab0-249">Během nasazení se používají následující verze softwaru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-249">The following software versions are used during the deployment:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-250">Software</span><span class="sxs-lookup"><span data-stu-id="e4ab0-250">Software</span></span></th><th><span data-ttu-id="e4ab0-251">Zdroj</span><span class="sxs-lookup"><span data-stu-id="e4ab0-251">Source</span></span></th><th><span data-ttu-id="e4ab0-252">Verze</span><span class="sxs-lookup"><span data-stu-id="e4ab0-252">Version</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-253">PROSTŘEDÍ JRE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-253">JRE</span></span>    </td><td><span data-ttu-id="e4ab0-254">[PROSTŘEDÍ JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span><span class="sxs-lookup"><span data-stu-id="e4ab0-254">[JRE 8](http://www.oracle.com/technetwork/java/javase/downloads/server-jre8-downloads-2133154.html) </span></span></td><td><span data-ttu-id="e4ab0-255">8U5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-255">8U5</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-256">JNA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-256">JNA</span></span>    </td><td><span data-ttu-id="e4ab0-257">[JNA](https://github.com/twall/jna) </span><span class="sxs-lookup"><span data-stu-id="e4ab0-257">[JNA](https://github.com/twall/jna) </span></span></td><td> <span data-ttu-id="e4ab0-258">3.2.7</span><span class="sxs-lookup"><span data-stu-id="e4ab0-258">3.2.7</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-259">Cassandra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-259">Cassandra</span></span></td><td>[<span data-ttu-id="e4ab0-260">Apache Cassandra 2.0.8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-260">Apache Cassandra 2.0.8</span></span>](http://www.apache.org/dist/cassandra/2.0.8/apache-cassandra-2.0.8-bin.tar.gz)</td><td> <span data-ttu-id="e4ab0-261">2.0.8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-261">2.0.8</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-262">Ubuntu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-262">Ubuntu</span></span>    </td><td><span data-ttu-id="e4ab0-263">[Microsoft Azure](https://azure.microsoft.com/) </span><span class="sxs-lookup"><span data-stu-id="e4ab0-263">[Microsoft Azure](https://azure.microsoft.com/) </span></span></td><td><span data-ttu-id="e4ab0-264">14.04 LTS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-264">14.04 LTS</span></span></td></tr>
</table>

<span data-ttu-id="e4ab0-265">Vzhledem k tomu, že stahování prostředí JRE vyžaduje ruční přijetí licenčních Oracle, zjednodušit nasazení, stáhněte veškerý požadovaný software na plochu později nahrát do Ubuntu image šablony, které budeme vytvářet jako předchůdcem nasazení clusteru služby.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-265">Since downloading of JRE requires manual acceptance of Oracle license, to simplify the deployment, download all the required software to the desktop for later uploading into the Ubuntu template image we will be creating as a precursor to the cluster deployment.</span></span>

<span data-ttu-id="e4ab0-266">Stáhněte si výše uvedený software do adresáře dobře známé stahování (např. %TEMP%/downloads v systému Windows nebo ~/Downloads na Linuxových distribucích většiny Mac) v místním počítači.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-266">Download the above software into a well-known download directory (e.g. %TEMP%/downloads on Windows or ~/Downloads on most Linux distributions or Mac) on the local computer.</span></span>

### <a name="create-ubuntu-vm"></a><span data-ttu-id="e4ab0-267">VYTVOŘENÍ VIRTUÁLNÍHO POČÍTAČE S UBUNTU</span><span class="sxs-lookup"><span data-stu-id="e4ab0-267">CREATE UBUNTU VM</span></span>
<span data-ttu-id="e4ab0-268">V tomto kroku procesu Ubuntu image pomocí vytvoříme požadovaného softwaru tak, aby bitovou kopii můžete znovu použít pro několik uzlů Cassandra zřizování.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-268">In this step of the process we will create Ubuntu image with the pre-requisite software so that the image can be reused for provisioning several Cassandra nodes.</span></span>  

#### <a name="step-1-generate-ssh-key-pair"></a><span data-ttu-id="e4ab0-269">Krok 1: Vygenerovat pár klíčů SSH</span><span class="sxs-lookup"><span data-stu-id="e4ab0-269">STEP 1: Generate SSH key pair</span></span>
<span data-ttu-id="e4ab0-270">Azure potřebuje X509 veřejný klíč, který je PEM nebo DER kódovaný během zřizování.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-270">Azure needs an X509 public key that is either PEM or DER encoded at the provisioning time.</span></span> <span data-ttu-id="e4ab0-271">Generování páru veřejného a privátního klíče RSA podle pokynů v tom, jak použití SSH se systémem Linux v Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-271">Generate a public/private key pair using the instructions located at How to Use SSH with Linux on Azure.</span></span> <span data-ttu-id="e4ab0-272">Pokud budete chtít použít putty.exe jako klienta SSH buď na systému Windows nebo Linux, je nutné převést PEM kódovaný privátního klíče RSA PPK formátu s využitím puttygen.exe; Pokyny k tomuto naleznete na webové stránce nahoře.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-272">If you plan to use putty.exe as an SSH client either on Windows or Linux, you have to convert the PEM encoded RSA private key to PPK format using puttygen.exe; the instructions for this can be found in the above web page.</span></span>

#### <a name="step-2-create-ubuntu-template-vm"></a><span data-ttu-id="e4ab0-273">Krok 2: Vytvoření Ubuntu šablony virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="e4ab0-273">STEP 2: Create Ubuntu template VM</span></span>
<span data-ttu-id="e4ab0-274">Vytvořit šablonu virtuálního počítače, přihlaste se k portálu Azure classic a použijte následující posloupnost: klikněte na tlačítko Nový, výpočetní, virtuální počítač, FROM GALERIE, UBUNTU a Ubuntu Server 14.04 LTS a klikněte na šipku vpravo.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-274">To create the template VM, log into the Azure classic portal and use the following sequence: Click NEW, COMPUTE, VIRTUAL MACHINE, FROM GALLERY, UBUNTU, Ubuntu Server 14.04 LTS, and then click the right arrow.</span></span> <span data-ttu-id="e4ab0-275">Kurz, který popisuje, jak vytvořit virtuální počítač s Linuxem, najdete v části vytvořit virtuální počítač systémem Linux.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-275">For a tutorial that describes how to create a Linux VM, see Create a Virtual Machine Running Linux.</span></span>

<span data-ttu-id="e4ab0-276">Na obrazovce "Konfigurace virtuálního počítače" #1 zadejte následující informace:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-276">Enter the following information on the “Virtual machine configuration” screen #1:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-277">NÁZEV POLE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-277">FIELD NAME</span></span>              </td><td>       <span data-ttu-id="e4ab0-278">HODNOTA POLE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-278">FIELD VALUE</span></span>               </td><td>         <span data-ttu-id="e4ab0-279">POZNÁMKY</span><span class="sxs-lookup"><span data-stu-id="e4ab0-279">REMARKS</span></span>                </td><tr>
<tr><td><span data-ttu-id="e4ab0-280">DATUM VYDÁNÍ VERZE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-280">VERSION RELEASE DATE</span></span>    </td><td> <span data-ttu-id="e4ab0-281">Vyberte datum z rozevírací nabídky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-281">Select a date from the drop down</span></span></td><td></td><tr>
<tr><td><span data-ttu-id="e4ab0-282">NÁZEV VIRTUÁLNÍHO POČÍTAČE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-282">VIRTUAL MACHINE NAME</span></span>    </td><td> <span data-ttu-id="e4ab0-283">Cass šablony.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-283">cass-template</span></span>                   </td><td> <span data-ttu-id="e4ab0-284">Toto je název hostitele virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-284">This is the hostname of the VM</span></span> </td><tr>
<tr><td><span data-ttu-id="e4ab0-285">VRSTVY</span><span class="sxs-lookup"><span data-stu-id="e4ab0-285">TIER</span></span>                     </td><td> <span data-ttu-id="e4ab0-286">STANDARD</span><span class="sxs-lookup"><span data-stu-id="e4ab0-286">STANDARD</span></span>                           </td><td> <span data-ttu-id="e4ab0-287">Ponechte výchozí nastavení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-287">Leave the default</span></span>              </td><tr>
<tr><td><span data-ttu-id="e4ab0-288">VELIKOST</span><span class="sxs-lookup"><span data-stu-id="e4ab0-288">SIZE</span></span>                     </td><td> <span data-ttu-id="e4ab0-289">A1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-289">A1</span></span>                              </td><td><span data-ttu-id="e4ab0-290">Vyberte virtuální počítač, na základě potřeb vstupně-výstupní operace; pro tento účel ponechte výchozí nastavení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-290">Select the VM based on the IO needs; for this purpose leave the default</span></span> </td><tr>
<tr><td> <span data-ttu-id="e4ab0-291">NOVÉ UŽIVATELSKÉ JMÉNO</span><span class="sxs-lookup"><span data-stu-id="e4ab0-291">NEW USER NAME</span></span>             </td><td> <span data-ttu-id="e4ab0-292">localadmin</span><span class="sxs-lookup"><span data-stu-id="e4ab0-292">localadmin</span></span>                       </td><td> <span data-ttu-id="e4ab0-293">"admin" je vyhrazené uživatelské jméno ve 12. xx Ubuntu a</span><span class="sxs-lookup"><span data-stu-id="e4ab0-293">"admin" is a reserved user name in Ubuntu 12.xx and after</span></span></td><tr>
<tr><td> <span data-ttu-id="e4ab0-294">OVĚŘOVÁNÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-294">AUTHENTICATION</span></span>         </td><td> <span data-ttu-id="e4ab0-295">Klikněte na zaškrtávací políčko</span><span class="sxs-lookup"><span data-stu-id="e4ab0-295">Click check box</span></span>                 </td><td><span data-ttu-id="e4ab0-296">Zkontrolujte, zda chcete zabezpečit pomocí klíče SSH</span><span class="sxs-lookup"><span data-stu-id="e4ab0-296">Check if you want to secure with an SSH key</span></span> </td><tr>
<tr><td> <span data-ttu-id="e4ab0-297">CERTIFIKÁT</span><span class="sxs-lookup"><span data-stu-id="e4ab0-297">CERTIFICATE</span></span>             </td><td> <span data-ttu-id="e4ab0-298">Název souboru certifikátu veřejného klíče</span><span class="sxs-lookup"><span data-stu-id="e4ab0-298">file name of the public key certificate</span></span> </td><td> <span data-ttu-id="e4ab0-299">Použijte veřejný klíč vygenerovaný dříve</span><span class="sxs-lookup"><span data-stu-id="e4ab0-299">Use the public key generated previously</span></span></td><tr>
<tr><td> <span data-ttu-id="e4ab0-300">Nové heslo</span><span class="sxs-lookup"><span data-stu-id="e4ab0-300">New Password</span></span>    </td><td> <span data-ttu-id="e4ab0-301">silné heslo</span><span class="sxs-lookup"><span data-stu-id="e4ab0-301">strong password</span></span> </td><td> </td><tr>
<tr><td> <span data-ttu-id="e4ab0-302">Potvrzení hesla</span><span class="sxs-lookup"><span data-stu-id="e4ab0-302">Confirm Password</span></span>    </td><td> <span data-ttu-id="e4ab0-303">silné heslo</span><span class="sxs-lookup"><span data-stu-id="e4ab0-303">strong password</span></span> </td><td></td><tr>
</table>

<span data-ttu-id="e4ab0-304">Na obrazovce "Konfigurace virtuálního počítače" #2 zadejte následující informace:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-304">Enter the following information on the “Virtual machine configuration” screen #2:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-305">NÁZEV POLE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-305">FIELD NAME</span></span>             </th><th> <span data-ttu-id="e4ab0-306">HODNOTA POLE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-306">FIELD VALUE</span></span>                       </th><th> <span data-ttu-id="e4ab0-307">POZNÁMKY</span><span class="sxs-lookup"><span data-stu-id="e4ab0-307">REMARKS</span></span>                                 </th></tr>
<tr><td> <span data-ttu-id="e4ab0-308">CLOUDOVÉ SLUŽBY</span><span class="sxs-lookup"><span data-stu-id="e4ab0-308">CLOUD SERVICE</span></span>    </td><td> <span data-ttu-id="e4ab0-309">Vytvořte novou cloudovou službu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-309">Create a new cloud service</span></span>    </td><td><span data-ttu-id="e4ab0-310">Cloudová služba je kontejner výpočetní prostředky, a to jako virtuální počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-310">Cloud service is a container compute resources like virtual machines</span></span></td></tr>
<tr><td> <span data-ttu-id="e4ab0-311">NÁZEV CLOUDOVÉ SLUŽBY DNS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-311">CLOUD SERVICE DNS NAME</span></span>    </td><td><span data-ttu-id="e4ab0-312">Ubuntu template.cloudapp.net</span><span class="sxs-lookup"><span data-stu-id="e4ab0-312">ubuntu-template.cloudapp.net</span></span>    </td><td><span data-ttu-id="e4ab0-313">Pojmenujte nástroje pro vyrovnávání zatížení lhostejné počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-313">Give a machine agnostic load balancer name</span></span></td></tr>
<tr><td> <span data-ttu-id="e4ab0-314">OBLASTI NEBO SKUPINY VZTAHŮ NEBO VIRTUÁLNÍ SÍTĚ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-314">REGION/AFFINITY GROUP/VIRTUAL NETWORK</span></span> </td><td>    <span data-ttu-id="e4ab0-315">Západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-315">West US</span></span>    </td><td> <span data-ttu-id="e4ab0-316">Vyberte oblast, ve kterém webových aplikací přístup ke clusteru Cassandra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-316">Select a region from which your web applications access the Cassandra cluster</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-317">ÚČET ÚLOŽIŠTĚ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-317">STORAGE ACCOUNT</span></span> </td><td>    <span data-ttu-id="e4ab0-318">Použít výchozí</span><span class="sxs-lookup"><span data-stu-id="e4ab0-318">Use default</span></span>    </td><td><span data-ttu-id="e4ab0-319">Použít výchozí účet úložiště nebo předem vytvořený účet úložiště v určité oblasti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-319">Use the default storage account  or a pre-created storage account in a particular region</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-320">SADY DOSTUPNOSTI.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-320">AVAILABILITY SET</span></span> </td><td>    <span data-ttu-id="e4ab0-321">Žádný</span><span class="sxs-lookup"><span data-stu-id="e4ab0-321">None</span></span> </td><td>    <span data-ttu-id="e4ab0-322">Ponechat prázdné</span><span class="sxs-lookup"><span data-stu-id="e4ab0-322">Leave it blank</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-323">KONCOVÉ BODY</span><span class="sxs-lookup"><span data-stu-id="e4ab0-323">ENDPOINTS</span></span>    </td><td><span data-ttu-id="e4ab0-324">Použít výchozí</span><span class="sxs-lookup"><span data-stu-id="e4ab0-324">Use default</span></span> </td><td>    <span data-ttu-id="e4ab0-325">Použít výchozí konfiguraci SSH</span><span class="sxs-lookup"><span data-stu-id="e4ab0-325">Use the default SSH configuration</span></span> </td></tr>
</table>

<span data-ttu-id="e4ab0-326">Klikněte na šipku vpravo, ponechte výchozí nastavení na obrazovce #3 a klikněte na tlačítko "kontrola" k dokončení procesu zřizování virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-326">Click right arrow, leave the defaults on the screen #3 and click the “check” button to complete the VM provisioning process.</span></span> <span data-ttu-id="e4ab0-327">Po několika minutách by měly mít virtuální počítač s názvem "ubuntu šablona" stavu "spuštění".</span><span class="sxs-lookup"><span data-stu-id="e4ab0-327">After a few minutes, the VM with the name “ubuntu-template” should be in a “running” status.</span></span>

### <a name="install-the-necessary-software"></a><span data-ttu-id="e4ab0-328">NAINSTALUJTE POTŘEBNÝ SOFTWARE</span><span class="sxs-lookup"><span data-stu-id="e4ab0-328">INSTALL THE NECESSARY SOFTWARE</span></span>
#### <a name="step-1-upload-tarballs"></a><span data-ttu-id="e4ab0-329">Krok 1: Nahrávání tarballs</span><span class="sxs-lookup"><span data-stu-id="e4ab0-329">STEP 1: Upload tarballs</span></span>
<span data-ttu-id="e4ab0-330">Spojovací bod služby nebo pscp používáte, zkopírujte dříve stažené softwaru ~/downloads adresář v následujícím formátu příkaz:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-330">Using scp or pscp, copy the previously downloaded software to ~/downloads directory using the following command format:</span></span>

##### <a name="pscp-server-jre-8u5-linux-x64targz-localadminhk-cas-templatecloudappnethomelocaladmindownloadsserver-jre-8u5-linux-x64targz"></a><span data-ttu-id="e4ab0-331">pscp server-prostředí jre-8u5-linux-x64.tar.gzlocaladmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span><span class="sxs-lookup"><span data-stu-id="e4ab0-331">pscp server-jre-8u5-linux-x64.tar.gz localadmin@hk-cas-template.cloudapp.net:/home/localadmin/downloads/server-jre-8u5-linux-x64.tar.gz</span></span>
<span data-ttu-id="e4ab0-332">Zopakujte výše uvedeném příkazu pro prostředí JRE také jako Cassandra bits.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-332">Repeat the above command for JRE as well as for the Cassandra bits.</span></span>

#### <a name="step-2-prepare-the-directory-structure-and-extract-the-archives"></a><span data-ttu-id="e4ab0-333">Krok 2: Příprava strukturu adresáře a extrahovat archivu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-333">STEP 2: Prepare the directory structure and extract the archives</span></span>
<span data-ttu-id="e4ab0-334">Přihlaste se k virtuálnímu počítači a vytvořte strukturu adresáře a extrahovat softwaru jako superuživatele pomocí skriptu bash níže:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-334">Log into the VM and create the directory structure and extract software as a super user using the bash script below:</span></span>

    #!/bin/bash
    CASS_INSTALL_DIR="/opt/cassandra"
    JRE_INSTALL_DIR="/opt/java"
    CASS_DATA_DIR="/var/lib/cassandra"
    CASS_LOG_DIR="/var/log/cassandra"
    DOWNLOADS_DIR="~/downloads"
    JRE_TARBALL="server-jre-8u5-linux-x64.tar.gz"
    CASS_TARBALL="apache-cassandra-2.0.8-bin.tar.gz"
    SVC_USER="localadmin"

    RESET_ERROR=1
    MKDIR_ERROR=2

    reset_installation ()
    {
       rm -rf $CASS_INSTALL_DIR 2> /dev/null
       rm -rf $JRE_INSTALL_DIR 2> /dev/null
       rm -rf $CASS_DATA_DIR 2> /dev/null
       rm -rf $CASS_LOG_DIR 2> /dev/null
    }
    make_dir ()
    {
       if [ -z "$1" ]
       then
          echo "make_dir: invalid directory name"
          exit $MKDIR_ERROR
       fi

       if [ -d "$1" ]
       then
          echo "make_dir: directory already exists"
          exit $MKDIR_ERROR
       fi

       mkdir $1 2>/dev/null
       if [ $? != 0 ]
       then
          echo "directory creation failed"
          exit $MKDIR_ERROR
       fi
    }

    unzip()
    {
       if [ $# == 2 ]
       then
          tar xzf $1 -C $2
       else
          echo "archive error"
       fi

    }

    if [ -n "$1" ]
    then
       SVC_USER=$1
    fi

    reset_installation
    make_dir $CASS_INSTALL_DIR
    make_dir $JRE_INSTALL_DIR
    make_dir $CASS_DATA_DIR
    make_dir $CASS_LOG_DIR

    #unzip JRE and Cassandra
    unzip $HOME/downloads/$JRE_TARBALL $JRE_INSTALL_DIR
    unzip $HOME/downloads/$CASS_TARBALL $CASS_INSTALL_DIR

    #Change the ownership to the service credentials

    chown -R $SVC_USER:$GROUP $CASS_DATA_DIR
    chown -R $SVC_USER:$GROUP $CASS_LOG_DIR
    echo "edit /etc/profile to add JRE to the PATH"
    echo "installation is complete"


<span data-ttu-id="e4ab0-335">Pokud tento skript můžete vložit do okna vim, nezapomeňte odebrat návratu na začátek ('\r ") pomocí následujícího příkazu:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-335">If you paste this script into vim window, make sure to remove the carriage return (‘\r”) using the following command:</span></span>

    tr -d '\r' <infile.sh >outfile.sh

#### <a name="step-3-edit-etcprofile"></a><span data-ttu-id="e4ab0-336">Krok 3: Úprava atd nebo profil</span><span class="sxs-lookup"><span data-stu-id="e4ab0-336">Step 3: Edit etc/profile</span></span>
<span data-ttu-id="e4ab0-337">Připojte následující na konci:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-337">Append the following at the end:</span></span>

    JAVA_HOME=/opt/java/jdk1.8.0_05
    CASS_HOME= /opt/cassandra/apache-cassandra-2.0.8
    PATH=$PATH:$HOME/bin:$JAVA_HOME/bin:$CASS_HOME/bin
    export JAVA_HOME
    export CASS_HOME
    export PATH

#### <a name="step-4-install-jna-for-production-systems"></a><span data-ttu-id="e4ab0-338">Krok 4: Instalace JNA pro produkční systémy.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-338">Step 4: Install JNA for production systems</span></span>
<span data-ttu-id="e4ab0-339">Použijte následující sekvence příkazů: Tento příkaz nainstaluje jna 3.2.7.jar a platforma 3.2.7.jar jna do adresáře /usr/share.java sudo výstižný get nainstalovat libjna java</span><span class="sxs-lookup"><span data-stu-id="e4ab0-339">Use the following command sequence: The following command will install jna-3.2.7.jar and jna-platform-3.2.7.jar to /usr/share.java directory sudo apt-get install libjna-java</span></span>

<span data-ttu-id="e4ab0-340">Vytvořte symbolické odkazy v adresáři CASS_HOME/lib $, aby tyto JAR najít Cassandra spouštěcí skript:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-340">Create symbolic links in $CASS_HOME/lib directory so that Cassandra startup script can find these jars:</span></span>

    ln -s /usr/share/java/jna-3.2.7.jar $CASS_HOME/lib/jna.jar

    ln -s /usr/share/java/jna-platform-3.2.7.jar $CASS_HOME/lib/jna-platform.jar

#### <a name="step-5-configure-cassandrayaml"></a><span data-ttu-id="e4ab0-341">Krok 5: Konfigurace cassandra.yaml</span><span class="sxs-lookup"><span data-stu-id="e4ab0-341">Step 5: Configure cassandra.yaml</span></span>
<span data-ttu-id="e4ab0-342">Upravte cassandra.yaml na každý virtuální počítač tak, aby odrážela konfigurace potřebné pro všechny virtuální počítače [jsme se vylepšení to při zřizování skutečné]:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-342">Edit cassandra.yaml on each VM to reflect configuration needed by all the virtual machines [we will tweak this during the actual provisioning]:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-343">Název pole</span><span class="sxs-lookup"><span data-stu-id="e4ab0-343">Field Name</span></span>   </th><th> <span data-ttu-id="e4ab0-344">Hodnota</span><span class="sxs-lookup"><span data-stu-id="e4ab0-344">Value</span></span>  </th><th>    <span data-ttu-id="e4ab0-345">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-345">Remarks</span></span> </th></tr>
<tr><td><span data-ttu-id="e4ab0-346">název_clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-346">cluster_name</span></span> </td><td>    <span data-ttu-id="e4ab0-347">"CustomerService"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-347">“CustomerService”</span></span>    </td><td> <span data-ttu-id="e4ab0-348">Použijte název, který se vztahuje k nasazení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-348">Use the name that reflects your deployment</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-349">listen_address</span><span class="sxs-lookup"><span data-stu-id="e4ab0-349">listen_address</span></span>    </td><td><span data-ttu-id="e4ab0-350">[necháte prázdné]</span><span class="sxs-lookup"><span data-stu-id="e4ab0-350">[leave it blank]</span></span>    </td><td> <span data-ttu-id="e4ab0-351">Odstranit "localhost"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-351">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-352">rpc_addres</span><span class="sxs-lookup"><span data-stu-id="e4ab0-352">rpc_addres</span></span>   </td><td><span data-ttu-id="e4ab0-353">[necháte prázdné]</span><span class="sxs-lookup"><span data-stu-id="e4ab0-353">[leave it blank]</span></span>    </td><td> <span data-ttu-id="e4ab0-354">Odstranit "localhost"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-354">Delete “localhost”</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-355">semen</span><span class="sxs-lookup"><span data-stu-id="e4ab0-355">seeds</span></span>    </td><td><span data-ttu-id="e4ab0-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-356">"10.1.2.4, 10.1.2.6, 10.1.2.8"</span></span>    </td><td><span data-ttu-id="e4ab0-357">Seznam všech adres IP, které jsou určené jako vstupní.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-357">List of  all the IP addresses which are designated as seeds.</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-358">endpoint_snitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-358">endpoint_snitch</span></span> </td><td> <span data-ttu-id="e4ab0-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span><span class="sxs-lookup"><span data-stu-id="e4ab0-359">org.apache.cassandra.locator.GossipingPropertyFileSnitch</span></span> </td><td> <span data-ttu-id="e4ab0-360">Toto je používáno NetworkTopologyStrateg pro odvození datového centra a racku virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-360">This is used by the NetworkTopologyStrateg for inferring the data center and the rack of the VM</span></span></td></tr>
</table>

#### <a name="step-6-capture-the-vm-image"></a><span data-ttu-id="e4ab0-361">Krok 6: Zachycení bitové kopie virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-361">Step 6: Capture the VM image</span></span>
<span data-ttu-id="e4ab0-362">Přihlaste se k virtuálnímu počítači pomocí názvu hostitele (hk template.cloudapp.net certifikační autority) a privátní klíč SSH vytvořili.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-362">Log into the virtual machine using the hostname (hk-cas-template.cloudapp.net) and the SSH private key previously created.</span></span> <span data-ttu-id="e4ab0-363">Najdete v části Postup použití SSH se systémem Linux v Azure podrobnosti o tom, jak se přihlásit pomocí příkazu ssh nebo putty.exe.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-363">See How to Use SSH with Linux on Azure for details on how to log in using the command ssh or putty.exe.</span></span>

<span data-ttu-id="e4ab0-364">Spusťte následující posloupnost akcí k zachycení bitové kopie:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-364">Execute the following sequence of actions to capture the image:</span></span>

##### <a name="1-deprovision"></a><span data-ttu-id="e4ab0-365">1. Deprovision</span><span class="sxs-lookup"><span data-stu-id="e4ab0-365">1. Deprovision</span></span>
<span data-ttu-id="e4ab0-366">Použijte příkaz "sudo příkaz waagent – deprovision + uživatele" odebrat konkrétní informace o instanci virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-366">Use the command “sudo waagent –deprovision+user” to remove Virtual Machine instance specific information.</span></span> <span data-ttu-id="e4ab0-367">Zobrazit [jak zachytit virtuální počítač s Linuxem](capture-image.md) chcete použít jako šablonu podrobnosti na proces zachycení bitové kopie.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-367">See for [How to Capture a Linux Virtual Machine](capture-image.md) to Use as a Template more details on the image capture process.</span></span>

##### <a name="2-shutdown-the-vm"></a><span data-ttu-id="e4ab0-368">2: vypnutí virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-368">2: Shutdown the VM</span></span>
<span data-ttu-id="e4ab0-369">Ujistěte se, že virtuální počítač je označený a klikněte na odkaz vypnutí z řádku nabídek dolní.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-369">Make sure that the virtual machine is highlighted and click the SHUTDOWN link from the bottom command bar.</span></span>

##### <a name="3-capture-the-image"></a><span data-ttu-id="e4ab0-370">3: zachycení bitové kopie</span><span class="sxs-lookup"><span data-stu-id="e4ab0-370">3: Capture the image</span></span>
<span data-ttu-id="e4ab0-371">Ujistěte se, že virtuální počítač je označený a klikněte na odkaz zachycení z panelu dolní příkazů.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-371">Make sure that the virtual machine is highlighted and click the CAPTURE link from the bottom command bar.</span></span> <span data-ttu-id="e4ab0-372">Na další obrazovce zadejte název bitové kopie (například hk-cas-2-08-ub-14-04-2014071), příslušné popis bitové kopie a klikněte na tlačítko "" zaškrtnutí dokončete proces zachycení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-372">In the next screen, give an IMAGE NAME (e.g. hk-cas-2-08-ub-14-04-2014071), appropriate IMAGE DESCRIPTION, and click the “check” mark to finish the CAPTURE process.</span></span>

<span data-ttu-id="e4ab0-373">Bude to trvat několik sekund a bitovou kopii, která by měla být k dispozici v části Moje Image z Galerie obrázků.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-373">This will take a few seconds and the image should be available in MY IMAGES section of the image gallery.</span></span> <span data-ttu-id="e4ab0-374">Zdrojový virtuální počítač bude automaticky odstraněna po úspěšně zachycením image.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-374">The source VM will be automatically deleted after the image is successfully captured.</span></span> 

## <a name="single-region-deployment-process"></a><span data-ttu-id="e4ab0-375">Proces nasazení jedné oblasti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-375">Single Region Deployment Process</span></span>
<span data-ttu-id="e4ab0-376">**Krok 1: Vytvoření virtuální sítě** Přihlaste se k portálu Azure a vytvoření virtuální sítě (klasické) s atributy uvedené v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-376">**Step 1: Create the Virtual Network** Log into the Azure portal and create a virtual network (classic) with the attributes shown in the following table.</span></span> <span data-ttu-id="e4ab0-377">V tématu [vytvoření virtuální sítě (klasické) pomocí portálu Azure](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) podrobný popis kroků procesu.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-377">See [Create a virtual network (classic) using the Azure portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="e4ab0-378">Atribut název virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-378">VM Attribute Name</span></span></th><th><span data-ttu-id="e4ab0-379">Hodnota</span><span class="sxs-lookup"><span data-stu-id="e4ab0-379">Value</span></span></th><th><span data-ttu-id="e4ab0-380">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-380">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-381">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-381">Name</span></span></td><td><span data-ttu-id="e4ab0-382">vnet-cass západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-382">vnet-cass-west-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-383">Oblast</span><span class="sxs-lookup"><span data-stu-id="e4ab0-383">Region</span></span></td><td><span data-ttu-id="e4ab0-384">Západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-384">West US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-385">Servery DNS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-385">DNS Servers</span></span></td><td><span data-ttu-id="e4ab0-386">Žádný</span><span class="sxs-lookup"><span data-stu-id="e4ab0-386">None</span></span></td><td><span data-ttu-id="e4ab0-387">Toto ignorovat, protože jsme nejsou pomocí serveru DNS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-387">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-388">Adresní prostor</span><span class="sxs-lookup"><span data-stu-id="e4ab0-388">Address Space</span></span></td><td><span data-ttu-id="e4ab0-389">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="e4ab0-389">10.1.0.0/16</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="e4ab0-390">Počáteční IP adresu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-390">Starting IP</span></span></td><td><span data-ttu-id="e4ab0-391">10.1.0.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-391">10.1.0.0</span></span></td><td></td></tr>    
<tr><td><span data-ttu-id="e4ab0-392">CIDR</span><span class="sxs-lookup"><span data-stu-id="e4ab0-392">CIDR</span></span> </td><td><span data-ttu-id="e4ab0-393">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-393">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="e4ab0-394">Přidejte následující podsítě:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-394">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-395">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-395">Name</span></span></th><th><span data-ttu-id="e4ab0-396">Počáteční IP adresu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-396">Starting IP</span></span></th><th><span data-ttu-id="e4ab0-397">CIDR</span><span class="sxs-lookup"><span data-stu-id="e4ab0-397">CIDR</span></span></th><th><span data-ttu-id="e4ab0-398">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-398">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-399">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-399">web</span></span></td><td><span data-ttu-id="e4ab0-400">10.1.1.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-400">10.1.1.0</span></span></td><td><span data-ttu-id="e4ab0-401">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-401">/24 (251)</span></span></td><td><span data-ttu-id="e4ab0-402">Podsíť pro webové farmy</span><span class="sxs-lookup"><span data-stu-id="e4ab0-402">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-403">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-403">data</span></span></td><td><span data-ttu-id="e4ab0-404">10.1.2.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-404">10.1.2.0</span></span></td><td><span data-ttu-id="e4ab0-405">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-405">/24 (251)</span></span></td><td><span data-ttu-id="e4ab0-406">Podsíť pro databázové uzly</span><span class="sxs-lookup"><span data-stu-id="e4ab0-406">Subnet for the database nodes</span></span></td></tr>
</table>

<span data-ttu-id="e4ab0-407">Data a webové podsítě se dají chránit pomocí skupin zabezpečení sítě pokrytí sahá nad rámec tohoto článku.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-407">Data and Web subnets can be protected through network security groups the coverage of which is out of scope for this article.</span></span>  

<span data-ttu-id="e4ab0-408">**Krok 2: Zřizování virtuálních počítačů** pomocí bitové kopie předtím vytvořili, jsme vytvoříte následující virtuální počítače v cloudu serveru "(Hong Kong) c-svc západ" a navázat je na příslušných podsítí, jak je uvedeno níže:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-408">**Step 2: Provision Virtual Machines** Using the image created previously, we will create the following virtual machines in the cloud server “hk-c-svc-west” and bind them to the respective subnets as shown below:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-409">Název počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-409">Machine Name</span></span>    </th><th><span data-ttu-id="e4ab0-410">Podsíť</span><span class="sxs-lookup"><span data-stu-id="e4ab0-410">Subnet</span></span>    </th><th><span data-ttu-id="e4ab0-411">IP adresa</span><span class="sxs-lookup"><span data-stu-id="e4ab0-411">IP Address</span></span>    </th><th><span data-ttu-id="e4ab0-412">Skupina dostupnosti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-412">Availability set</span></span></th><th><span data-ttu-id="e4ab0-413">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="e4ab0-413">DC/Rack</span></span></th><th><span data-ttu-id="e4ab0-414">Počáteční hodnoty?</span><span class="sxs-lookup"><span data-stu-id="e4ab0-414">Seed?</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-415">(Hong Kong) c1-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-415">hk-c1-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-416">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-416">data</span></span>    </td><td><span data-ttu-id="e4ab0-417">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-417">10.1.2.4</span></span>    </td><td><span data-ttu-id="e4ab0-418">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-418">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="e4ab0-419">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-419">dc =WESTUS rack =rack1</span></span> </td><td><span data-ttu-id="e4ab0-420">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-420">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-421">(Hong Kong) c2-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-421">hk-c2-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-422">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-422">data</span></span>    </td><td><span data-ttu-id="e4ab0-423">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-423">10.1.2.5</span></span>    </td><td><span data-ttu-id="e4ab0-424">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-424">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="e4ab0-425">DC = WESTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-425">dc =WESTUS rack =rack1</span></span>    </td><td><span data-ttu-id="e4ab0-426">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-426">No</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-427">(Hong Kong) c3-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-427">hk-c3-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-428">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-428">data</span></span>    </td><td><span data-ttu-id="e4ab0-429">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="e4ab0-429">10.1.2.6</span></span>    </td><td><span data-ttu-id="e4ab0-430">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-430">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="e4ab0-431">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-431">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="e4ab0-432">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-432">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-433">(Hong Kong) c4-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-433">hk-c4-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-434">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-434">data</span></span>    </td><td><span data-ttu-id="e4ab0-435">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="e4ab0-435">10.1.2.7</span></span>    </td><td><span data-ttu-id="e4ab0-436">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-436">hk-c-aset-1</span></span>    </td><td><span data-ttu-id="e4ab0-437">DC = WESTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-437">dc =WESTUS rack =rack2</span></span>    </td><td><span data-ttu-id="e4ab0-438">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-438">No</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-439">(Hong Kong) c5-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-439">hk-c5-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-440">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-440">data</span></span>    </td><td><span data-ttu-id="e4ab0-441">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-441">10.1.2.8</span></span>    </td><td><span data-ttu-id="e4ab0-442">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-442">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="e4ab0-443">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-443">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="e4ab0-444">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-444">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-445">(Hong Kong) c6-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-445">hk-c6-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-446">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-446">data</span></span>    </td><td><span data-ttu-id="e4ab0-447">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="e4ab0-447">10.1.2.9</span></span>    </td><td><span data-ttu-id="e4ab0-448">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-448">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="e4ab0-449">DC = WESTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-449">dc =WESTUS rack =rack3</span></span>    </td><td><span data-ttu-id="e4ab0-450">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-450">No</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-451">(Hong Kong)-s c7 – západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-451">hk-c7-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-452">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-452">data</span></span>    </td><td><span data-ttu-id="e4ab0-453">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="e4ab0-453">10.1.2.10</span></span>    </td><td><span data-ttu-id="e4ab0-454">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-454">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="e4ab0-455">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-455">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="e4ab0-456">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-456">Yes</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-457">(Hong Kong) c8-západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-457">hk-c8-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-458">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-458">data</span></span>    </td><td><span data-ttu-id="e4ab0-459">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="e4ab0-459">10.1.2.11</span></span>    </td><td><span data-ttu-id="e4ab0-460">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-460">hk-c-aset-2</span></span>    </td><td><span data-ttu-id="e4ab0-461">DC = WESTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-461">dc =WESTUS rack =rack4</span></span>    </td><td><span data-ttu-id="e4ab0-462">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-462">No</span></span> </td></tr>
<tr><td><span data-ttu-id="e4ab0-463">(Hong Kong) w1 – západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-463">hk-w1-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-464">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-464">web</span></span>    </td><td><span data-ttu-id="e4ab0-465">10.1.1.4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-465">10.1.1.4</span></span>    </td><td><span data-ttu-id="e4ab0-466">(Hong Kong) w sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-466">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="e4ab0-467">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-467">N/A</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-468">(Hong Kong) w2 – západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-468">hk-w2-west-us</span></span>    </td><td><span data-ttu-id="e4ab0-469">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-469">web</span></span>    </td><td><span data-ttu-id="e4ab0-470">10.1.1.5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-470">10.1.1.5</span></span>    </td><td><span data-ttu-id="e4ab0-471">(Hong Kong) w sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-471">hk-w-aset-1</span></span>    </td><td>                       </td><td><span data-ttu-id="e4ab0-472">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-472">N/A</span></span></td></tr>
</table>

<span data-ttu-id="e4ab0-473">Vytvoření seznamu virtuálních počítačů, vyžaduje následující proces:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-473">Creation of the above list of VMs requires the following process:</span></span>

1. <span data-ttu-id="e4ab0-474">Vytvoření prázdné cloudové služby v určité oblasti.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-474">Create an empty cloud service in a particular region</span></span>
2. <span data-ttu-id="e4ab0-475">Vytvoření virtuálního počítače z dříve zaznamenané bitové kopie a jeho připojení k virtuální síti vytvořené dříve; Tento postup opakujte pro všechny virtuální počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-475">Create a VM from the previously captured image and attach it to the virtual network created previously; repeat this for all the VMs</span></span>
3. <span data-ttu-id="e4ab0-476">Přidejte interní nástroj do cloudové služby a jeho připojení k podsíti "data.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-476">Add an internal load balancer to the cloud service and attach it to the “data” subnet</span></span>
4. <span data-ttu-id="e4ab0-477">Pro každý virtuální počítač předtím vytvořili přidáte koncový bod Vyrovnávání zatížení pro provoz thrift prostřednictvím připojený ke službě Vyrovnávání zatížení dříve vytvořenou interní skupinu s vyrovnáváním zatížení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-477">For each VM created previously, add a load balanced endpoint for thrift traffic through a load balanced set connected to the previously created internal load balancer</span></span>

<span data-ttu-id="e4ab0-478">Výše uvedené proces lze provést pomocí portálu Azure classic; počítače s Windows (použití a virtuálních počítačů v Azure, pokud nemáte přístup k počítači s Windows), použít následující skript prostředí PowerShell pro zřízení všech 8 virtuálních počítačů automaticky.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-478">The above process can be executed using Azure classic portal; use a Windows machine (use a VM on Azure if you don't have access to a Windows machine), use the following PowerShell script to provision all 8 VMs automatically.</span></span>

<span data-ttu-id="e4ab0-479">**Seznam 1: Skript prostředí PowerShell pro zřizování virtuálních počítačů**</span><span class="sxs-lookup"><span data-stu-id="e4ab0-479">**List 1: PowerShell script for provisioning virtual machines**</span></span>

        #Tested with Azure Powershell - November 2014
        #This powershell script deployes a number of VMs from an existing image inside an Azure region
        #Import your Azure subscription into the current Powershell session before proceeding
        #The process: 1. create Azure Storage account, 2. create virtual network, 3.create the VM template, 2. crate a list of VMs from the template

        #fundamental variables - change these to reflect your subscription
        $country="us"; $region="west"; $vnetName = "your_vnet_name";$storageAccount="your_storage_account"
        $numVMs=8;$prefix = "hk-cass";$ilbIP="your_ilb_ip"
        $subscriptionName = "Azure_subscription_name";
        $vmSize="ExtraSmall"; $imageName="your_linux_image_name"
        $ilbName="ThriftInternalLB"; $thriftEndPoint="ThriftEndPoint"

        #generated variables
        $serviceName = "$prefix-svc-$region-$country"; $azureRegion = "$region $country"

        $vmNames = @()
        for ($i=0; $i -lt $numVMs; $i++)
        {
           $vmNames+=("$prefix-vm"+($i+1) + "-$region-$country" );
        }

        #select an Azure subscription already imported into Powershell session
        Select-AzureSubscription -SubscriptionName $subscriptionName -Current
        Set-AzureSubscription -SubscriptionName $subscriptionName -CurrentStorageAccountName $storageAccount

        #create an empty cloud service
        New-AzureService -ServiceName $serviceName -Label "hkcass$region" -Location $azureRegion
        Write-Host "Created $serviceName"

        $VMList= @()   # stores the list of azure vm configuration objects
        #create the list of VMs
        foreach($vmName in $vmNames)
        {
           $VMList += New-AzureVMConfig -Name $vmName -InstanceSize ExtraSmall -ImageName $imageName |
           Add-AzureProvisioningConfig -Linux -LinuxUser "localadmin" -Password "Local123" |
           Set-AzureSubnet "data"
        }

        New-AzureVM -ServiceName $serviceName -VNetName $vnetName -VMs $VMList

        #Create internal load balancer
        Add-AzureInternalLoadBalancer -ServiceName $serviceName -InternalLoadBalancerName $ilbName -SubnetName "data" -StaticVNetIPAddress "$ilbIP"
        Write-Host "Created $ilbName"
        #Add add the thrift endpoint to the internal load balancer for all the VMs
        foreach($vmName in $vmNames)
        {
            Get-AzureVM -ServiceName $serviceName -Name $vmName |
                Add-AzureEndpoint -Name $thriftEndPoint -LBSetName "ThriftLBSet" -Protocol tcp -LocalPort 9160 -PublicPort 9160 -ProbePort 9160 -ProbeProtocol tcp -ProbeIntervalInSeconds 10 -InternalLoadBalancerName $ilbName |
                Update-AzureVM

            Write-Host "created $vmName"     
        }

<span data-ttu-id="e4ab0-480">**Krok 3: Konfigurace Cassandra na jednotlivé virtuální počítače**</span><span class="sxs-lookup"><span data-stu-id="e4ab0-480">**Step 3: Configure Cassandra on each VM**</span></span>

<span data-ttu-id="e4ab0-481">Přihlaste se k virtuálnímu počítači a proveďte následující:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-481">Log into the VM and perform the following:</span></span>

* <span data-ttu-id="e4ab0-482">Upravte $CASS_HOME/conf/cassandra-rackdc.properties k určení datového centra a rack vlastností:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-482">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties:</span></span>
  
       dc =EASTUS, rack =rack1
* <span data-ttu-id="e4ab0-483">Upravte cassandra.yaml konfigurace uzly počáteční hodnoty jako níže:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-483">Edit cassandra.yaml to configure seed nodes as below:</span></span>
  
       Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10"

<span data-ttu-id="e4ab0-484">**Krok 4: Spuštění virtuální počítače a otestovat clusteru**</span><span class="sxs-lookup"><span data-stu-id="e4ab0-484">**Step 4: Start the VMs and test the cluster**</span></span>

<span data-ttu-id="e4ab0-485">Přihlaste se do jednoho z uzlů (například (Hong Kong) c1-západní us) a spusťte následující příkaz a zjistit stav clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-485">Log into one of the nodes (e.g. hk-c1-west-us) and run the following command to see the status of the cluster:</span></span>

       nodetool –h 10.1.2.4 –p 7199 status

<span data-ttu-id="e4ab0-486">Měli byste vidět zobrazení podobné níže 8 uzlů clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-486">You should see the display similar to the one below for an 8-node cluster:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-487">Status</span><span class="sxs-lookup"><span data-stu-id="e4ab0-487">Status</span></span></th><th><span data-ttu-id="e4ab0-488">Adresa</span><span class="sxs-lookup"><span data-stu-id="e4ab0-488">Address</span></span>    </th><th><span data-ttu-id="e4ab0-489">Načtení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-489">Load</span></span>    </th><th><span data-ttu-id="e4ab0-490">Tokeny</span><span class="sxs-lookup"><span data-stu-id="e4ab0-490">Tokens</span></span>    </th><th><span data-ttu-id="e4ab0-491">Vlastní</span><span class="sxs-lookup"><span data-stu-id="e4ab0-491">Owns</span></span> </th><th><span data-ttu-id="e4ab0-492">ID hostitele</span><span class="sxs-lookup"><span data-stu-id="e4ab0-492">Host ID</span></span>    </th><th><span data-ttu-id="e4ab0-493">Rack</span><span class="sxs-lookup"><span data-stu-id="e4ab0-493">Rack</span></span></th></tr>
<tr><th><span data-ttu-id="e4ab0-494">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-494">UN</span></span>    </td><td><span data-ttu-id="e4ab0-495">10.1.2.4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-495">10.1.2.4</span></span>     </td><td><span data-ttu-id="e4ab0-496">87.81 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-496">87.81 KB</span></span>    </td><td><span data-ttu-id="e4ab0-497">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-497">256</span></span>    </td><td><span data-ttu-id="e4ab0-498">38.0%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-498">38.0%</span></span>    </td><td><span data-ttu-id="e4ab0-499">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-499">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-500">rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-500">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-501">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-501">UN</span></span>    </td><td><span data-ttu-id="e4ab0-502">10.1.2.5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-502">10.1.2.5</span></span>     </td><td><span data-ttu-id="e4ab0-503">41.08 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-503">41.08 KB</span></span>    </td><td><span data-ttu-id="e4ab0-504">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-504">256</span></span>    </td><td><span data-ttu-id="e4ab0-505">68.9%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-505">68.9%</span></span>    </td><td><span data-ttu-id="e4ab0-506">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-506">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-507">rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-507">rack1</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-508">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-508">UN</span></span>    </td><td><span data-ttu-id="e4ab0-509">10.1.2.6</span><span class="sxs-lookup"><span data-stu-id="e4ab0-509">10.1.2.6</span></span>     </td><td><span data-ttu-id="e4ab0-510">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-510">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-511">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-511">256</span></span>    </td><td><span data-ttu-id="e4ab0-512">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-512">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-513">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-513">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-514">rack2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-514">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-515">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-515">UN</span></span>    </td><td><span data-ttu-id="e4ab0-516">10.1.2.7</span><span class="sxs-lookup"><span data-stu-id="e4ab0-516">10.1.2.7</span></span>     </td><td><span data-ttu-id="e4ab0-517">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-517">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-518">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-518">256</span></span>    </td><td><span data-ttu-id="e4ab0-519">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-519">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-520">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-520">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-521">rack2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-521">rack2</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-522">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-522">UN</span></span>    </td><td><span data-ttu-id="e4ab0-523">10.1.2.8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-523">10.1.2.8</span></span>     </td><td><span data-ttu-id="e4ab0-524">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-524">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-525">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-525">256</span></span>    </td><td><span data-ttu-id="e4ab0-526">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-526">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-527">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-527">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-528">rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-528">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-529">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-529">UN</span></span>    </td><td><span data-ttu-id="e4ab0-530">10.1.2.9</span><span class="sxs-lookup"><span data-stu-id="e4ab0-530">10.1.2.9</span></span>     </td><td><span data-ttu-id="e4ab0-531">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-531">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-532">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-532">256</span></span>    </td><td><span data-ttu-id="e4ab0-533">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-533">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-534">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-534">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-535">rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-535">rack3</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-536">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-536">UN</span></span>    </td><td><span data-ttu-id="e4ab0-537">10.1.2.10</span><span class="sxs-lookup"><span data-stu-id="e4ab0-537">10.1.2.10</span></span>     </td><td><span data-ttu-id="e4ab0-538">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-538">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-539">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-539">256</span></span>    </td><td><span data-ttu-id="e4ab0-540">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-540">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-541">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-541">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-542">rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-542">rack4</span></span></td></tr>
<tr><th><span data-ttu-id="e4ab0-543">ZRUŠENÍ</span><span class="sxs-lookup"><span data-stu-id="e4ab0-543">UN</span></span>    </td><td><span data-ttu-id="e4ab0-544">10.1.2.11</span><span class="sxs-lookup"><span data-stu-id="e4ab0-544">10.1.2.11</span></span>     </td><td><span data-ttu-id="e4ab0-545">55.29 KB</span><span class="sxs-lookup"><span data-stu-id="e4ab0-545">55.29 KB</span></span>    </td><td><span data-ttu-id="e4ab0-546">256</span><span class="sxs-lookup"><span data-stu-id="e4ab0-546">256</span></span>    </td><td><span data-ttu-id="e4ab0-547">68.8%</span><span class="sxs-lookup"><span data-stu-id="e4ab0-547">68.8%</span></span>    </td><td><span data-ttu-id="e4ab0-548">Identifikátor GUID (odebrat)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-548">Guid (removed)</span></span></td><td><span data-ttu-id="e4ab0-549">rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-549">rack4</span></span></td></tr>
</table>

## <a name="test-the-single-region-cluster"></a><span data-ttu-id="e4ab0-550">Testování jedné oblasti clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-550">Test the Single Region Cluster</span></span>
<span data-ttu-id="e4ab0-551">Použijte následující postup k testování clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-551">Use the following steps to test the cluster:</span></span>

1. <span data-ttu-id="e4ab0-552">Pomocí příkazu Get-AzureInternalLoadbalancer prostředí PowerShell., získejte IP adresu služby Vyrovnávání zatížení pro vnitřní (např.)  10.1.2.101).</span><span class="sxs-lookup"><span data-stu-id="e4ab0-552">Using the Powershell command Get-AzureInternalLoadbalancer commandlet, obtain the IP address of the internal load balancer (e.g.  10.1.2.101).</span></span> <span data-ttu-id="e4ab0-553">Syntaxe příkazu je zobrazena níže: Get-AzureLoadbalancer – ServiceName "(Hong Kong) c-svc západní USA" [zobrazí podrobnosti o vyrovnávání zatížení pro vnitřní společně s jeho IP adresy]</span><span class="sxs-lookup"><span data-stu-id="e4ab0-553">The syntax of the command is shown below: Get-AzureLoadbalancer –ServiceName "hk-c-svc-west-us” [displays the details of the internal load balancer along with its IP address]</span></span>
2. <span data-ttu-id="e4ab0-554">Přihlaste se k webové farmy virtuálního počítače (například hk-w1 – – západ us) pomocí klienta Putty ssh nebo</span><span class="sxs-lookup"><span data-stu-id="e4ab0-554">Log into the web farm VM (e.g. hk-w1-west-us) using Putty or ssh</span></span>
3. <span data-ttu-id="e4ab0-555">Spuštění $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="e4ab0-555">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
4. <span data-ttu-id="e4ab0-556">Chcete-li ověřit, zda je cluster funkční, použijte následující příkazy CQL:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-556">Use the following CQL commands to verify if the cluster is working:</span></span>
   
     <span data-ttu-id="e4ab0-557">Vytvoření KEYSPACE customers_ks REPLIKACE s = {'class': 'SimpleStrategy', 'replication_factor': 3};   POUŽITÍ customers_ks;   Vytvoření tabulky Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Vložit do VALUES(1, 'John', 'Doe') Customers(customer_id, firstname, lastname);   Vložit do Customers(customer_id, firstname, lastname) hodnoty (2, 'Jana', 'Doe');</span><span class="sxs-lookup"><span data-stu-id="e4ab0-557">CREATE KEYSPACE customers_ks WITH REPLICATION = { 'class' : 'SimpleStrategy', 'replication_factor' : 3 };   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');</span></span>
   
     <span data-ttu-id="e4ab0-558">Vyberte * od zákazníků;</span><span class="sxs-lookup"><span data-stu-id="e4ab0-558">SELECT * FROM Customers;</span></span>

<span data-ttu-id="e4ab0-559">Měli byste vidět zobrazení stejný, jako je nižší než:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-559">You should see a display like the one below:</span></span>

<table>
  <tr><th> <span data-ttu-id="e4ab0-560">customer_id</span><span class="sxs-lookup"><span data-stu-id="e4ab0-560">customer_id</span></span> </th><th> <span data-ttu-id="e4ab0-561">FirstName</span><span class="sxs-lookup"><span data-stu-id="e4ab0-561">firstname</span></span> </th><th> <span data-ttu-id="e4ab0-562">Příjmení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-562">lastname</span></span> </th></tr>
  <tr><td> <span data-ttu-id="e4ab0-563">1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-563">1</span></span> </td><td> <span data-ttu-id="e4ab0-564">Jan</span><span class="sxs-lookup"><span data-stu-id="e4ab0-564">John</span></span> </td><td> <span data-ttu-id="e4ab0-565">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-565">Doe</span></span> </td></tr>
  <tr><td> <span data-ttu-id="e4ab0-566">2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-566">2</span></span> </td><td> <span data-ttu-id="e4ab0-567">Jana</span><span class="sxs-lookup"><span data-stu-id="e4ab0-567">Jane</span></span> </td><td> <span data-ttu-id="e4ab0-568">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-568">Doe</span></span> </td></tr>
</table>

<span data-ttu-id="e4ab0-569">Upozorňujeme, že keyspace vytvořili v kroku 4 používá SimpleStrategy s replication_factor 3.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-569">Please note that the keyspace created in step 4 uses SimpleStrategy with a  replication_factor of 3.</span></span> <span data-ttu-id="e4ab0-570">SimpleStrategy se doporučuje pro jednoho datového centra nasazení zatímco NetworkTopologyStrategy pro více data center nasazení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-570">SimpleStrategy is recommended for single data center deployments whereas NetworkTopologyStrategy for multi-data center deployments.</span></span> <span data-ttu-id="e4ab0-571">Replication_factor 3 získáte odolnost proti selhání uzlu.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-571">A replication_factor of 3 will give tolerance for node failures.</span></span>

## <span data-ttu-id="e4ab0-572"><a id="tworegion"></a>Procesu nasazení s více oblast</span><span class="sxs-lookup"><span data-stu-id="e4ab0-572"><a id="tworegion"> </a>Multi-Region Deployment Process</span></span>
<span data-ttu-id="e4ab0-573">Bude využívat nasazení jedné oblasti bylo dokončeno a opakujte stejný postup pro instalaci druhé oblast.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-573">Will leverage the single region deployment completed and repeat the same process for installing the second region.</span></span> <span data-ttu-id="e4ab0-574">Klíčovým rozdílem mezi jednou či více oblastí nasazení je nastavení tunelové propojení VPN pro komunikaci mezi oblast; jsme bude začínat síťovou instalaci, zřídíte virtuální počítače a nakonfigurujete Cassandra.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-574">The key difference between the single and multiple region deployment is the VPN tunnel setup for inter-region communication; we will start with the network installation, provision the VMs and configure Cassandra.</span></span>

### <a name="step-1-create-the-virtual-network-at-the-2nd-region"></a><span data-ttu-id="e4ab0-575">Krok 1: Vytvoření virtuální sítě v oblasti 2.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-575">Step 1: Create the Virtual Network at the 2nd Region</span></span>
<span data-ttu-id="e4ab0-576">Přihlaste se k portálu Azure classic a vytvoření virtuální sítě s atributy zobrazení v tabulce.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-576">Log into the Azure classic portal and create a Virtual Network with the attributes show in the table.</span></span> <span data-ttu-id="e4ab0-577">V tématu [konfigurace virtuální sítě Cloud-Only na portálu Azure classic](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) podrobný popis kroků procesu.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-577">See [Configure a Cloud-Only Virtual Network in the Azure classic portal](../../../virtual-network/virtual-networks-create-vnet-classic-pportal.md) for detailed steps of the process.</span></span>      

<table>
<tr><th><span data-ttu-id="e4ab0-578">Název atributu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-578">Attribute Name</span></span>    </th><th><span data-ttu-id="e4ab0-579">Hodnota</span><span class="sxs-lookup"><span data-stu-id="e4ab0-579">Value</span></span>    </th><th><span data-ttu-id="e4ab0-580">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-580">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-581">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-581">Name</span></span>    </td><td><span data-ttu-id="e4ab0-582">vnet-cass východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-582">vnet-cass-east-us</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-583">Oblast</span><span class="sxs-lookup"><span data-stu-id="e4ab0-583">Region</span></span>    </td><td><span data-ttu-id="e4ab0-584">Východ USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-584">East US</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-585">Servery DNS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-585">DNS Servers</span></span>        </td><td></td><td><span data-ttu-id="e4ab0-586">Toto ignorovat, protože jsme nejsou pomocí serveru DNS</span><span class="sxs-lookup"><span data-stu-id="e4ab0-586">Ignore this as we are not using a DNS Server</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-587">Konfigurace VPN typu point-to-site</span><span class="sxs-lookup"><span data-stu-id="e4ab0-587">Configure a point-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="e4ab0-588">Můžete tuto zprávu ignorovat</span><span class="sxs-lookup"><span data-stu-id="e4ab0-588">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-589">Konfigurace sítě Site-to-Site VPN</span><span class="sxs-lookup"><span data-stu-id="e4ab0-589">Configure a site-to-site VPN</span></span></td><td></td><td>        <span data-ttu-id="e4ab0-590">Můžete tuto zprávu ignorovat</span><span class="sxs-lookup"><span data-stu-id="e4ab0-590">Ignore this</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-591">Adresní prostor</span><span class="sxs-lookup"><span data-stu-id="e4ab0-591">Address Space</span></span>    </td><td><span data-ttu-id="e4ab0-592">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="e4ab0-592">10.2.0.0/16</span></span></td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-593">Počáteční IP adresu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-593">Starting IP</span></span>    </td><td><span data-ttu-id="e4ab0-594">10.2.0.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-594">10.2.0.0</span></span>    </td><td></td></tr>
<tr><td><span data-ttu-id="e4ab0-595">CIDR</span><span class="sxs-lookup"><span data-stu-id="e4ab0-595">CIDR</span></span>    </td><td><span data-ttu-id="e4ab0-596">/16 (65531)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-596">/16 (65531)</span></span></td><td></td></tr>
</table>

<span data-ttu-id="e4ab0-597">Přidejte následující podsítě:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-597">Add the following subnets:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-598">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-598">Name</span></span>    </th><th><span data-ttu-id="e4ab0-599">Počáteční IP adresu</span><span class="sxs-lookup"><span data-stu-id="e4ab0-599">Starting IP</span></span>    </th><th><span data-ttu-id="e4ab0-600">CIDR</span><span class="sxs-lookup"><span data-stu-id="e4ab0-600">CIDR</span></span>    </th><th><span data-ttu-id="e4ab0-601">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-601">Remarks</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-602">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-602">web</span></span>    </td><td><span data-ttu-id="e4ab0-603">10.2.1.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-603">10.2.1.0</span></span>    </td><td><span data-ttu-id="e4ab0-604">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-604">/24 (251)</span></span>    </td><td><span data-ttu-id="e4ab0-605">Podsíť pro webové farmy</span><span class="sxs-lookup"><span data-stu-id="e4ab0-605">Subnet for the web farm</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-606">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-606">data</span></span>    </td><td><span data-ttu-id="e4ab0-607">10.2.2.0</span><span class="sxs-lookup"><span data-stu-id="e4ab0-607">10.2.2.0</span></span>    </td><td><span data-ttu-id="e4ab0-608">/24 (251)</span><span class="sxs-lookup"><span data-stu-id="e4ab0-608">/24 (251)</span></span>    </td><td><span data-ttu-id="e4ab0-609">Podsíť pro databázové uzly</span><span class="sxs-lookup"><span data-stu-id="e4ab0-609">Subnet for the database nodes</span></span></td></tr>
</table>


### <a name="step-2-create-local-networks"></a><span data-ttu-id="e4ab0-610">Krok 2: Vytvoření místní sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-610">Step 2: Create Local Networks</span></span>
<span data-ttu-id="e4ab0-611">Do místní sítě v Azure virtuální sítě je adresní prostor proxy serveru, který se mapuje na vzdálené lokality, včetně privátního cloudu nebo jiné oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-611">A Local Network in Azure virtual networking is a proxy address space that maps to a remote site including a private cloud or another Azure region.</span></span> <span data-ttu-id="e4ab0-612">Tento adresní prostor proxy je vázána Brána vzdálené směrování sítě do správné síťové umístění.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-612">This proxy address space is bound to a remote gateway for routing network to the right networking destinations.</span></span> <span data-ttu-id="e4ab0-613">V tématu [nakonfigurovat virtuální síť připojení mezi virtuálními](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) pokyny k vytvoření připojení VNET-to-VNET.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-613">See [Configure a VNet to VNet Connection](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md) for the instructions on establishing VNET-to-VNET connection.</span></span>

<span data-ttu-id="e4ab0-614">Vytvořte dvě místní sítě za následující podrobnosti:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-614">Create two local networks per the following details:</span></span>

| <span data-ttu-id="e4ab0-615">Název sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-615">Network Name</span></span> | <span data-ttu-id="e4ab0-616">Adresa brány sítě VPN</span><span class="sxs-lookup"><span data-stu-id="e4ab0-616">VPN Gateway Address</span></span> | <span data-ttu-id="e4ab0-617">Adresní prostor</span><span class="sxs-lookup"><span data-stu-id="e4ab0-617">Address Space</span></span> | <span data-ttu-id="e4ab0-618">Poznámky</span><span class="sxs-lookup"><span data-stu-id="e4ab0-618">Remarks</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="e4ab0-619">HK-lnet-map-to-East-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-619">hk-lnet-map-to-east-us</span></span> |<span data-ttu-id="e4ab0-620">23.1.1.1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-620">23.1.1.1</span></span> |<span data-ttu-id="e4ab0-621">10.2.0.0/16</span><span class="sxs-lookup"><span data-stu-id="e4ab0-621">10.2.0.0/16</span></span> |<span data-ttu-id="e4ab0-622">Při vytváření místní síti poskytněte zástupný symbol adresu brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-622">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="e4ab0-623">Po vytvoření brány, naplní adresu skutečné brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-623">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="e4ab0-624">Ujistěte se, že adresní prostor přesně odpovídá příslušné virtuální sítě vzdálené; v takovém případě síť VNET vytvořena v oblasti Východ USA.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-624">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the East US region.</span></span> |
| <span data-ttu-id="e4ab0-625">HK-lnet-map-to-West-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-625">hk-lnet-map-to-west-us</span></span> |<span data-ttu-id="e4ab0-626">23.2.2.2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-626">23.2.2.2</span></span> |<span data-ttu-id="e4ab0-627">10.1.0.0/16</span><span class="sxs-lookup"><span data-stu-id="e4ab0-627">10.1.0.0/16</span></span> |<span data-ttu-id="e4ab0-628">Při vytváření místní síti poskytněte zástupný symbol adresu brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-628">While creating the Local Network give a placeholder gateway address.</span></span> <span data-ttu-id="e4ab0-629">Po vytvoření brány, naplní adresu skutečné brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-629">The real gateway address is filled once the gateway is created.</span></span> <span data-ttu-id="e4ab0-630">Ujistěte se, že adresní prostor přesně odpovídá příslušné virtuální sítě vzdálené; v takovém případě síť VNET vytvořena v oblasti západní USA.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-630">Make sure the address space exactly matches the respective remote VNET; in this case the VNET created in the West US region.</span></span> |

### <a name="step-3-map-local-network-to-the-respective-vnets"></a><span data-ttu-id="e4ab0-631">Krok 3: "Local" sítě mapu příslušných virtuálních sítí</span><span class="sxs-lookup"><span data-stu-id="e4ab0-631">Step 3: Map “Local” network to the respective VNETs</span></span>
<span data-ttu-id="e4ab0-632">Z klasického portálu Azure vyberte každý virtuální síť, klikněte na tlačítko "Konfigurace", "Připojení k místní síti" a vyberte místní sítě za následující podrobnosti:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-632">From the Azure classic portal, select each vnet, click “Configure”, check “Connect to the local network”, and select the Local Networks per the following details:</span></span>

| <span data-ttu-id="e4ab0-633">Virtual Network</span><span class="sxs-lookup"><span data-stu-id="e4ab0-633">Virtual Network</span></span> | <span data-ttu-id="e4ab0-634">Místní sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-634">Local Network</span></span> |
| --- | --- |
| <span data-ttu-id="e4ab0-635">(Hong Kong) vnet západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-635">hk-vnet-west-us</span></span> |<span data-ttu-id="e4ab0-636">HK-lnet-map-to-East-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-636">hk-lnet-map-to-east-us</span></span> |
| <span data-ttu-id="e4ab0-637">(Hong Kong) vnet-– východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-637">hk-vnet-east-us</span></span> |<span data-ttu-id="e4ab0-638">HK-lnet-map-to-West-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-638">hk-lnet-map-to-west-us</span></span> |

### <a name="step-4-create-gateways-on-vnet1-and-vnet2"></a><span data-ttu-id="e4ab0-639">Krok 4: Vytvoření brány na VNET1 a VNET2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-639">Step 4: Create Gateways on VNET1 and VNET2</span></span>
<span data-ttu-id="e4ab0-640">Na řídicím panelu virtuální sítě klikněte na možnost vytvořit BRÁNU, která se aktivuje bránu VPN procesu zřizování.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-640">From the dashboard of both the virtual networks, click CREATE GATEWAY which will trigger the VPN gateway provisioning process.</span></span> <span data-ttu-id="e4ab0-641">Po několika minutách řídicí panel každý virtuální sítě by měl obsahovat adresu skutečného brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-641">After a few minutes the dashboard of each virtual network should display the actual gateway address.</span></span>

### <a name="step-5-update-local-networks-with-the-respective-gateway-addresses"></a><span data-ttu-id="e4ab0-642">Krok 5: Aktualizace "Local" sítě s adresami příslušných "brány"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-642">Step 5: Update “Local” networks with the respective “Gateway” addresses</span></span>
<span data-ttu-id="e4ab0-643">Upravte místní sítě nahradit IP adresu brány zástupný symbol skutečné IP adresu právě zřízené brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-643">Edit both the local networks to replace the placeholder gateway IP address with the real IP address of the just provisioned gateways.</span></span> <span data-ttu-id="e4ab0-644">Použijte následující mapování:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-644">Use the following mapping:</span></span>

<table>
<tr><th><span data-ttu-id="e4ab0-645">Místní sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-645">Local Network</span></span>    </th><th><span data-ttu-id="e4ab0-646">Brána virtuální sítě</span><span class="sxs-lookup"><span data-stu-id="e4ab0-646">Virtual Network Gateway</span></span></th></tr>
<tr><td><span data-ttu-id="e4ab0-647">HK-lnet-map-to-East-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-647">hk-lnet-map-to-east-us</span></span> </td><td><span data-ttu-id="e4ab0-648">Brána (Hong Kong) vnet západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-648">Gateway of hk-vnet-west-us</span></span></td></tr>
<tr><td><span data-ttu-id="e4ab0-649">HK-lnet-map-to-West-us</span><span class="sxs-lookup"><span data-stu-id="e4ab0-649">hk-lnet-map-to-west-us</span></span> </td><td><span data-ttu-id="e4ab0-650">Brána (Hong Kong) vnet-– východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-650">Gateway of hk-vnet-east-us</span></span></td></tr>
</table>

### <a name="step-6-update-the-shared-key"></a><span data-ttu-id="e4ab0-651">Krok 6: Aktualizace sdílený klíč</span><span class="sxs-lookup"><span data-stu-id="e4ab0-651">Step 6: Update the shared key</span></span>
<span data-ttu-id="e4ab0-652">Pomocí následujícího skriptu prostředí Powershell se aktualizovat klíč protokolu IPSec každý brány VPN [použití saké klíč pro obě brány]: hk-lnet-map-to-west-us - LocalNetworkSiteName v Set AzureVNetGatewayKey - VNetName (Hong Kong) vnet-– východ us - SharedKey D9E76BKK Set-AzureVNetGatewayKey - VNetName (Hong Kong) vnet západní USA - LocalNetworkSiteName hk-lnet-map-to-east-us - SharedKey D9E76BKK</span><span class="sxs-lookup"><span data-stu-id="e4ab0-652">Use the following Powershell script to update the IPSec key of each VPN gateway [use the sake key for both the gateways]: Set-AzureVNetGatewayKey -VNetName hk-vnet-east-us -LocalNetworkSiteName hk-lnet-map-to-west-us -SharedKey D9E76BKK Set-AzureVNetGatewayKey -VNetName hk-vnet-west-us -LocalNetworkSiteName hk-lnet-map-to-east-us -SharedKey D9E76BKK</span></span>

### <a name="step-7-establish-the-vnet-to-vnet-connection"></a><span data-ttu-id="e4ab0-653">Krok 7: Připojení VNET-to-VNET</span><span class="sxs-lookup"><span data-stu-id="e4ab0-653">Step 7: Establish the VNET-to-VNET connection</span></span>
<span data-ttu-id="e4ab0-654">Z klasického portálu Azure pomocí nabídky "Řídicího PANELU" virtuální sítě k navázání připojení brány brány.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-654">From the Azure classic portal, use the “DASHBOARD” menu of both the virtual networks to establish gateway-to-gateway connection.</span></span> <span data-ttu-id="e4ab0-655">Pomocí položky nabídky "Připojit" v dolním panelu nástrojů.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-655">Use the “CONNECT” menu items in the bottom toolbar.</span></span> <span data-ttu-id="e4ab0-656">Po několika minutách by měl řídicím panelu zobrazovat podrobnosti připojení graficky.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-656">After a few minutes the dashboard should display the connection details graphically.</span></span>

### <a name="step-8-create-the-virtual-machines-in-region-2"></a><span data-ttu-id="e4ab0-657">Krok 8: Vytvoření virtuálních počítačů v oblasti #2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-657">Step 8: Create the virtual machines in region #2</span></span>
<span data-ttu-id="e4ab0-658">Vytvoření bitové kopie Ubuntu, jak je popsáno v oblasti #1 nasazení podle stejné kroky nebo kopírování souboru bitové kopie virtuálního pevného disku na účet úložiště Azure umístěný v oblasti #2 a vytvoření bitové kopie.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-658">Create the Ubuntu image as described in region #1 deployment by following the same steps or copy the image VHD file to the Azure storage account located in region #2 and create the image.</span></span> <span data-ttu-id="e4ab0-659">Použijte tuto bitovou kopii a vytvoření následující seznam virtuálních počítačů do novou cloudovou službu hk-c-svc východ nám:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-659">Use this image and create the following list of virtual machines into a new cloud service hk-c-svc-east-us:</span></span>

| <span data-ttu-id="e4ab0-660">Název počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-660">Machine Name</span></span> | <span data-ttu-id="e4ab0-661">Podsíť</span><span class="sxs-lookup"><span data-stu-id="e4ab0-661">Subnet</span></span> | <span data-ttu-id="e4ab0-662">IP adresa</span><span class="sxs-lookup"><span data-stu-id="e4ab0-662">IP Address</span></span> | <span data-ttu-id="e4ab0-663">Skupina dostupnosti</span><span class="sxs-lookup"><span data-stu-id="e4ab0-663">Availability set</span></span> | <span data-ttu-id="e4ab0-664">DC/Rack</span><span class="sxs-lookup"><span data-stu-id="e4ab0-664">DC/Rack</span></span> | <span data-ttu-id="e4ab0-665">Počáteční hodnoty?</span><span class="sxs-lookup"><span data-stu-id="e4ab0-665">Seed?</span></span> |
| --- | --- | --- | --- | --- | --- |
| <span data-ttu-id="e4ab0-666">(Hong Kong) c1-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-666">hk-c1-east-us</span></span> |<span data-ttu-id="e4ab0-667">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-667">data</span></span> |<span data-ttu-id="e4ab0-668">10.2.2.4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-668">10.2.2.4</span></span> |<span data-ttu-id="e4ab0-669">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-669">hk-c-aset-1</span></span> |<span data-ttu-id="e4ab0-670">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-670">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="e4ab0-671">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-671">Yes</span></span> |
| <span data-ttu-id="e4ab0-672">(Hong Kong) c2-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-672">hk-c2-east-us</span></span> |<span data-ttu-id="e4ab0-673">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-673">data</span></span> |<span data-ttu-id="e4ab0-674">10.2.2.5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-674">10.2.2.5</span></span> |<span data-ttu-id="e4ab0-675">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-675">hk-c-aset-1</span></span> |<span data-ttu-id="e4ab0-676">DC = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-676">dc =EASTUS rack =rack1</span></span> |<span data-ttu-id="e4ab0-677">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-677">No</span></span> |
| <span data-ttu-id="e4ab0-678">(Hong Kong) c3-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-678">hk-c3-east-us</span></span> |<span data-ttu-id="e4ab0-679">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-679">data</span></span> |<span data-ttu-id="e4ab0-680">10.2.2.6</span><span class="sxs-lookup"><span data-stu-id="e4ab0-680">10.2.2.6</span></span> |<span data-ttu-id="e4ab0-681">(Hong Kong) c sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-681">hk-c-aset-1</span></span> |<span data-ttu-id="e4ab0-682">DC = EASTUS rack = rack2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-682">dc =EASTUS rack =rack2</span></span> |<span data-ttu-id="e4ab0-683">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-683">Yes</span></span> |
| <span data-ttu-id="e4ab0-684">(Hong Kong) c5-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-684">hk-c5-east-us</span></span> |<span data-ttu-id="e4ab0-685">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-685">data</span></span> |<span data-ttu-id="e4ab0-686">10.2.2.8</span><span class="sxs-lookup"><span data-stu-id="e4ab0-686">10.2.2.8</span></span> |<span data-ttu-id="e4ab0-687">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-687">hk-c-aset-2</span></span> |<span data-ttu-id="e4ab0-688">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-688">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="e4ab0-689">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-689">Yes</span></span> |
| <span data-ttu-id="e4ab0-690">(Hong Kong) c6-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-690">hk-c6-east-us</span></span> |<span data-ttu-id="e4ab0-691">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-691">data</span></span> |<span data-ttu-id="e4ab0-692">10.2.2.9</span><span class="sxs-lookup"><span data-stu-id="e4ab0-692">10.2.2.9</span></span> |<span data-ttu-id="e4ab0-693">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-693">hk-c-aset-2</span></span> |<span data-ttu-id="e4ab0-694">DC = EASTUS rack = rack3</span><span class="sxs-lookup"><span data-stu-id="e4ab0-694">dc =EASTUS rack =rack3</span></span> |<span data-ttu-id="e4ab0-695">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-695">No</span></span> |
| <span data-ttu-id="e4ab0-696">(Hong Kong)-s c7 – východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-696">hk-c7-east-us</span></span> |<span data-ttu-id="e4ab0-697">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-697">data</span></span> |<span data-ttu-id="e4ab0-698">10.2.2.10</span><span class="sxs-lookup"><span data-stu-id="e4ab0-698">10.2.2.10</span></span> |<span data-ttu-id="e4ab0-699">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-699">hk-c-aset-2</span></span> |<span data-ttu-id="e4ab0-700">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-700">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="e4ab0-701">Ano</span><span class="sxs-lookup"><span data-stu-id="e4ab0-701">Yes</span></span> |
| <span data-ttu-id="e4ab0-702">(Hong Kong) c8-východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-702">hk-c8-east-us</span></span> |<span data-ttu-id="e4ab0-703">data</span><span class="sxs-lookup"><span data-stu-id="e4ab0-703">data</span></span> |<span data-ttu-id="e4ab0-704">10.2.2.11</span><span class="sxs-lookup"><span data-stu-id="e4ab0-704">10.2.2.11</span></span> |<span data-ttu-id="e4ab0-705">(Hong Kong) c sada-2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-705">hk-c-aset-2</span></span> |<span data-ttu-id="e4ab0-706">DC = EASTUS rack = rack4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-706">dc =EASTUS rack =rack4</span></span> |<span data-ttu-id="e4ab0-707">Ne</span><span class="sxs-lookup"><span data-stu-id="e4ab0-707">No</span></span> |
| <span data-ttu-id="e4ab0-708">(Hong Kong) w1 – východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-708">hk-w1-east-us</span></span> |<span data-ttu-id="e4ab0-709">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-709">web</span></span> |<span data-ttu-id="e4ab0-710">10.2.1.4</span><span class="sxs-lookup"><span data-stu-id="e4ab0-710">10.2.1.4</span></span> |<span data-ttu-id="e4ab0-711">(Hong Kong) w sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-711">hk-w-aset-1</span></span> |<span data-ttu-id="e4ab0-712">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-712">N/A</span></span> |<span data-ttu-id="e4ab0-713">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-713">N/A</span></span> |
| <span data-ttu-id="e4ab0-714">(Hong Kong) w2 – východ nám</span><span class="sxs-lookup"><span data-stu-id="e4ab0-714">hk-w2-east-us</span></span> |<span data-ttu-id="e4ab0-715">webové</span><span class="sxs-lookup"><span data-stu-id="e4ab0-715">web</span></span> |<span data-ttu-id="e4ab0-716">10.2.1.5</span><span class="sxs-lookup"><span data-stu-id="e4ab0-716">10.2.1.5</span></span> |<span data-ttu-id="e4ab0-717">(Hong Kong) w sada-1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-717">hk-w-aset-1</span></span> |<span data-ttu-id="e4ab0-718">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-718">N/A</span></span> |<span data-ttu-id="e4ab0-719">Není k dispozici</span><span class="sxs-lookup"><span data-stu-id="e4ab0-719">N/A</span></span> |

<span data-ttu-id="e4ab0-720">Použijte stejné pokyny jako oblast #1, ale použít 10.2.xxx.xxx adresní prostor.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-720">Follow the same instructions as region #1 but use 10.2.xxx.xxx address space.</span></span>

### <a name="step-9-configure-cassandra-on-each-vm"></a><span data-ttu-id="e4ab0-721">Krok 9: Konfigurace Cassandra na jednotlivé virtuální počítače</span><span class="sxs-lookup"><span data-stu-id="e4ab0-721">Step 9: Configure Cassandra on each VM</span></span>
<span data-ttu-id="e4ab0-722">Přihlaste se k virtuálnímu počítači a proveďte následující:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-722">Log into the VM and perform the following:</span></span>

1. <span data-ttu-id="e4ab0-723">Upravit $CASS_HOME/conf/cassandra-rackdc.properties zadat vlastnosti center a rack data ve formátu: dc = EASTUS rack = rack1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-723">Edit $CASS_HOME/conf/cassandra-rackdc.properties to specify the data center and rack properties in the format:  dc =EASTUS  rack =rack1</span></span>
2. <span data-ttu-id="e4ab0-724">Upravit cassandra.yaml konfigurace uzly počáteční hodnoty: semen: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-724">Edit cassandra.yaml to configure seed nodes:  Seeds: "10.1.2.4,10.1.2.6,10.1.2.8,10.1.2.10,10.2.2.4,10.2.2.6,10.2.2.8,10.2.2.10"</span></span>

### <a name="step-10-start-cassandra"></a><span data-ttu-id="e4ab0-725">Krok 10: Spuštění Cassandra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-725">Step 10: Start Cassandra</span></span>
<span data-ttu-id="e4ab0-726">Přihlaste se k každý virtuální počítač a spusťte Cassandra na pozadí spuštěním následujícího příkazu: $CASS_HOME/bin/cassandra</span><span class="sxs-lookup"><span data-stu-id="e4ab0-726">Log into each VM and start Cassandra in the background by running the following command: $CASS_HOME/bin/cassandra</span></span>

## <a name="test-the-multi-region-cluster"></a><span data-ttu-id="e4ab0-727">Testování více oblast clusteru</span><span class="sxs-lookup"><span data-stu-id="e4ab0-727">Test the Multi-Region Cluster</span></span>
<span data-ttu-id="e4ab0-728">Nyní Cassandra nasazený na 16 uzlů s 8 uzly v každé oblasti Azure.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-728">By now Cassandra has been deployed to 16 nodes with 8 nodes in each Azure region.</span></span> <span data-ttu-id="e4ab0-729">Tyto uzly jsou ve stejném clusteru na základě běžný název clusteru a počáteční konfigurace uzlu.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-729">These nodes are in the same cluster by virtue of the common cluster name and the seed node configuration.</span></span> <span data-ttu-id="e4ab0-730">Použijte následující postup k testování clusteru:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-730">Use the following process to test the cluster:</span></span>

### <a name="step-1-get-the-internal-load-balancer-ip-for-both-the-regions-using-powershell"></a><span data-ttu-id="e4ab0-731">Krok 1: Získání IP nástroje pro vyrovnávání zatížení pro vnitřní pro oblasti pomocí prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="e4ab0-731">Step 1: Get the internal load balancer IP for both the regions using PowerShell</span></span>
* <span data-ttu-id="e4ab0-732">Get-AzureInternalLoadbalancer - ServiceName "(Hong Kong) c-svc západní USA"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-732">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-west-us"</span></span>
* <span data-ttu-id="e4ab0-733">Get-AzureInternalLoadbalancer - ServiceName "(Hong Kong) c-svc Východ USA"</span><span class="sxs-lookup"><span data-stu-id="e4ab0-733">Get-AzureInternalLoadbalancer -ServiceName "hk-c-svc-east-us"</span></span>  
  
    <span data-ttu-id="e4ab0-734">Všimněte si IP adresy (například – západ - 10.1.2.101, východ - 10.2.2.101) zobrazí.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-734">Note the IP addresses (e.g. west - 10.1.2.101, east - 10.2.2.101) displayed.</span></span>

### <a name="step-2-execute-the-following-in-the-west-region-after-logging-into-hk-w1-west-us"></a><span data-ttu-id="e4ab0-735">Krok 2: Spuštěním následujících v této oblasti po přihlášení na hk-w1 – západní USA</span><span class="sxs-lookup"><span data-stu-id="e4ab0-735">Step 2: Execute the following in the west region after logging into hk-w1-west-us</span></span>
1. <span data-ttu-id="e4ab0-736">Spuštění $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="e4ab0-736">Execute $CASS_HOME/bin/cqlsh 10.1.2.101 9160</span></span>
2. <span data-ttu-id="e4ab0-737">Spuštěním následujících příkazů CQL:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-737">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="e4ab0-738">Vytvoření KEYSPACE customers_ks REPLIKACE s = {'class': 'NetworkToplogyStrategy', 'WESTUS': 3, 'EASTUS': 3};   POUŽITÍ customers_ks;   Vytvoření tabulky Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Vložit do VALUES(1, 'John', 'Doe') Customers(customer_id, firstname, lastname);   Vložit do Customers(customer_id, firstname, lastname) hodnoty (2, 'Jana', 'Doe');   Vyberte * od zákazníků;</span><span class="sxs-lookup"><span data-stu-id="e4ab0-738">CREATE KEYSPACE customers_ks   WITH REPLICATION = { 'class' : 'NetworkToplogyStrategy', 'WESTUS' : 3, 'EASTUS' : 3};   USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="e4ab0-739">Měli byste vidět zobrazení stejný, jako je nižší než:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-739">You should see a display like the one below:</span></span>

| <span data-ttu-id="e4ab0-740">customer_id</span><span class="sxs-lookup"><span data-stu-id="e4ab0-740">customer_id</span></span> | <span data-ttu-id="e4ab0-741">FirstName</span><span class="sxs-lookup"><span data-stu-id="e4ab0-741">firstname</span></span> | <span data-ttu-id="e4ab0-742">Příjmení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-742">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e4ab0-743">1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-743">1</span></span> |<span data-ttu-id="e4ab0-744">Jan</span><span class="sxs-lookup"><span data-stu-id="e4ab0-744">John</span></span> |<span data-ttu-id="e4ab0-745">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-745">Doe</span></span> |
| <span data-ttu-id="e4ab0-746">2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-746">2</span></span> |<span data-ttu-id="e4ab0-747">Jana</span><span class="sxs-lookup"><span data-stu-id="e4ab0-747">Jane</span></span> |<span data-ttu-id="e4ab0-748">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-748">Doe</span></span> |

### <a name="step-3-execute-the-following-in-the-east-region-after-logging-into-hk-w1-east-us"></a><span data-ttu-id="e4ab0-749">Krok 3: Spusťte následující v oblasti Východ po přihlášení na hk-w1 – východ us:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-749">Step 3: Execute the following in the east region after logging into hk-w1-east-us:</span></span>
1. <span data-ttu-id="e4ab0-750">Spuštění $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span><span class="sxs-lookup"><span data-stu-id="e4ab0-750">Execute $CASS_HOME/bin/cqlsh 10.2.2.101 9160</span></span>
2. <span data-ttu-id="e4ab0-751">Spuštěním následujících příkazů CQL:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-751">Execute the following CQL commands:</span></span>
   
     <span data-ttu-id="e4ab0-752">POUŽITÍ customers_ks;   Vytvoření tabulky Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   Vložit do VALUES(1, 'John', 'Doe') Customers(customer_id, firstname, lastname);   Vložit do Customers(customer_id, firstname, lastname) hodnoty (2, 'Jana', 'Doe');   Vyberte * od zákazníků;</span><span class="sxs-lookup"><span data-stu-id="e4ab0-752">USE customers_ks;   CREATE TABLE Customers(customer_id int PRIMARY KEY, firstname text, lastname text);   INSERT INTO Customers(customer_id, firstname, lastname) VALUES(1, 'John', 'Doe');   INSERT INTO Customers(customer_id, firstname, lastname) VALUES (2, 'Jane', 'Doe');   SELECT * FROM Customers;</span></span>

<span data-ttu-id="e4ab0-753">Jak je vidět pro oblast západní byste měli vidět stejné zobrazení:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-753">You should see the same display as seen for the West region:</span></span>

| <span data-ttu-id="e4ab0-754">customer_id</span><span class="sxs-lookup"><span data-stu-id="e4ab0-754">customer_id</span></span> | <span data-ttu-id="e4ab0-755">FirstName</span><span class="sxs-lookup"><span data-stu-id="e4ab0-755">firstname</span></span> | <span data-ttu-id="e4ab0-756">Příjmení</span><span class="sxs-lookup"><span data-stu-id="e4ab0-756">Lastname</span></span> |
| --- | --- | --- |
| <span data-ttu-id="e4ab0-757">1</span><span class="sxs-lookup"><span data-stu-id="e4ab0-757">1</span></span> |<span data-ttu-id="e4ab0-758">Jan</span><span class="sxs-lookup"><span data-stu-id="e4ab0-758">John</span></span> |<span data-ttu-id="e4ab0-759">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-759">Doe</span></span> |
| <span data-ttu-id="e4ab0-760">2</span><span class="sxs-lookup"><span data-stu-id="e4ab0-760">2</span></span> |<span data-ttu-id="e4ab0-761">Jana</span><span class="sxs-lookup"><span data-stu-id="e4ab0-761">Jane</span></span> |<span data-ttu-id="e4ab0-762">Doe</span><span class="sxs-lookup"><span data-stu-id="e4ab0-762">Doe</span></span> |

<span data-ttu-id="e4ab0-763">Provést několik další vložení a v tématu, aby těch, které se replikovaly západ-nám součástí clusteru.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-763">Execute a few more inserts and see that those get replicated to west-us part of the cluster.</span></span>

## <a name="test-cassandra-cluster-from-nodejs"></a><span data-ttu-id="e4ab0-764">Test Cassandra Cluster z Node.js</span><span class="sxs-lookup"><span data-stu-id="e4ab0-764">Test Cassandra Cluster from Node.js</span></span>
<span data-ttu-id="e4ab0-765">Pomocí jednoho z virtuálních počítačů Linux vytvářet v "web" vrstvy dříve, jsme spustí skript jednoduché Node.js čtení dříve vložených dat</span><span class="sxs-lookup"><span data-stu-id="e4ab0-765">Using one of the Linux VMs crated in the "web" tier previously, we will execute a simple Node.js script to read the previously inserted data</span></span>

<span data-ttu-id="e4ab0-766">**Krok 1: Instalace Node.js a Cassandra klienta**</span><span class="sxs-lookup"><span data-stu-id="e4ab0-766">**Step 1: Install Node.js and Cassandra Client**</span></span>

1. <span data-ttu-id="e4ab0-767">Nainstalovat Node.js a npm</span><span class="sxs-lookup"><span data-stu-id="e4ab0-767">Install Node.js and npm</span></span>
2. <span data-ttu-id="e4ab0-768">Instalace uzlu balíček "cassandra klienta" pomocí npm</span><span class="sxs-lookup"><span data-stu-id="e4ab0-768">Install node package "cassandra-client" using npm</span></span>
3. <span data-ttu-id="e4ab0-769">Spusťte následující skript příkazového řádku prostředí, která zobrazuje řetězec json načtená data:</span><span class="sxs-lookup"><span data-stu-id="e4ab0-769">Execute the following script at the shell prompt which displays the json string of the retrieved data:</span></span>
   
        var pooledCon = require('cassandra-client').PooledConnection;
        var ksName = "custsupport_ks";
        var cfName = "customers_cf";
        var hostList = ['internal_loadbalancer_ip:9160'];
        var ksConOptions = { hosts: hostList,
                             keyspace: ksName, use_bigints: false };
   
        function createKeyspace(callback){
           var cql = 'CREATE KEYSPACE ' + ksName + ' WITH strategy_class=SimpleStrategy AND strategy_options:replication_factor=1';
           var sysConOptions = { hosts: hostList,  
                                 keyspace: 'system', use_bigints: false };
           var con = new pooledCon(sysConOptions);
           con.execute(cql,[],function(err) {
           if (err) {
             console.log("Failed to create Keyspace: " + ksName);
             console.log(err);
           }
           else {
             console.log("Created Keyspace: " + ksName);
             callback(ksConOptions, populateCustomerData);
           }
           });
           con.shutdown();
        }
   
        function createColumnFamily(ksConOptions, callback){
          var params = ['customers_cf','custid','varint','custname',
                        'text','custaddress','text'];
          var cql = 'CREATE COLUMNFAMILY ? (? ? PRIMARY KEY,? ?, ? ?)';
        var con =  new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) {
                 console.log("Failed to create column family: " + params[0]);
                 console.log(err);
              }
              else {
                 console.log("Created column family: " + params[0]);
                 callback();
              }
          });
          con.shutdown();
        }
   
        //populate Data
        function populateCustomerData() {
           var params = ['John','Infinity Dr, TX', 1];
           updateCustomer(ksConOptions,params);
   
           params = ['Tom','Fermat Ln, WA', 2];
           updateCustomer(ksConOptions,params);
        }
   
        //update will also insert the record if none exists
        function updateCustomer(ksConOptions,params)
        {
          var cql = 'UPDATE customers_cf SET custname=?,custaddress=? where custid=?';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,params,function(err) {
              if (err) console.log(err);
              else console.log("Inserted customer : " + params[0]);
          });
          con.shutdown();
        }
   
        //read the two rows inserted above
        function readCustomer(ksConOptions)
        {
          var cql = 'SELECT * FROM customers_cf WHERE custid IN (1,2)';
          var con = new pooledCon(ksConOptions);
          con.execute(cql,[],function(err,rows) {
              if (err)
                 console.log(err);
              else
                 for (var i=0; i<rows.length; i++)
                    console.log(JSON.stringify(rows[i]));
            });
           con.shutdown();
        }
   
        //exectue the code
        createKeyspace(createColumnFamily);
        readCustomer(ksConOptions)

## <a name="conclusion"></a><span data-ttu-id="e4ab0-770">Závěr</span><span class="sxs-lookup"><span data-stu-id="e4ab0-770">Conclusion</span></span>
<span data-ttu-id="e4ab0-771">Microsoft Azure je flexibilní platforma, která umožňuje spuštění sad Microsoft jak software s otevřeným zdrojem, jak je ukázáno v tomto cvičení.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-771">Microsoft Azure is a flexible platform that allows the running of both Microsoft as well as open source software as demonstrated by this exercise.</span></span> <span data-ttu-id="e4ab0-772">Clustery s vysokou dostupností Cassandra můžete nasadit na jednoho datového centra prostřednictvím šíření uzly clusteru více domén selhání.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-772">Highly available Cassandra clusters can be deployed on a single data center through the spreading of the cluster nodes across multiple fault domains.</span></span> <span data-ttu-id="e4ab0-773">Také je možné instalovat clustery Cassandra nad několika oblastmi Azure geograficky vzdáleným doklad systémů po havárii.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-773">Cassandra clusters can also be deployed across multiple geographically distant Azure regions for disaster proof systems.</span></span> <span data-ttu-id="e4ab0-774">Azure a Cassandra společně umožňuje vytváření vysoce škálovatelnou a vysoce dostupné a po havárii obnovitelné cloudové služby potřeby škálovat podle dnešní internetové služby.</span><span class="sxs-lookup"><span data-stu-id="e4ab0-774">Azure and Cassandra together enables the construction of highly scalable, highly available and disaster recoverable cloud services needed by today's internet scale services.</span></span>  

## <a name="references"></a><span data-ttu-id="e4ab0-775">Odkazy</span><span class="sxs-lookup"><span data-stu-id="e4ab0-775">References</span></span>
* [<span data-ttu-id="e4ab0-776">http://cassandra.apache.org</span><span class="sxs-lookup"><span data-stu-id="e4ab0-776">http://cassandra.apache.org</span></span>](http://cassandra.apache.org)
* [<span data-ttu-id="e4ab0-777">http://www.datastax.com</span><span class="sxs-lookup"><span data-stu-id="e4ab0-777">http://www.datastax.com</span></span>](http://www.datastax.com)
* [<span data-ttu-id="e4ab0-778">http://www.nodejs.org</span><span class="sxs-lookup"><span data-stu-id="e4ab0-778">http://www.nodejs.org</span></span>](http://www.nodejs.org)


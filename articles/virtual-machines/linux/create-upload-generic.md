---
title: "Vytvoření a nahrání virtuálního pevného disku Linux v Azure"
description: "Naučte se vytvořit a odeslat Azure virtuálního pevného disku (VHD) obsahující operační systém Linux."
services: virtual-machines-linux
documentationcenter: 
author: szarkos
manager: timlt
editor: tysonn
tags: azure-resource-manager,azure-service-management
ms.assetid: d351396c-95a0-4092-b7bf-c6aae0bbd112
ms.service: virtual-machines-linux
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-linux
ms.devlang: na
ms.topic: article
ms.date: 02/02/2017
ms.author: szark
ms.openlocfilehash: ccadf55c492c097ef96f25e469dbf36fc87b6102
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="information-for-non-endorsed-distributions"></a><span data-ttu-id="43a69-103">Informace pro neschválené distribuce</span><span class="sxs-lookup"><span data-stu-id="43a69-103">Information for Non-Endorsed Distributions</span></span>
[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="43a69-104">Platformy Azure SLA se vztahuje na virtuální počítače běžící operační systém Linux jenom v případě, že je jeden z [distribuce schválené](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) se používá.</span><span class="sxs-lookup"><span data-stu-id="43a69-104">The Azure platform SLA applies to virtual machines running the Linux OS only when one of the [endorsed distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) is used.</span></span> <span data-ttu-id="43a69-105">Všechny distribuce Linux, které jsou k dispozici v galerii Azure bitové kopie jsou potvrzená distribuce s požadovanou konfigurací.</span><span class="sxs-lookup"><span data-stu-id="43a69-105">All Linux distributions that are provided in the Azure image gallery are endorsed distributions with the required configuration.</span></span>

* [<span data-ttu-id="43a69-106">Distribuce schválené pro Linux ve službě Azure-</span><span class="sxs-lookup"><span data-stu-id="43a69-106">Linux on Azure - Endorsed Distributions</span></span>](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)
* [<span data-ttu-id="43a69-107">Podpora pro Linux obrázků v Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="43a69-107">Support for Linux images in Microsoft Azure</span></span>](https://support.microsoft.com/kb/2941892)

<span data-ttu-id="43a69-108">Všechny distribuce spuštěné v Azure budou muset splňovat určité požadavky na šance, že správně spouštět na platformě.</span><span class="sxs-lookup"><span data-stu-id="43a69-108">All distributions running on Azure will need to meet a number of prerequisites to have a chance to properly run on the platform.</span></span>  <span data-ttu-id="43a69-109">Tento článek je komplexní rozhodně není, protože každý distribuční se liší. a je dost možné, že i v případě splnění všech následujících kritérií stále potřebujete k výraznému vylepšení systému Linux a ujistěte se, zda správně pracuje na platformě.</span><span class="sxs-lookup"><span data-stu-id="43a69-109">This article is by no means comprehensive as every distribution is different; and it is quite possible that even if you meet all the criteria below you will still need to significantly tweak your Linux system to ensure that it properly runs on the platform.</span></span>

<span data-ttu-id="43a69-110">Je z tohoto důvodu, který doporučujeme spouštět některý z našich [Linux na distribuce schválené pro Azure](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) Pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="43a69-110">It is for this reason that we recommend that you start with one of our [Linux on Azure Endorsed Distributions](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) when possible.</span></span> <span data-ttu-id="43a69-111">V následujících článcích vás provede postup přípravy různé potvrzená distribuce systému Linux, které jsou podporovány v Azure:</span><span class="sxs-lookup"><span data-stu-id="43a69-111">The following articles will guide you through how to prepare the various endorsed Linux distributions that are supported on Azure:</span></span>

* <span data-ttu-id="43a69-112">**[Na základě centOS distribuce](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-112">**[CentOS-based Distributions](create-upload-centos.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="43a69-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-113">**[Debian Linux](debian-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="43a69-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-114">**[Oracle Linux](oracle-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="43a69-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-115">**[Red Hat Enterprise Linux](redhat-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="43a69-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-116">**[SLES & openSUSE](suse-create-upload-vhd.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>
* <span data-ttu-id="43a69-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span><span class="sxs-lookup"><span data-stu-id="43a69-117">**[Ubuntu](create-upload-ubuntu.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)**</span></span>

<span data-ttu-id="43a69-118">Zbývající část tohoto článku se soustředí na obecných pokynů pro spuštění distribuční Linux v Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-118">The rest of this article will focus on general guidance for running your Linux distribution on Azure.</span></span>

## <a name="general-linux-installation-notes"></a><span data-ttu-id="43a69-119">Poznámky k instalaci obecné Linux</span><span class="sxs-lookup"><span data-stu-id="43a69-119">General Linux Installation Notes</span></span>
* <span data-ttu-id="43a69-120">Formát VHDX není podporován v Azure, pouze **pevný virtuální pevný disk**.</span><span class="sxs-lookup"><span data-stu-id="43a69-120">The VHDX format is not supported in Azure, only **fixed VHD**.</span></span>  <span data-ttu-id="43a69-121">Disk můžete převést do formátu virtuálního pevného disku pomocí Správce technologie Hyper-V nebo rutiny convert-VHD prostředí.</span><span class="sxs-lookup"><span data-stu-id="43a69-121">You can convert the disk to VHD format using Hyper-V Manager or the convert-vhd cmdlet.</span></span> <span data-ttu-id="43a69-122">Pokud používáte VirtualBox to znamená výběr **pevnou velikost** oproti výchozí přidělí dynamicky při vytváření disku.</span><span class="sxs-lookup"><span data-stu-id="43a69-122">If you are using VirtualBox this means selecting **Fixed size** as opposed to the default dynamically allocated when creating the disk.</span></span>
* <span data-ttu-id="43a69-123">Azure podporuje pouze virtuální počítače generace 1.</span><span class="sxs-lookup"><span data-stu-id="43a69-123">Azure only supports generation 1 virtual machines.</span></span> <span data-ttu-id="43a69-124">Virtuální počítač generace 1 můžete převést z VHDX do formátu souboru virtuálního pevného disku a dynamicky se zvětšující pevné velikosti disku.</span><span class="sxs-lookup"><span data-stu-id="43a69-124">You can convert a generation 1 virtual machine from VHDX to the VHD file format and from dynamically expanding to a fixed sized disk.</span></span> <span data-ttu-id="43a69-125">Ale nemůžete změnit generaci virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="43a69-125">But you can't change a virtual machine's generation.</span></span> <span data-ttu-id="43a69-126">Další informace najdete v tématu [by měl vytvořit virtuální počítač generace 1 nebo 2 v Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span><span class="sxs-lookup"><span data-stu-id="43a69-126">For more information, see [Should I create a generation 1 or 2 virtual machine in Hyper-V?](https://technet.microsoft.com/en-us/windows-server-docs/compute/hyper-v/plan/should-i-create-a-generation-1-or-2-virtual-machine-in-hyper-v)</span></span>
* <span data-ttu-id="43a69-127">Maximální velikost povolenou pro virtuální pevný disk je 1,023 GB.</span><span class="sxs-lookup"><span data-stu-id="43a69-127">The maximum size allowed for the VHD is 1,023 GB.</span></span>
* <span data-ttu-id="43a69-128">Při instalaci systému Linux je *doporučená* použít standardní oddíly spíše než LVM (často výchozí pro mnoho instalace).</span><span class="sxs-lookup"><span data-stu-id="43a69-128">When installing the Linux system it is *recommended* that you use standard partitions rather than LVM (often the default for many installations).</span></span> <span data-ttu-id="43a69-129">Tím se vyhnete LVM název je v konfliktu s klonovaný virtuální počítače, zvlášť pokud někdy musí být připojen k virtuálnímu počítači jiné identické pro řešení potíží s disk s operačním systémem.</span><span class="sxs-lookup"><span data-stu-id="43a69-129">This will avoid LVM name conflicts with cloned VMs, particularly if an OS disk ever needs to be attached to another identical VM for troubleshooting.</span></span> <span data-ttu-id="43a69-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) nebo [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) mohou být použity na datové disky.</span><span class="sxs-lookup"><span data-stu-id="43a69-130">[LVM](configure-lvm.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) or [RAID](configure-raid.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) may be used on data disks.</span></span>
* <span data-ttu-id="43a69-131">Vyžaduje se podpora jádra pro připojení systémy souborů UDF.</span><span class="sxs-lookup"><span data-stu-id="43a69-131">Kernel support for mounting UDF file systems is required.</span></span> <span data-ttu-id="43a69-132">Při prvním spuštění v Azure je předána zřizování konfigurace do virtuálního počítače s Linuxem pomocí formátu UDF média, který je připojen k Host.</span><span class="sxs-lookup"><span data-stu-id="43a69-132">At first boot on Azure the provisioning configuration is passed to the Linux VM via UDF-formatted media that is attached to the guest.</span></span> <span data-ttu-id="43a69-133">Azure Linux agent musí být schopný se připojit a načíst jeho konfiguraci a zřídit virtuální počítač v systému souborů UDF.</span><span class="sxs-lookup"><span data-stu-id="43a69-133">The Azure Linux agent must be able to mount the UDF file system to read its configuration and provision the VM.</span></span>
* <span data-ttu-id="43a69-134">Verze jádra Linux pod 2.6.37 nepodporují NUMA v technologii Hyper-V s větší velikostí virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="43a69-134">Linux kernel versions below 2.6.37 do not support NUMA on Hyper-V with larger VM sizes.</span></span> <span data-ttu-id="43a69-135">-Li tento problém ovlivňuje především starší distribuce pomocí nadřazený Red Hat 2.6.32 jádra která byla opravena v RHEL 6.6 (jádra 2.6.32 504).</span><span class="sxs-lookup"><span data-stu-id="43a69-135">This issue primarily impacts older distributions using the upstream Red Hat 2.6.32 kernel, and was fixed in RHEL 6.6 (kernel-2.6.32-504).</span></span> <span data-ttu-id="43a69-136">Systémy s operačním systémem vlastní jádra starší než 2.6.37 nebo na základě RHEL jádra starší než 2.6.32-504 musíte nastavit parametr spouštěcího `numa=off` na příkazového řádku v grub.conf jádra.</span><span class="sxs-lookup"><span data-stu-id="43a69-136">Systems running custom kernels older than 2.6.37, or RHEL-based kernels older than 2.6.32-504 must set the boot parameter `numa=off` on the kernel command-line in grub.conf.</span></span> <span data-ttu-id="43a69-137">Další informace najdete v části Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span><span class="sxs-lookup"><span data-stu-id="43a69-137">For more information see Red Hat [KB 436883](https://access.redhat.com/solutions/436883).</span></span>
* <span data-ttu-id="43a69-138">Nekonfigurujte přepnutí oddílu na disku operačního systému.</span><span class="sxs-lookup"><span data-stu-id="43a69-138">Do not configure a swap partition on the OS disk.</span></span> <span data-ttu-id="43a69-139">Chcete-li vytvořit odkládací soubor na disku dočasných prostředků lze nakonfigurovat agenta systému Linux.</span><span class="sxs-lookup"><span data-stu-id="43a69-139">The Linux agent can be configured to create a swap file on the temporary resource disk.</span></span>  <span data-ttu-id="43a69-140">Další informace o této naleznete v následujících krocích.</span><span class="sxs-lookup"><span data-stu-id="43a69-140">More information about this can be found in the steps below.</span></span>
* <span data-ttu-id="43a69-141">Všechny virtuální pevné disky musí mít velikostí, které jsou násobky 1 MB.</span><span class="sxs-lookup"><span data-stu-id="43a69-141">All of the VHDs must have sizes that are multiples of 1 MB.</span></span>

### <a name="installing-kernel-modules-without-hyper-v"></a><span data-ttu-id="43a69-142">Instalace modulů jádra bez technologie Hyper-V</span><span class="sxs-lookup"><span data-stu-id="43a69-142">Installing kernel modules without Hyper-V</span></span>
<span data-ttu-id="43a69-143">Azure je spuštěná na hypervisoru technologie Hyper-V, takže Linux vyžaduje nainstalované moduly určité jádra pro spuštění v Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-143">Azure runs on the Hyper-V hypervisor, so Linux requires that certain kernel modules are installed in order to run in Azure.</span></span> <span data-ttu-id="43a69-144">Pokud máte virtuální počítač, který se vytvořil mimo technologie Hyper-V, instalačních programů Linux nemusí zahrnovat ovladače pro Hyper-V v počáteční disku paměti RAM (initrd nebo initramfs) Pokud zjistí, zda je spuštěna prostředí Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="43a69-144">If you have a VM that was created outside of Hyper-V, the Linux installers may not include the drivers for Hyper-V in the initial ramdisk (initrd or initramfs) unless it detects that it is running an a Hyper-V environment.</span></span> <span data-ttu-id="43a69-145">Při použití jiným virtualizačním systému (tj. Virtualbox, KVM atd.) Příprava bitové kopie systému Linux, budete muset znovu vytvořit initrd zajistit, aby alespoň `hv_vmbus` a `hv_storvsc` jádra moduly jsou k dispozici na počáteční disku paměti RAM.</span><span class="sxs-lookup"><span data-stu-id="43a69-145">When using a different virtualization system (i.e. Virtualbox, KVM, etc.) to prepare your Linux image, you may need to rebuild the initrd to ensure that at least the `hv_vmbus` and `hv_storvsc` kernel modules are available on the initial ramdisk.</span></span>  <span data-ttu-id="43a69-146">Jedná se o známý problém alespoň na systémy založené na nadřazený distribuce Red Hat.</span><span class="sxs-lookup"><span data-stu-id="43a69-146">This is a known issue at least on systems based on the upstream Red Hat distribution.</span></span>

<span data-ttu-id="43a69-147">Tento mechanismus pro nové sestavení initrd nebo initramfs image může lišit v závislosti na rozdělení.</span><span class="sxs-lookup"><span data-stu-id="43a69-147">The mechanism for rebuilding the initrd or initramfs image may vary depending on the distribution.</span></span> <span data-ttu-id="43a69-148">Projděte si dokumentaci k vaší distribuční nebo podporu pro správné postup.</span><span class="sxs-lookup"><span data-stu-id="43a69-148">Please consult your distribution's documentation or support for the proper procedure.</span></span>  <span data-ttu-id="43a69-149">Tady je jedním z příkladů jak znovu sestavte initrd pomocí `mkinitrd` nástroje:</span><span class="sxs-lookup"><span data-stu-id="43a69-149">Here is one example for how to rebuild the initrd using the `mkinitrd` utility:</span></span>

<span data-ttu-id="43a69-150">Nejprve zálohujte existující bitová kopie initrd:</span><span class="sxs-lookup"><span data-stu-id="43a69-150">First, back up the existing initrd image:</span></span>

    # cd /boot
    # sudo cp initrd-`uname -r`.img  initrd-`uname -r`.img.bak

<span data-ttu-id="43a69-151">V dalším kroku znovu sestavit initrd s `hv_vmbus` a `hv_storvsc` moduly jádra:</span><span class="sxs-lookup"><span data-stu-id="43a69-151">Next, rebuild the initrd with the `hv_vmbus` and `hv_storvsc` kernel modules:</span></span>

    # sudo mkinitrd --preload=hv_storvsc --preload=hv_vmbus -v -f initrd-`uname -r`.img `uname -r`


### <a name="resizing-vhds"></a><span data-ttu-id="43a69-152">Změna velikosti virtuálních pevných disků</span><span class="sxs-lookup"><span data-stu-id="43a69-152">Resizing VHDs</span></span>
<span data-ttu-id="43a69-153">Image virtuálního pevného disku na Azure musí mít virtuální velikost zarovnán 1MB.</span><span class="sxs-lookup"><span data-stu-id="43a69-153">VHD images on Azure must have a virtual size aligned to 1MB.</span></span>  <span data-ttu-id="43a69-154">Obvykle virtuální pevné disky vytvořené pomocí technologie Hyper-V už zarovnání správně.</span><span class="sxs-lookup"><span data-stu-id="43a69-154">Typically, VHDs created using Hyper-V should already be aligned correctly.</span></span>  <span data-ttu-id="43a69-155">Pokud není správně zarovnaná virtuálního pevného disku, pak při pokusu o vytvoření, může se zobrazit chybová zpráva podobná následující *image* z vaší virtuálního pevného disku:</span><span class="sxs-lookup"><span data-stu-id="43a69-155">If the VHD is not aligned correctly then you may receive an error message similar to the following when you attempt to create an *image* from your VHD:</span></span>

    "The VHD http://<mystorageaccount>.blob.core.windows.net/vhds/MyLinuxVM.vhd has an unsupported virtual size of 21475270656 bytes. The size must be a whole number (in MBs).”

<span data-ttu-id="43a69-156">Chcete-li opravit to můžete změnit velikost virtuálního počítače pomocí konzoly Správce technologie Hyper-V nebo [změny velikosti virtuálního pevného disku](http://technet.microsoft.com/library/hh848535.aspx) rutiny prostředí Powershell.</span><span class="sxs-lookup"><span data-stu-id="43a69-156">To remedy this you can resize the VM using either the Hyper-V Manager console or the [Resize-VHD](http://technet.microsoft.com/library/hh848535.aspx) Powershell cmdlet.</span></span>  <span data-ttu-id="43a69-157">Pokud používáte v prostředí systému Windows, se doporučuje použít qemu img převést (v případě potřeby) a změnit velikost virtuálního pevného disku.</span><span class="sxs-lookup"><span data-stu-id="43a69-157">If you are not running in a Windows environment then it is recommended to use qemu-img to convert (if needed) and resize the VHD.</span></span>

> [!NOTE]
> <span data-ttu-id="43a69-158">Je známého problému v qemu img verze > = 2.2.1, jejímž výsledkem nesprávně naformátovaný VHD.</span><span class="sxs-lookup"><span data-stu-id="43a69-158">There is a known bug in qemu-img versions >=2.2.1 that results in an improperly formatted VHD.</span></span> <span data-ttu-id="43a69-159">Ve verzi 2.6 QEMU byl opraven problém.</span><span class="sxs-lookup"><span data-stu-id="43a69-159">The issue has been fixed in QEMU 2.6.</span></span> <span data-ttu-id="43a69-160">Doporučuje se používat qemu-img 2.2.0 nebo nižší, nebo aktualizace na 2.6 nebo novější.</span><span class="sxs-lookup"><span data-stu-id="43a69-160">It is recommended to use either qemu-img 2.2.0 or lower, or update to 2.6 or higher.</span></span> <span data-ttu-id="43a69-161">Referenční dokumentace: https://bugs.launchpad.net/qemu/+bug/1490611.</span><span class="sxs-lookup"><span data-stu-id="43a69-161">Reference: https://bugs.launchpad.net/qemu/+bug/1490611.</span></span>
> 
> 

1. <span data-ttu-id="43a69-162">Změna velikosti virtuálního pevného disku přímo pomocí nástrojů, jako `qemu-img` nebo `vbox-manage` může mít za následek nelze spustit VHD.</span><span class="sxs-lookup"><span data-stu-id="43a69-162">Resizing the VHD directly using tools such as `qemu-img` or `vbox-manage` may result in an unbootable VHD.</span></span>  <span data-ttu-id="43a69-163">Proto se doporučuje první převést virtuální pevný disk do bitové kopie NEZPRACOVANÁ disku.</span><span class="sxs-lookup"><span data-stu-id="43a69-163">So it is recommended to first convert the VHD to a RAW disk image.</span></span>  <span data-ttu-id="43a69-164">Pokud image virtuálního počítače byla již vytvořena jako image NEZPRACOVANÁ disku (výchozí nastavení pro některé hypervisory například KVM) může tento krok přeskočit:</span><span class="sxs-lookup"><span data-stu-id="43a69-164">If the VM image was already created as RAW disk image (the default for some Hypervisors such as KVM) then you may skip this step:</span></span>
   
       # qemu-img convert -f vpc -O raw MyLinuxVM.vhd MyLinuxVM.raw

2. <span data-ttu-id="43a69-165">Vypočítejte požadovaná velikost bitové kopie disku a ujistěte se, že virtuální velikost je zarovnán 1MB.</span><span class="sxs-lookup"><span data-stu-id="43a69-165">Calculate the required size of the disk image to ensure that the virtual size is aligned to 1MB.</span></span>  <span data-ttu-id="43a69-166">Následující skript prostředí bash s tím pomůže.</span><span class="sxs-lookup"><span data-stu-id="43a69-166">The following bash shell script can assist with this.</span></span>  <span data-ttu-id="43a69-167">Tento skript využívá "`qemu-img info`" určit virtuální velikost bitové kopie disku a pak vypočítá velikost další 1 MB:</span><span class="sxs-lookup"><span data-stu-id="43a69-167">The script uses "`qemu-img info`" to determine the virtual size of the disk image and then calculates the size to the next 1MB:</span></span>
   
       rawdisk="MyLinuxVM.raw"
       vhddisk="MyLinuxVM.vhd"
   
       MB=$((1024*1024))
       size=$(qemu-img info -f raw --output json "$rawdisk" | \
              gawk 'match($0, /"virtual-size": ([0-9]+),/, val) {print val[1]}')
   
       rounded_size=$((($size/$MB + 1)*$MB))
       echo "Rounded Size = $rounded_size"

3. <span data-ttu-id="43a69-168">Změna velikosti nezpracovaná disku pomocí $rounded_size nastavená na skript výše:</span><span class="sxs-lookup"><span data-stu-id="43a69-168">Resize the raw disk using $rounded_size as set in the above script:</span></span>
   
       # qemu-img resize MyLinuxVM.raw $rounded_size

4. <span data-ttu-id="43a69-169">Nyní NEZPRACOVANÁ disku převeďte zpátky na virtuální pevný disk pevné velikosti:</span><span class="sxs-lookup"><span data-stu-id="43a69-169">Now, convert the RAW disk back to a fixed-size VHD:</span></span>
   
       # qemu-img convert -f raw -o subformat=fixed -O vpc MyLinuxVM.raw MyLinuxVM.vhd

   <span data-ttu-id="43a69-170">Nebo s verzí qemu **2.6 +** zahrnují `force_size` možnost:</span><span class="sxs-lookup"><span data-stu-id="43a69-170">Or, with qemu version **2.6+** include the `force_size` option:</span></span>

       # qemu-img convert -f raw -o subformat=fixed,force_size -O vpc MyLinuxVM.raw MyLinuxVM.vhd

## <a name="linux-kernel-requirements"></a><span data-ttu-id="43a69-171">Požadavky na Linux jádra</span><span class="sxs-lookup"><span data-stu-id="43a69-171">Linux Kernel Requirements</span></span>
<span data-ttu-id="43a69-172">Přímo na nadřazený jádra systému Linux jsou podílí ovladače Linux integrační služby (LIS) pro technologii Hyper-V a Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-172">The Linux Integration Services (LIS) drivers for Hyper-V and Azure are contributed directly to the upstream Linux kernel.</span></span> <span data-ttu-id="43a69-173">Velkém množství distribucí, které obsahují nejnovější verzi jádra Linux (tj. 3.x) bude již je k dispozici tyto ovladače, nebo v opačném případě zadejte přeneseny zpět verze těchto ovladačů s jejich jádra.</span><span class="sxs-lookup"><span data-stu-id="43a69-173">Many distributions that include a recent Linux kernel version (i.e. 3.x) will have these drivers available already, or otherwise provide backported versions of these drivers with their kernels.</span></span>  <span data-ttu-id="43a69-174">Tyto ovladače neustále aktualizované v nadřazeného jádra s nové opravy a funkce, takže pokud je to možné se doporučuje spustit [schválené distribuční](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) který bude obsahovat tyto opravy a aktualizace.</span><span class="sxs-lookup"><span data-stu-id="43a69-174">These drivers are constantly being updated in the upstream kernel with new fixes and features, so when possible it is recommended to run an [endorsed distribution](endorsed-distros.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) that will include these fixes and updates.</span></span>

<span data-ttu-id="43a69-175">Pokud používáte hodnotu typu variant Red Hat Enterprise Linux verze **6.0 6.3**, bude nutné nainstalovat nejnovější ovladače LIS pro Hyper-V.</span><span class="sxs-lookup"><span data-stu-id="43a69-175">If you are running a variant of Red Hat Enterprise Linux versions **6.0-6.3**, then you will need to install the latest LIS drivers for Hyper-V.</span></span> <span data-ttu-id="43a69-176">Ovladače lze nalézt [v tomto umístění](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="43a69-176">The drivers can be found [at this location](http://go.microsoft.com/fwlink/p/?LinkID=254263&clcid=0x409).</span></span> <span data-ttu-id="43a69-177">Od systému RHEL **6.4 +** (a odvozené konfigurace) LIS jsou již součástí jádra a proto žádné další instalační balíčky jsou potřebné ke spuštění těchto systémech v Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-177">As of RHEL **6.4+** (and derivatives) the LIS drivers are already included with the kernel and so no additional installation packages are needed to run those systems on Azure.</span></span>

<span data-ttu-id="43a69-178">Pokud se vyžaduje vlastní jádra, se doporučuje použít novější verzi jádra (tj. **3.8 +**).</span><span class="sxs-lookup"><span data-stu-id="43a69-178">If a custom kernel is required, it is recommended to use a more recent kernel version (i.e. **3.8+**).</span></span> <span data-ttu-id="43a69-179">U těchto distribuce nebo dodavatelů, kteří spravují své vlastní jádra některé úsilí bude potřeba pravidelně backport LIS ovladače z nadřazeného jádra pro vaše vlastní jádra.</span><span class="sxs-lookup"><span data-stu-id="43a69-179">For those distributions or vendors who maintain their own kernel, some effort will be required to regularly backport the LIS drivers from the upstream kernel to your custom kernel.</span></span>  <span data-ttu-id="43a69-180">I když už používáte relativně nejnovější verzi jádra, důrazně doporučujeme ke sledování všech nadřazeného opravy LIS ovladače a backport ty podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="43a69-180">Even if you are already running a relatively recent kernel version, it is highly recommended to keep track of any upstream fixes in the LIS drivers and backport those as needed.</span></span> <span data-ttu-id="43a69-181">Je k dispozici v umístění zdrojových souborů ovladačů LIS [údržby programu](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) ve stromu Linux jádra zdrojového souboru:</span><span class="sxs-lookup"><span data-stu-id="43a69-181">The location of the LIS driver source files is available in the [MAINTAINERS](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/MAINTAINERS) file in the Linux kernel source tree:</span></span>

    F:    arch/x86/include/asm/mshyperv.h
    F:    arch/x86/include/uapi/asm/hyperv.h
    F:    arch/x86/kernel/cpu/mshyperv.c
    F:    drivers/hid/hid-hyperv.c
    F:    drivers/hv/
    F:    drivers/input/serio/hyperv-keyboard.c
    F:    drivers/net/hyperv/
    F:    drivers/scsi/storvsc_drv.c
    F:    drivers/video/fbdev/hyperv_fb.c
    F:    include/linux/hyperv.h
    F:    tools/hv/

<span data-ttu-id="43a69-182">V velmi minimální bylo zjištěno chybí následující opravy, způsobit problémy v Azure a tak tyto musí být obsaženy v jádra.</span><span class="sxs-lookup"><span data-stu-id="43a69-182">At a very minimum, the absence of the following patches have been known to cause problems on Azure and so these must be included in the kernel.</span></span> <span data-ttu-id="43a69-183">Tento seznam je rozhodně není vyčerpávající nebo úplný pro všechny distribuce:</span><span class="sxs-lookup"><span data-stu-id="43a69-183">This list is by no means exhaustive or complete for all distributions:</span></span>

* [<span data-ttu-id="43a69-184">ata_piix: ve výchozím nastavení odložené disků, aby se ovladače technologie Hyper-V</span><span class="sxs-lookup"><span data-stu-id="43a69-184">ata_piix: defer disks to the Hyper-V drivers by default</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/ata/ata_piix.c?id=cd006086fa5d91414d8ff9ff2b78fbb593878e3c)
* [<span data-ttu-id="43a69-185">miniport storvsc: účet pro pakety na cestě v cestě k RESETOVÁNÍ</span><span class="sxs-lookup"><span data-stu-id="43a69-185">storvsc: Account for in-transit packets in the RESET path</span></span>](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/drivers/scsi/storvsc_drv.c?id=5c1b10ab7f93d24f29b5630286e323d1c5802d5c)
* [<span data-ttu-id="43a69-186">miniport storvsc: Vyhněte se použití WRITE_SAME</span><span class="sxs-lookup"><span data-stu-id="43a69-186">storvsc: avoid usage of WRITE_SAME</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=3e8f4f4065901c8dfc51407e1984495e1748c090)
* [<span data-ttu-id="43a69-187">miniport storvsc: zakázat zápis stejné diskového pole RAID a ovladače adaptéru virtuální hostitel</span><span class="sxs-lookup"><span data-stu-id="43a69-187">storvsc: Disable WRITE SAME for RAID and virtual host adapter drivers</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=54b2b50c20a61b51199bedb6e5d2f8ec2568fb43)
* [<span data-ttu-id="43a69-188">miniport storvsc: oprava zrušení ukazatele NULL.</span><span class="sxs-lookup"><span data-stu-id="43a69-188">storvsc: NULL pointer dereference fix</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=b12bb60d6c350b348a4e1460cd68f97ccae9822e)
* [<span data-ttu-id="43a69-189">miniport storvsc: selhání prstenec vyrovnávací paměti může vést k zablokování vstupně-výstupních operací</span><span class="sxs-lookup"><span data-stu-id="43a69-189">storvsc: ring buffer failures may result in I/O freeze</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/storvsc_drv.c?id=e86fb5e8ab95f10ec5f2e9430119d5d35020c951)
* [<span data-ttu-id="43a69-190">scsi_sysfs: ochranu proti dvojité provádění __scsi_remove_device</span><span class="sxs-lookup"><span data-stu-id="43a69-190">scsi_sysfs: protect against double execution of __scsi_remove_device</span></span>](https://git.kernel.org/cgit/linux/kernel/git/next/linux-next.git/commit/drivers/scsi/scsi_sysfs.c?id=be821fd8e62765de43cc4f0e2db363d0e30a7e9b)

## <a name="the-azure-linux-agent"></a><span data-ttu-id="43a69-191">Azure Linux Agent</span><span class="sxs-lookup"><span data-stu-id="43a69-191">The Azure Linux Agent</span></span>
<span data-ttu-id="43a69-192">[Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (příkaz waagent) je potřeba správně zřídit virtuální počítač s Linuxem v Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-192">The [Azure Linux Agent](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json) (waagent) is required to properly provision a Linux virtual machine in Azure.</span></span> <span data-ttu-id="43a69-193">Můžete získat nejnovější verzi, soubor problémy nebo odeslání žádosti o přijetí změn na [úložiště GitHub agenta Linux](https://github.com/Azure/WALinuxAgent).</span><span class="sxs-lookup"><span data-stu-id="43a69-193">You can get the latest version, file issues or submit pull requests at the [Linux Agent GitHub repo](https://github.com/Azure/WALinuxAgent).</span></span>

* <span data-ttu-id="43a69-194">V rámci Apache 2.0 licence vydání agenta systému Linux.</span><span class="sxs-lookup"><span data-stu-id="43a69-194">The Linux agent is released under the Apache 2.0 license.</span></span> <span data-ttu-id="43a69-195">Velkém množství distribucí již zadejte ot. / min nebo bázi deb balíčky pro agenta, a proto v některých případech to lze nainstalovat a aktualizovat s malým množstvím úsilí.</span><span class="sxs-lookup"><span data-stu-id="43a69-195">Many distributions already provide RPM or deb packages for the agent, and so in some cases this can be installed and updated with little effort.</span></span>
* <span data-ttu-id="43a69-196">Azure Linux Agent vyžaduje Python v2.6 +.</span><span class="sxs-lookup"><span data-stu-id="43a69-196">The Azure Linux Agent requires Python v2.6+.</span></span>
* <span data-ttu-id="43a69-197">Agent vyžaduje taky modul python pyasn1.</span><span class="sxs-lookup"><span data-stu-id="43a69-197">The agent also requires the python-pyasn1 module.</span></span> <span data-ttu-id="43a69-198">Většina distribuce to zadejte jako samostatný balíček, který může být instalován.</span><span class="sxs-lookup"><span data-stu-id="43a69-198">Most distributions provide this as a separate package that can be installed.</span></span>
* <span data-ttu-id="43a69-199">V některých případech nemusí být kompatibilní s NetworkManager Azure Linux Agent.</span><span class="sxs-lookup"><span data-stu-id="43a69-199">In some cases the Azure Linux Agent may not be compatible with NetworkManager.</span></span> <span data-ttu-id="43a69-200">Mnoho balíčků RPM/bázi Deb poskytované distribuce nakonfigurujte NetworkManager konflikt balíčku příkaz waagent a proto odinstaluje NetworkManager při instalaci balíčku agenta systému Linux.</span><span class="sxs-lookup"><span data-stu-id="43a69-200">Many of the RPM/Deb packages provided by distributions configure NetworkManager as a conflict to the waagent package, and thus will uninstall NetworkManager when you install the Linux agent package.</span></span>

## <a name="general-linux-system-requirements"></a><span data-ttu-id="43a69-201">Požadavky na systém Linux obecné</span><span class="sxs-lookup"><span data-stu-id="43a69-201">General Linux System Requirements</span></span>

* <span data-ttu-id="43a69-202">Změňte na řádku spouštěcí jádra GRUB nebo GRUB2, zahrnout následující parametry.</span><span class="sxs-lookup"><span data-stu-id="43a69-202">Modify the kernel boot line in GRUB or GRUB2 to include the following parameters.</span></span> <span data-ttu-id="43a69-203">To také zajistí, všechny zprávy konzoly odešlou do první sériového portu, který může být užitečné Azure podporu pro ladění problémů:</span><span class="sxs-lookup"><span data-stu-id="43a69-203">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues:</span></span>
  
        console=ttyS0,115200n8 earlyprintk=ttyS0,115200 rootdelay=300
  
    <span data-ttu-id="43a69-204">To také zajistí, všechny zprávy konzoly odešlou do první sériového portu, který může být užitečné Azure podporu pro ladění problémů.</span><span class="sxs-lookup"><span data-stu-id="43a69-204">This will also ensure all console messages are sent to the first serial port, which can assist Azure support with debugging issues.</span></span>
  
    <span data-ttu-id="43a69-205">Kromě výše uvedeného, doporučuje se *odebrat* Pokud existují následující parametry:</span><span class="sxs-lookup"><span data-stu-id="43a69-205">In addition to the above, it is recommended to *remove* the following parameters if they exist:</span></span>
  
        rhgb quiet crashkernel=auto
  
    <span data-ttu-id="43a69-206">Grafické a quiet spouštěcí nejsou užitečné při cloudovém prostředí, kde chceme, aby všechny protokoly pro odeslání do sériového portu.</span><span class="sxs-lookup"><span data-stu-id="43a69-206">Graphical and quiet boot are not useful in a cloud environment where we want all the logs to be sent to the serial port.</span></span> <span data-ttu-id="43a69-207">`crashkernel` Možnost může být vlevo nakonfigurované v případě potřeby, ale Všimněte si, že tento parametr se sníží množství dostupné paměti ve virtuálním počítači 128 MB nebo informace, které mohou způsobovat menší velikostí virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="43a69-207">The `crashkernel` option may be left configured if desired, but note that this parameter will reduce the amount of available memory in the VM by 128MB or more, which may be problematic on the smaller VM sizes.</span></span>

* <span data-ttu-id="43a69-208">Instalace agenta Azure Linux</span><span class="sxs-lookup"><span data-stu-id="43a69-208">Installing the Azure Linux Agent</span></span>
  
    <span data-ttu-id="43a69-209">Azure Linux Agent je požadované pro zřizování Linux image na platformě Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-209">The Azure Linux Agent is required for provisioning a Linux image on Azure.</span></span>  <span data-ttu-id="43a69-210">Velkém množství distribucí zadejte agenta jako balíček RPM nebo bázi Deb (balíčku se obvykle označuje jako 'WALinuxAgent' nebo 'walinuxagent').</span><span class="sxs-lookup"><span data-stu-id="43a69-210">Many distributions provide the agent as an RPM or Deb package (the package is typically called 'WALinuxAgent' or 'walinuxagent').</span></span>  <span data-ttu-id="43a69-211">Agent lze také nainstalovat ručně pomocí následujících kroků v [Linux Agent průvodce](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="43a69-211">The agent can also be installed manually by following the steps in the [Linux Agent Guide](../windows/agent-user-guide.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json).</span></span>

* <span data-ttu-id="43a69-212">Ujistěte se, že SSH server je nainstalován a nakonfigurován na spuštění při spuštění.</span><span class="sxs-lookup"><span data-stu-id="43a69-212">Ensure that the SSH server is installed and configured to start at boot time.</span></span>  <span data-ttu-id="43a69-213">Obvykle je to výchozí hodnota.</span><span class="sxs-lookup"><span data-stu-id="43a69-213">This is usually the default.</span></span>

* <span data-ttu-id="43a69-214">Nevytvářejte odkládacího prostoru na disku operačního systému</span><span class="sxs-lookup"><span data-stu-id="43a69-214">Do not create swap space on the OS disk</span></span>
  
    <span data-ttu-id="43a69-215">Azure Linux Agent mohou automaticky konfigurovat odkládacího souboru pomocí disku místní prostředek, který je připojen k virtuálnímu počítači po zřízení v Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-215">The Azure Linux Agent can automatically configure swap space using the local resource disk that is attached to the VM after provisioning on Azure.</span></span> <span data-ttu-id="43a69-216">Všimněte si, že je disk místní prostředek *dočasné* na disku a může vyprázdněny, když je virtuální počítač zrušit.</span><span class="sxs-lookup"><span data-stu-id="43a69-216">Note that the local resource disk is a *temporary* disk, and might be emptied when the VM is deprovisioned.</span></span> <span data-ttu-id="43a69-217">Po instalaci Azure Linux Agent (viz předchozí krok), upravte následující parametry v /etc/waagent.conf odpovídajícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="43a69-217">After installing the Azure Linux Agent (see previous step), modify the following parameters in /etc/waagent.conf appropriately:</span></span>
  
        ResourceDisk.Format=y
        ResourceDisk.Filesystem=ext4
        ResourceDisk.MountPoint=/mnt/resource
        ResourceDisk.EnableSwap=y
        ResourceDisk.SwapSizeMB=2048    ## NOTE: set this to whatever you need it to be.

* <span data-ttu-id="43a69-218">V posledním kroku spusťte následující příkaz pro zrušení zřízení virtuálního počítače:</span><span class="sxs-lookup"><span data-stu-id="43a69-218">As a final step, run the following commands to deprovision the virtual machine:</span></span>
  
        # sudo waagent -force -deprovision
        # export HISTSIZE=0
        # logout
  
  > [!NOTE]
  > <span data-ttu-id="43a69-219">Na Virtualbox mohou se zobrazit chybová zpráva po spuštění se příkaz waagent-force - deprovision.: `[Errno 5] Input/output error`.</span><span class="sxs-lookup"><span data-stu-id="43a69-219">On Virtualbox you may see the following error after running 'waagent -force -deprovision': `[Errno 5] Input/output error`.</span></span> <span data-ttu-id="43a69-220">Tato chybová zpráva není příliš důležitý a můžete ignorovat.</span><span class="sxs-lookup"><span data-stu-id="43a69-220">This error message is not critical and can be ignored.</span></span>
  > 
  > 

* <span data-ttu-id="43a69-221">Pak musíte vypnout virtuální počítač a nahrání virtuálního pevného disku do Azure.</span><span class="sxs-lookup"><span data-stu-id="43a69-221">You will then need to shut down the virtual machine and upload the VHD to Azure.</span></span>


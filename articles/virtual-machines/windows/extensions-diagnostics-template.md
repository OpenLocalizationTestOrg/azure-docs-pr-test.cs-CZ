---
title: "Přidat monitorování & diagnostiky pro virtuální počítač Azure | Microsoft Docs"
description: "Pomocí šablony Azure resource Manageru k vytvoření nového virtuálního počítače Windows Azure diagnostics rozšíření."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 6955e3d8c7b032ee898be11e611080905b5069ba
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="333be-103">Monitorování a Diagnostika pomocí šablony virtuálního počítače s Windows a Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="333be-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="333be-104">Rozšíření diagnostiky Azure poskytuje, monitorování a diagnostické funkce v systému Windows na základě virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="333be-104">The Azure Diagnostics Extension provides the monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="333be-105">Tyto funkce na virtuálním počítači můžete povolit v rámci šablony azure resource Manageru, přiložením rozšíření.</span><span class="sxs-lookup"><span data-stu-id="333be-105">You can enable these capabilities on the virtual machine by including the extension as part of the azure resource manager template.</span></span> <span data-ttu-id="333be-106">V tématu [vytváření šablon Azure Resource Manager pomocí rozšíření virtuálního počítače](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) Další informace o včetně všechna rozšíření v rámci šablony virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="333be-107">Tento článek popisuje, jak přidat rozšíření Azure Diagnostics do šablony virtuálního počítače windows.</span><span class="sxs-lookup"><span data-stu-id="333be-107">This article describes how you can add the Azure Diagnostics extension to a windows virtual machine template.</span></span>  

## <a name="add-the-azure-diagnostics-extension-to-the-vm-resource-definition"></a><span data-ttu-id="333be-108">Přidejte rozšíření Azure Diagnostics do definice prostředků virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="333be-108">Add the Azure Diagnostics extension to the VM resource definition</span></span>
<span data-ttu-id="333be-109">Chcete-li povolit rozšíření diagnostiky na virtuální počítač Windows přidat příponu jako prostředek virtuálního počítače v šabloně Resource manager.</span><span class="sxs-lookup"><span data-stu-id="333be-109">To enable the diagnostics extension on a Windows Virtual Machine you need to add the extension as a VM resource in the Resource manager template.</span></span>

<span data-ttu-id="333be-110">Pro jednoduché Resource Manager na bázi virtuálního počítače přidat do konfigurace rozšíření *prostředky* pole pro virtuální počítač:</span><span class="sxs-lookup"><span data-stu-id="333be-110">For a simple Resource Manager based Virtual Machine add the extension configuration to the *resources* array for the Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="333be-111">Další běžné konvence je přidat konfigurace rozšíření v uzlu kořenové prostředků šablony místo definice prostředků uzlu virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-111">Another common convention is add the extension configuration at the root resources node of the template instead of defining it under the virtual machine's resources node.</span></span> <span data-ttu-id="333be-112">S tímto přístupem budete muset explicitně určit hierarchický vztah mezi rozšíření a virtuální počítač s *název* a *typ* hodnoty.</span><span class="sxs-lookup"><span data-stu-id="333be-112">With this approach you have to explicitly specify a hierarchical relation between the extension and the virtual machine with the *name* and *type* values.</span></span> <span data-ttu-id="333be-113">Například:</span><span class="sxs-lookup"><span data-stu-id="333be-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="333be-114">Rozšíření je vždy přidružený virtuální počítač, můžete buď přímo přímo definovat uzlu prostředků virtuálního počítače nebo definovat na úrovni základní a přidružit ho k virtuálnímu počítači pomocí hierarchické zásady vytváření názvů.</span><span class="sxs-lookup"><span data-stu-id="333be-114">The extension is always associated with the virtual machine, you can either directly define it under the virtual machine's resource node directly or define it at the base level and use the hierarchical naming convention to associate it with the virtual machine.</span></span>

<span data-ttu-id="333be-115">Konfigurace rozšíření je pro sady škálování virtuálního počítače zadaná v *extensionProfile* vlastnost *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="333be-115">For Virtual Machine Scale Sets the extensions configuration is specified in the *extensionProfile* property of the *VirtualMachineProfile*.</span></span>

<span data-ttu-id="333be-116">*Vydavatele* vlastnosti s hodnotou **Microsoft.Azure.Diagnostics** a *typ* vlastnosti s hodnotou **IaaSDiagnostics** jednoznačně rozšíření Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="333be-116">The *publisher* property with the value of **Microsoft.Azure.Diagnostics** and the *type* property with the value of **IaaSDiagnostics** uniquely identify the Azure Diagnostics extension.</span></span>

<span data-ttu-id="333be-117">Hodnota *název* vlastnost lze použít k odkazování na rozšíření ve skupině prostředků.</span><span class="sxs-lookup"><span data-stu-id="333be-117">The value of the *name* property can be used to refer to the extension in the resource group.</span></span> <span data-ttu-id="333be-118">Konkrétně pro jeho nastavení **Microsoft.Insights.VMDiagnosticsSettings** vám umožní snadno identifikovat na portálu Azure, zajistíte, že monitorování grafy zobrazují až správně na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="333be-118">Setting it specifically to **Microsoft.Insights.VMDiagnosticsSettings** will enable it to be easily identified by the Azure portal ensuring that the monitoring charts show up correctly in the Azure portal.</span></span>

<span data-ttu-id="333be-119">*TypeHandlerVersion* Určuje verzi rozšíření, které chcete použít.</span><span class="sxs-lookup"><span data-stu-id="333be-119">The *typeHandlerVersion* specifies the version of the extension you would like to use.</span></span> <span data-ttu-id="333be-120">Nastavení *autoUpgradeMinorVersion* podverze k **true** zajistí, že dostanete nejnovější dílčí verzi rozšíření, která je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="333be-120">Setting *autoUpgradeMinorVersion* minor version to **true** ensures that you will get the latest Minor version of the extension that is available.</span></span> <span data-ttu-id="333be-121">Důrazně doporučujeme vždy nastavit *autoUpgradeMinorVersion* vždycky být **true** , abyste měli vždy použít nejnovější rozšíření diagnostiky k dispozici všechny nové funkce a opravy chyb.</span><span class="sxs-lookup"><span data-stu-id="333be-121">It is highly recommended that you always set *autoUpgradeMinorVersion* to always be **true** so that you always get to use the latest available diagnostics extension with all the new features and bug fixes.</span></span> 

<span data-ttu-id="333be-122">*Nastavení* prvek obsahuje vlastnosti konfigurace pro rozšíření, které můžete nastavit a načíst zpět z rozšíření (někdy označované jako veřejné konfigurace).</span><span class="sxs-lookup"><span data-stu-id="333be-122">The *settings* element contains configurations properties for the extension that can be set and read back from the extension (sometimes referred to as public configuration).</span></span> <span data-ttu-id="333be-123">*Xmlcfg* vlastnost obsahuje konfigurační soubor xml na základě protokolů diagnostiky, čítačích výkonu atd, který bude shromážděn agentem diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="333be-123">The *xmlcfg* property contains xml based configuration for the diagnostics logs, performance counters etc that will be collected by the diagnostics agent.</span></span> <span data-ttu-id="333be-124">V tématu [schéma konfigurace diagnostiky](https://msdn.microsoft.com/library/azure/dn782207.aspx) Další informace o schématu xml, sám sebe.</span><span class="sxs-lookup"><span data-stu-id="333be-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about the xml schema itself.</span></span> <span data-ttu-id="333be-125">Běžnou praxí je pro uložení konfigurační soubor xml skutečné jako proměnné v šablony Azure Resource Manageru a pak zřetězení a kódování base64 je nastavit hodnotu pro *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="333be-125">A common practice is to store the actual xml configuration as a variable in the Azure Resource Manager template and then concatenate and base64 encode them to set the value for *xmlcfg*.</span></span> <span data-ttu-id="333be-126">Projděte část o [proměnné konfigurace diagnostiky](#diagnostics-configuration-variables) bližší informace o tom, jak uložit xml do proměnné.</span><span class="sxs-lookup"><span data-stu-id="333be-126">See the section on [diagnostics configuration variables](#diagnostics-configuration-variables) to understand more about how to store the xml in variables.</span></span> <span data-ttu-id="333be-127">*StorageAccount* vlastnost určuje název účtu úložiště, do které diagnostiky se nepřenesou data.</span><span class="sxs-lookup"><span data-stu-id="333be-127">The *storageAccount* property specifies the name of the storage account to which diagnostics data will be transferred.</span></span> 

<span data-ttu-id="333be-128">Vlastnosti v *protectedSettings* (někdy označují jako privátní konfigurace) můžete nastavit, ale nemůže přečíst zpět po nastaveno.</span><span class="sxs-lookup"><span data-stu-id="333be-128">The properties in *protectedSettings* (sometimes referred to as private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="333be-129">Jen pro zápis povaze *protectedSettings* je vhodná pro ukládání tajné klíče jako klíč účtu úložiště zápis diagnostická data.</span><span class="sxs-lookup"><span data-stu-id="333be-129">The write-only nature of *protectedSettings* makes it useful for storing secrets like the storage account key where the diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="333be-130">Zadání účtu úložiště diagnostiky jako parametry</span><span class="sxs-lookup"><span data-stu-id="333be-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="333be-131">Diagnostika rozšíření json výše uvedeném fragmentu předpokládá dva parametry *existingdiagnosticsStorageAccountName* a *existingdiagnosticsStorageResourceGroup* určete účet úložiště diagnostiky, kde bude uložena diagnostická data.</span><span class="sxs-lookup"><span data-stu-id="333be-131">The diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* to specify the diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="333be-132">Zadání účtu úložiště diagnostiky jako parametr ní snadno změnit účet úložiště diagnostiky různých prostředích například můžete chtít použít účet úložiště různé diagnostiky pro testování a jinou pro produkční nasazení.</span><span class="sxs-lookup"><span data-stu-id="333be-132">Specifying the diagnostics storage account as a parameter makes it easy to change the diagnostics storage account across different environments e.g. you may want to use a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "The name of an existing storage account to which diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "The resource group for the storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="333be-133">Je vhodné v jiné skupině prostředků než skupinu prostředků pro virtuální počítač zadejte účet úložiště diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="333be-133">It is best practice to specify a diagnostics storage account in a different resource group than the resource group for the virtual machine.</span></span> <span data-ttu-id="333be-134">Skupinu prostředků lze považovat za jako jednotky nasazení s vlastním životního cyklu, virtuální počítač můžete nasadit a znovu nasadit jako nové aktualizace konfigurace jsou vytvářeny k němu ale můžete chtít pokračovat v ukládání dat diagnostiky ve stejném účtu úložiště mezi tyto nasazení virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="333be-134">A resource group can be considered to be a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it to it but you may want to continue storing the diagnostics data in the same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="333be-135">S účet úložiště v různých prostředků umožňuje účet úložiště tak, aby přijímal data z různých nasazení virtuálních počítačů, a usnadňuje tak řešení problémů mezi různými verzemi.</span><span class="sxs-lookup"><span data-stu-id="333be-135">Having the storage account in a different resource enables the storage account to accept data from various virtual machine deployments making it easy to troubleshoot issues across the various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="333be-136">Pokud vytvoříte šablonu virtuálního počítače windows ze sady Visual Studio může být nastaveno výchozí účet úložiště použít stejný účet úložiště, kde je načtený pevný disk virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-136">If you create a windows virtual machine template from Visual Studio the default storage account might be set to use the same storage account where the virtual machine VHD is uploaded.</span></span> <span data-ttu-id="333be-137">Toto je ke zjednodušení počáteční nastavení virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-137">This is to simplify initial setup of the VM.</span></span> <span data-ttu-id="333be-138">Je potřeba zvážit znovu šablonu, kterou chcete použít jiný účet úložiště, může být předán jako parametr.</span><span class="sxs-lookup"><span data-stu-id="333be-138">You should re-factor the template to use a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="333be-139">Proměnné konfigurace diagnostiky</span><span class="sxs-lookup"><span data-stu-id="333be-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="333be-140">Definuje diagnostiky rozšíření json výše uvedeném fragmentu *accountid* proměnná zjednodušit získávání klíč účtu úložiště pro úložiště diagnostiky:</span><span class="sxs-lookup"><span data-stu-id="333be-140">The diagnostics extension json snippet above defines an *accountid* variable to simplify getting the storage account key for the diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="333be-141">*Xmlcfg* vlastnost pro rozšíření diagnostiky je definovaná pomocí více proměnných, které jsou zřetězeny společně.</span><span class="sxs-lookup"><span data-stu-id="333be-141">The *xmlcfg* property for the diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="333be-142">Hodnoty těchto proměnných jsou ve formátu xml, takže budou muset být správně uvozeny zpětným lomítkem při nastavování proměnné json.</span><span class="sxs-lookup"><span data-stu-id="333be-142">The values of these variables are in xml so they need to be escaped correctly when setting the json variables.</span></span>

<span data-ttu-id="333be-143">Následující část popisuje konfigurační soubor xml diagnostiky, která shromažďuje čítače úrovně výkonu standardní systému spolu se některé protokoly událostí systému windows a protokolů diagnostiky infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="333be-143">The following describes the diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="333be-144">Je uvozena a zda je správně naformátován tak, aby konfigurace lze vložit přímo do části proměnných šablony.</span><span class="sxs-lookup"><span data-stu-id="333be-144">It has been escaped and formatted correctly so that the configuration can directly be pasted into the variables section of your template.</span></span> <span data-ttu-id="333be-145">Najdete v článku [schéma konfigurace diagnostiky](https://msdn.microsoft.com/library/azure/dn782207.aspx) více lidského čitelný příklad kódu XML konfigurace.</span><span class="sxs-lookup"><span data-stu-id="333be-145">See the [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of the configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="333be-146">Uzel metriky definice xml v konfiguraci výše je důležité konfigurační element jako definuje, jak se čítače výkonu definované výše v kód xml v *PerformanceCounter* uzlu bude agregovat a uložené.</span><span class="sxs-lookup"><span data-stu-id="333be-146">The Metrics definition xml node in the above configuration is an important configuration element as it defines how the performance counters defined earlier in the xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="333be-147">Tyto metriky jednotky monitorování grafů a výstrahy na portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="333be-147">These metrics drive the monitoring charts and alerts in the Azure portal.</span></span>  <span data-ttu-id="333be-148">**Metriky** uzel s *resourceID* a **MetricAggregation** musí obsahovat v konfiguraci diagnostiky pro virtuální počítač, pokud chcete zobrazit data na portálu Azure monitorování virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-148">The **Metrics** node with the *resourceID* and **MetricAggregation** must be included in the diagnostics configuration for your VM if you want to see the VM monitoring data in the Azure portal.</span></span> 
> 
> 

<span data-ttu-id="333be-149">Následuje příklad kódu XML definice metriky:</span><span class="sxs-lookup"><span data-stu-id="333be-149">The following is an example of the xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="333be-150">*ResourceID* atribut jednoznačně identifikuje virtuální počítač v rámci vašeho předplatného.</span><span class="sxs-lookup"><span data-stu-id="333be-150">The *resourceID* attribute uniquely identifies the virtual machine in your subscription.</span></span> <span data-ttu-id="333be-151">Ujistěte se, že pomocí funkcí subscription() a resourceGroup() tak, aby šablona automaticky aktualizuje tyto hodnoty na základě předplatného a skupiny prostředků, které nasazujete.</span><span class="sxs-lookup"><span data-stu-id="333be-151">Make sure to use the subscription() and resourceGroup() functions so that the template automatically updates those values based on the subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="333be-152">Pokud vytvoříte více virtuálních počítačů ve smyčce, pak bude mít k naplnění *resourceID* hodnoty pomocí funkce copyIndex() správně odlišit od jednotlivých jednotlivých virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="333be-152">If you are creating multiple Virtual Machines in a loop then you will have to populate the *resourceID* value with an copyIndex() function to correctly differentiate each individual VM.</span></span> <span data-ttu-id="333be-153">*XmlCfg* hodnota může být aktualizované kvůli podpoře to následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="333be-153">The *xmlCfg* value can be updated to support this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="333be-154">Hodnota MetricAggregation *PT1H* a *PT1M* označily agregace za minutu a agregace přes hodinu.</span><span class="sxs-lookup"><span data-stu-id="333be-154">The MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="333be-155">WADMetrics tabulek v úložišti</span><span class="sxs-lookup"><span data-stu-id="333be-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="333be-156">Výše uvedené metriky konfigurace vygeneruje tabulky ve vašem účtu úložiště diagnostiky s následující názvové konvence:</span><span class="sxs-lookup"><span data-stu-id="333be-156">The Metrics configuration above will generate tables in your diagnostics storage account with the following naming conventions:</span></span>

* <span data-ttu-id="333be-157">**WADMetrics** : standardní předponou pro všechny tabulky WADMetrics</span><span class="sxs-lookup"><span data-stu-id="333be-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="333be-158">**PT1H** nebo **PT1M** : označuje, zda tabulka obsahuje agregovaná data více než 1 hodina nebo 1 minuta</span><span class="sxs-lookup"><span data-stu-id="333be-158">**PT1H** or **PT1M** : Signifies that the table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="333be-159">**P10D** : označuje, že v tabulce budou obsahovat data pro 10 dní od při spuštění v tabulce shromažďování dat</span><span class="sxs-lookup"><span data-stu-id="333be-159">**P10D** : Signifies the table will contain data for 10 days from when the table started collecting data</span></span>
* <span data-ttu-id="333be-160">**V2S** : řetězcová konstanta</span><span class="sxs-lookup"><span data-stu-id="333be-160">**V2S** : String constant</span></span>
* <span data-ttu-id="333be-161">**RRRRMMDD** : datum, kdy došlo v tabulce shromažďování dat</span><span class="sxs-lookup"><span data-stu-id="333be-161">**yyyymmdd** : The date at which the table started collecting data</span></span>

<span data-ttu-id="333be-162">Příklad: *WADMetricsPT1HP10DV2S20151108* budou obsahovat data metriky agregovat přes hodinu 10 dní od 11. listopadu 2015</span><span class="sxs-lookup"><span data-stu-id="333be-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="333be-163">Každá tabulka WADMetrics bude obsahovat následující sloupce:</span><span class="sxs-lookup"><span data-stu-id="333be-163">Each WADMetrics table will contain the following columns:</span></span>

* <span data-ttu-id="333be-164">**PartitionKey**: partitionkey sestavený na základě *resourceID* hodnotu k jednoznačné identifikaci prostředků virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="333be-164">**PartitionKey**: The partitionkey is constructed based on the *resourceID* value to uniquely identify the VM resource.</span></span> <span data-ttu-id="333be-165">pro např: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="333be-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="333be-166">**RowKey** : strukturu <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="333be-166">**RowKey** : Follows the format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="333be-167">Sestupné značek výpočet doby je maximální doba rysky minus čas začátku období agregace.</span><span class="sxs-lookup"><span data-stu-id="333be-167">The descending time tick calculation is max time ticks minus the time of the beginning of the aggregation period.</span></span> <span data-ttu-id="333be-168">Například</span><span class="sxs-lookup"><span data-stu-id="333be-168">E.g.</span></span> <span data-ttu-id="333be-169">Pokud je ukázka období spuštěné na 10. listopadu 2015 a 00:00Hrs UTC pak výpočet by: DateTime.MaxValue.Ticks - (nové DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Rysky).</span><span class="sxs-lookup"><span data-stu-id="333be-169">if the sample period started on 10-Nov-2015 and 00:00Hrs UTC then the calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="333be-170">Pro paměť klíč řádku čítače výkonu bajty k dispozici bude vypadat jako: 2519551871999999999__:005CMemory:005CAvailable:0020 bajtů</span><span class="sxs-lookup"><span data-stu-id="333be-170">For the memory available bytes performance counter the row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="333be-171">**Název_čítače** : název čítače výkonu.</span><span class="sxs-lookup"><span data-stu-id="333be-171">**CounterName** : Is the name of the performance counter.</span></span> <span data-ttu-id="333be-172">To odpovídá *counterSpecifier* definované v xml konfigurace.</span><span class="sxs-lookup"><span data-stu-id="333be-172">This matches the *counterSpecifier* defined in the xml config.</span></span>
* <span data-ttu-id="333be-173">**Maximální** : maximální hodnota čítače výkonu období agregace.</span><span class="sxs-lookup"><span data-stu-id="333be-173">**Maximum** : The maximum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="333be-174">**Minimální** : minimální hodnota čítače výkonu období agregace.</span><span class="sxs-lookup"><span data-stu-id="333be-174">**Minimum** : The minimum value of the performance counter over the aggregation period.</span></span>
* <span data-ttu-id="333be-175">**Celkový počet** : součet všech hodnot čítače výkonu hlášené období agregace.</span><span class="sxs-lookup"><span data-stu-id="333be-175">**Total** : The sum of all values of the performance counter reported over the aggregation period.</span></span>
* <span data-ttu-id="333be-176">**Počet** : Celkový počet hodnot hlášené pro čítač výkonu.</span><span class="sxs-lookup"><span data-stu-id="333be-176">**Count** : The total number of values reported for the performance counter.</span></span>
* <span data-ttu-id="333be-177">**Průměrná** : průměr (celkem nebo počet) hodnota čítače výkonu období agregace.</span><span class="sxs-lookup"><span data-stu-id="333be-177">**Average** : The average (total/count) value of the performance counter over the aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="333be-178">Další kroky</span><span class="sxs-lookup"><span data-stu-id="333be-178">Next Steps</span></span>
* <span data-ttu-id="333be-179">Pro dokončení vzorové šablony z virtuálního počítače s Windows pomocí rozšíření diagnostiky najdete v části [201-vm monitorování--rozšíření diagnostiky](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="333be-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="333be-180">Nasazení pomocí šablony správce prostředků [prostředí Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) nebo [příkazového řádku Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="333be-180">Deploy the resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="333be-181">Další informace o [vytváření šablon Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="333be-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>


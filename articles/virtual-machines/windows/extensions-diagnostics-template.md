---
title: "aaaAdd monitorování & diagnostiky tooan virtuální počítač Azure | Microsoft Docs"
description: "Pomocí toocreate šablony správce prostředků Azure nového virtuálního počítače Windows Azure diagnostics rozšíření."
services: virtual-machines-windows
documentationcenter: 
author: sbtron
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: 8cde8fe7-977b-43d2-be74-ad46dc946058
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: article
ms.date: 05/31/2017
ms.author: saurabh
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d8a831421a0f9d38c09d51cf8c2e6dff913c77ff
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="use-monitoring-and-diagnostics-with-a-windows-vm-and-azure-resource-manager-templates"></a><span data-ttu-id="7044b-103">Monitorování a Diagnostika pomocí šablony virtuálního počítače s Windows a Azure Resource Manager</span><span class="sxs-lookup"><span data-stu-id="7044b-103">Use monitoring and diagnostics with a Windows VM and Azure Resource Manager templates</span></span>
<span data-ttu-id="7044b-104">Hello rozšíření diagnostiky Azure poskytuje hello monitorování a Diagnostika možnosti v systému Windows na základě virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="7044b-104">hello Azure Diagnostics Extension provides hello monitoring and diagnostics capabilities on a Windows based Azure virtual machine.</span></span> <span data-ttu-id="7044b-105">Tyto funkce na virtuálním počítači hello můžete povolit, přiložením rozšíření hello jako součást hello šablony azure resource Manageru.</span><span class="sxs-lookup"><span data-stu-id="7044b-105">You can enable these capabilities on hello virtual machine by including hello extension as part of hello azure resource manager template.</span></span> <span data-ttu-id="7044b-106">V tématu [vytváření šablon Azure Resource Manager pomocí rozšíření virtuálního počítače](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) Další informace o včetně všechna rozšíření v rámci šablony virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="7044b-106">See [Authoring Azure Resource Manager Templates with VM Extensions](template-description.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json#extensions) for more information on including any extension as part of a virtual machine template.</span></span> <span data-ttu-id="7044b-107">Tento článek popisuje, jak můžete přidat šablonu virtuálního počítače windows rozšíření tooa aplikace hello Azure Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="7044b-107">This article describes how you can add hello Azure Diagnostics extension tooa windows virtual machine template.</span></span>  

## <a name="add-hello-azure-diagnostics-extension-toohello-vm-resource-definition"></a><span data-ttu-id="7044b-108">Přidat definici prostředků hello Azure Diagnostics rozšíření toohello virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="7044b-108">Add hello Azure Diagnostics extension toohello VM resource definition</span></span>
<span data-ttu-id="7044b-109">rozšíření diagnostiky hello tooenable na virtuální počítač Windows musíte rozšíření hello tooadd jako prostředek virtuálního počítače v hello šablona Resource Manageru.</span><span class="sxs-lookup"><span data-stu-id="7044b-109">tooenable hello diagnostics extension on a Windows Virtual Machine you need tooadd hello extension as a VM resource in hello Resource manager template.</span></span>

<span data-ttu-id="7044b-110">Pro jednoduché Resource Manager na bázi virtuálního počítače přidejte hello rozšíření konfigurace toohello *prostředky* pole pro hello virtuálního počítače:</span><span class="sxs-lookup"><span data-stu-id="7044b-110">For a simple Resource Manager based Virtual Machine add hello extension configuration toohello *resources* array for hello Virtual Machine:</span></span> 

    "resources": [
                {
                    "name": "Microsoft.Insights.VMDiagnosticsSettings",
                    "type": "extensions",
                    "location": "[resourceGroup().location]",
                    "apiVersion": "2015-06-15",
                    "dependsOn": [
                        "[concat('Microsoft.Compute/virtualMachines/', variables('vmName'))]"
                    ],
                    "tags": {
                        "displayName": "AzureDiagnostics"
                    },
                    "properties": {
                        "publisher": "Microsoft.Azure.Diagnostics",
                        "type": "IaaSDiagnostics",
                        "typeHandlerVersion": "1.5",
                        "autoUpgradeMinorVersion": true,
                        "settings": {
                            "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), variables('vmName'), variables('wadcfgxend')))]",
                            "storageAccount": "[parameters('existingdiagnosticsStorageAccountName')]"
                        },
                        "protectedSettings": {
                            "storageAccountName": "[parameters('existingdiagnosticsStorageAccountName')]",
                            "storageAccountKey": "[listkeys(variables('accountid'), '2015-05-01-preview').key1]",
                            "storageAccountEndPoint": "https://core.windows.net"
                        }
                    }
                }
            ]


<span data-ttu-id="7044b-111">Další běžné konvence je přidat konfigurace rozšíření hello v hello kořenový uzel prostředků šablony hello místo definice prostředků uzlu hello virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="7044b-111">Another common convention is add hello extension configuration at hello root resources node of hello template instead of defining it under hello virtual machine's resources node.</span></span> <span data-ttu-id="7044b-112">S tímto přístupem je nutné zadat hierarchický vztah mezi hello rozšíření a hello virtuální počítač s hello tooexplicitly *název* a *typ* hodnoty.</span><span class="sxs-lookup"><span data-stu-id="7044b-112">With this approach you have tooexplicitly specify a hierarchical relation between hello extension and hello virtual machine with hello *name* and *type* values.</span></span> <span data-ttu-id="7044b-113">Například:</span><span class="sxs-lookup"><span data-stu-id="7044b-113">For example:</span></span> 

    "name": "[concat(variables('vmName'),'Microsoft.Insights.VMDiagnosticsSettings')]",
    "type": "Microsoft.Compute/virtualMachines/extensions",

<span data-ttu-id="7044b-114">rozšíření Hello je vždy přidružený hello virtuálního počítače, můžete buď přímo přímo definovat uzlu prostředků hello virtuálního počítače nebo zadejte na základní úrovni hello a použít tooassociate hierarchické konvence pojmenování hello je s virtuálním hello počítač.</span><span class="sxs-lookup"><span data-stu-id="7044b-114">hello extension is always associated with hello virtual machine, you can either directly define it under hello virtual machine's resource node directly or define it at hello base level and use hello hierarchical naming convention tooassociate it with hello virtual machine.</span></span>

<span data-ttu-id="7044b-115">Konfigurace je pro rozšíření hello sady škálování virtuálního počítače zadaná v hello *extensionProfile* vlastnost hello *VirtualMachineProfile*.</span><span class="sxs-lookup"><span data-stu-id="7044b-115">For Virtual Machine Scale Sets hello extensions configuration is specified in hello *extensionProfile* property of hello *VirtualMachineProfile*.</span></span>

<span data-ttu-id="7044b-116">Hello *vydavatele* vlastnosti s hodnotou hello **Microsoft.Azure.Diagnostics** a hello *typ* vlastnosti s hodnotou hello **IaaSDiagnostics** jednoznačně rozšíření Azure Diagnostics hello.</span><span class="sxs-lookup"><span data-stu-id="7044b-116">hello *publisher* property with hello value of **Microsoft.Azure.Diagnostics** and hello *type* property with hello value of **IaaSDiagnostics** uniquely identify hello Azure Diagnostics extension.</span></span>

<span data-ttu-id="7044b-117">Hello hodnotu hello *název* vlastnost lze použít toorefer toohello rozšíření ve skupině prostředků hello.</span><span class="sxs-lookup"><span data-stu-id="7044b-117">hello value of hello *name* property can be used toorefer toohello extension in hello resource group.</span></span> <span data-ttu-id="7044b-118">Nastavení se konkrétně příliš**Microsoft.Insights.VMDiagnosticsSettings** ho povolí toobe snadno identifikovaný hello zajistit, portálu Azure, který hello monitorování grafy se zobrazí správně v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="7044b-118">Setting it specifically too**Microsoft.Insights.VMDiagnosticsSettings** will enable it toobe easily identified by hello Azure portal ensuring that hello monitoring charts show up correctly in hello Azure portal.</span></span>

<span data-ttu-id="7044b-119">Hello *typeHandlerVersion* Určuje verzi hello hello rozšíření chcete toouse.</span><span class="sxs-lookup"><span data-stu-id="7044b-119">hello *typeHandlerVersion* specifies hello version of hello extension you would like toouse.</span></span> <span data-ttu-id="7044b-120">Nastavení *autoUpgradeMinorVersion* příliš malé verze**true** zajistí, že dostanete nejnovější dílčí verzi hello hello rozšíření, která je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="7044b-120">Setting *autoUpgradeMinorVersion* minor version too**true** ensures that you will get hello latest Minor version of hello extension that is available.</span></span> <span data-ttu-id="7044b-121">Důrazně doporučujeme vždy nastavit *autoUpgradeMinorVersion* tooalways být **true** , abyste měli vždy toouse hello rozšíření na nejnovější dostupné diagnostiky se všemi hello nové funkce a chyb opravy.</span><span class="sxs-lookup"><span data-stu-id="7044b-121">It is highly recommended that you always set *autoUpgradeMinorVersion* tooalways be **true** so that you always get toouse hello latest available diagnostics extension with all hello new features and bug fixes.</span></span> 

<span data-ttu-id="7044b-122">Hello *nastavení* prvek obsahuje vlastnosti konfigurace hello rozšíření, která můžete nastavit a čtení zpět z rozšíření hello (někdy označují tooas veřejné konfigurace).</span><span class="sxs-lookup"><span data-stu-id="7044b-122">hello *settings* element contains configurations properties for hello extension that can be set and read back from hello extension (sometimes referred tooas public configuration).</span></span> <span data-ttu-id="7044b-123">Hello *xmlcfg* vlastnost obsahuje konfigurační soubor xml na základě protokolů diagnostiky hello, čítačích výkonu atd, které bude shromažďována agentem hello diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="7044b-123">hello *xmlcfg* property contains xml based configuration for hello diagnostics logs, performance counters etc that will be collected by hello diagnostics agent.</span></span> <span data-ttu-id="7044b-124">V tématu [schéma konfigurace diagnostiky](https://msdn.microsoft.com/library/azure/dn782207.aspx) Další informace o schématu xml hello, sám sebe.</span><span class="sxs-lookup"><span data-stu-id="7044b-124">See [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for more information about hello xml schema itself.</span></span> <span data-ttu-id="7044b-125">Běžnou praxí je toostore hello skutečné xml konfigurace jako base64 a proměnnou v hello šablony Azure Resource Manageru a pak zřetězení zakódovat je hodnota hello tooset *xmlcfg*.</span><span class="sxs-lookup"><span data-stu-id="7044b-125">A common practice is toostore hello actual xml configuration as a variable in hello Azure Resource Manager template and then concatenate and base64 encode them tooset hello value for *xmlcfg*.</span></span> <span data-ttu-id="7044b-126">Části hello na [proměnné konfigurace diagnostiky](#diagnostics-configuration-variables) toounderstand informace o tom, jak toostore hello kód xml v proměnné.</span><span class="sxs-lookup"><span data-stu-id="7044b-126">See hello section on [diagnostics configuration variables](#diagnostics-configuration-variables) toounderstand more about how toostore hello xml in variables.</span></span> <span data-ttu-id="7044b-127">Hello *storageAccount* vlastnost určuje název hello hello úložiště účet toowhich diagnostická data budou přeneseny.</span><span class="sxs-lookup"><span data-stu-id="7044b-127">hello *storageAccount* property specifies hello name of hello storage account toowhich diagnostics data will be transferred.</span></span> 

<span data-ttu-id="7044b-128">Hello vlastnosti v *protectedSettings* (někdy označují tooas privátní konfigurace) můžete nastavit, ale nemůže přečíst zpět po nastaveno.</span><span class="sxs-lookup"><span data-stu-id="7044b-128">hello properties in *protectedSettings* (sometimes referred tooas private configuration) can be set but cannot be read back after being set.</span></span> <span data-ttu-id="7044b-129">Hello jen pro zápis povaha *protectedSettings* je vhodná pro ukládání tajné klíče jako klíč účtu úložiště hello zápis hello diagnostická data.</span><span class="sxs-lookup"><span data-stu-id="7044b-129">hello write-only nature of *protectedSettings* makes it useful for storing secrets like hello storage account key where hello diagnostics data will be written.</span></span>    

## <a name="specifying-diagnostics-storage-account-as-parameters"></a><span data-ttu-id="7044b-130">Zadání účtu úložiště diagnostiky jako parametry</span><span class="sxs-lookup"><span data-stu-id="7044b-130">Specifying diagnostics storage account as parameters</span></span>
<span data-ttu-id="7044b-131">Hello diagnostiky rozšíření fragmentu kódu json výše předpokládá dva parametry *existingdiagnosticsStorageAccountName* a *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostiky účet úložiště, kde bude uložena diagnostická data.</span><span class="sxs-lookup"><span data-stu-id="7044b-131">hello diagnostics extension json snippet above assumes two parameters *existingdiagnosticsStorageAccountName* and *existingdiagnosticsStorageResourceGroup* toospecify hello diagnostics storage account where diagnostics data will be stored.</span></span> <span data-ttu-id="7044b-132">Zadání účtu úložiště diagnostiky hello jako parametr je účet úložiště diagnostiky hello snadno toochange různých prostředích například může být vhodné toouse účet úložiště různé diagnostiky pro testování a jinou pro vaše produkčním nasazení.</span><span class="sxs-lookup"><span data-stu-id="7044b-132">Specifying hello diagnostics storage account as a parameter makes it easy toochange hello diagnostics storage account across different environments e.g. you may want toouse a different diagnostics storage account for testing and a different one for your production deployment.</span></span>  

        "existingdiagnosticsStorageAccountName": {
            "type": "string",
            "metadata": {
        "description": "hello name of an existing storage account toowhich diagnostics data will be transfered."
            }        
        },
        "existingdiagnosticsStorageResourceGroup": {
            "type": "string",
            "metadata": {
        "description": "hello resource group for hello storage account specified in existingdiagnosticsStorageAccountName"
              }
        }

<span data-ttu-id="7044b-133">Je nejlepší postup toospecify účtu úložiště diagnostiky v jiné skupině prostředků než hello skupinu prostředků pro virtuální počítač hello.</span><span class="sxs-lookup"><span data-stu-id="7044b-133">It is best practice toospecify a diagnostics storage account in a different resource group than hello resource group for hello virtual machine.</span></span> <span data-ttu-id="7044b-134">Skupinu prostředků lze považovat za toobe jednotka nasazení se vlastní životnost, virtuální počítač můžete nasadit a znovu nasadit jako nové aktualizace konfigurace probíhají tooit ale může být vhodné toocontinue ukládání dat diagnostiky hello v hello stejný účet úložiště mezi tyto nasazení virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="7044b-134">A resource group can be considered toobe a deployment unit with its own lifetime, a virtual machine can be deployed and redeployed as new configurations updates are made it tooit but you may want toocontinue storing hello diagnostics data in hello same storage account across those virtual machine deployments.</span></span> <span data-ttu-id="7044b-135">S hello účet úložiště ve umožňuje jiného prostředku hello úložiště účet tooaccept data z různých nasazení virtuálních počítačů, takže je easy tootroubleshoot problémy napříč hello různých verzí.</span><span class="sxs-lookup"><span data-stu-id="7044b-135">Having hello storage account in a different resource enables hello storage account tooaccept data from various virtual machine deployments making it easy tootroubleshoot issues across hello various versions.</span></span>

> [!NOTE]
> <span data-ttu-id="7044b-136">Pokud vytvoříte šablonu virtuálního počítače windows ze sady Visual Studio hello výchozí účet úložiště může být nastaveno toouse hello stejný účet úložiště, kde je načtený hello pevný disk virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="7044b-136">If you create a windows virtual machine template from Visual Studio hello default storage account might be set toouse hello same storage account where hello virtual machine VHD is uploaded.</span></span> <span data-ttu-id="7044b-137">Toto je počáteční nastavení toosimplify hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="7044b-137">This is toosimplify initial setup of hello VM.</span></span> <span data-ttu-id="7044b-138">Je potřeba zvážit znovu hello šablony toouse jiný účet úložiště, může být předán jako parametr.</span><span class="sxs-lookup"><span data-stu-id="7044b-138">You should re-factor hello template toouse a different storage account that can be passed in as a parameter.</span></span> 
> 
> 

## <a name="diagnostics-configuration-variables"></a><span data-ttu-id="7044b-139">Proměnné konfigurace diagnostiky</span><span class="sxs-lookup"><span data-stu-id="7044b-139">Diagnostics configuration variables</span></span>
<span data-ttu-id="7044b-140">Definuje Hello diagnostiky rozšíření fragmentu kódu json výše *accountid* proměnné toosimplify získávání hello klíč účtu úložiště pro úložiště diagnostiky hello:</span><span class="sxs-lookup"><span data-stu-id="7044b-140">hello diagnostics extension json snippet above defines an *accountid* variable toosimplify getting hello storage account key for hello diagnostics storage:</span></span>   

    "accountid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/',parameters('existingdiagnosticsStorageResourceGroup'), '/providers/','Microsoft.Storage/storageAccounts/', parameters('existingdiagnosticsStorageAccountName'))]"


<span data-ttu-id="7044b-141">Hello *xmlcfg* vlastnost pro rozšíření diagnostiky hello je definovaná pomocí více proměnných, které jsou zřetězeny společně.</span><span class="sxs-lookup"><span data-stu-id="7044b-141">hello *xmlcfg* property for hello diagnostics extension is defined using multiple variables that are concatenated together.</span></span> <span data-ttu-id="7044b-142">Hello hodnoty těchto proměnných jsou ve formátu xml, proto potřebují toobe správně uvozeny zpětným lomítkem při nastavování hello json proměnné.</span><span class="sxs-lookup"><span data-stu-id="7044b-142">hello values of these variables are in xml so they need toobe escaped correctly when setting hello json variables.</span></span>

<span data-ttu-id="7044b-143">Hello následující text popisuje hello diagnostiky konfigurace xml, který shromažďuje čítače úrovně výkonu standardní systému spolu se některé protokoly událostí systému windows a protokolů diagnostiky infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="7044b-143">hello following describes hello diagnostics configuration xml that collects standard system level performance counters along with some windows event logs and diagnostics infrastructure logs.</span></span> <span data-ttu-id="7044b-144">Je uvozena a zda je správně naformátovaná tak, aby hello konfigurace lze přímo vložit do části hello proměnných šablony.</span><span class="sxs-lookup"><span data-stu-id="7044b-144">It has been escaped and formatted correctly so that hello configuration can directly be pasted into hello variables section of your template.</span></span> <span data-ttu-id="7044b-145">V tématu hello [schéma konfigurace diagnostiky](https://msdn.microsoft.com/library/azure/dn782207.aspx) více lidského čitelný příklad hello konfigurační soubor xml.</span><span class="sxs-lookup"><span data-stu-id="7044b-145">See hello [Diagnostics Configuration Schema](https://msdn.microsoft.com/library/azure/dn782207.aspx) for a more human readable example of hello configuration xml.</span></span>

        "wadlogs": "<WadCfg> <DiagnosticMonitorConfiguration overallQuotaInMB=\"4096\" xmlns=\"http://schemas.microsoft.com/ServiceHosting/2010/10/DiagnosticsConfiguration\"> <DiagnosticInfrastructureLogs scheduledTransferLogLevelFilter=\"Error\"/> <WindowsEventLog scheduledTransferPeriod=\"PT1M\" > <DataSource name=\"Application!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"Security!*[System[(Level = 1 or Level = 2)]]\" /> <DataSource name=\"System!*[System[(Level = 1 or Level = 2)]]\" /></WindowsEventLog>",
        "wadperfcounters1": "<PerformanceCounters scheduledTransferPeriod=\"PT1M\"><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Processor Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU utilization\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% Privileged Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU privileged time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor(_Total)\\% User Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"CPU user time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Processor Information(_Total)\\Processor Frequency\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"CPU frequency\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\System\\Processes\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Processes\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Thread Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Threads\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Process(_Total)\\Handle Count\" sampleRate=\"PT15S\" unit=\"Count\"><annotation displayName=\"Handles\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\% Committed Bytes In Use\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Memory usage\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Available Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory available\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Committed Bytes\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory committed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\Memory\\Commit Limit\" sampleRate=\"PT15S\" unit=\"Bytes\"><annotation displayName=\"Memory commit limit\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active time\" locale=\"en-us\"/></PerformanceCounterConfiguration>",
        "wadperfcounters2": "<PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Read Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active read time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\% Disk Write Time\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk active write time\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Transfers/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Reads/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk read operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Writes/sec\" sampleRate=\"PT15S\" unit=\"CountPerSecond\"><annotation displayName=\"Disk write operations\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Read Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk read speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\PhysicalDisk(_Total)\\Disk Write Bytes/sec\" sampleRate=\"PT15S\" unit=\"BytesPerSecond\"><annotation displayName=\"Disk write speed\" locale=\"en-us\"/></PerformanceCounterConfiguration><PerformanceCounterConfiguration counterSpecifier=\"\\LogicalDisk(_Total)\\% Free Space\" sampleRate=\"PT15S\" unit=\"Percent\"><annotation displayName=\"Disk free space (percentage)\" locale=\"en-us\"/></PerformanceCounterConfiguration></PerformanceCounters>",
        "wadcfgxstart": "[concat(variables('wadlogs'), variables('wadperfcounters1'), variables('wadperfcounters2'), '<Metrics resourceId=\"')]",
        "wadmetricsresourceid": "[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name , '/providers/', 'Microsoft.Compute/virtualMachines/')]",
        "wadcfgxend": "\"><MetricAggregation scheduledTransferPeriod=\"PT1H\"/><MetricAggregation scheduledTransferPeriod=\"PT1M\"/></Metrics></DiagnosticMonitorConfiguration></WadCfg>"

<span data-ttu-id="7044b-146">Hello metriky definice xml uzlu v hello výše konfigurace je důležité konfigurační element jako definuje, jak se čítače výkonu hello definované dříve v hello xml v *PerformanceCounter* uzlu budou seskupeny a uložené.</span><span class="sxs-lookup"><span data-stu-id="7044b-146">hello Metrics definition xml node in hello above configuration is an important configuration element as it defines how hello performance counters defined earlier in hello xml in *PerformanceCounter* node will be aggregated and stored.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="7044b-147">Tyto metriky jednotky hello monitorování grafů a výstrahy v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="7044b-147">These metrics drive hello monitoring charts and alerts in hello Azure portal.</span></span>  <span data-ttu-id="7044b-148">Hello **metriky** uzel s hello *resourceID* a **MetricAggregation** musí obsahovat hello konfigurace diagnostiky pro virtuální počítač, pokud chcete, aby toosee hello virtuálních počítačů data monitorování v hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="7044b-148">hello **Metrics** node with hello *resourceID* and **MetricAggregation** must be included in hello diagnostics configuration for your VM if you want toosee hello VM monitoring data in hello Azure portal.</span></span> 
> 
> 

<span data-ttu-id="7044b-149">Hello následuje příklad xml hello metriky definice:</span><span class="sxs-lookup"><span data-stu-id="7044b-149">hello following is an example of hello xml for metrics definitions:</span></span> 

        <Metrics resourceId="/subscriptions/subscription().subscriptionId/resourceGroups/resourceGroup().name/providers/Microsoft.Compute/virtualMachines/vmName">
            <MetricAggregation scheduledTransferPeriod="PT1H"/>
            <MetricAggregation scheduledTransferPeriod="PT1M"/>
        </Metrics>

<span data-ttu-id="7044b-150">Hello *resourceID* atribut jednoznačně identifikuje hello virtuálního počítače v rámci vašeho předplatného.</span><span class="sxs-lookup"><span data-stu-id="7044b-150">hello *resourceID* attribute uniquely identifies hello virtual machine in your subscription.</span></span> <span data-ttu-id="7044b-151">Ujistěte se, zda text hello subscription() toouse a resourceGroup() funguje tak, aby hello šablony automaticky aktualizuje tyto hodnoty podle hello předplatném nebo skupině prostředků, které nasazujete.</span><span class="sxs-lookup"><span data-stu-id="7044b-151">Make sure toouse hello subscription() and resourceGroup() functions so that hello template automatically updates those values based on hello subscription and resource group you are deploying to.</span></span>

<span data-ttu-id="7044b-152">Pokud vytvoříte více virtuálních počítačů ve smyčce, pak bude mít toopopulate hello *resourceID* hodnotu s toocorrectly funkce copyIndex() rozlišení jednotlivých jednotlivých virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="7044b-152">If you are creating multiple Virtual Machines in a loop then you will have toopopulate hello *resourceID* value with an copyIndex() function toocorrectly differentiate each individual VM.</span></span> <span data-ttu-id="7044b-153">Hello *xmlCfg* hodnota může být aktualizovaný toosupport to následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="7044b-153">hello *xmlCfg* value can be updated toosupport this as follows:</span></span>  

    "xmlCfg": "[base64(concat(variables('wadcfgxstart'), variables('wadmetricsresourceid'), concat(parameters('vmNamePrefix'), copyindex()), variables('wadcfgxend')))]", 

<span data-ttu-id="7044b-154">Hello hodnotu MetricAggregation *PT1H* a *PT1M* označily agregace za minutu a agregace přes hodinu.</span><span class="sxs-lookup"><span data-stu-id="7044b-154">hello MetricAggregation value of *PT1H* and *PT1M* signify an aggregation over a minute and an aggregation over an hour.</span></span>

## <a name="wadmetrics-tables-in-storage"></a><span data-ttu-id="7044b-155">WADMetrics tabulek v úložišti</span><span class="sxs-lookup"><span data-stu-id="7044b-155">WADMetrics tables in storage</span></span>
<span data-ttu-id="7044b-156">Konfigurace metriky Hello výše bude generovat tabulky ve vašem účtu úložiště diagnostiky s hello následující zásady vytváření názvů:</span><span class="sxs-lookup"><span data-stu-id="7044b-156">hello Metrics configuration above will generate tables in your diagnostics storage account with hello following naming conventions:</span></span>

* <span data-ttu-id="7044b-157">**WADMetrics** : standardní předponou pro všechny tabulky WADMetrics</span><span class="sxs-lookup"><span data-stu-id="7044b-157">**WADMetrics** : Standard prefix for all WADMetrics tables</span></span>
* <span data-ttu-id="7044b-158">**PT1H** nebo **PT1M** : označuje, že tabulka hello obsahuje agregovaná data více než 1 hodina nebo 1 minuta</span><span class="sxs-lookup"><span data-stu-id="7044b-158">**PT1H** or **PT1M** : Signifies that hello table contains aggregate data over 1 hour or 1 minute</span></span>
* <span data-ttu-id="7044b-159">**P10D** : označuje, že tabulka hello budou obsahovat data pro 10 dní od hello tabulky při spuštění, shromažďování dat</span><span class="sxs-lookup"><span data-stu-id="7044b-159">**P10D** : Signifies hello table will contain data for 10 days from when hello table started collecting data</span></span>
* <span data-ttu-id="7044b-160">**V2S** : řetězcová konstanta</span><span class="sxs-lookup"><span data-stu-id="7044b-160">**V2S** : String constant</span></span>
* <span data-ttu-id="7044b-161">**RRRRMMDD** : hello datum, na které hello tabulky shromažďování dat</span><span class="sxs-lookup"><span data-stu-id="7044b-161">**yyyymmdd** : hello date at which hello table started collecting data</span></span>

<span data-ttu-id="7044b-162">Příklad: *WADMetricsPT1HP10DV2S20151108* budou obsahovat data metriky agregovat přes hodinu 10 dní od 11. listopadu 2015</span><span class="sxs-lookup"><span data-stu-id="7044b-162">Example: *WADMetricsPT1HP10DV2S20151108* will contain metrics data aggregated over an hour for 10 days starting on 11-Nov-2015</span></span>    

<span data-ttu-id="7044b-163">Každá tabulka WADMetrics bude obsahovat hello následující sloupce:</span><span class="sxs-lookup"><span data-stu-id="7044b-163">Each WADMetrics table will contain hello following columns:</span></span>

* <span data-ttu-id="7044b-164">**PartitionKey**: hello partitionkey vytvořeným v závislosti na hello *resourceID* hodnotu toouniquely identifikovat hello prostředků virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="7044b-164">**PartitionKey**: hello partitionkey is constructed based on hello *resourceID* value toouniquely identify hello VM resource.</span></span> <span data-ttu-id="7044b-165">pro např: 002Fsubscriptions:<subscriptionID>: 002FresourceGroups:002F<ResourceGroupName>: 002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span><span class="sxs-lookup"><span data-stu-id="7044b-165">for e.g. : 002Fsubscriptions:<subscriptionID>:002FresourceGroups:002F<ResourceGroupName>:002Fproviders:002FMicrosoft:002ECompute:002FvirtualMachines:002F<vmName></span></span>  
* <span data-ttu-id="7044b-166">**RowKey** : formát hello způsobem <Descending time tick>:<Performance Counter Name>.</span><span class="sxs-lookup"><span data-stu-id="7044b-166">**RowKey** : Follows hello format <Descending time tick>:<Performance Counter Name>.</span></span> <span data-ttu-id="7044b-167">Hello sestupném značek výpočet doby je maximální doba rysky minus hello čas začátku hello hello agregace období.</span><span class="sxs-lookup"><span data-stu-id="7044b-167">hello descending time tick calculation is max time ticks minus hello time of hello beginning of hello aggregation period.</span></span> <span data-ttu-id="7044b-168">Například</span><span class="sxs-lookup"><span data-stu-id="7044b-168">E.g.</span></span> <span data-ttu-id="7044b-169">Pokud hello ukázka období spustit na 10. listopadu 2015 a 00:00Hrs UTC pak hello výpočtu by: DateTime.MaxValue.Ticks - (nové DateTime(2015,11,10,0,0,0,DateTimeKind.Utc). Rysky).</span><span class="sxs-lookup"><span data-stu-id="7044b-169">if hello sample period started on 10-Nov-2015 and 00:00Hrs UTC then hello calculation would be: DateTime.MaxValue.Ticks - (new DateTime(2015,11,10,0,0,0,DateTimeKind.Utc).Ticks).</span></span> <span data-ttu-id="7044b-170">Pro klíč řádku hello výkonu hello paměti bajty k dispozici čítače bude vypadat jako: 2519551871999999999__:005CMemory:005CAvailable:0020 bajtů</span><span class="sxs-lookup"><span data-stu-id="7044b-170">For hello memory available bytes performance counter hello row key will look like: 2519551871999999999__:005CMemory:005CAvailable:0020Bytes</span></span>
* <span data-ttu-id="7044b-171">**Název_čítače** : je hello název čítače výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="7044b-171">**CounterName** : Is hello name of hello performance counter.</span></span> <span data-ttu-id="7044b-172">To odpovídá hello *counterSpecifier* definované v hello xml konfigurace.</span><span class="sxs-lookup"><span data-stu-id="7044b-172">This matches hello *counterSpecifier* defined in hello xml config.</span></span>
* <span data-ttu-id="7044b-173">**Maximální** : hello maximální hodnota čítače výkonu hello období hello agregace.</span><span class="sxs-lookup"><span data-stu-id="7044b-173">**Maximum** : hello maximum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="7044b-174">**Minimální** : hello minimální hodnota čítače výkonu hello období hello agregace.</span><span class="sxs-lookup"><span data-stu-id="7044b-174">**Minimum** : hello minimum value of hello performance counter over hello aggregation period.</span></span>
* <span data-ttu-id="7044b-175">**Celkový počet** : hello součet všech hodnot čítač výkonu hello hlášené období hello agregace.</span><span class="sxs-lookup"><span data-stu-id="7044b-175">**Total** : hello sum of all values of hello performance counter reported over hello aggregation period.</span></span>
* <span data-ttu-id="7044b-176">**Počet** : Celkový počet hodnot hello hlášené pro čítač výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="7044b-176">**Count** : hello total number of values reported for hello performance counter.</span></span>
* <span data-ttu-id="7044b-177">**Průměrná** : hello průměr (celkem nebo počet) hodnota čítače výkonu hello období hello agregace.</span><span class="sxs-lookup"><span data-stu-id="7044b-177">**Average** : hello average (total/count) value of hello performance counter over hello aggregation period.</span></span>

## <a name="next-steps"></a><span data-ttu-id="7044b-178">Další kroky</span><span class="sxs-lookup"><span data-stu-id="7044b-178">Next Steps</span></span>
* <span data-ttu-id="7044b-179">Pro dokončení vzorové šablony z virtuálního počítače s Windows pomocí rozšíření diagnostiky najdete v části [201-vm monitorování--rozšíření diagnostiky](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span><span class="sxs-lookup"><span data-stu-id="7044b-179">For a complete sample template of a Windows virtual machine with diagnostics extension see [201-vm-monitoring-diagnostics-extension](https://github.com/Azure/azure-quickstart-templates/tree/master/201-vm-monitoring-diagnostics-extension)</span></span>   
* <span data-ttu-id="7044b-180">Nasazení pomocí šablony správce prostředků hello [prostředí Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) nebo [příkazového řádku Azure](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="7044b-180">Deploy hello resource manager template using [Azure PowerShell](ps-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json) or [Azure Command Line](../linux/create-ssh-secured-vm-from-template.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="7044b-181">Další informace o [vytváření šablon Azure Resource Manager](../../resource-group-authoring-templates.md)</span><span class="sxs-lookup"><span data-stu-id="7044b-181">Learn more about [authoring Azure Resource Manager templates](../../resource-group-authoring-templates.md)</span></span>


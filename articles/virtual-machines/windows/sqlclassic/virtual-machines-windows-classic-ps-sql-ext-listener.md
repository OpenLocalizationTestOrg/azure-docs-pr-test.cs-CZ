---
title: "Konfigurace o externí naslouchací proces pro skupiny dostupnosti Always On | Microsoft Docs"
description: "Tento kurz vás provede kroky k vytvoření vždy na naslouchací proces skupiny dostupnosti v Azure, které je externě přístupné pomocí veřejná virtuální IP adresy přidružené cloudové služby."
services: virtual-machines-windows
documentationcenter: na
author: MikeRayMSFT
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: a2453032-94ab-4775-b976-c74d24716728
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 05/31/2017
ms.author: mikeray
ms.openlocfilehash: 8e506be42aea4fb3c48c29b771a78dcf694f4518
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="configure-an-external-listener-for-always-on-availability-groups-in-azure"></a><span data-ttu-id="d4112-103">Konfigurace o externí naslouchací proces pro skupiny dostupnosti Always On v Azure</span><span class="sxs-lookup"><span data-stu-id="d4112-103">Configure an external listener for Always On Availability Groups in Azure</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="d4112-104">Interní naslouchací proces</span><span class="sxs-lookup"><span data-stu-id="d4112-104">Internal Listener</span></span>](../classic/ps-sql-int-listener.md)
> * [<span data-ttu-id="d4112-105">Externí naslouchací proces</span><span class="sxs-lookup"><span data-stu-id="d4112-105">External Listener</span></span>](../classic/ps-sql-ext-listener.md)
> 
> 

<span data-ttu-id="d4112-106">Toto téma ukazuje, jak nakonfigurovat naslouchací proces pro vždy na skupiny dostupnosti, která je přístupná externě na Internetu.</span><span class="sxs-lookup"><span data-stu-id="d4112-106">This topic shows you how to configure a listener for an Always On Availability Group that is externally accessible on the internet.</span></span> <span data-ttu-id="d4112-107">To je umožněno díky přidružení cloudové službě **veřejná virtuální IP (VIP)** adresu naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="d4112-107">This is made possible by associating the cloud service's **public Virtual IP (VIP)** address with the listener.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="d4112-108">Azure má dva různé modely nasazení pro vytváření a práci s prostředky: [Resource Manager a klasický](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="d4112-108">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="d4112-109">Tento článek se zabývá pomocí modelu nasazení Classic.</span><span class="sxs-lookup"><span data-stu-id="d4112-109">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="d4112-110">Microsoft doporučuje, aby byl ve většině nových nasazení použit model Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="d4112-110">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="d4112-111">Vaší skupiny dostupnosti může obsahovat replik, které jsou pouze, místní, Azure nebo span místní a Azure pro hybridní konfigurace.</span><span class="sxs-lookup"><span data-stu-id="d4112-111">Your Availability Group can contain replicas that are on-premises only, Azure only, or span both on-premises and Azure for hybrid configurations.</span></span> <span data-ttu-id="d4112-112">Azure repliky mohou být uloženy ve stejné oblasti nebo nad několika oblastmi pomocí více virtuálních sítí (virtuální sítě).</span><span class="sxs-lookup"><span data-stu-id="d4112-112">Azure replicas can reside within the same region or across multiple regions using multiple virtual networks (VNets).</span></span> <span data-ttu-id="d4112-113">Následující postup předpokládá, že už máte [nakonfigurovat skupinu dostupnosti](../classic/portal-sql-alwayson-availability-groups.md) ale nenakonfigurovali naslouchací proces.</span><span class="sxs-lookup"><span data-stu-id="d4112-113">The steps below assume you have already [configured an availability group](../classic/portal-sql-alwayson-availability-groups.md) but have not configured a listener.</span></span>

## <a name="guidelines-and-limitations-for-external-listeners"></a><span data-ttu-id="d4112-114">Pokyny a omezení pro externí naslouchací procesy</span><span class="sxs-lookup"><span data-stu-id="d4112-114">Guidelines and limitations for external listeners</span></span>
<span data-ttu-id="d4112-115">Všimněte si následující pokyny o naslouchacího procesu skupiny dostupnosti v Azure při nasazení pomocí adresy stydké VIP cloudové služby:</span><span class="sxs-lookup"><span data-stu-id="d4112-115">Note the following guidelines about the availability group listener in Azure when you are deploying using the cloud service pubic VIP address:</span></span>

* <span data-ttu-id="d4112-116">Naslouchací proces skupiny dostupnosti je podporován v systému Windows Server 2008 R2, Windows Server 2012 a Windows Server 2012 R2.</span><span class="sxs-lookup"><span data-stu-id="d4112-116">The availability group listener is supported on Windows Server 2008 R2, Windows Server 2012, and Windows Server 2012 R2.</span></span>
* <span data-ttu-id="d4112-117">Klientská aplikace se musí nacházet v jiné cloudové službě než ten, který obsahuje vaší skupiny dostupnosti virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="d4112-117">The client application must reside on a different cloud service than the one that contains your availability group VMs.</span></span> <span data-ttu-id="d4112-118">Azure nepodporuje přímá odpověď ze serveru s klientem a serverem v rámci stejné cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="d4112-118">Azure does not support direct server return with client and server in the same cloud service.</span></span>
* <span data-ttu-id="d4112-119">Ve výchozím kroky v tomto článku ukazují, jak nakonfigurovat jeden naslouchací proces použít adresu cloudové služby virtuální IP (VIP).</span><span class="sxs-lookup"><span data-stu-id="d4112-119">By default, the steps in this article show how to configure one listener to use the cloud service Virtual IP (VIP) address.</span></span> <span data-ttu-id="d4112-120">Nicméně je možné vyhradit a vytvořte více VIP adres pro cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="d4112-120">However, it is possible to reserve and create multiple VIP addresses for your cloud service.</span></span> <span data-ttu-id="d4112-121">Můžete vytvořit více naslouchací procesy, které se každý souvisejí s jinou virtuální IP adresy pomocí kroků v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="d4112-121">This enables you to use the steps in this article to create multiple listeners that are each associated with a different VIP.</span></span> <span data-ttu-id="d4112-122">Informace o tom, jak vytvořit více virtuálních IP adres najdete v tématu [několika virtuálními IP adresami za cloudové služby](../../../load-balancer/load-balancer-multivip.md).</span><span class="sxs-lookup"><span data-stu-id="d4112-122">For information on how to create multiple VIP addresses, see [Multiple VIPs per cloud service](../../../load-balancer/load-balancer-multivip.md).</span></span>
* <span data-ttu-id="d4112-123">Pokud chcete vytvořit naslouchací proces pro hybridní prostředí, do místní sítě musí mít připojení k veřejnému Internetu kromě site-to-site VPN s virtuální síť Azure.</span><span class="sxs-lookup"><span data-stu-id="d4112-123">If you are creating a listener for a hybrid environment, the on-premises network must have connectivity to the public Internet in addition to the site-to-site VPN with the Azure virtual network.</span></span> <span data-ttu-id="d4112-124">V podsíti Azure, je dostupná pouze pro veřejnou IP adresu odpovídající cloudové služby naslouchacího procesu skupiny dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="d4112-124">When in the Azure subnet, the availability group listener is reachable only by the public IP address of the respective cloud service.</span></span>
* <span data-ttu-id="d4112-125">Není možné vytvořit o externí naslouchací proces ve stejné cloudové služby, kde máte také naslouchací proces interní pomocí interní nástroj pro vyrovnávání zatížení (ILB).</span><span class="sxs-lookup"><span data-stu-id="d4112-125">It is not supported to create an external listener in the same cloud service where you also have an internal listener using the Internal Load Balancer (ILB).</span></span>

## <a name="determine-the-accessibility-of-the-listener"></a><span data-ttu-id="d4112-126">Určení usnadnění naslouchacího procesu</span><span class="sxs-lookup"><span data-stu-id="d4112-126">Determine the accessibility of the listener</span></span>
[!INCLUDE [ag-listener-accessibility](../../../../includes/virtual-machines-ag-listener-determine-accessibility.md)]

<span data-ttu-id="d4112-127">Tento článek se zaměřuje na tvorbu naslouchací proces, který používá **Vyrovnávání zatížení externí**.</span><span class="sxs-lookup"><span data-stu-id="d4112-127">This article focuses on creating a listener that uses **external load balancing**.</span></span> <span data-ttu-id="d4112-128">Pokud chcete naslouchací proces, který je privátní k virtuální síti, najdete v části verzi tohoto článku, který obsahuje postup pro nastavení [naslouchací proces s ILB](../classic/ps-sql-int-listener.md)</span><span class="sxs-lookup"><span data-stu-id="d4112-128">If you want a listener that is private to your virtual network, see the version of this article that provides steps for setting up an [listener with ILB](../classic/ps-sql-int-listener.md)</span></span>

## <a name="create-load-balanced-vm-endpoints-with-direct-server-return"></a><span data-ttu-id="d4112-129">Vytvoření koncové body s vyrovnáváním zatížení virtuálních počítačů s přímý server návratový</span><span class="sxs-lookup"><span data-stu-id="d4112-129">Create load-balanced VM endpoints with direct server return</span></span>
<span data-ttu-id="d4112-130">Externí Vyrovnávání zatížení využívá virtuální veřejná virtuální IP adresa cloudové služby, který hostuje virtuální počítače.</span><span class="sxs-lookup"><span data-stu-id="d4112-130">External load balancing uses the virtual the public Virtual IP address of the cloud service that hosts your VMs.</span></span> <span data-ttu-id="d4112-131">Proto není nutné k vytváření a konfiguraci nástroje pro vyrovnávání zatížení v tomto případě.</span><span class="sxs-lookup"><span data-stu-id="d4112-131">So you do not need to create or configure the load balancer in this case.</span></span>

<span data-ttu-id="d4112-132">Koncový bod Vyrovnávání zatížení sítě je nutné vytvořit pro každý virtuální počítač Azure repliky hostování.</span><span class="sxs-lookup"><span data-stu-id="d4112-132">You must create a load-balanced endpoint for each VM hosting an Azure replica.</span></span> <span data-ttu-id="d4112-133">Pokud máte repliky v několika oblastech, každá replika pro danou oblast musí být v rámci stejné cloudové služby ve stejné virtuální síti.</span><span class="sxs-lookup"><span data-stu-id="d4112-133">If you have replicas in multiple regions, each replica for that region must be in the same cloud service in the same VNet.</span></span> <span data-ttu-id="d4112-134">Vytvoření skupiny dostupnosti replik, které jsou rozmístěny v několika oblastmi Azure vyžaduje konfiguraci více virtuálních sítí.</span><span class="sxs-lookup"><span data-stu-id="d4112-134">Creating Availability Group replicas that span multiple Azure regions requires configuring multiple VNets.</span></span> <span data-ttu-id="d4112-135">Další informace o konfiguraci křížové připojení virtuální sítě najdete v tématu [konfigurace virtuální sítě pro připojení k virtuální síti](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span><span class="sxs-lookup"><span data-stu-id="d4112-135">For more information on configuring cross VNet connectivity, see  [Configure VNet to VNet Connectivity](../../../vpn-gateway/virtual-networks-configure-vnet-to-vnet-connection.md).</span></span>

1. <span data-ttu-id="d4112-136">Na portálu Azure přejděte na každý virtuální počítač, který je hostitelem repliky a zobrazení podrobností.</span><span class="sxs-lookup"><span data-stu-id="d4112-136">In the Azure portal, navigate to each VM hosting a replica and view the details.</span></span>
2. <span data-ttu-id="d4112-137">Klikněte **koncové body** kartu pro každý z virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="d4112-137">Click the **Endpoints** tab for each of the VMs.</span></span>
3. <span data-ttu-id="d4112-138">Ověřte, zda **název** a **veřejný Port** naslouchacího procesu koncový bod, který chcete použít není již používán.</span><span class="sxs-lookup"><span data-stu-id="d4112-138">Verify that the **Name** and **Public Port** of the listener endpoint you want to use is not already in use.</span></span> <span data-ttu-id="d4112-139">V následujícím příkladu je název "MyEndpoint" a port je "1433".</span><span class="sxs-lookup"><span data-stu-id="d4112-139">In the example below, the name is “MyEndpoint” and the port is “1433”.</span></span>
4. <span data-ttu-id="d4112-140">Na místního klienta, stáhněte a nainstalujte [nejnovější modul PowerShell](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="d4112-140">On your local client, download and install [the latest PowerShell module](https://azure.microsoft.com/downloads/).</span></span>
5. <span data-ttu-id="d4112-141">Spusťte **prostředí Azure PowerShell**.</span><span class="sxs-lookup"><span data-stu-id="d4112-141">Launch **Azure PowerShell**.</span></span> <span data-ttu-id="d4112-142">Novou relaci prostředí PowerShell, je otevřené s Azure pro správu moduly načíst.</span><span class="sxs-lookup"><span data-stu-id="d4112-142">A new PowerShell session is opened with the Azure administrative modules loaded.</span></span>
6. <span data-ttu-id="d4112-143">Spustit **Get-AzurePublishSettingsFile**.</span><span class="sxs-lookup"><span data-stu-id="d4112-143">Run **Get-AzurePublishSettingsFile**.</span></span> <span data-ttu-id="d4112-144">Tato rutina vás přesměruje do prohlížeče a stáhněte soubor nastavení publikování do místního adresáře.</span><span class="sxs-lookup"><span data-stu-id="d4112-144">This cmdlet directs you to a browser to download a publish settings file to a local directory.</span></span> <span data-ttu-id="d4112-145">Budete vyzváni k zadání pověření přihlašování pro vaše předplatné Azure.</span><span class="sxs-lookup"><span data-stu-id="d4112-145">You may be prompted for your log-in credentials for your Azure subscription.</span></span>
7. <span data-ttu-id="d4112-146">Spustit **Import AzurePublishSettingsFile** příkazu s cestou soubor nastavení publikování, který jste stáhli:</span><span class="sxs-lookup"><span data-stu-id="d4112-146">Run the **Import-AzurePublishSettingsFile** command with the path of the publish settings file that you downloaded:</span></span>
   
        Import-AzurePublishSettingsFile -PublishSettingsFile <PublishSettingsFilePath>
   
    <span data-ttu-id="d4112-147">Po importu se soubor nastavení publikování, můžete spravovat vaše předplatné Azure v relaci prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d4112-147">Once the publish settings file is imported, you can manage your Azure subscription in the PowerShell session.</span></span>
    
1. <span data-ttu-id="d4112-148">Do textového editoru, zkopírujte níže uvedený skript prostředí PowerShell a nastavte hodnoty proměnné tak, aby odpovídaly vašemu prostředí (výchozí hodnoty byly zadány pro některé parametry).</span><span class="sxs-lookup"><span data-stu-id="d4112-148">Copy the PowerShell script below into a text editor and set the variable values to suit your environment (defaults have been provided for some parameters).</span></span> <span data-ttu-id="d4112-149">Všimněte si, že pokud vaše skupina dostupnosti zahrnuje oblasti Azure, musíte spustit skript jednou v každé datové centrum pro cloudové služby a uzly, které jsou umístěny ve stejné datové centrum.</span><span class="sxs-lookup"><span data-stu-id="d4112-149">Note that if your availability group spans Azure regions, you must run the script once in each datacenter for the cloud service and nodes that reside in that datacenter.</span></span>
   
        # Define variables
        $ServiceName = "<MyCloudService>" # the name of the cloud service that contains the availability group nodes
        $AGNodes = "<VM1>","<VM2>","<VM3>" # all availability group nodes containing replicas in the same cloud service, separated by commas
   
        # Configure a load balanced endpoint for each node in $AGNodes, with direct server return enabled
        ForEach ($node in $AGNodes)
        {
            Get-AzureVM -ServiceName $ServiceName -Name $node | Add-AzureEndpoint -Name "ListenerEndpoint" -Protocol "TCP" -PublicPort 1433 -LocalPort 1433 -LBSetName "ListenerEndpointLB" -ProbePort 59999 -ProbeProtocol "TCP" -DirectServerReturn $true | Update-AzureVM
        }

2. <span data-ttu-id="d4112-150">Jakmile jednou nastavíte proměnné, zkopírujte z textového editoru do relace prostředí Azure PowerShell ji spustit skript.</span><span class="sxs-lookup"><span data-stu-id="d4112-150">Once you have set the variables, copy the script from the text editor into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="d4112-151">Pokud stále zobrazuje řádku >>, zadejte zadejte znovu a ujistěte se, je skript spuštěn.</span><span class="sxs-lookup"><span data-stu-id="d4112-151">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>

## <a name="verify-that-kb2854082-is-installed-if-necessary"></a><span data-ttu-id="d4112-152">Ověřte, zda KB2854082 nainstalována v případě potřeby</span><span class="sxs-lookup"><span data-stu-id="d4112-152">Verify that KB2854082 is installed if necessary</span></span>
[!INCLUDE [kb2854082](../../../../includes/virtual-machines-ag-listener-kb2854082.md)]

## <a name="open-the-firewall-ports-in-availability-group-nodes"></a><span data-ttu-id="d4112-153">Otevřít porty brány firewall v uzlech skupiny dostupnosti</span><span class="sxs-lookup"><span data-stu-id="d4112-153">Open the firewall ports in availability group nodes</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-open-firewall.md)]

## <a name="create-the-availability-group-listener"></a><span data-ttu-id="d4112-154">Vytvoření naslouchacího procesu skupiny dostupnosti</span><span class="sxs-lookup"><span data-stu-id="d4112-154">Create the availability group listener</span></span>

<span data-ttu-id="d4112-155">Vytvořte naslouchací proces skupiny dostupnosti ve dvou krocích.</span><span class="sxs-lookup"><span data-stu-id="d4112-155">Create the availability group listener in two steps.</span></span> <span data-ttu-id="d4112-156">Nejprve vytvořte prostředek clusteru bodu přístupu klienta a nakonfigurovat závislosti.</span><span class="sxs-lookup"><span data-stu-id="d4112-156">First, create the client access point cluster resource and configure  dependencies.</span></span> <span data-ttu-id="d4112-157">Druhý nakonfigurujte prostředky clusteru pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="d4112-157">Second, configure the cluster resources with PowerShell.</span></span>

### <a name="create-the-client-access-point-and-configure-the-cluster-dependencies"></a><span data-ttu-id="d4112-158">Vytvořit klientský přístupový bod a nakonfigurovat závislosti clusteru</span><span class="sxs-lookup"><span data-stu-id="d4112-158">Create the client access point and configure the cluster dependencies</span></span>
[!INCLUDE [firewall](../../../../includes/virtual-machines-ag-listener-create-listener.md)]

### <a name="configure-the-cluster-resources-in-powershell"></a><span data-ttu-id="d4112-159">Konfigurace prostředků clusteru v prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="d4112-159">Configure the cluster resources in PowerShell</span></span>
1. <span data-ttu-id="d4112-160">Pro externí zátěže, musíte získat veřejnou virtuální IP adresu cloudové služby, který obsahuje repliky.</span><span class="sxs-lookup"><span data-stu-id="d4112-160">For external load balancing, you must obtain the public virtual IP address of the cloud service that contains your replicas.</span></span> <span data-ttu-id="d4112-161">Přihlaste se k portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="d4112-161">Log into the Azure portal.</span></span> <span data-ttu-id="d4112-162">Přejděte do cloudové služby, která obsahuje vaší skupiny dostupnosti virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="d4112-162">Navigate to the cloud service that contains your availability group VM.</span></span> <span data-ttu-id="d4112-163">Otevřete **řídicí panel** zobrazení.</span><span class="sxs-lookup"><span data-stu-id="d4112-163">Open the **Dashboard** view.</span></span>
2. <span data-ttu-id="d4112-164">Poznamenejte si adresu v části **veřejná virtuální IP (VIP) Adresa**.</span><span class="sxs-lookup"><span data-stu-id="d4112-164">Note the address shown under **Public Virtual IP (VIP) Address**.</span></span> <span data-ttu-id="d4112-165">Pokud vaše řešení zahrnuje virtuální sítě, můžete tento krok opakujte pro každou cloudovou službu, která obsahuje virtuální počítač, který je hostitelem repliky.</span><span class="sxs-lookup"><span data-stu-id="d4112-165">If your solution spans VNets, repeat this step for each cloud service that contains a VM that hosts a replica.</span></span>
3. <span data-ttu-id="d4112-166">Na jednom z virtuálních počítačů do textového editoru, zkopírujte níže uvedený skript prostředí PowerShell a nastavte proměnné na hodnoty, které jste si předtím poznamenali.</span><span class="sxs-lookup"><span data-stu-id="d4112-166">On one of the VMs, copy the PowerShell script below into a text editor and set the variables to the values you noted earlier.</span></span>
   
        # Define variables
        $ClusterNetworkName = "<ClusterNetworkName>" # the cluster network name (Use Get-ClusterNetwork on Windows Server 2012 of higher to find the name)
        $IPResourceName = "<IPResourceName>" # the IP Address resource name
        $CloudServiceIP = "<X.X.X.X>" # Public Virtual IP (VIP) address of your cloud service
   
        Import-Module FailoverClusters
   
        # If you are using Windows Server 2012 or higher, use the Get-Cluster Resource command. If you are using Windows Server 2008 R2, use the cluster res command. Both commands are commented out. Choose the one applicable to your environment and remove the # at the beginning of the line to convert the comment to an executable line of code.
   
        # Get-ClusterResource $IPResourceName | Set-ClusterParameter -Multiple @{"Address"="$CloudServiceIP";"ProbePort"="59999";"SubnetMask"="255.255.255.255";"Network"="$ClusterNetworkName";"OverrideAddressMatch"=1;"EnableDhcp"=0}
        # cluster res $IPResourceName /priv enabledhcp=0 overrideaddressmatch=1 address=$CloudServiceIP probeport=59999  subnetmask=255.255.255.255
4. <span data-ttu-id="d4112-167">Jednou jste nastavili proměnné, otevřete okno se zvýšenými oprávněními prostředí Windows PowerShell, pak zkopírujte skript z textového editoru a vložte do relace prostředí Azure PowerShell ji spustit.</span><span class="sxs-lookup"><span data-stu-id="d4112-167">Once you have set the variables, open an elevated Windows PowerShell window, then copy the script from the text editor and paste into your Azure PowerShell session to run it.</span></span> <span data-ttu-id="d4112-168">Pokud stále zobrazuje řádku >>, zadejte zadejte znovu a ujistěte se, je skript spuštěn.</span><span class="sxs-lookup"><span data-stu-id="d4112-168">If the prompt still shows >>, type ENTER again to make sure the script starts running.</span></span>
5. <span data-ttu-id="d4112-169">Tento postup opakujte pro každý virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="d4112-169">Repeat this on each VM.</span></span> <span data-ttu-id="d4112-170">Tento skript nakonfiguruje prostředků IP adresu s IP adresou cloudové služby a nastaví další parametry, jako je port testu.</span><span class="sxs-lookup"><span data-stu-id="d4112-170">This script configures the IP Address resource with the IP address of the cloud service and sets other parameters like the probe port.</span></span> <span data-ttu-id="d4112-171">Pokud IP adresa prostředků do online režimu, může pak reagovat dotazování na port testu z vyrovnávání zatížení koncového bodu v tomto kurzu vytvořili.</span><span class="sxs-lookup"><span data-stu-id="d4112-171">When the IP Address resource is brought online, it can then respond to the polling on the probe port from the load-balanced endpoint created earlier in this tutorial.</span></span>

## <a name="bring-the-listener-online"></a><span data-ttu-id="d4112-172">Přepněte naslouchací proces online</span><span class="sxs-lookup"><span data-stu-id="d4112-172">Bring the listener online</span></span>
[!INCLUDE [Bring-Listener-Online](../../../../includes/virtual-machines-ag-listener-bring-online.md)]

## <a name="follow-up-items"></a><span data-ttu-id="d4112-173">Položky následnou akci</span><span class="sxs-lookup"><span data-stu-id="d4112-173">Follow-up items</span></span>
[!INCLUDE [Follow-up](../../../../includes/virtual-machines-ag-listener-follow-up.md)]

## <a name="test-the-availability-group-listener-within-the-same-vnet"></a><span data-ttu-id="d4112-174">Testování naslouchacího procesu skupiny dostupnosti (v rámci stejné virtuální)</span><span class="sxs-lookup"><span data-stu-id="d4112-174">Test the availability group listener (within the same VNet)</span></span>
[!INCLUDE [Test-Listener-Within-VNET](../../../../includes/virtual-machines-ag-listener-test.md)]

## <a name="test-the-availability-group-listener-over-the-internet"></a><span data-ttu-id="d4112-175">Testování naslouchacího procesu skupiny dostupnosti (přes internet)</span><span class="sxs-lookup"><span data-stu-id="d4112-175">Test the availability group listener (over the internet)</span></span>
<span data-ttu-id="d4112-176">Chcete-li získat přístup k naslouchání z mimo virtuální síť, musíte používat vyrovnávání zatížení externí nebo veřejné (popsaný v tomto tématu) místo ILB, který je dostupný jenom z v rámci stejnou virtuální síť.</span><span class="sxs-lookup"><span data-stu-id="d4112-176">In order to access the listener from outside the virtual network, you must be using external/public load balancing (described in this topic) rather than ILB, which is only accesible within the same VNet.</span></span> <span data-ttu-id="d4112-177">V připojovacím řetězci zadejte název cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="d4112-177">In the connection string, you specify the cloud service name.</span></span> <span data-ttu-id="d4112-178">Například pokud jste měli cloudové služby s názvem *mycloudservice*, sqlcmd příkaz vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="d4112-178">For example, if you had a cloud service with the name *mycloudservice*, the sqlcmd statement would be as follows:</span></span>

    sqlcmd -S "mycloudservice.cloudapp.net,<EndpointPort>" -d "<DatabaseName>" -U "<LoginId>" -P "<Password>"  -Q "select @@servername, db_name()" -l 15

<span data-ttu-id="d4112-179">Na rozdíl od předchozí příklad musí být použít ověřování SQL, protože volající nelze použít ověřování systému windows přes internet.</span><span class="sxs-lookup"><span data-stu-id="d4112-179">Unlike the previous example, SQL authentication must be used, because the caller cannot use windows authentication over the internet.</span></span> <span data-ttu-id="d4112-180">Další informace najdete v tématu [vždy na skupiny dostupnosti ve virtuálním počítači Azure: případech připojení klienta](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4112-180">For more information, see [Always On Availability Group in Azure VM: Client Connectivity Scenarios](http://blogs.msdn.com/b/sqlcat/archive/2014/02/03/alwayson-availability-group-in-windows-azure-vm-client-connectivity-scenarios.aspx).</span></span> <span data-ttu-id="d4112-181">Když pomocí ověřování SQL. Ujistěte se, že můžete vytvořit stejnou přihlášení na obou replikách.</span><span class="sxs-lookup"><span data-stu-id="d4112-181">When using SQL authentication, make sure that you create the same login on both replicas.</span></span> <span data-ttu-id="d4112-182">Další informace o odstraňování potíží s přihlášení se skupinami dostupnosti najdete v tématu [mapování přihlášení nebo použití obsažené uživatele databáze SQL pro připojení k jiné repliky a mapovat do databází dostupnosti,](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span><span class="sxs-lookup"><span data-stu-id="d4112-182">For more information about troubleshooting logins with Availability Groups, see [How to map logins or use contained SQL database user to connect to other replicas and map to availability databases](http://blogs.msdn.com/b/alwaysonpro/archive/2014/02/19/how-to-map-logins-or-use-contained-sql-database-user-to-connect-to-other-replicas-and-map-to-availability-databases.aspx).</span></span>

<span data-ttu-id="d4112-183">Pokud jsou repliky Always On v různých podsítích, musí klienti zadat **MultisubnetFailover = True** v připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="d4112-183">If the Always On replicas are in different subnets, clients must specify **MultisubnetFailover=True** in the connection string.</span></span> <span data-ttu-id="d4112-184">Výsledkem pokusy o připojení paralelní replikami v různých podsítích.</span><span class="sxs-lookup"><span data-stu-id="d4112-184">This results in parallel connection attempts to replicas in the different subnets.</span></span> <span data-ttu-id="d4112-185">Všimněte si, že tento scénář zahrnuje nasazení mezi oblastmi vždy na skupiny dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="d4112-185">Note that this scenario includes a cross-region Always On Availability Group deployment.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d4112-186">Další kroky</span><span class="sxs-lookup"><span data-stu-id="d4112-186">Next steps</span></span>
[!INCLUDE [Listener-Next-Steps](../../../../includes/virtual-machines-ag-listener-next-steps.md)]


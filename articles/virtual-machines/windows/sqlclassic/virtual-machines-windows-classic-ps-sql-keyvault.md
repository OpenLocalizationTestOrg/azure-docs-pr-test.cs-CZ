---
title: "Trezor klíčů integraci se službou SQL Server na virtuálních počítačích Windows v Azure (klasický) | Microsoft Docs"
description: "Zjistěte, jak k automatizaci konfigurace systému SQL Server šifrování pro použití s Azure Key Vault. Toto téma vysvětluje, jak používat Azure Key Vault integrace s SQL serverem v modelu nasazení classic vytvořit virtuální počítače."
services: virtual-machines-windows
documentationcenter: 
author: rothja
manager: jhubbard
editor: 
tags: azure-service-management
ms.assetid: ab8d41a7-1971-4032-ab71-eb435c455dc1
ms.service: virtual-machines-sql
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: vm-windows-sql-server
ms.workload: iaas-sql-server
ms.date: 02/17/2017
ms.author: jroth
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 2a9ac5763bb934bd0646e47c3936f7bdd0d603b1
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-key-vault-integration-for-sql-server-on-azure-virtual-machines-classic"></a><span data-ttu-id="dee7a-104">Konfigurace integrace Azure Key Vault pro SQL Server na virtuálních počítačích Azure (klasický)</span><span class="sxs-lookup"><span data-stu-id="dee7a-104">Configure Azure Key Vault Integration for SQL Server on Azure Virtual Machines (Classic)</span></span>
> [!div class="op_single_selector"]
> * [<span data-ttu-id="dee7a-105">Resource Manager</span><span class="sxs-lookup"><span data-stu-id="dee7a-105">Resource Manager</span></span>](../sql/virtual-machines-windows-ps-sql-keyvault.md)
> * [<span data-ttu-id="dee7a-106">Classic</span><span class="sxs-lookup"><span data-stu-id="dee7a-106">Classic</span></span>](../classic/ps-sql-keyvault.md)
> 
> 

## <a name="overview"></a><span data-ttu-id="dee7a-107">Přehled</span><span class="sxs-lookup"><span data-stu-id="dee7a-107">Overview</span></span>
<span data-ttu-id="dee7a-108">Existuje více funkcí šifrování systému SQL Server, například [transparentní šifrování dat (šifrování TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [šifrování na úrovni sloupce (Vymazat)](https://msdn.microsoft.com/library/ms173744.aspx), a [zálohu šifrovacího](https://msdn.microsoft.com/library/dn449489.aspx).</span><span class="sxs-lookup"><span data-stu-id="dee7a-108">There are multiple SQL Server encryption features, such as [transparent data encryption (TDE)](https://msdn.microsoft.com/library/bb934049.aspx), [column level encryption (CLE)](https://msdn.microsoft.com/library/ms173744.aspx), and [backup encryption](https://msdn.microsoft.com/library/dn449489.aspx).</span></span> <span data-ttu-id="dee7a-109">Tyto formuláře šifrování vyžadovat ke správě a ukládání kryptografických klíčů, které používáte pro šifrování.</span><span class="sxs-lookup"><span data-stu-id="dee7a-109">These forms of encryption require you to manage and store the cryptographic keys you use for encryption.</span></span> <span data-ttu-id="dee7a-110">Službu službou Azure Key Vault (AZURE) slouží k vylepšení zabezpečení a správu tyto klíče v umístění zabezpečené a vysoce dostupné.</span><span class="sxs-lookup"><span data-stu-id="dee7a-110">The Azure Key Vault (AKV) service is designed to improve the security and management of these keys in a secure and highly available location.</span></span> <span data-ttu-id="dee7a-111">[Konektor služby serveru SQL](http://www.microsoft.com/download/details.aspx?id=45344) umožňuje serveru SQL pro použití těchto klíčů z Azure Key Vault.</span><span class="sxs-lookup"><span data-stu-id="dee7a-111">The [SQL Server Connector](http://www.microsoft.com/download/details.aspx?id=45344) enables SQL Server to use these keys from Azure Key Vault.</span></span>

> [!IMPORTANT] 
> <span data-ttu-id="dee7a-112">Azure má dva různé modely nasazení pro vytváření a práci s prostředky: [Resource Manager a klasický](../../../azure-resource-manager/resource-manager-deployment-model.md).</span><span class="sxs-lookup"><span data-stu-id="dee7a-112">Azure has two different deployment models for creating and working with resources: [Resource Manager and Classic](../../../azure-resource-manager/resource-manager-deployment-model.md).</span></span> <span data-ttu-id="dee7a-113">Tento článek se zabývá pomocí modelu nasazení Classic.</span><span class="sxs-lookup"><span data-stu-id="dee7a-113">This article covers using the Classic deployment model.</span></span> <span data-ttu-id="dee7a-114">Microsoft doporučuje, aby byl ve většině nových nasazení použit model Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="dee7a-114">Microsoft recommends that most new deployments use the Resource Manager model.</span></span>

<span data-ttu-id="dee7a-115">Pokud používáte systém SQL Server s místním počítačům, jsou [kroky, pomocí kterých můžete pro přístup k Azure Key Vault z vašeho místního počítače systému SQL Server](https://msdn.microsoft.com/library/dn198405.aspx).</span><span class="sxs-lookup"><span data-stu-id="dee7a-115">If you are running SQL Server with on-premises machines, there are [steps you can follow to access Azure Key Vault from your on-premises SQL Server machine](https://msdn.microsoft.com/library/dn198405.aspx).</span></span> <span data-ttu-id="dee7a-116">Ale pro SQL Server ve virtuálních počítačích Azure, můžete ušetřit čas pomocí *Azure Key Vault integrace* funkce.</span><span class="sxs-lookup"><span data-stu-id="dee7a-116">But for SQL Server in Azure VMs, you can save time by using the *Azure Key Vault Integration* feature.</span></span> <span data-ttu-id="dee7a-117">Pomocí několik rutin prostředí Azure PowerShell tuto funkci povolíte můžete automatizovat konfiguraci potřebné pro virtuální počítač SQL pro přístup k trezoru klíčů.</span><span class="sxs-lookup"><span data-stu-id="dee7a-117">With a few Azure PowerShell cmdlets to enable this feature, you can automate the configuration necessary for a SQL VM to access your key vault.</span></span>

<span data-ttu-id="dee7a-118">Pokud je tato funkce povolena, automaticky se nainstaluje konektor serveru SQL, nakonfiguruje zprostředkovatele EKM. pro přístup k Azure Key Vault a vytvoří pověření umožňují přístup k trezoru.</span><span class="sxs-lookup"><span data-stu-id="dee7a-118">When this feature is enabled, it automatically installs the SQL Server Connector, configures the EKM provider to access Azure Key Vault, and creates the credential to allow you to access your vault.</span></span> <span data-ttu-id="dee7a-119">Pokud zvážení kroky v dokumentaci k výše uvedených v místě, uvidíte, že tato funkce automatizuje kroky 2 a 3.</span><span class="sxs-lookup"><span data-stu-id="dee7a-119">If you looked at the steps in the previously mentioned on-premises documentation, you can see that this feature automates steps 2 and 3.</span></span> <span data-ttu-id="dee7a-120">Jediné, co by se stále potřeba udělat ručně je vytvoření trezoru klíčů a klíče.</span><span class="sxs-lookup"><span data-stu-id="dee7a-120">The only thing you would still need to do manually is to create the key vault and keys.</span></span> <span data-ttu-id="dee7a-121">Z tohoto místa se automatizované celé nastavení virtuálního počítače SQL.</span><span class="sxs-lookup"><span data-stu-id="dee7a-121">From there, the entire setup of your SQL VM is automated.</span></span> <span data-ttu-id="dee7a-122">Po dokončení této instalace této funkce můžete spustit příkazů T-SQL zahájíte šifrování databáze nebo zálohy běžným způsobem.</span><span class="sxs-lookup"><span data-stu-id="dee7a-122">Once this feature has completed this setup, you can execute T-SQL statements to begin encrypting your databases or backups as you normally would.</span></span>

[!INCLUDE [AKV Integration Prepare](../../../../includes/virtual-machines-sql-server-akv-prepare.md)]

## <a name="configure-akv-integration"></a><span data-ttu-id="dee7a-123">Konfigurace integrace se službou AZURE</span><span class="sxs-lookup"><span data-stu-id="dee7a-123">Configure AKV Integration</span></span>
<span data-ttu-id="dee7a-124">Konfigurace Azure Key Vault integrace pomocí prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="dee7a-124">Use PowerShell to configure Azure Key Vault Integration.</span></span> <span data-ttu-id="dee7a-125">Následující části obsahují přehled požadované parametry a potom ukázkový skript PowerShell.</span><span class="sxs-lookup"><span data-stu-id="dee7a-125">The following sections provide an overview of the required parameters and then a sample PowerShell script.</span></span>

### <a name="install-the-sql-server-iaas-extension"></a><span data-ttu-id="dee7a-126">Instalace rozšíření IaaS systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="dee7a-126">Install the SQL Server IaaS Extension</span></span>
<span data-ttu-id="dee7a-127">První, [nainstalovat rozšíření SQL Server IaaS](../classic/sql-server-agent-extension.md).</span><span class="sxs-lookup"><span data-stu-id="dee7a-127">First, [install the SQL Server IaaS Extension](../classic/sql-server-agent-extension.md).</span></span>

### <a name="understand-the-input-parameters"></a><span data-ttu-id="dee7a-128">Pochopení vstupní parametry</span><span class="sxs-lookup"><span data-stu-id="dee7a-128">Understand the input parameters</span></span>
<span data-ttu-id="dee7a-129">Následující tabulka uvádí parametrů požadovaných pro spuštění skriptu prostředí PowerShell v další části.</span><span class="sxs-lookup"><span data-stu-id="dee7a-129">The following table lists the parameters required to run the PowerShell script in the next section.</span></span>

| <span data-ttu-id="dee7a-130">Parametr</span><span class="sxs-lookup"><span data-stu-id="dee7a-130">Parameter</span></span> | <span data-ttu-id="dee7a-131">Popis</span><span class="sxs-lookup"><span data-stu-id="dee7a-131">Description</span></span> | <span data-ttu-id="dee7a-132">Příklad</span><span class="sxs-lookup"><span data-stu-id="dee7a-132">Example</span></span> |
| --- | --- | --- |
| <span data-ttu-id="dee7a-133">**$akvURL**</span><span class="sxs-lookup"><span data-stu-id="dee7a-133">**$akvURL**</span></span> |<span data-ttu-id="dee7a-134">**Adresa URL trezoru klíčů**</span><span class="sxs-lookup"><span data-stu-id="dee7a-134">**The key vault URL**</span></span> |<span data-ttu-id="dee7a-135">"https://contosokeyvault.vault.azure.net/"</span><span class="sxs-lookup"><span data-stu-id="dee7a-135">"https://contosokeyvault.vault.azure.net/"</span></span> |
| <span data-ttu-id="dee7a-136">**$spName**</span><span class="sxs-lookup"><span data-stu-id="dee7a-136">**$spName**</span></span> |<span data-ttu-id="dee7a-137">**Hlavní název služby**</span><span class="sxs-lookup"><span data-stu-id="dee7a-137">**Service Principal name**</span></span> |<span data-ttu-id="dee7a-138">"fde2b411 - 33d 5-4e11-af04eb07b669ccf2"</span><span class="sxs-lookup"><span data-stu-id="dee7a-138">"fde2b411-33d5-4e11-af04eb07b669ccf2"</span></span> |
| <span data-ttu-id="dee7a-139">**$spSecret**</span><span class="sxs-lookup"><span data-stu-id="dee7a-139">**$spSecret**</span></span> |<span data-ttu-id="dee7a-140">**Tajný klíč objektu služby**</span><span class="sxs-lookup"><span data-stu-id="dee7a-140">**Service Principal secret**</span></span> |<span data-ttu-id="dee7a-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM ="</span><span class="sxs-lookup"><span data-stu-id="dee7a-141">"9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="</span></span> |
| <span data-ttu-id="dee7a-142">**$credName**</span><span class="sxs-lookup"><span data-stu-id="dee7a-142">**$credName**</span></span> |<span data-ttu-id="dee7a-143">**Název přihlašovacího údaje:** Integrace se službou Azure Key Vault vytvoří přihlašovací údaje v rámci SQL Serveru, díky čemuž mají virtuální počítače přístup do trezoru klíčů.</span><span class="sxs-lookup"><span data-stu-id="dee7a-143">**Credential name**: AKV Integration creates a credential within SQL Server, allowing the VM to have access to the key vault.</span></span> <span data-ttu-id="dee7a-144">Zvolte název pro tyto přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="dee7a-144">Choose a name for this credential.</span></span> |<span data-ttu-id="dee7a-145">"mycred1"</span><span class="sxs-lookup"><span data-stu-id="dee7a-145">"mycred1"</span></span> |
| <span data-ttu-id="dee7a-146">**$vmName**</span><span class="sxs-lookup"><span data-stu-id="dee7a-146">**$vmName**</span></span> |<span data-ttu-id="dee7a-147">**Název virtuálního počítače**: název vytvořeného virtuálního počítače s SQL.</span><span class="sxs-lookup"><span data-stu-id="dee7a-147">**Virtual machine name**: The name of a previously created SQL VM.</span></span> |<span data-ttu-id="dee7a-148">"myvmname"</span><span class="sxs-lookup"><span data-stu-id="dee7a-148">"myvmname"</span></span> |
| <span data-ttu-id="dee7a-149">**$serviceName**</span><span class="sxs-lookup"><span data-stu-id="dee7a-149">**$serviceName**</span></span> |<span data-ttu-id="dee7a-150">**Název služby**: název cloudové služby, který je přidružený virtuální počítač SQL.</span><span class="sxs-lookup"><span data-stu-id="dee7a-150">**Service name**: The Cloud Service name that is associated with the SQL VM.</span></span> |<span data-ttu-id="dee7a-151">"mycloudservicename"</span><span class="sxs-lookup"><span data-stu-id="dee7a-151">"mycloudservicename"</span></span> |

### <a name="enable-akv-integration-with-powershell"></a><span data-ttu-id="dee7a-152">Povolení integrace se službou AZURE pomocí prostředí PowerShell</span><span class="sxs-lookup"><span data-stu-id="dee7a-152">Enable AKV Integration with PowerShell</span></span>
<span data-ttu-id="dee7a-153">**New-AzureVMSqlServerKeyVaultCredentialConfig** rutina vytvoří objekt konfigurace pro funkci Azure Key Vault integrace.</span><span class="sxs-lookup"><span data-stu-id="dee7a-153">The **New-AzureVMSqlServerKeyVaultCredentialConfig** cmdlet creates a configuration object for the Azure Key Vault Integration feature.</span></span> <span data-ttu-id="dee7a-154">**Set-AzureVMSqlServerExtension** konfiguruje Tato integrace s **KeyVaultCredentialSettings** parametr.</span><span class="sxs-lookup"><span data-stu-id="dee7a-154">The **Set-AzureVMSqlServerExtension** configures this integration with the **KeyVaultCredentialSettings** parameter.</span></span> <span data-ttu-id="dee7a-155">Následující kroky ukazují, jak používat tyto příkazy.</span><span class="sxs-lookup"><span data-stu-id="dee7a-155">The following steps show how to use these commands.</span></span>

1. <span data-ttu-id="dee7a-156">V prostředí Azure PowerShell nakonfigurujte nejprve vstupní parametry s konkrétní hodnoty, jak je popsáno v předchozí části tohoto tématu.</span><span class="sxs-lookup"><span data-stu-id="dee7a-156">In Azure PowerShell, first configure the input parameters with your specific values as described in the previous sections of this topic.</span></span> <span data-ttu-id="dee7a-157">Následující skript představuje příklad.</span><span class="sxs-lookup"><span data-stu-id="dee7a-157">The following script is an example.</span></span>
   
        $akvURL = "https://contosokeyvault.vault.azure.net/"
        $spName = "fde2b411-33d5-4e11-af04eb07b669ccf2"
        $spSecret = "9VTJSQwzlFepD8XODnzy8n2V01Jd8dAjwm/azF1XDKM="
        $credName = "mycred1"
        $vmName = "myvmname"
        $serviceName = "mycloudservicename"
2. <span data-ttu-id="dee7a-158">Potom pomocí následujícího skriptu ke konfiguraci a povolení integrace se službou AZURE.</span><span class="sxs-lookup"><span data-stu-id="dee7a-158">Then use the following script to configure and enable AKV Integration.</span></span>
   
        $secureakv =  $spSecret | ConvertTo-SecureString -AsPlainText -Force
        $akvs = New-AzureVMSqlServerKeyVaultCredentialConfig -Enable -CredentialName $credname -AzureKeyVaultUrl $akvURL -ServicePrincipalName $spName -ServicePrincipalSecret $secureakv
        Get-AzureVM -ServiceName $serviceName -Name $vmName | Set-AzureVMSqlServerExtension -KeyVaultCredentialSettings $akvs | Update-AzureVM

<span data-ttu-id="dee7a-159">Rozšíření agenta SQL IaaS aktualizuje virtuální počítač SQL tuto novou konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="dee7a-159">The SQL IaaS Agent Extension will update the SQL VM with this new configuration.</span></span>

[!INCLUDE [AKV Integration Next Steps](../../../../includes/virtual-machines-sql-server-akv-next-steps.md)]


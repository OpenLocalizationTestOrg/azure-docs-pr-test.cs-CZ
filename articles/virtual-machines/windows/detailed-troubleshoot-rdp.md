---
title: "Vzdálená plocha aaaDetailed odstraňování potíží v Azure | Microsoft Docs"
description: "Přečtěte si podrobné řešení potíží pro vzdálené plochy chyby, kde nemůžete tooa Windows virtuálních počítačů v Azure"
services: virtual-machines-windows
documentationcenter: 
author: genlin
manager: timlt
editor: 
tags: top-support-issue,azure-service-management,azure-resource-manager
keywords: "nelze připojit tooremote plochy, řešení potíží s vzdálené plochy, nemůže připojit ke vzdálené ploše, vzdálené plochy chyby, řešení potíží vzdálené plochy, potížích se vzdálenou plochou"
ms.assetid: 9da36f3d-30dd-44af-824b-8ce5ef07e5e0
ms.service: virtual-machines-windows
ms.workload: infrastructure-services
ms.tgt_pltfrm: vm-windows
ms.devlang: na
ms.topic: support-article
ms.date: 07/25/2017
ms.author: genli
ms.openlocfilehash: fcb0d06aa66b748f3ebbbbe3431471d3cbe7c60d
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="detailed-troubleshooting-steps-for-remote-desktop-connection-issues-toowindows-vms-in-azure"></a><span data-ttu-id="89a77-104">Podrobný postup řešení potíží pro připojení ke vzdálené ploše problémy tooWindows virtuálních počítačů v Azure</span><span class="sxs-lookup"><span data-stu-id="89a77-104">Detailed troubleshooting steps for remote desktop connection issues tooWindows VMs in Azure</span></span>
<span data-ttu-id="89a77-105">Tento článek obsahuje podrobný postup řešení potíží toodiagnose a opravte komplexní chyby Vzdálená plocha systému Windows Azure virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="89a77-105">This article provides detailed troubleshooting steps toodiagnose and fix complex Remote Desktop errors for Windows-based Azure virtual machines.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="89a77-106">tooeliminate hello více běžných chyb vzdálené plochy, ujistěte se, že tooread [hello základní článku Poradce při potížích pro vzdálenou plochu](troubleshoot-rdp-connection.md) než budete pokračovat.</span><span class="sxs-lookup"><span data-stu-id="89a77-106">tooeliminate hello more common Remote Desktop errors, make sure tooread [hello basic troubleshooting article for Remote Desktop](troubleshoot-rdp-connection.md) before proceeding.</span></span>

<span data-ttu-id="89a77-107">Může dojít ke vzdálené ploše chybovou zprávu, která není vypadat hello specifické chybové zprávy popsané v [hello základní Vzdálená plocha Průvodce odstraňováním potíží s](troubleshoot-rdp-connection.md).</span><span class="sxs-lookup"><span data-stu-id="89a77-107">You may encounter a Remote Desktop error message that does not resemble any of hello specific error messages covered in [hello basic Remote Desktop troubleshooting guide](troubleshoot-rdp-connection.md).</span></span> <span data-ttu-id="89a77-108">Postupujte podle těchto kroků toodetermine proč hello klienta vzdálené plochy (RDP) je služba protokolu RDP nelze tooconnect toohello na hello virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-108">Follow these steps toodetermine why hello Remote Desktop (RDP) client is unable tooconnect toohello RDP service on hello Azure VM.</span></span>

[!INCLUDE [learn-about-deployment-models](../../../includes/learn-about-deployment-models-both-include.md)]

<span data-ttu-id="89a77-109">Pokud potřebujete další pomoc v libovolném bodě v tomto článku, obraťte se na hello Azure odborníky na [hello MSDN Azure a hello Stack Overflow fóra](https://azure.microsoft.com/support/forums/).</span><span class="sxs-lookup"><span data-stu-id="89a77-109">If you need more help at any point in this article, you can contact hello Azure experts on [hello MSDN Azure and hello Stack Overflow forums](https://azure.microsoft.com/support/forums/).</span></span> <span data-ttu-id="89a77-110">Alternativně můžete také soubor incidentu podpory Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-110">Alternatively, you can also file an Azure support incident.</span></span> <span data-ttu-id="89a77-111">Přejděte toohello [podporu Azure lokality](https://azure.microsoft.com/support/options/) a klikněte na tlačítko **získat podporu**.</span><span class="sxs-lookup"><span data-stu-id="89a77-111">Go toohello [Azure Support site](https://azure.microsoft.com/support/options/) and click **Get Support**.</span></span> <span data-ttu-id="89a77-112">Informace o používání podporu Azure, najdete v tématu hello [Microsoft Azure Support – nejčastější dotazy](https://azure.microsoft.com/support/faq/).</span><span class="sxs-lookup"><span data-stu-id="89a77-112">For information about using Azure Support, read hello [Microsoft Azure Support FAQ](https://azure.microsoft.com/support/faq/).</span></span>

## <a name="components-of-a-remote-desktop-connection"></a><span data-ttu-id="89a77-113">Součásti připojení vzdálené plochy</span><span class="sxs-lookup"><span data-stu-id="89a77-113">Components of a Remote Desktop connection</span></span>
<span data-ttu-id="89a77-114">připojení ke vzdálené ploše podílí Hello následující součásti:</span><span class="sxs-lookup"><span data-stu-id="89a77-114">hello following components are involved in an RDP connection:</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_0.png)

<span data-ttu-id="89a77-115">Než budete pokračovat, může pomoci toomentally zkontrolujte, co se změnilo od hello poslední úspěšné připojení ke vzdálené ploše připojení toohello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="89a77-115">Before proceeding, it might help toomentally review what has changed since hello last successful Remote Desktop connection toohello VM.</span></span> <span data-ttu-id="89a77-116">Například:</span><span class="sxs-lookup"><span data-stu-id="89a77-116">For example:</span></span>

* <span data-ttu-id="89a77-117">Hello veřejnou IP adresu hello virtuálního počítače nebo hello cloudové služby, která obsahuje hello virtuálních počítačů (také nazývané hello virtuální IP adresy [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) se změnila.</span><span class="sxs-lookup"><span data-stu-id="89a77-117">hello public IP address of hello VM or hello cloud service containing hello VM (also called hello virtual IP address [VIP](https://en.wikipedia.org/wiki/Virtual_IP_address)) has changed.</span></span> <span data-ttu-id="89a77-118">Hello RDP selhání může být způsobeno vaší mezipaměti klienta DNS má stále hello *starou IP adresu* zaregistrovat pro název DNS hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-118">hello RDP failure could be because your DNS client cache still has hello *old IP address* registered for hello DNS name.</span></span> <span data-ttu-id="89a77-119">Vyprázdnění mezipaměti klienta DNS a zkuste se znovu připojit hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="89a77-119">Flush your DNS client cache and try connecting hello VM again.</span></span> <span data-ttu-id="89a77-120">Nebo se připojte přímo s novou VIP hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-120">Or try connecting directly with hello new VIP.</span></span>
* <span data-ttu-id="89a77-121">Používáte aplikace třetích stran toomanage vaše připojení ke vzdálené ploše místo použití hello připojení vygenerované hello portálu Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-121">You are using a third-party application toomanage your Remote Desktop connections instead of using hello connection generated by hello Azure portal.</span></span> <span data-ttu-id="89a77-122">Ověřte, že tato konfigurace aplikace hello zahrnuje hello správný port TCP pro hello provoz vzdálené plochy.</span><span class="sxs-lookup"><span data-stu-id="89a77-122">Verify that hello application configuration includes hello correct TCP port for hello Remote Desktop traffic.</span></span> <span data-ttu-id="89a77-123">Můžete zkontrolovat tento port pro klasické virtuální počítač v hello [portál Azure](https://portal.azure.com), kliknutím na nastavení hello Virtuálního počítače > Koncové body.</span><span class="sxs-lookup"><span data-stu-id="89a77-123">You can check this port for a classic virtual machine in hello [Azure portal](https://portal.azure.com), by clicking hello VM's Settings > Endpoints.</span></span>

## <a name="preliminary-steps"></a><span data-ttu-id="89a77-124">Předběžné kroky</span><span class="sxs-lookup"><span data-stu-id="89a77-124">Preliminary steps</span></span>
<span data-ttu-id="89a77-125">Před pokračováním toohello podrobné řešení problémů</span><span class="sxs-lookup"><span data-stu-id="89a77-125">Before proceeding toohello detailed troubleshooting,</span></span>

* <span data-ttu-id="89a77-126">Zkontrolujte stav hello hello virtuálního počítače v hello portál Azure pro všechny zřejmé problémy.</span><span class="sxs-lookup"><span data-stu-id="89a77-126">Check hello status of hello virtual machine in hello Azure portal for any obvious issues.</span></span>
* <span data-ttu-id="89a77-127">Postupujte podle hello [oprava rychlé kroky pro běžné chyby RDP v základním řešení problémů hello průvodce](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span><span class="sxs-lookup"><span data-stu-id="89a77-127">Follow hello [quick fix steps for common RDP errors in hello basic troubleshooting guide](troubleshoot-rdp-connection.md#quick-troubleshooting-steps).</span></span>

<span data-ttu-id="89a77-128">Zkuste se znovu připojit toohello virtuálního počítače prostřednictvím vzdálené plochy po provedení těchto kroků.</span><span class="sxs-lookup"><span data-stu-id="89a77-128">Try reconnecting toohello VM via Remote Desktop after these steps.</span></span>

## <a name="detailed-troubleshooting-steps"></a><span data-ttu-id="89a77-129">Podrobný poradce při potížích</span><span class="sxs-lookup"><span data-stu-id="89a77-129">Detailed troubleshooting steps</span></span>
<span data-ttu-id="89a77-130">klient vzdálené plochy Hello nemusí být možné tooreach hello služby Vzdálená plocha na hello virtuálního počítače Azure kvůli tooissues v hello následující zdroje:</span><span class="sxs-lookup"><span data-stu-id="89a77-130">hello Remote Desktop client may not be able tooreach hello Remote Desktop service on hello Azure VM due tooissues at hello following sources:</span></span>

* [<span data-ttu-id="89a77-131">Klient služby Vzdálená plocha počítače</span><span class="sxs-lookup"><span data-stu-id="89a77-131">Remote Desktop client computer</span></span>](#source-1-remote-desktop-client-computer)
* [<span data-ttu-id="89a77-132">Hraniční zařízení intranetu organizace</span><span class="sxs-lookup"><span data-stu-id="89a77-132">Organization intranet edge device</span></span>](#source-2-organization-intranet-edge-device)
* [<span data-ttu-id="89a77-133">Koncový bod služby v cloudu a přístup k seznamu řízení (ACL)</span><span class="sxs-lookup"><span data-stu-id="89a77-133">Cloud service endpoint and access control list (ACL)</span></span>](#source-3-cloud-service-endpoint-and-acl)
* [<span data-ttu-id="89a77-134">Skupiny zabezpečení sítě</span><span class="sxs-lookup"><span data-stu-id="89a77-134">Network security groups</span></span>](#source-4-network-security-groups)
* [<span data-ttu-id="89a77-135">Systém Windows Azure virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="89a77-135">Windows-based Azure VM</span></span>](#source-5-windows-based-azure-vm)

## <a name="source-1-remote-desktop-client-computer"></a><span data-ttu-id="89a77-136">Zdroj 1: Klient služby Vzdálená plocha počítače</span><span class="sxs-lookup"><span data-stu-id="89a77-136">Source 1: Remote Desktop client computer</span></span>
<span data-ttu-id="89a77-137">Ověřte, že váš počítač provádět Vzdálená plocha připojení tooanother místně, počítače se systémem Windows.</span><span class="sxs-lookup"><span data-stu-id="89a77-137">Verify that your computer can make Remote Desktop connections tooanother on-premises, Windows-based computer.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_1.png)

<span data-ttu-id="89a77-138">Pokud není, můžete zkontrolujte hello následující nastavení v počítači:</span><span class="sxs-lookup"><span data-stu-id="89a77-138">If you cannot, check for hello following settings on your computer:</span></span>

* <span data-ttu-id="89a77-139">Nastavení místní brány firewall, které blokuje provoz vzdálené plochy.</span><span class="sxs-lookup"><span data-stu-id="89a77-139">A local firewall setting that is blocking Remote Desktop traffic.</span></span>
* <span data-ttu-id="89a77-140">Místně nainstalován klientský software proxy serveru, který brání připojení ke vzdálené ploše.</span><span class="sxs-lookup"><span data-stu-id="89a77-140">Locally installed client proxy software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="89a77-141">Místně nainstalován software, který brání připojení ke vzdálené ploše monitorování sítě.</span><span class="sxs-lookup"><span data-stu-id="89a77-141">Locally installed network monitoring software that is preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="89a77-142">Jiné typy zabezpečení softwaru, které monitorování provozu nebo povolí nebo zakáže určité typy přenosů, který brání připojení ke vzdálené ploše.</span><span class="sxs-lookup"><span data-stu-id="89a77-142">Other types of security software that either monitor traffic or allow/disallow specific types of traffic that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="89a77-143">V těchto případech dočasně zakázat hello softwaru a zkuste to tooconnect tooan místním počítači přes vzdálenou plochu.</span><span class="sxs-lookup"><span data-stu-id="89a77-143">In all these cases, temporarily disable hello software and try tooconnect tooan on-premises computer via Remote Desktop.</span></span> <span data-ttu-id="89a77-144">Pokud můžete zjistit skutečný příčina hello tímto způsobem, pracujete s vaší sítě Správce toocorrect hello softwaru nastavení tooallow připojení ke vzdálené ploše.</span><span class="sxs-lookup"><span data-stu-id="89a77-144">If you can find out hello actual cause this way, work with your network administrator toocorrect hello software settings tooallow Remote Desktop connections.</span></span>

## <a name="source-2-organization-intranet-edge-device"></a><span data-ttu-id="89a77-145">Zdroj 2: Organizace intranetu hraniční zařízení</span><span class="sxs-lookup"><span data-stu-id="89a77-145">Source 2: Organization intranet edge device</span></span>
<span data-ttu-id="89a77-146">Ověřte, zda počítač přímo připojen toohello, které má Internet tooyour připojení ke vzdálené ploše virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-146">Verify that a computer directly connected toohello Internet can make Remote Desktop connections tooyour Azure virtual machine.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_2.png)

<span data-ttu-id="89a77-147">Pokud nemáte počítač, který je přímo připojený toohello Internetu, vytvoření a testování pomocí Azure nového virtuálního počítače v prostředku skupiny nebo cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="89a77-147">If you do not have a computer that is directly connected toohello Internet, create and test with a new Azure virtual machine in a resource group or cloud service.</span></span> <span data-ttu-id="89a77-148">Další informace najdete v tématu [vytvoření virtuálního počítače se systémem Windows v Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="89a77-148">For more information, see [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="89a77-149">Hello virtuálního počítače a skupiny prostředků hello nebo hello Cloudová služba, můžete odstranit po testu hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-149">You can delete hello virtual machine and hello resource group or hello cloud service, after hello test.</span></span>

<span data-ttu-id="89a77-150">Pokud je možné vytvořit připojení vzdálené plochy s počítačem přímo připojené toohello Internetu, zkontrolujte vaše organizace intranetu hraniční zařízení pro:</span><span class="sxs-lookup"><span data-stu-id="89a77-150">If you can create a Remote Desktop connection with a computer directly attached toohello Internet, check your organization intranet edge device for:</span></span>

* <span data-ttu-id="89a77-151">K interní firewall blokující toohello připojení HTTPS Internetu.</span><span class="sxs-lookup"><span data-stu-id="89a77-151">An internal firewall blocking HTTPS connections toohello Internet.</span></span>
* <span data-ttu-id="89a77-152">Proxy server, který brání připojení ke vzdálené ploše.</span><span class="sxs-lookup"><span data-stu-id="89a77-152">A proxy server preventing Remote Desktop connections.</span></span>
* <span data-ttu-id="89a77-153">Software spuštěný na zařízení ve vaší hraniční síti, která brání připojení ke vzdálené ploše monitorování sítě nebo zjišťování neoprávněných vniknutí.</span><span class="sxs-lookup"><span data-stu-id="89a77-153">Intrusion detection or network monitoring software running on devices in your edge network that is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="89a77-154">Spolupracovat s vaší správce toocorrect hello nastavení sítě vaší organizace intranetu hraniční zařízení tooallow založený na protokolu HTTPS vzdálené plochy připojení toohello Internetu.</span><span class="sxs-lookup"><span data-stu-id="89a77-154">Work with your network administrator toocorrect hello settings of your organization intranet edge device tooallow HTTPS-based Remote Desktop connections toohello Internet.</span></span>

## <a name="source-3-cloud-service-endpoint-and-acl"></a><span data-ttu-id="89a77-155">Zdroj 3: Koncový bod služby Cloud a seznamu ACL</span><span class="sxs-lookup"><span data-stu-id="89a77-155">Source 3: Cloud service endpoint and ACL</span></span>
<span data-ttu-id="89a77-156">Pro virtuální počítače vytvořené pomocí modelu nasazení Classic hello, ověřte, zda, jiný virtuální počítač Azure, která je v hello stejné cloudové služby nebo virtuální sítě můžete provést tooyour připojení ke vzdálené ploše virtuálního počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-156">For VMs created using hello Classic deployment model, verify that another Azure VM that is in hello same cloud service or virtual network can make Remote Desktop connections tooyour Azure VM.</span></span>

![](./media/detailed-troubleshoot-rdp/tshootrdp_3.png)

> [!NOTE]
> <span data-ttu-id="89a77-157">Pro virtuální počítače vytvořené ve službě Správce prostředků, přeskočte příliš[zdroj 4: skupin zabezpečení sítě](#source-4-network-security-groups).</span><span class="sxs-lookup"><span data-stu-id="89a77-157">For virtual machines created in Resource Manager, skip too[Source 4: Network Security Groups](#source-4-network-security-groups).</span></span>

<span data-ttu-id="89a77-158">Pokud jste jiný virtuální počítač v hello stejné cloudové služby nebo virtuální sítě, vytvořte ho.</span><span class="sxs-lookup"><span data-stu-id="89a77-158">If you do not have another virtual machine in hello same cloud service or virtual network, create one.</span></span> <span data-ttu-id="89a77-159">Postupujte podle kroků hello v [vytvoření virtuálního počítače se systémem Windows v Azure](../virtual-machines-windows-hero-tutorial.md).</span><span class="sxs-lookup"><span data-stu-id="89a77-159">Follow hello steps in [Create a virtual machine running Windows in Azure](../virtual-machines-windows-hero-tutorial.md).</span></span> <span data-ttu-id="89a77-160">Odstraňte hello testovací virtuální počítač po dokončení testu hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-160">Delete hello test virtual machine after hello test is completed.</span></span>

<span data-ttu-id="89a77-161">Pokud se můžete připojit přes vzdálenou plochu tooa virtuálního počítače v hello stejné cloudové služby nebo virtuální sítě, zkontrolujte tato nastavení:</span><span class="sxs-lookup"><span data-stu-id="89a77-161">If you can connect via Remote Desktop tooa virtual machine in hello same cloud service or virtual network, check for these settings:</span></span>

* <span data-ttu-id="89a77-162">konfigurace koncového bodu Hello přenosům vzdálené plochy na hello cílovém virtuálním počítači: hello privátní port TCP hello koncového bodu musí odpovídat portu TCP hello, na které hello naslouchá služby Vzdálená plocha Virtuálního počítače (výchozí hodnota je 3389).</span><span class="sxs-lookup"><span data-stu-id="89a77-162">hello endpoint configuration for Remote Desktop traffic on hello target VM: hello private TCP port of hello endpoint must match hello TCP port on which hello VM's Remote Desktop service is listening (default is 3389).</span></span>
* <span data-ttu-id="89a77-163">Hello seznamu ACL pro koncový bod provoz vzdálené plochy hello na cíli hello virtuálních počítačů: seznamy ACL umožňují toospecify povolené nebo zakázané příchozí přenosy z Internetu na základě jeho zdrojové IP adresy hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-163">hello ACL for hello Remote Desktop traffic endpoint on hello target VM: ACLs allow you toospecify allowed or denied incoming traffic from hello Internet based on its source IP address.</span></span> <span data-ttu-id="89a77-164">Nesprávně nakonfigurované seznamy ACL můžete zabránit příchozí vzdálené plochy provoz toohello koncový bod.</span><span class="sxs-lookup"><span data-stu-id="89a77-164">Misconfigured ACLs can prevent incoming Remote Desktop traffic toohello endpoint.</span></span> <span data-ttu-id="89a77-165">Zkontrolujte vaší tooensure seznamy ACL, který je povolen příchozí provoz z veřejné IP adresy proxy nebo jiný server edge.</span><span class="sxs-lookup"><span data-stu-id="89a77-165">Check your ACLs tooensure that incoming traffic from your public IP addresses of your proxy or other edge server is allowed.</span></span> <span data-ttu-id="89a77-166">Další informace najdete v tématu [co je seznamu pro řízení přístupu sítě (ACL)?](../../virtual-network/virtual-networks-acl.md)</span><span class="sxs-lookup"><span data-stu-id="89a77-166">For more information, see [What is a Network Access Control List (ACL)?](../../virtual-network/virtual-networks-acl.md)</span></span>

<span data-ttu-id="89a77-167">toocheck Pokud koncový bod hello je hello zdroj hello problém, odeberte hello aktuální koncový bod a vytvořte novou, výběrem náhodný port v hello rozsahu 49152 až 65535 pro externí port číslo hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-167">toocheck if hello endpoint is hello source of hello problem, remove hello current endpoint and create a new one, choosing a random port in hello range 49152–65535 for hello external port number.</span></span> <span data-ttu-id="89a77-168">Další informace najdete v tématu [jak tooset koncové body tooa virtuálního počítače](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span><span class="sxs-lookup"><span data-stu-id="89a77-168">For more information, see [How tooset up endpoints tooa virtual machine](classic/setup-endpoints.md?toc=%2fazure%2fvirtual-machines%2fwindows%2fclassic%2ftoc.json).</span></span>

## <a name="source-4-network-security-groups"></a><span data-ttu-id="89a77-169">Zdroje 4: Skupiny zabezpečení sítě</span><span class="sxs-lookup"><span data-stu-id="89a77-169">Source 4: Network Security Groups</span></span>
<span data-ttu-id="89a77-170">Skupiny zabezpečení sítě povolit podrobnější řízení povolené příchozí a odchozí přenosy.</span><span class="sxs-lookup"><span data-stu-id="89a77-170">Network Security Groups allow more granular control of allowed inbound and outbound traffic.</span></span> <span data-ttu-id="89a77-171">Můžete vytvořit pravidla pokrývání uzlů podsítě a cloudových služeb v virtuální sítě Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-171">You can create rules spanning subnets and cloud services in an Azure virtual network.</span></span>

<span data-ttu-id="89a77-172">Použití [IP tok ověření](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm Pokud pravidla v skupinu zabezpečení sítě blokuje tooor provoz z virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="89a77-172">Use [IP flow verify](../../network-watcher/network-watcher-check-ip-flow-verify-portal.md) tooconfirm if a rule in a Network Security Group is blocking traffic tooor from a virtual machine.</span></span> <span data-ttu-id="89a77-173">Můžete také zkontrolovat efektivní zabezpečení skupiny pravidel tooensure příchozí "Povolit" NSG pravidel existuje a prioritu pro RDP port (standardně 3389).</span><span class="sxs-lookup"><span data-stu-id="89a77-173">You can also review effective security group rules tooensure inbound "Allow" NSG rule exists and is prioritized for RDP port(default 3389).</span></span> <span data-ttu-id="89a77-174">Další informace najdete v tématu [tok provozu pomocí efektivní pravidla zabezpečení tootroubleshoot virtuálních počítačů](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span><span class="sxs-lookup"><span data-stu-id="89a77-174">For more information, see [Using Effective Security Rules tootroubleshoot VM traffic flow](../../virtual-network/virtual-network-nsg-troubleshoot-portal.md#using-effective-security-rules-to-troubleshoot-vm-traffic-flow).</span></span>

## <a name="source-5-windows-based-azure-vm"></a><span data-ttu-id="89a77-175">Zdroj 5: Založené na systému Windows virtuálního počítače Azure</span><span class="sxs-lookup"><span data-stu-id="89a77-175">Source 5: Windows-based Azure VM</span></span>
![](./media/detailed-troubleshoot-rdp/tshootrdp_5.png)

<span data-ttu-id="89a77-176">Postupujte podle pokynů hello v [v tomto článku](reset-rdp.md).</span><span class="sxs-lookup"><span data-stu-id="89a77-176">Follow hello instructions in [this article](reset-rdp.md).</span></span> <span data-ttu-id="89a77-177">Tento článek resetuje hello služby Vzdálená plocha na virtuálním počítači hello:</span><span class="sxs-lookup"><span data-stu-id="89a77-177">This article resets hello Remote Desktop service on hello virtual machine:</span></span>

* <span data-ttu-id="89a77-178">Povolte pravidlo výchozí brány Windows Firewall "Vzdálené plochy" hello (TCP port 3389).</span><span class="sxs-lookup"><span data-stu-id="89a77-178">Enable hello "Remote Desktop" Windows Firewall default rule (TCP port 3389).</span></span>
* <span data-ttu-id="89a77-179">Povolte připojení ke vzdálené ploše nastavením too0 hodnotu registru HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-179">Enable Remote Desktop connections by setting hello HKLM\System\CurrentControlSet\Control\Terminal Server\fDenyTSConnections registry value too0.</span></span>

<span data-ttu-id="89a77-180">Zkuste hello připojení z vašeho počítače znovu.</span><span class="sxs-lookup"><span data-stu-id="89a77-180">Try hello connection from your computer again.</span></span> <span data-ttu-id="89a77-181">Pokud jste stále nemůžete tooconnect přes vzdálenou plochu, zkontrolujte hello následující možné problémy:</span><span class="sxs-lookup"><span data-stu-id="89a77-181">If you are still not able tooconnect via Remote Desktop, check for hello following possible problems:</span></span>

* <span data-ttu-id="89a77-182">Hello služby Vzdálená plocha není spuštěna na cíli hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="89a77-182">hello Remote Desktop service is not running on hello target VM.</span></span>
* <span data-ttu-id="89a77-183">Hello služby Vzdálená plocha není naslouchá na portu TCP 3389.</span><span class="sxs-lookup"><span data-stu-id="89a77-183">hello Remote Desktop service is not listening on TCP port 3389.</span></span>
* <span data-ttu-id="89a77-184">Brána Windows Firewall nebo jiné místní brány firewall má odchozí pravidlo, které brání provoz vzdálené plochy.</span><span class="sxs-lookup"><span data-stu-id="89a77-184">Windows Firewall or another local firewall has an outbound rule that is preventing Remote Desktop traffic.</span></span>
* <span data-ttu-id="89a77-185">Zjišťování neoprávněných vniknutí nebo monitorování softwaru systémem hello virtuální počítač Azure sítě brání připojení ke vzdálené ploše.</span><span class="sxs-lookup"><span data-stu-id="89a77-185">Intrusion detection or network monitoring software running on hello Azure virtual machine is preventing Remote Desktop connections.</span></span>

<span data-ttu-id="89a77-186">Pro virtuální počítače vytvořené pomocí modelu nasazení classic hello můžete použít toohello vzdálené relace prostředí Azure PowerShell virtuální počítač Azure.</span><span class="sxs-lookup"><span data-stu-id="89a77-186">For VMs created using hello classic deployment model, you can use a remote Azure PowerShell session toohello Azure virtual machine.</span></span> <span data-ttu-id="89a77-187">Nejprve je třeba tooinstall certifikát pro cloudové služby hostování hello virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="89a77-187">First, you need tooinstall a certificate for hello virtual machine's hosting cloud service.</span></span> <span data-ttu-id="89a77-188">Přejděte příliš[tooAzure konfigurovat zabezpečení vzdáleného prostředí PowerShell přístup virtuálních počítačů](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) a stáhnout hello **InstallWinRMCertAzureVM.ps1** skriptu souboru tooyour místního počítače.</span><span class="sxs-lookup"><span data-stu-id="89a77-188">Go too[Configure Secure Remote PowerShell Access tooAzure Virtual Machines](http://gallery.technet.microsoft.com/scriptcenter/Configures-Secure-Remote-b137f2fe) and download hello **InstallWinRMCertAzureVM.ps1** script file tooyour local computer.</span></span>

<span data-ttu-id="89a77-189">Pokud jste to ještě neudělali, potom nainstalujte Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="89a77-189">Next, install Azure PowerShell if you haven't already.</span></span> <span data-ttu-id="89a77-190">V tématu [jak tooinstall a konfigurace prostředí Azure PowerShell](/powershell/azure/overview).</span><span class="sxs-lookup"><span data-stu-id="89a77-190">See [How tooinstall and configure Azure PowerShell](/powershell/azure/overview).</span></span>

<span data-ttu-id="89a77-191">Dále otevřete příkazový řádek prostředí Azure PowerShell a změňte hello aktuální toohello umístění složky hello **InstallWinRMCertAzureVM.ps1** souboru skriptu.</span><span class="sxs-lookup"><span data-stu-id="89a77-191">Next, open an Azure PowerShell command prompt and change hello current folder toohello location of hello **InstallWinRMCertAzureVM.ps1** script file.</span></span> <span data-ttu-id="89a77-192">toorun skript Azure PowerShell, musíte nastavit zásady správné spouštění hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-192">toorun an Azure PowerShell script, you must set hello correct execution policy.</span></span> <span data-ttu-id="89a77-193">Spustit hello **Get-ExecutionPolicy** příkaz toodetermine vaše aktuální úroveň zásad.</span><span class="sxs-lookup"><span data-stu-id="89a77-193">Run hello **Get-ExecutionPolicy** command toodetermine your current policy level.</span></span> <span data-ttu-id="89a77-194">Informace o nastavení odpovídající úroveň hello najdete v tématu [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span><span class="sxs-lookup"><span data-stu-id="89a77-194">For information about setting hello appropriate level, see [Set-ExecutionPolicy](https://technet.microsoft.com/library/hh849812.aspx).</span></span>

<span data-ttu-id="89a77-195">V dalším kroku zadat název vašeho předplatného Azure, hello název cloudové služby a název vašeho virtuálního počítače (odebrání hello < a > znaků) a potom spuštěním těchto příkazů.</span><span class="sxs-lookup"><span data-stu-id="89a77-195">Next, fill in your Azure subscription name, hello cloud service name, and your virtual machine name (removing hello < and > characters), and then run these commands.</span></span>

```powershell
$subscr="<Name of your Azure subscription>"
$serviceName="<Name of hello cloud service that contains hello target virtual machine>"
$vmName="<Name of hello target virtual machine>"
.\InstallWinRMCertAzureVM.ps1 -SubscriptionName $subscr -ServiceName $serviceName -Name $vmName
```

<span data-ttu-id="89a77-196">Můžete získat název správné předplatné hello hello *Název_předplatného* vlastnost hello zobrazení hello **Get-AzureSubscription** příkaz.</span><span class="sxs-lookup"><span data-stu-id="89a77-196">You can get hello correct subscription name from hello *SubscriptionName* property of hello display of hello **Get-AzureSubscription** command.</span></span> <span data-ttu-id="89a77-197">Název cloudové služby hello hello virtuálního počítače můžete získat z hello *ServiceName* sloupce v zobrazení hello hello **Get-AzureVM** příkaz.</span><span class="sxs-lookup"><span data-stu-id="89a77-197">You can get hello cloud service name for hello virtual machine from hello *ServiceName* column in hello display of hello **Get-AzureVM** command.</span></span>

<span data-ttu-id="89a77-198">Zkontrolujte, pokud máte hello nový certifikát.</span><span class="sxs-lookup"><span data-stu-id="89a77-198">Check if you have hello new certificate.</span></span> <span data-ttu-id="89a77-199">Otevřete modul snap-in Certifikáty pro aktuálního uživatele hello a zkontrolujte hello **Trusted Root Certification Authorities\Certificates** složky.</span><span class="sxs-lookup"><span data-stu-id="89a77-199">Open a Certificates snap-in for hello current user and look in hello **Trusted Root Certification Authorities\Certificates** folder.</span></span> <span data-ttu-id="89a77-200">Měli byste vidět certifikát s názvem DNS hello vaše cloudové služby v hello vydáno toocolumn (Příklad: cloudservice4testing.cloudapp.net).</span><span class="sxs-lookup"><span data-stu-id="89a77-200">You should see a certificate with hello DNS name of your cloud service in hello Issued toocolumn (example: cloudservice4testing.cloudapp.net).</span></span>

<span data-ttu-id="89a77-201">V dalším kroku spuštění vzdálené relace prostředí Azure PowerShell pomocí těchto příkazů.</span><span class="sxs-lookup"><span data-stu-id="89a77-201">Next, initiate a remote Azure PowerShell session by using these commands.</span></span>

```powershell
$uri = Get-AzureWinRMUri -ServiceName $serviceName -Name $vmName
$creds = Get-Credential
Enter-PSSession -ConnectionUri $uri -Credential $creds
```

<span data-ttu-id="89a77-202">Po zadání přihlašovacích údajů správce platný, měli byste vidět něco podobné toohello příkazového řádku Azure PowerShell následující:</span><span class="sxs-lookup"><span data-stu-id="89a77-202">After entering valid administrator credentials, you should see something similar toohello following Azure PowerShell prompt:</span></span>

```powershell
[cloudservice4testing.cloudapp.net]: PS C:\Users\User1\Documents>
```

<span data-ttu-id="89a77-203">první část Hello tuto výzvu je název vaší cloudové služby, který obsahuje hello cílovém virtuálním počítači, který může lišit od "cloudservice4testing.cloudapp.net".</span><span class="sxs-lookup"><span data-stu-id="89a77-203">hello first part of this prompt is your cloud service name that contains hello target VM, which could be different from "cloudservice4testing.cloudapp.net".</span></span> <span data-ttu-id="89a77-204">Teď můžete vydat služby tooinvestigate hello problémy uvedené příkazy prostředí Azure PowerShell pro tento cloud a opravte konfiguraci hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-204">You can now issue Azure PowerShell commands for this cloud service tooinvestigate hello problems mentioned and correct hello configuration.</span></span>

### <a name="toomanually-correct-hello-remote-desktop-services-listening-tcp-port"></a><span data-ttu-id="89a77-205">toomanually správné hello TCP port naslouchání služby Vzdálená plocha</span><span class="sxs-lookup"><span data-stu-id="89a77-205">toomanually correct hello Remote Desktop Services listening TCP port</span></span>
<span data-ttu-id="89a77-206">V hello vzdálené relace příkazového řádku Azure PowerShell spusťte tento příkaz.</span><span class="sxs-lookup"><span data-stu-id="89a77-206">At hello remote Azure PowerShell session prompt, run this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="89a77-207">Hello číslo_portu vlastnost ukazuje hello aktuální číslo portu.</span><span class="sxs-lookup"><span data-stu-id="89a77-207">hello PortNumber property shows hello current port number.</span></span> <span data-ttu-id="89a77-208">V případě potřeby změňte hello vzdálené plochy port číslo back tooits výchozí hodnotu (3389) pomocí tohoto příkazu.</span><span class="sxs-lookup"><span data-stu-id="89a77-208">If needed, change hello Remote Desktop port number back tooits default value (3389) by using this command.</span></span>

```powershell
Set-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber" -Value 3389
```

<span data-ttu-id="89a77-209">Ověřte, že hello port byl změněné too3389 pomocí tohoto příkazu.</span><span class="sxs-lookup"><span data-stu-id="89a77-209">Verify that hello port has been changed too3389 by using this command.</span></span>

```powershell
Get-ItemProperty -Path "HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" -Name "PortNumber"
```

<span data-ttu-id="89a77-210">Pomocí tohoto příkazu Ukončit hello vzdálenou relaci prostředí Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="89a77-210">Exit hello remote Azure PowerShell session by using this command.</span></span>

```powershell
Exit-PSSession
```

<span data-ttu-id="89a77-211">Ověřte, že tento hello koncový bod vzdálené plochy pro hello virtuálního počítače Azure také používá port TCP. 3398 jako svůj vnitřní port.</span><span class="sxs-lookup"><span data-stu-id="89a77-211">Verify that hello Remote Desktop endpoint for hello Azure VM is also using TCP port 3398 as its internal port.</span></span> <span data-ttu-id="89a77-212">Restartujte hello virtuální počítač Azure a zkuste to znovu připojení ke vzdálené ploše hello.</span><span class="sxs-lookup"><span data-stu-id="89a77-212">Restart hello Azure VM and try hello Remote Desktop connection again.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="89a77-213">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="89a77-213">Additional resources</span></span>
[<span data-ttu-id="89a77-214">Jak služba tooreset heslo nebo hello vzdálené plochy pro virtuální počítače s Windows</span><span class="sxs-lookup"><span data-stu-id="89a77-214">How tooreset a password or hello Remote Desktop service for Windows virtual machines</span></span>](reset-rdp.md)

[<span data-ttu-id="89a77-215">Jak tooinstall a konfigurace prostředí Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="89a77-215">How tooinstall and configure Azure PowerShell</span></span>](/powershell/azure/overview)

[<span data-ttu-id="89a77-216">Řešení potíží s Secure Shell (SSH) připojení tooa systémem Linux virtuálního počítače Azure</span><span class="sxs-lookup"><span data-stu-id="89a77-216">Troubleshoot Secure Shell (SSH) connections tooa Linux-based Azure virtual machine</span></span>](../linux/troubleshoot-ssh-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)

[<span data-ttu-id="89a77-217">Řešení potíží s přístup tooan aplikace běžící na virtuálním počítači Azure</span><span class="sxs-lookup"><span data-stu-id="89a77-217">Troubleshoot access tooan application running on an Azure virtual machine</span></span>](../linux/troubleshoot-app-connection.md?toc=%2fazure%2fvirtual-machines%2flinux%2ftoc.json)


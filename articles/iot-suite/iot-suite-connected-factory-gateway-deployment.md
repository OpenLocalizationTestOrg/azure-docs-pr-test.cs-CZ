---
title: "Nasazení připojené vytváření brány Azure IoT Suite | Microsoft Docs"
description: "K nasazení brány v systému Windows nebo Linux pro umožnění připojení k připojené objekt pro vytváření předkonfigurovaného řešení."
services: 
suite: iot-suite
documentationcenter: na
author: dominicbetts
manager: timlt
editor: 
ms.service: iot-suite
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/24/2017
ms.author: dobett
ms.openlocfilehash: b0e6ae705911d7c18643c77b7fe08fdffffa5eb1
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="deploy-a-gateway-on-windows-or-linux-for-the-connected-factory-preconfigured-solution"></a><span data-ttu-id="ac5d3-103">Nasazení brány v systému Windows nebo Linux připojené objekt pro vytváření předkonfigurovaného řešení</span><span class="sxs-lookup"><span data-stu-id="ac5d3-103">Deploy a gateway on Windows or Linux for the connected factory preconfigured solution</span></span>

<span data-ttu-id="ac5d3-104">Software, abyste mohli nasadit bránu pro připojené objekt pro vytváření předkonfigurovaného řešení má dvě součásti:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-104">The software required to deploy a gateway for the connected factory preconfigured solution has two components:</span></span>

* <span data-ttu-id="ac5d3-105">*OPC Proxy* naváže připojení ke službě IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-105">The *OPC Proxy* establishes a connection to IoT Hub.</span></span> <span data-ttu-id="ac5d3-106">*OPC Proxy* potom počká, než pro příkazy a ovládání zprávy z integrované OPC prohlížeče, který běží na portálu řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-106">The *OPC Proxy* then waits for command and control messages from the integrated OPC Browser that runs in the connected factory solution portal.</span></span>
* <span data-ttu-id="ac5d3-107">*OPC vydavatele* se připojuje k existující místní OPC UA servery a předává telemetrické zprávy z nich do služby IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-107">The *OPC Publisher* connects to existing on-premises OPC UA servers and forwards telemetry messages from them to IoT Hub.</span></span>

<span data-ttu-id="ac5d3-108">Obě součásti jsou open source a jsou k dispozici jako zdroj na Githubu a jako kontejnery Docker:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-108">Both components are open-source and are available as source on GitHub and as Docker containers:</span></span>

| <span data-ttu-id="ac5d3-109">GitHubu</span><span class="sxs-lookup"><span data-stu-id="ac5d3-109">GitHub</span></span> | <span data-ttu-id="ac5d3-110">DockerHub</span><span class="sxs-lookup"><span data-stu-id="ac5d3-110">DockerHub</span></span> |
| ------ | --------- |
| <span data-ttu-id="ac5d3-111">[Vydavatel OPC][lnk-publisher-github]</span><span class="sxs-lookup"><span data-stu-id="ac5d3-111">[OPC Publisher][lnk-publisher-github]</span></span> | <span data-ttu-id="ac5d3-112">[Vydavatel OPC][lnk-publisher-docker]</span><span class="sxs-lookup"><span data-stu-id="ac5d3-112">[OPC Publisher][lnk-publisher-docker]</span></span> |
| <span data-ttu-id="ac5d3-113">[OPC Proxy][lnk-proxy-github]</span><span class="sxs-lookup"><span data-stu-id="ac5d3-113">[OPC Proxy][lnk-proxy-github]</span></span> | <span data-ttu-id="ac5d3-114">[OPC Proxy][lnk-proxy-docker]</span><span class="sxs-lookup"><span data-stu-id="ac5d3-114">[OPC Proxy][lnk-proxy-docker]</span></span> |

<span data-ttu-id="ac5d3-115">Žádné veřejnou IP adresu nebo díry v bráně firewall brány jsou požadovány pro žádné komponenty.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-115">No public-facing IP address or holes in the gateway firewall are required for either component.</span></span> <span data-ttu-id="ac5d3-116">OPC Proxy a OPC vydavatele používat pouze odchozí porty 443 a 5671, 8883.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-116">The OPC Proxy and OPC Publisher use only outbound ports 443, 5671, and 8883.</span></span>

<span data-ttu-id="ac5d3-117">Kroky v tomto článku ukazují, jak nasadit bránu pomocí Docker na buď [Windows](#windows-deployment) nebo [Linux](#linux-deployment).</span><span class="sxs-lookup"><span data-stu-id="ac5d3-117">The steps in this article show you how to deploy a gateway using Docker on either [Windows](#windows-deployment) or [Linux](#linux-deployment).</span></span> <span data-ttu-id="ac5d3-118">Brána umožňuje připojení k připojené objekt pro vytváření předkonfigurovaného řešení.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-118">The gateway enables connectivity to the connected factory preconfigured solution.</span></span>

> [!NOTE]
> <span data-ttu-id="ac5d3-119">Software brány, který běží v kontejner Docker [Azure IoT Edge].</span><span class="sxs-lookup"><span data-stu-id="ac5d3-119">The gateway software that runs in the Docker container is [Azure IoT Edge].</span></span>

## <a name="windows-deployment"></a><span data-ttu-id="ac5d3-120">Nasazení systému Windows</span><span class="sxs-lookup"><span data-stu-id="ac5d3-120">Windows deployment</span></span>

> [!NOTE]
> <span data-ttu-id="ac5d3-121">Pokud ještě nemáte zařízení brány, Microsoft doporučuje že zakoupit komerční brány na jednom z našich partnerů.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-121">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="ac5d3-122">Přejděte [katalogu zařízení Azure IoT] seznam zařízení brány, které jsou kompatibilní s řešením připojené objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-122">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="ac5d3-123">Postupujte podle pokynů, které jsou součástí zařízení nastavit bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-123">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="ac5d3-124">Alternativně použijte následující pokyny k ruční nastavení jedné z vašich bran existující.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-124">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

### <a name="install-docker"></a><span data-ttu-id="ac5d3-125">Nainstalujte Docker</span><span class="sxs-lookup"><span data-stu-id="ac5d3-125">Install Docker</span></span>

<span data-ttu-id="ac5d3-126">Nainstalujte [Docker pro systém Windows] na zařízení brány se systémem Windows.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-126">Install [Docker for Windows] on your Windows-based gateway device.</span></span> <span data-ttu-id="ac5d3-127">Během instalace systému Windows Docker vyberte jednotku na počítači hostitele sdílet s Docker.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-127">During Windows Docker setup, select a drive on your host machine to share with Docker.</span></span> <span data-ttu-id="ac5d3-128">Následující snímek obrazovky ukazuje sdílení diskovou jednotku d v systému Windows:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-128">The following screenshot shows sharing the D drive on your Windows system:</span></span>

![Nainstalujte Docker][img-install-docker]

<span data-ttu-id="ac5d3-130">Pak vytvořte složku s názvem **docker** v kořenovém adresáři sdílené jednotky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-130">Then create a folder called **docker** in the root of the shared drive.</span></span>
<span data-ttu-id="ac5d3-131">Můžete také provést tento krok po instalaci dockerem **nastavení** nabídky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-131">You can also perform this step after installing docker from the **Settings** menu.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="ac5d3-132">Konfigurace brány</span><span class="sxs-lookup"><span data-stu-id="ac5d3-132">Configure the gateway</span></span>

1. <span data-ttu-id="ac5d3-133">Je nutné **iothubowner** připojovací řetězec sady Azure IoT Suite připojen objekt pro vytváření nasazení k dokončení nasazení brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-133">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="ac5d3-134">V [portál Azure], přejděte do služby IoT Hub ve skupině prostředků vytvořili při nasazení řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-134">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="ac5d3-135">Klikněte na tlačítko **zásady sdíleného přístupu** k přístupu **iothubowner** připojovací řetězec:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-135">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![Najděte připojovací řetězec služby IoT Hub][img-hub-connection]

    <span data-ttu-id="ac5d3-137">Kopírování **připojovací řetězec – primární klíč** hodnotu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-137">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="ac5d3-138">Konfigurace brány pro službu IoT Hub spuštěním moduly dvě brány **po** z příkazového řádku pomocí:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-138">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a command prompt with:</span></span>

    `docker run -it --rm -h <ApplicationName> -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="ac5d3-139">**&lt;ApplicationName&gt;**  je název vaší OPC UA vydavatele ve formátu **vydavatele.&lt; váš plně kvalifikovaný název domény&gt;**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-139">**&lt;ApplicationName&gt;** is the name to give to your OPC UA Publisher in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="ac5d3-140">Například, pokud objekt pro vytváření sítě se nazývá **myfactorynetwork.com**, **ApplicationName** hodnota je **publisher.myfactorynetwork.com**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-140">For example, if your factory network is called **myfactorynetwork.com**, the **ApplicationName** value is **publisher.myfactorynetwork.com**.</span></span>
    * <span data-ttu-id="ac5d3-141">**&lt;IoTHubOwnerConnectionString&gt;**  je **iothubowner** připojovacího řetězce, které jste zkopírovali v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-141">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="ac5d3-142">Tento připojovací řetězec se používá pouze v tomto kroku, nebudete ho potřebovat v následujících krocích:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-142">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="ac5d3-143">Použití namapované D:\\docker složky ( `-v` argument) později k uchování dva certifikáty X.509, které používají moduly brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-143">You use the mapped D:\\docker folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="ac5d3-144">Spusťte bránu</span><span class="sxs-lookup"><span data-stu-id="ac5d3-144">Run the gateway</span></span>

1. <span data-ttu-id="ac5d3-145">Restartujte bránu pomocí následujících příkazů:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-145">Restart the gateway using the following commands:</span></span>

    `docker run -it --rm -h <ApplicationName> --expose 62222 -p 62222:62222 -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v //D/docker:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v //D/docker:/shared -v //D/docker:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `docker run -it --rm -v //D/docker:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="ac5d3-146">Z bezpečnostních důvodů dva certifikáty X.509 uchovávané v D:\\docker složka obsahovat privátní klíč.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-146">For security reasons, the two X.509 certificates persisted in the D:\\docker folder contain the private key.</span></span> <span data-ttu-id="ac5d3-147">Omezit přístup do této složky na přihlašovací údaje (obvykle **správci**) můžete použít ke spuštění kontejner Docker.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-147">Limit access to this folder to the credentials (typically **Administrators**) you use to run the Docker container.</span></span> <span data-ttu-id="ac5d3-148">Klikněte pravým tlačítkem myši D:\\docker složky, vyberte **vlastnosti**, pak **zabezpečení**a potom **upravit**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-148">Right-click the D:\\docker folder, choose **Properties**, then **Security**, and then **Edit**.</span></span> <span data-ttu-id="ac5d3-149">Poskytnout **správci** úplné řízení a odeberte všechny ostatní:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-149">Give **Administrators** full control and remove everyone else:</span></span>

    ![Udělení oprávnění ke sdílené složce Docker][img-docker-share]

1. <span data-ttu-id="ac5d3-151">Ověřte připojení k síti.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-151">Verify network connectivity.</span></span> <span data-ttu-id="ac5d3-152">Z příkazového řádku, zadejte příkaz `ping publisher.<your fully qualified domain name>` na příkaz ping bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-152">From a command prompt, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="ac5d3-153">Pokud cíl nedostupný, přidejte IP adresu a název své brány do souboru hostitelů na bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-153">If the destination is unreachable, add the IP address and name of your gateway to the hosts file on your gateway.</span></span> <span data-ttu-id="ac5d3-154">Soubor hostitele je umístěn ve **Windows\\System32\\ovladače\\atd** složky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-154">The hosts file is located in the **Windows\\System32\\drivers\\etc** folder.</span></span>

1. <span data-ttu-id="ac5d3-155">Další pokuste se připojit k vydavateli pomocí místní OPC UA klienta se systémem na bráně.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-155">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="ac5d3-156">Adresa URL je koncový bod OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-156">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="ac5d3-157">Pokud nemáte klientem OPC UA, můžete stáhnout a použít [open-source OPC UA klienta].</span><span class="sxs-lookup"><span data-stu-id="ac5d3-157">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="ac5d3-158">Když byly úspěšně dokončeny tyto místní testy, přejdete **připojit vlastní OPC UA Server** na portálu řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-158">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="ac5d3-159">Zadejte adresu URL koncového bodu vydavatele (`tcp://publisher.<your fully qualified domain name>:62222`) a klikněte na tlačítko **Connect**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-159">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="ac5d3-160">Získat varování týkající se certifikátu a potom klikněte na **pokračovat.**</span><span class="sxs-lookup"><span data-stu-id="ac5d3-160">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="ac5d3-161">Další dojde k chybě vydavatele nebude důvěřovat webovému klientovi uživatelský Agent.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-161">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="ac5d3-162">Chcete-li tuto chybu vyřešit, zkopírujte **uživatelský Agent klienta webové** certifikátu z **D:\\docker\\odmítl certifikáty\\certifikátů** složku pro **D: \\docker\\uživatelský Agent aplikace\\certifikátů** složky na bráně.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-162">To resolve this error, copy the **UA Web Client** certificate from the **D:\\docker\\Rejected Certificates\\certs** folder to the **D:\\docker\\UA Applications\\certs** folder on the gateway.</span></span> <span data-ttu-id="ac5d3-163">Není nutné restartovat brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-163">You do not need to restart of the gateway.</span></span> <span data-ttu-id="ac5d3-164">Tento krok opakujte.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-164">Repeat this step.</span></span> <span data-ttu-id="ac5d3-165">Již se můžete připojit k bráně z cloudu a jste připraveni přidat servery OPC UA k řešení.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-165">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="ac5d3-166">Přidání serverů OPC UA</span><span class="sxs-lookup"><span data-stu-id="ac5d3-166">Add your OPC UA servers</span></span>

1. <span data-ttu-id="ac5d3-167">Vyhledejte **připojit vlastní OPC UA Server** na portálu řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-167">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="ac5d3-168">Postupujte stejným způsobem jako v předchozí části k vybudování důvěry mezi portál připojené objekt pro vytváření a OPC UA server.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-168">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="ac5d3-169">Tento krok vytváří vzájemné vztah důvěryhodnosti z portálu připojené objekt pro vytváření a serverem OPC UA certifikátů a vytvoří připojení.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-169">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="ac5d3-170">Procházet uzlů stromu OPC UA OPC UA serveru, klikněte pravým tlačítkem na OPC uzly a vyberte **publikování**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-170">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="ac5d3-171">Pro publikování pro práci tímto způsobem, server OPC UA a vydavatele musí být ve stejné síti.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-171">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="ac5d3-172">Jinými slovy Pokud je název plně kvalifikované domény vydavatele **publisher.mydomain.com** musí být plně kvalifikovaný název domény serveru OPC UA, například **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-172">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="ac5d3-173">Pokud vaše instalace se liší, můžete ručně přidat uzly do souboru publishesnodes.json v nalezen **D:\\docker** složky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-173">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **D:\\docker** folder.</span></span> <span data-ttu-id="ac5d3-174">Soubor publishesnodes.json se automaticky vygeneroval na prvním úspěšném publikování OPC uzlu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-174">The publishesnodes.json file is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="ac5d3-175">Telemetrická data jsou nyní z zařízení brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-175">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="ac5d3-176">Můžete zobrazit telemetrii v **umístění objektu pro vytváření** zobrazení portálu připojené factory pod **nový objekt pro vytváření**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-176">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="linux-deployment"></a><span data-ttu-id="ac5d3-177">Linux nasazení</span><span class="sxs-lookup"><span data-stu-id="ac5d3-177">Linux deployment</span></span>

> [!NOTE]
> <span data-ttu-id="ac5d3-178">Pokud ještě nemáte zařízení brány, Microsoft doporučuje že zakoupit komerční brány na jednom z našich partnerů.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-178">If you don't yet have a gateway device, Microsoft recommends you buy a commercial gateway from one of our partners.</span></span> <span data-ttu-id="ac5d3-179">Přejděte [katalogu zařízení Azure IoT] seznam zařízení brány, které jsou kompatibilní s řešením připojené objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-179">Visit the [Azure IoT device catalog] for a list of gateway devices compatible with the connected factory solution.</span></span> <span data-ttu-id="ac5d3-180">Postupujte podle pokynů, které jsou součástí zařízení nastavit bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-180">Follow the instructions that come with the device to set up the gateway.</span></span> <span data-ttu-id="ac5d3-181">Alternativně použijte následující pokyny k ruční nastavení jedné z vašich bran existující.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-181">Alternatively, use the following instructions to manually set up one of your existing gateways.</span></span>

<span data-ttu-id="ac5d3-182">[Nainstalujte Docker] na vaše zařízení brány Linux.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-182">[Install Docker] on your Linux gateway device.</span></span>

### <a name="configure-the-gateway"></a><span data-ttu-id="ac5d3-183">Konfigurace brány</span><span class="sxs-lookup"><span data-stu-id="ac5d3-183">Configure the gateway</span></span>

1. <span data-ttu-id="ac5d3-184">Je nutné **iothubowner** připojovací řetězec sady Azure IoT Suite připojen objekt pro vytváření nasazení k dokončení nasazení brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-184">You need the **iothubowner** connection string of your Azure IoT Suite connected factory deployment to complete the gateway deployment.</span></span> <span data-ttu-id="ac5d3-185">V [portál Azure], přejděte do služby IoT Hub ve skupině prostředků vytvořili při nasazení řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-185">In the [Azure portal], navigate to your IoT Hub in the resource group created when you deployed the connected factory solution.</span></span> <span data-ttu-id="ac5d3-186">Klikněte na tlačítko **zásady sdíleného přístupu** k přístupu **iothubowner** připojovací řetězec:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-186">Click **Shared access policies** to access the **iothubowner** connection string:</span></span>

    ![Najděte připojovací řetězec služby IoT Hub][img-hub-connection]

    <span data-ttu-id="ac5d3-188">Kopírování **připojovací řetězec – primární klíč** hodnotu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-188">Copy the **Connection string--primary key** value.</span></span>

1. <span data-ttu-id="ac5d3-189">Konfigurace brány pro službu IoT Hub spuštěním moduly dvě brány **po** z prostředí s:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-189">Configure the gateway for your IoT Hub by running the two gateway modules **once** from a shell with:</span></span>

    `sudo docker run -it --rm -h <ApplicationName> -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/ -v /shared:/root/.dotnet/corefx/cryptography/x509stores microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName> "<IoTHubOwnerConnectionString>"`

    `sudo docker run --rm -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -i -c "<IoTHubOwnerConnectionString>" -D /mapped/cs.db`

    * <span data-ttu-id="ac5d3-190">**&lt;ApplicationName&gt;**  je název brány vytvoří ve formátu aplikace OPC UA **vydavatele.&lt; váš plně kvalifikovaný název domény&gt;**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-190">**&lt;ApplicationName&gt;** is the name of the OPC UA application the gateway creates in the format **publisher.&lt;your fully qualified domain name&gt;**.</span></span> <span data-ttu-id="ac5d3-191">Například **publisher.microsoft.com**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-191">For example, **publisher.microsoft.com**.</span></span>
    * <span data-ttu-id="ac5d3-192">**&lt;IoTHubOwnerConnectionString&gt;**  je **iothubowner** připojovacího řetězce, které jste zkopírovali v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-192">**&lt;IoTHubOwnerConnectionString&gt;** is the **iothubowner** connection string you copied in the previous step.</span></span> <span data-ttu-id="ac5d3-193">Tento připojovací řetězec se používá pouze v tomto kroku, nebudete ho potřebovat v následujících krocích:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-193">This connection string is only used in this step, you don’t need it in the following steps:</span></span>

    <span data-ttu-id="ac5d3-194">Můžete použít **/ sdílené** složky ( `-v` argument) později k uchování dva certifikáty X.509, které používají moduly brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-194">You use the **/shared** folder (the `-v` argument) later to persist the two X.509 certificates that the gateway modules use.</span></span>

### <a name="run-the-gateway"></a><span data-ttu-id="ac5d3-195">Spusťte bránu</span><span class="sxs-lookup"><span data-stu-id="ac5d3-195">Run the gateway</span></span>

1. <span data-ttu-id="ac5d3-196">Restartujte bránu pomocí následujících příkazů:</span><span class="sxs-lookup"><span data-stu-id="ac5d3-196">Restart the gateway using the following commands:</span></span>

    `sudo docker run -it -h <ApplicationName> --expose 62222 -p 62222:62222 –-rm -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/Logs -v /shared:/build/src/GatewayApp.NetCore/bin/Debug/netcoreapp1.0/publish/CertificateStores -v /shared:/shared -v /shared:/root/.dotnet/corefx/cryptography/x509stores -e _GW_PNFP="/shared/publishednodes.JSON" microsoft/iot-gateway-opc-ua:1.0.0 <ApplicationName>`

    `sudo docker run -it -v /shared:/mapped microsoft/iot-gateway-opc-ua-proxy:0.1.3 -D /mapped/cs.db`

1. <span data-ttu-id="ac5d3-197">Z bezpečnostních důvodů dva certifikáty X.509 uchovávané v **/ sdílené** složka obsahovat privátní klíč.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-197">For security reasons, the two X.509 certificates persisted in the **/shared** folder contain the private key.</span></span> <span data-ttu-id="ac5d3-198">Omezte přístup do této složky na přihlašovacích údajů, které používáte ke spouštění kontejner Docker.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-198">Limit access to this folder to the credentials you use to run the Docker container.</span></span> <span data-ttu-id="ac5d3-199">Nastavení oprávnění pro **kořenové** výhradně `chmod` prostředí shell příkaz na složku.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-199">To set the permissions for **root** only, use the `chmod` shell command on the folder.</span></span>

1. <span data-ttu-id="ac5d3-200">Ověřte připojení k síti.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-200">Verify network connectivity.</span></span> <span data-ttu-id="ac5d3-201">Z prostředí, zadejte příkaz `ping publisher.<your fully qualified domain name>` na příkaz ping bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-201">From a shell, enter the command `ping publisher.<your fully qualified domain name>` to ping your gateway.</span></span> <span data-ttu-id="ac5d3-202">Pokud cíl nedostupný, přidejte IP adresu a název své brány do souboru hostitelů na bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-202">If the destination is unreachable, add the IP address and name of your gateway to your hosts file on your gateway.</span></span> <span data-ttu-id="ac5d3-203">Soubor hostitele je umístěn ve **/atd** složky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-203">The hosts file is located in the **/etc** folder.</span></span>

1. <span data-ttu-id="ac5d3-204">Další pokuste se připojit k vydavateli pomocí místní OPC UA klienta se systémem na bráně.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-204">Next, try to connect to the publisher using a local OPC UA client running on the gateway.</span></span> <span data-ttu-id="ac5d3-205">Adresa URL je koncový bod OPC UA `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-205">The OPC UA endpoint URL is `opc.tcp://publisher.<your fully qualified domain name>:62222`.</span></span> <span data-ttu-id="ac5d3-206">Pokud nemáte klientem OPC UA, můžete stáhnout a použít [open-source OPC UA klienta].</span><span class="sxs-lookup"><span data-stu-id="ac5d3-206">If you don't have an OPC UA client, you can download and use an [open-source OPC UA client].</span></span>

1. <span data-ttu-id="ac5d3-207">Když byly úspěšně dokončeny tyto místní testy, přejdete **připojit vlastní OPC UA Server** na portálu řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-207">When you have successfully completed these local tests, browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="ac5d3-208">Zadejte adresu URL koncového bodu vydavatele (`tcp://publisher.<your fully qualified domain name>:62222`) a klikněte na tlačítko **Connect**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-208">Enter the publisher endpoint URL (`tcp://publisher.<your fully qualified domain name>:62222`) and click **Connect**.</span></span> <span data-ttu-id="ac5d3-209">Získat varování týkající se certifikátu a potom klikněte na **pokračovat.**</span><span class="sxs-lookup"><span data-stu-id="ac5d3-209">You get a certificate warning, then click **Proceed.**</span></span> <span data-ttu-id="ac5d3-210">Další dojde k chybě vydavatele nebude důvěřovat webovému klientovi uživatelský Agent.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-210">Next you get an error that the publisher doesn’t trust the UA Web Client.</span></span> <span data-ttu-id="ac5d3-211">Chcete-li tuto chybu vyřešit, zkopírujte **uživatelský Agent webového klienta** certifikátu z **/sdílené/zamítnutý certifikáty nebo certifikáty** složku pro **/shared/UA aplikací/certifikátů** složky na bránu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-211">To resolve this error, copy the **UA Web Client** certificate from the **/shared/Rejected Certificates/certs** folder to the **/shared/UA Applications/certs** folder on the gateway.</span></span> <span data-ttu-id="ac5d3-212">Není nutné restartovat brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-212">You do not need to restart of the gateway.</span></span> <span data-ttu-id="ac5d3-213">Tento krok opakujte.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-213">Repeat this step.</span></span> <span data-ttu-id="ac5d3-214">Již se můžete připojit k bráně z cloudu a jste připraveni přidat servery OPC UA k řešení.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-214">You can now connect to the gateway from the cloud, and you are ready to add OPC UA servers to the solution.</span></span>

### <a name="add-your-opc-ua-servers"></a><span data-ttu-id="ac5d3-215">Přidání serverů OPC UA</span><span class="sxs-lookup"><span data-stu-id="ac5d3-215">Add your OPC UA servers</span></span>

1. <span data-ttu-id="ac5d3-216">Vyhledejte **připojit vlastní OPC UA Server** na portálu řešení připojených objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-216">Browse to the **Connect your own OPC UA Server** page in the connected factory solution portal.</span></span> <span data-ttu-id="ac5d3-217">Postupujte stejným způsobem jako v předchozí části k vybudování důvěry mezi portál připojené objekt pro vytváření a OPC UA server.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-217">Follow the same steps as in the preceding section to establish trust between the connected factory portal and the OPC UA server.</span></span> <span data-ttu-id="ac5d3-218">Tento krok vytváří vzájemné vztah důvěryhodnosti z portálu připojené objekt pro vytváření a serverem OPC UA certifikátů a vytvoří připojení.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-218">This step establishes a mutual trust of the certificates from the connected factory portal and the OPC UA server and creates a connection.</span></span>

1. <span data-ttu-id="ac5d3-219">Procházet uzlů stromu OPC UA OPC UA serveru, klikněte pravým tlačítkem na OPC uzly a vyberte **publikování**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-219">Browse the OPC UA nodes tree of your OPC UA server, right-click the OPC nodes, and select **publish**.</span></span> <span data-ttu-id="ac5d3-220">Pro publikování pro práci tímto způsobem, server OPC UA a vydavatele musí být ve stejné síti.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-220">For publishing to work this way, the OPC UA server and the publisher must be on the same network.</span></span> <span data-ttu-id="ac5d3-221">Jinými slovy Pokud je název plně kvalifikované domény vydavatele **publisher.mydomain.com** musí být plně kvalifikovaný název domény serveru OPC UA, například **myopcuaserver.mydomain.com**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-221">In other words, if the fully qualified domain name of the publisher is **publisher.mydomain.com** then the fully qualified domain name of the OPC UA server must be, for example, **myopcuaserver.mydomain.com**.</span></span> <span data-ttu-id="ac5d3-222">Pokud vaše instalace se liší, můžete ručně přidat uzly do souboru publishesnodes.json v nalezen **/ sdílené** složky.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-222">If your setup is different, you can manually add nodes to the publishesnodes.json file found in the **/shared** folder.</span></span> <span data-ttu-id="ac5d3-223">Publishesnodes.json se automaticky vygeneroval na prvním úspěšném publikování OPC uzlu.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-223">The publishesnodes.json is automatically generated on the first successful publish of an OPC node.</span></span>

1. <span data-ttu-id="ac5d3-224">Telemetrická data jsou nyní z zařízení brány.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-224">Telemetry now flows from the gateway device.</span></span> <span data-ttu-id="ac5d3-225">Můžete zobrazit telemetrii v **umístění objektu pro vytváření** zobrazení portálu připojené factory pod **nový objekt pro vytváření**.</span><span class="sxs-lookup"><span data-stu-id="ac5d3-225">You can view the telemetry in the **Factory Locations** view of the connected factory portal under **New Factory**.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ac5d3-226">Další kroky</span><span class="sxs-lookup"><span data-stu-id="ac5d3-226">Next steps</span></span>

<span data-ttu-id="ac5d3-227">Další informace o architektuře připojené objekt pro vytváření předkonfigurovaného řešení najdete v tématu [připojené factory návod pro předkonfigurované řešení][lnk-walkthrough].</span><span class="sxs-lookup"><span data-stu-id="ac5d3-227">To learn more about the architecture of the connected factory preconfigured solution, see [Connected factory preconfigured solution walkthrough][lnk-walkthrough].</span></span>

[img-install-docker]: ./media/iot-suite-connected-factory-gateway-deployment/image1.png
[img-hub-connection]: ./media/iot-suite-connected-factory-gateway-deployment/image2.png
[img-docker-share]: ./media/iot-suite-connected-factory-gateway-deployment/image3.png

<span data-ttu-id="ac5d3-228">[Docker pro systém Windows]: https://www.docker.com/docker-windows</span><span class="sxs-lookup"><span data-stu-id="ac5d3-228">[Docker for Windows]: https://www.docker.com/docker-windows</span></span>
<span data-ttu-id="ac5d3-229">[katalogu zařízení Azure IoT]: https://catalog.azureiotsuite.com/?q=opc</span><span class="sxs-lookup"><span data-stu-id="ac5d3-229">[Azure IoT device catalog]: https://catalog.azureiotsuite.com/?q=opc</span></span>
<span data-ttu-id="ac5d3-230">[portál Azure]: http://portal.azure.com/</span><span class="sxs-lookup"><span data-stu-id="ac5d3-230">[Azure portal]: http://portal.azure.com/</span></span>
<span data-ttu-id="ac5d3-231">[open-source OPC UA klienta]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span><span class="sxs-lookup"><span data-stu-id="ac5d3-231">[open-source OPC UA client]: https://github.com/OPCFoundation/UA-.NETStandardLibrary/tree/master/SampleApplications/Samples/Client.Net4</span></span>
<span data-ttu-id="ac5d3-232">[Nainstalujte Docker]: https://www.docker.com/community-edition#/download</span><span class="sxs-lookup"><span data-stu-id="ac5d3-232">[Install Docker]: https://www.docker.com/community-edition#/download</span></span>
[lnk-walkthrough]: iot-suite-connected-factory-sample-walkthrough.md
<span data-ttu-id="ac5d3-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span><span class="sxs-lookup"><span data-stu-id="ac5d3-233">[Azure IoT Edge]: https://github.com/Azure/iot-edge</span></span>

[lnk-publisher-github]: https://github.com/Azure/iot-edge-opc-publisher
[lnk-publisher-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua
[lnk-proxy-github]: https://github.com/Azure/iot-edge-opc-proxy
[lnk-proxy-docker]: https://hub.docker.com/r/microsoft/iot-gateway-opc-ua-proxy
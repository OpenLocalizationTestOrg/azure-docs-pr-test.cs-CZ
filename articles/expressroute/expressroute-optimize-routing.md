---
title: "Optimalizace směrování ExpressRoute: Azure | Dokumentace Microsoftu"
description: "Tato stránka poskytuje podrobnosti o tom, jak toooptimize směrování, pokud máte více než jeden ExpressRoute okruhy, připojení mezi Microsoftem a podnikovou sítí."
documentationcenter: na
services: expressroute
author: charwen
manager: carmonm
editor: 
ms.assetid: fca53249-d9c3-4cff-8916-f8749386a4dd
ms.service: expressroute
ms.devlang: na
ms.topic: get-started-article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 04/06/2017
ms.author: charwen
ms.openlocfilehash: ebcfb638f67a9ac78c3e476668bfd0bb0ffb9985
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="optimize-expressroute-routing"></a><span data-ttu-id="9f722-103">Optimalizace směrování ExpressRoute</span><span class="sxs-lookup"><span data-stu-id="9f722-103">Optimize ExpressRoute Routing</span></span>
<span data-ttu-id="9f722-104">Pokud máte víc okruhů ExpressRoute, máte více než jeden tooMicrosoft tooconnect cesta.</span><span class="sxs-lookup"><span data-stu-id="9f722-104">When you have multiple ExpressRoute circuits, you have more than one path tooconnect tooMicrosoft.</span></span> <span data-ttu-id="9f722-105">V důsledku toho může dojít, neoptimální směrování – tedy provozu může trvat delší cestu tooreach společnosti Microsoft a tooyour sítě společnosti Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9f722-105">As a result, suboptimal routing may happen - that is, your traffic may take a longer path tooreach Microsoft, and Microsoft tooyour network.</span></span> <span data-ttu-id="9f722-106">Hello delší hello síťovou cestu, vyšší latence hello hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-106">hello longer hello network path, hello higher hello latency.</span></span> <span data-ttu-id="9f722-107">Latence má přímý vliv na výkon aplikací a činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="9f722-107">Latency has direct impact on application performance and user experience.</span></span> <span data-ttu-id="9f722-108">Tento článek popíše tento problém, který se popisují, jak hello toooptimize směrování pomocí standardních technologií směrování.</span><span class="sxs-lookup"><span data-stu-id="9f722-108">This article will illustrate this problem and explain how toooptimize routing using hello standard routing technologies.</span></span>

## <a name="suboptimal-routing-from-customer-toomicrosoft"></a><span data-ttu-id="9f722-109">Neoptimální směrování z tooMicrosoft zákazníka</span><span class="sxs-lookup"><span data-stu-id="9f722-109">Suboptimal routing from customer tooMicrosoft</span></span>
<span data-ttu-id="9f722-110">Podívejme se na příkladu zblízka na problém směrování hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-110">Let's take a close look at hello routing problem by an example.</span></span> <span data-ttu-id="9f722-111">Představte si, že máte dvě pobočky v hello USA, jednu v Los Angeles a jednu v New Yorku.</span><span class="sxs-lookup"><span data-stu-id="9f722-111">Imagine you have two offices in hello US, one in Los Angeles and one in New York.</span></span> <span data-ttu-id="9f722-112">Vaše pobočky jsou připojené k síti WAN, což může být buď vaše páteřní síti, nebo virtuální privátní síť IP poskytovatele služeb.</span><span class="sxs-lookup"><span data-stu-id="9f722-112">Your offices are connected on a Wide Area Network (WAN), which can be either your own backbone network or your service provider's IP VPN.</span></span> <span data-ttu-id="9f722-113">Máte dva okruhy ExpressRoute, jeden v oblasti USA – západ a druhý v oblasti USA – východ, které jsou také připojené hello sítě WAN.</span><span class="sxs-lookup"><span data-stu-id="9f722-113">You have two ExpressRoute circuits, one in US West and one in US East, that are also connected on hello WAN.</span></span> <span data-ttu-id="9f722-114">Zjevně máte dvě cesty tooconnect toohello Microsoft sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-114">Obviously, you have two paths tooconnect toohello Microsoft network.</span></span> <span data-ttu-id="9f722-115">Nyní si představte, že máte nasazení Azure (například Azure App Service) v oblasti USA – západ i USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-115">Now imagine you have Azure deployment (for example, Azure App Service) in both US West and US East.</span></span> <span data-ttu-id="9f722-116">Vaším záměrem je tooconnect vaši uživatelé v Los Angeles tooAzure USA – západ a uživatele z New Yorku tooAzure USA – východ, protože správce služby inzeruje, že každý office přístupu uživatelům z hello nedaleko Azure services pro činnost optimální.</span><span class="sxs-lookup"><span data-stu-id="9f722-116">Your intention is tooconnect your users in Los Angeles tooAzure US West and your users in New York tooAzure US East because your service admin advertises that users in each office access hello nearby Azure services for optimal experiences.</span></span> <span data-ttu-id="9f722-117">Bohužel hello plán funguje dobře pro uživatele na východním pobřeží hello, ale ne pro uživatele na západním pobřeží hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-117">Unfortunately, hello plan works out well for hello east coast users but not for hello west coast users.</span></span> <span data-ttu-id="9f722-118">Hello příčinu problému hello je následující hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-118">hello cause of hello problem is hello following.</span></span> <span data-ttu-id="9f722-119">V každém okruhu ExpressRoute inzerujeme tooyou hello předponu v Azure USA – východ (23.100.0.0/16) i hello předponu v Azure USA – západ (13.100.0.0/16).</span><span class="sxs-lookup"><span data-stu-id="9f722-119">On each ExpressRoute circuit, we advertise tooyou both hello prefix in Azure US East (23.100.0.0/16) and hello prefix in Azure US West (13.100.0.0/16).</span></span> <span data-ttu-id="9f722-120">Pokud si nejste jisti, která předpona je z které oblasti, nejste možné tootreat ho jinak.</span><span class="sxs-lookup"><span data-stu-id="9f722-120">If you don't know which prefix is from which region, you are not able tootreat it differently.</span></span> <span data-ttu-id="9f722-121">Vaše síť WAN může vezměte v úvahu obě hello předpony jsou blíž tooUS – východ než USA – západ a proto směruje uživatele toohello i office okruh ExpressRoute v oblasti USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-121">Your WAN network may think both of hello prefixes are closer tooUS East than US West and therefore route both office users toohello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="9f722-122">V hello end budete mít v hello office Los Angeles mnoho nespokojených uživatelů.</span><span class="sxs-lookup"><span data-stu-id="9f722-122">In hello end, you will have many unhappy users in hello Los Angeles office.</span></span>

![Problém ExpressRoute případ 1 - neoptimální směrování z tooMicrosoft zákazníka](./media/expressroute-optimize-routing/expressroute-case1-problem.png)

### <a name="solution-use-bgp-communities"></a><span data-ttu-id="9f722-124">Řešení: Použití komunit protokolu BGP</span><span class="sxs-lookup"><span data-stu-id="9f722-124">Solution: use BGP Communities</span></span>
<span data-ttu-id="9f722-125">toooptimize směrování pro uživatele obou poboček, budete potřebovat tooknow, která předpona je z Azure USA – západ a která z Azure USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-125">toooptimize routing for both office users, you need tooknow which prefix is from Azure US West and which from Azure US East.</span></span> <span data-ttu-id="9f722-126">Tyto informace kódujeme pomocí [hodnot komunity protokolu BGP](expressroute-routing.md).</span><span class="sxs-lookup"><span data-stu-id="9f722-126">We encode this information by using [BGP Community values](expressroute-routing.md).</span></span> <span data-ttu-id="9f722-127">Přiřadili jsme tooeach jedinečnou hodnotu komunity protokolu BGP oblast Azure, například 12076:51004 pro USA – východ, 12076:51006 pro USA – západ.</span><span class="sxs-lookup"><span data-stu-id="9f722-127">We've assigned a unique BGP Community value tooeach Azure region, e.g. "12076:51004" for US East, "12076:51006" for US West.</span></span> <span data-ttu-id="9f722-128">Teď, když už víte, které předpona je z které oblasti Azure, můžete nakonfigurovat, který okruh ExpressRoute se bude upřednostňovat.</span><span class="sxs-lookup"><span data-stu-id="9f722-128">Now that you know which prefix is from which Azure region, you can configure which ExpressRoute circuit should be preferred.</span></span> <span data-ttu-id="9f722-129">Vzhledem k tomu, že používáme hello informací o tooexchange směrování protokolu BGP, můžete použít směrování tooinfluence hodnotu Local Preference protokolu BGP.</span><span class="sxs-lookup"><span data-stu-id="9f722-129">Because we use hello BGP tooexchange routing info, you can use BGP's Local Preference tooinfluence routing.</span></span> <span data-ttu-id="9f722-130">V našem příkladu můžete přiřadit too13.100.0.0/16 hodnotu vyšší hodnotu local preference v USA – západ než v USA – východ a obdobně vyšší too23.100.0.0/16 hodnota hodnotu local preference v oblasti USA – východ než USA – západ.</span><span class="sxs-lookup"><span data-stu-id="9f722-130">In our example, you can assign a higher local preference value too13.100.0.0/16 in US West than in US East, and similarly, a higher local preference value too23.100.0.0/16 in US East than in US West.</span></span> <span data-ttu-id="9f722-131">Tato konfigurace zajistí, že když jsou k dispozici obě cesty tooMicrosoft, uživatelé v Los Angeles učiní hello okruh ExpressRoute v oblasti USA – západ tooconnect tooAzure USA – západ zatímco uživatelé v New Yorku trvat hello ExpressRoute v oblasti USA – východ tooAzure USA – východ .</span><span class="sxs-lookup"><span data-stu-id="9f722-131">This configuration will make sure that, when both paths tooMicrosoft are available, your users in Los Angeles will take hello ExpressRoute circuit in US West tooconnect tooAzure US West whereas your users in New York take hello ExpressRoute in US East tooAzure US East.</span></span> <span data-ttu-id="9f722-132">Směrování je optimalizované na obou stranách.</span><span class="sxs-lookup"><span data-stu-id="9f722-132">Routing is optimized on both sides.</span></span> 

![Případ 1 ExpressRoute – Řešení: Použití komunit protokolu BGP](./media/expressroute-optimize-routing/expressroute-case1-solution.png)

> [!NOTE]
> <span data-ttu-id="9f722-134">Dobrý den stejným způsobem, pomocí hodnotu Local Preference, může být použité toorouting z zákazníka tooAzure virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-134">hello same technique, using Local Preference, can be applied toorouting from customer tooAzure Virtual Network.</span></span> <span data-ttu-id="9f722-135">Jsme nemáte označit komunity protokolu BGP hodnota toohello předpon inzerovaných z Azure tooyour sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-135">We don't tag BGP Community value toohello prefixes advertised from Azure tooyour network.</span></span> <span data-ttu-id="9f722-136">Ale vzhledem k tomu, že znáte, což při nasazení virtuální sítě je zavřít toowhich sady Office, můžete nakonfigurovat směrovače odpovídajícím způsobem tooprefer jeden tooanother typu okruhu ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="9f722-136">However, since you know which of your Virtual Network deployment is close toowhich of your office, you can configure your routers accordingly tooprefer one ExpressRoute circuit tooanother.</span></span>
>
>

## <a name="suboptimal-routing-from-microsoft-toocustomer"></a><span data-ttu-id="9f722-137">Neoptimální směrování z Microsoft toocustomer</span><span class="sxs-lookup"><span data-stu-id="9f722-137">Suboptimal routing from Microsoft toocustomer</span></span>
<span data-ttu-id="9f722-138">Zde je další příklad kde připojení z Microsoftu trvat delší cestu tooreach vaší sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-138">Here is another example where connections from Microsoft take a longer path tooreach your network.</span></span> <span data-ttu-id="9f722-139">V tomto případě používáte místní servery Exchange a Exchange Online v [hybridním prostředí](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span><span class="sxs-lookup"><span data-stu-id="9f722-139">In this case, you use on-premises Exchange servers and Exchange Online in a [hybrid environment](https://technet.microsoft.com/library/jj200581%28v=exchg.150%29.aspx).</span></span> <span data-ttu-id="9f722-140">Vaše pobočky jsou připojené tooa sítě WAN.</span><span class="sxs-lookup"><span data-stu-id="9f722-140">Your offices are connected tooa WAN.</span></span> <span data-ttu-id="9f722-141">Inzerujete předpony hello místní serverů v obou vaší pobočky tooMicrosoft prostřednictvím hello dva okruhy ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="9f722-141">You advertise hello prefixes of your on-premises servers in both of your offices tooMicrosoft through hello two ExpressRoute circuits.</span></span> <span data-ttu-id="9f722-142">Exchange Online bude inicializovat místními servery toohello připojení v případech, jako je například přenesení poštovní schránky.</span><span class="sxs-lookup"><span data-stu-id="9f722-142">Exchange Online will initiate connections toohello on-premises servers in cases such as mailbox migration.</span></span> <span data-ttu-id="9f722-143">Bohužel hello připojení tooyour office Los Angeles se směruje toohello okruh ExpressRoute v oblasti USA – východ před procházení hello celý obsah přenášel back toohello západním pobřeží.</span><span class="sxs-lookup"><span data-stu-id="9f722-143">Unfortunately, hello connection tooyour Los Angeles office is routed toohello ExpressRoute circuit in US East before traversing hello entire continent back toohello west coast.</span></span> <span data-ttu-id="9f722-144">Hello příčinou problému hello je podobné toohello první z nich.</span><span class="sxs-lookup"><span data-stu-id="9f722-144">hello cause of hello problem is similar toohello first one.</span></span> <span data-ttu-id="9f722-145">Bez jakékoli pomoci namůže síť Microsoftu hello zjistit, která předpona zákazníka je zavřít tooUS – východ a které z nich je, zavřete tooUS – západ.</span><span class="sxs-lookup"><span data-stu-id="9f722-145">Without any hint, hello Microsoft network can't tell which customer prefix is close tooUS East and which one is close tooUS West.</span></span> <span data-ttu-id="9f722-146">Odehrává se toopick hello cesty je chybný tooyour office v Los Angeles.</span><span class="sxs-lookup"><span data-stu-id="9f722-146">It happens toopick hello wrong path tooyour office in Los Angeles.</span></span>

![ExpressRoute případ 2 - neoptimální směrování z Microsoft toocustomer](./media/expressroute-optimize-routing/expressroute-case2-problem.png)

### <a name="solution-use-as-path-prepending"></a><span data-ttu-id="9f722-148">Řešení: Použití předřazení AS PATH</span><span class="sxs-lookup"><span data-stu-id="9f722-148">Solution: use AS PATH prepending</span></span>
<span data-ttu-id="9f722-149">Existují dvě řešení toohello problém.</span><span class="sxs-lookup"><span data-stu-id="9f722-149">There are two solutions toohello problem.</span></span> <span data-ttu-id="9f722-150">Hello nejdřív jednu je, že budete jednoduše inzerovat vaši místní předponu pro office Los Angeles, 177.2.0.0/31, v okruhu ExpressRoute hello v oblasti USA – západ a místní předponu pro vaše v New Yorku, 177.2.0.2/31, v hello okruh ExpressRoute v oblasti USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-150">hello first one is that you simply advertise your on-premises prefix for your Los Angeles office, 177.2.0.0/31, on hello ExpressRoute circuit in US West and your on-premises prefix for your New York office, 177.2.0.2/31, on hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="9f722-151">V důsledku toho není k dispozici jenom jednu cestu pro Microsoft tooconnect tooeach vašich pobočkách.</span><span class="sxs-lookup"><span data-stu-id="9f722-151">As a result, there is only one path for Microsoft tooconnect tooeach of your offices.</span></span> <span data-ttu-id="9f722-152">Nedochází k nejednoznačnosti a směrování je optimalizované.</span><span class="sxs-lookup"><span data-stu-id="9f722-152">There is no ambiguity and routing is optimized.</span></span> <span data-ttu-id="9f722-153">Tento návrh je nutné toothink o strategie převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="9f722-153">With this design, you need toothink about your failover strategy.</span></span> <span data-ttu-id="9f722-154">V hello je porušený událost, která hello cesta tooMicrosoft přes ExpressRoute, musíte toomake jistotu, že Exchange Online se pořád připojit tooyour na místní servery.</span><span class="sxs-lookup"><span data-stu-id="9f722-154">In hello event that hello path tooMicrosoft via ExpressRoute is broken, you need toomake sure that Exchange Online can still connect tooyour on-premises servers.</span></span> 

<span data-ttu-id="9f722-155">Hello druhým řešením je, že pokračovat tooadvertise předpon hello v obou okruzích ExpressRoute a kromě toho nám dáte pokyn, která předpona je zavřít toowhich jeden z poboček.</span><span class="sxs-lookup"><span data-stu-id="9f722-155">hello second solution is that you continue tooadvertise both of hello prefixes on both ExpressRoute circuits, and in addition you give us a hint of which prefix is close toowhich one of your offices.</span></span> <span data-ttu-id="9f722-156">Protože podporujeme předřazení protokolu BGP AS Path, můžete nakonfigurovat hello AS Path pro směrování tooinfluence předponu.</span><span class="sxs-lookup"><span data-stu-id="9f722-156">Because we support BGP AS Path prepending, you can configure hello AS Path for your prefix tooinfluence routing.</span></span> <span data-ttu-id="9f722-157">V tomto příkladu lze prodloužit hello AS PATH pro 172.2.0.0/31 v oblasti USA – východ, takže jsme se raději hello okruh ExpressRoute v oblasti USA – západ pro přenos dat určený pro tuto předponu (protože naše síť si bude myslet, že předpona toothis cesta hello je kratší in – západ hello).</span><span class="sxs-lookup"><span data-stu-id="9f722-157">In this example, you can lengthen hello AS PATH for 172.2.0.0/31 in US East so that we will prefer hello ExpressRoute circuit in US West for traffic destined for this prefix (as our network will think hello path toothis prefix is shorter in hello west).</span></span> <span data-ttu-id="9f722-158">Obdobně lze prodloužit hello AS PATH pro 172.2.0.2/31 v oblasti USA – Západ, abychom preferovali okruh ExpressRoute hello v oblasti USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-158">Similarly you can lengthen hello AS PATH for 172.2.0.2/31 in US West so that we'll prefer hello ExpressRoute circuit in US East.</span></span> <span data-ttu-id="9f722-159">Směrování je optimalizované pro obě pobočky.</span><span class="sxs-lookup"><span data-stu-id="9f722-159">Routing is optimized for both offices.</span></span> <span data-ttu-id="9f722-160">Pokud v tomto návrhu jeden okruh ExpressRoute není funkční, Exchange Online se s vámi pořád může spojit prostřednictvím jiného okruhu ExpressRoute a vaší sítě WAN.</span><span class="sxs-lookup"><span data-stu-id="9f722-160">With this design, if one ExpressRoute circuit is broken, Exchange Online can still reach you via another ExpressRoute circuit and your WAN.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="9f722-161">Odebereme soukromá jako čísla v hello AS PATH pro předpony hello přijaté na Peering společnosti Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9f722-161">We remove private AS numbers in hello AS PATH for hello prefixes received on Microsoft Peering.</span></span> <span data-ttu-id="9f722-162">Je třeba tooappend veřejná čísla AS v hello směrování tooinfluence AS PATH pro Peering společnosti Microsoft.</span><span class="sxs-lookup"><span data-stu-id="9f722-162">You need tooappend public AS numbers in hello AS PATH tooinfluence routing for Microsoft Peering.</span></span>
> 
> 

![Případ 2 ExpressRoute – Řešení: Použití předřazení AS PATH](./media/expressroute-optimize-routing/expressroute-case2-solution.png)

> [!NOTE]
> <span data-ttu-id="9f722-164">Zde uvedené příklady hello jsou pro společnost Microsoft a veřejných partnerských vztahů, jsme podporují hello stejné funkce pro hello soukromého partnerského vztahu.</span><span class="sxs-lookup"><span data-stu-id="9f722-164">While hello examples given here are for Microsoft and Public peerings, we do support hello same capabilities for hello Private peering.</span></span> <span data-ttu-id="9f722-165">Navíc předřazení AS Path hello funguje v rámci jednoho jeden okruh ExpressRoute, tooinfluence hello výběr hello primární a sekundární cesty.</span><span class="sxs-lookup"><span data-stu-id="9f722-165">Also, hello AS Path prepending works within one single ExpressRoute circuit, tooinfluence hello selection of hello primary and secondary paths.</span></span>
> 
> 

## <a name="suboptimal-routing-between-virtual-networks"></a><span data-ttu-id="9f722-166">Neoptimální směrování mezi virtuálními sítěmi</span><span class="sxs-lookup"><span data-stu-id="9f722-166">Suboptimal routing between virtual networks</span></span>
<span data-ttu-id="9f722-167">Pomocí ExpressRoute, můžete povolit virtuální sítě tooVirtual sítě (která je také označována jako "Virtuální sítě") komunikace jejich propojováním tooan okruh ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="9f722-167">With ExpressRoute, you can enable Virtual Network tooVirtual Network (which is also known as "VNet") communication by linking them tooan ExpressRoute circuit.</span></span> <span data-ttu-id="9f722-168">Při propojení je toomultiple okruhy ExpressRoute, neoptimálnímu směrování může dojít mezi hello virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-168">When you link them toomultiple ExpressRoute circuits, suboptimal routing can happen between hello VNets.</span></span> <span data-ttu-id="9f722-169">Zvažte následující příklad.</span><span class="sxs-lookup"><span data-stu-id="9f722-169">Let's consider an example.</span></span> <span data-ttu-id="9f722-170">Máte dva okruhy ExpressRoute, jeden v oblasti USA – západ a druhý v oblasti USA – východ.</span><span class="sxs-lookup"><span data-stu-id="9f722-170">You have two ExpressRoute circuits, one in US West and one in US East.</span></span> <span data-ttu-id="9f722-171">V každé oblasti máte dvě virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-171">In each region, you have two VNets.</span></span> <span data-ttu-id="9f722-172">V jedné virtuální sítě nasazených webových serverů a aplikačních serverů v jiných hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-172">Your web servers are deployed in one VNet and application servers in hello other.</span></span> <span data-ttu-id="9f722-173">Pro redundanci můžete odkaz hello dvou virtuálních sítí v každé oblasti tooboth hello místní okruh ExpressRoute a hello vzdálené okruh ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="9f722-173">For redundancy, you link hello two VNets in each region tooboth hello local ExpressRoute circuit and hello remote ExpressRoute circuit.</span></span> <span data-ttu-id="9f722-174">Jak je vidět níže, v každé virtuální sítě existují dvě cesty toohello jiné virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9f722-174">As can be seen below, from each VNet there are two paths toohello other VNet.</span></span> <span data-ttu-id="9f722-175">Hello virtuálních sítí neznáte, který okruh ExpressRoute je místní a která je vzdálený.</span><span class="sxs-lookup"><span data-stu-id="9f722-175">hello VNets don't know which ExpressRoute circuit is local and which one is remote.</span></span> <span data-ttu-id="9f722-176">V důsledku stejně jako rovná náklady více cesta (ECMP) směrování tooload vyrovnávání přenosů mezi virtuálními, některé tok přenosů dat bude trvat delší cestu hello a získat směruje na okruh ExpressRoute vzdálené hello.</span><span class="sxs-lookup"><span data-stu-id="9f722-176">Consequently as they do Equal-Cost-Multi-Path (ECMP) routing tooload-balance inter-VNet traffic, some traffic flows will take hello longer path and get routed at hello remote ExpressRoute circuit.</span></span>

![Případ 3 ExpressRoute – Neoptimální směrování mezi virtuálními sítěmi](./media/expressroute-optimize-routing/expressroute-case3-problem.png)

### <a name="solution-assign-a-high-weight-toolocal-connection"></a><span data-ttu-id="9f722-178">Řešení: přiřaďte vysokou váhu toolocal připojení</span><span class="sxs-lookup"><span data-stu-id="9f722-178">Solution: assign a high weight toolocal connection</span></span>
<span data-ttu-id="9f722-179">Hello řešení je jednoduchá.</span><span class="sxs-lookup"><span data-stu-id="9f722-179">hello solution is simple.</span></span> <span data-ttu-id="9f722-180">Vzhledem k tomu, že znáte, kde jsou hello virtuální sítě a hello okruhů, můžete nám říct které cesty každý virtuální síť by měla přednost.</span><span class="sxs-lookup"><span data-stu-id="9f722-180">Since you know where hello VNets and hello circuits are, you can tell us which path each VNet should prefer.</span></span> <span data-ttu-id="9f722-181">Speciálně pro tento příklad přiřadit vyšší váhou toohello místní připojení než toohello vzdáleného připojení (viz příklad konfigurace hello [sem](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span><span class="sxs-lookup"><span data-stu-id="9f722-181">Specifically for this example, you assign a higher weight toohello local connection than toohello remote connection (see hello configuration example [here](expressroute-howto-linkvnet-arm.md#modify-a-virtual-network-connection)).</span></span> <span data-ttu-id="9f722-182">Když virtuální síť, která obdrží hello předpona hello jiné virtuální sítě na víc připojení ho s hello nejvyšší váhy toosend provoz určený pro tuto předponu preferovali hello připojení.</span><span class="sxs-lookup"><span data-stu-id="9f722-182">When a VNet receives hello prefix of hello other VNet on multiple connections it will prefer hello connection with hello highest weight toosend traffic destined for that prefix.</span></span>

![Řešení ExpressRoute případ 3 - přiřazení vysokou váhu toolocal připojení](./media/expressroute-optimize-routing/expressroute-case3-solution.png)

> [!NOTE]
> <span data-ttu-id="9f722-184">Můžete také ovlivnit směrování z virtuální sítě tooyour místní sítě, pokud máte víc okruhů ExpressRoute, tím, že nakonfigurujete váhy hello připojení místo použití AS PATH předřazení techniku popsanou v hello druhý scénář výše.</span><span class="sxs-lookup"><span data-stu-id="9f722-184">You can also influence routing from VNet tooyour on-premises network, if you have multiple ExpressRoute circuits, by configuring hello weight of a connection instead of applying AS PATH prepending, a technique described in hello second scenario above.</span></span> <span data-ttu-id="9f722-185">Pro každou předponu vždy Podíváme se na váhy připojení hello před hello AS Path délka při rozhodování o tom, jak toosend provoz.</span><span class="sxs-lookup"><span data-stu-id="9f722-185">For each prefix, we will always look at hello connection weight before hello AS Path length when deciding how toosend traffic.</span></span>
>
>

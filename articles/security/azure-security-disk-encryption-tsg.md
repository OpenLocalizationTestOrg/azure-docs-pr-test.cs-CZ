---
title: "řešení potíží s šifrování disku aaaAzure | Microsoft Docs"
description: "Tento článek obsahuje tipy k řešení potíží pro Microsoft Azure Disk Encryption pro systém Windows a virtuálních počítačů IaaS Linux."
services: security
documentationcenter: na
author: deventiwari
manager: avibm
editor: yuridio
ms.assetid: ce0e23bd-07eb-43af-a56c-aa1a73bdb747
ms.service: security
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 07/27/2017
ms.author: devtiw
ms.openlocfilehash: 2ecb8df1fb869e3bf8f3be4be4494e6485e75695
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="azure-disk-encryption-troubleshooting-guide"></a><span data-ttu-id="4b2db-103">Průvodce odstraňováním potíží Azure Disk Encryption</span><span class="sxs-lookup"><span data-stu-id="4b2db-103">Azure Disk Encryption Troubleshooting Guide</span></span>

<span data-ttu-id="4b2db-104">Tato příručka je (IT) profesionálům, informace analytikům zabezpečení a problémy související s můžou správci cloudové jejichž organizace používají šifrování disku Azure a potřebovat pokyny tootroubleshoot-šifrování disku.</span><span class="sxs-lookup"><span data-stu-id="4b2db-104">This guide is for information technology (IT) professionals, information security analysts, and cloud administrators whose organizations are using Azure disk encryption and need guidance tootroubleshoot disk-encryption related issues.</span></span>

## <a name="troubleshooting-linux-os-disk-encryption"></a><span data-ttu-id="4b2db-105">Řešení potíží s šifrování disku operačního systému Linux</span><span class="sxs-lookup"><span data-stu-id="4b2db-105">Troubleshooting Linux OS disk encryption</span></span>

<span data-ttu-id="4b2db-106">Šifrování disku operačního systému Linux musí odpojit předchozí toorunning jednotky hello operačního systému přes proces šifrování celého disku hello.</span><span class="sxs-lookup"><span data-stu-id="4b2db-106">Linux OS disk encryption must unmount hello OS drive prior toorunning it through hello full disk encryption process.</span></span>   <span data-ttu-id="4b2db-107">Pokud ne, chybová zpráva z "se nezdařilo toounmount po..."</span><span class="sxs-lookup"><span data-stu-id="4b2db-107">If it cannot, an error message of "failed toounmount after…"</span></span> <span data-ttu-id="4b2db-108">chybová zpráva je pravděpodobně toooccur.</span><span class="sxs-lookup"><span data-stu-id="4b2db-108">error message is likely toooccur.</span></span>

<span data-ttu-id="4b2db-109">Toto je nejpravděpodobnější, při pokusu o šifrování disku operačního systému na cílové prostředí virtuálního počítače, který byl změněn nebo se změnila z jeho podporovaných uložených Galerie image.</span><span class="sxs-lookup"><span data-stu-id="4b2db-109">This is most likely when OS disk encryption is attempted on a target VM environment that has been modified or changed from its supported stock gallery image.</span></span>  <span data-ttu-id="4b2db-110">Příklady odchylky od hello podporované bitovou kopii, kterou může narušovat hello rozšíření možnost toounmount hello OS jednotky:</span><span class="sxs-lookup"><span data-stu-id="4b2db-110">Examples of deviations from hello supported image, which can interfere with hello extension’s ability toounmount hello OS drive include:</span></span>
- <span data-ttu-id="4b2db-111">Přizpůsobené bitové kopie, které už odpovídají v podporovaném systému souborů nebo schéma rozdělení oddílů.</span><span class="sxs-lookup"><span data-stu-id="4b2db-111">Customized images that no longer match a supported file system and/or partitioning scheme.</span></span>
- <span data-ttu-id="4b2db-112">Přizpůsobené bitové kopie s aplikací, jako jsou antivirové Docker, SAP, MongoDB nebo Cassandra Apache spuštěné v předchozí tooencryption hello operačního systému.</span><span class="sxs-lookup"><span data-stu-id="4b2db-112">Customized images with applications such as antivirus, Docker, SAP, MongoDB, or Apache Cassandra running in hello OS prior tooencryption.</span></span>  <span data-ttu-id="4b2db-113">Tyto aplikace se obtížně tooterminate a při otevření souboru popisovače toohello OS jednotky zachovávají, hello jednotka nemůže nepřipojené způsobující selhání.</span><span class="sxs-lookup"><span data-stu-id="4b2db-113">These applications are difficult tooterminate, and when they retain open file handles toohello OS drive, hello drive cannot be unmounted, causing failure.</span></span>
- <span data-ttu-id="4b2db-114">Vlastní skripty, které běží v zavřete čas blízkosti toohello šifrování krok může docházet ke konfliktům a způsobit, že tuto chybu.</span><span class="sxs-lookup"><span data-stu-id="4b2db-114">Custom scripts that run in close time proximity toohello encryption step can interfere and cause this failure.</span></span> <span data-ttu-id="4b2db-115">Tomu může dojít, když šablony Resource Manageru současně definuje tooexecute více rozšíření, nebo když rozšíření vlastních skriptů nebo jiným běží současně toodisk šifrování.</span><span class="sxs-lookup"><span data-stu-id="4b2db-115">This can happen when a Resource Manager template defines multiple extensions tooexecute simultaneously, or when a custom script extension or other action is run simultaneously toodisk encryption.</span></span>   <span data-ttu-id="4b2db-116">Hello problém může vyřešit serializaci a izolování tyto kroky.</span><span class="sxs-lookup"><span data-stu-id="4b2db-116">Serializing and isolating such steps may resolve hello issue.</span></span>
- <span data-ttu-id="4b2db-117">Když SELinux nebylo zakázáno předchozí tooenabling šifrování, odpojte hello krok nezdaří.</span><span class="sxs-lookup"><span data-stu-id="4b2db-117">When SELinux has not been disabled prior tooenabling encryption, hello unmount step fails.</span></span>  <span data-ttu-id="4b2db-118">Po dokončení šifrování, může být SELinux znovu zapnout.</span><span class="sxs-lookup"><span data-stu-id="4b2db-118">SELinux can be re-enabled after encryption has completed.</span></span>
- <span data-ttu-id="4b2db-119">Pokud je disk hello operačního systému pomocí příslušné schéma LVM (i když je k dispozici omezená podpora disku data LVM, disk operačního systému LVM není)</span><span class="sxs-lookup"><span data-stu-id="4b2db-119">When hello OS disk is using an LVM scheme (although limited LVM data disk support is available, LVM OS disk is not)</span></span>
- <span data-ttu-id="4b2db-120">Pokud nejsou splněné požadavky na minimální množství paměti (7 GB je navržený pro šifrování disku operačního systému)</span><span class="sxs-lookup"><span data-stu-id="4b2db-120">When minimum memory requirements are not met (7GB is suggested for OS disk encryption)</span></span>
- <span data-ttu-id="4b2db-121">Když datové jednotky byly rekurzivně připojeny v adresáři /mnt/ nebo navzájem (například /mnt/data1 /mnt/data2, /data3 + /data3/data4, atd.)</span><span class="sxs-lookup"><span data-stu-id="4b2db-121">When data drives have been recursively mounted under /mnt/ directory, or each other (for example, /mnt/data1, /mnt/data2, /data3 + /data3/data4, etc.)</span></span>
- <span data-ttu-id="4b2db-122">Při další Azure Disk Encryption [požadavky](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) nejsou splněny pro Linux</span><span class="sxs-lookup"><span data-stu-id="4b2db-122">When other Azure Disk Encryption [prerequisites](https://docs.microsoft.com/en-us/azure/security/azure-security-disk-encryption) for Linux are not met</span></span>

## <a name="unable-tooencrypt"></a><span data-ttu-id="4b2db-123">Nelze tooencrypt</span><span class="sxs-lookup"><span data-stu-id="4b2db-123">Unable tooencrypt</span></span>

<span data-ttu-id="4b2db-124">V některých případech se zobrazí šifrování disku Linux hello toobe zablokované ve "Spuštění šifrování disku operačního systému." a SSH je zakázaná.</span><span class="sxs-lookup"><span data-stu-id="4b2db-124">In some cases, hello Linux disk encryption appears toobe stuck at "OS disk encryption started" and SSH is disabled.</span></span> <span data-ttu-id="4b2db-125">Tento proces může trvat mezi toocomplete 3-16 hodin na bitovou kopii uložených galerie.</span><span class="sxs-lookup"><span data-stu-id="4b2db-125">This process can take between 3-16 hours toocomplete on a stock gallery image.</span></span>  <span data-ttu-id="4b2db-126">Pokud přidáte více TB velikost datových disků, hello proces může trvat dnů.</span><span class="sxs-lookup"><span data-stu-id="4b2db-126">If multi-TB size data disks are added, hello process may take days.</span></span> <span data-ttu-id="4b2db-127">Hello pořadí šifrování disku operačního systému Linux dočasně odpojí jednotky hello operačního systému a provádí šifrování blok po bloku hello celý disk operačního systému, než ho opakovanému připojení v jeho šifrovaného stavu.</span><span class="sxs-lookup"><span data-stu-id="4b2db-127">hello Linux OS disk encryption sequence unmounts hello OS drive temporarily, and performs block by block encryption of hello entire OS disk, before remounting it in its encrypted state.</span></span>   <span data-ttu-id="4b2db-128">Na rozdíl od Azure Disk Encryption v systému Windows Linux šifrování disku neumožňuje souběžné používání hello virtuálních počítačů, když probíhá šifrování hello.</span><span class="sxs-lookup"><span data-stu-id="4b2db-128">Unlike Azure Disk Encryption on Windows, Linux Disk Encryption does not allow concurrent use of hello VM while hello encryption is in progress.</span></span>  <span data-ttu-id="4b2db-129">Hello výkonnostních charakteristik hello virtuálních počítačů, včetně velikosti hello hello disku a zda je účet úložiště hello zajištěna úložiště standard nebo premium (SSD), můžete výrazně ovlivnit hello čas potřebný toocomplete šifrování.</span><span class="sxs-lookup"><span data-stu-id="4b2db-129">hello performance characteristics of hello VM, including hello size of hello disk and whether hello storage account is backed by standard or premium (SSD) storage, can greatly influence hello time required toocomplete encryption.</span></span>

<span data-ttu-id="4b2db-130">Stav toocheck hello ProgressMessage pole vrácených hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) testují příkaz.</span><span class="sxs-lookup"><span data-stu-id="4b2db-130">toocheck status, hello ProgressMessage field returned from hello [Get-AzureRmVmDiskEncryptionStatus](https://docs.microsoft.com/powershell/module/azurerm.compute/get-azurermvmdiskencryptionstatus) command can be polled.</span></span>   <span data-ttu-id="4b2db-131">Při šifrované jednotky hello operačního systému, hello virtuální počítač dostane do stavu údržby a SSH je také zakázané tooprevent jakýkoli proces probíhající toohello přerušení.</span><span class="sxs-lookup"><span data-stu-id="4b2db-131">While hello OS drive is being encrypted, hello VM enters a servicing state, and SSH is also disabled tooprevent any disruption toohello ongoing process.</span></span>  <span data-ttu-id="4b2db-132">Při šifrování probíhá, a potom několik hodin později s VMRestartPending zpráva s výzvou toorestart hello virtuálních počítačů, se pro většinu hello hello doby ohlásí EncryptionInProgress.</span><span class="sxs-lookup"><span data-stu-id="4b2db-132">EncryptionInProgress will be reported for hello majority of hello time while encryption is in progress, followed several hours later with a VMRestartPending message prompting toorestart hello VM.</span></span>  <span data-ttu-id="4b2db-133">Například:</span><span class="sxs-lookup"><span data-stu-id="4b2db-133">For example:</span></span>


```
PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : EncryptionInProgress
DataVolumesEncrypted       : EncryptionInProgress
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk encryption started

PS > Get-AzureRmVMDiskEncryptionStatus -ResourceGroupName $resourceGroupName -VMName $vmName
OsVolumeEncrypted          : VMRestartPending
DataVolumesEncrypted       : Encrypted
OsVolumeEncryptionSettings : Microsoft.Azure.Management.Compute.Models.DiskEncryptionSettings
ProgressMessage            : OS disk successfully encrypted, please reboot hello VM
```

<span data-ttu-id="4b2db-134">Po zobrazení výzvy tooreboot hello virtuálních počítačů a po restartování hello virtuálních počítačů a to se 2 – 3 minuty, pro restartování hello a provést na cíli hello toobe závěrečné kroky, označí hello stavovou zprávu, že šifrování nakonec byla dokončena.</span><span class="sxs-lookup"><span data-stu-id="4b2db-134">Once prompted tooreboot hello VM, and after restarting hello VM, and giving 2-3 minutes for hello reboot and for final steps toobe performed on hello target, hello status message will indicate that encryption has finally completed.</span></span>   <span data-ttu-id="4b2db-135">Jakmile tato zpráva je k dispozici, hello šifrované jednotky operačního systému je očekávané toobe připravené pro použití a hello virtuálních počítačů toobe použít znovu.</span><span class="sxs-lookup"><span data-stu-id="4b2db-135">Once this message is available, hello encrypted OS drive is expected toobe ready for use and for hello VM toobe usable again.</span></span>

<span data-ttu-id="4b2db-136">V případech, kdy toto pořadí nebyla zobrazena nebo pokud informace o spuštění, zprávu o průběhu nebo další indikátory, chyba ohlásit že OS šifrování selhala uprostřed hello tohoto procesu (například pokud vidíte chyby hello "se nezdařilo toounmount" popsané v tomto průvodci) Doporučujeme toorestore hello virtuální počítač zpět toohello snímek nebo zálohy okamžitě předchozí tooencryption.</span><span class="sxs-lookup"><span data-stu-id="4b2db-136">In cases where this sequence was not seen, or if boot information, progress message, or other error indicators report that OS encryption has failed in hello middle of this process (for example if you are seeing hello "failed toounmount" error described in this guide), it is recommended toorestore hello VM back toohello snapshot or backup taken immediately prior tooencryption.</span></span>  <span data-ttu-id="4b2db-137">Další pokus předchozí toohello, je navržené toore-vyhodnocení hello charakteristika hello virtuální počítač a ujistěte se, že jsou splněny všechny požadavky.</span><span class="sxs-lookup"><span data-stu-id="4b2db-137">Prior toohello next attempt, it is suggested toore-evaluate hello characteristics of hello VM and ensure that all prerequisites are satisfied.</span></span>

## <a name="troubleshooting-azure-disk-encryption-behind-a-firewall"></a><span data-ttu-id="4b2db-138">Řešení potíží s Azure Disk Encryption za bránou Firewall</span><span class="sxs-lookup"><span data-stu-id="4b2db-138">Troubleshooting Azure Disk Encryption behind a Firewall</span></span>
<span data-ttu-id="4b2db-139">Při připojení je omezené na základě schopnost hello rozšíření tooperform hello brány firewall, proxy požadavek nebo nastavení zabezpečení skupiny (NSG) sítě, potřeby můžou být přerušeny úlohy.</span><span class="sxs-lookup"><span data-stu-id="4b2db-139">When connectivity is restricted by a firewall, proxy requirement, or network security group (NSG) settings, hello ability of hello extension tooperform needed tasks can be disrupted.</span></span>   <span data-ttu-id="4b2db-140">To může způsobit stavové zprávy, jako je například "Stav rozšíření není k dispozici v hello virtuální počítač" a v očekávané scénáře selhání toofinish.</span><span class="sxs-lookup"><span data-stu-id="4b2db-140">This can result in status messages such as "Extension status not available on hello VM" and in expected scenarios failing toofinish.</span></span>  <span data-ttu-id="4b2db-141">Hello oddíly, které následují má některé běžné problémy brány firewall, které může prozkoumat.</span><span class="sxs-lookup"><span data-stu-id="4b2db-141">hello sections that follow has some common firewall issues that you may investigate.</span></span>

### <a name="network-security-groups"></a><span data-ttu-id="4b2db-142">Skupiny zabezpečení sítě</span><span class="sxs-lookup"><span data-stu-id="4b2db-142">Network security groups</span></span>
<span data-ttu-id="4b2db-143">Všechna nastavení skupiny zabezpečení sítě použít musí umožňovat stále konfigurace sítě hello koncový bod toomeet hello popsané [požadavky](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) šifrování disku.</span><span class="sxs-lookup"><span data-stu-id="4b2db-143">Any network security group settings applied must still allow hello endpoint toomeet hello documented network configuration [prerequisites](https://docs.microsoft.com/azure/security/azure-security-disk-encryption#prerequisites) for disk encryption.</span></span>

### <a name="azure-keyvault-behind-firewall"></a><span data-ttu-id="4b2db-144">Azure Keyvault za bránou firewall</span><span class="sxs-lookup"><span data-stu-id="4b2db-144">Azure Keyvault behind firewall</span></span>
<span data-ttu-id="4b2db-145">Hello virtuálního počítače musí být schopný tooaccess trezoru klíčů.</span><span class="sxs-lookup"><span data-stu-id="4b2db-145">hello VM must be able tooaccess key vault.</span></span> <span data-ttu-id="4b2db-146">Odkazovat tooguidance na selhání tookey přístup přes bránu firewall, který je spravován hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) týmu.</span><span class="sxs-lookup"><span data-stu-id="4b2db-146">Refer tooguidance on access tookey fault from behind a firewall that is maintained by hello [Key Vault](https://docs.microsoft.com/azure/key-vault/key-vault-access-behind-firewall) team.</span></span>

### <a name="linux-package-management-behind-firewall"></a><span data-ttu-id="4b2db-147">Linux správy balíčků za bránou firewall</span><span class="sxs-lookup"><span data-stu-id="4b2db-147">Linux package management behind firewall</span></span>
<span data-ttu-id="4b2db-148">V době běhu Azure Disk Encryption pro Linux spoléhá na předchozí tooenabling šifrování požadované součásti systému tooinstall potřeby hello cílový distribuční balíček správy.</span><span class="sxs-lookup"><span data-stu-id="4b2db-148">At run time, Azure Disk Encryption for Linux relies on hello target distribution’s package management system tooinstall needed prerequisite components prior tooenabling encryption.</span></span>  <span data-ttu-id="4b2db-149">Pokud nastavení brány firewall, aby hello virtuálního počítače nebylo možné toodownload a tyto součásti nainstalovat, jsou očekávané následné selhání.</span><span class="sxs-lookup"><span data-stu-id="4b2db-149">If firewall settings prevent hello VM from being able toodownload and install these components, then subsequent failures are expected.</span></span>    <span data-ttu-id="4b2db-150">Hello tooconfigure kroky, to se může lišit podle distribuce.</span><span class="sxs-lookup"><span data-stu-id="4b2db-150">hello steps tooconfigure this may vary by distribution.</span></span>  <span data-ttu-id="4b2db-151">Na Red Hat zajistíte, že odběr manager a yum jsou správně nastavena je pokud proxy server je nutné, důležité.</span><span class="sxs-lookup"><span data-stu-id="4b2db-151">On Red Hat, when a proxy is required, ensuring that subscription-manager and yum are set up properly is vital.</span></span>  <span data-ttu-id="4b2db-152">V tématu [to](https://access.redhat.com/solutions/189533) článek podpory Red Hat v tomto tématu.</span><span class="sxs-lookup"><span data-stu-id="4b2db-152">See [this](https://access.redhat.com/solutions/189533) Red Hat support article on this topic.</span></span>  

## <a name="troubleshooting-windows-server-2016-server-core"></a><span data-ttu-id="4b2db-153">Řešení potíží s jádra serveru systému Windows Server 2016</span><span class="sxs-lookup"><span data-stu-id="4b2db-153">Troubleshooting Windows Server 2016 Server Core</span></span>

<span data-ttu-id="4b2db-154">Na jádru serveru Windows Server 2016 hello bdehdcfg součást není k dispozici ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="4b2db-154">On Windows Server 2016 Server Core, hello bdehdcfg component is not available by default.</span></span> <span data-ttu-id="4b2db-155">Tato součást vyžaduje Azure Disk Encryption.</span><span class="sxs-lookup"><span data-stu-id="4b2db-155">This component is required by Azure Disk Encryption.</span></span>

<span data-ttu-id="4b2db-156">tooworkaround tento problém, kopie hello následující 4 soubory ze složky c:\windows\system32 toohello virtuálního počítače Windows serveru 2016 Data Center hello jádra serveru bitové kopie:</span><span class="sxs-lookup"><span data-stu-id="4b2db-156">tooworkaround this issue, copy hello following 4 files from a Windows Server 2016 Data Center VM toohello c:\windows\system32 folder of hello Server Core image:</span></span>

```
bdehdcfg.exe
bdehdcfglib.dll
bdehdcfglib.dll.mui
bdehdcfg.exe.mui
```

<span data-ttu-id="4b2db-157">Potom spusťte následující příkaz hello:</span><span class="sxs-lookup"><span data-stu-id="4b2db-157">Then, run hello following command:</span></span>

```
bdehdcfg.exe -target default
```

<span data-ttu-id="4b2db-158">Tím se vytvoří systémový oddíl 550MB a pak po restartování systému, můžete pomocí nástroje Diskpart toocheck hello svazky a pokračovat.</span><span class="sxs-lookup"><span data-stu-id="4b2db-158">This will create a 550MB system partition and then after a reboot, you can use Diskpart toocheck hello volumes, and proceed.</span></span>  

<span data-ttu-id="4b2db-159">Například:</span><span class="sxs-lookup"><span data-stu-id="4b2db-159">For example:</span></span>

```
DISKPART> list vol

  Volume ###  Ltr  Label        Fs     Type        Size     Status     Info
  ----------  ---  -----------  -----  ----------  -------  ---------  --------
  Volume 0     C                NTFS   Partition    126 GB  Healthy    Boot
  Volume 1                      NTFS   Partition    550 MB  Healthy    System
  Volume 2     D   Temporary S  NTFS   Partition     13 GB  Healthy    Pagefile
```
## <a name="see-also"></a><span data-ttu-id="4b2db-160">Viz také</span><span class="sxs-lookup"><span data-stu-id="4b2db-160">See also</span></span>
<span data-ttu-id="4b2db-161">V tomto dokumentu jste zjistili, informace o některé běžné problémy v Azure disk encryption a jak tootroubleshoot.</span><span class="sxs-lookup"><span data-stu-id="4b2db-161">In this document, you learned more about some common issues in Azure disk encryption, and how tootroubleshoot.</span></span> <span data-ttu-id="4b2db-162">Další informace o této služby a jeho schopnosti najdete v tématu:</span><span class="sxs-lookup"><span data-stu-id="4b2db-162">For more information about this service and its capability read:</span></span>

- [<span data-ttu-id="4b2db-163">Použít šifrování disku v Azure Security Center</span><span class="sxs-lookup"><span data-stu-id="4b2db-163">Apply disk encryption in Azure Security Center</span></span>](https://docs.microsoft.com/azure/security-center/security-center-apply-disk-encryption)
- [<span data-ttu-id="4b2db-164">Šifrování virtuálního počítače Azure</span><span class="sxs-lookup"><span data-stu-id="4b2db-164">Encrypt an Azure Virtual Machine</span></span>](https://docs.microsoft.com/azure/security-center/security-center-disk-encryption)
- [<span data-ttu-id="4b2db-165">Šifrování na Rest Azure dat</span><span class="sxs-lookup"><span data-stu-id="4b2db-165">Azure Data Encryption-at-Rest</span></span>](https://docs.microsoft.com/azure/security/azure-security-encryption-atrest)

---
title: "Rozšíření Azure MFA serveru NPS nakonfigurovat | Microsoft Docs"
description: "Po instalaci rozšíření serveru NPS, tyto kroky použijte pro pokročilou konfiguraci, jako je vytvoření seznamu povolených IP a nahrazení UPN."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/14/2017
ms.author: kgremban
ms.reviewer: yossib
ms.custom: it-pro
ms.openlocfilehash: ef922668f080b8f02f07c2f9724f5a98171fb754
ms.sourcegitcommit: 422efcbac5b6b68295064bd545132fcc98349d01
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/29/2017
---
# <a name="advanced-configuration-options-for-the-nps-extension-for-multi-factor-authentication"></a><span data-ttu-id="367e5-103">Upřesnit možnosti konfigurace pro NPS rozšíření pro službu Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="367e5-103">Advanced configuration options for the NPS extension for Multi-Factor Authentication</span></span>

<span data-ttu-id="367e5-104">Rozšíření serveru NPS (Network Policy Server) rozšiřuje vaše cloudové funkce Azure Multi-Factor Authentication do místní infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="367e5-104">The Network Policy Server (NPS) extension extends your cloud-based Azure Multi-Factor Authentication features into your on-premises infrastructure.</span></span> <span data-ttu-id="367e5-105">Tento článek předpokládá už máte rozšíření nainstalovat a teď chcete vědět, jak přizpůsobit rozšíření pro vás potřebám.</span><span class="sxs-lookup"><span data-stu-id="367e5-105">This article assumes that you already have the extension installed, and now want to know how to customize the extension for you needs.</span></span> 

## <a name="alternate-login-id"></a><span data-ttu-id="367e5-106">Alternativním přihlašovacím ID</span><span class="sxs-lookup"><span data-stu-id="367e5-106">Alternate login ID</span></span>

<span data-ttu-id="367e5-107">Vzhledem k tomu, že rozšíření NPS se připojí k místní a cloudové adresáře, můžete setkat s problémem, kdy se hlavní názvy vaše místní uživatele (UPN) neshodují názvy v cloudu.</span><span class="sxs-lookup"><span data-stu-id="367e5-107">Since the NPS extension connects to both your on-premises and cloud directories, you might encounter an issue where your on-premises user principal names (UPNs) don't match the names in the cloud.</span></span> <span data-ttu-id="367e5-108">Chcete-li tento problém vyřešit, použijte alternativních přihlašovacích ID.</span><span class="sxs-lookup"><span data-stu-id="367e5-108">To solve this problem, use alternate login IDs.</span></span> 

<span data-ttu-id="367e5-109">V rámci rozšíření serveru NPS můžete určit atributů služby Active Directory, který má být použit místo názvu UPN pro Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="367e5-109">Within the NPS extension, you can designate an Active Directory attribute to be used in place of the UPN for Azure Multi-Factor Authentication.</span></span> <span data-ttu-id="367e5-110">To umožňuje chránit místní prostředky s dvoustupnovym overovanim beze změny vaší místní UPN.</span><span class="sxs-lookup"><span data-stu-id="367e5-110">This enables you to protect your on-premises resources with two-step verification without modifying your on-premises UPNs.</span></span> 

<span data-ttu-id="367e5-111">Konfigurace alternativního přihlašovacího ID, přejděte na `HKLM\SOFTWARE\Microsoft\AzureMfa` a upravit následující hodnoty registru:</span><span class="sxs-lookup"><span data-stu-id="367e5-111">To configure alternate login IDs, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and edit the following registry values:</span></span>

| <span data-ttu-id="367e5-112">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="367e5-112">Name</span></span> | <span data-ttu-id="367e5-113">Typ</span><span class="sxs-lookup"><span data-stu-id="367e5-113">Type</span></span> | <span data-ttu-id="367e5-114">Výchozí hodnota</span><span class="sxs-lookup"><span data-stu-id="367e5-114">Default value</span></span> | <span data-ttu-id="367e5-115">Popis</span><span class="sxs-lookup"><span data-stu-id="367e5-115">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="367e5-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span><span class="sxs-lookup"><span data-stu-id="367e5-116">LDAP_ALTERNATE_LOGINID_ATTRIBUTE</span></span> | <span data-ttu-id="367e5-117">Řetězec</span><span class="sxs-lookup"><span data-stu-id="367e5-117">string</span></span> | <span data-ttu-id="367e5-118">prázdný</span><span class="sxs-lookup"><span data-stu-id="367e5-118">Empty</span></span> | <span data-ttu-id="367e5-119">Určete název atributu služby Active Directory, který chcete použít místo názvu UPN.</span><span class="sxs-lookup"><span data-stu-id="367e5-119">Designate the name of Active Directory attribute that you want to use instead of the UPN.</span></span> <span data-ttu-id="367e5-120">Tento atribut slouží jako atribut AlternateLoginId.</span><span class="sxs-lookup"><span data-stu-id="367e5-120">This attribute is used as the AlternateLoginId attribute.</span></span> <span data-ttu-id="367e5-121">Pokud tato hodnota registru nastavena na [platný atribut služby Active Directory](https://msdn.microsoft.com/library/ms675090.aspx) (například e-mailu nebo displayName), pak hodnota atributu je použít místo uživatele (UPN) pro ověřování.</span><span class="sxs-lookup"><span data-stu-id="367e5-121">If this registry value is set to a [valid Active Directory attribute](https://msdn.microsoft.com/library/ms675090.aspx) (for example, mail or displayName), then the attribute's value is used in place of the user's UPN for authentication.</span></span> <span data-ttu-id="367e5-122">Pokud tato hodnota registru není prázdný, nebo není nakonfigurováno, pak je zakázána AlternateLoginId a uživatele (UPN) se používá k ověřování.</span><span class="sxs-lookup"><span data-stu-id="367e5-122">If this registry value is empty or not configured, then AlternateLoginId is disabled and the user's UPN is used for authentication.</span></span> |
| <span data-ttu-id="367e5-123">LDAP_FORCE_GLOBAL_CATALOG</span><span class="sxs-lookup"><span data-stu-id="367e5-123">LDAP_FORCE_GLOBAL_CATALOG</span></span> | <span data-ttu-id="367e5-124">Logická hodnota</span><span class="sxs-lookup"><span data-stu-id="367e5-124">boolean</span></span> | <span data-ttu-id="367e5-125">False</span><span class="sxs-lookup"><span data-stu-id="367e5-125">False</span></span> | <span data-ttu-id="367e5-126">Pomocí tohoto příznaku při vyhledávání AlternateLoginId vynutit použití globálního katalogu pro hledání LDAP.</span><span class="sxs-lookup"><span data-stu-id="367e5-126">Use this flag to force the use of Global Catalog for LDAP searches when looking up AlternateLoginId.</span></span> <span data-ttu-id="367e5-127">Konfigurace řadiče domény jako globální katalog, přidejte atribut AlternateLoginId do globálního katalogu a potom povolte tento příznak.</span><span class="sxs-lookup"><span data-stu-id="367e5-127">Configure a domain controller as a Global Catalog, add the AlternateLoginId attribute to the Global Catalog, and then enable this flag.</span></span> <br><br> <span data-ttu-id="367e5-128">Pokud je nakonfigurovaný (není prázdná), LDAP_LOOKUP_FORESTS **tento příznak se vynucuje jako true**, bez ohledu na to hodnota nastavení registru.</span><span class="sxs-lookup"><span data-stu-id="367e5-128">If LDAP_LOOKUP_FORESTS is configured (not empty), **this flag is enforced as true**, regardless of the value of the registry setting.</span></span> <span data-ttu-id="367e5-129">V takovém případě rozšíření NPS vyžaduje globální katalog nakonfigurovat s atributem AlternateLoginId pro jednotlivé doménové struktury.</span><span class="sxs-lookup"><span data-stu-id="367e5-129">In this case, the NPS extension requires the Global Catalog to be configured with the AlternateLoginId attribute for each forest.</span></span> |
| <span data-ttu-id="367e5-130">LDAP_LOOKUP_FORESTS</span><span class="sxs-lookup"><span data-stu-id="367e5-130">LDAP_LOOKUP_FORESTS</span></span> | <span data-ttu-id="367e5-131">Řetězec</span><span class="sxs-lookup"><span data-stu-id="367e5-131">string</span></span> | <span data-ttu-id="367e5-132">prázdný</span><span class="sxs-lookup"><span data-stu-id="367e5-132">Empty</span></span> | <span data-ttu-id="367e5-133">Zadejte středníky oddělený seznam doménové struktury pro vyhledávání.</span><span class="sxs-lookup"><span data-stu-id="367e5-133">Provide a semi-colon separated list of forests to search.</span></span> <span data-ttu-id="367e5-134">Například *contoso.com;foobar.com*.</span><span class="sxs-lookup"><span data-stu-id="367e5-134">For example, *contoso.com;foobar.com*.</span></span> <span data-ttu-id="367e5-135">Pokud je tato hodnota registru nakonfigurovaný, vyhledá rozšíření NPS interaktivně všech doménových strukturách v pořadí, ve kterém byly uvedeny a vrátí první hodnotu AlternateLoginId úspěšné.</span><span class="sxs-lookup"><span data-stu-id="367e5-135">If this registry value is configured, the NPS extension iteratively searches all the forests in the order in which they were listed, and returns the first successful AlternateLoginId value.</span></span> <span data-ttu-id="367e5-136">Pokud tato hodnota registru není nakonfigurováno, se vyhledávání AlternateLoginId jen do aktuální domény.</span><span class="sxs-lookup"><span data-stu-id="367e5-136">If this registry value is not configured, the AlternateLoginId lookup is confined to the current domain.</span></span>|

<span data-ttu-id="367e5-137">Chcete-li vyřešit potíže s alternativním přihlašovacím ID, použijte doporučené kroky pro [alternativní přihlašovací ID chyby](multi-factor-authentication-nps-errors.md#alternate-login-id-errors).</span><span class="sxs-lookup"><span data-stu-id="367e5-137">To troubleshoot problems with alternate login IDs, use the recommended steps for [Alternate login ID errors](multi-factor-authentication-nps-errors.md#alternate-login-id-errors).</span></span>

## <a name="ip-exceptions"></a><span data-ttu-id="367e5-138">Výjimky IP</span><span class="sxs-lookup"><span data-stu-id="367e5-138">IP exceptions</span></span>

<span data-ttu-id="367e5-139">Pokud je nutné sledovat dostupnost serveru, například pokud ověřte nástroje pro vyrovnávání zatížení serverů, které jsou spuštěny před odesláním úloh, nechcete, aby tyto kontroly zablokuje žádostmi o ověření.</span><span class="sxs-lookup"><span data-stu-id="367e5-139">If you need to monitor server availability, like if load balancers verify which servers are running before sending workloads, you don't want these checks to be blocked by verification requests.</span></span> <span data-ttu-id="367e5-140">Místo toho vytvořte seznam IP adres, které znáte používají účty služeb a zakázání služby Multi-Factor Authentication požadavky pro tento seznam.</span><span class="sxs-lookup"><span data-stu-id="367e5-140">Instead, create a list of IP addresses that you know are used by service accounts, and disable Multi-Factor Authentication requirements for that list.</span></span> 

<span data-ttu-id="367e5-141">Chcete-li nakonfigurovat seznam povolených IP adres, přejděte na `HKLM\SOFTWARE\Microsoft\AzureMfa` a nakonfigurujte následující hodnotu registru:</span><span class="sxs-lookup"><span data-stu-id="367e5-141">To configure an IP whitelist, go to `HKLM\SOFTWARE\Microsoft\AzureMfa` and configure the following registry value:</span></span> 

| <span data-ttu-id="367e5-142">Name (Název)</span><span class="sxs-lookup"><span data-stu-id="367e5-142">Name</span></span> | <span data-ttu-id="367e5-143">Typ</span><span class="sxs-lookup"><span data-stu-id="367e5-143">Type</span></span> | <span data-ttu-id="367e5-144">Výchozí hodnota</span><span class="sxs-lookup"><span data-stu-id="367e5-144">Default value</span></span> | <span data-ttu-id="367e5-145">Popis</span><span class="sxs-lookup"><span data-stu-id="367e5-145">Description</span></span> |
| ---- | ---- | ------------- | ----------- |
| <span data-ttu-id="367e5-146">IP_WHITELIST</span><span class="sxs-lookup"><span data-stu-id="367e5-146">IP_WHITELIST</span></span> | <span data-ttu-id="367e5-147">Řetězec</span><span class="sxs-lookup"><span data-stu-id="367e5-147">string</span></span> | <span data-ttu-id="367e5-148">prázdný</span><span class="sxs-lookup"><span data-stu-id="367e5-148">Empty</span></span> | <span data-ttu-id="367e5-149">Zadejte středníky oddělený seznam IP adres.</span><span class="sxs-lookup"><span data-stu-id="367e5-149">Provide a semi-colon separated list of IP addresses.</span></span> <span data-ttu-id="367e5-150">Zahrnují IP adresy počítačů, kde žádosti o služby mají původ, třeba server NAS nebo virtuální privátní sítě.</span><span class="sxs-lookup"><span data-stu-id="367e5-150">Include the IP addresses of machines where service requests originate, like the NAS/VPN server.</span></span> <span data-ttu-id="367e5-151">Rozsahy IP jsou podsítě nejsou podporovány.</span><span class="sxs-lookup"><span data-stu-id="367e5-151">IP ranges are subnets are not supported.</span></span> <br><br> <span data-ttu-id="367e5-152">Například *10.0.0.1;10.0.0.2;10.0.0.3*.</span><span class="sxs-lookup"><span data-stu-id="367e5-152">For example, *10.0.0.1;10.0.0.2;10.0.0.3*.</span></span>

<span data-ttu-id="367e5-153">Když přijde žádost z IP adresy, která existuje v seznamu povolených serverů, bylo přeskočeno dvoustupňové ověřování.</span><span class="sxs-lookup"><span data-stu-id="367e5-153">When a request comes in from an IP address that exists in the whitelist, two-step verification is skipped.</span></span> <span data-ttu-id="367e5-154">Seznam povolených IP adres se porovná na IP adresu, která je součástí *ratNASIPAddress* atribut požadavku protokolu RADIUS.</span><span class="sxs-lookup"><span data-stu-id="367e5-154">The IP whitelist is compared to the IP address that is provided in the *ratNASIPAddress* attribute of the RADIUS request.</span></span> <span data-ttu-id="367e5-155">Pokud požadavku protokolu RADIUS dodává bez atribut ratNASIPAddress, zaznamená se následující upozornění: "P_WHITE_LIST_WARNING::IP povolených je ignorován jako zdrojové IP adresy chybí v požadavku protokolu RADIUS v atributu NasIpAddress."</span><span class="sxs-lookup"><span data-stu-id="367e5-155">If a RADIUS request comes in without the ratNASIPAddress attribute, the following warning is logged: "P_WHITE_LIST_WARNING::IP Whitelist is being ignored as source IP is missing in RADIUS request in NasIpAddress attribute."</span></span>

## <a name="next-steps"></a><span data-ttu-id="367e5-156">Další kroky</span><span class="sxs-lookup"><span data-stu-id="367e5-156">Next steps</span></span>

[<span data-ttu-id="367e5-157">řešení chybových zpráv z rozšíření NPS pro Azure Multi-Factor Authentication</span><span class="sxs-lookup"><span data-stu-id="367e5-157">Resolve error messages from the NPS extension for Azure Multi-Factor Authentication</span></span>](multi-factor-authentication-nps-errors.md)
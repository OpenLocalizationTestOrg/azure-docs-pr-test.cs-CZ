---
title: MFA Server s AD FS ve Windows Serveru | Dokumentace Microsoftu
description: "Tento článek popisuje, jak začít se službami Azure Multi-Factor Authentication a AD FS v systému Windows Server 2012 R2 a 2016."
services: multi-factor-authentication
documentationcenter: 
author: kgremban
manager: femila
editor: yossib
ms.assetid: 57208068-1e55-45b6-840f-fdcd13723074
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: get-started-article
ms.date: 03/29/2017
ms.author: kgremban
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: f2481c18f12d74a90938ffb0353dd000fe73f440
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="configure-azure-multi-factor-authentication-server-to-work-with-ad-fs-in-windows-server"></a><span data-ttu-id="41462-103">Konfigurace serveru Azure Multi-Factor Authentication pro práci se službou AD FS ve Windows Serveru</span><span class="sxs-lookup"><span data-stu-id="41462-103">Configure Azure Multi-Factor Authentication Server to work with AD FS in Windows Server</span></span>
<span data-ttu-id="41462-104">Pokud používáte službu AD FS (Active Directory Federation Services) a chcete zabezpečit cloudové nebo místní prostředky, můžete nakonfigurovat Azure Multi-Factor Authentication Server pro práci se službou AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-104">If you use Active Directory Federation Services (AD FS) and want to secure cloud or on-premises resources, you can configure Azure Multi-Factor Authentication Server to work with AD FS.</span></span> <span data-ttu-id="41462-105">Tato konfigurace aktivuje u citlivých koncových bodů dvoustupňové ověřování.</span><span class="sxs-lookup"><span data-stu-id="41462-105">This configuration triggers two-step verification for high-value endpoints.</span></span>

<span data-ttu-id="41462-106">V tomto článku se podíváme na to, jak používat Azure Multi-Factor Authentication Server s AD FS v systému Windows Server 2012 R2 nebo Windows Server 2016.</span><span class="sxs-lookup"><span data-stu-id="41462-106">In this article, we discuss using Azure Multi-Factor Authentication Server with AD FS in Windows Server 2012 R2 or Windows Server 2016.</span></span> <span data-ttu-id="41462-107">Další informace najdete v tématu [Zabezpečení cloudových a lokálních prostředků pomocí Microsoft Azure Multi-Factor Authentication Serveru s AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span><span class="sxs-lookup"><span data-stu-id="41462-107">For more information, read about how to [secure cloud and on-premises resources by using Azure Multi-Factor Authentication Server with AD FS 2.0](multi-factor-authentication-get-started-adfs-adfs2.md).</span></span>

## <a name="secure-windows-server-ad-fs-with-azure-multi-factor-authentication-server"></a><span data-ttu-id="41462-108">Zabezpečení Windows Serveru AD FS pomocí Azure Multi-Factor Authentication Serveru</span><span class="sxs-lookup"><span data-stu-id="41462-108">Secure Windows Server AD FS with Azure Multi-Factor Authentication Server</span></span>
<span data-ttu-id="41462-109">Azure Multi-Factor Authentication Server můžete instalovat různě:</span><span class="sxs-lookup"><span data-stu-id="41462-109">When you install Azure Multi-Factor Authentication Server, you have the following options:</span></span>

* <span data-ttu-id="41462-110">Nainstalujte Azure Multi-Factor Authentication Server lokálně na stejném serveru jako AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-110">Install Azure Multi-Factor Authentication Server locally on the same server as AD FS</span></span>
* <span data-ttu-id="41462-111">Nainstalujte adaptér Azure Multi-Factor Authentication místně na server AD FS a Multi-Factor Authentication Server potom nainstalujte na jiný počítač.</span><span class="sxs-lookup"><span data-stu-id="41462-111">Install the Azure Multi-Factor Authentication adapter locally on the AD FS server, and then install Multi-Factor Authentication Server on a different computer</span></span>

<span data-ttu-id="41462-112">Před zahájením se ujistěte, že znáte následující informace:</span><span class="sxs-lookup"><span data-stu-id="41462-112">Before you begin, be aware of the following information:</span></span>

* <span data-ttu-id="41462-113">Azure Multi-Factor Authentication Server není potřeba instalovat na váš server AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-113">You are not required to install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="41462-114">Na Windows Server 2012 R2 nebo Windows Server 2016, kde běží služba AD FS, je pak ale nutné nainstalovat adaptér Multi-Factor Authentication pro AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-114">However, you must install the Multi-Factor Authentication adapter for AD FS on a Windows Server 2012 R2 or Windows Server 2016 that is running AD FS.</span></span> <span data-ttu-id="41462-115">Server můžete nainstalovat na jiný počítač, pokud se jedná o podporovanou verzi, a adaptér AD FS potom nainstalujete samostatně na federační server AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-115">You can install the server on a different computer if it is a supported version and you install the AD FS adapter separately on your AD FS federation server.</span></span> <span data-ttu-id="41462-116">Samostatně adaptér instalujte podle následujících postupů.</span><span class="sxs-lookup"><span data-stu-id="41462-116">See the following procedures to learn how to install the adapter separately.</span></span>
* <span data-ttu-id="41462-117">Pokud v organizaci používáte metody ověření pomocí textové zprávy nebo mobilní aplikace, řetězce definované v Nastavení společnosti obsahují zástupný text „<$*application_name*$>“.</span><span class="sxs-lookup"><span data-stu-id="41462-117">If your organization is using text message or mobile app verification methods, the strings defined in Company Settings contain a placeholder, <$*application_name*$>.</span></span> <span data-ttu-id="41462-118">V MFA Serveru verze 7.1 můžete zadat název aplikace, který nahrazuje tento zástupný text.</span><span class="sxs-lookup"><span data-stu-id="41462-118">In MFA Server v7.1, you can provide an application name that replaces this placeholder.</span></span> <span data-ttu-id="41462-119">Ve verzi 7.0 nebo dřívější se tento zástupný text při použití adaptéru AD FS nenahradí automaticky.</span><span class="sxs-lookup"><span data-stu-id="41462-119">In v7.0 or older, this placeholder is not automatically replaced when you use the AD FS adapter.</span></span> <span data-ttu-id="41462-120">U těchto starších verzí při zabezpečování AD FS odeberte tento zástupný text z příslušných řetězců.</span><span class="sxs-lookup"><span data-stu-id="41462-120">For those older versions, remove the placeholder from the appropriate strings when you secure AD FS.</span></span>
* <span data-ttu-id="41462-121">Účet, se kterým se přihlašujete, musí mít uživatelská práva k vytváření skupin zabezpečení ve službě Active Directory.</span><span class="sxs-lookup"><span data-stu-id="41462-121">The account that you use to sign in must have user rights to create security groups in your Active Directory service.</span></span>
* <span data-ttu-id="41462-122">Průvodce instalací adaptéru Multi-Factor Authentication AD FS vytvoří v instanci Active Directory skupinu zabezpečení s názvem PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="41462-122">The Multi-Factor Authentication AD FS adapter installation wizard creates a security group called PhoneFactor Admins in your instance of Active Directory.</span></span> <span data-ttu-id="41462-123">Potom přidá účet služby AD FS vaší služby federace do této skupiny.</span><span class="sxs-lookup"><span data-stu-id="41462-123">It then adds the AD FS service account of your federation service to this group.</span></span> <span data-ttu-id="41462-124">V řadiči domény ověřte, že se skupina PhoneFactor Admins opravdu vytvořila a mezi jejími členy je účet služby AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-124">Verify on your domain controller that the PhoneFactor Admins group is indeed created and that the AD FS service account is a member of this group.</span></span> <span data-ttu-id="41462-125">Pokud je to nutné, přidejte v řadiči domény účet služby AD FS do skupiny PhoneFactor Admins ručně.</span><span class="sxs-lookup"><span data-stu-id="41462-125">If necessary, manually add the AD FS service account to the PhoneFactor Admins group on your domain controller.</span></span>
* <span data-ttu-id="41462-126">Informace o tom, jak instalovat sadu SDK webové služby pomocí uživatelského portálu, najdete v tématu [Nasazení uživatelského portálu pro Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span><span class="sxs-lookup"><span data-stu-id="41462-126">For information about installing the Web Service SDK with the user portal, read about [deploying the user portal for Azure Multi-Factor Authentication Server.](multi-factor-authentication-get-started-portal.md)</span></span>

### <a name="install-azure-multi-factor-authentication-server-locally-on-the-ad-fs-server"></a><span data-ttu-id="41462-127">Instalace Azure Multi-Factor Authentication Server místně na serveru AD FS</span><span class="sxs-lookup"><span data-stu-id="41462-127">Install Azure Multi-Factor Authentication Server locally on the AD FS server</span></span>
1. <span data-ttu-id="41462-128">Stáhněte a nainstalujte Azure Multi-Factor Authentication Server na server AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-128">Download and install Azure Multi-Factor Authentication Server on your AD FS server.</span></span> <span data-ttu-id="41462-129">Informace o instalaci se dočtete v tématu [Začínáme s Azure Multi-Factor Authentication Serverem](multi-factor-authentication-get-started-server.md).</span><span class="sxs-lookup"><span data-stu-id="41462-129">For installation information, read about [getting started with Azure Multi-Factor Authentication Server](multi-factor-authentication-get-started-server.md).</span></span>
2. <span data-ttu-id="41462-130">Na Azure Multi-Factor Authentication Serveru klikněte na ikonu **AD FS**.</span><span class="sxs-lookup"><span data-stu-id="41462-130">In the Azure Multi-Factor Authentication Server management console, click the **AD FS** icon.</span></span> <span data-ttu-id="41462-131">Vyberte možnosti **Povolit zápis uživatele** a **Povolit uživatelům výběr metody**.</span><span class="sxs-lookup"><span data-stu-id="41462-131">Select the options **Allow user enrollment** and **Allow users to select method**.</span></span>
3. <span data-ttu-id="41462-132">Vyberte další možnosti, které byste chtěli pro svou organizaci nastavit.</span><span class="sxs-lookup"><span data-stu-id="41462-132">Select any additional options you'd like to specify for your organization.</span></span>
4. <span data-ttu-id="41462-133">Klikněte na **Instalovat adaptér služby AD FS**.</span><span class="sxs-lookup"><span data-stu-id="41462-133">Click **Install AD FS Adapter**.</span></span>
   
   <span data-ttu-id="41462-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span><span class="sxs-lookup"><span data-stu-id="41462-134"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/server.png)</center></span></span>

5. <span data-ttu-id="41462-135">Pokud se zobrazí okno služby Active Directory, znamená to dvě věci.</span><span class="sxs-lookup"><span data-stu-id="41462-135">If the Active Directory window is displayed, that means two things.</span></span> <span data-ttu-id="41462-136">Počítač je připojený k doméně a konfigurace Active Directory pro zabezpečení komunikace mezi adaptérem AD FS a ověřovací službou Multi-Factor Authentication není kompletní.</span><span class="sxs-lookup"><span data-stu-id="41462-136">Your computer is joined to a domain, and the Active Directory configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="41462-137">Kliknutím na možnost **Další** konfiguraci automaticky dokončíte. Nebo můžete zaškrtnout políčko **Vynechat automatickou konfiguraci služby Active Directory a konfigurovat nastavení ručně**.</span><span class="sxs-lookup"><span data-stu-id="41462-137">Click **Next** to automatically complete this configuration, or select the **Skip automatic Active Directory configuration and configure settings manually** check box.</span></span> <span data-ttu-id="41462-138">Klikněte na **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-138">Click **Next**.</span></span>
6. <span data-ttu-id="41462-139">Pokud se zobrazí okno místní skupiny, znamená to dvě věci.</span><span class="sxs-lookup"><span data-stu-id="41462-139">If the Local Group windows is displayed, that means two things.</span></span> <span data-ttu-id="41462-140">Počítač není připojený k doméně a konfigurace místní skupiny pro zabezpečení komunikace mezi adaptérem AD FS a ověřovací službou Multi-Factor Authentication není kompletní.</span><span class="sxs-lookup"><span data-stu-id="41462-140">Your computer is not joined to a domain, and the local group configuration for securing communication between the AD FS adapter and the Multi-Factor Authentication service is incomplete.</span></span> <span data-ttu-id="41462-141">Kliknutím na možnost **Další** konfiguraci automaticky dokončíte. Nebo můžete zaškrtnout políčko **Vynechat automatickou konfiguraci místní skupiny a konfigurovat nastavení ručně**.</span><span class="sxs-lookup"><span data-stu-id="41462-141">Click **Next** to automatically complete this configuration, or select the **Skip automatic Local Group configuration and configure settings manually** check box.</span></span> <span data-ttu-id="41462-142">Klikněte na **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-142">Click **Next**.</span></span>
7. <span data-ttu-id="41462-143">V průvodci instalací klikněte na tlačítko **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-143">In the installation wizard, click **Next**.</span></span> <span data-ttu-id="41462-144">Azure Multi-Factor Authentication Server vytvoří skupinu PhoneFactor Admins a přidá do ní účet služby AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-144">Azure Multi-Factor Authentication Server creates the PhoneFactor Admins group and adds the AD FS service account to the PhoneFactor Admins group.</span></span>
   <span data-ttu-id="41462-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span><span class="sxs-lookup"><span data-stu-id="41462-145"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/adapter.png)</center></span></span>
8. <span data-ttu-id="41462-146">V kroku **Spustit instalační program** klikněte na **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-146">On the **Launch Installer** page, click **Next**.</span></span>
9. <span data-ttu-id="41462-147">V instalačním programu adaptéru Multi-Factor Authentication AD FS klikněte na **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-147">In the Multi-Factor Authentication AD FS adapter installer, click **Next**.</span></span>
10. <span data-ttu-id="41462-148">Po dokončení instalace klikněte na **Zavřít**.</span><span class="sxs-lookup"><span data-stu-id="41462-148">Click **Close** when the installation is finished.</span></span>
11. <span data-ttu-id="41462-149">Nainstalovaný adaptér je třeba zaregistrovat ve službě AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-149">When the adapter has been installed, you must register it with AD FS.</span></span> <span data-ttu-id="41462-150">Otevřete Windows PowerShell a spusťte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="41462-150">Open Windows PowerShell and run the following command:</span></span><br><span data-ttu-id="41462-151">
    `C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
    <center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span><span class="sxs-lookup"><span data-stu-id="41462-151">
`C:\Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1`
<center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/pshell.png)</center></span></span>
12. <span data-ttu-id="41462-152">Upravte globální zásady ověřování ve službě AD FS tak, abyste mohli nově zaregistrovaný adaptér použít.</span><span class="sxs-lookup"><span data-stu-id="41462-152">To use your newly registered adapter, edit the global authentication policy in AD FS.</span></span> <span data-ttu-id="41462-153">V konzole pro správu služby AD FS přejděte k uzlu **Zásady ověřování**.</span><span class="sxs-lookup"><span data-stu-id="41462-153">In the AD FS management console, go to the **Authentication Policies** node.</span></span> <span data-ttu-id="41462-154">V oddílu **Multi-Factor Authentication** klikněte na odkaz **Upravit** vedle oddílu **Globální nastavení**.</span><span class="sxs-lookup"><span data-stu-id="41462-154">In the **Multi-factor Authentication** section, click the **Edit** link next to the **Global Settings** section.</span></span> <span data-ttu-id="41462-155">V okně **Upravit globální zásady ověření** vyberte jako další metodu ověření **Multi-Factor Authentication** a klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="41462-155">In the **Edit Global Authentication Policy** window, select **Multi-Factor Authentication** as an additional authentication method, and then click **OK**.</span></span> <span data-ttu-id="41462-156">Adaptér je zaregistrovaný jako WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="41462-156">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="41462-157">Restartujte službu AD FS, aby se registrace projevila.</span><span class="sxs-lookup"><span data-stu-id="41462-157">Restart the AD FS service for the registration to take effect.</span></span>

<span data-ttu-id="41462-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span><span class="sxs-lookup"><span data-stu-id="41462-158"><center>![Cloud](./media/multi-factor-authentication-get-started-adfs-w2k12/global.png)</center></span></span>

<span data-ttu-id="41462-159">Multi-Factor Authentication Server máte teď nastavený jako dodatečného poskytovatele ověření vedle služby AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-159">At this point, Multi-Factor Authentication Server is set up to be an additional authentication provider to use with AD FS.</span></span>

## <a name="install-a-standalone-instance-of-the-ad-fs-adapter-by-using-the-web-service-sdk"></a><span data-ttu-id="41462-160">Samostatná instalace adaptéru AD FS pomocí sady SDK webové služby</span><span class="sxs-lookup"><span data-stu-id="41462-160">Install a standalone instance of the AD FS adapter by using the Web Service SDK</span></span>
1. <span data-ttu-id="41462-161">Nainstalujte sadu SDK webové služby na server, kde běží Multi-Factor Authentication Server.</span><span class="sxs-lookup"><span data-stu-id="41462-161">Install the Web Service SDK on the server that is running Multi-Factor Authentication Server.</span></span>
2. <span data-ttu-id="41462-162">Z adresáře \Program Files\Multi-Factor Authentication Server zkopírujte na server, kam plánujete nainstalovat adaptér služby AD FS, tyto soubory:</span><span class="sxs-lookup"><span data-stu-id="41462-162">Copy the following files from the \Program Files\Multi-Factor Authentication Server directory to the server on which you plan to install the AD FS adapter:</span></span>
   * <span data-ttu-id="41462-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span><span class="sxs-lookup"><span data-stu-id="41462-163">MultiFactorAuthenticationAdfsAdapterSetup64.msi</span></span>
   * <span data-ttu-id="41462-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="41462-164">Register-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="41462-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span><span class="sxs-lookup"><span data-stu-id="41462-165">Unregister-MultiFactorAuthenticationAdfsAdapter.ps1</span></span>
   * <span data-ttu-id="41462-166">MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="41462-166">MultiFactorAuthenticationAdfsAdapter.config</span></span>
3. <span data-ttu-id="41462-167">Spusťte instalační soubor MultiFactorAuthenticationAdfsAdapterSetup64.msi.</span><span class="sxs-lookup"><span data-stu-id="41462-167">Run the MultiFactorAuthenticationAdfsAdapterSetup64.msi installation file.</span></span>
4. <span data-ttu-id="41462-168">V instalačním programu adaptéru Multi-Factor Authentication AD FS spusťte instalaci kliknutím na tlačítko **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-168">In the Multi-Factor Authentication AD FS adapter installer, click **Next** to start the installation.</span></span>
5. <span data-ttu-id="41462-169">Po dokončení instalace klikněte na **Zavřít**.</span><span class="sxs-lookup"><span data-stu-id="41462-169">Click **Close** when the installation is finished.</span></span>

## <a name="edit-the-multifactorauthenticationadfsadapterconfig-file"></a><span data-ttu-id="41462-170">Úprava souboru MultiFactorAuthenticationAdfsAdapter.config</span><span class="sxs-lookup"><span data-stu-id="41462-170">Edit the MultiFactorAuthenticationAdfsAdapter.config file</span></span>
<span data-ttu-id="41462-171">Postupujte podle těchto kroků a upravte soubor MultiFactorAuthenticationAdfsAdapter.config:</span><span class="sxs-lookup"><span data-stu-id="41462-171">Follow these steps to edit the MultiFactorAuthenticationAdfsAdapter.config file:</span></span>

1. <span data-ttu-id="41462-172">Uzel **UseWebServiceSdk** nastavte na **true**.</span><span class="sxs-lookup"><span data-stu-id="41462-172">Set the **UseWebServiceSdk** node to **true**.</span></span>  
2. <span data-ttu-id="41462-173">Hodnotu **WebServiceSdkUrl** nastavte na URL sady SDK webové služby pro Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="41462-173">Set the value for **WebServiceSdkUrl** to the URL of the Multi-Factor Authentication Web Service SDK.</span></span> <span data-ttu-id="41462-174">Například: *https://contoso.com/&lt;název_certifikátu&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, kde *název_certifikátu* je název vašeho certifikátu.</span><span class="sxs-lookup"><span data-stu-id="41462-174">For example:  *https://contoso.com/&lt;certificatename&gt;/MultiFactorAuthWebServiceSdk/PfWsSdk.asmx*, Where *certificatename* is the name of your certificate.</span></span>  
3. <span data-ttu-id="41462-175">Upravte skript Register-MultiFactorAuthenticationAdfsAdapter.ps1 tak, že na konec příkazu `Register-AdfsAuthenticationProvider` přidáte *-ConfigurationFilePath &lt;cesta&gt;*, kde *&lt;cesta&gt;* je úplná cesta k souboru MultiFactorAuthenticationAdfsAdapter.config.</span><span class="sxs-lookup"><span data-stu-id="41462-175">Edit the Register-MultiFactorAuthenticationAdfsAdapter.ps1 script by adding *-ConfigurationFilePath &lt;path&gt;* to the end of the `Register-AdfsAuthenticationProvider` command, where *&lt;path&gt;* is the full path to the MultiFactorAuthenticationAdfsAdapter.config file.</span></span>

### <a name="configure-the-web-service-sdk-with-a-username-and-password"></a><span data-ttu-id="41462-176">Konfigurace sady SDK webové služby pomocí uživatelského jména a hesla</span><span class="sxs-lookup"><span data-stu-id="41462-176">Configure the Web Service SDK with a username and password</span></span>
<span data-ttu-id="41462-177">Por konfiguraci sady SDK webové služby existují dvě možnosti.</span><span class="sxs-lookup"><span data-stu-id="41462-177">There are two options for configuring the Web Service SDK.</span></span> <span data-ttu-id="41462-178">První možností je použití uživatelského jména a hesla, druhou je použití klientského certifikátu.</span><span class="sxs-lookup"><span data-stu-id="41462-178">The first is with a username and password, the second is with a client certificate.</span></span> <span data-ttu-id="41462-179">Pro první možnost postupujte podle těchto kroků, nebo je přeskočte, pokud chcete použít druhou možnost.</span><span class="sxs-lookup"><span data-stu-id="41462-179">Follow these steps for the first option, or skip ahead for the second.</span></span>  

1. <span data-ttu-id="41462-180">Hodnotu **WebServiceSdkUsername** nastavte na účet, který je členem skupiny zabezpečení PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="41462-180">Set the value for **WebServiceSdkUsername** to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="41462-181">Zadávejte ve formátu &lt;doména&gt;&#92;&lt;uživatelské jméno&gt;.</span><span class="sxs-lookup"><span data-stu-id="41462-181">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
2. <span data-ttu-id="41462-182">Hodnotu **WebServiceSdkPassword** nastavte na odpovídající heslo k tomuto účtu.</span><span class="sxs-lookup"><span data-stu-id="41462-182">Set the value for **WebServiceSdkPassword** to the appropriate account password.</span></span>

### <a name="configure-the-web-service-sdk-with-a-client-certificate"></a><span data-ttu-id="41462-183">Konfigurace sady SDK webové služby pomocí klientského certifikátu</span><span class="sxs-lookup"><span data-stu-id="41462-183">Configure the Web Service SDK with a client certificate</span></span>
<span data-ttu-id="41462-184">Pokud nechcete použít uživatelské jméno a heslo, postupujte podle těchto kroků a nakonfigurujte sadu SDK webové služby pomocí klientského certifikátu.</span><span class="sxs-lookup"><span data-stu-id="41462-184">If you don't want to use a username and password, follow these steps to configure the Web Service SDK with a client certificate.</span></span>

1. <span data-ttu-id="41462-185">Od certifikační autority získejte klientský certifikát pro server, na kterém běží sada SDK webové služby.</span><span class="sxs-lookup"><span data-stu-id="41462-185">Obtain a client certificate from a certificate authority for the server that is running the Web Service SDK.</span></span> <span data-ttu-id="41462-186">Přečtěte si, jak [získat klientský certifikát](https://technet.microsoft.com/library/cc770328.aspx).</span><span class="sxs-lookup"><span data-stu-id="41462-186">Learn how to [obtain client certificates](https://technet.microsoft.com/library/cc770328.aspx).</span></span>  
2. <span data-ttu-id="41462-187">Importujte klientský certifikát do osobního úložiště certifikátů na místním serveru, kde běží sada SDK webové služby.</span><span class="sxs-lookup"><span data-stu-id="41462-187">Import the client certificate to the local computer personal certificate store on the server that is running the Web Service SDK.</span></span> <span data-ttu-id="41462-188">Ujistěte se, že se veřejný certifikát této autority nachází v úložišti certifikátů Důvěryhodné kořenové certifikáty.</span><span class="sxs-lookup"><span data-stu-id="41462-188">Make sure that the certificate authority's public certificate is in Trusted Root Certificates certificate store.</span></span>  
3. <span data-ttu-id="41462-189">Exportujte veřejný a privátní klíč klientského certifikátu do souboru .pfx.</span><span class="sxs-lookup"><span data-stu-id="41462-189">Export the public and private keys of the client certificate to a .pfx file.</span></span>  
4. <span data-ttu-id="41462-190">Exportujte veřejný klíč ve formátu Base64 do souboru .cer.</span><span class="sxs-lookup"><span data-stu-id="41462-190">Export the public key in Base64 format to a .cer file.</span></span>  
5. <span data-ttu-id="41462-191">Ve Správci serveru zkontrolujte, že je nainstalovaná funkce Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication.</span><span class="sxs-lookup"><span data-stu-id="41462-191">In Server Manager, verify that the Web Server (IIS)\Web Server\Security\IIS Client Certificate Mapping Authentication feature is installed.</span></span> <span data-ttu-id="41462-192">Pokud nainstalovaná není, přidejte ji kliknutím na **Přidat role a funkce**.</span><span class="sxs-lookup"><span data-stu-id="41462-192">If it is not installed, select **Add Roles and Features** to add this feature.</span></span>  
6. <span data-ttu-id="41462-193">Ve Správci IIS na webové stránce, která obsahuje virtuální adresář sady SDK webové služby, poklikejte na **Editor konfigurace**.</span><span class="sxs-lookup"><span data-stu-id="41462-193">In IIS Manager, double-click **Configuration Editor** in the website that contains the Web Service SDK virtual directory.</span></span> <span data-ttu-id="41462-194">Je důležité vybrat na web, a ne virtuální adresář.</span><span class="sxs-lookup"><span data-stu-id="41462-194">It is important to select the website, not the virtual directory.</span></span>  
7. <span data-ttu-id="41462-195">Přejděte do oddílu **system.webServer/security/authentication/iisClientCertificateMappingAuthentication**.</span><span class="sxs-lookup"><span data-stu-id="41462-195">Go to the **system.webServer/security/authentication/iisClientCertificateMappingAuthentication** section.</span></span>  
8. <span data-ttu-id="41462-196">Hodnotu enabled nastavte na **true**.</span><span class="sxs-lookup"><span data-stu-id="41462-196">Set enabled to **true**.</span></span>  
9. <span data-ttu-id="41462-197">Hodnotu oneToOneCertificateMappingsEnabled nastavte na **true**.</span><span class="sxs-lookup"><span data-stu-id="41462-197">Set oneToOneCertificateMappingsEnabled to **true**.</span></span>  
10. <span data-ttu-id="41462-198">Klikněte na tlačítko **...** vedle položky oneToOneMappings a potom klikněte na odkaz **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="41462-198">Click the **...** button next to oneToOneMappings, and then click the **Add** link.</span></span>  
11. <span data-ttu-id="41462-199">Otevřete soubor .cer s klíčem ve formátu Base64, který jste exportovali.</span><span class="sxs-lookup"><span data-stu-id="41462-199">Open the Base64 .cer file you exported earlier.</span></span> <span data-ttu-id="41462-200">Odeberte řetězce *-----BEGIN CERTIFICATE-----* a *-----END CERTIFICATE-----* a veškerá zalomení řádků.</span><span class="sxs-lookup"><span data-stu-id="41462-200">Remove *-----BEGIN CERTIFICATE-----*, *-----END CERTIFICATE-----*, and any line breaks.</span></span> <span data-ttu-id="41462-201">Výsledný řetězec zkopírujte.</span><span class="sxs-lookup"><span data-stu-id="41462-201">Copy the resulting string.</span></span>  
12. <span data-ttu-id="41462-202">Hodnotu certificate nastavte na řetězec zkopírovaný v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="41462-202">Set certificate to the string copied in the preceding step.</span></span>  
13. <span data-ttu-id="41462-203">Hodnotu enabled nastavte na **true**.</span><span class="sxs-lookup"><span data-stu-id="41462-203">Set enabled to **true**.</span></span>  
14. <span data-ttu-id="41462-204">Nastavte userName na účet, který je členem skupiny zabezpečení PhoneFactor Admins.</span><span class="sxs-lookup"><span data-stu-id="41462-204">Set userName to an account that is a member of the PhoneFactor Admins security group.</span></span> <span data-ttu-id="41462-205">Zadávejte ve formátu &lt;doména&gt;&#92;&lt;uživatelské jméno&gt;.</span><span class="sxs-lookup"><span data-stu-id="41462-205">Use the &lt;domain&gt;&#92;&lt;user name&gt; format.</span></span>  
15. <span data-ttu-id="41462-206">Heslo nastavte na odpovídající heslo k tomuto účtu a pak Editor konfigurace zavřete.</span><span class="sxs-lookup"><span data-stu-id="41462-206">Set the password to the appropriate account password, and then close Configuration Editor.</span></span>  
16. <span data-ttu-id="41462-207">Klikněte na odkaz **Použít**.</span><span class="sxs-lookup"><span data-stu-id="41462-207">Click the **Apply** link.</span></span>  
17. <span data-ttu-id="41462-208">Ve virtuálním adresáři sady SDK webové služby poklikejte na možnost **Ověřování**.</span><span class="sxs-lookup"><span data-stu-id="41462-208">In the Web Service SDK virtual directory, double-click **Authentication**.</span></span>  
18. <span data-ttu-id="41462-209">Zkontrolujte, že jsou možnosti Zosobnění technologie ASP.NET a Základní ověřování **zapnuté** a všechny ostatní položky **vypnuté**.</span><span class="sxs-lookup"><span data-stu-id="41462-209">Verify that ASP.NET Impersonation and Basic Authentication are set to **Enabled**, and that all other items are set to **Disabled**.</span></span>  
19. <span data-ttu-id="41462-210">Ve virtuálním adresáři sady SDK webové služby poklikejte na **Nastavení SSL**.</span><span class="sxs-lookup"><span data-stu-id="41462-210">In the Web Service SDK virtual directory, double-click **SSL Settings**.</span></span>  
20. <span data-ttu-id="41462-211">Nastavte Klientské certifikáty na **Přijmout** a klikněte na **Použít**.</span><span class="sxs-lookup"><span data-stu-id="41462-211">Set Client Certificates to **Accept**, and then click **Apply**.</span></span>  
21. <span data-ttu-id="41462-212">Soubor .pfx, který jste exportovali, zkopírujte na server, kde běží adaptér AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-212">Copy the .pfx file you exported earlier to the server that is running the AD FS adapter.</span></span>  
22. <span data-ttu-id="41462-213">Importujte soubor .pfx do osobního úložiště certifikátů na místním počítači.</span><span class="sxs-lookup"><span data-stu-id="41462-213">Import the .pfx file to the local computer personal certificate store.</span></span>  
23. <span data-ttu-id="41462-214">Klikněte pravým tlačítkem, vyberte možnost **Spravovat soukromé klíče** a účtu, který jste použili pro přihlášení ke službě AD FS, udělte oprávnění ke čtení.</span><span class="sxs-lookup"><span data-stu-id="41462-214">Right-click and select **Manage Private Keys**, and then grant read access to the account you used to sign in to the AD FS service.</span></span>  
24. <span data-ttu-id="41462-215">Otevřete klientský certifikát a zkopírujte kryptografický otisk z karty **Podrobnosti**.</span><span class="sxs-lookup"><span data-stu-id="41462-215">Open the client certificate and copy the thumbprint from the **Details** tab.</span></span>  
25. <span data-ttu-id="41462-216">V souboru MultiFactorAuthenticationAdfsAdapter.config nastavte **WebServiceSdkCertificateThumbprint** na řetězec zkopírovaný v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="41462-216">In the MultiFactorAuthenticationAdfsAdapter.config file, set **WebServiceSdkCertificateThumbprint** to the string copied in the previous step.</span></span>  

<span data-ttu-id="41462-217">V prostředí PowerShell spusťte skript \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1.</span><span class="sxs-lookup"><span data-stu-id="41462-217">Finally, to register the adapter, run the \Program Files\Multi-Factor Authentication Server\Register-MultiFactorAuthenticationAdfsAdapter.ps1 script in PowerShell.</span></span> <span data-ttu-id="41462-218">Adaptér je zaregistrovaný jako WindowsAzureMultiFactorAuthentication.</span><span class="sxs-lookup"><span data-stu-id="41462-218">The adapter is registered as WindowsAzureMultiFactorAuthentication.</span></span> <span data-ttu-id="41462-219">Restartujte službu AD FS, aby se registrace projevila.</span><span class="sxs-lookup"><span data-stu-id="41462-219">Restart the AD FS service for the registration to take effect.</span></span>

## <a name="secure-azure-ad-resources-using-ad-fs"></a><span data-ttu-id="41462-220">Zabezpečení prostředků Azure AD pomocí služby AD FS</span><span class="sxs-lookup"><span data-stu-id="41462-220">Secure Azure AD resources using AD FS</span></span>
<span data-ttu-id="41462-221">K zabezpečení cloudových prostředků nastavte pravidlo deklarace identity tak, aby služba Active Directory Federation Services vyslala deklaraci identity multipleauthn, když uživatel úspěšně provede dvoustupňové ověření.</span><span class="sxs-lookup"><span data-stu-id="41462-221">To secure your cloud resource, set up a claims rule so that Active Directory Federation Services emits the multipleauthn claim when a user performs two-step verification successfully.</span></span> <span data-ttu-id="41462-222">Tato deklarace identity se předá Azure AD.</span><span class="sxs-lookup"><span data-stu-id="41462-222">This claim is passed on to Azure AD.</span></span> <span data-ttu-id="41462-223">Postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="41462-223">Follow this procedure to walk through the steps:</span></span>

1. <span data-ttu-id="41462-224">Otevřete správu služby AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-224">Open AD FS Management.</span></span>
2. <span data-ttu-id="41462-225">Na levé straně vyberte **Vztahy důvěryhodnosti předávající strany**.</span><span class="sxs-lookup"><span data-stu-id="41462-225">On the left, select **Relying Party Trusts**.</span></span>
3. <span data-ttu-id="41462-226">Klikněte pravým tlačítkem na **Platforma identit Microsoft Office 365** a vyberte **Upravit pravidla deklarací identity**.</span><span class="sxs-lookup"><span data-stu-id="41462-226">Right-click on **Microsoft Office 365 Identity Platform** and select **Edit Claim Rules…**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip1.png)

4. <span data-ttu-id="41462-228">V pravidlech transformace vystavení klikněte na **Přidat pravidlo**.</span><span class="sxs-lookup"><span data-stu-id="41462-228">On Issuance Transform Rules, click **Add Rule.**</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip2.png)

5. <span data-ttu-id="41462-230">V Průvodci přidáním pravidla – deklarace identity transformace vyberte v rozevíracím seznamu **Předávat nebo filtrovat příchozí deklarace** a klikněte na **Další**.</span><span class="sxs-lookup"><span data-stu-id="41462-230">On the Add Transform Claim Rule Wizard, select **Pass Through or Filter an Incoming Claim** from the drop-down and click **Next**.</span></span>

   ![Cloud](./media/multi-factor-authentication-get-started-adfs-cloud/trustedip3.png)

6. <span data-ttu-id="41462-232">Pojmenujte pravidlo.</span><span class="sxs-lookup"><span data-stu-id="41462-232">Give your rule a name.</span></span>
7. <span data-ttu-id="41462-233">Jako typ příchozí deklarace identity vyberte **Odkazy na metody ověřování**.</span><span class="sxs-lookup"><span data-stu-id="41462-233">Select **Authentication Methods References** as the Incoming claim type.</span></span>
8. <span data-ttu-id="41462-234">Vyberte **Předávat všechny hodnoty deklarací identity**.</span><span class="sxs-lookup"><span data-stu-id="41462-234">Select **Pass through all claim values**.</span></span>
    <span data-ttu-id="41462-235">![	Průvodce přidáním pravidla – deklarace identity transformace](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span><span class="sxs-lookup"><span data-stu-id="41462-235">![Add Transform Claim Rule Wizard](./media/multi-factor-authentication-get-started-adfs-cloud/configurewizard.png)</span></span>
9. <span data-ttu-id="41462-236">Klikněte na **Dokončit**.</span><span class="sxs-lookup"><span data-stu-id="41462-236">Click **Finish**.</span></span> <span data-ttu-id="41462-237">Uzavřete konzolu pro správu služby AD FS.</span><span class="sxs-lookup"><span data-stu-id="41462-237">Close the AD FS Management console.</span></span>

## <a name="related-topics"></a><span data-ttu-id="41462-238">Související témata</span><span class="sxs-lookup"><span data-stu-id="41462-238">Related topics</span></span>
<span data-ttu-id="41462-239">Pomoc při řešení potíží najdete v tématu [Nejčastější dotazy ke službě Azure Multi-Factor Authentication](multi-factor-authentication-faq.md).</span><span class="sxs-lookup"><span data-stu-id="41462-239">For troubleshooting help, see the [Azure Multi-Factor Authentication FAQs](multi-factor-authentication-faq.md)</span></span>

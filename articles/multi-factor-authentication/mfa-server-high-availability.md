---
title: "pro zajištění vysoké dostupnosti aaaConfigure Azure MFA serveru | Microsoft Docs"
description: "Nasazení více instancí serveru Azure Multi-Factor Authentication Server v konfiguracích, které zajišťují vysokou dostupnost."
services: multi-factor-authentication
keywords: Azure MFA
documentationcenter: 
author: MicrosoftGuyJFlo
manager: femila
ms.assetid: 
ms.service: multi-factor-authentication
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 08/23/2017
ms.author: joflore
ms.reviewer: alexwe
ms.custom: it-pro
ms.openlocfilehash: 8c6b1921c734c7a7273e443b3591fbbb15cd5e6c
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="configure-azure-multi-factor-authentication-server-for-high-availability"></a><span data-ttu-id="6e5f2-104">Nakonfigurujte Server Azure Multi-Factor Authentication pro zajištění vysoké dostupnosti</span><span class="sxs-lookup"><span data-stu-id="6e5f2-104">Configure Azure Multi-Factor Authentication Server for high availability</span></span>

<span data-ttu-id="6e5f2-105">tooachieve vysoká dostupnost s nasazením Azure MFA serveru, je nutné toodeploy více serverů vícefaktorového ověřování.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-105">tooachieve high-availability with your Azure Server MFA deployment, you need toodeploy multiple MFA servers.</span></span> <span data-ttu-id="6e5f2-106">Tato část obsahuje informace o vyrovnávání zatížení sítě návrhu tooachieve vaše cíle vysoké dostupnosti ve službě Azure MFS serveru nasazení.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-106">This section provides information on a load-balanced design tooachieve your high availability targets in you Azure MFS Server deployment.</span></span>

## <a name="mfa-server-overview"></a><span data-ttu-id="6e5f2-107">Přehled MFA serveru</span><span class="sxs-lookup"><span data-stu-id="6e5f2-107">MFA Server overview</span></span>

<span data-ttu-id="6e5f2-108">Hello architektura služby Azure MFA serveru zahrnuje několik komponent, jak je znázorněno v následujícím diagramu hello:</span><span class="sxs-lookup"><span data-stu-id="6e5f2-108">hello Azure MFA Server service architecture comprises several components as shown in hello following diagram:</span></span>

 ![Architektura serveru MFA](./media/mfa-server-high-availability/mfa-ha-architecture.png)

<span data-ttu-id="6e5f2-110">MFA Server je Windows Server, který má nainstalovaný software hello Azure Multi-Factor Authentication.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-110">An MFA Server is a Windows Server that has hello Azure Multi-Factor Authentication software installed.</span></span> <span data-ttu-id="6e5f2-111">instance serveru MFA Hello musí aktivovat hello služby MFA v Azure toofunction.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-111">hello MFA Server instance must be activated by hello MFA Service in Azure toofunction.</span></span> <span data-ttu-id="6e5f2-112">Více než jeden Server MFA může být nainstalovaná na místě.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-112">More than one MFA Server can be installed on-premises.</span></span>

<span data-ttu-id="6e5f2-113">Hello je první MFA serveru, který je nainstalován hello hlavní Server MFA po aktivaci pomocí hello služby Azure MFA ve výchozím nastavení.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-113">hello first MFA Server that is installed is hello master MFA Server upon activation by hello Azure MFA Service by default.</span></span> <span data-ttu-id="6e5f2-114">hlavní server MFA Hello má kopii databáze PhoneFactor.pfdata hello nelze zapisovat.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-114">hello master MFA server has a writeable copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6e5f2-115">Následné instalace instancí MFA serveru se označují jako slaves.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-115">Subsequent installations of instances of MFA Server are known as slaves.</span></span> <span data-ttu-id="6e5f2-116">Hello MFA slaves mít replikované jen pro čtení kopie databáze PhoneFactor.pfdata hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-116">hello MFA slaves have a replicated read-only copy of hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6e5f2-117">MFA servery replikují informace o používání vzdáleného volání procedur (RPC).</span><span class="sxs-lookup"><span data-stu-id="6e5f2-117">MFA servers replicate information using Remote Procedure Call (RPC).</span></span> <span data-ttu-id="6e5f2-118">Všechny servery vícefaktorového ověřování musí souhrnně být buď připojený k doméně nebo samostatné tooreplicate informace.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-118">All MFA Severs must collectively either be domain joined or standalone tooreplicate information.</span></span>

<span data-ttu-id="6e5f2-119">Hlavní server MFA a podřízené servery vícefaktorového ověřování komunikovat s hello služby MFA Pokud se vyžaduje dvoufaktorové ověření.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-119">Both MFA master and slave MFA Servers communicate with hello MFA Service when two-factor authentication is required.</span></span> <span data-ttu-id="6e5f2-120">Například když se uživatel pokusí toogain přístup tooan aplikace, která vyžaduje dvoufaktorové ověřování, hello uživatele bude nejprve ověřit pomocí zprostředkovatele identity, jako je Active Directory (AD).</span><span class="sxs-lookup"><span data-stu-id="6e5f2-120">For example, when a user attempts toogain access tooan application that requires two-factor authentication, hello user will first be authenticated by an identity provider, such as Active Directory (AD).</span></span>

<span data-ttu-id="6e5f2-121">Po úspěšném ověření službou AD hello MFA Server komunikovat s hello služby MFA.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-121">After successful authentication with AD, hello MFA Server will communicate with hello MFA Service.</span></span> <span data-ttu-id="6e5f2-122">Hello MFA Server čeká oznámení ze služby MFA tooallow hello nebo odepřít aplikace toohello přístup uživatelů hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-122">hello MFA Server waits for notification from hello MFA Service tooallow or deny hello user access toohello application.</span></span>

<span data-ttu-id="6e5f2-123">Pokud hlavní server MFA hello přejde do režimu offline, ověřování stále lze zpracovat, ale operace, které vyžadují změny toohello MFA databázi nelze zpracovat.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-123">If hello MFA master server goes offline, authentications can still be processed, but operations that require changes toohello MFA database cannot be processed.</span></span> <span data-ttu-id="6e5f2-124">(Příklady: Přidání uživatelů samoobslužné služby změny kódu PIN a změna informace o uživateli hello)</span><span class="sxs-lookup"><span data-stu-id="6e5f2-124">(Examples include: hello addition of users, self-service PIN changes, and changing user information)</span></span>

## <a name="deployment"></a><span data-ttu-id="6e5f2-125">Nasazení</span><span class="sxs-lookup"><span data-stu-id="6e5f2-125">Deployment</span></span>

<span data-ttu-id="6e5f2-126">Vezměte v úvahu hello následující důležité body pro vyrovnávání zatížení Azure MFA serveru a jeho souvisejících součástí.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-126">Consider hello following important points for load balancing Azure MFA Server and its related components.</span></span>

* <span data-ttu-id="6e5f2-127">**Pomocí protokolu RADIUS standardní tooachieve vysokou dostupnost**.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-127">**Using RADIUS standard tooachieve high availability**.</span></span> <span data-ttu-id="6e5f2-128">Pokud používáte Azure MFA servery jako servery RADIUS, můžete nakonfigurovat jeden Server MFA potenciálně jako primární cíl ověřování protokolu RADIUS a dalších serverů Azure MFA jako cíle sekundární ověřování.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-128">If you are using Azure MFA Servers as RADIUS servers, you can potentially configure one MFA Server as a primary RADIUS authentication target and other Azure MFA Servers as secondary authentication targets.</span></span> <span data-ttu-id="6e5f2-129">Však tato metoda tooachieve vysokou dostupnost nemusí být praktické, protože období toooccur časový limit musíte počkat, než můžete ověřovány proti sekundárního ověřování hello selhání ověření na cílové primární ověřování hello cíl.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-129">However, this method tooachieve high availability may not be practical because you must wait for a time-out period toooccur when authentication fails on hello primary authentication target before you can be authenticated against hello secondary authentication target.</span></span> <span data-ttu-id="6e5f2-130">Je efektivnější tooload vyrovnávání hello RADIUS přenosů mezi klientem RADIUS hello a servery RADIUS hello (v tomto případě hello Azure MFA servery fungují jako servery RADIUS) tak, aby klienti RADIUS hello lze nakonfigurovat jednu adresu URL, která může ukazovat na.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-130">It is more efficient tooload balance hello RADIUS traffic between hello RADIUS client and hello RADIUS Servers (in this case, hello Azure MFA Servers acting as RADIUS servers) so that you can configure hello RADIUS clients with a single URL that they can point to.</span></span>
* <span data-ttu-id="6e5f2-131">**Musí podporovat toomanually MFA slaves**.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-131">**Need toomanually promote MFA slaves**.</span></span> <span data-ttu-id="6e5f2-132">Pokud hlavní server Azure MFA hello přejde do režimu offline, hello sekundárních serverů Azure MFA dál tooprocess požadavky vícefaktorového ověřování.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-132">If hello master Azure MFA server goes offline, hello secondary Azure MFA Servers continue tooprocess MFA requests.</span></span> <span data-ttu-id="6e5f2-133">Ale dokud hlavní MFA server k dispozici, admins nelze přidat uživatele nebo změnit nastavení vícefaktorového ověřování, a uživatelé nelze provádět změny pomocí hello uživatelského portálu.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-133">However, until a master MFA server is available, admins can not add users or modify MFA settings, and users can not make changes using hello user portal.</span></span> <span data-ttu-id="6e5f2-134">Povýšení toohello podřízený vícefaktorového ověřování pro hlavní role je vždy ruční proces.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-134">Promoting an MFA slave toohello master role is always a manual process.</span></span>
* <span data-ttu-id="6e5f2-135">**Separability součástí**.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-135">**Separability of components**.</span></span> <span data-ttu-id="6e5f2-136">hello Hello Azure MFA serveru zahrnuje několik komponent, které je možné nainstalovat na stejnou instanci serveru Windows nebo na jinou instancí.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-136">hello Azure MFA Server comprises several components that can be installed on hello same Windows Server instance or on different instances.</span></span> <span data-ttu-id="6e5f2-137">Tyto součásti zahrnují hello portálu User Portal, webové služby mobilní aplikace a adaptér AD FS hello (agent).</span><span class="sxs-lookup"><span data-stu-id="6e5f2-137">These components include hello User Portal, Mobile App Web Service, and hello ADFS adapter (agent).</span></span> <span data-ttu-id="6e5f2-138">Tento separability je možné toouse hello Proxy webových aplikací toopublish hello portálu User Portal a mobilní aplikace Webový Server z hello hraniční síti.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-138">This separability makes it possible toouse hello Web Application Proxy toopublish hello User Portal and Mobile App Web Server from hello perimeter network.</span></span> <span data-ttu-id="6e5f2-139">Taková konfigurace přidá toohello celkového zabezpečení návrhu, jak je znázorněno v následujícím diagramu hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-139">Such a configuration adds toohello overall security of your design, as shown in hello following diagram.</span></span> <span data-ttu-id="6e5f2-140">Hello MFA User Portal a mobilní aplikace Webový Server může také možné nasadit v konfiguraci Vyrovnávání zatížení sítě HA.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-140">hello MFA User Portal and Mobile App Web Server may also be deployed in HA load-balanced configurations.</span></span>

   ![MFA serveru s hraniční sítí](./media/mfa-server-high-availability/mfasecurity.png)

* <span data-ttu-id="6e5f2-142">**Jednorázovým heslem (OTP) prostřednictvím serveru SMS (neboli jednosměrné služby SMS) vyžaduje hello použití trvalé relace, pokud provoz s vyrovnáváním zatížení**.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-142">**One-time password (OTP) over SMS (aka one-way SMS) requires hello use of sticky sessions if traffic is load-balanced**.</span></span> <span data-ttu-id="6e5f2-143">Jednosměrné služby SMS je možnost ověřování, která způsobí, že uživatelé hello toosend MFA Server hello textovou zprávu jednorázovým HESLEM.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-143">One-way SMS is an authentication option that causes hello MFA Server toosend hello users a text message containing an OTP.</span></span> <span data-ttu-id="6e5f2-144">Hello uživatel zadá hello jednorázového HESLA vyzvat okno toocomplete hello ověřovací test MFA.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-144">hello user enters hello OTP in a prompt window toocomplete hello MFA challenge.</span></span> <span data-ttu-id="6e5f2-145">Při načítání vyrovnávání serverů Azure MFA, hello stejný server, který obsluhuje hello počátečního požadavku na ověření musí být server hello, který přijme zprávu jednorázového HESLA hello od uživatele hello; Pokud jiný Server MFA obdrží hello odpověď ověřování jednorázovým HESLEM, hello výzvu ověřování se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-145">If you load balance Azure MFA Servers, hello same server that served hello initial authentication request must be hello server that receives hello OTP message from hello user; if another MFA Server receives hello OTP reply, hello authentication challenge fails.</span></span> <span data-ttu-id="6e5f2-146">Další informace najdete v tématu [jedno heslo čas přes SMS přidat tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span><span class="sxs-lookup"><span data-stu-id="6e5f2-146">For more information, see [One Time Password over SMS Added tooAzure MFA Server](https://blogs.technet.microsoft.com/enterprisemobility/2015/03/02/one-time-password-over-sms-added-to-azure-mfa-server).</span></span>
* <span data-ttu-id="6e5f2-147">**Vyrovnávání zatížení sítě nasazení hello portálu User Portal a webová služba mobilní aplikace vyžadují trvalé relace**.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-147">**Load-Balanced deployments of hello User Portal and Mobile App Web Service require sticky sessions**.</span></span> <span data-ttu-id="6e5f2-148">Pokud jste Vyrovnávání zatížení hello MFA User Portal a hello webové služby mobilní aplikace, musí každé relaci toostay na hello stejný server.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-148">If you are load-balancing hello MFA User Portal and hello Mobile App Web Service, each session needs toostay on hello same server.</span></span>

## <a name="high-availability-deployment"></a><span data-ttu-id="6e5f2-149">Nasazení vysoké dostupnosti</span><span class="sxs-lookup"><span data-stu-id="6e5f2-149">High-availability deployment</span></span>

<span data-ttu-id="6e5f2-150">Hello následující diagram znázorňuje na dokončení HA Vyrovnávání zatížení sítě implementace Azure MFA a jeho komponenty, spolu s AD FS pro referenci.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-150">hello following diagram shows a complete HA load-balanced implementation of Azure MFA and its components, along with ADFS for reference.</span></span>

 ![Azure MFA Server HA implementace](./media/mfa-server-high-availability/mfa-ha-deployment.png)

<span data-ttu-id="6e5f2-152">Mějte na paměti následující položky pro oblast hello odpovídajícím způsobem číslované hello předcházející diagram hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-152">Note hello following items for hello correspondingly numbered area of hello preceding diagram.</span></span>

1. <span data-ttu-id="6e5f2-153">Dobrý den, které jsou dva servery vícefaktorového ověřování Azure (MFA1 a MFA2) načíst vyrovnáváním (mfaapp.contoso.com) a jsou nakonfigurované toouse statický port (4443) tooreplicate hello PhoneFactor.pfdata databáze.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-153">hello two Azure MFA Servers (MFA1 and MFA2) are load balanced (mfaapp.contoso.com) and are configured toouse a static port (4443) tooreplicate hello PhoneFactor.pfdata database.</span></span> <span data-ttu-id="6e5f2-154">Hello sady SDK webové služby je nainstalován na každém hello MFA Server tooenable komunikace přes port TCP 443 se servery služby AD FS hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-154">hello Web Service SDK is installed on each of hello MFA Server tooenable communication over TCP port 443 with hello ADFS servers.</span></span> <span data-ttu-id="6e5f2-155">Hello MFA servery jsou nasazeny v konfiguraci bezstavové Vyrovnávání zatížení sítě.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-155">hello MFA servers are deployed in a stateless load-balanced configuration.</span></span> <span data-ttu-id="6e5f2-156">Ale pokud budete chtít toouse jednorázového HESLA prostřednictvím serveru SMS, musíte použít vyrovnávání stavová zatížení.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-156">However, if you wanted toouse OTP over SMS, you must use stateful load balancing.</span></span>
   <span data-ttu-id="6e5f2-157">![Azure MFA serveru - aplikační server HA](./media/mfa-server-high-availability/mfaapp.png)</span><span class="sxs-lookup"><span data-stu-id="6e5f2-157">![Azure MFA Server - App server HA](./media/mfa-server-high-availability/mfaapp.png)</span></span>

   > [!NOTE]
   > <span data-ttu-id="6e5f2-158">Protože RPC používá dynamické porty, není doporučeno brány firewall tooopen až toohello rozsah dynamické porty, které mohou potenciálně používat RPC.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-158">Because RPC uses dynamic ports, it is not recommended tooopen firewalls up toohello range of dynamic ports that RPC can potentially use.</span></span> <span data-ttu-id="6e5f2-159">Pokud máte bránu firewall **mezi** MFA aplikační servery, byste měli nakonfigurovat toocommunicate MFA Server hello na statický port pro přenosy replikace hello mezi hlavní data a podřízené servery a otevřete, který port v bráně firewall.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-159">If you have a firewall **between** your MFA application servers, you should configure hello MFA Server toocommunicate on a static port for hello replication traffic between slave and master servers and open that port on your firewall.</span></span> <span data-ttu-id="6e5f2-160">Statický port hello můžete vynutit tím, že vytvoříte hodnotu DWORD registru na ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` názvem ```Pfsvc_ncan_ip_tcp_port``` a nastavení hodnoty hello tooan k dispozici statický port.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-160">You can force hello static port by creating a DWORD registry value at ```HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Positive Networks\PhoneFactor``` called ```Pfsvc_ncan_ip_tcp_port``` and setting hello value tooan available static port.</span></span> <span data-ttu-id="6e5f2-161">Připojení se vždy spouští hello podřízené servery vícefaktorového ověřování toohello hlavním, hello statický port je potřeba jenom na hlavní server hello, ale vzhledem k tomu, že můžete zvýšit úroveň hlavní podřízený toobe hello kdykoli, měli byste nastavit hello statický port ve všech serverech vícefaktorového ověřování.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-161">Connections are always initiated by hello slave MFA Servers toohello master, hello static port is only required on hello master, but since you can promote a slave toobe hello master at any time, you should set hello static port on all MFA Servers.</span></span>

2. <span data-ttu-id="6e5f2-162">servery uživatele portálu nebo vícefaktorového ověřování mobilní aplikace Hello dva (vícefaktorového ověřování. až MAS1 a MFA. až MAS2) jsou v skupinu s vyrovnáváním zatížení **stateful** konfigurace (mfa.contoso.com).</span><span class="sxs-lookup"><span data-stu-id="6e5f2-162">hello two User Portal/MFA Mobile App servers (MFA-UP-MAS1 and MFA-UP-MAS2) are load balanced in a **stateful** configuration (mfa.contoso.com).</span></span> <span data-ttu-id="6e5f2-163">Odvolat, aby trvalé relace jsou nutné pro vyrovnávání zatížení hello MFA User Portal a služby mobilní aplikace.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-163">Recall that sticky sessions are a requirement for load balancing hello MFA User Portal and Mobile App Service.</span></span>
   <span data-ttu-id="6e5f2-164">![Azure MFA serveru – portál User Portal a mobilní aplikace služby HA](./media/mfa-server-high-availability/mfaportal.png)</span><span class="sxs-lookup"><span data-stu-id="6e5f2-164">![Azure MFA Server - User Portal and Mobile App Service HA](./media/mfa-server-high-availability/mfaportal.png)</span></span>
3. <span data-ttu-id="6e5f2-165">farma serverů služby AD FS Hello je skupinu s vyrovnáváním zatížení a publikovat toohello Internet prostřednictvím Vyrovnávání zatížení sítě proxy služby AD FS v hraniční síti hello.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-165">hello ADFS Server farm is load balanced and published toohello Internet through load-balanced ADFS proxies in hello perimeter network.</span></span> <span data-ttu-id="6e5f2-166">Každý Server služby AD FS používá toocommunicate agent služby AD FS hello s hello servery vícefaktorového ověřování Azure pomocí jednu Vyrovnávání zatížení sítě adresu URL (mfaapp.contoso.com) přes port 443 protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="6e5f2-166">Each ADFS Server uses hello ADFS agent toocommunicate with hello Azure MFA Servers using a single load-balanced URL (mfaapp.contoso.com) over TCP port 443.</span></span>

## <a name="next-steps"></a><span data-ttu-id="6e5f2-167">Další kroky</span><span class="sxs-lookup"><span data-stu-id="6e5f2-167">Next steps</span></span>

* [<span data-ttu-id="6e5f2-168">Instalace a konfigurace Azure MFA serveru</span><span class="sxs-lookup"><span data-stu-id="6e5f2-168">Install and configure Azure MFA Server</span></span>](multi-factor-authentication-get-started-server.md)

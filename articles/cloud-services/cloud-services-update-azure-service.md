---
title: "Jak aktualizovat Cloudová služba | Microsoft Docs"
description: "Zjistěte, jak aktualizovat cloudové služby v Azure. Zjistěte, jak se aktualizace v cloudové službě pokračuje k zajištění dostupnosti."
services: cloud-services
documentationcenter: 
author: Thraka
manager: timlt
editor: 
ms.assetid: c6a8b5e6-5c99-454c-9911-5c7ae8d1af63
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 04/19/2017
ms.author: adegeo
ms.openlocfilehash: 2ba9676ed2afce7f18446642527971f5001b5ca7
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="how-to-update-a-cloud-service"></a><span data-ttu-id="90a08-104">Postup aktualizace cloudové služby</span><span class="sxs-lookup"><span data-stu-id="90a08-104">How to update a cloud service</span></span>

<span data-ttu-id="90a08-105">Aktualizace cloudové služby, včetně jeho role a hostovaný operační systém, je proces tři krok.</span><span class="sxs-lookup"><span data-stu-id="90a08-105">Updating a cloud service, including both its roles and guest OS, is a three step process.</span></span> <span data-ttu-id="90a08-106">První musí se nahrát binární soubory a konfigurační soubory pro novou cloudovou službu nebo verze operačního systému.</span><span class="sxs-lookup"><span data-stu-id="90a08-106">First, the binaries and configuration files for the new cloud service or OS version must be uploaded.</span></span> <span data-ttu-id="90a08-107">V dalším kroku Azure si vyhrazuje výpočetní a síťové prostředky pro cloudové služby na základě požadavků na nové cloudovou verzi služby.</span><span class="sxs-lookup"><span data-stu-id="90a08-107">Next, Azure reserves compute and network resources for the cloud service based on the requirements of the new cloud service version.</span></span> <span data-ttu-id="90a08-108">Nakonec Azure provádí přírůstkové aktualizace klienta na novou verzi nebo hostovaný operační systém, při zachování dostupnosti vaší postupného upgradu.</span><span class="sxs-lookup"><span data-stu-id="90a08-108">Finally, Azure performs a rolling upgrade to incrementally update the tenant to the new version or guest OS, while preserving your availability.</span></span> <span data-ttu-id="90a08-109">Tento článek popisuje podrobnosti o tomto posledním kroku – postupného upgradu.</span><span class="sxs-lookup"><span data-stu-id="90a08-109">This article discusses the details of this last step – the rolling upgrade.</span></span>

## <a name="update-an-azure-service"></a><span data-ttu-id="90a08-110">Aktualizace služby Azure</span><span class="sxs-lookup"><span data-stu-id="90a08-110">Update an Azure Service</span></span>
<span data-ttu-id="90a08-111">Azure umožňuje instance role uspořádat do logických skupin názvem domén upgradu (UD).</span><span class="sxs-lookup"><span data-stu-id="90a08-111">Azure organizes your role instances into logical groupings called upgrade domains (UD).</span></span> <span data-ttu-id="90a08-112">Upgradu domény (UD) jsou logické skupiny instancí role, které jsou aktualizované jako skupina.</span><span class="sxs-lookup"><span data-stu-id="90a08-112">Upgrade domains (UD) are logical sets of role instances that are updated as a group.</span></span>  <span data-ttu-id="90a08-113">Azure aktualizace a cloudové služby jeden UD současně, což umožňuje instancí v jiných UDs pokračujte s provozem.</span><span class="sxs-lookup"><span data-stu-id="90a08-113">Azure updates a cloud service one UD at a time, which allows instances in other UDs to continue serving traffic.</span></span>

<span data-ttu-id="90a08-114">Výchozí počet domén upgradu je 5.</span><span class="sxs-lookup"><span data-stu-id="90a08-114">The default number of upgrade domains is 5.</span></span> <span data-ttu-id="90a08-115">Můžete zadat jiný počet domén upgradu včetně atribut upgradeDomainCount v souboru definice služby (.csdef).</span><span class="sxs-lookup"><span data-stu-id="90a08-115">You can specify a different number of upgrade domains by including the upgradeDomainCount attribute in the service’s definition file (.csdef).</span></span> <span data-ttu-id="90a08-116">Další informace o atributu upgradeDomainCount najdete v tématu [WebRole schématu](https://msdn.microsoft.com/library/azure/gg557553.aspx) nebo [WorkerRole schématu](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span><span class="sxs-lookup"><span data-stu-id="90a08-116">For more information about the upgradeDomainCount attribute, see [WebRole Schema](https://msdn.microsoft.com/library/azure/gg557553.aspx) or [WorkerRole Schema](https://msdn.microsoft.com/library/azure/gg557552.aspx).</span></span>

<span data-ttu-id="90a08-117">Když provedete aktualizaci na místě jednu nebo více rolí ve službě, aktualizuje Azure sady instancí role podle upgradovací domény, do které patří.</span><span class="sxs-lookup"><span data-stu-id="90a08-117">When you perform an in-place update of one or more roles in your service, Azure updates sets of role instances according to the upgrade domain to which they belong.</span></span> <span data-ttu-id="90a08-118">Azure aktualizací, které se všechny instance v dané doméně upgradu –, zastavení, aktualizuje, uvede zpět online – pak se posouvá do další domény.</span><span class="sxs-lookup"><span data-stu-id="90a08-118">Azure updates all of the instances in a given upgrade domain – stopping them, updating them, bringing them back on-line – then moves onto the next domain.</span></span> <span data-ttu-id="90a08-119">Tím zastavíte pouze instance, které jsou spuštěné v aktuální upgradovací doméně, je zajištěno, že aktualizace vyskytuje v nejmenší dopad na spuštěnou službu Azure.</span><span class="sxs-lookup"><span data-stu-id="90a08-119">By stopping only the instances running in the current upgrade domain, Azure makes sure that an update occurs with the least possible impact to the running service.</span></span> <span data-ttu-id="90a08-120">Další informace najdete v tématu [jak aktualizace pokračuje](#howanupgradeproceeds) dále v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="90a08-120">For more information, see [How the update proceeds](#howanupgradeproceeds) later in this article.</span></span>

> [!NOTE]
> <span data-ttu-id="90a08-121">Při podmínky **aktualizace** a **upgrade** mají mírně jiný význam v rámci Azure, mohou být použity zcela zaměnitelným významem pro procesy a popis jednotlivých funkcí v tomto dokumentu.</span><span class="sxs-lookup"><span data-stu-id="90a08-121">While the terms **update** and **upgrade** have slightly different meaning in the context Azure, they can be used interchangeably for the processes and descriptions of the features in this document.</span></span>
>
>

<span data-ttu-id="90a08-122">Služby musí definovat aspoň dvě instance role pro tuto roli aktualizovat na místě bez výpadků.</span><span class="sxs-lookup"><span data-stu-id="90a08-122">Your service must define at least two instances of a role for that role to be updated in-place without downtime.</span></span> <span data-ttu-id="90a08-123">Pokud služba obsahuje pouze jednu instanci jedné role, služby nebude k dispozici, dokud nedokončí aktualizace na místě.</span><span class="sxs-lookup"><span data-stu-id="90a08-123">If the service consists of only one instance of one role, your service will be unavailable until the in-place update has finished.</span></span>

<span data-ttu-id="90a08-124">Toto téma obsahuje následující informace o Azure aktualizace:</span><span class="sxs-lookup"><span data-stu-id="90a08-124">This topic covers the following information about Azure updates:</span></span>

* [<span data-ttu-id="90a08-125">Během aktualizace povoleny změny služby</span><span class="sxs-lookup"><span data-stu-id="90a08-125">Allowed service changes during an update</span></span>](#AllowedChanges)
* [<span data-ttu-id="90a08-126">Jak pokračuje upgradu</span><span class="sxs-lookup"><span data-stu-id="90a08-126">How an upgrade proceeds</span></span>](#howanupgradeproceeds)
* [<span data-ttu-id="90a08-127">Vrácení zpět aktualizace</span><span class="sxs-lookup"><span data-stu-id="90a08-127">Rollback of an update</span></span>](#RollbackofanUpdate)
* [<span data-ttu-id="90a08-128">Spouštění více mutating operací na probíhající nasazení</span><span class="sxs-lookup"><span data-stu-id="90a08-128">Initiating multiple mutating operations on an ongoing deployment</span></span>](#multiplemutatingoperations)
* [<span data-ttu-id="90a08-129">Distribuce rolí napříč doménami upgradu</span><span class="sxs-lookup"><span data-stu-id="90a08-129">Distribution of roles across upgrade domains</span></span>](#distributiondfroles)

<a name="AllowedChanges"></a>

## <a name="allowed-service-changes-during-an-update"></a><span data-ttu-id="90a08-130">Během aktualizace povoleny změny služby</span><span class="sxs-lookup"><span data-stu-id="90a08-130">Allowed service changes during an update</span></span>
<span data-ttu-id="90a08-131">Následující tabulka ukazuje povolené změny služby během aktualizace:</span><span class="sxs-lookup"><span data-stu-id="90a08-131">The following table shows the allowed changes to a service during an update:</span></span>

| <span data-ttu-id="90a08-132">Změny umožnit hostování, služeb a rolí</span><span class="sxs-lookup"><span data-stu-id="90a08-132">Changes permitted to hosting, services, and roles</span></span> | <span data-ttu-id="90a08-133">Aktualizace na místě</span><span class="sxs-lookup"><span data-stu-id="90a08-133">In-place update</span></span> | <span data-ttu-id="90a08-134">Dvoufázové instalace (prohození virtuálních IP adres)</span><span class="sxs-lookup"><span data-stu-id="90a08-134">Staged (VIP swap)</span></span> | <span data-ttu-id="90a08-135">Odstranit a znovu nasadit.</span><span class="sxs-lookup"><span data-stu-id="90a08-135">Delete and re-deploy</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="90a08-136">Verze operačního systému</span><span class="sxs-lookup"><span data-stu-id="90a08-136">Operating system version</span></span> |<span data-ttu-id="90a08-137">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-137">Yes</span></span> |<span data-ttu-id="90a08-138">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-138">Yes</span></span> |<span data-ttu-id="90a08-139">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-139">Yes</span></span> |
| <span data-ttu-id="90a08-140">Úrovně důvěryhodnosti .NET</span><span class="sxs-lookup"><span data-stu-id="90a08-140">.NET trust level</span></span> |<span data-ttu-id="90a08-141">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-141">Yes</span></span> |<span data-ttu-id="90a08-142">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-142">Yes</span></span> |<span data-ttu-id="90a08-143">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-143">Yes</span></span> |
| <span data-ttu-id="90a08-144">Velikost virtuálního počítače<sup>1</sup></span><span class="sxs-lookup"><span data-stu-id="90a08-144">Virtual machine size<sup>1</sup></span></span> |<span data-ttu-id="90a08-145">Ano<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="90a08-145">Yes<sup>2</sup></span></span> |<span data-ttu-id="90a08-146">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-146">Yes</span></span> |<span data-ttu-id="90a08-147">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-147">Yes</span></span> |
| <span data-ttu-id="90a08-148">Nastavení místního úložiště</span><span class="sxs-lookup"><span data-stu-id="90a08-148">Local storage settings</span></span> |<span data-ttu-id="90a08-149">Pouze zvýšit<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="90a08-149">Increase only<sup>2</sup></span></span> |<span data-ttu-id="90a08-150">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-150">Yes</span></span> |<span data-ttu-id="90a08-151">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-151">Yes</span></span> |
| <span data-ttu-id="90a08-152">Přidání nebo odebrání rolí ve službě</span><span class="sxs-lookup"><span data-stu-id="90a08-152">Add or remove roles in a service</span></span> |<span data-ttu-id="90a08-153">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-153">Yes</span></span> |<span data-ttu-id="90a08-154">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-154">Yes</span></span> |<span data-ttu-id="90a08-155">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-155">Yes</span></span> |
| <span data-ttu-id="90a08-156">Počet instancí určité role</span><span class="sxs-lookup"><span data-stu-id="90a08-156">Number of instances of a particular role</span></span> |<span data-ttu-id="90a08-157">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-157">Yes</span></span> |<span data-ttu-id="90a08-158">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-158">Yes</span></span> |<span data-ttu-id="90a08-159">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-159">Yes</span></span> |
| <span data-ttu-id="90a08-160">Číslo nebo typ koncových bodů pro služby</span><span class="sxs-lookup"><span data-stu-id="90a08-160">Number or type of endpoints for a service</span></span> |<span data-ttu-id="90a08-161">Ano<sup>2</sup></span><span class="sxs-lookup"><span data-stu-id="90a08-161">Yes<sup>2</sup></span></span> |<span data-ttu-id="90a08-162">Ne</span><span class="sxs-lookup"><span data-stu-id="90a08-162">No</span></span> |<span data-ttu-id="90a08-163">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-163">Yes</span></span> |
| <span data-ttu-id="90a08-164">Názvy a hodnoty nastavení konfigurace</span><span class="sxs-lookup"><span data-stu-id="90a08-164">Names and values of configuration settings</span></span> |<span data-ttu-id="90a08-165">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-165">Yes</span></span> |<span data-ttu-id="90a08-166">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-166">Yes</span></span> |<span data-ttu-id="90a08-167">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-167">Yes</span></span> |
| <span data-ttu-id="90a08-168">Hodnoty (ale ne názvy) nastavení konfigurace</span><span class="sxs-lookup"><span data-stu-id="90a08-168">Values (but not names) of configuration settings</span></span> |<span data-ttu-id="90a08-169">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-169">Yes</span></span> |<span data-ttu-id="90a08-170">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-170">Yes</span></span> |<span data-ttu-id="90a08-171">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-171">Yes</span></span> |
| <span data-ttu-id="90a08-172">Přidat nové certifikáty</span><span class="sxs-lookup"><span data-stu-id="90a08-172">Add new certificates</span></span> |<span data-ttu-id="90a08-173">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-173">Yes</span></span> |<span data-ttu-id="90a08-174">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-174">Yes</span></span> |<span data-ttu-id="90a08-175">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-175">Yes</span></span> |
| <span data-ttu-id="90a08-176">Změna existující certifikátů</span><span class="sxs-lookup"><span data-stu-id="90a08-176">Change existing certificates</span></span> |<span data-ttu-id="90a08-177">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-177">Yes</span></span> |<span data-ttu-id="90a08-178">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-178">Yes</span></span> |<span data-ttu-id="90a08-179">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-179">Yes</span></span> |
| <span data-ttu-id="90a08-180">Nasazování nového kódu</span><span class="sxs-lookup"><span data-stu-id="90a08-180">Deploy new code</span></span> |<span data-ttu-id="90a08-181">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-181">Yes</span></span> |<span data-ttu-id="90a08-182">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-182">Yes</span></span> |<span data-ttu-id="90a08-183">Ano</span><span class="sxs-lookup"><span data-stu-id="90a08-183">Yes</span></span> |

<span data-ttu-id="90a08-184"><sup>1</sup> velikost změnu omezit na podmnožinu dostupných pro cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="90a08-184"><sup>1</sup> Size change limited to the subset of sizes available for the cloud service.</span></span>

<span data-ttu-id="90a08-185"><sup>2</sup> vyžaduje Azure SDK 1.5 nebo novější verze.</span><span class="sxs-lookup"><span data-stu-id="90a08-185"><sup>2</sup> Requires Azure SDK 1.5 or later versions.</span></span>

> [!WARNING]
> <span data-ttu-id="90a08-186">Změna velikosti virtuálního počítače způsobí zničení místní data.</span><span class="sxs-lookup"><span data-stu-id="90a08-186">Changing the virtual machine size will destroy local data.</span></span>
>
>

<span data-ttu-id="90a08-187">Během aktualizace nejsou podporovány následující položky:</span><span class="sxs-lookup"><span data-stu-id="90a08-187">The following items are not supported during an update:</span></span>

* <span data-ttu-id="90a08-188">Změna názvu role.</span><span class="sxs-lookup"><span data-stu-id="90a08-188">Changing the name of a role.</span></span> <span data-ttu-id="90a08-189">Odeberte a pak přidejte roli s novým názvem.</span><span class="sxs-lookup"><span data-stu-id="90a08-189">Remove and then add the role with the new name.</span></span>
* <span data-ttu-id="90a08-190">Změna počtu upgradu domény.</span><span class="sxs-lookup"><span data-stu-id="90a08-190">Changing of the Upgrade Domain count.</span></span>
* <span data-ttu-id="90a08-191">Snížení velikosti místních prostředků.</span><span class="sxs-lookup"><span data-stu-id="90a08-191">Decreasing the size of the local resources.</span></span>

<span data-ttu-id="90a08-192">Pokud provádíte jiné aktualizace definice služby, například snížení velikosti místní prostředek, je nutné provést o aktualizaci prohození virtuální IP adresy.</span><span class="sxs-lookup"><span data-stu-id="90a08-192">If you are making other updates to your service's definition, such as decreasing the size of local resource, you must perform a VIP swap update instead.</span></span> <span data-ttu-id="90a08-193">Další informace najdete v tématu [Prohodit nasazení](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span><span class="sxs-lookup"><span data-stu-id="90a08-193">For more information, see [Swap Deployment](https://msdn.microsoft.com/library/azure/ee460814.aspx).</span></span>

<a name="howanupgradeproceeds"></a>

## <a name="how-an-upgrade-proceeds"></a><span data-ttu-id="90a08-194">Jak pokračuje upgradu</span><span class="sxs-lookup"><span data-stu-id="90a08-194">How an upgrade proceeds</span></span>
<span data-ttu-id="90a08-195">Můžete se rozhodnout, jestli chcete aktualizovat všechny role ve službě nebo jedné role v rámci služby.</span><span class="sxs-lookup"><span data-stu-id="90a08-195">You can decide whether you want to update all of the roles in your service or a single role in the service.</span></span> <span data-ttu-id="90a08-196">V obou případech jsou všechny instance jednotlivých rolí, která se upgraduje a musí patřit do první upgradu domény byla zastavena, upgradovat a vrátí do režimu online.</span><span class="sxs-lookup"><span data-stu-id="90a08-196">In either case, all instances of each role that is being upgraded and belong to the first upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="90a08-197">Jakmile jsou zpět do režimu online, jsou instance v druhé doméně upgradu byla zastavena, upgradovat a vrátí do režimu online.</span><span class="sxs-lookup"><span data-stu-id="90a08-197">Once they are back online, the instances in the second upgrade domain are stopped, upgraded, and brought back online.</span></span> <span data-ttu-id="90a08-198">Cloudové služby může mít maximálně jeden upgradu v každém okamžiku aktivní.</span><span class="sxs-lookup"><span data-stu-id="90a08-198">A cloud service can have at most one upgrade active at a time.</span></span> <span data-ttu-id="90a08-199">Je proveden upgrade na nejnovější verzi cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="90a08-199">The upgrade is always performed against the latest version of the cloud service.</span></span>

<span data-ttu-id="90a08-200">Následující diagram znázorňuje, jak upgradu při upgradu všech rolí v rámci služby:</span><span class="sxs-lookup"><span data-stu-id="90a08-200">The following diagram illustrates how the upgrade proceeds if you are upgrading all of the roles in the service:</span></span>

<span data-ttu-id="90a08-201">![Upgrade služby](media/cloud-services-update-azure-service/IC345879.png "Upgrade služby")</span><span class="sxs-lookup"><span data-stu-id="90a08-201">![Upgrade service](media/cloud-services-update-azure-service/IC345879.png "Upgrade service")</span></span>

<span data-ttu-id="90a08-202">Tento další diagram znázorňuje, jak bude pokračovat aktualizace, pokud provádíte upgrade jedné role:</span><span class="sxs-lookup"><span data-stu-id="90a08-202">This next diagram illustrates how the update proceeds if you are upgrading only a single role:</span></span>

<span data-ttu-id="90a08-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "upgradu role")</span><span class="sxs-lookup"><span data-stu-id="90a08-203">![Upgrade role](media/cloud-services-update-azure-service/IC345880.png "Upgrade role")</span></span>  

<span data-ttu-id="90a08-204">Během automatické aktualizace Kontroleru prostředků infrastruktury Azure pravidelně vyhodnocuje stav cloudové služby za účelem určení, kdy je bezpečné provede další UD.</span><span class="sxs-lookup"><span data-stu-id="90a08-204">During an automatic update, the Azure Fabric Controller periodically evaluates the health of the cloud service to determine when it’s safe to walk the next UD.</span></span> <span data-ttu-id="90a08-205">Tato vyhodnocení stavu se provádí na základě podle rolí a považuje pouze instance v nejnovější verzi (tj. instance z UDs, které již byly šel).</span><span class="sxs-lookup"><span data-stu-id="90a08-205">This health evaluation is performed on a per-role basis and considers only instances in the latest version (i.e. instances from UDs that have already been walked).</span></span> <span data-ttu-id="90a08-206">Ověřuje, že minimální počet instancí role, pro každou roli, jste dosáhli uspokojivé stavu terminálu.</span><span class="sxs-lookup"><span data-stu-id="90a08-206">It verifies that a minimum number of role instances, for each role, have achieved a satisfactory terminal state.</span></span>

### <a name="role-instance-start-timeout"></a><span data-ttu-id="90a08-207">Časový limit spuštění Instance role</span><span class="sxs-lookup"><span data-stu-id="90a08-207">Role Instance Start Timeout</span></span>
<span data-ttu-id="90a08-208">Kontroleru prostředků infrastruktury počká 30 minut pro každou instanci role dosáhne stavu spuštěno.</span><span class="sxs-lookup"><span data-stu-id="90a08-208">The Fabric Controller will wait 30 minutes for each role instance to reach a Started state.</span></span> <span data-ttu-id="90a08-209">Časový limit uplynutím, Kontroleru prostředků infrastruktury bude proti pro další instance role.</span><span class="sxs-lookup"><span data-stu-id="90a08-209">If the timeout duration elapses, the Fabric Controller will continue walking to the next role instance.</span></span>

### <a name="impact-to-drive-data-during-cloud-service-upgrades"></a><span data-ttu-id="90a08-210">Upgraduje dopad na jednotce data během cloudové služby</span><span class="sxs-lookup"><span data-stu-id="90a08-210">Impact to drive data during Cloud Service upgrades</span></span>

<span data-ttu-id="90a08-211">Při upgradu služby z jediné instance na více instancí služby bude uveden do během upgradu je provést z důvodu služby Azure upgrady způsobem.</span><span class="sxs-lookup"><span data-stu-id="90a08-211">When upgrading a service from a single instance to multiple instances your service will be brought down while the upgrade is performed due to the way Azure upgrades services.</span></span> <span data-ttu-id="90a08-212">Záruční služby dostupnost smlouvu o úrovni služeb se vztahuje pouze na služby, které se nasadí s více než jednu instanci.</span><span class="sxs-lookup"><span data-stu-id="90a08-212">The service level agreement guaranteeing service availability only applies to services that are deployed with more than one instance.</span></span> <span data-ttu-id="90a08-213">Následující seznam popisuje, jak jsou data na každém disku ovlivněná každý scénář upgradu služby Azure:</span><span class="sxs-lookup"><span data-stu-id="90a08-213">The following list describes how the data on each drive is affected by each Azure service upgrade scenario:</span></span>

|<span data-ttu-id="90a08-214">Scénář</span><span class="sxs-lookup"><span data-stu-id="90a08-214">Scenario</span></span>|<span data-ttu-id="90a08-215">Jednotka C</span><span class="sxs-lookup"><span data-stu-id="90a08-215">C Drive</span></span>|<span data-ttu-id="90a08-216">Diskovou jednotku d</span><span class="sxs-lookup"><span data-stu-id="90a08-216">D Drive</span></span>|<span data-ttu-id="90a08-217">Jednotce E:</span><span class="sxs-lookup"><span data-stu-id="90a08-217">E Drive</span></span>|
|--------|-------|-------|-------|
|<span data-ttu-id="90a08-218">Restartování virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="90a08-218">VM reboot</span></span>|<span data-ttu-id="90a08-219">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-219">Preserved</span></span>|<span data-ttu-id="90a08-220">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-220">Preserved</span></span>|<span data-ttu-id="90a08-221">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-221">Preserved</span></span>|
|<span data-ttu-id="90a08-222">Restartování portálu</span><span class="sxs-lookup"><span data-stu-id="90a08-222">Portal reboot</span></span>|<span data-ttu-id="90a08-223">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-223">Preserved</span></span>|<span data-ttu-id="90a08-224">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-224">Preserved</span></span>|<span data-ttu-id="90a08-225">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-225">Destroyed</span></span>|
|<span data-ttu-id="90a08-226">Obnovení z Image portálu</span><span class="sxs-lookup"><span data-stu-id="90a08-226">Portal reimage</span></span>|<span data-ttu-id="90a08-227">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-227">Preserved</span></span>|<span data-ttu-id="90a08-228">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-228">Destroyed</span></span>|<span data-ttu-id="90a08-229">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-229">Destroyed</span></span>|
|<span data-ttu-id="90a08-230">Místní Upgrade</span><span class="sxs-lookup"><span data-stu-id="90a08-230">In-Place Upgrade</span></span>|<span data-ttu-id="90a08-231">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-231">Preserved</span></span>|<span data-ttu-id="90a08-232">Zachovají</span><span class="sxs-lookup"><span data-stu-id="90a08-232">Preserved</span></span>|<span data-ttu-id="90a08-233">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-233">Destroyed</span></span>|
|<span data-ttu-id="90a08-234">Migrace uzlu</span><span class="sxs-lookup"><span data-stu-id="90a08-234">Node migration</span></span>|<span data-ttu-id="90a08-235">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-235">Destroyed</span></span>|<span data-ttu-id="90a08-236">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-236">Destroyed</span></span>|<span data-ttu-id="90a08-237">Zničení</span><span class="sxs-lookup"><span data-stu-id="90a08-237">Destroyed</span></span>|

<span data-ttu-id="90a08-238">Upozorňujeme, že, v seznamu nahoře jednotce E: představuje role kořenové jednotce a nesmí být pevně.</span><span class="sxs-lookup"><span data-stu-id="90a08-238">Note that, in the above list, the E: drive represents the role’s root drive, and should not be hard-coded.</span></span> <span data-ttu-id="90a08-239">Místo toho použijte **RoleRoot %** proměnné prostředí, které představují jednotky.</span><span class="sxs-lookup"><span data-stu-id="90a08-239">Instead, use the **%RoleRoot%** environment variable to represent the drive.</span></span>

<span data-ttu-id="90a08-240">Chcete-li minimalizovat výpadek při upgradu jedné instance služby, nasazení nové služby s více instancemi pracovní server a proveďte prohození virtuálních IP adres.</span><span class="sxs-lookup"><span data-stu-id="90a08-240">To minimize the downtime when upgrading a single-instance service, deploy a new multi-instance service to the staging server and perform a VIP swap.</span></span>

<a name="RollbackofanUpdate"></a>

## <a name="rollback-of-an-update"></a><span data-ttu-id="90a08-241">Vrácení zpět aktualizace</span><span class="sxs-lookup"><span data-stu-id="90a08-241">Rollback of an update</span></span>
<span data-ttu-id="90a08-242">Azure poskytuje flexibilitu při správě služby během aktualizace tím, že umožňuje zahájit další operace ve službě, po počáteční aktualizace žádost přijme Kontroleru prostředků infrastruktury Azure.</span><span class="sxs-lookup"><span data-stu-id="90a08-242">Azure provides flexibility in managing services during an update by letting you initiate additional operations on a service, after the initial update request is accepted by the Azure Fabric Controller.</span></span> <span data-ttu-id="90a08-243">Vrácení zpět lze provést pouze, pokud by aktualizace (Změna konfigurace) nebo upgrade **v průběhu** stavu na nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-243">A rollback can only be performed when an update (configuration change) or upgrade is in the **in progress** state on the deployment.</span></span> <span data-ttu-id="90a08-244">Aktualizaci nebo upgradu se považuje za probíhá, pokud existuje alespoň jedna instance služby, který ještě neaktualizoval na novou verzi.</span><span class="sxs-lookup"><span data-stu-id="90a08-244">An update or upgrade is considered to be in-progress as long as there is at least one instance of the service which has not yet been updated to the new version.</span></span> <span data-ttu-id="90a08-245">K ověření, zda je povoleno vrácení zpět, zkontrolujte hodnotu příznak RollbackAllowed vrácený [získat nasazení](https://msdn.microsoft.com/library/azure/ee460804.aspx) a [získat vlastnosti cloudové služby](https://msdn.microsoft.com/library/azure/ee460806.aspx) operace, je nastaven na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="90a08-245">To test whether a rollback is allowed, check the value of the RollbackAllowed flag, returned by [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations, is set to true.</span></span>

> [!NOTE]
> <span data-ttu-id="90a08-246">Pouze má smysl volat vrácení zpět **na místě** aktualizovat nebo upgradovat, protože upgrady prohození virtuální IP adresy zahrnují nahrazení jednu celý spuštěné instanci služby s jinou.</span><span class="sxs-lookup"><span data-stu-id="90a08-246">It only makes sense to call Rollback on an **in-place** update or upgrade because VIP swap upgrades involve replacing one entire running instance of your service with another.</span></span>
>
>

<span data-ttu-id="90a08-247">Vrácení změn v průběhu aktualizace má následující důsledky pro nasazení:</span><span class="sxs-lookup"><span data-stu-id="90a08-247">Rollback of an in-progress update has the following effects on the deployment:</span></span>

* <span data-ttu-id="90a08-248">Nejsou žádné instance rolí, které měl ještě nebyly aktualizovat nebo upgradovat na novou verzi aktualizovat nebo upgradovat, protože tato instance je již spuštěn cílový verzi služby.</span><span class="sxs-lookup"><span data-stu-id="90a08-248">Any role instances which had not yet been updated or upgraded to the new version are not updated or upgraded, because those instances are already running the target version of the service.</span></span>
* <span data-ttu-id="90a08-249">Všechny instance rolí, které měl již byla aktualizovat nebo upgradovat na novou verzi balíčku služby (\*.cspkg) souboru nebo konfigurace služby (\*.cscfg) souboru (nebo oba soubory) se vrátit zpět na před upgradem verze těchto souborů.</span><span class="sxs-lookup"><span data-stu-id="90a08-249">Any role instances which had already been updated or upgraded to the new version of the service package (\*.cspkg) file or the service configuration (\*.cscfg) file (or both files) are reverted to the pre-upgrade version of these files.</span></span>

<span data-ttu-id="90a08-250">To funkčně poskytuje následující funkce:</span><span class="sxs-lookup"><span data-stu-id="90a08-250">This functionally is provided by the following features:</span></span>

* <span data-ttu-id="90a08-251">[Vrácení zpět aktualizovat nebo upgradovat](https://msdn.microsoft.com/library/azure/hh403977.aspx) operace, které může zavolat na aktualizaci konfigurace (aktivovány volání [změna konfigurace nasazení](https://msdn.microsoft.com/library/azure/ee460809.aspx)) nebo upgradu (aktivovány volání [nasazení upgradu](https://msdn.microsoft.com/library/azure/ee460793.aspx)), dokud existuje alespoň jedna instance v rámci služby, která nebyla aktualizována na novou verzi.</span><span class="sxs-lookup"><span data-stu-id="90a08-251">The [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation, which can be called on a configuration update (triggered by calling [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx)) or an upgrade (triggered by calling [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx)) as long as there is at least one instance in the service which has not yet been updated to the new version.</span></span>
* <span data-ttu-id="90a08-252">Element uzamčen a RollbackAllowed elementu, které jsou vraceny jako součást text odpovědi [získat nasazení](https://msdn.microsoft.com/library/azure/ee460804.aspx) a [získat vlastnosti cloudové služby](https://msdn.microsoft.com/library/azure/ee460806.aspx) operace:</span><span class="sxs-lookup"><span data-stu-id="90a08-252">The Locked element and the RollbackAllowed element, which are returned as part of the response body of the [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx) operations:</span></span>

  1. <span data-ttu-id="90a08-253">Element uzamčen umožňuje rozpoznat, kdy mutating operace může být volána v zadaném nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-253">The Locked element allows you to detect when a mutating operation can be invoked on a given deployment.</span></span>
  2. <span data-ttu-id="90a08-254">RollbackAllowed element umožňuje zjistit, kdy [vrácení zpět aktualizace nebo upgradu](https://msdn.microsoft.com/library/azure/hh403977.aspx) operaci nelze volat u dané nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-254">The RollbackAllowed element allows you to detect when the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation can be called on a given deployment.</span></span>

  <span data-ttu-id="90a08-255">Chcete-li provést vrácení zpět, nemáte zkontrolujte uzamčen a RollbackAllowed elementy.</span><span class="sxs-lookup"><span data-stu-id="90a08-255">In order to perform a rollback, you do not have to check both the Locked and the RollbackAllowed elements.</span></span> <span data-ttu-id="90a08-256">Stačí potvrďte, že RollbackAllowed je nastavená na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="90a08-256">It suffices to confirm that RollbackAllowed is set to true.</span></span> <span data-ttu-id="90a08-257">Tyto prvky jsou vrácena pouze v případě, že tyto metody jsou vyvolány pomocí hlavičky žádosti nastavit na "x-ms-version: 2011-10-01" nebo novější.</span><span class="sxs-lookup"><span data-stu-id="90a08-257">These elements are only returned if these methods are invoked by using the request header set to “x-ms-version: 2011-10-01” or a later version.</span></span> <span data-ttu-id="90a08-258">Další informace o hlavičkách verze najdete v tématu [Správa služby správy verzí](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="90a08-258">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<span data-ttu-id="90a08-259">Existují některé situace, kde vrácení zpět aktualizace nebo není upgrade podporován, jedná se o následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="90a08-259">There are some situations where a rollback of an update or upgrade is not supported, these are as follows:</span></span>

* <span data-ttu-id="90a08-260">Snížení místní prostředky - aktualizace se zvyšuje místních prostředků pro roli platformy Azure neumožňuje vrácení zpět.</span><span class="sxs-lookup"><span data-stu-id="90a08-260">Reduction in local resources - If the update increases the local resources for a role the Azure platform does not allow rolling back.</span></span>
* <span data-ttu-id="90a08-261">Omezení kvóty – Pokud aktualizace byla vertikálně operace, které jste se už nebude mít dostatečnou kvótu výpočetní k dokončení operace vrácení zpět.</span><span class="sxs-lookup"><span data-stu-id="90a08-261">Quota limitations - If the update was a scale down operation you may no longer have sufficient compute quota to complete the rollback operation.</span></span> <span data-ttu-id="90a08-262">Každé předplatné Azure má přidruženo kvótu, která určuje maximální počet jader, které mohou být spotřebovávána všechny hostované služby, které patří k tomuto předplatnému.</span><span class="sxs-lookup"><span data-stu-id="90a08-262">Each Azure subscription has a quota associated with it that specifies the maximum number of cores which can be consumed by all hosted services that belong to that subscription.</span></span> <span data-ttu-id="90a08-263">Je-li provést vrácení dané aktualizace by měla být umístěna vaše předplatné přes kvóty a která nebude povolen vrácení zpět.</span><span class="sxs-lookup"><span data-stu-id="90a08-263">If performing a rollback of a given update would put your subscription over quota then that a rollback will not be enabled.</span></span>
* <span data-ttu-id="90a08-264">Soupeření podmínku – Pokud počáteční aktualizace dokončena, vrácení zpět. není možné.</span><span class="sxs-lookup"><span data-stu-id="90a08-264">Race condition - If the initial update has completed, a rollback is not possible.</span></span>

<span data-ttu-id="90a08-265">Je například při vrácení zpět aktualizace mohou být užitečné, pokud používáte [nasazení upgradu](https://msdn.microsoft.com/library/azure/ee460793.aspx) operace v ručním režimu řídí rychlost, jakou hlavní místního upgradu vaší Azure hostovaná služba se nasazuje.</span><span class="sxs-lookup"><span data-stu-id="90a08-265">An example of when the rollback of an update might be useful is if you are using the [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) operation in manual mode to control the rate at which a major in-place upgrade to your Azure hosted service is rolled out.</span></span>

<span data-ttu-id="90a08-266">Při zavedení upgradu zavoláte [nasazení upgradu](https://msdn.microsoft.com/library/azure/ee460793.aspx) v ručním režimu a začít provede upgradovacích domén.</span><span class="sxs-lookup"><span data-stu-id="90a08-266">During the rollout of the upgrade you call [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx) in manual mode and begin to walk upgrade domains.</span></span> <span data-ttu-id="90a08-267">Pokud v určitém okamžiku při sledování upgradu můžete Všimněte si některé instance rolí v prvním upgradu domén, které byste zkontrolovat mít přestat reagovat, můžete zavolat [vrácení zpět aktualizace nebo upgradu](https://msdn.microsoft.com/library/azure/hh403977.aspx) operaci s nasazením, což ponechá nezměněné instance, které nebyly dosud nebyly upgradovány a vrácení instance, které upgradovali na předchozí balíček služby a konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="90a08-267">If at some point, as you monitor the upgrade, you note some role instances in the first upgrade domains that you examine have become unresponsive, you can call the [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx) operation on the deployment, which will leave untouched the instances which had not yet been upgraded and rollback instances which had been upgraded to the previous service package and configuration.</span></span>

<a name="multiplemutatingoperations"></a>

## <a name="initiating-multiple-mutating-operations-on-an-ongoing-deployment"></a><span data-ttu-id="90a08-268">Spouštění více mutating operací na probíhající nasazení</span><span class="sxs-lookup"><span data-stu-id="90a08-268">Initiating multiple mutating operations on an ongoing deployment</span></span>
<span data-ttu-id="90a08-269">V některých případech můžete chtít zahájit více souběžných mutating operací na probíhající nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-269">In some cases you may want to initiate multiple simultaneous mutating operations on an ongoing deployment.</span></span> <span data-ttu-id="90a08-270">Například může provádět aktualizaci služby a že aktualizace je se nasazuje přes služby, ale chcete provedení některých změn, například vrácení zpět aktualizace, použít jinou aktualizaci nebo odstranění i nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-270">For example, you may perform a service update and, while that update is being rolled out across your service, you want to make some change, e.g. to roll the update back, apply a different update, or even delete the deployment.</span></span> <span data-ttu-id="90a08-271">Případ, kdy to může být potřeba je, zda aktualizace služby obsahuje buggy kódu, což způsobí, že upgradovaná role instance na opakovaně k chybě.</span><span class="sxs-lookup"><span data-stu-id="90a08-271">A case in which this might be necessary is if a service upgrade contains buggy code which causes an upgraded role instance to repeatedly crash.</span></span> <span data-ttu-id="90a08-272">V takovém případě nebude Kontroleru prostředků infrastruktury Azure nemůže pokračovat v použití, která upgradovat, protože dostatečný počet instancí v upgradované domény jsou v pořádku.</span><span class="sxs-lookup"><span data-stu-id="90a08-272">In this case, the Azure Fabric Controller will not be able to make progress in applying that upgrade because an insufficient number of instances in the upgraded domain are healthy.</span></span> <span data-ttu-id="90a08-273">Tento stav se označuje jako *zablokované nasazení*.</span><span class="sxs-lookup"><span data-stu-id="90a08-273">This state is referred to as a *stuck deployment*.</span></span> <span data-ttu-id="90a08-274">Nasazení můžete unstick vrácení zpět aktualizace nebo novou aktualizaci nad horní neúspěšného jeden.</span><span class="sxs-lookup"><span data-stu-id="90a08-274">You can unstick the deployment by rolling back the update or applying a fresh update over top of the failing one.</span></span>

<span data-ttu-id="90a08-275">Po počáteční požadavek na aktualizaci nebo upgradu služby byla přijata adaptérem prostředků infrastruktury Azure, můžete začít následných mutace operací.</span><span class="sxs-lookup"><span data-stu-id="90a08-275">Once the initial request to update or upgrade the service has been received by the Azure Fabric Controller, you can start subsequent mutating operations.</span></span> <span data-ttu-id="90a08-276">To znamená, že nemáte počkejte na dokončení před zahájením jiná operace mutating počáteční operace.</span><span class="sxs-lookup"><span data-stu-id="90a08-276">That is, you do not have to wait for the initial operation to complete before you can start another mutating operation.</span></span>

<span data-ttu-id="90a08-277">Při první aktualizaci stále probíhá inicializace druhá operace aktualizace provede podobná operaci vrácení zpět.</span><span class="sxs-lookup"><span data-stu-id="90a08-277">Initiating a second update operation while the first update is ongoing will perform similar to the rollback operation.</span></span> <span data-ttu-id="90a08-278">Pokud je druhá aktualizace v automatickém režimu, první doména upgradu se upgradují okamžitě, by mohl vést k instancí z několika domén upgradu je offline ze stejného bodu v čase.</span><span class="sxs-lookup"><span data-stu-id="90a08-278">If the second update is in automatic mode, the first upgrade domain will be upgraded immediately, possibly leading to instances from multiple upgrade domains being offline at the same point in time.</span></span>

<span data-ttu-id="90a08-279">Mutating operace jsou následující: [změna konfigurace nasazení](https://msdn.microsoft.com/library/azure/ee460809.aspx), [nasazení upgradu](https://msdn.microsoft.com/library/azure/ee460793.aspx), [stav nasazení aktualizace](https://msdn.microsoft.com/library/azure/ee460808.aspx), [odstranit nasazení](https://msdn.microsoft.com/library/azure/ee460815.aspx), a [vrácení zpět aktualizace nebo upgradu](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span><span class="sxs-lookup"><span data-stu-id="90a08-279">The mutating operations are as follows: [Change Deployment Configuration](https://msdn.microsoft.com/library/azure/ee460809.aspx), [Upgrade Deployment](https://msdn.microsoft.com/library/azure/ee460793.aspx), [Update Deployment Status](https://msdn.microsoft.com/library/azure/ee460808.aspx), [Delete Deployment](https://msdn.microsoft.com/library/azure/ee460815.aspx), and [Rollback Update Or Upgrade](https://msdn.microsoft.com/library/azure/hh403977.aspx).</span></span>

<span data-ttu-id="90a08-280">Dvě operace [získat nasazení](https://msdn.microsoft.com/library/azure/ee460804.aspx) a [získat vlastnosti cloudové služby](https://msdn.microsoft.com/library/azure/ee460806.aspx), vrátí uzamčen příznak, který můžete prověřit, abyste zjistili, zda mutating operace může být volána na dané nasazení.</span><span class="sxs-lookup"><span data-stu-id="90a08-280">Two operations, [Get Deployment](https://msdn.microsoft.com/library/azure/ee460804.aspx) and [Get Cloud Service Properties](https://msdn.microsoft.com/library/azure/ee460806.aspx), return the Locked flag which can be examined to determine whether a mutating operation can be invoked on a given deployment.</span></span>

<span data-ttu-id="90a08-281">Volání verze těchto metod, které vrátí příznak uzamčen, je nutné nastavit hlavička požadavku na "x-ms-version: 2011-10-01" nebo pozdější.</span><span class="sxs-lookup"><span data-stu-id="90a08-281">In order to call the version of these methods which returns the Locked flag, you must set request header to “x-ms-version: 2011-10-01” or a later.</span></span> <span data-ttu-id="90a08-282">Další informace o hlavičkách verze najdete v tématu [Správa služby správy verzí](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span><span class="sxs-lookup"><span data-stu-id="90a08-282">For more information about versioning headers, see [Service Management Versioning](https://msdn.microsoft.com/library/azure/gg592580.aspx).</span></span>

<a name="distributiondfroles"></a>

## <a name="distribution-of-roles-across-upgrade-domains"></a><span data-ttu-id="90a08-283">Distribuce rolí napříč doménami upgradu</span><span class="sxs-lookup"><span data-stu-id="90a08-283">Distribution of roles across upgrade domains</span></span>
<span data-ttu-id="90a08-284">Instance role Azure rovnoměrně distribuuje mezi se stanoveným počtem upgradovacích domén, které lze konfigurovat jako součást souboru definice (.csdef) služby.</span><span class="sxs-lookup"><span data-stu-id="90a08-284">Azure distributes instances of a role evenly across a set number of upgrade domains, which can be configured as part of the service definition (.csdef) file.</span></span> <span data-ttu-id="90a08-285">Maximální počet domén upgradu je 20 a výchozí hodnota je 5.</span><span class="sxs-lookup"><span data-stu-id="90a08-285">The max number of upgrade domains is 20 and the default is 5.</span></span> <span data-ttu-id="90a08-286">Další informace o tom, jak upravit soubor definice služby najdete v tématu [Azure schématu definice služby (.csdef souboru)](cloud-services-model-and-package.md#csdef).</span><span class="sxs-lookup"><span data-stu-id="90a08-286">For more information about how to modify the service definition file, see [Azure Service Definition Schema (.csdef File)](cloud-services-model-and-package.md#csdef).</span></span>

<span data-ttu-id="90a08-287">Například pokud vaše role má deset instancí, ve výchozím nastavení každé upgradované domény obsahuje dvě instance.</span><span class="sxs-lookup"><span data-stu-id="90a08-287">For example, if your role has ten instances, by default each upgrade domain contains two instances.</span></span> <span data-ttu-id="90a08-288">Pokud vaše role má 14 instancí, potom čtyři upgradu domén obsahovat tři instance a páté domény obsahuje dva.</span><span class="sxs-lookup"><span data-stu-id="90a08-288">If your role has 14 instances, then four of the upgrade domains contain three instances, and a fifth domain contains two.</span></span>

<span data-ttu-id="90a08-289">Domén upgradu jsou označeny index počítaný od nuly: první doména upgradu má ID 0, a druhé upgradu domény ID 1 a tak dále.</span><span class="sxs-lookup"><span data-stu-id="90a08-289">Upgrade domains are identified with a zero-based index: the first upgrade domain has an ID of 0, and the second upgrade domain has an ID of 1, and so on.</span></span>

<span data-ttu-id="90a08-290">Následující diagram znázorňuje, jak služba než obsahuje dvě role při distribuují službu definuje dvě domény upgradu.</span><span class="sxs-lookup"><span data-stu-id="90a08-290">The following diagram illustrates how a service than contains two roles are distributed when the service defines two upgrade domains.</span></span> <span data-ttu-id="90a08-291">Služba běží osm instancí webovou roli a devět instancí role pracovního procesu.</span><span class="sxs-lookup"><span data-stu-id="90a08-291">The service is running eight instances of the web role and nine instances of the worker role.</span></span>

<span data-ttu-id="90a08-292">![Distribuce domén upgradu](media/cloud-services-update-azure-service/IC345533.png "distribuce domén upgradu")</span><span class="sxs-lookup"><span data-stu-id="90a08-292">![Distribution of Upgrade Domains](media/cloud-services-update-azure-service/IC345533.png "Distribution of Upgrade Domains")</span></span>

> [!NOTE]
> <span data-ttu-id="90a08-293">Všimněte si, že Azure řídit přidělování instancí napříč doménami upgradu.</span><span class="sxs-lookup"><span data-stu-id="90a08-293">Note that Azure controls how instances are allocated across upgrade domains.</span></span> <span data-ttu-id="90a08-294">Není možné určit, které instance jsou přiděleny do které domény.</span><span class="sxs-lookup"><span data-stu-id="90a08-294">It's not possible to specify which instances are allocated to which domain.</span></span>
>
>

## <a name="next-steps"></a><span data-ttu-id="90a08-295">Další kroky</span><span class="sxs-lookup"><span data-stu-id="90a08-295">Next steps</span></span>
[<span data-ttu-id="90a08-296">Jak spravovat Cloud Services</span><span class="sxs-lookup"><span data-stu-id="90a08-296">How to Manage Cloud Services</span></span>](cloud-services-how-to-manage.md)  
[<span data-ttu-id="90a08-297">Postup sledování cloudové služby</span><span class="sxs-lookup"><span data-stu-id="90a08-297">How to Monitor Cloud Services</span></span>](cloud-services-how-to-monitor.md)  
[<span data-ttu-id="90a08-298">Jak konfigurovat Cloud Services</span><span class="sxs-lookup"><span data-stu-id="90a08-298">How to Configure Cloud Services</span></span>](cloud-services-how-to-configure.md)  

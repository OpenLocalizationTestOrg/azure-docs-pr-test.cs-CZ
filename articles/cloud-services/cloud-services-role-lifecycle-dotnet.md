---
title: "Zpracování událostí životního cyklu cloudové služby | Microsoft Docs"
description: "Zjistěte, jak lze použít metody životního cyklu Cloudová služba role v rozhraní .NET"
services: cloud-services
documentationcenter: .net
author: Thraka
manager: timlt
editor: 
ms.assetid: 39b30acd-57b9-48b7-a7c4-40ea3430e451
ms.service: cloud-services
ms.workload: tbd
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 07/18/2017
ms.author: adegeo
ms.openlocfilehash: eb78c05df3b3cdf3887334c11bdabd5cebb74747
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="customize-the-lifecycle-of-a-web-or-worker-role-in-net"></a><span data-ttu-id="f893d-103">Přizpůsobení životního cyklu webové role nebo role pracovního procesu v .NET</span><span class="sxs-lookup"><span data-stu-id="f893d-103">Customize the Lifecycle of a Web or Worker role in .NET</span></span>
<span data-ttu-id="f893d-104">Když vytvoříte roli pracovního procesu, můžete rozšířit [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) třída, která poskytuje metody pro vás k přepsání, které vám umožní reagovat na události životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="f893d-104">When you create a worker role, you extend the [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class which provides methods for you to override that let you respond to lifecycle events.</span></span> <span data-ttu-id="f893d-105">Pro webové role Tato třída je volitelné, takže je nutné použít na reakce na události životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="f893d-105">For web roles this class is optional, so you must use it to respond to lifecycle events.</span></span>

## <a name="extend-the-roleentrypoint-class"></a><span data-ttu-id="f893d-106">Rozšíření třídy RoleEntryPoint</span><span class="sxs-lookup"><span data-stu-id="f893d-106">Extend the RoleEntryPoint class</span></span>
<span data-ttu-id="f893d-107">[RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) třída obsahuje metody, které se nazývají Azure při jeho **spustí**, **spouští**, nebo **zastaví** roli web nebo worker.</span><span class="sxs-lookup"><span data-stu-id="f893d-107">The [RoleEntryPoint](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.aspx) class includes methods that are called by Azure when it **starts**, **runs**, or **stops** a web or worker role.</span></span> <span data-ttu-id="f893d-108">Volitelně můžete přepsat tyto metody pro správu role inicializace, role vypnutí pořadí nebo prováděcí vlákno role.</span><span class="sxs-lookup"><span data-stu-id="f893d-108">You can optionally override these methods to manage role initialization, role shutdown sequences, or the execution thread of the role.</span></span> 

<span data-ttu-id="f893d-109">Při rozšiřování **RoleEntryPoint**, byste měli vědět z následujících chování metod:</span><span class="sxs-lookup"><span data-stu-id="f893d-109">When extending **RoleEntryPoint**, you should be aware of the following behaviors of the methods:</span></span>

* <span data-ttu-id="f893d-110">[OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) a [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) metody vrátit logickou hodnotu, takže je možné vrátit **false** z těchto metod.</span><span class="sxs-lookup"><span data-stu-id="f893d-110">The [OnStart](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstart.aspx) and [OnStop](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) methods return a boolean value, so it is possible to return **false** from these methods.</span></span>
  
   <span data-ttu-id="f893d-111">Pokud váš kód vrátí **false**neočekávaného ukončení procesu role, bez spuštění jakékoli pořadí vypnutí můžete mít na místě.</span><span class="sxs-lookup"><span data-stu-id="f893d-111">If your code returns **false**, the role process is abruptly terminated, without running any shutdown sequence you may have in place.</span></span> <span data-ttu-id="f893d-112">Obecně platí, neměli byste vrácení **false** z **OnStart** metoda.</span><span class="sxs-lookup"><span data-stu-id="f893d-112">In general, you should avoid returning **false** from the **OnStart** method.</span></span>
* <span data-ttu-id="f893d-113">Žádné nezachycená v rámci přetížení **RoleEntryPoint** metoda je považován za k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="f893d-113">Any uncaught exception within an overload of a **RoleEntryPoint** method is treated as an unhandled exception.</span></span>
  
   <span data-ttu-id="f893d-114">Pokud dojde k výjimce v rámci jedné z metod životního cyklu, bude vyvolána Azure [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) událostí a proces je ukončen.</span><span class="sxs-lookup"><span data-stu-id="f893d-114">If an exception occurs within one of the lifecycle methods, Azure will raise the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event, and then the process is terminated.</span></span> <span data-ttu-id="f893d-115">Po vaše role je v režimu offline, se restartuje v Azure.</span><span class="sxs-lookup"><span data-stu-id="f893d-115">After your role has been taken offline, it will be restarted by Azure.</span></span> <span data-ttu-id="f893d-116">Když dojde k neošetřené výjimce [zastavení](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) událost se vyvolá a **OnStop** metoda není volána.</span><span class="sxs-lookup"><span data-stu-id="f893d-116">When an unhandled exception occurs, the [Stopping](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleenvironment.stopping.aspx) event is not raised, and the **OnStop** method is not called.</span></span>

<span data-ttu-id="f893d-117">Pokud vaše role se nespustí, nebo je recyklace inicializace zaneprázdněný, až zastavením stavy, může váš kód vyvolání k neošetřené výjimce v rámci jedné události životního cyklu každém restartování roli.</span><span class="sxs-lookup"><span data-stu-id="f893d-117">If your role does not start, or is recycling between the initializing, busy, and stopping states, your code may be throwing an unhandled exception within one of the lifecycle events each time the role restarts.</span></span> <span data-ttu-id="f893d-118">V takovém případě použijte [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) událostí a zjistěte příčinu výjimka správně zpracovat.</span><span class="sxs-lookup"><span data-stu-id="f893d-118">In this case, use the [UnhandledException](https://msdn.microsoft.com/library/system.appdomain.unhandledexception.aspx) event to determine the cause of the exception and handle it appropriately.</span></span> <span data-ttu-id="f893d-119">Vaše role může být také vrácení z [spustit](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) metoda, což způsobí, že role, kterou chcete restartovat.</span><span class="sxs-lookup"><span data-stu-id="f893d-119">Your role may also be returning from the [Run](https://msdn.microsoft.com/library/azure/microsoft.windowsazure.serviceruntime.roleentrypoint.run.aspx) method, which causes the role to restart.</span></span> <span data-ttu-id="f893d-120">Další informace o stavy nasazení najdete v tématu [běžné problémy které příčina rolí k recyklaci](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span><span class="sxs-lookup"><span data-stu-id="f893d-120">For more information about deployment states, see [Common Issues Which Cause Roles to Recycle](cloud-services-troubleshoot-common-issues-which-cause-roles-recycle.md).</span></span>

> [!NOTE]
> <span data-ttu-id="f893d-121">Pokud používáte **nástroje Azure pro sadu Microsoft Visual Studio** vyvíjet aplikace, šablony projektů role automaticky rozšířit **RoleEntryPoint** třídy, v  *WebRole.cs* a *WorkerRole.cs* soubory.</span><span class="sxs-lookup"><span data-stu-id="f893d-121">If you are using the **Azure Tools for Microsoft Visual Studio** to develop your application, the role project templates automatically extend the **RoleEntryPoint** class for you, in the *WebRole.cs* and *WorkerRole.cs* files.</span></span>
> 
> 

## <a name="onstart-method"></a><span data-ttu-id="f893d-122">OnStart – metoda</span><span class="sxs-lookup"><span data-stu-id="f893d-122">OnStart method</span></span>
<span data-ttu-id="f893d-123">**OnStart** metoda je volána, když vaše instance role do online režimu Azure.</span><span class="sxs-lookup"><span data-stu-id="f893d-123">The **OnStart** method is called when your role instance is brought online by Azure.</span></span> <span data-ttu-id="f893d-124">Při spouštění kód OnStart role instance je označena jako **zaneprázdněn** a žádný externí provoz budete přesměrováni na je nástroj pro vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="f893d-124">While the OnStart code is executing, the role instance is marked as **Busy** and no external traffic will be directed to it by the load balancer.</span></span> <span data-ttu-id="f893d-125">Můžete přepsat tuto metodu za účelem inicializace práci, jako je například implementace obslužné rutiny událostí a spuštění [Azure Diagnostics](cloud-services-how-to-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="f893d-125">You can override this method to perform initialization work, such as implementing event handlers and starting [Azure Diagnostics](cloud-services-how-to-monitor.md).</span></span>

<span data-ttu-id="f893d-126">Pokud **OnStart** vrátí **true**, instance je úspěšně inicializován a Azure volá **RoleEntryPoint.Run** metoda.</span><span class="sxs-lookup"><span data-stu-id="f893d-126">If **OnStart** returns **true**, the instance is successfully initialized and Azure calls the **RoleEntryPoint.Run** method.</span></span> <span data-ttu-id="f893d-127">Pokud **OnStart** vrátí **false**, roli ukončí okamžitě, bez spuštění jakýchkoli pořadí plánované vypnutí.</span><span class="sxs-lookup"><span data-stu-id="f893d-127">If **OnStart** returns **false**, the role terminates immediately, without executing any planned shutdown sequences.</span></span>

<span data-ttu-id="f893d-128">Následující příklad kódu ukazuje, jak lze přepsat **OnStart** metoda.</span><span class="sxs-lookup"><span data-stu-id="f893d-128">The following code example shows how to override the **OnStart** method.</span></span> <span data-ttu-id="f893d-129">Tato metoda nakonfiguruje a spustí monitorování diagnostiky, když role instance spuštění a nastaví přenosu dat protokolování na účet úložiště:</span><span class="sxs-lookup"><span data-stu-id="f893d-129">This method configures and starts a diagnostic monitor when the role instance starts and sets up a transfer of logging data to a storage account:</span></span>

```csharp
public override bool OnStart()
{
    var config = DiagnosticMonitor.GetDefaultInitialConfiguration();

    config.DiagnosticInfrastructureLogs.ScheduledTransferLogLevelFilter = LogLevel.Error;
    config.DiagnosticInfrastructureLogs.ScheduledTransferPeriod = TimeSpan.FromMinutes(5);

    DiagnosticMonitor.Start("DiagnosticsConnectionString", config);

    return true;
}
```

## <a name="onstop-method"></a><span data-ttu-id="f893d-130">Onstop – metoda</span><span class="sxs-lookup"><span data-stu-id="f893d-130">OnStop method</span></span>
<span data-ttu-id="f893d-131">**OnStop** metoda je volána po instanci role je v režimu offline v Azure a před proces bude ukončen.</span><span class="sxs-lookup"><span data-stu-id="f893d-131">The **OnStop** method is called after a role instance has been taken offline by Azure and before the process exits.</span></span> <span data-ttu-id="f893d-132">Mohou přepsat tuto metodu volat kódu vyžadovaného pro instanci role řádně vypnout.</span><span class="sxs-lookup"><span data-stu-id="f893d-132">You can override this method to call code required for your role instance to cleanly shut down.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f893d-133">Kód spuštěný ve **OnStop** metoda má po omezenou dobu ukončíte při volání z jiných důvodů než vypnutí spuštěné uživatelem.</span><span class="sxs-lookup"><span data-stu-id="f893d-133">Code running in the **OnStop** method has a limited time to finish when it is called for reasons other than a user-initiated shutdown.</span></span> <span data-ttu-id="f893d-134">Po uplynutí této doby, ukončení procesu, ujistěte se, že kód **OnStop** metoda lze rychle spustit nebo toleruje není spuštěna na dokončení.</span><span class="sxs-lookup"><span data-stu-id="f893d-134">After this time elapses, the process is terminated, so you must make sure that code in the **OnStop** method can run quickly or tolerates not running to completion.</span></span> <span data-ttu-id="f893d-135">**OnStop** metoda je volána po **zastavení** událost se vyvolá.</span><span class="sxs-lookup"><span data-stu-id="f893d-135">The **OnStop** method is called after the **Stopping** event is raised.</span></span>
> 
> 

## <a name="run-method"></a><span data-ttu-id="f893d-136">Run – metoda</span><span class="sxs-lookup"><span data-stu-id="f893d-136">Run method</span></span>
<span data-ttu-id="f893d-137">Je možné přepsat **spustit** metody k implementaci dlouho spuštěných vláken pro instanci role.</span><span class="sxs-lookup"><span data-stu-id="f893d-137">You can override the **Run** method to implement a long-running thread for your role instance.</span></span>

<span data-ttu-id="f893d-138">Přepsání **spustit** metoda není vyžadováno; výchozí implementace spustí vlákno, které uspí navždy.</span><span class="sxs-lookup"><span data-stu-id="f893d-138">Overriding the **Run** method is not required; the default implementation starts a thread that sleeps forever.</span></span> <span data-ttu-id="f893d-139">Pokud přepíšete **spustit** metoda, váš kód by měl blokovat po neomezenou dobu.</span><span class="sxs-lookup"><span data-stu-id="f893d-139">If you do override the **Run** method, your code should block indefinitely.</span></span> <span data-ttu-id="f893d-140">Pokud **spustit** metoda vrátí hodnotu, je automaticky řádně recykluje roli; jinými slovy, vyvolá Azure **zastavení** událostí a volání **OnStop** metoda tak, aby vaše vypnutí pořadí může být spuštěna před role do režimu offline.</span><span class="sxs-lookup"><span data-stu-id="f893d-140">If the **Run** method returns, the role is automatically gracefully recycled; in other words, Azure raises the **Stopping** event and calls the **OnStop** method so that your shutdown sequences may be executed before the role is taken offline.</span></span>

### <a name="implementing-the-aspnet-lifecycle-methods-for-a-web-role"></a><span data-ttu-id="f893d-141">Implementace metody životního cyklu ASP.NET pro webové role</span><span class="sxs-lookup"><span data-stu-id="f893d-141">Implementing the ASP.NET lifecycle methods for a web role</span></span>
<span data-ttu-id="f893d-142">Můžete použít metody životního cyklu ASP.NET, kromě těch, které poskytuje **RoleEntryPoint** třídy, ke správě pořadí inicializace a vypnutí pro webové role.</span><span class="sxs-lookup"><span data-stu-id="f893d-142">You can use the ASP.NET lifecycle methods, in addition to those provided by the **RoleEntryPoint** class, to manage initialization and shutdown sequences for a web role.</span></span> <span data-ttu-id="f893d-143">To může být užitečná pro účely kompatibility, pokud jsou portování stávající aplikaci ASP.NET do Azure.</span><span class="sxs-lookup"><span data-stu-id="f893d-143">This may be useful for compatibility purposes if you are porting an existing ASP.NET application to Azure.</span></span> <span data-ttu-id="f893d-144">Metody životního cyklu ASP.NET jsou volány prostřednictvím **RoleEntryPoint** metody.</span><span class="sxs-lookup"><span data-stu-id="f893d-144">The ASP.NET lifecycle methods are called from within the **RoleEntryPoint** methods.</span></span> <span data-ttu-id="f893d-145">**Aplikace\_spustit** metoda je volána po **RoleEntryPoint.OnStart** Metoda dokončení.</span><span class="sxs-lookup"><span data-stu-id="f893d-145">The **Application\_Start** method is called after the **RoleEntryPoint.OnStart** method finishes.</span></span> <span data-ttu-id="f893d-146">**Aplikace\_End** metoda je volána před provedením **RoleEntryPoint.OnStop** metoda je volána.</span><span class="sxs-lookup"><span data-stu-id="f893d-146">The **Application\_End** method is called before the **RoleEntryPoint.OnStop** method is called.</span></span>

## <a name="next-steps"></a><span data-ttu-id="f893d-147">Další kroky</span><span class="sxs-lookup"><span data-stu-id="f893d-147">Next steps</span></span>
<span data-ttu-id="f893d-148">Zjistěte, jak [vytvořit balíček služby cloud](cloud-services-model-and-package.md).</span><span class="sxs-lookup"><span data-stu-id="f893d-148">Learn how to [create a cloud service package](cloud-services-model-and-package.md).</span></span>


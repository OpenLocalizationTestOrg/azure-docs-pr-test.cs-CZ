---
title: "aaaTroubleshooting došlo k chybě přidělení cloudové služby | Microsoft Docs"
description: "Řešení potíží s přidělením při nasazení Cloud Services v Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: dfd5cc4663ccc6ed1b27ca9df579182737363b0e
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="9256e-103">Řešení potíží s přidělením při nasazení Cloud Services v Azure</span><span class="sxs-lookup"><span data-stu-id="9256e-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="9256e-104">Souhrn</span><span class="sxs-lookup"><span data-stu-id="9256e-104">Summary</span></span>
<span data-ttu-id="9256e-105">Při nasazení instance tooa Cloudovou službu nebo přidat nový web nebo instancí rolí pracovního procesu, Microsoft Azure přiřadí výpočetní prostředky.</span><span class="sxs-lookup"><span data-stu-id="9256e-105">When you deploy instances tooa Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="9256e-106">Příležitostně zobrazí chyby při provádění těchto operací ještě před dosažením hello limity předplatného Azure.</span><span class="sxs-lookup"><span data-stu-id="9256e-106">You may occasionally receive errors when performing these operations even before you reach hello Azure subscription limits.</span></span> <span data-ttu-id="9256e-107">Tento článek vysvětluje hello příčiny některých běžných chyb přidělení hello a navrhne možné nápravu.</span><span class="sxs-lookup"><span data-stu-id="9256e-107">This article explains hello causes of some of hello common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="9256e-108">Hello informace může být užitečné také při plánování nasazení hello vašich služeb.</span><span class="sxs-lookup"><span data-stu-id="9256e-108">hello information may also be useful when you plan hello deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="9256e-109">Pozadí – fungování přidělení</span><span class="sxs-lookup"><span data-stu-id="9256e-109">Background – How allocation works</span></span>
<span data-ttu-id="9256e-110">do clusterů do několika oddílů Hello serverů v datových centrech Azure.</span><span class="sxs-lookup"><span data-stu-id="9256e-110">hello servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="9256e-111">Žádost o nové cloudové služby přidělení dojde k pokusu o několik clusterů.</span><span class="sxs-lookup"><span data-stu-id="9256e-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="9256e-112">Při první instance hello je nasazené tooa cloudové služby (v rámci buď pracovním nebo produkčním), která Cloudová služba získá definovaného tooa clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-112">When hello first instance is deployed tooa cloud service(in either staging or production), that cloud service gets pinned tooa cluster.</span></span> <span data-ttu-id="9256e-113">Žádné další nasazení pro hello Cloudová služba se stane v hello stejné clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-113">Any further deployments for hello cloud service will happen in hello same cluster.</span></span> <span data-ttu-id="9256e-114">V tomto článku označujeme toothis jako "definovaného tooa clusteru".</span><span class="sxs-lookup"><span data-stu-id="9256e-114">In this article, we'll refer toothis as "pinned tooa cluster".</span></span> <span data-ttu-id="9256e-115">Obrázek 1 níže znázorňuje hello malá normální přidělení, které dojde k pokusu o několik clusterů; Obrázek 2 znázorňuje hello malá přidělení to je vázaný tooCluster 2 protože, kde je hello existující CS_1 cloudové služby je hostovaná.</span><span class="sxs-lookup"><span data-stu-id="9256e-115">Diagram 1 below illustrates hello case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates hello case of an allocation that's pinned tooCluster 2 because that's where hello existing Cloud Service CS_1 is hosted.</span></span>

![Diagram přidělení](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="9256e-117">Proč se stane došlo k chybě přidělení</span><span class="sxs-lookup"><span data-stu-id="9256e-117">Why allocation failure happens</span></span>
<span data-ttu-id="9256e-118">Při požadavku na přidělení je vázaný tooa cluster, existuje vyšší pravděpodobnost selhávat toofind volných prostředků, protože fond k dispozici zdrojů hello je omezená tooa clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-118">When an allocation request is pinned tooa cluster, there's a higher chance of failing toofind free resources since hello available resource pool is limited tooa cluster.</span></span> <span data-ttu-id="9256e-119">Kromě toho pokud požadavek na přidělení definovaného tooa clusteru, ale tento cluster nepodporuje hello typ prostředku, který jste požadovali, vaši žádost se nezdaří i v případě, že má hello cluster volný prostředek.</span><span class="sxs-lookup"><span data-stu-id="9256e-119">Furthermore, if your allocation request is pinned tooa cluster but hello type of resource you requested is not supported by that cluster, your request will fail even if hello cluster has free resource.</span></span> <span data-ttu-id="9256e-120">Obrázek 3 níže znázorňuje hello případu, kdy připojené přidělení nezdaří, protože hello pouze candidate cluster nebude mít uvolnění prostředků.</span><span class="sxs-lookup"><span data-stu-id="9256e-120">Diagram 3 below illustrates hello case where a pinned allocation fails because hello only candidate cluster does not have free resources.</span></span> <span data-ttu-id="9256e-121">Obrázek 4 ukazuje hello případu, kdy připojené přidělení nezdaří, protože hello pouze candidate clusteru nepodporuje hello požadovaná velikost virtuálního počítače, i když má hello cluster uvolnění prostředků.</span><span class="sxs-lookup"><span data-stu-id="9256e-121">Diagram 4 illustrates hello case where a pinned allocation fails because hello only candidate cluster does not support hello requested VM size, even though hello cluster has free resources.</span></span>

![Došlo k chybě definovaného přidělení](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="9256e-123">Řešení potíží s přidělením pro cloudové služby</span><span class="sxs-lookup"><span data-stu-id="9256e-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="9256e-124">Chybová zpráva</span><span class="sxs-lookup"><span data-stu-id="9256e-124">Error Message</span></span>
<span data-ttu-id="9256e-125">Mohou se zobrazit hello následující chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="9256e-125">You may see hello following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable toosatisfy constraints in request. hello requested new service deployment is bound tooan Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains hello new deployment toospecific Azure resources. Please retry later or try reducing hello VM size or number of role instances. Alternatively, if possible, remove hello aforementioned constraints or try deploying tooa different region."

### <a name="common-issues"></a><span data-ttu-id="9256e-126">Běžné problémy</span><span class="sxs-lookup"><span data-stu-id="9256e-126">Common Issues</span></span>
<span data-ttu-id="9256e-127">Tady jsou hello běžné přidělení scénáře, které způsobí přidělení požadavek toobe definovaného tooa jeden cluster.</span><span class="sxs-lookup"><span data-stu-id="9256e-127">Here are hello common allocation scenarios that cause an allocation request toobe pinned tooa single cluster.</span></span>

* <span data-ttu-id="9256e-128">Nasazení tooStaging slotu – cloudové služby má v buď slotu nasazení, pak hello celý Cloudová služba je vázaný tooa konkrétní clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-128">Deploying tooStaging Slot - If a cloud service has a deployment in either slot, then hello entire cloud service is pinned tooa specific cluster.</span></span>  <span data-ttu-id="9256e-129">To znamená, že pokud nasazení již existuje v produkční slot hello, pak nové pracovní nasazení lze pouze přiřadit ve hello stejné clusteru jako hello produkční slot.</span><span class="sxs-lookup"><span data-stu-id="9256e-129">This means that if a deployment already exists in hello production slot, then a new staging deployment can only be allocated in hello same cluster as hello production slot.</span></span> <span data-ttu-id="9256e-130">Pokud hello cluster se blíží obsazení, hello žádost může selhat.</span><span class="sxs-lookup"><span data-stu-id="9256e-130">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="9256e-131">Škálování – přidání nové instance tooan stávající cloudovou službu přidělíte v hello stejné clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-131">Scaling - Adding new instances tooan existing cloud service must allocate in hello same cluster.</span></span>  <span data-ttu-id="9256e-132">Malého škálování požadavků lze obvykle rozdělit, ale ne vždy.</span><span class="sxs-lookup"><span data-stu-id="9256e-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="9256e-133">Pokud hello cluster se blíží obsazení, hello žádost může selhat.</span><span class="sxs-lookup"><span data-stu-id="9256e-133">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="9256e-134">Skupina vztahů – nové nasazení tooan prázdný cloudové služby mohou být přiděleny přes hello fabric v jakémkoliv clusteru v této oblasti, pokud hello Cloudová služba je skupina vztahů definovaného tooan.</span><span class="sxs-lookup"><span data-stu-id="9256e-134">Affinity Group - A new deployment tooan empty cloud service can be allocated by hello fabric in any cluster in that region, unless hello cloud service is pinned tooan affinity group.</span></span> <span data-ttu-id="9256e-135">Nasazení toohello stejnou skupinu vztahů se pokus o hello stejného clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-135">Deployments toohello same affinity group will be attempted on hello same cluster.</span></span> <span data-ttu-id="9256e-136">Pokud hello cluster se blíží obsazení, hello žádost může selhat.</span><span class="sxs-lookup"><span data-stu-id="9256e-136">If hello cluster is nearing capacity, hello request may fail.</span></span>
* <span data-ttu-id="9256e-137">Skupiny vztahů vNet - starší virtuální sítě bylo vázané tooaffinity skupin místo oblasti a cloudové služby v tyto virtuální sítě budou definovaného toohello vztahů skupiny clusteru.</span><span class="sxs-lookup"><span data-stu-id="9256e-137">Affinity Group vNet - Older Virtual Networks were tied tooaffinity groups instead of regions, and cloud services in these Virtual Networks would be pinned toohello affinity group cluster.</span></span> <span data-ttu-id="9256e-138">V clusteru hello připnutý se pokusí toothis typ nasazení virtuální sítě.</span><span class="sxs-lookup"><span data-stu-id="9256e-138">Deployments toothis type of virtual network will be attempted on hello pinned cluster.</span></span> <span data-ttu-id="9256e-139">Pokud hello cluster se blíží obsazení, hello žádost může selhat.</span><span class="sxs-lookup"><span data-stu-id="9256e-139">If hello cluster is nearing capacity, hello request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="9256e-140">Řešení</span><span class="sxs-lookup"><span data-stu-id="9256e-140">Solutions</span></span>
1. <span data-ttu-id="9256e-141">Znovu ho zaveďte tooa nová Cloudová služba – toto řešení je pravděpodobně toobe nejvíce úspěšné, protože umožňuje hello platformy toochoose ze všech clusterů v této oblasti.</span><span class="sxs-lookup"><span data-stu-id="9256e-141">Redeploy tooa new cloud service - This solution is likely toobe most successful as it allows hello platform toochoose from all clusters in that region.</span></span>

   * <span data-ttu-id="9256e-142">Nasazení hello zatížení tooa novou cloudovou službu</span><span class="sxs-lookup"><span data-stu-id="9256e-142">Deploy hello workload tooa new cloud service</span></span>  
   * <span data-ttu-id="9256e-143">Aktualizovat hello CNAME nebo A záznamů toopoint provoz toohello novou cloudovou službu</span><span class="sxs-lookup"><span data-stu-id="9256e-143">Update hello CNAME or A record toopoint traffic toohello new cloud service</span></span>
   * <span data-ttu-id="9256e-144">Jakmile nulové provoz prochází toohello staré lokality, můžete odstranit hello staré cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="9256e-144">Once zero traffic is going toohello old site, you can delete hello old cloud service.</span></span> <span data-ttu-id="9256e-145">Toto řešení měly ukládat nepřeruší.</span><span class="sxs-lookup"><span data-stu-id="9256e-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="9256e-146">Odstranit produkční a pracovní sloty – toto řešení se zachovat svůj existující název DNS, ale může způsobit výpadek tooyour aplikace.</span><span class="sxs-lookup"><span data-stu-id="9256e-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime tooyour application.</span></span>

   * <span data-ttu-id="9256e-147">Odstranit hello produkční a pracovní sloty stávající cloudovou službu, aby hello Cloudová služba je prázdná a potom</span><span class="sxs-lookup"><span data-stu-id="9256e-147">Delete hello production and staging slots of an existing cloud service so that hello cloud service is empty, and then</span></span>
   * <span data-ttu-id="9256e-148">Vytvořte nové nasazení v hello stávající cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="9256e-148">Create a new deployment in hello existing cloud service.</span></span> <span data-ttu-id="9256e-149">To se znovu pokusí tooallocation na všech clusterech v oblasti hello.</span><span class="sxs-lookup"><span data-stu-id="9256e-149">This will re-attempt tooallocation on all clusters in hello region.</span></span> <span data-ttu-id="9256e-150">Zajistěte, aby hello Cloudová služba není vázaná tooan skupiny vztahů.</span><span class="sxs-lookup"><span data-stu-id="9256e-150">Ensure hello cloud service is not tied tooan affinity group.</span></span>
3. <span data-ttu-id="9256e-151">Vyhrazená IP adresa – toto řešení se zachovat stávající IP adresy, ale může způsobit výpadek tooyour aplikace.</span><span class="sxs-lookup"><span data-stu-id="9256e-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime tooyour application.</span></span>  

   * <span data-ttu-id="9256e-152">Vytvořit vyhrazenou IP adresu pro vaše stávající nasazení pomocí prostředí Powershell</span><span class="sxs-lookup"><span data-stu-id="9256e-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="9256e-153">Postupujte podle #2 výše, provedení zda toospecify hello nové vyhrazené IP adresy v CSCFG hello služby.</span><span class="sxs-lookup"><span data-stu-id="9256e-153">Follow #2 from above, making sure toospecify hello new ReservedIP in hello service's CSCFG.</span></span>
4. <span data-ttu-id="9256e-154">Odeberte skupinu vztahů pro nová nasazení - už doporučují skupiny vztahů.</span><span class="sxs-lookup"><span data-stu-id="9256e-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="9256e-155">Postupujte podle kroků pro #1 výše toodeploy novou cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="9256e-155">Follow steps for #1 above toodeploy a new cloud service.</span></span> <span data-ttu-id="9256e-156">Ujistěte se, Cloudová služba není ve skupině vztahů.</span><span class="sxs-lookup"><span data-stu-id="9256e-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="9256e-157">Převést tooa regionální virtuální síť – viz [jak toomigrate ze skupiny vztahů tooa regionální virtuální síť (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="9256e-157">Convert tooa Regional Virtual Network - See [How toomigrate from Affinity Groups tooa Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>

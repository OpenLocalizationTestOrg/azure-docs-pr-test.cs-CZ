---
title: "Řešení potíží s přidělením cloudové služby | Microsoft Docs"
description: "Řešení potíží s přidělením při nasazení Cloud Services v Azure"
services: azure-service-management, cloud-services
documentationcenter: 
author: simonxjx
manager: felixwu
editor: 
tags: top-support-issue
ms.assetid: 529157eb-e4a1-4388-aa2b-09e8b923af74
ms.service: cloud-services
ms.workload: na
ms.tgt_pltfrm: ibiza
ms.devlang: na
ms.topic: article
ms.date: 7/26/2017
ms.author: v-six
ms.openlocfilehash: 3379b6d9bea874abecae7e56d30cfb15e6b0c2fc
ms.sourcegitcommit: 02e69c4a9d17645633357fe3d46677c2ff22c85a
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/03/2017
---
# <a name="troubleshooting-allocation-failure-when-you-deploy-cloud-services-in-azure"></a><span data-ttu-id="fc0d6-103">Řešení potíží s přidělením při nasazení Cloud Services v Azure</span><span class="sxs-lookup"><span data-stu-id="fc0d6-103">Troubleshooting allocation failure when you deploy Cloud Services in Azure</span></span>
## <a name="summary"></a><span data-ttu-id="fc0d6-104">Souhrn</span><span class="sxs-lookup"><span data-stu-id="fc0d6-104">Summary</span></span>
<span data-ttu-id="fc0d6-105">Při nasazování instancí cloudové služby nebo přidat nový web nebo instancí rolí pracovního procesu, Microsoft Azure přiřadí výpočetní prostředky.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-105">When you deploy instances to a Cloud Service or add new web or worker role instances, Microsoft Azure allocates compute resources.</span></span> <span data-ttu-id="fc0d6-106">Příležitostně zobrazí chyby při provádění těchto operací ještě před dosažením limity předplatného Azure.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-106">You may occasionally receive errors when performing these operations even before you reach the Azure subscription limits.</span></span> <span data-ttu-id="fc0d6-107">Tento článek vysvětluje příčiny některých běžných chyb přidělení a navrhne možné nápravu.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-107">This article explains the causes of some of the common allocation failures and suggests possible remediation.</span></span> <span data-ttu-id="fc0d6-108">Informace mohou být užitečné také při plánování nasazení vašich služeb.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-108">The information may also be useful when you plan the deployment of your services.</span></span>

[!INCLUDE [support-disclaimer](../../includes/support-disclaimer.md)]

### <a name="background--how-allocation-works"></a><span data-ttu-id="fc0d6-109">Pozadí – fungování přidělení</span><span class="sxs-lookup"><span data-stu-id="fc0d6-109">Background – How allocation works</span></span>
<span data-ttu-id="fc0d6-110">Servery v datových centrech Azure jsou rozděleny do clusterů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-110">The servers in Azure datacenters are partitioned into clusters.</span></span> <span data-ttu-id="fc0d6-111">Žádost o nové cloudové služby přidělení dojde k pokusu o několik clusterů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-111">A new cloud service allocation request is attempted in multiple clusters.</span></span> <span data-ttu-id="fc0d6-112">Při nasazení první instance do cloudové služby (ve buď pracovním nebo produkčním), která Cloudová služba získá připnuli do clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-112">When the first instance is deployed to a cloud service(in either staging or production), that cloud service gets pinned to a cluster.</span></span> <span data-ttu-id="fc0d6-113">Stane se žádné další nasazení pro cloudové služby ve stejném clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-113">Any further deployments for the cloud service will happen in the same cluster.</span></span> <span data-ttu-id="fc0d6-114">V tomto článku budeme označovat to jako "připnutý do clusteru s podporou".</span><span class="sxs-lookup"><span data-stu-id="fc0d6-114">In this article, we'll refer to this as "pinned to a cluster".</span></span> <span data-ttu-id="fc0d6-115">Obrázek 1 níže znázorňuje malá normální přidělení, které dojde k pokusu o několik clusterů; Obrázek 2 znázorňuje malá přidělení, má připnuli k clusteru 2, protože se jedná, je hostitelem existující služby CS_1 cloudu.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-115">Diagram 1 below illustrates the case of a normal allocation which is attempted in multiple clusters; Diagram 2 illustrates the case of an allocation that's pinned to Cluster 2 because that's where the existing Cloud Service CS_1 is hosted.</span></span>

![Diagram přidělení](./media/cloud-services-allocation-failure/Allocation1.png)

### <a name="why-allocation-failure-happens"></a><span data-ttu-id="fc0d6-117">Proč se stane došlo k chybě přidělení</span><span class="sxs-lookup"><span data-stu-id="fc0d6-117">Why allocation failure happens</span></span>
<span data-ttu-id="fc0d6-118">Při požadavku na přidělení je ukotvena do clusteru, existuje vyšší pravděpodobnost nedaří najít volných prostředků, protože fond zdrojů k dispozici je omezený na clusteru s podporou.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-118">When an allocation request is pinned to a cluster, there's a higher chance of failing to find free resources since the available resource pool is limited to a cluster.</span></span> <span data-ttu-id="fc0d6-119">Kromě toho pokud požadavek na přidělení umístěn v clusteru, ale tento cluster nepodporuje typ prostředku, který jste požadovali, vaši žádost se nezdaří i v případě, že cluster má volný prostředek.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-119">Furthermore, if your allocation request is pinned to a cluster but the type of resource you requested is not supported by that cluster, your request will fail even if the cluster has free resource.</span></span> <span data-ttu-id="fc0d6-120">Obrázek 3 níže znázorňuje tento případ, kdy připojené přidělení nezdaří, protože cluster jenom candidate nemá uvolnění prostředků.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-120">Diagram 3 below illustrates the case where a pinned allocation fails because the only candidate cluster does not have free resources.</span></span> <span data-ttu-id="fc0d6-121">Obrázek 4 znázorňuje tento případ, kde připojené přidělení nezdaří, protože pouze candidate clusteru nepodporuje požadovaná velikost virtuálního počítače, i když cluster má uvolnění prostředků.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-121">Diagram 4 illustrates the case where a pinned allocation fails because the only candidate cluster does not support the requested VM size, even though the cluster has free resources.</span></span>

![Došlo k chybě definovaného přidělení](./media/cloud-services-allocation-failure/Allocation2.png)

## <a name="troubleshooting-allocation-failure-for-cloud-services"></a><span data-ttu-id="fc0d6-123">Řešení potíží s přidělením pro cloudové služby</span><span class="sxs-lookup"><span data-stu-id="fc0d6-123">Troubleshooting allocation failure for cloud services</span></span>
### <a name="error-message"></a><span data-ttu-id="fc0d6-124">Chybová zpráva</span><span class="sxs-lookup"><span data-stu-id="fc0d6-124">Error Message</span></span>
<span data-ttu-id="fc0d6-125">Mohou se zobrazit tato chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="fc0d6-125">You may see the following error message:</span></span>

    "Azure operation '{operation id}' failed with code Compute.ConstrainedAllocationFailed. Details: Allocation failed; unable to satisfy constraints in request. The requested new service deployment is bound to an Affinity Group, or it targets a Virtual Network, or there is an existing deployment under this hosted service. Any of these conditions constrains the new deployment to specific Azure resources. Please retry later or try reducing the VM size or number of role instances. Alternatively, if possible, remove the aforementioned constraints or try deploying to a different region."

### <a name="common-issues"></a><span data-ttu-id="fc0d6-126">Běžné problémy</span><span class="sxs-lookup"><span data-stu-id="fc0d6-126">Common Issues</span></span>
<span data-ttu-id="fc0d6-127">Tady uvádíme běžné scénáře přidělení, které způsobí požadavek přidělení připojit do jednoho clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-127">Here are the common allocation scenarios that cause an allocation request to be pinned to a single cluster.</span></span>

* <span data-ttu-id="fc0d6-128">Nasazení do pracovní pozici – cloudové služby má v buď slotu nasazení, pak celý Cloudová služba je připnutá k konkrétní clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-128">Deploying to Staging Slot - If a cloud service has a deployment in either slot, then the entire cloud service is pinned to a specific cluster.</span></span>  <span data-ttu-id="fc0d6-129">To znamená, že pokud nasazení již existuje v produkčním slotu, pak nové pracovní nasazení lze pouze rozdělit ve stejném clusteru jako produkční slot.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-129">This means that if a deployment already exists in the production slot, then a new staging deployment can only be allocated in the same cluster as the production slot.</span></span> <span data-ttu-id="fc0d6-130">Pokud cluster se blíží obsazení, požadavek se pravděpodobně nezdaří.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-130">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fc0d6-131">Škálování – přidání nové instance do stávající cloudovou službu, musíte přidělit ve stejném clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-131">Scaling - Adding new instances to an existing cloud service must allocate in the same cluster.</span></span>  <span data-ttu-id="fc0d6-132">Malého škálování požadavků lze obvykle rozdělit, ale ne vždy.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-132">Small scaling requests can usually be allocated, but not always.</span></span> <span data-ttu-id="fc0d6-133">Pokud cluster se blíží obsazení, požadavek se pravděpodobně nezdaří.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-133">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fc0d6-134">Skupina vztahů - nového nasazení do prázdné cloudové služby lze rozdělit podle prostředků infrastruktury v jakémkoliv clusteru v této oblasti, pokud cloudové služby je připojena do skupiny vztahů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-134">Affinity Group - A new deployment to an empty cloud service can be allocated by the fabric in any cluster in that region, unless the cloud service is pinned to an affinity group.</span></span> <span data-ttu-id="fc0d6-135">Ve stejném clusteru se pokusí nasazení pro stejnou skupinu vztahů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-135">Deployments to the same affinity group will be attempted on the same cluster.</span></span> <span data-ttu-id="fc0d6-136">Pokud cluster se blíží obsazení, požadavek se pravděpodobně nezdaří.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-136">If the cluster is nearing capacity, the request may fail.</span></span>
* <span data-ttu-id="fc0d6-137">Skupiny vztahů vNet - starší virtuální sítě bylo vázané na skupiny vztahů místo oblasti a cloudové služby v tyto virtuální sítě by připnutý do skupiny vztahů clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-137">Affinity Group vNet - Older Virtual Networks were tied to affinity groups instead of regions, and cloud services in these Virtual Networks would be pinned to the affinity group cluster.</span></span> <span data-ttu-id="fc0d6-138">Nasazení pro tento typ virtuální sítě se pokusí na definovaného clusteru.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-138">Deployments to this type of virtual network will be attempted on the pinned cluster.</span></span> <span data-ttu-id="fc0d6-139">Pokud cluster se blíží obsazení, požadavek se pravděpodobně nezdaří.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-139">If the cluster is nearing capacity, the request may fail.</span></span>

## <a name="solutions"></a><span data-ttu-id="fc0d6-140">Řešení</span><span class="sxs-lookup"><span data-stu-id="fc0d6-140">Solutions</span></span>
1. <span data-ttu-id="fc0d6-141">Na novou cloudovou službu znovu nasaďte – toto řešení je pravděpodobně být nejvíce úspěšné, protože umožňuje platformy můžete vybrat ze všech clusterů v této oblasti.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-141">Redeploy to a new cloud service - This solution is likely to be most successful as it allows the platform to choose from all clusters in that region.</span></span>

   * <span data-ttu-id="fc0d6-142">Nasazení zatížení na novou cloudovou službu</span><span class="sxs-lookup"><span data-stu-id="fc0d6-142">Deploy the workload to a new cloud service</span></span>  
   * <span data-ttu-id="fc0d6-143">Aktualizujte CNAME nebo záznam směrovaly přenášená data do nové cloudové služby</span><span class="sxs-lookup"><span data-stu-id="fc0d6-143">Update the CNAME or A record to point traffic to the new cloud service</span></span>
   * <span data-ttu-id="fc0d6-144">Jakmile nulové provoz prochází k původní lokalitě, můžete odstranit staré cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-144">Once zero traffic is going to the old site, you can delete the old cloud service.</span></span> <span data-ttu-id="fc0d6-145">Toto řešení měly ukládat nepřeruší.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-145">This solution should incur zero downtime.</span></span>
2. <span data-ttu-id="fc0d6-146">Odstranit produkční a pracovní sloty – toto řešení se zachovat svůj existující název DNS, ale může způsobit výpadek do vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-146">Delete both production and staging slots - This solution will preserve your existing DNS name, but will cause downtime to your application.</span></span>

   * <span data-ttu-id="fc0d6-147">Odstranit produkční a pracovní sloty stávající cloudovou službu, aby Cloudová služba je prázdná a potom</span><span class="sxs-lookup"><span data-stu-id="fc0d6-147">Delete the production and staging slots of an existing cloud service so that the cloud service is empty, and then</span></span>
   * <span data-ttu-id="fc0d6-148">Vytvořte nové nasazení v rámci existující cloudové služby.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-148">Create a new deployment in the existing cloud service.</span></span> <span data-ttu-id="fc0d6-149">To se znovu pokusí o přidělení na všech clusterech v oblasti.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-149">This will re-attempt to allocation on all clusters in the region.</span></span> <span data-ttu-id="fc0d6-150">Zkontrolujte, zda že cloudové služby není vázaný do skupiny vztahů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-150">Ensure the cloud service is not tied to an affinity group.</span></span>
3. <span data-ttu-id="fc0d6-151">Vyhrazená IP adresa – toto řešení se zachovat stávající IP adresy, ale může způsobit výpadek do vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-151">Reserved IP -  This solution will preserve your existing IP address, but will cause downtime to your application.</span></span>  

   * <span data-ttu-id="fc0d6-152">Vytvořit vyhrazenou IP adresu pro vaše stávající nasazení pomocí prostředí Powershell</span><span class="sxs-lookup"><span data-stu-id="fc0d6-152">Create a ReservedIP for your existing deployment using Powershell</span></span>

     ```
     New-AzureReservedIP -ReservedIPName {new reserved IP name} -Location {location} -ServiceName {existing service name}
     ```
   * <span data-ttu-id="fc0d6-153">Postupujte podle #2 výše, a ujistěte se, pokud chcete zadat novou vyhrazenou IP adresu do služby CSCFG.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-153">Follow #2 from above, making sure to specify the new ReservedIP in the service's CSCFG.</span></span>
4. <span data-ttu-id="fc0d6-154">Odeberte skupinu vztahů pro nová nasazení - už doporučují skupiny vztahů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-154">Remove affinity group for new deployments - Affinity Groups are no longer recommended.</span></span> <span data-ttu-id="fc0d6-155">Postupujte podle kroků pro #1 výše a nasadit novou cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-155">Follow steps for #1 above to deploy a new cloud service.</span></span> <span data-ttu-id="fc0d6-156">Ujistěte se, Cloudová služba není ve skupině vztahů.</span><span class="sxs-lookup"><span data-stu-id="fc0d6-156">Ensure cloud service is not in an affinity group.</span></span>
5. <span data-ttu-id="fc0d6-157">Převést na regionální virtuální síť – viz [jak migrovat z skupiny vztahů regionální virtuální síť (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span><span class="sxs-lookup"><span data-stu-id="fc0d6-157">Convert to a Regional Virtual Network - See [How to migrate from Affinity Groups to a Regional Virtual Network (VNet)](../virtual-network/virtual-networks-migrate-to-regional-vnet.md).</span></span>

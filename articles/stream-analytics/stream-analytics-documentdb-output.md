---
title: "výstup aaaJSON Stream Analytics | Microsoft Docs"
description: "Zjistěte, jak Stream Analytics můžete cílit na Azure Cosmos DB pro výstup JSON, archivace dat a nízkou latencí dotazy na nestrukturovaných dat JSON."
keywords: "Výstup JSON"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: fa717818c839ecd7a60fcee33d22011990fd5878
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="6526e-104">Cíl Azure Cosmos DB pro výstup JSON ze služby Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6526e-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="6526e-105">Stream Analytics můžete cílit na [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) pro výstup JSON, povolení archivace a nízkou latencí dotazy dat na nestrukturovaných dat JSON.</span><span class="sxs-lookup"><span data-stu-id="6526e-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="6526e-106">Tento dokument popisuje některé osvědčené postupy při implementaci této konfigurace.</span><span class="sxs-lookup"><span data-stu-id="6526e-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="6526e-107">Pro ty, kteří jsou obeznámeni s Cosmos DB, podívejte se na [studijní postup Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget spuštěna.</span><span class="sxs-lookup"><span data-stu-id="6526e-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) tooget started.</span></span> 

<span data-ttu-id="6526e-108">Poznámka: Rozhraní API DB Mongo na základě Cosmos DB kolekce není aktuálně podporována.</span><span class="sxs-lookup"><span data-stu-id="6526e-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="6526e-109">Základní informace o DB Cosmos jako cíl výstupu</span><span class="sxs-lookup"><span data-stu-id="6526e-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="6526e-110">Hello Azure Cosmos DB výstupu v Stream Analytics, který umožňuje zapisovat zpracování výsledků jako výstup JSON do vaší kolekcí Cosmos DB datového proudu.</span><span class="sxs-lookup"><span data-stu-id="6526e-110">hello Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="6526e-111">Stream Analytics nevytvoří kolekcí do databáze, místo toho byste museli toocreate je předem.</span><span class="sxs-lookup"><span data-stu-id="6526e-111">Stream Analytics does not create collections in your database, instead requiring you toocreate them upfront.</span></span> <span data-ttu-id="6526e-112">Toto je, aby byly transparentní tooyou hello fakturace náklady Cosmos DB kolekcí, a tak, aby mohli vyladit výkon hello, konzistence a kapacitu vaší kolekce přímo pomocí hello [rozhraní API DB Cosmos](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="6526e-112">This is so that hello billing costs of Cosmos DB collections are transparent tooyou, and so that you can tune hello performance, consistency and capacity of your collections directly using hello [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="6526e-113">Doporučujeme používat jednu databázi DB Cosmos za streamování úlohy toologically samostatné kolekce pro úlohu streamování.</span><span class="sxs-lookup"><span data-stu-id="6526e-113">We recommend using one Cosmos DB Database per streaming job toologically separate your collections for a streaming job.</span></span>

<span data-ttu-id="6526e-114">Některé možnosti kolekce Cosmos DB hello jsou podrobně popsány níže.</span><span class="sxs-lookup"><span data-stu-id="6526e-114">Some of hello Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="6526e-115">Vyladění konzistence, dostupností a latencí</span><span class="sxs-lookup"><span data-stu-id="6526e-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="6526e-116">toomatch vaše požadavky aplikací Cosmos DB vám umožní toofine tune hello databáze a kolekce a zkontrolujte kompromis mezi konzistencí, dostupností a latencí.</span><span class="sxs-lookup"><span data-stu-id="6526e-116">toomatch your application requirements, Cosmos DB allows you toofine tune hello database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="6526e-117">V závislosti na tom, jaké úrovně konzistenci čtení potřeb scénář proti čtení a zápisu latence, že můžete úroveň konzistence na vašem účtu databáze.</span><span class="sxs-lookup"><span data-stu-id="6526e-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="6526e-118">Také ve výchozím nastavení, Cosmos DB umožňuje synchronní indexování na každou kolekci tooyour operace CRUD.</span><span class="sxs-lookup"><span data-stu-id="6526e-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation tooyour collection.</span></span> <span data-ttu-id="6526e-119">To je další užitečné možnost toocontrol hello zápisu nebo čtení výkonu do databáze. Cosmos.</span><span class="sxs-lookup"><span data-stu-id="6526e-119">This is another useful option toocontrol hello write/read performance in Cosmos DB.</span></span> <span data-ttu-id="6526e-120">Další informace v tomto tématu najdete v tématu hello [změnit vaší databáze a dotaz úrovně konzistence](../documentdb/documentdb-consistency-levels.md) článku.</span><span class="sxs-lookup"><span data-stu-id="6526e-120">For further information on this topic, review hello [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="6526e-121">Upserts ze služby Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="6526e-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="6526e-122">Stream Analytics integrace s Cosmos DB umožňuje tooinsert nebo aktualizace záznamů v kolekci Cosmos DB na základě daného sloupce ID dokumentu.</span><span class="sxs-lookup"><span data-stu-id="6526e-122">Stream Analytics integration with Cosmos DB allows you tooinsert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="6526e-123">Toto je také odkazované tooas *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="6526e-123">This is also referred tooas an *Upsert*.</span></span>

<span data-ttu-id="6526e-124">Stream Analytics využívá optimistické Upsert přístup, kde aktualizace jsou pouze provádět při vložení nezdaří z důvodu konfliktu tooa ID dokumentu.</span><span class="sxs-lookup"><span data-stu-id="6526e-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due tooa Document ID conflict.</span></span> <span data-ttu-id="6526e-125">Tato aktualizace je prováděno pomocí Stream Analytics jako opravy, takže umožňuje částečné aktualizace toohello dokumentu, tj. přidání nových vlastností nebo nahrazení stávající vlastnosti se provádí postupně.</span><span class="sxs-lookup"><span data-stu-id="6526e-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates toohello document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="6526e-126">Všimněte si, že změny v hello hodnoty vlastností pole v dokumentu JSON za následek hello celé pole získávání přepsat tj není pole hello sloučit.</span><span class="sxs-lookup"><span data-stu-id="6526e-126">Note that changes in hello values of array properties in your JSON document result in hello entire array getting overwritten, i.e. hello array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="6526e-127">Vytvoření oddílů dat v databázi systému Cosmos</span><span class="sxs-lookup"><span data-stu-id="6526e-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="6526e-128">Cosmos DB [oddíly kolekce](../cosmos-db/partition-data.md) jsou hello doporučenému přístupu pro dělení vaše data.</span><span class="sxs-lookup"><span data-stu-id="6526e-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are hello recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="6526e-129">Pro jeden Cosmos DB kolekce Stream Analytics stále můžete toopartition data podle schémat dotazů hello a požadavkům na výkon vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="6526e-129">For single Cosmos DB collections, Stream Analytics still allows you toopartition your data based on both hello query patterns and performance needs of your application.</span></span> <span data-ttu-id="6526e-130">Každá kolekce může obsahovat až too10GB dat (maximum) a aktuálně neexistuje žádný způsob, jak tooscale nahoru (nebo přetečení) kolekce.</span><span class="sxs-lookup"><span data-stu-id="6526e-130">Each collection may contain up too10GB of data (maximum) and currently there is no way tooscale up (or overflow) a collection.</span></span> <span data-ttu-id="6526e-131">Pro škálování, Stream Analytics můžete toowrite toomultiple kolekce s danou předponu (viz níže podrobnosti o použití).</span><span class="sxs-lookup"><span data-stu-id="6526e-131">For scaling out, Stream Analytics allows you toowrite toomultiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="6526e-132">Stream Analytics používá hello konzistentní [Hash oddílu překladač](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategie na základě uživatele hello zadaný sloupec toopartition PartitionKey svoje záznamy o výstup.</span><span class="sxs-lookup"><span data-stu-id="6526e-132">Stream Analytics uses hello consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on hello user provided PartitionKey column toopartition its output records.</span></span> <span data-ttu-id="6526e-133">Hello počet kolekcí s hello zadané předpony v hello streamování čas spuštění úlohy se používá jako počet oddílů výstup hello, zapíše tooin paralelní úlohy hello toowhich (Cosmos DB kolekce = výstup oddíly).</span><span class="sxs-lookup"><span data-stu-id="6526e-133">hello number of collections with hello given prefix at hello streaming job’s start time is used as hello output partition count, toowhich hello job writes tooin parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="6526e-134">Pro jednu kolekci s Opožděné indexování to jenom vložení, o 0.4 MB/s zápisu propustnost je možné očekávat.</span><span class="sxs-lookup"><span data-stu-id="6526e-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="6526e-135">Použití více kolekcí můžete povolit, můžete tooachieve vyšší propustnost a zvýšené kapacity.</span><span class="sxs-lookup"><span data-stu-id="6526e-135">Using multiple collections can allow you tooachieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="6526e-136">Pokud máte v úmyslu počet oddílů hello tooincrease v hello budoucí, musíte toostop úlohy změny rozdělení hello dat z existující kolekce do nové kolekce a potom úlohy služby Stream Analytics hello restartování.</span><span class="sxs-lookup"><span data-stu-id="6526e-136">If you intend tooincrease hello partition count in hello future, you may need toostop your job, repartition hello data from your existing collections into new collections and then restart hello Stream Analytics job.</span></span> <span data-ttu-id="6526e-137">Další podrobnosti o používání PartitionResolver a opětovné vytváření oddílů společně s ukázkový kód, bude součástí následné post.</span><span class="sxs-lookup"><span data-stu-id="6526e-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="6526e-138">článek Hello [dělení a škálování v Cosmos DB](../documentdb/documentdb-partition-data.md) také podrobné informace o to.</span><span class="sxs-lookup"><span data-stu-id="6526e-138">hello article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="6526e-139">Nastavení cosmos DB pro výstup JSON</span><span class="sxs-lookup"><span data-stu-id="6526e-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="6526e-140">Vytváření Cosmos DB jako výstupu v Stream Analytics generuje řádku informace, jak vidíte níže.</span><span class="sxs-lookup"><span data-stu-id="6526e-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="6526e-141">Tato část obsahuje vysvětlení hello vlastnosti definice.</span><span class="sxs-lookup"><span data-stu-id="6526e-141">This section provides an explanation of hello properties definition.</span></span>

<span data-ttu-id="6526e-142">Dělené kolekce</span><span class="sxs-lookup"><span data-stu-id="6526e-142">Partitioned Collection</span></span> | <span data-ttu-id="6526e-143">Více kolekcí "Jednoho oddílu"</span><span class="sxs-lookup"><span data-stu-id="6526e-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb stream analytics výstup obrazovky](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb stream analytics výstup obrazovky](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="6526e-146">Hello **více kolekcí "Jednoho oddílu"** scénář vyžaduje klíč oddílu a konfigurace je podporována.</span><span class="sxs-lookup"><span data-stu-id="6526e-146">hello **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="6526e-147">**Výstup Alias** – alias toorefer tento výstup v dotazu ASA</span><span class="sxs-lookup"><span data-stu-id="6526e-147">**Output Alias** – An alias toorefer this output in your ASA query</span></span>  
* <span data-ttu-id="6526e-148">**Název účtu** – hello název nebo identifikátor URI hello Cosmos DB účet koncový bod.</span><span class="sxs-lookup"><span data-stu-id="6526e-148">**Account Name** – hello name or endpoint URI of hello Cosmos DB account.</span></span>  
* <span data-ttu-id="6526e-149">**Účet klíč** – hello sdílený přístupový klíč pro hello účet Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6526e-149">**Account Key** – hello shared access key for hello Cosmos DB account.</span></span>  
* <span data-ttu-id="6526e-150">**Databáze** – název databáze hello Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="6526e-150">**Database** – hello Cosmos DB database name.</span></span>  
* <span data-ttu-id="6526e-151">**Vzor názvu** – název kolekce hello nebo jejich vzor toobe kolekce hello používá.</span><span class="sxs-lookup"><span data-stu-id="6526e-151">**Collection Name Pattern** – hello collection name or their pattern for hello collections toobe used.</span></span> <span data-ttu-id="6526e-152">Formát názvu kolekce Hello lze sestavit pomocí tokenu hello volitelné {partition}, na kterém oddíly začínají od 0.</span><span class="sxs-lookup"><span data-stu-id="6526e-152">hello collection name format can be constructed using hello optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="6526e-153">Ukázka platné vstupní hodnoty jsou následující:</span><span class="sxs-lookup"><span data-stu-id="6526e-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="6526e-154">1\) kolekce – jednu kolekci s názvem "Kolekce" musí existovat.</span><span class="sxs-lookup"><span data-stu-id="6526e-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="6526e-155">2\) kolekce {partition} – takových kolekcí, musí existovat – "MyCollection0", "MyCollection1", "MyCollection2" a tak dále.</span><span class="sxs-lookup"><span data-stu-id="6526e-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="6526e-156">**Klíč oddílu** – volitelné.</span><span class="sxs-lookup"><span data-stu-id="6526e-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="6526e-157">To je potřeba jenom Pokud používáte token {vytvoření oddílu} ve vzoru názvu vaší kolekce.</span><span class="sxs-lookup"><span data-stu-id="6526e-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="6526e-158">Název Hello hello pole ve výstupních událostech používaný toospecify hello klíče pro rozdělení výstupu do kolekcí.</span><span class="sxs-lookup"><span data-stu-id="6526e-158">hello name of hello field in output events used toospecify hello key for partitioning output across collections.</span></span> <span data-ttu-id="6526e-159">Pro výstup jedinou kolekci všechny libovolný výstupního sloupce lze použít například ID oddílu.</span><span class="sxs-lookup"><span data-stu-id="6526e-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="6526e-160">**ID dokumentu** – volitelné.</span><span class="sxs-lookup"><span data-stu-id="6526e-160">**Document ID** – Optional.</span></span> <span data-ttu-id="6526e-161">Název Hello hello pole ve výstupních událostech používá toospecify hello primární klíč, na které insert nebo update jsou založené operace.</span><span class="sxs-lookup"><span data-stu-id="6526e-161">hello name of hello field in output events used toospecify hello primary key on which insert or update operations are based.</span></span>  

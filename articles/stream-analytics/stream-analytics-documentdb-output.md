---
title: "Výstup JSON pro Stream Analytics | Microsoft Docs"
description: "Zjistěte, jak Stream Analytics můžete cílit na Azure Cosmos DB pro výstup JSON, archivace dat a nízkou latencí dotazy na nestrukturovaných dat JSON."
keywords: "Výstup JSON"
documentationcenter: 
services: stream-analytics,documentdb
author: samacha
manager: jhubbard
editor: cgronlun
ms.assetid: 5d2a61a6-0dbf-4f1b-80af-60a80eb25dd1
ms.service: stream-analytics
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: data-services
ms.date: 03/28/2017
ms.author: samacha
ms.openlocfilehash: cc80b0080c806541362a1ef2d71b95862bd51ca2
ms.sourcegitcommit: 18ad9bc049589c8e44ed277f8f43dcaa483f3339
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/29/2017
---
# <a name="target-azure-cosmos-db-for-json-output-from-stream-analytics"></a><span data-ttu-id="21f8d-104">Cíl Azure Cosmos DB pro výstup JSON ze služby Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="21f8d-104">Target Azure Cosmos DB for JSON output from Stream Analytics</span></span>
<span data-ttu-id="21f8d-105">Stream Analytics můžete cílit na [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) pro výstup JSON, povolení archivace a nízkou latencí dotazy dat na nestrukturovaných dat JSON.</span><span class="sxs-lookup"><span data-stu-id="21f8d-105">Stream Analytics can target [Azure Cosmos DB](https://azure.microsoft.com/services/documentdb/) for JSON output, enabling data archiving and low-latency queries on unstructured JSON data.</span></span> <span data-ttu-id="21f8d-106">Tento dokument popisuje některé osvědčené postupy při implementaci této konfigurace.</span><span class="sxs-lookup"><span data-stu-id="21f8d-106">This document covers some best practices for implementing this configuration.</span></span>

<span data-ttu-id="21f8d-107">Pro ty, kteří jsou obeznámeni s Cosmos DB, podívejte se na [studijní postup Azure Cosmos DB](https://azure.microsoft.com/documentation/learning-paths/documentdb/) začít pracovat.</span><span class="sxs-lookup"><span data-stu-id="21f8d-107">For those who are unfamiliar with Cosmos DB, take a look at [Azure Cosmos DB’s learning path](https://azure.microsoft.com/documentation/learning-paths/documentdb/) to get started.</span></span> 

<span data-ttu-id="21f8d-108">Poznámka: Rozhraní API DB Mongo na základě Cosmos DB kolekce není aktuálně podporována.</span><span class="sxs-lookup"><span data-stu-id="21f8d-108">Note: Mongo DB API based Cosmos DB collections is currently not supported.</span></span> 

## <a name="basics-of-cosmos-db-as-an-output-target"></a><span data-ttu-id="21f8d-109">Základní informace o DB Cosmos jako cíl výstupu</span><span class="sxs-lookup"><span data-stu-id="21f8d-109">Basics of Cosmos DB as an output target</span></span>
<span data-ttu-id="21f8d-110">Výstup Azure Cosmos DB v Stream Analytics, který umožňuje zapisovat zpracování výsledků jako výstup JSON do vaší kolekcí Cosmos DB datového proudu.</span><span class="sxs-lookup"><span data-stu-id="21f8d-110">The Azure Cosmos DB output in Stream Analytics enables writing your stream processing results as JSON output into your Cosmos DB collection(s).</span></span> <span data-ttu-id="21f8d-111">Stream Analytics nevytváří kolekcí do databáze, místo toho by bylo potřeba vytvořit předem.</span><span class="sxs-lookup"><span data-stu-id="21f8d-111">Stream Analytics does not create collections in your database, instead requiring you to create them upfront.</span></span> <span data-ttu-id="21f8d-112">Toto je tak, aby fakturace nákladů na Cosmos DB kolekce jsou transparentní pro vás, a tak, aby mohli vyladit výkon, konzistence a kapacitu vaší kolekce přímo pomocí [rozhraní API DB Cosmos](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span><span class="sxs-lookup"><span data-stu-id="21f8d-112">This is so that the billing costs of Cosmos DB collections are transparent to you, and so that you can tune the performance, consistency and capacity of your collections directly using the [Cosmos DB APIs](https://msdn.microsoft.com/library/azure/dn781481.aspx).</span></span> <span data-ttu-id="21f8d-113">Doporučujeme používat jednu databázi na DB Cosmos jednu úlohu streamování logicky jednotlivé kolekce pro úlohu streamování.</span><span class="sxs-lookup"><span data-stu-id="21f8d-113">We recommend using one Cosmos DB Database per streaming job to logically separate your collections for a streaming job.</span></span>

<span data-ttu-id="21f8d-114">Některé možnosti Cosmos DB kolekce jsou podrobně popsány níže.</span><span class="sxs-lookup"><span data-stu-id="21f8d-114">Some of the Cosmos DB collection options are detailed below.</span></span>

## <a name="tune-consistency-availability-and-latency"></a><span data-ttu-id="21f8d-115">Vyladění konzistence, dostupností a latencí</span><span class="sxs-lookup"><span data-stu-id="21f8d-115">Tune consistency, availability, and latency</span></span>
<span data-ttu-id="21f8d-116">Tak, aby odpovídaly vaše požadavky aplikací, umožňuje Cosmos DB správně vyladit databáze a kolekce a ujistěte se, kompromis mezi konzistencí, dostupností a latencí.</span><span class="sxs-lookup"><span data-stu-id="21f8d-116">To match your application requirements, Cosmos DB allows you to fine tune the database and collections and make trade-offs between consistency, availability and latency.</span></span> <span data-ttu-id="21f8d-117">V závislosti na tom, jaké úrovně konzistenci čtení potřeb scénář proti čtení a zápisu latence, že můžete úroveň konzistence na vašem účtu databáze.</span><span class="sxs-lookup"><span data-stu-id="21f8d-117">Depending on what levels of read consistency your scenario needs against read and write latency, you can choose a consistency level on your database account.</span></span> <span data-ttu-id="21f8d-118">Také ve výchozím nastavení, Cosmos DB umožňuje synchronní indexování na každé operace CRUD do vaší kolekce.</span><span class="sxs-lookup"><span data-stu-id="21f8d-118">Also by default, Cosmos DB enables synchronous indexing on each CRUD operation to your collection.</span></span> <span data-ttu-id="21f8d-119">Toto je další možností užitečné k řízení výkonu zápisu nebo čtení v Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="21f8d-119">This is another useful option to control the write/read performance in Cosmos DB.</span></span> <span data-ttu-id="21f8d-120">Další informace v tomto tématu najdete v článku [změnit vaší databáze a dotaz úrovně konzistence](../documentdb/documentdb-consistency-levels.md) článku.</span><span class="sxs-lookup"><span data-stu-id="21f8d-120">For further information on this topic, review the [change your database and query consistency levels](../documentdb/documentdb-consistency-levels.md) article.</span></span>

## <a name="upserts-from-stream-analytics"></a><span data-ttu-id="21f8d-121">Upserts ze služby Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="21f8d-121">Upserts from Stream Analytics</span></span>
<span data-ttu-id="21f8d-122">Stream Analytics integrace s Cosmos DB umožňuje vložit nebo aktualizovat záznamy v Cosmos DB kolekce na základě daného sloupce ID dokumentu.</span><span class="sxs-lookup"><span data-stu-id="21f8d-122">Stream Analytics integration with Cosmos DB allows you to insert or update records in your Cosmos DB collection based on a given Document ID column.</span></span> <span data-ttu-id="21f8d-123">Tím se také označuje jako *Upsert*.</span><span class="sxs-lookup"><span data-stu-id="21f8d-123">This is also referred to as an *Upsert*.</span></span>

<span data-ttu-id="21f8d-124">Stream Analytics využívá optimistické Upsert přístup, kde aktualizace jsou pouze provádět při vložení nezdaří z důvodu konfliktu ID dokumentu.</span><span class="sxs-lookup"><span data-stu-id="21f8d-124">Stream Analytics utilizes an optimistic Upsert approach, where updates are only done when insert fails due to a Document ID conflict.</span></span> <span data-ttu-id="21f8d-125">Tato aktualizace je prováděno pomocí Stream Analytics jako opravy, takže umožňuje částečné aktualizace v dokumentu, tj. přidání nových vlastností nebo nahrazení stávající vlastnosti se provádí postupně.</span><span class="sxs-lookup"><span data-stu-id="21f8d-125">This update is performed by Stream Analytics as a PATCH, so it enables partial updates to the document, i.e. addition of new properties or replacing an existing property is performed incrementally.</span></span> <span data-ttu-id="21f8d-126">Všimněte si, že není sloučit změny v hodnotách vlastnosti pole ve vaší výsledku dokumentu JSON v poli celý, získávání přepsat, tj. pole.</span><span class="sxs-lookup"><span data-stu-id="21f8d-126">Note that changes in the values of array properties in your JSON document result in the entire array getting overwritten, i.e. the array is not merged.</span></span>

## <a name="data-partitioning-in-cosmos-db"></a><span data-ttu-id="21f8d-127">Vytvoření oddílů dat v databázi systému Cosmos</span><span class="sxs-lookup"><span data-stu-id="21f8d-127">Data partitioning in Cosmos DB</span></span>
<span data-ttu-id="21f8d-128">Cosmos DB [oddíly kolekce](../cosmos-db/partition-data.md) se o doporučený postup pro vytváření oddílů vaše data.</span><span class="sxs-lookup"><span data-stu-id="21f8d-128">Cosmos DB [partitioned collections](../cosmos-db/partition-data.md) are the recommended approach for partitioning your data.</span></span> 

<span data-ttu-id="21f8d-129">Pro jeden Cosmos DB kolekce Stream Analytics stále umožňuje oddílu vaše data, podle schémat dotazů a požadavkům na výkon vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="21f8d-129">For single Cosmos DB collections, Stream Analytics still allows you to partition your data based on both the query patterns and performance needs of your application.</span></span> <span data-ttu-id="21f8d-130">Každá kolekce může obsahovat až 10GB dat (maximum) a aktuálně neexistuje žádný způsob, jak vertikálně navýšit kapacitu (nebo přetečení) kolekce.</span><span class="sxs-lookup"><span data-stu-id="21f8d-130">Each collection may contain up to 10GB of data (maximum) and currently there is no way to scale up (or overflow) a collection.</span></span> <span data-ttu-id="21f8d-131">Pro škálování, Stream Analytics můžete zapsat do více kolekcí s danou předponu (viz níže podrobnosti o použití).</span><span class="sxs-lookup"><span data-stu-id="21f8d-131">For scaling out, Stream Analytics allows you to write to multiple collections with a given prefix (see usage details below).</span></span> <span data-ttu-id="21f8d-132">Stream Analytics používá konzistentní [Hash oddílu překladač](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategie na základě uživatele zadaný sloupec PartitionKey oddílu svoje záznamy o výstup.</span><span class="sxs-lookup"><span data-stu-id="21f8d-132">Stream Analytics uses the consistent [Hash Partition Resolver](https://msdn.microsoft.com/library/azure/microsoft.azure.documents.partitioning.hashpartitionresolver.aspx) strategy based on the user provided PartitionKey column to partition its output records.</span></span> <span data-ttu-id="21f8d-133">Počet kolekcí s danou předponu při spuštění úlohu streamování slouží jako počet oddílů výstup, ke kterému se úloha zapíše do paralelně (Cosmos DB kolekce = výstup oddíly).</span><span class="sxs-lookup"><span data-stu-id="21f8d-133">The number of collections with the given prefix at the streaming job’s start time is used as the output partition count, to which the job writes to in parallel (Cosmos DB Collections = Output Partitions).</span></span> <span data-ttu-id="21f8d-134">Pro jednu kolekci s Opožděné indexování to jenom vložení, o 0.4 MB/s zápisu propustnost je možné očekávat.</span><span class="sxs-lookup"><span data-stu-id="21f8d-134">For a single collection with lazy indexing doing only inserts, about 0.4 MB/s write throughput can be expected.</span></span> <span data-ttu-id="21f8d-135">Použití více kolekcí můžete povolit dosáhnout vyšší propustnost a zvýšené kapacity.</span><span class="sxs-lookup"><span data-stu-id="21f8d-135">Using multiple collections can allow you to achieve higher throughput and increased capacity.</span></span>

<span data-ttu-id="21f8d-136">Pokud chcete zvýšit počet oddílů v budoucnosti, musíte zastavit úlohu, změnit rozdělení dat z existující kolekce do nové kolekce a potom restartujte úlohu služby Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="21f8d-136">If you intend to increase the partition count in the future, you may need to stop your job, repartition the data from your existing collections into new collections and then restart the Stream Analytics job.</span></span> <span data-ttu-id="21f8d-137">Další podrobnosti o používání PartitionResolver a opětovné vytváření oddílů společně s ukázkový kód, bude součástí následné post.</span><span class="sxs-lookup"><span data-stu-id="21f8d-137">More details on using PartitionResolver and re-partitioning along with sample code, will be included in a follow-up post.</span></span> <span data-ttu-id="21f8d-138">Článek [dělení a škálování v Cosmos DB](../documentdb/documentdb-partition-data.md) také podrobné informace o to.</span><span class="sxs-lookup"><span data-stu-id="21f8d-138">The article [Partitioning and scaling in Cosmos DB](../documentdb/documentdb-partition-data.md) also provides details on this.</span></span>

## <a name="cosmos-db-settings-for-json-output"></a><span data-ttu-id="21f8d-139">Nastavení cosmos DB pro výstup JSON</span><span class="sxs-lookup"><span data-stu-id="21f8d-139">Cosmos DB settings for JSON output</span></span>
<span data-ttu-id="21f8d-140">Vytváření Cosmos DB jako výstupu v Stream Analytics generuje řádku informace, jak vidíte níže.</span><span class="sxs-lookup"><span data-stu-id="21f8d-140">Creating Cosmos DB as an output in Stream Analytics generates a prompt for information as seen below.</span></span> <span data-ttu-id="21f8d-141">Tato část obsahuje vysvětlení definici vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="21f8d-141">This section provides an explanation of the properties definition.</span></span>

<span data-ttu-id="21f8d-142">Dělené kolekce</span><span class="sxs-lookup"><span data-stu-id="21f8d-142">Partitioned Collection</span></span> | <span data-ttu-id="21f8d-143">Více kolekcí "Jednoho oddílu"</span><span class="sxs-lookup"><span data-stu-id="21f8d-143">Multiple “Single Partition” collections</span></span>
---|---
![documentdb stream analytics výstup obrazovky](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-1.png) |  ![documentdb stream analytics výstup obrazovky](media/stream-analytics-documentdb-output/stream-analytics-documentdb-output-2.png)


  
> [!NOTE]
> <span data-ttu-id="21f8d-146">**Více kolekcí "Jednoho oddílu"** scénář vyžaduje klíč oddílu a konfigurace je podporována.</span><span class="sxs-lookup"><span data-stu-id="21f8d-146">The **Multiple “Single Partition” collections** scenario requires a partition key and is a supported configuration.</span></span> 

* <span data-ttu-id="21f8d-147">**Výstup Alias** – na alias odkazovat tento výstup v dotazu ASA</span><span class="sxs-lookup"><span data-stu-id="21f8d-147">**Output Alias** – An alias to refer this output in your ASA query</span></span>  
* <span data-ttu-id="21f8d-148">**Název účtu** – název nebo identifikátor URI účtu Cosmos DB koncového bodu.</span><span class="sxs-lookup"><span data-stu-id="21f8d-148">**Account Name** – The name or endpoint URI of the Cosmos DB account.</span></span>  
* <span data-ttu-id="21f8d-149">**Účet klíč** – sdílený přístupový klíč pro účet Cosmos DB.</span><span class="sxs-lookup"><span data-stu-id="21f8d-149">**Account Key** – The shared access key for the Cosmos DB account.</span></span>  
* <span data-ttu-id="21f8d-150">**Databáze** – název databáze DB Cosmos.</span><span class="sxs-lookup"><span data-stu-id="21f8d-150">**Database** – The Cosmos DB database name.</span></span>  
* <span data-ttu-id="21f8d-151">**Vzor názvu** – název kolekce nebo jejich vzor pro kolekce, který se má použít.</span><span class="sxs-lookup"><span data-stu-id="21f8d-151">**Collection Name Pattern** – The collection name or their pattern for the collections to be used.</span></span> <span data-ttu-id="21f8d-152">Formát názvu kolekce se dá vytvořit pomocí tokenu volitelná {partition}, na kterém oddíly začínají od 0.</span><span class="sxs-lookup"><span data-stu-id="21f8d-152">The collection name format can be constructed using the optional {partition} token, where partitions start from 0.</span></span> <span data-ttu-id="21f8d-153">Ukázka platné vstupní hodnoty jsou následující:</span><span class="sxs-lookup"><span data-stu-id="21f8d-153">Following are sample valid inputs:</span></span>  
  <span data-ttu-id="21f8d-154">1\) kolekce – jednu kolekci s názvem "Kolekce" musí existovat.</span><span class="sxs-lookup"><span data-stu-id="21f8d-154">1\) MyCollection – One collection named “MyCollection” must exist.</span></span>  
  <span data-ttu-id="21f8d-155">2\) kolekce {partition} – takových kolekcí, musí existovat – "MyCollection0", "MyCollection1", "MyCollection2" a tak dále.</span><span class="sxs-lookup"><span data-stu-id="21f8d-155">2\) MyCollection{partition} – Such collections must exist– "MyCollection0”, “MyCollection1”, “MyCollection2” and so on.</span></span>  
* <span data-ttu-id="21f8d-156">**Klíč oddílu** – volitelné.</span><span class="sxs-lookup"><span data-stu-id="21f8d-156">**Partition Key** – Optional.</span></span> <span data-ttu-id="21f8d-157">To je potřeba jenom Pokud používáte token {vytvoření oddílu} ve vzoru názvu vaší kolekce.</span><span class="sxs-lookup"><span data-stu-id="21f8d-157">This is only needed if you are using a {parition} token in your collection name pattern.</span></span> <span data-ttu-id="21f8d-158">Název pole ve výstupních událostech používaný k určení klíče pro rozdělení výstupu do kolekcí</span><span class="sxs-lookup"><span data-stu-id="21f8d-158">The name of the field in output events used to specify the key for partitioning output across collections.</span></span> <span data-ttu-id="21f8d-159">Pro výstup jedinou kolekci všechny libovolný výstupního sloupce lze použít například ID oddílu.</span><span class="sxs-lookup"><span data-stu-id="21f8d-159">For single collection output, any arbitrary output column can be used e.g. PartitionId.</span></span>  
* <span data-ttu-id="21f8d-160">**ID dokumentu** – volitelné.</span><span class="sxs-lookup"><span data-stu-id="21f8d-160">**Document ID** – Optional.</span></span> <span data-ttu-id="21f8d-161">Název pole ve výstupních událostech používaný k určení primárního klíče, na které insert nebo update jsou založené operace.</span><span class="sxs-lookup"><span data-stu-id="21f8d-161">The name of the field in output events used to specify the primary key on which insert or update operations are based.</span></span>  

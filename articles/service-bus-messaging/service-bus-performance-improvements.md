---
title: "Osvědčené postupy pro zlepšení výkonu pomocí Azure Service Bus | Microsoft Docs"
description: "Popisuje postup použití služby Service Bus k optimalizaci výkonu při výměně zprostředkované zprávy."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: e756c15d-31fc-45c0-8df4-0bca0da10bb2
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 05/10/2017
ms.author: sethm
ms.openlocfilehash: e6a0e480f7748f12f5e566cf4059b5b2c4242c09
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-performance-improvements-using-service-bus-messaging"></a><span data-ttu-id="bccf6-103">Osvědčené postupy pro zlepšení výkonu pomocí zasílání zpráv Service Bus</span><span class="sxs-lookup"><span data-stu-id="bccf6-103">Best Practices for performance improvements using Service Bus Messaging</span></span>

<span data-ttu-id="bccf6-104">Tento článek popisuje způsob použití [zasílání zpráv Azure Service Bus](https://azure.microsoft.com/services/service-bus/) za účelem optimalizace výkonu při výměně zprostředkované zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-104">This article describes how to use [Azure Service Bus messaging](https://azure.microsoft.com/services/service-bus/) to optimize performance when exchanging brokered messages.</span></span> <span data-ttu-id="bccf6-105">První část Toto téma popisuje různé mechanismy, které nabízí za účelem zvýšení výkonu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-105">The first part of this topic describes the different mechanisms that are offered to help increase performance.</span></span> <span data-ttu-id="bccf6-106">Druhá část obsahuje pokyny k použití služby Service Bus tak, že můžete nabídnout nejlepší výkon v daném scénáři.</span><span class="sxs-lookup"><span data-stu-id="bccf6-106">The second part provides guidance on how to use Service Bus in a way that can offer the best performance in a given scenario.</span></span>

<span data-ttu-id="bccf6-107">V tomto tématu se pojem "client" představuje Každá entita, která přistupuje k Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-107">Throughout this topic, the term "client" refers to any entity that accesses Service Bus.</span></span> <span data-ttu-id="bccf6-108">Klient může trvat roli odesílatele nebo příjemce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-108">A client can take the role of a sender or a receiver.</span></span> <span data-ttu-id="bccf6-109">Termín "sender" se používá pro Service Bus fronta nebo téma klienta, který odesílá zprávy do fronty sběrnice nebo téma.</span><span class="sxs-lookup"><span data-stu-id="bccf6-109">The term "sender" is used for a Service Bus queue or topic client that sends messages to a Service Bus queue or topic.</span></span> <span data-ttu-id="bccf6-110">Termín "příjemce" odkazuje na Service Bus fronty nebo předplatného klienta, který přijímá zprávy z fronty Service Bus nebo předplatné.</span><span class="sxs-lookup"><span data-stu-id="bccf6-110">The term "receiver" refers to a Service Bus queue or subscription client that receives messages from a Service Bus queue or subscription.</span></span>

<span data-ttu-id="bccf6-111">Tyto části seznámí několik konceptů, které používá Service Bus, které pomáhají výkonu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-111">These sections introduce several concepts that Service Bus uses to help boost performance.</span></span>

## <a name="protocols"></a><span data-ttu-id="bccf6-112">Protokoly</span><span class="sxs-lookup"><span data-stu-id="bccf6-112">Protocols</span></span>
<span data-ttu-id="bccf6-113">Service Bus umožní klientům posílat a přijímat zprávy přes jeden ze tří protokolů:</span><span class="sxs-lookup"><span data-stu-id="bccf6-113">Service Bus enables clients to send and receive messages via one of three protocols:</span></span>

1. <span data-ttu-id="bccf6-114">Pokročilé zpráv služby Řízení front Protocol (AMQP)</span><span class="sxs-lookup"><span data-stu-id="bccf6-114">Advanced Message Queuing Protocol (AMQP)</span></span>
2. <span data-ttu-id="bccf6-115">Sběrnice zpráv protokolu (SBMP)</span><span class="sxs-lookup"><span data-stu-id="bccf6-115">Service Bus Messaging Protocol (SBMP)</span></span>
3. <span data-ttu-id="bccf6-116">HTTP</span><span class="sxs-lookup"><span data-stu-id="bccf6-116">HTTP</span></span>

<span data-ttu-id="bccf6-117">Protokoly AMQP a SBMP jsou efektivnější, protože udržují připojení k Service Bus, dokud existuje objekt pro vytváření zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-117">AMQP and SBMP are more efficient, because they maintain the connection to Service Bus as long as the messaging factory exists.</span></span> <span data-ttu-id="bccf6-118">Také implementuje dávkování a prefetching.</span><span class="sxs-lookup"><span data-stu-id="bccf6-118">It also implements batching and prefetching.</span></span> <span data-ttu-id="bccf6-119">Pokud není výslovně uvedeno, veškerý obsah v tomto tématu se předpokládá použití AMQP nebo SBMP.</span><span class="sxs-lookup"><span data-stu-id="bccf6-119">Unless explicitly mentioned, all content in this topic assumes the use of AMQP or SBMP.</span></span>

## <a name="reusing-factories-and-clients"></a><span data-ttu-id="bccf6-120">Opětovné použití objektů Factory a klientů</span><span class="sxs-lookup"><span data-stu-id="bccf6-120">Reusing factories and clients</span></span>
<span data-ttu-id="bccf6-121">Service Bus klient objekty, jako například [QueueClient] [ QueueClient] nebo [MessageSender][MessageSender], jsou vytvořeny pomocí [ MessagingFactory] [ MessagingFactory] objekt, který také poskytuje interní správu připojení.</span><span class="sxs-lookup"><span data-stu-id="bccf6-121">Service Bus client objects, such as [QueueClient][QueueClient] or [MessageSender][MessageSender], are created through a [MessagingFactory][MessagingFactory] object, which also provides internal management of connections.</span></span> <span data-ttu-id="bccf6-122">Zasílání zpráv objekty Factory nebo fronty, témata a předplatné klientů by neměl zavřít po odeslat zprávu a pak další zprávu odešlete znovu vytvořit.</span><span class="sxs-lookup"><span data-stu-id="bccf6-122">You should not close messaging factories or queue, topic, and subscription clients after you send a message, and then re-create them when you send the next message.</span></span> <span data-ttu-id="bccf6-123">Zavřením objekt zasílání zpráv odstraní připojení ke službě Service Bus a vytvoření nového připojení při opětovném vytváření objektu pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-123">Closing a messaging factory deletes the connection to the Service Bus service, and a new connection is established when recreating the factory.</span></span> <span data-ttu-id="bccf6-124">Navázání připojení je náročná operace, která znovu pomocí stejné objekt pro vytváření a objekty klienta pro více operací se můžete vyhnout.</span><span class="sxs-lookup"><span data-stu-id="bccf6-124">Establishing a connection is an expensive operation that you can avoid by re-using the same factory and client objects for multiple operations.</span></span> <span data-ttu-id="bccf6-125">Můžete bezpečně používat [QueueClient] [ QueueClient] objekt pro odesílání zpráv z více vláken a souběžných asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="bccf6-125">You can safely use the [QueueClient][QueueClient] object for sending messages from concurrent asynchronous operations and multiple threads.</span></span> 

## <a name="concurrent-operations"></a><span data-ttu-id="bccf6-126">Souběžných operací</span><span class="sxs-lookup"><span data-stu-id="bccf6-126">Concurrent operations</span></span>
<span data-ttu-id="bccf6-127">Provádění operace (odesílání, příjem, odstranit, apod) nějakou dobu trvá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-127">Performing an operation (send, receive, delete, etc.) takes some time.</span></span> <span data-ttu-id="bccf6-128">Tentokrát zahrnuje zpracování operace služby Service Bus kromě latence požadavku a odpovědi.</span><span class="sxs-lookup"><span data-stu-id="bccf6-128">This time includes the processing of the operation by the Service Bus service in addition to the latency of the request and the reply.</span></span> <span data-ttu-id="bccf6-129">Pokud chcete zvýšit počet operací za čas, musí současně provést operace.</span><span class="sxs-lookup"><span data-stu-id="bccf6-129">To increase the number of operations per time, operations must execute concurrently.</span></span> <span data-ttu-id="bccf6-130">Můžete provést několika různými způsoby:</span><span class="sxs-lookup"><span data-stu-id="bccf6-130">You can do this in several different ways:</span></span>

* <span data-ttu-id="bccf6-131">**Asynchronní operace**: klient plány operations provedením asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="bccf6-131">**Asynchronous operations**: the client schedules operations by performing asynchronous operations.</span></span> <span data-ttu-id="bccf6-132">Další požadavek je spuštěn před dokončením předchozí požadavek.</span><span class="sxs-lookup"><span data-stu-id="bccf6-132">The next request is started before the previous request is completed.</span></span> <span data-ttu-id="bccf6-133">Následuje příklad operace asynchronní odesílání:</span><span class="sxs-lookup"><span data-stu-id="bccf6-133">The following is an example of an asynchronous send operation:</span></span>
  
 ```csharp
  BrokeredMessage m1 = new BrokeredMessage(body);
  BrokeredMessage m2 = new BrokeredMessage(body);
  
  Task send1 = queueClient.SendAsync(m1).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #1");
    });
  Task send2 = queueClient.SendAsync(m2).ContinueWith((t) => 
    {
      Console.WriteLine("Sent message #2");
    });
  Task.WaitAll(send1, send2);
  Console.WriteLine("All messages sent");
  ```
  
  <span data-ttu-id="bccf6-134">Toto je příklad asynchronní příjem operace:</span><span class="sxs-lookup"><span data-stu-id="bccf6-134">This is an example of an asynchronous receive operation:</span></span>
  
  ```csharp
  Task receive1 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  Task receive2 = queueClient.ReceiveAsync().ContinueWith(ProcessReceivedMessage);
  
  Task.WaitAll(receive1, receive2);
  Console.WriteLine("All messages received");
  
  async void ProcessReceivedMessage(Task<BrokeredMessage> t)
  {
    BrokeredMessage m = t.Result;
    Console.WriteLine("{0} received", m.Label);
    await m.CompleteAsync();
    Console.WriteLine("{0} complete", m.Label);
  }
  ```
* <span data-ttu-id="bccf6-135">**Více objektů Factory**: Všichni klienti (odesílatelé kromě příjemců), které jsou vytvořené pomocí stejné objekt factory sdílet jedno připojení TCP.</span><span class="sxs-lookup"><span data-stu-id="bccf6-135">**Multiple factories**: all clients (senders in addition to receivers) that are created by the same factory share one TCP connection.</span></span> <span data-ttu-id="bccf6-136">Zpráva maximální propustnost je omezen počet operací, které můžete přejít přes toto připojení TCP.</span><span class="sxs-lookup"><span data-stu-id="bccf6-136">The maximum message throughput is limited by the number of operations that can go through this TCP connection.</span></span> <span data-ttu-id="bccf6-137">Propustnost, kterou lze získat pomocí jednoho factory se výrazně liší podle doby odezvy TCP a velikost zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-137">The throughput that can be obtained with a single factory varies greatly with TCP round-trip times and message size.</span></span> <span data-ttu-id="bccf6-138">Chcete-li dosáhnout vyšší propustnosti, byste měli používat více objektů Factory zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-138">To obtain higher throughput rates, you should use multiple messaging factories.</span></span>

## <a name="receive-mode"></a><span data-ttu-id="bccf6-139">Zobrazí režim</span><span class="sxs-lookup"><span data-stu-id="bccf6-139">Receive mode</span></span>
<span data-ttu-id="bccf6-140">Při vytvoření fronty nebo předplatného klienta, můžete určit režim příjmu: *funkce Náhled zámku* nebo *přijetí a odstranění*.</span><span class="sxs-lookup"><span data-stu-id="bccf6-140">When creating a queue or subscription client, you can specify a receive mode: *Peek-lock* or *Receive and Delete*.</span></span> <span data-ttu-id="bccf6-141">Zobrazí výchozí režim je [PeekLock][PeekLock].</span><span class="sxs-lookup"><span data-stu-id="bccf6-141">The default receive mode is [PeekLock][PeekLock].</span></span> <span data-ttu-id="bccf6-142">Při provozu v tomto režimu, klient odešle požadavek pro příjem zprávy ze služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-142">When operating in this mode, the client sends a request to receive a message from Service Bus.</span></span> <span data-ttu-id="bccf6-143">Jakmile klient obdrží zprávu, odešle požadavek na dokončení zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-143">After the client has received the message, it sends a request to complete the message.</span></span>

<span data-ttu-id="bccf6-144">Při nastavování režimu receive na [ReceiveAndDelete][ReceiveAndDelete], oba kroky se zkombinují v jedné žádosti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-144">When setting the receive mode to [ReceiveAndDelete][ReceiveAndDelete], both steps are combined in a single request.</span></span> <span data-ttu-id="bccf6-145">To snižuje celkový počet operací a zkvalitnit celkovou propustnost zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-145">This reduces the overall number of operations, and can improve the overall message throughput.</span></span> <span data-ttu-id="bccf6-146">Tato výkonnější dodává jeho riziko ztráty zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-146">This performance gain comes at the risk of losing messages.</span></span>

<span data-ttu-id="bccf6-147">Service Bus nepodporuje transakce pro operace přijímat a odstranění.</span><span class="sxs-lookup"><span data-stu-id="bccf6-147">Service Bus does not support transactions for receive-and-delete operations.</span></span> <span data-ttu-id="bccf6-148">Kromě toho jsou požadovány pro všechny scénáře, ve kterých chce odložení klienta funkce Náhled zámku sémantiku nebo [nedoručených zpráv](service-bus-dead-letter-queues.md) zprávu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-148">In addition, peek-lock semantics are required for any scenarios in which the client wants to defer or [dead-letter](service-bus-dead-letter-queues.md) a message.</span></span>

## <a name="client-side-batching"></a><span data-ttu-id="bccf6-149">Dávkování na straně klienta</span><span class="sxs-lookup"><span data-stu-id="bccf6-149">Client-side batching</span></span>
<span data-ttu-id="bccf6-150">Dávkování na straně klienta umožňuje klientovi fronta nebo téma do prodleva odesílání zprávy pro určitou dobu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-150">Client-side batching enables a queue or topic client to delay the sending of a message for a certain period of time.</span></span> <span data-ttu-id="bccf6-151">Pokud klient pošle další zprávy během tohoto období, přenáší zprávy v jedné dávce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-151">If the client sends additional messages during this time period, it transmits the messages in a single batch.</span></span> <span data-ttu-id="bccf6-152">Dávkování na straně klienta rovněž způsobí, že fronta nebo předplatného klienta tak, aby dávky více **Complete** požadavky do jedné žádosti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-152">Client-side batching also causes a queue or subscription client to batch multiple **Complete** requests into a single request.</span></span> <span data-ttu-id="bccf6-153">Dávkování je dostupná jenom pro asynchronní **odeslat** a **Complete** operace.</span><span class="sxs-lookup"><span data-stu-id="bccf6-153">Batching is only available for asynchronous **Send** and **Complete** operations.</span></span> <span data-ttu-id="bccf6-154">Synchronní operace se okamžitě odesílají do služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-154">Synchronous operations are immediately sent to the Service Bus service.</span></span> <span data-ttu-id="bccf6-155">Dávkování dojít k funkce Náhled nebo přijímat operace, ani dávkování dojde k do klientů.</span><span class="sxs-lookup"><span data-stu-id="bccf6-155">Batching does not occur for peek or receive operations, nor does batching occur across clients.</span></span>

<span data-ttu-id="bccf6-156">Ve výchozím nastavení používá klienta s intervalem batch 20ms.</span><span class="sxs-lookup"><span data-stu-id="bccf6-156">By default, a client uses a batch interval of 20ms.</span></span> <span data-ttu-id="bccf6-157">Batch interval, můžete změnit nastavením [BatchFlushInterval] [ BatchFlushInterval] vlastnost před vytvořením objektu pro vytváření zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-157">You can change the batch interval by setting the [BatchFlushInterval][BatchFlushInterval] property before creating the messaging factory.</span></span> <span data-ttu-id="bccf6-158">Toto nastavení ovlivní všechny klienty, které jsou vytvořené pomocí tento objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-158">This setting affects all clients that are created by this factory.</span></span>

<span data-ttu-id="bccf6-159">Chcete-li zakázat dávkování, nastavte [BatchFlushInterval] [ BatchFlushInterval] vlastnost **TimeSpan.Zero**.</span><span class="sxs-lookup"><span data-stu-id="bccf6-159">To disable batching, set the [BatchFlushInterval][BatchFlushInterval] property to **TimeSpan.Zero**.</span></span> <span data-ttu-id="bccf6-160">Například:</span><span class="sxs-lookup"><span data-stu-id="bccf6-160">For example:</span></span>

```csharp
MessagingFactorySettings mfs = new MessagingFactorySettings();
mfs.TokenProvider = tokenProvider;
mfs.NetMessagingTransportSettings.BatchFlushInterval = TimeSpan.FromSeconds(0.05);
MessagingFactory messagingFactory = MessagingFactory.Create(namespaceUri, mfs);
```

<span data-ttu-id="bccf6-161">Dávkování nemá vliv na počet operací fakturovatelný zasílání zpráv a je dostupná jenom pro protokol klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-161">Batching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="bccf6-162">Protokol HTTP nepodporuje dávkování.</span><span class="sxs-lookup"><span data-stu-id="bccf6-162">The HTTP protocol does not support batching.</span></span>

## <a name="batching-store-access"></a><span data-ttu-id="bccf6-163">Dávkování přístup k úložišti</span><span class="sxs-lookup"><span data-stu-id="bccf6-163">Batching store access</span></span>
<span data-ttu-id="bccf6-164">Pokud chcete zvýšit propustnost fronty, tématu nebo předplatného, Service Bus dávek více zpráv při zapíše do jeho interní úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-164">To increase the throughput of a queue, topic, or subscription, Service Bus batches multiple messages when it writes to its internal store.</span></span> <span data-ttu-id="bccf6-165">Pokud je povoleno na se fronta nebo téma, zápis zpráv do úložiště bude zpracovat v dávce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-165">If enabled on a queue or topic, writing messages into the store will be batched.</span></span> <span data-ttu-id="bccf6-166">Pokud je povoleno na fronty nebo předplatného, odstraňování zpráv z úložiště bude zpracovat v dávce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-166">If enabled on a queue or subscription, deleting messages from the store will be batched.</span></span> <span data-ttu-id="bccf6-167">Pokud je povolený přístup dávkové úložiště pro entitu, Service Bus zpozdí operace zápisu úložiště o dané entity podle až 20ms.</span><span class="sxs-lookup"><span data-stu-id="bccf6-167">If batched store access is enabled for an entity, Service Bus delays a store write operation regarding that entity by up to 20ms.</span></span> <span data-ttu-id="bccf6-168">Další úložiště operace, ke kterým došlo během tohoto intervalu jsou přidány do dávky.</span><span class="sxs-lookup"><span data-stu-id="bccf6-168">Additional store operations that occur during this interval are added to the batch.</span></span> <span data-ttu-id="bccf6-169">Zpracovat v dávce ovlivňuje pouze přístup k úložišti **odeslat** a **Complete** operace; přijímat operace neovlivní.</span><span class="sxs-lookup"><span data-stu-id="bccf6-169">Batched store access only affects **Send** and **Complete** operations; receive operations are not affected.</span></span> <span data-ttu-id="bccf6-170">Dávkové úložiště přístup je vlastnost u entity.</span><span class="sxs-lookup"><span data-stu-id="bccf6-170">Batched store access is a property on an entity.</span></span> <span data-ttu-id="bccf6-171">Dávkování dochází mezi všechny entity, které umožňují přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-171">Batching occurs across all entities that enable batched store access.</span></span>

<span data-ttu-id="bccf6-172">Při vytváření nové fronty, tématu nebo předplatného, je ve výchozím nastavení povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-172">When creating a new queue, topic or subscription, batched store access is enabled by default.</span></span> <span data-ttu-id="bccf6-173">Chcete-li zakázat přístup dávkové úložiště, nastavte [EnableBatchedOperations] [ EnableBatchedOperations] vlastnost **false** před vytvořením entity.</span><span class="sxs-lookup"><span data-stu-id="bccf6-173">To disable batched store access, set the [EnableBatchedOperations][EnableBatchedOperations] property to **false** before creating the entity.</span></span> <span data-ttu-id="bccf6-174">Například:</span><span class="sxs-lookup"><span data-stu-id="bccf6-174">For example:</span></span>

```csharp
QueueDescription qd = new QueueDescription();
qd.EnableBatchedOperations = false;
Queue q = namespaceManager.CreateQueue(qd);
```

<span data-ttu-id="bccf6-175">Dávkové úložiště přístup nemá vliv na počet operací fakturovatelný zasílání zpráv a je vlastností fronty, tématu nebo předplatného.</span><span class="sxs-lookup"><span data-stu-id="bccf6-175">Batched store access does not affect the number of billable messaging operations, and is a property of a queue, topic, or subscription.</span></span> <span data-ttu-id="bccf6-176">Je nezávislé na režim příjmu a protokol, který se používá mezi klientem a službu Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-176">It is independent of the receive mode and the protocol that is used between a client and the Service Bus service.</span></span>

## <a name="prefetching"></a><span data-ttu-id="bccf6-177">Prefetching</span><span class="sxs-lookup"><span data-stu-id="bccf6-177">Prefetching</span></span>
<span data-ttu-id="bccf6-178">Prefetching umožňuje klientovi fronty nebo předplatné načíst další zprávy ze služby při provádění operace příjmu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-178">Prefetching enables the queue or subscription client to load additional messages from the service when it performs a receive operation.</span></span> <span data-ttu-id="bccf6-179">Klient uloží tyto zprávy v místní mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-179">The client stores these messages in a local cache.</span></span> <span data-ttu-id="bccf6-180">Velikost mezipaměti je dáno [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] nebo [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-180">The size of the cache is determined by the [QueueClient.PrefetchCount][QueueClient.PrefetchCount] or [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] properties.</span></span> <span data-ttu-id="bccf6-181">Každého klienta, který umožňuje prefetching udržuje vlastní mezipaměť.</span><span class="sxs-lookup"><span data-stu-id="bccf6-181">Each client that enables prefetching maintains its own cache.</span></span> <span data-ttu-id="bccf6-182">Mezipaměť není sdílet mezi klienty.</span><span class="sxs-lookup"><span data-stu-id="bccf6-182">A cache is not shared across clients.</span></span> <span data-ttu-id="bccf6-183">Pokud klient zahájí operace příjmu a jeho mezipaměť je prázdná, služba přenáší dávku zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-183">If the client initiates a receive operation and its cache is empty, the service transmits a batch of messages.</span></span> <span data-ttu-id="bccf6-184">Velikost dávky se rovná velikosti mezipaměti nebo 256 KB, podle toho, která je menší.</span><span class="sxs-lookup"><span data-stu-id="bccf6-184">The size of the batch equals the size of the cache or 256 KB, whichever is smaller.</span></span> <span data-ttu-id="bccf6-185">Pokud klient zahájí operace příjmu a mezipaměti obsahuje zprávu, zpráva je převzata z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-185">If the client initiates a receive operation and the cache contains a message, the message is taken from the cache.</span></span>

<span data-ttu-id="bccf6-186">Když je prefetched zprávy, se prefetched zpráva jen uzamkne službu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-186">When a message is prefetched, the service locks the prefetched message.</span></span> <span data-ttu-id="bccf6-187">Díky tomu prefetched zpráva nemůže přijímat jiný příjemce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-187">By doing this, the prefetched message cannot be received by a different receiver.</span></span> <span data-ttu-id="bccf6-188">Pokud příjemce nemůže dokončit zprávu, než vyprší platnost zámek, k dispozici pro ostatní příjemce zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-188">If the receiver cannot complete the message before the lock expires, the message becomes available to other receivers.</span></span> <span data-ttu-id="bccf6-189">Prefetched kopie zprávy zůstává v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-189">The prefetched copy of the message remains in the cache.</span></span> <span data-ttu-id="bccf6-190">Příjemce, který využívá vypršenou platností v mezipaměti kopie dostanou výjimku při pokusu o dokončení této zprávě.</span><span class="sxs-lookup"><span data-stu-id="bccf6-190">The receiver that consumes the expired cached copy will receive an exception when it tries to complete that message.</span></span> <span data-ttu-id="bccf6-191">Ve výchozím nastavení zámek zprávy vyprší po 60 sekund.</span><span class="sxs-lookup"><span data-stu-id="bccf6-191">By default, the message lock expires after 60 seconds.</span></span> <span data-ttu-id="bccf6-192">Tuto hodnotu lze rozšířit na 5 minut.</span><span class="sxs-lookup"><span data-stu-id="bccf6-192">This value can be extended to 5 minutes.</span></span> <span data-ttu-id="bccf6-193">Pokud chcete zabránit spotřeby zprávy s vypršenou platností, by měla být velikost mezipaměti vždy menší než počet zpráv, které mohou být využívány službou klienta v určeném časovém limitu uzamčení.</span><span class="sxs-lookup"><span data-stu-id="bccf6-193">To prevent the consumption of expired messages, the cache size should always be smaller than the number of messages that can be consumed by a client within the lock time-out interval.</span></span>

<span data-ttu-id="bccf6-194">Při použití výchozí zámku vypršení platnosti 60 sekund, správné hodnoty pro [SubscriptionClient.PrefetchCount] [ SubscriptionClient.PrefetchCount] je 20krát maximální počet zpracovaných položek všechny přijímačů objektu pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-194">When using the default lock expiration of 60 seconds, a good value for [SubscriptionClient.PrefetchCount][SubscriptionClient.PrefetchCount] is 20 times the maximum processing rates of all receivers of the factory.</span></span> <span data-ttu-id="bccf6-195">Například objekt factory vytvoří 3 příjemci a každý příjemce může zpracovat až 10 zpráv za sekundu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-195">For example, a factory creates 3 receivers, and each receiver can process up to 10 messages per second.</span></span> <span data-ttu-id="bccf6-196">Předběžné načtení počet nesmí být delší než 20 × 3 × 10 = 600.</span><span class="sxs-lookup"><span data-stu-id="bccf6-196">The prefetch count should not exceed 20 X 3 X 10 = 600.</span></span> <span data-ttu-id="bccf6-197">Ve výchozím nastavení [QueueClient.PrefetchCount] [ QueueClient.PrefetchCount] je nastaven na hodnotu 0, což znamená, že žádné další zprávy jsou načtených ze služby.</span><span class="sxs-lookup"><span data-stu-id="bccf6-197">By default, [QueueClient.PrefetchCount][QueueClient.PrefetchCount] is set to 0, which means that no additional messages are fetched from the service.</span></span>

<span data-ttu-id="bccf6-198">Prefetching zprávy zvyšuje celkovou propustnost pro fronty nebo předplatného, protože snižuje celkový počet zpráv operace nebo zpátečních cest.</span><span class="sxs-lookup"><span data-stu-id="bccf6-198">Prefetching messages increases the overall throughput for a queue or subscription because it reduces the overall number of message operations, or round trips.</span></span> <span data-ttu-id="bccf6-199">Načítání první zprávu, ale bude trvat déle (z důvodu velikost vyšší zprávy).</span><span class="sxs-lookup"><span data-stu-id="bccf6-199">Fetching the first message, however, will take longer (due to the increased message size).</span></span> <span data-ttu-id="bccf6-200">Přijímání zpráv prefetched bude rychlejší, protože tyto zprávy již byly staženy klientem.</span><span class="sxs-lookup"><span data-stu-id="bccf6-200">Receiving prefetched messages will be faster because these messages have already been downloaded by the client.</span></span>

<span data-ttu-id="bccf6-201">Vlastnost time to live (TTL) zprávy, které se kontroluje server v době, kdy server odešle zprávu do klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-201">The time-to-live (TTL) property of a message is checked by the server at the time the server sends the message to the client.</span></span> <span data-ttu-id="bccf6-202">Klient nekontroluje vlastnost TTL dané zprávy při doručení zprávy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-202">The client does not check the message’s TTL property when the message is received.</span></span> <span data-ttu-id="bccf6-203">Místo toho zpráva může být přijata i v případě TTL dané zprávy uplynutí a zprávy se uloží do mezipaměti klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-203">Instead, the message can be received even if the message’s TTL has passed while the message was cached by the client.</span></span>

<span data-ttu-id="bccf6-204">Prefetching nemá vliv na počet operací fakturovatelný zasílání zpráv a je dostupná jenom pro protokol klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-204">Prefetching does not affect the number of billable messaging operations, and is available only for the Service Bus client protocol.</span></span> <span data-ttu-id="bccf6-205">Protokol HTTP nepodporuje prefetching.</span><span class="sxs-lookup"><span data-stu-id="bccf6-205">The HTTP protocol does not support prefetching.</span></span> <span data-ttu-id="bccf6-206">Prefetching je k dispozici pro synchronní a asynchronní operace příjmu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-206">Prefetching is available for both synchronous and asynchronous receive operations.</span></span>

## <a name="express-queues-and-topics"></a><span data-ttu-id="bccf6-207">Express front a témat</span><span class="sxs-lookup"><span data-stu-id="bccf6-207">Express queues and topics</span></span>

<span data-ttu-id="bccf6-208">Expresní entity povolte vysoké propustnosti a menší latence scénáře a jsou podporovány pouze na vrstvě Standard zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-208">Express entities enable high throughput and reduced latency scenarios, and are supported only in the Standard messaging tier.</span></span> <span data-ttu-id="bccf6-209">Entity vytvořené v [Premium obory názvů](service-bus-premium-messaging.md) nepodporují možnost express.</span><span class="sxs-lookup"><span data-stu-id="bccf6-209">Entities created in [Premium namespaces](service-bus-premium-messaging.md) do not support the express option.</span></span> <span data-ttu-id="bccf6-210">S expresní entity Pokud je odeslána zpráva se fronta nebo téma, zprávy se neuloží okamžitě v úložišti pro přenos zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-210">With express entities, if a message is sent to a queue or topic, the message is not immediately stored in the messaging store.</span></span> <span data-ttu-id="bccf6-211">Místo toho do mezipaměti v paměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-211">Instead, it is cached in memory.</span></span> <span data-ttu-id="bccf6-212">Pokud zpráva zůstane ve frontě více než několik sekund, se automaticky zapisuje do ustájení úložiště, tedy chránit před ztrátou kvůli výpadku.</span><span class="sxs-lookup"><span data-stu-id="bccf6-212">If a message remains in the queue for more than a few seconds, it is automatically written to stable storage, thus protecting it against loss due to an outage.</span></span> <span data-ttu-id="bccf6-213">Zápis zprávy do mezipaměti paměti zvyšuje propustnost a snižuje latence, protože není k dispozici přístup na pevné úložiště v době, kdy je zpráva odeslána.</span><span class="sxs-lookup"><span data-stu-id="bccf6-213">Writing the message into a memory cache increases throughput and reduces latency because there is no access to stable storage at the time the message is sent.</span></span> <span data-ttu-id="bccf6-214">Zprávy, které se spotřebovávají během několika sekund nezapisují k úložišti zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-214">Messages that are consumed within a few seconds are not written to the messaging store.</span></span> <span data-ttu-id="bccf6-215">Následující příklad vytvoří express tématu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-215">The following example creates an express topic.</span></span>

```csharp
TopicDescription td = new TopicDescription(TopicName);
td.EnableExpress = true;
namespaceManager.CreateTopic(td);
```

<span data-ttu-id="bccf6-216">Pokud expresní entity odeslání zprávu, která obsahuje důležité informace, které nesmí být ztraceny, odesílatel můžete vynutit Service Bus se okamžitě zachovat zprávy na pevné úložiště nastavením [ForcePersistence] [ ForcePersistence] vlastnost **true**.</span><span class="sxs-lookup"><span data-stu-id="bccf6-216">If a message containing critical information that must not be lost is sent to an express entity, the sender can force Service Bus to immediately persist the message to stable storage by setting the [ForcePersistence][ForcePersistence] property to **true**.</span></span>

> [!NOTE]
> <span data-ttu-id="bccf6-217">Expresní entity nepodporují transakce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-217">Express entities do not support transactions.</span></span>

## <a name="use-of-partitioned-queues-or-topics"></a><span data-ttu-id="bccf6-218">Použití oddílů fronty nebo témata</span><span class="sxs-lookup"><span data-stu-id="bccf6-218">Use of partitioned queues or topics</span></span>
<span data-ttu-id="bccf6-219">Interně Service Bus používá stejný uzel a zasílání zpráv uložení ke zpracování a ukládání všechny zprávy pro entity přenosu zpráv (fronty nebo tématu).</span><span class="sxs-lookup"><span data-stu-id="bccf6-219">Internally, Service Bus uses the same node and messaging store to process and store all messages for a messaging entity (queue or topic).</span></span> <span data-ttu-id="bccf6-220">Oddílů fronta nebo téma, na druhé straně je distribuován do více uzlů a úložiště pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-220">A partitioned queue or topic, on the other hand, is distributed across multiple nodes and messaging stores.</span></span> <span data-ttu-id="bccf6-221">Oddílů fronty a témata nejen poskytne vyšší výkon než regulární fronty a témata, budou také vykazovat vyšší dostupnosti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-221">Partitioned queues and topics not only yield a higher throughput than regular queues and topics, they also exhibit superior availability.</span></span> <span data-ttu-id="bccf6-222">Chcete-li vytvořit dělené entity, nastavte [enablepartitioning je] [ EnablePartitioning] vlastnost **true**, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-222">To create a partitioned entity, set the [EnablePartitioning][EnablePartitioning] property to **true**, as shown in the following example.</span></span> <span data-ttu-id="bccf6-223">Další informace o dělené entity najdete v tématu [segmentované entity zasílání zpráv][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="bccf6-223">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

```csharp
// Create partitioned queue.
QueueDescription qd = new QueueDescription(QueueName);
qd.EnablePartitioning = true;
namespaceManager.CreateQueue(qd);
```

## <a name="use-of-multiple-queues"></a><span data-ttu-id="bccf6-224">Použití více front</span><span class="sxs-lookup"><span data-stu-id="bccf6-224">Use of multiple queues</span></span>

<span data-ttu-id="bccf6-225">Pokud není možné použít oddílů fronta nebo téma nebo očekávané zátěže nelze zpracovat pomocí jednoho oddílů fronta nebo téma, je nutné použít více entit pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="bccf6-225">If it is not possible to use a partitioned queue or topic, or the expected load cannot be handled by a single partitioned queue or topic, you must use multiple messaging entities.</span></span> <span data-ttu-id="bccf6-226">Pokud používáte více entit, vytvořte vyhrazený klienta pro každou entitu, místo použití stejného klienta pro všechny entity.</span><span class="sxs-lookup"><span data-stu-id="bccf6-226">When using multiple entities, create a dedicated client for each entity, instead of using the same client for all entities.</span></span>

## <a name="development-and-testing-features"></a><span data-ttu-id="bccf6-227">Vývoj a testování funkcí</span><span class="sxs-lookup"><span data-stu-id="bccf6-227">Development and testing features</span></span>

<span data-ttu-id="bccf6-228">Service Bus má jednu funkci, který je používán speciálně pro vývoj který **by měl být nikdy použit ve konfigurace produkční**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span><span class="sxs-lookup"><span data-stu-id="bccf6-228">Service Bus has one feature that is used specifically for development which **should never be used in production configurations**: [TopicDescription.EnableFilteringMessagesBeforePublishing][].</span></span>

<span data-ttu-id="bccf6-229">Pokud nová pravidla nebo filtry jsou přidány do tématu, můžete použít [TopicDescription.EnableFilteringMessagesBeforePublishing][] k ověření, že nový výraz filtru funguje podle očekávání.</span><span class="sxs-lookup"><span data-stu-id="bccf6-229">When new rules or filters are added to the topic, you can use [TopicDescription.EnableFilteringMessagesBeforePublishing][] to verify that the new filter expression is working as expected.</span></span>

## <a name="scenarios"></a><span data-ttu-id="bccf6-230">Scénáře</span><span class="sxs-lookup"><span data-stu-id="bccf6-230">Scenarios</span></span>
<span data-ttu-id="bccf6-231">Následující části popisují typické scénáře zasílání zpráv a popisují nastavení služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-231">The following sections describe typical messaging scenarios and outline the preferred Service Bus settings.</span></span> <span data-ttu-id="bccf6-232">Propustnosti jsou klasifikovány jako malé (méně než 1 zpráv za sekundu), střední (1 zpráv za sekundu nebo větší, ale méně než 100 zpráv za sekundu) a vysokou (100 zprávy/druhý nebo vyšší).</span><span class="sxs-lookup"><span data-stu-id="bccf6-232">Throughput rates are classified as small (less than 1 message/second), moderate (1 message/second or greater but less than 100 messages/second) and high (100 messages/second or greater).</span></span> <span data-ttu-id="bccf6-233">Počet klientů, které jsou klasifikovány jako malá (5 nebo méně), střední (víc než 5, ale menší než nebo rovna 20) a velké (více než 20).</span><span class="sxs-lookup"><span data-stu-id="bccf6-233">The number of clients are classified as small (5 or fewer), moderate (more than 5 but less than or equal to 20), and large (more than 20).</span></span>

### <a name="high-throughput-queue"></a><span data-ttu-id="bccf6-234">Vysokou propustností fronty</span><span class="sxs-lookup"><span data-stu-id="bccf6-234">High-throughput queue</span></span>
<span data-ttu-id="bccf6-235">Cíl: Maximalizujte propustnost jedné frontě.</span><span class="sxs-lookup"><span data-stu-id="bccf6-235">Goal: Maximize the throughput of a single queue.</span></span> <span data-ttu-id="bccf6-236">Počet odesílateli a příjemci je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-236">The number of senders and receivers is small.</span></span>

* <span data-ttu-id="bccf6-237">Oddílů frontu použijte pro lepší výkon a dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-237">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bccf6-238">Chcete-li zvýšit celkový rychlost odesílání do fronty, použijte k vytvoření odesílatelé více.</span><span class="sxs-lookup"><span data-stu-id="bccf6-238">To increase the overall send rate into the queue, use multiple message factories to create senders.</span></span> <span data-ttu-id="bccf6-239">Pro každý odesílatele použijte asynchronní operace nebo více vláken.</span><span class="sxs-lookup"><span data-stu-id="bccf6-239">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bccf6-240">Pokud chcete zvýšit celkový rychlost přijímání z fronty, použijte k vytvoření přijímače více.</span><span class="sxs-lookup"><span data-stu-id="bccf6-240">To increase the overall receive rate from the queue, use multiple message factories to create receivers.</span></span>
* <span data-ttu-id="bccf6-241">Použití asynchronních operací využívat výhod dávkování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-241">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bccf6-242">Nastavte dávkování interval na 50ms a snížit počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-242">Set the batching interval to 50ms to reduce the number of Service Bus client protocol transmissions.</span></span> <span data-ttu-id="bccf6-243">Pokud jsou použity více odesílatelé, zvýšit dávkování interval 100ms.</span><span class="sxs-lookup"><span data-stu-id="bccf6-243">If multiple senders are used, increase the batching interval to 100ms.</span></span>
* <span data-ttu-id="bccf6-244">Ponechte povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-244">Leave batched store access enabled.</span></span> <span data-ttu-id="bccf6-245">Tím se zvyšuje celkovou rychlost, kdy mohou být zprávy zapisovány do fronty.</span><span class="sxs-lookup"><span data-stu-id="bccf6-245">This increases the overall rate at which messages can be written into the queue.</span></span>
* <span data-ttu-id="bccf6-246">Nastavte počet předběžné načtení 20krát maximální zpracování sazby všichni příjemci objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-246">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bccf6-247">Tím se snižuje počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-247">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="multiple-high-throughput-queues"></a><span data-ttu-id="bccf6-248">Více vysokou propustností fronty</span><span class="sxs-lookup"><span data-stu-id="bccf6-248">Multiple high-throughput queues</span></span>
<span data-ttu-id="bccf6-249">Cíl: Maximalizujte celkovou propustnost více front.</span><span class="sxs-lookup"><span data-stu-id="bccf6-249">Goal: Maximize overall throughput of multiple queues.</span></span> <span data-ttu-id="bccf6-250">Propustnost jednotlivé fronty je střední nebo vysoké.</span><span class="sxs-lookup"><span data-stu-id="bccf6-250">The throughput of an individual queue is moderate or high.</span></span>

<span data-ttu-id="bccf6-251">Pokud chcete získat maximální propustnost napříč více front, použijte nastavení popsané Maximalizovat propustnost jedné frontě.</span><span class="sxs-lookup"><span data-stu-id="bccf6-251">To obtain maximum throughput across multiple queues, use the settings outlined to maximize the throughput of a single queue.</span></span> <span data-ttu-id="bccf6-252">Kromě toho můžete použijte různé objekty Factory vytvořit klienti, kteří odesílat nebo přijímat z různých front.</span><span class="sxs-lookup"><span data-stu-id="bccf6-252">In addition, use different factories to create clients that send or receive from different queues.</span></span>

### <a name="low-latency-queue"></a><span data-ttu-id="bccf6-253">Fronty s nízkou latencí</span><span class="sxs-lookup"><span data-stu-id="bccf6-253">Low latency queue</span></span>
<span data-ttu-id="bccf6-254">Cíl: Minimalizaci latence začátku do konce se fronta nebo téma.</span><span class="sxs-lookup"><span data-stu-id="bccf6-254">Goal: Minimize end-to-end latency of a queue or topic.</span></span> <span data-ttu-id="bccf6-255">Počet odesílateli a příjemci je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-255">The number of senders and receivers is small.</span></span> <span data-ttu-id="bccf6-256">Propustnost fronty je malá nebo střední.</span><span class="sxs-lookup"><span data-stu-id="bccf6-256">The throughput of the queue is small or moderate.</span></span>

* <span data-ttu-id="bccf6-257">Oddílů frontu použijte pro lepší dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-257">Use a partitioned queue for improved availability.</span></span>
* <span data-ttu-id="bccf6-258">Zakážete dávkování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-258">Disable client-side batching.</span></span> <span data-ttu-id="bccf6-259">Klient, ihned odešle zprávu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-259">The client immediately sends a message.</span></span>
* <span data-ttu-id="bccf6-260">Zakážete přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-260">Disable batched store access.</span></span> <span data-ttu-id="bccf6-261">Služba okamžitě zapíše zprávu do úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-261">The service immediately writes the message to the store.</span></span>
* <span data-ttu-id="bccf6-262">Při použití jednoho klienta, nastavte počet předběžné načtení 20krát zpracování míru příjemce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-262">If using a single client, set the prefetch count to 20 times the processing rate of the receiver.</span></span> <span data-ttu-id="bccf6-263">Pokud více zpráv přijaty ve frontě ve stejnou dobu, odesílá protokol klienta služby Service Bus je všechny najednou.</span><span class="sxs-lookup"><span data-stu-id="bccf6-263">If multiple messages arrive at the queue at the same time, the Service Bus client protocol transmits them all at the same time.</span></span> <span data-ttu-id="bccf6-264">Když klient obdrží na další zprávu, zpráva již v místní mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-264">When the client receives the next message, that message is already in the local cache.</span></span> <span data-ttu-id="bccf6-265">Mezipaměti musí být malé.</span><span class="sxs-lookup"><span data-stu-id="bccf6-265">The cache should be small.</span></span>
* <span data-ttu-id="bccf6-266">Pokud používáte více klientů, nastavte počet předběžné načtení na hodnotu 0.</span><span class="sxs-lookup"><span data-stu-id="bccf6-266">If using multiple clients, set the prefetch count to 0.</span></span> <span data-ttu-id="bccf6-267">Díky tomu může klient druhý přijímat o druhou zprávu při první klient stále zpracovává první zprávu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-267">By doing this, the second client can receive the second message while the first client is still processing the first message.</span></span>

### <a name="queue-with-a-large-number-of-senders"></a><span data-ttu-id="bccf6-268">Fronty s velkým počtem uživatelů</span><span class="sxs-lookup"><span data-stu-id="bccf6-268">Queue with a large number of senders</span></span>
<span data-ttu-id="bccf6-269">Cíl: Maximalizujte propustnost se fronta nebo téma s velkým počtem uživatelů.</span><span class="sxs-lookup"><span data-stu-id="bccf6-269">Goal: Maximize throughput of a queue or topic with a large number of senders.</span></span> <span data-ttu-id="bccf6-270">Každý odesílatel odešle zprávy střední míru.</span><span class="sxs-lookup"><span data-stu-id="bccf6-270">Each sender sends messages with a moderate rate.</span></span> <span data-ttu-id="bccf6-271">Počet příjemců je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-271">The number of receivers is small.</span></span>

<span data-ttu-id="bccf6-272">Umožňuje až 1 000 souběžných připojení k entitě přenosu zpráv Service Bus (nebo 5000 pomocí protokolu AMQP).</span><span class="sxs-lookup"><span data-stu-id="bccf6-272">Service Bus enables up to 1000 concurrent connections to a messaging entity (or 5000 using AMQP).</span></span> <span data-ttu-id="bccf6-273">Tento limit je vyžadována na úrovni oboru názvů a fronty, témata nebo odběry jsou omezená podle maximální počet souběžných připojení na obor názvů.</span><span class="sxs-lookup"><span data-stu-id="bccf6-273">This limit is enforced at the namespace level, and queues/topics/subscriptions are capped by the limit of concurrent connections per namespace.</span></span> <span data-ttu-id="bccf6-274">Pro fronty je toto číslo sdílet mezi odesílateli a příjemci.</span><span class="sxs-lookup"><span data-stu-id="bccf6-274">For queues, this number is shared between senders and receivers.</span></span> <span data-ttu-id="bccf6-275">Pokud jsou požadovány pro odesílatelé všechna připojení 1000, měli byste nahradit fronty téma a v rámci jednoho předplatného.</span><span class="sxs-lookup"><span data-stu-id="bccf6-275">If all 1000 connections are required for senders, you should replace the queue with a topic and a single subscription.</span></span> <span data-ttu-id="bccf6-276">Téma přijme až 1 000 souběžných připojení z odesílatelé, zatímco předplatné přijímá další 1 000 souběžných připojení z příjemců.</span><span class="sxs-lookup"><span data-stu-id="bccf6-276">A topic accepts up to 1000 concurrent connections from senders, whereas the subscription accepts an additional 1000 concurrent connections from receivers.</span></span> <span data-ttu-id="bccf6-277">Pokud více než 1 000 souběžných odesílatelé, by měl odesílatelé odesílání zpráv na protokol Service Bus přes HTTP.</span><span class="sxs-lookup"><span data-stu-id="bccf6-277">If more than 1000 concurrent senders are required, the senders should send messages to the Service Bus protocol via HTTP.</span></span>

<span data-ttu-id="bccf6-278">Chcete-li maximalizovat propustnost, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="bccf6-278">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bccf6-279">Oddílů frontu použijte pro lepší výkon a dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-279">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bccf6-280">Pokud každý odesílatele se nachází v jiném procesu, použijte pouze jeden objekt factory pro procesy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-280">If each sender resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="bccf6-281">Použití asynchronních operací využívat výhod dávkování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-281">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bccf6-282">Použijte výchozí dávkování interval 20ms a snížit počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-282">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bccf6-283">Ponechte povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-283">Leave batched store access enabled.</span></span> <span data-ttu-id="bccf6-284">Tím se zvyšuje celkovou rychlost, kdy mohou být zprávy zapisovány do fronta nebo téma.</span><span class="sxs-lookup"><span data-stu-id="bccf6-284">This increases the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="bccf6-285">Nastavte počet předběžné načtení 20krát maximální zpracování sazby všichni příjemci objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-285">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bccf6-286">Tím se snižuje počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-286">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="queue-with-a-large-number-of-receivers"></a><span data-ttu-id="bccf6-287">Fronty s velkým počtem příjemci</span><span class="sxs-lookup"><span data-stu-id="bccf6-287">Queue with a large number of receivers</span></span>
<span data-ttu-id="bccf6-288">Cíl: Maximalizujte rychlost přijímání fronty nebo předplatné s velký počet příjemců.</span><span class="sxs-lookup"><span data-stu-id="bccf6-288">Goal: Maximize the receive rate of a queue or subscription with a large number of receivers.</span></span> <span data-ttu-id="bccf6-289">Každý příjemce přijímá zprávy střední rychlostí.</span><span class="sxs-lookup"><span data-stu-id="bccf6-289">Each receiver receives messages at a moderate rate.</span></span> <span data-ttu-id="bccf6-290">Počet uživatelů je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-290">The number of senders is small.</span></span>

<span data-ttu-id="bccf6-291">Service Bus umožňuje až 1 000 souběžných připojení k entitě.</span><span class="sxs-lookup"><span data-stu-id="bccf6-291">Service Bus enables up to 1000 concurrent connections to an entity.</span></span> <span data-ttu-id="bccf6-292">Pokud fronty vyžaduje více než 1 000 příjemci, měli byste nahradit fronty téma a více předplatných.</span><span class="sxs-lookup"><span data-stu-id="bccf6-292">If a queue requires more than 1000 receivers, you should replace the queue with a topic and multiple subscriptions.</span></span> <span data-ttu-id="bccf6-293">Každý odběr může podporovat až 1 000 souběžných připojení.</span><span class="sxs-lookup"><span data-stu-id="bccf6-293">Each subscription can support up to 1000 concurrent connections.</span></span> <span data-ttu-id="bccf6-294">Alternativně můžete příjemci přistupovat ke frontě prostřednictvím protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="bccf6-294">Alternatively, receivers can access the queue via the HTTP protocol.</span></span>

<span data-ttu-id="bccf6-295">Chcete-li maximalizovat propustnost, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="bccf6-295">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bccf6-296">Oddílů frontu použijte pro lepší výkon a dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-296">Use a partitioned queue for improved performance and availability.</span></span>
* <span data-ttu-id="bccf6-297">Pokud každý příjemce se nachází v jiném procesu, použijte pouze jeden objekt factory pro procesy.</span><span class="sxs-lookup"><span data-stu-id="bccf6-297">If each receiver resides in a different process, use only a single factory per process.</span></span>
* <span data-ttu-id="bccf6-298">Příjemci můžete použít synchronní nebo asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="bccf6-298">Receivers can use synchronous or asynchronous operations.</span></span> <span data-ttu-id="bccf6-299">Zadaný počet střední receive jednotlivé příjemce, dávkování na straně klienta dokončení požadavku nemá vliv na propustnost příjemce.</span><span class="sxs-lookup"><span data-stu-id="bccf6-299">Given the moderate receive rate of an individual receiver, client-side batching of a Complete request does not affect receiver throughput.</span></span>
* <span data-ttu-id="bccf6-300">Ponechte povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-300">Leave batched store access enabled.</span></span> <span data-ttu-id="bccf6-301">Tím se snižuje celkové zatížení entity.</span><span class="sxs-lookup"><span data-stu-id="bccf6-301">This reduces the overall load of the entity.</span></span> <span data-ttu-id="bccf6-302">Také snižuje celkovou rychlost, kdy mohou být zprávy zapisovány do fronta nebo téma.</span><span class="sxs-lookup"><span data-stu-id="bccf6-302">It also reduces the overall rate at which messages can be written into the queue or topic.</span></span>
* <span data-ttu-id="bccf6-303">Předběžné počet nastavená na hodnotu malé (například PrefetchCount = 10).</span><span class="sxs-lookup"><span data-stu-id="bccf6-303">Set the prefetch count to a small value (for example, PrefetchCount = 10).</span></span> <span data-ttu-id="bccf6-304">To brání tomu, aby příjemci nečinnosti, zatímco ostatní příjemce máte velké množství zpráv do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-304">This prevents receivers from being idle while other receivers have large numbers of messages cached.</span></span>

### <a name="topic-with-a-small-number-of-subscriptions"></a><span data-ttu-id="bccf6-305">Téma se malý počet odběrů</span><span class="sxs-lookup"><span data-stu-id="bccf6-305">Topic with a small number of subscriptions</span></span>
<span data-ttu-id="bccf6-306">Cíl: Maximalizujte propustnost téma s malým počtem odběry.</span><span class="sxs-lookup"><span data-stu-id="bccf6-306">Goal: Maximize the throughput of a topic with a small number of subscriptions.</span></span> <span data-ttu-id="bccf6-307">Zprávu přijme mnoho odběrů, což znamená, že míra kombinované receive přes všechny odběry je větší než frekvence odesílání.</span><span class="sxs-lookup"><span data-stu-id="bccf6-307">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is larger than the send rate.</span></span> <span data-ttu-id="bccf6-308">Počet uživatelů je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-308">The number of senders is small.</span></span> <span data-ttu-id="bccf6-309">Počet příjemců na předplatné je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-309">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="bccf6-310">Chcete-li maximalizovat propustnost, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="bccf6-310">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bccf6-311">Použijte oddílů tématu pro lepší výkon a dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-311">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="bccf6-312">Chcete-li zvýšit celkový rychlost odesílání do tématu, použijte k vytvoření odesílatelé více.</span><span class="sxs-lookup"><span data-stu-id="bccf6-312">To increase the overall send rate into the topic, use multiple message factories to create senders.</span></span> <span data-ttu-id="bccf6-313">Pro každý odesílatele použijte asynchronní operace nebo více vláken.</span><span class="sxs-lookup"><span data-stu-id="bccf6-313">For each sender, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bccf6-314">Pokud chcete zvýšit celková míra přijetí z odběru, použijte k vytvoření přijímače více.</span><span class="sxs-lookup"><span data-stu-id="bccf6-314">To increase the overall receive rate from a subscription, use multiple message factories to create receivers.</span></span> <span data-ttu-id="bccf6-315">Pro každý příjemce použijte asynchronní operace nebo více vláken.</span><span class="sxs-lookup"><span data-stu-id="bccf6-315">For each receiver, use asynchronous operations or multiple threads.</span></span>
* <span data-ttu-id="bccf6-316">Použití asynchronních operací využívat výhod dávkování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-316">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bccf6-317">Použijte výchozí dávkování interval 20ms a snížit počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-317">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bccf6-318">Ponechte povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-318">Leave batched store access enabled.</span></span> <span data-ttu-id="bccf6-319">Tím se zvyšuje celkovou rychlost, kdy mohou být zprávy zapisovány do tématu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-319">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="bccf6-320">Nastavte počet předběžné načtení 20krát maximální zpracování sazby všichni příjemci objekt pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="bccf6-320">Set the prefetch count to 20 times the maximum processing rates of all receivers of a factory.</span></span> <span data-ttu-id="bccf6-321">Tím se snižuje počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-321">This reduces the number of Service Bus client protocol transmissions.</span></span>

### <a name="topic-with-a-large-number-of-subscriptions"></a><span data-ttu-id="bccf6-322">Téma se velký počet odběrů</span><span class="sxs-lookup"><span data-stu-id="bccf6-322">Topic with a large number of subscriptions</span></span>
<span data-ttu-id="bccf6-323">Cíl: Maximalizujte propustnost téma se velký počet předplatných.</span><span class="sxs-lookup"><span data-stu-id="bccf6-323">Goal: Maximize the throughput of a topic with a large number of subscriptions.</span></span> <span data-ttu-id="bccf6-324">Zpráva je přijatých mnoho odběrů, což znamená, že míra kombinované receive přes všechny odběry je mnohem větší než frekvence odesílání.</span><span class="sxs-lookup"><span data-stu-id="bccf6-324">A message is received by many subscriptions, which means the combined receive rate over all subscriptions is much larger than the send rate.</span></span> <span data-ttu-id="bccf6-325">Počet uživatelů je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-325">The number of senders is small.</span></span> <span data-ttu-id="bccf6-326">Počet příjemců na předplatné je malá.</span><span class="sxs-lookup"><span data-stu-id="bccf6-326">The number of receivers per subscription is small.</span></span>

<span data-ttu-id="bccf6-327">Témata s velkým počtem odběry obvykle odhalí nízkou celkovou propustnost všechny zprávy jsou směrovány do všech odběrů.</span><span class="sxs-lookup"><span data-stu-id="bccf6-327">Topics with a large number of subscriptions typically expose a low overall throughput if all messages are routed to all subscriptions.</span></span> <span data-ttu-id="bccf6-328">Důvodem je skutečnost, že každou zprávu přijme mnohokrát a všechny zprávy, které jsou obsaženy v tématu a všechny její odběry jsou uložené ve stejném úložišti.</span><span class="sxs-lookup"><span data-stu-id="bccf6-328">This is caused by the fact that each message is received many times, and all messages that are contained in a topic and all its subscriptions are stored in the same store.</span></span> <span data-ttu-id="bccf6-329">Předpokládá se, že počet odesílatelé a počet příjemců na předplatné je malé.</span><span class="sxs-lookup"><span data-stu-id="bccf6-329">It is assumed that the number of senders and number of receivers per subscription is small.</span></span> <span data-ttu-id="bccf6-330">Service Bus podporuje až 2 000 odběry na téma.</span><span class="sxs-lookup"><span data-stu-id="bccf6-330">Service Bus supports up to 2,000 subscriptions per topic.</span></span>

<span data-ttu-id="bccf6-331">Chcete-li maximalizovat propustnost, postupujte takto:</span><span class="sxs-lookup"><span data-stu-id="bccf6-331">To maximize throughput, do the following:</span></span>

* <span data-ttu-id="bccf6-332">Použijte oddílů tématu pro lepší výkon a dostupnost.</span><span class="sxs-lookup"><span data-stu-id="bccf6-332">Use a partitioned topic for improved performance and availability.</span></span>
* <span data-ttu-id="bccf6-333">Použití asynchronních operací využívat výhod dávkování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="bccf6-333">Use asynchronous operations to take advantage of client-side batching.</span></span>
* <span data-ttu-id="bccf6-334">Použijte výchozí dávkování interval 20ms a snížit počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-334">Use the default batching interval of 20ms to reduce the number of Service Bus client protocol transmissions.</span></span>
* <span data-ttu-id="bccf6-335">Ponechte povolen přístup dávkové úložiště.</span><span class="sxs-lookup"><span data-stu-id="bccf6-335">Leave batched store access enabled.</span></span> <span data-ttu-id="bccf6-336">Tím se zvyšuje celkovou rychlost, kdy mohou být zprávy zapisovány do tématu.</span><span class="sxs-lookup"><span data-stu-id="bccf6-336">This increases the overall rate at which messages can be written into the topic.</span></span>
* <span data-ttu-id="bccf6-337">Nastavte počet předběžné načtení 20krát očekávané receive míru v sekundách.</span><span class="sxs-lookup"><span data-stu-id="bccf6-337">Set the prefetch count to 20 times the expected receive rate in seconds.</span></span> <span data-ttu-id="bccf6-338">Tím se snižuje počet přenosů protokolu klienta služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="bccf6-338">This reduces the number of Service Bus client protocol transmissions.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bccf6-339">Další kroky</span><span class="sxs-lookup"><span data-stu-id="bccf6-339">Next steps</span></span>
<span data-ttu-id="bccf6-340">Další informace o optimalizaci výkonu služby Service Bus, najdete v části [segmentované entity zasílání zpráv][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="bccf6-340">To learn more about optimizing Service Bus performance, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[MessageSender]: /dotnet/api/microsoft.servicebus.messaging.messagesender
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[PeekLock]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[ReceiveAndDelete]: /dotnet/api/microsoft.servicebus.messaging.receivemode
[BatchFlushInterval]: /dotnet/api/microsoft.servicebus.messaging.netmessagingtransportsettings.batchflushinterval#Microsoft_ServiceBus_Messaging_NetMessagingTransportSettings_BatchFlushInterval
[EnableBatchedOperations]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablebatchedoperations#Microsoft_ServiceBus_Messaging_QueueDescription_EnableBatchedOperations
[QueueClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.queueclient.prefetchcount#Microsoft_ServiceBus_Messaging_QueueClient_PrefetchCount
[SubscriptionClient.PrefetchCount]: /dotnet/api/microsoft.servicebus.messaging.subscriptionclient.prefetchcount#Microsoft_ServiceBus_Messaging_SubscriptionClient_PrefetchCount
[ForcePersistence]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage.forcepersistence#Microsoft_ServiceBus_Messaging_BrokeredMessage_ForcePersistence
[EnablePartitioning]: /dotnet/api/microsoft.servicebus.messaging.queuedescription.enablepartitioning#Microsoft_ServiceBus_Messaging_QueueDescription_EnablePartitioning
[Partitioned messaging entities]: service-bus-partitioning.md
<span data-ttu-id="bccf6-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span><span class="sxs-lookup"><span data-stu-id="bccf6-341">[TopicDescription.EnableFilteringMessagesBeforePublishing]: /dotnet/api/microsoft.servicebus.messaging.topicdescription.enablefilteringmessagesbeforepublishing#Microsoft_ServiceBus_Messaging_TopicDescription_EnableFilteringMessagesBeforePublishing</span></span>

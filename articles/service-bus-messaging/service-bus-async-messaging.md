---
title: "Asynchronní zasílání zpráv Service Bus | Microsoft Docs"
description: "Popis asynchronní zasílání zpráv Azure Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: f1435549-e1f2-40cb-a280-64ea07b39fc7
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/19/2017
ms.author: sethm
ms.openlocfilehash: 95d6f295ba145a55fe4ed3fc7c6f627c9d419a3c
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="asynchronous-messaging-patterns-and-high-availability"></a><span data-ttu-id="39093-103">Asynchronní schémata zasílání zpráv a vysoká dostupnost</span><span class="sxs-lookup"><span data-stu-id="39093-103">Asynchronous messaging patterns and high availability</span></span>

<span data-ttu-id="39093-104">Asynchronní zasílání zpráv, můžou se implementovat v mnoha různými způsoby.</span><span class="sxs-lookup"><span data-stu-id="39093-104">Asynchronous messaging can be implemented in a variety of different ways.</span></span> <span data-ttu-id="39093-105">Pomocí fronty, témata a odběry Azure Service Bus podporuje asynchronism prostřednictvím dopředného mechanismus a úložiště.</span><span class="sxs-lookup"><span data-stu-id="39093-105">With queues, topics, and subscriptions, Azure Service Bus supports asynchronism via a store and forward mechanism.</span></span> <span data-ttu-id="39093-106">V běžném provozu (synchronní) odesílání zpráv do front a témat a příjem zpráv z fronty a odběry.</span><span class="sxs-lookup"><span data-stu-id="39093-106">In normal (synchronous) operation, you send messages to queues and topics, and receive messages from queues and subscriptions.</span></span> <span data-ttu-id="39093-107">Aplikace, které můžete psát závisí na těchto entitách se vždy k dispozici.</span><span class="sxs-lookup"><span data-stu-id="39093-107">Applications you write depend on these entities always being available.</span></span> <span data-ttu-id="39093-108">Když se změní stav entity, z důvodu z různých důvodů, potřebujete způsob, jak poskytnout omezenou schopnost entita, která může stát odpovědí na většinu potřeb.</span><span class="sxs-lookup"><span data-stu-id="39093-108">When the entity health changes, due to a variety of circumstances, you need a way to provide a reduced capability entity that can satisfy most needs.</span></span>

<span data-ttu-id="39093-109">Aplikace můžete povolit různé scénáře komunikace obvykle pomocí asynchronními vzory zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-109">Applications typically use asynchronous messaging patterns to enable a number of communication scenarios.</span></span> <span data-ttu-id="39093-110">Můžete vytvořit aplikace, ve kterých klienti mohou zasílat zprávy do služby, i když služba není spuštěná.</span><span class="sxs-lookup"><span data-stu-id="39093-110">You can build applications in which clients can send messages to services, even when the service is not running.</span></span> <span data-ttu-id="39093-111">Pro aplikace na úrovni tohoto prostředí, které může pomoci shluky komunikace, fronty zatížení tím, že poskytuje místo pro komunikaci mezi vyrovnávací paměti.</span><span class="sxs-lookup"><span data-stu-id="39093-111">For applications that experience bursts of communications, a queue can help level the load by providing a place to buffer communications.</span></span> <span data-ttu-id="39093-112">Nakonec můžete získat Vyrovnávání zatížení jednoduchý, ale efektivní distribuci zprávy mezi různými počítači.</span><span class="sxs-lookup"><span data-stu-id="39093-112">Finally, you can get a simple but effective load balancer to distribute messages across multiple machines.</span></span>

<span data-ttu-id="39093-113">Aby byla zachována dostupnosti kterékoli z těchto entit, vezměte v úvahu počet různé způsoby, ve kterém může vyskytovat tyto entity není k dispozici pro odolný systém zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-113">In order to maintain availability of any of these entities, consider a number of different ways in which these entities can appear unavailable for a durable messaging system.</span></span> <span data-ttu-id="39093-114">Obecně řečeno vidíme entity k dispozici pro aplikace, kterou jsme napsali následující různými způsoby:</span><span class="sxs-lookup"><span data-stu-id="39093-114">Generally speaking, we see the entity become unavailable to applications we write in the following different ways:</span></span>

* <span data-ttu-id="39093-115">Nelze odeslat zprávy.</span><span class="sxs-lookup"><span data-stu-id="39093-115">Unable to send messages.</span></span>
* <span data-ttu-id="39093-116">Nelze přijímat zprávy.</span><span class="sxs-lookup"><span data-stu-id="39093-116">Unable to receive messages.</span></span>
* <span data-ttu-id="39093-117">Nelze spravovat entity (vytvořit, získat, aktualizovat nebo odstranit entity).</span><span class="sxs-lookup"><span data-stu-id="39093-117">Unable to manage entities (create, retrieve, update, or delete entities).</span></span>
* <span data-ttu-id="39093-118">Nebylo možné kontaktovat službu.</span><span class="sxs-lookup"><span data-stu-id="39093-118">Unable to contact the service.</span></span>

<span data-ttu-id="39093-119">Pro každý z těchto chyb selhání různé režimy existují, které aplikace mohly pokračovat v práci na určité úrovni snížené schopnosti.</span><span class="sxs-lookup"><span data-stu-id="39093-119">For each of these failures, different failure modes exist that enable an application to continue to perform work at some level of reduced capability.</span></span> <span data-ttu-id="39093-120">Například systém, který může odesílat zprávy, ale není přijímat můžete nadále získávat objednávek zákazníků, ale nemůže zpracovat tyto objednávky.</span><span class="sxs-lookup"><span data-stu-id="39093-120">For example, a system that can send messages but not receive them can still receive orders from customers but cannot process those orders.</span></span> <span data-ttu-id="39093-121">Toto téma popisuje potenciální problémy, ke kterým dochází, a jak jsou omezeny těchto problémů.</span><span class="sxs-lookup"><span data-stu-id="39093-121">This topic discusses potential issues that can occur, and how those issues are mitigated.</span></span> <span data-ttu-id="39093-122">Service Bus zavedla několika způsoby zmírnění, které musí přihlásíte k odběru a toto téma taky popisuje pravidla pro používání těchto jejich zmírnění výslovný souhlas.</span><span class="sxs-lookup"><span data-stu-id="39093-122">Service Bus has introduced a number of mitigations which you must opt into, and this topic also discusses the rules governing the use of those opt-in mitigations.</span></span>

## <a name="reliability-in-service-bus"></a><span data-ttu-id="39093-123">Spolehlivost v Service Bus</span><span class="sxs-lookup"><span data-stu-id="39093-123">Reliability in Service Bus</span></span>
<span data-ttu-id="39093-124">Existuje několik způsobů pro zpracování zprávy a entity problémy a jsou pokyny pro příslušné užívání tyto způsoby zmírnění rizik.</span><span class="sxs-lookup"><span data-stu-id="39093-124">There are several ways to handle message and entity issues, and there are guidelines governing the appropriate use of those mitigations.</span></span> <span data-ttu-id="39093-125">Zjistit, podle pokynů, musíte nejprve porozumět, co může selhat v Service Bus.</span><span class="sxs-lookup"><span data-stu-id="39093-125">To understand the guidelines, you must first understand what can fail in Service Bus.</span></span> <span data-ttu-id="39093-126">Vzhledem k řešení Azure systémy všechny tyto problémy jsou obvykle krátkodobou.</span><span class="sxs-lookup"><span data-stu-id="39093-126">Due to the design of Azure systems, all of these issues tend to be short-lived.</span></span> <span data-ttu-id="39093-127">Na vysoké úrovni zobrazit různé příčiny nedostupnosti takto:</span><span class="sxs-lookup"><span data-stu-id="39093-127">At a high level, the different causes of unavailability appear as follows:</span></span>

* <span data-ttu-id="39093-128">Omezení z externího systému, na kterém závisí Service Bus.</span><span class="sxs-lookup"><span data-stu-id="39093-128">Throttling from an external system on which Service Bus depends.</span></span> <span data-ttu-id="39093-129">Omezení dojde na interakce s úložiště a výpočetní prostředky.</span><span class="sxs-lookup"><span data-stu-id="39093-129">Throttling occurs from interactions with storage and compute resources.</span></span>
* <span data-ttu-id="39093-130">Problém pro systém, na kterém závisí Service Bus.</span><span class="sxs-lookup"><span data-stu-id="39093-130">Issue for a system on which Service Bus depends.</span></span> <span data-ttu-id="39093-131">Například určitá část úložiště může dojít k potížím.</span><span class="sxs-lookup"><span data-stu-id="39093-131">For example, a given part of storage can encounter issues.</span></span>
* <span data-ttu-id="39093-132">Chyba služby Service Bus na jednom subsystému.</span><span class="sxs-lookup"><span data-stu-id="39093-132">Failure of Service Bus on single subsystem.</span></span> <span data-ttu-id="39093-133">V takovém případě výpočetním uzlu můžete získat v nekonzistentním stavu a musí restartujte samostatně, způsobuje všechny entity, které slouží k jiným uzlům Vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="39093-133">In this situation, a compute node can get into an inconsistent state and must restart itself, causing all entities it serves to load balance to other nodes.</span></span> <span data-ttu-id="39093-134">To zase způsobit na krátkou dobu zpracování pomalé zprávy.</span><span class="sxs-lookup"><span data-stu-id="39093-134">This in turn can cause a short period of slow message processing.</span></span>
* <span data-ttu-id="39093-135">Chyba služby Service Bus v rámci datového centra Azure.</span><span class="sxs-lookup"><span data-stu-id="39093-135">Failure of Service Bus within an Azure datacenter.</span></span> <span data-ttu-id="39093-136">Jedná se o "závažnou chybu" během které systému nedostupný pro mnoho minut nebo několik hodin.</span><span class="sxs-lookup"><span data-stu-id="39093-136">This is a "catastrophic failure" during which the system is unreachable for many minutes or a few hours.</span></span>

> [!NOTE]
> <span data-ttu-id="39093-137">Termín **úložiště** může zahrnovat Azure Storage a SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="39093-137">The term **storage** can mean both Azure Storage and SQL Azure.</span></span>
> 
> 

<span data-ttu-id="39093-138">Service Bus obsahuje počet jejich zmírnění pro tyto problémy.</span><span class="sxs-lookup"><span data-stu-id="39093-138">Service Bus contains a number of mitigations for these issues.</span></span> <span data-ttu-id="39093-139">Následující části popisují jednotlivé problémy a jejich odpovídajících jejich zmírnění.</span><span class="sxs-lookup"><span data-stu-id="39093-139">The following sections discuss each issue and their respective mitigations.</span></span>

### <a name="throttling"></a><span data-ttu-id="39093-140">Omezování</span><span class="sxs-lookup"><span data-stu-id="39093-140">Throttling</span></span>
<span data-ttu-id="39093-141">Službou Service Bus omezování umožňuje správu míra spolupráci zprávy.</span><span class="sxs-lookup"><span data-stu-id="39093-141">With Service Bus, throttling enables cooperative message rate management.</span></span> <span data-ttu-id="39093-142">Každý uzel jednotlivé služby Service Bus je umístěno mnoho entit.</span><span class="sxs-lookup"><span data-stu-id="39093-142">Each individual Service Bus node houses many entities.</span></span> <span data-ttu-id="39093-143">Každý z těchto entit vytváří požadavky na systém z hlediska využití procesoru, paměti, úložiště a jiné omezující vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="39093-143">Each of those entities makes demands on the system in terms of CPU, memory, storage, and other facets.</span></span> <span data-ttu-id="39093-144">Když některé z těchto omezující vlastnosti zjistí využití který překračuje definované prahové hodnoty, Service Bus můžete odepřít daného požadavku.</span><span class="sxs-lookup"><span data-stu-id="39093-144">When any of these facets detects usage that exceeds defined thresholds, Service Bus can deny a given request.</span></span> <span data-ttu-id="39093-145">Volající obdrží [ServerBusyException] [ ServerBusyException] a opakování za 10 sekund.</span><span class="sxs-lookup"><span data-stu-id="39093-145">The caller receives a [ServerBusyException][ServerBusyException] and retries after 10 seconds.</span></span>

<span data-ttu-id="39093-146">Jako omezení rizik musíte kód čtení chybu a zastaví všechny opakování zprávy alespoň 10 sekund.</span><span class="sxs-lookup"><span data-stu-id="39093-146">As a mitigation, the code must read the error and halt any retries of the message for at least 10 seconds.</span></span> <span data-ttu-id="39093-147">Vzhledem k tomu, že mezi částí aplikace zákazníka může dojít k chybě, očekává se, že každého jednotlivého nezávisle provede logika opakovaných pokusů.</span><span class="sxs-lookup"><span data-stu-id="39093-147">Since the error can happen across pieces of the customer application, it is expected that each piece independently executes the retry logic.</span></span> <span data-ttu-id="39093-148">Kód může snížit pravděpodobnost omezené tím, že umožňuje vytváření oddílů na se fronta nebo téma.</span><span class="sxs-lookup"><span data-stu-id="39093-148">The code can reduce the probability of being throttled by enabling partitioning on a queue or topic.</span></span>

### <a name="issue-for-an-azure-dependency"></a><span data-ttu-id="39093-149">Problém pro Azure závislostí</span><span class="sxs-lookup"><span data-stu-id="39093-149">Issue for an Azure dependency</span></span>
<span data-ttu-id="39093-150">Ostatní součásti v rámci Azure občas může mít problémy služby.</span><span class="sxs-lookup"><span data-stu-id="39093-150">Other components within Azure can occasionally have service issues.</span></span> <span data-ttu-id="39093-151">Například pokud probíhá upgrade systému, který používá Service Bus, daný systém může dočasně mají omezenou možnosti.</span><span class="sxs-lookup"><span data-stu-id="39093-151">For example, when a system that Service Bus uses is being upgraded, that system can temporarily experience reduced capabilities.</span></span> <span data-ttu-id="39093-152">Obejít těchto typů problémů, Service Bus pravidelně prověří a implementuje způsoby zmírnění rizik.</span><span class="sxs-lookup"><span data-stu-id="39093-152">To work around these types of issues, Service Bus regularly investigates and implements mitigations.</span></span> <span data-ttu-id="39093-153">Vedlejší efekty tyto způsoby zmírnění zobrazí.</span><span class="sxs-lookup"><span data-stu-id="39093-153">Side effects of these mitigations do appear.</span></span> <span data-ttu-id="39093-154">Service Bus implementuje pro zpracování přechodné problémy s úložištěm, systém, který umožňuje operace odesílání zpráv do pracují konzistentně.</span><span class="sxs-lookup"><span data-stu-id="39093-154">For example, to handle transient issues with storage, Service Bus implements a system that allows message send operations to work consistently.</span></span> <span data-ttu-id="39093-155">Vzhledem k povaze zmírnění odeslaná zpráva může trvat až 15 minut se zobrazí v ovlivněných fronty nebo předplatné a připravený pro operace příjmu.</span><span class="sxs-lookup"><span data-stu-id="39093-155">Due to the nature of the mitigation, a sent message can take up to 15 minutes to appear in the affected queue or subscription and be ready for a receive operation.</span></span> <span data-ttu-id="39093-156">Obecně řečeno většiny entit nebude k tomuto problému dojde.</span><span class="sxs-lookup"><span data-stu-id="39093-156">Generally speaking, most entities will not experience this issue.</span></span> <span data-ttu-id="39093-157">Však získá počet entit v Service Bus v Azure, tohoto omezení je někdy nutné pro malou zákazníků služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="39093-157">However, given the number of entities in Service Bus within Azure, this mitigation is sometimes needed for a small subset of Service Bus customers.</span></span>

### <a name="service-bus-failure-on-a-single-subsystem"></a><span data-ttu-id="39093-158">Service Bus selhání v jednom subsystému</span><span class="sxs-lookup"><span data-stu-id="39093-158">Service Bus failure on a single subsystem</span></span>
<span data-ttu-id="39093-159">S libovolnou aplikací okolností může způsobit interní součást Service Bus nekonzistenci.</span><span class="sxs-lookup"><span data-stu-id="39093-159">With any application, circumstances can cause an internal component of Service Bus to become inconsistent.</span></span> <span data-ttu-id="39093-160">Když Service Bus to zjistí, shromažďuje data z aplikace, které pomáhají při diagnostice, co se stalo.</span><span class="sxs-lookup"><span data-stu-id="39093-160">When Service Bus detects this, it collects data from the application to aid in diagnosing what happened.</span></span> <span data-ttu-id="39093-161">Jakmile data jsou shromažďována, aplikace se restartuje v pokus vrátit do konzistentního stavu.</span><span class="sxs-lookup"><span data-stu-id="39093-161">Once the data is collected, the application is restarted in an attempt to return it to a consistent state.</span></span> <span data-ttu-id="39093-162">Tento proces probíhá poměrně rychle a jsou mnohem kratší výsledky v entitě zobrazování být k dispozici pro až několik minut, i když je typické dobu mimo provoz.</span><span class="sxs-lookup"><span data-stu-id="39093-162">This process happens fairly quickly, and results in an entity appearing to be unavailable for up to a few minutes, though typical down times are much shorter.</span></span>

<span data-ttu-id="39093-163">V těchto případech klientská aplikace generuje [System.TimeoutException] [ System.TimeoutException] nebo [MessagingException] [ MessagingException] výjimka.</span><span class="sxs-lookup"><span data-stu-id="39093-163">In these cases, the client application generates a [System.TimeoutException][System.TimeoutException] or [MessagingException][MessagingException] exception.</span></span> <span data-ttu-id="39093-164">Service Bus obsahuje zmírnění dopadů pro tento problém ve formě logika opakovaných pokusů automatizované klienta.</span><span class="sxs-lookup"><span data-stu-id="39093-164">Service Bus contains a mitigation for this issue in the form of automated client retry logic.</span></span> <span data-ttu-id="39093-165">Jakmile vyčerpá. doba opakování a zpráva doručeno, můžete prozkoumat pomocí dalších funkcí, jako třeba [spárovat obory názvů][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="39093-165">Once the retry period is exhausted and the message is not delivered, you can explore using other features such as [paired namespaces][paired namespaces].</span></span> <span data-ttu-id="39093-166">Obory názvů spárované mít další upozornění, které jsou popsané v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="39093-166">Paired namespaces have other caveats that are discussed in that article.</span></span>

### <a name="failure-of-service-bus-within-an-azure-datacenter"></a><span data-ttu-id="39093-167">Selhání v rámci datového centra Azure Service Bus</span><span class="sxs-lookup"><span data-stu-id="39093-167">Failure of Service Bus within an Azure datacenter</span></span>
<span data-ttu-id="39093-168">Nejpravděpodobnější důvod selhání v datovém centru Azure je neúspěšné nasazení upgradu služby Service Bus nebo závislé systému.</span><span class="sxs-lookup"><span data-stu-id="39093-168">The most probable reason for a failure in an Azure datacenter is a failed upgrade deployment of Service Bus or a dependent system.</span></span> <span data-ttu-id="39093-169">Jak se používá na platformu, co pravděpodobnost, že tento typ selhání.</span><span class="sxs-lookup"><span data-stu-id="39093-169">As the platform has matured, the likelihood of this type of failure has diminished.</span></span> <span data-ttu-id="39093-170">Selhání datacenter může také vyskytnout z důvodů, které zahrnují následující:</span><span class="sxs-lookup"><span data-stu-id="39093-170">A datacenter failure can also happen for reasons that include the following:</span></span>

* <span data-ttu-id="39093-171">Elektrický výpadek (napájení a generování power zmizí).</span><span class="sxs-lookup"><span data-stu-id="39093-171">Electrical outage (power supply and generating power disappear).</span></span>
* <span data-ttu-id="39093-172">Připojení (internet zalomení mezi klienty a Azure).</span><span class="sxs-lookup"><span data-stu-id="39093-172">Connectivity (internet break between your clients and Azure).</span></span>

<span data-ttu-id="39093-173">V obou případech havárie přírodních nebo syntetická způsobila problém.</span><span class="sxs-lookup"><span data-stu-id="39093-173">In both cases, a natural or man-made disaster caused the issue.</span></span> <span data-ttu-id="39093-174">Chcete-li tento problém obejít a ujistěte se, že může i dál posílat zprávy, můžete použít [spárovat obory názvů] [ paired namespaces] zpráv k odeslání na jiné místo, zatímco primární umístění se provádí v pořádku znovu povolit.</span><span class="sxs-lookup"><span data-stu-id="39093-174">To work around this and make sure that you can still send messages, you can use [paired namespaces][paired namespaces] to enable messages to be sent to a second location while the primary location is made healthy again.</span></span> <span data-ttu-id="39093-175">Další informace najdete v tématu [osvědčené postupy pro izolační aplikace proti výpadkům Service Bus a havárií][Best practices for insulating applications against Service Bus outages and disasters].</span><span class="sxs-lookup"><span data-stu-id="39093-175">For more information, see [Best practices for insulating applications against Service Bus outages and disasters][Best practices for insulating applications against Service Bus outages and disasters].</span></span>

## <a name="paired-namespaces"></a><span data-ttu-id="39093-176">Spárované obory názvů</span><span class="sxs-lookup"><span data-stu-id="39093-176">Paired namespaces</span></span>
<span data-ttu-id="39093-177">[Spárovat obory názvů] [ paired namespaces] funkce podporuje scénáře, ve kterém entity služby sběrnice nebo nasazení v rámci datového centra k dispozici.</span><span class="sxs-lookup"><span data-stu-id="39093-177">The [paired namespaces][paired namespaces] feature supports scenarios in which a Service Bus entity or deployment within a data center becomes unavailable.</span></span> <span data-ttu-id="39093-178">Pokud k této události dochází zřídka, distribuovaných systémů stále musí být připraveny pro zpracování nejhorší scénářích případů.</span><span class="sxs-lookup"><span data-stu-id="39093-178">While this event occurs infrequently, distributed systems still must be prepared to handle worst case scenarios.</span></span> <span data-ttu-id="39093-179">Obvykle tato událost se stane, protože některé elementu, na kterém závisí Service Bus dochází krátkodobé problém.</span><span class="sxs-lookup"><span data-stu-id="39093-179">Typically, this event happens because some element on which Service Bus depends is experiencing a short-term issue.</span></span> <span data-ttu-id="39093-180">K udržování dostupnosti aplikace během výpadku, Service Bus mohou uživatelé dva samostatné obory názvů, pokud možno v samostatných datových centrech hostitele jejich entit pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-180">To maintain application availability during an outage, Service Bus users can use two separate namespaces, preferably in separate data centers, to host their messaging entities.</span></span> <span data-ttu-id="39093-181">Zbývající část Tato část používá následující terminologií:</span><span class="sxs-lookup"><span data-stu-id="39093-181">The remainder of this section uses the following terminology:</span></span>

* <span data-ttu-id="39093-182">Primární obor názvů: obor názvů, pomocí kterého aplikace komunikuje pro odesílání a přijímat operace.</span><span class="sxs-lookup"><span data-stu-id="39093-182">Primary namespace: The namespace with which your application interacts, for send and receive operations.</span></span>
* <span data-ttu-id="39093-183">Sekundární obor názvů: obor názvů, který slouží jako záložní pro primární obor názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-183">Secondary namespace: The namespace that acts as a backup to the primary namespace.</span></span> <span data-ttu-id="39093-184">Aplikace logiky nekomunikuje s Tento obor názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-184">Application logic does not interact with this namespace.</span></span>
* <span data-ttu-id="39093-185">Převzetí služeb při selhání interval: množství času, tak, aby přijímal normální selhání, než aplikace přepíná z oboru názvů primární na sekundární obor názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-185">Failover interval: The amount of time to accept normal failures before the application switches from the primary namespace to the secondary namespace.</span></span>

<span data-ttu-id="39093-186">Spárovat obory názvů podporu *odeslat dostupnosti*.</span><span class="sxs-lookup"><span data-stu-id="39093-186">Paired namespaces support *send availability*.</span></span> <span data-ttu-id="39093-187">Modul Send dostupnosti zachovává umožňuje odesílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-187">Send availability preserves the ability to send messages.</span></span> <span data-ttu-id="39093-188">Pokud chcete používat odesílání dostupnosti, musí aplikace splňovat následující požadavky:</span><span class="sxs-lookup"><span data-stu-id="39093-188">To use send availability, your application must meet the following requirements:</span></span>

1. <span data-ttu-id="39093-189">Zprávy jsou pouze přijatých z primární oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-189">Messages are only received from the primary namespace.</span></span>
2. <span data-ttu-id="39093-190">Zprávy odeslané do dané fronty nebo téma dodány ve správném pořadí.</span><span class="sxs-lookup"><span data-stu-id="39093-190">Messages sent to a given queue or topic might arrive out of order.</span></span>
3. <span data-ttu-id="39093-191">Zprávy v rámci relace může být dodány ve správném pořadí.</span><span class="sxs-lookup"><span data-stu-id="39093-191">Messages within a session might arrive out of order.</span></span> <span data-ttu-id="39093-192">Toto je zalomení z normální funkce relací.</span><span class="sxs-lookup"><span data-stu-id="39093-192">This is a break from normal functionality of sessions.</span></span> <span data-ttu-id="39093-193">To znamená, že vaše aplikace používá relací logicky seskupovat zprávy.</span><span class="sxs-lookup"><span data-stu-id="39093-193">This means that your application uses sessions to logically group messages.</span></span>
4. <span data-ttu-id="39093-194">Stav relace je zachováno pouze na primární oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-194">Session state is only maintained on the primary namespace.</span></span>
5. <span data-ttu-id="39093-195">Primární fronty můžete uvést do režimu online a začít přijímat zprávy před sekundární fronty nabízí všechny zprávy ve frontě primární.</span><span class="sxs-lookup"><span data-stu-id="39093-195">The primary queue can come online and start accepting messages before the secondary queue delivers all messages into the primary queue.</span></span>

<span data-ttu-id="39093-196">Následující části popisují rozhraní API, jak jsou implementované rozhraní API a zobrazuje ukázkový kód, který používá funkci.</span><span class="sxs-lookup"><span data-stu-id="39093-196">The following sections discuss the APIs, how the APIs are implemented, and shows sample code that uses the feature.</span></span> <span data-ttu-id="39093-197">Všimněte si, že jsou fakturace důsledky spojené s touto funkcí.</span><span class="sxs-lookup"><span data-stu-id="39093-197">Note that there are billing implications associated with this feature.</span></span>

### <a name="the-messagingfactorypairnamespaceasync-api"></a><span data-ttu-id="39093-198">MessagingFactory.PairNamespaceAsync rozhraní API</span><span class="sxs-lookup"><span data-stu-id="39093-198">The MessagingFactory.PairNamespaceAsync API</span></span>
<span data-ttu-id="39093-199">Obsahuje funkci spárované obory názvů [PairNamespaceAsync] [ PairNamespaceAsync] metodu [Microsoft.ServiceBus.Messaging.MessagingFactory] [ Microsoft.ServiceBus.Messaging.MessagingFactory] třídy:</span><span class="sxs-lookup"><span data-stu-id="39093-199">The paired namespaces feature includes the [PairNamespaceAsync][PairNamespaceAsync] method on the [Microsoft.ServiceBus.Messaging.MessagingFactory][Microsoft.ServiceBus.Messaging.MessagingFactory] class:</span></span>

```csharp
public Task PairNamespaceAsync(PairedNamespaceOptions options);
```

<span data-ttu-id="39093-200">Po dokončení úlohy párování obor názvů je také dokončení a připravena k provedení akce pro libovolný [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], nebo [TopicClient] [ TopicClient] vytvořené pomocí [MessagingFactory] [ MessagingFactory] instance.</span><span class="sxs-lookup"><span data-stu-id="39093-200">When the task completes, the namespace pairing is also complete and ready to act upon for any [MessageReceiver][MessageReceiver], [QueueClient][QueueClient], or [TopicClient][TopicClient] created with the [MessagingFactory][MessagingFactory] instance.</span></span> <span data-ttu-id="39093-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] [ Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] je základní třídou pro různé typy párování, které jsou k dispozici [MessagingFactory] [ MessagingFactory] objektu.</span><span class="sxs-lookup"><span data-stu-id="39093-201">[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions][Microsoft.ServiceBus.Messaging.PairedNamespaceOptions] is the base class for the different types of pairing that are available with a [MessagingFactory][MessagingFactory] object.</span></span> <span data-ttu-id="39093-202">V současné době pouze odvozené třídy je jednu s názvem [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], který implementuje dostupnosti požadavky na odeslání.</span><span class="sxs-lookup"><span data-stu-id="39093-202">Currently, the only derived class is one named [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions], which implements the send availability requirements.</span></span> <span data-ttu-id="39093-203">[SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] obsahuje sadu konstruktory, které sestavení na sobě navzájem.</span><span class="sxs-lookup"><span data-stu-id="39093-203">[SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] has a set of constructors that build on each other.</span></span> <span data-ttu-id="39093-204">Prohlížení konstruktoru se většina parametry, můžete porozumět chování další konstruktory.</span><span class="sxs-lookup"><span data-stu-id="39093-204">Looking at the constructor with the most parameters, you can understand the behavior of the other constructors.</span></span>

```csharp
public SendAvailabilityPairedNamespaceOptions(
    NamespaceManager secondaryNamespaceManager,
    MessagingFactory messagingFactory,
    int backlogQueueCount,
    TimeSpan failoverInterval,
    bool enableSyphon)
```

<span data-ttu-id="39093-205">Tyto parametry mají následující významy:</span><span class="sxs-lookup"><span data-stu-id="39093-205">These parameters have the following meanings:</span></span>

* <span data-ttu-id="39093-206">*secondaryNamespaceManager*: inicializovali [NamespaceManager] [ NamespaceManager] instance pro sekundární obor názvů, který [PairNamespaceAsync] [ PairNamespaceAsync] metodu můžete použít k nastavení sekundární obor názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-206">*secondaryNamespaceManager*: An initialized [NamespaceManager][NamespaceManager] instance for the secondary namespace that the [PairNamespaceAsync][PairNamespaceAsync] method can use to set up the secondary namespace.</span></span> <span data-ttu-id="39093-207">Správce obor názvů se používá k získání seznamu front v oboru názvů a ujistěte se, že existují požadované nevyřízené položky fronty.</span><span class="sxs-lookup"><span data-stu-id="39093-207">The namespace manager is used to obtain the list of queues in the namespace and to make sure that the required backlog queues exist.</span></span> <span data-ttu-id="39093-208">Pokud tyto fronty nejsou k dispozici, jejich vytvoření.</span><span class="sxs-lookup"><span data-stu-id="39093-208">If those queues do not exist, they are created.</span></span> <span data-ttu-id="39093-209">[NamespaceManager] [ NamespaceManager] vyžaduje schopnost vytvářet token se **spravovat** deklarací identity.</span><span class="sxs-lookup"><span data-stu-id="39093-209">[NamespaceManager][NamespaceManager] requires the ability to create a token with the **Manage** claim.</span></span>
* <span data-ttu-id="39093-210">*messagingFactory*: [MessagingFactory] [ MessagingFactory] instance pro sekundární obor názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-210">*messagingFactory*: The [MessagingFactory][MessagingFactory] instance for the secondary namespace.</span></span> <span data-ttu-id="39093-211">[MessagingFactory] [ MessagingFactory] objekt se používá k odeslání a pokud [EnableSyphon] [ EnableSyphon] je nastavena na **true**, přijímat zprávy z front nevyřízených položek.</span><span class="sxs-lookup"><span data-stu-id="39093-211">The [MessagingFactory][MessagingFactory] object is used to send and, if the [EnableSyphon][EnableSyphon] property is set to **true**, receive messages from the backlog queues.</span></span>
* <span data-ttu-id="39093-212">*backlogQueueCount*: počet nevyřízených položek fronty pro vytvoření.</span><span class="sxs-lookup"><span data-stu-id="39093-212">*backlogQueueCount*: The number of backlog queues to create.</span></span> <span data-ttu-id="39093-213">Tato hodnota musí být alespoň 1.</span><span class="sxs-lookup"><span data-stu-id="39093-213">This value must be at least 1.</span></span> <span data-ttu-id="39093-214">Při odesílání zpráv k backlogu, jednu z těchto front náhodně vybere.</span><span class="sxs-lookup"><span data-stu-id="39093-214">When sending messages to the backlog, one of these queues is randomly chosen.</span></span> <span data-ttu-id="39093-215">Pokud nastavíte hodnotu na 1, můžete použít někdy tento pouze jedna fronta.</span><span class="sxs-lookup"><span data-stu-id="39093-215">If you set the value to 1, then only one queue can ever be used.</span></span> <span data-ttu-id="39093-216">Pokud k tomu dojde a jeden nevyřízené položky fronty generuje chyby, klient není schopna zkuste jinou nevyřízené položky fronty a odeslání vaší zprávy se nemusí podařit.</span><span class="sxs-lookup"><span data-stu-id="39093-216">When this happens and the one backlog queue generates errors, the client is not able to try a different backlog queue and may fail to send your message.</span></span> <span data-ttu-id="39093-217">Doporučujeme tuto hodnotu nastavíte na některé větší hodnotu a výchozí hodnotu 10.</span><span class="sxs-lookup"><span data-stu-id="39093-217">We recommend setting this value to some larger value and default the value to 10.</span></span> <span data-ttu-id="39093-218">Toto můžete změnit na hodnotu vyšší nebo nižší v závislosti na množství dat, které vaše aplikace odešle za den.</span><span class="sxs-lookup"><span data-stu-id="39093-218">You can change this to a higher or lower value depending on how much data your application sends per day.</span></span> <span data-ttu-id="39093-219">Každá fronta nevyřízené položky mohou být uloženy až 5 GB zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-219">Each backlog queue can hold up to 5 GB of messages.</span></span>
* <span data-ttu-id="39093-220">*failoverInterval*: množství času, během kterého bude přijímat chyb v oboru názvů primární před přepnutím jednu entitu do sekundární oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-220">*failoverInterval*: The amount of time during which you will accept failures on the primary namespace before switching any single entity over to the secondary namespace.</span></span> <span data-ttu-id="39093-221">Na základě entity entity dojde k převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="39093-221">Failovers occur on an entity-by-entity basis.</span></span> <span data-ttu-id="39093-222">Entity v jeden obor názvů často za provozu v různých uzlech v rámci služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="39093-222">Entities in a single namespace frequently live in different nodes within Service Bus.</span></span> <span data-ttu-id="39093-223">Selhání v jedné entity neznamená selhání v jiném.</span><span class="sxs-lookup"><span data-stu-id="39093-223">A failure in one entity does not imply a failure in another.</span></span> <span data-ttu-id="39093-224">Tuto hodnotu můžete nastavit [System.TimeSpan.Zero] [ System.TimeSpan.Zero] převzetí služeb při selhání na sekundární okamžitě po selhání vaše první, pouze dočasné.</span><span class="sxs-lookup"><span data-stu-id="39093-224">You can set this value to [System.TimeSpan.Zero][System.TimeSpan.Zero] to failover to the secondary immediately after your first, non-transient failure.</span></span> <span data-ttu-id="39093-225">Selhání, které aktivují časovač převzetí služeb při selhání jsou [MessagingException] [ MessagingException] ve kterém [IsTransient] [ IsTransient] vlastnost je nastavena hodnota false, nebo [System.TimeoutException][System.TimeoutException].</span><span class="sxs-lookup"><span data-stu-id="39093-225">Failures that trigger the failover timer are any [MessagingException][MessagingException] in which the [IsTransient][IsTransient] property is false, or a [System.TimeoutException][System.TimeoutException].</span></span> <span data-ttu-id="39093-226">Ostatní výjimky, jako například [UnauthorizedAccessException] [ UnauthorizedAccessException] nezpůsobí převzetí služeb při selhání, protože označují, že je klient nakonfigurován nesprávně.</span><span class="sxs-lookup"><span data-stu-id="39093-226">Other exceptions, such as [UnauthorizedAccessException][UnauthorizedAccessException] do not cause failover, because they indicate that the client is configured incorrectly.</span></span> <span data-ttu-id="39093-227">A [ServerBusyException] [ ServerBusyException] nemá příčina převzetí služeb při selhání protože správné vzor je 10 sekund čekání zprávu odešlete znovu.</span><span class="sxs-lookup"><span data-stu-id="39093-227">A [ServerBusyException][ServerBusyException] does not cause failover because the correct pattern is to wait 10 seconds, then send the message again.</span></span>
* <span data-ttu-id="39093-228">*enableSyphon*: Určuje, že tato konkrétní párování by také syphon zprávy z oboru názvů sekundární zpět do primární oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="39093-228">*enableSyphon*: Indicates that this particular pairing should also syphon messages from the secondary namespace back to the primary namespace.</span></span> <span data-ttu-id="39093-229">Obecně platí, nastavte tuto hodnotu na aplikace, které odesílají zprávy **false**; aplikace, které přijímají zprávy měli nastavit hodnotu **true**.</span><span class="sxs-lookup"><span data-stu-id="39093-229">In general, applications that send messages should set this value to **false**; applications that receive messages should set this value to **true**.</span></span> <span data-ttu-id="39093-230">Důvodem je, že často, existují méně příjemci zprávy než odesílatelé zpráv.</span><span class="sxs-lookup"><span data-stu-id="39093-230">The reason for this is that frequently, there are fewer message receivers than message senders.</span></span> <span data-ttu-id="39093-231">V závislosti na počet příjemců můžete mít jednu aplikaci instanci, zpracování činnosti Trativod.</span><span class="sxs-lookup"><span data-stu-id="39093-231">Depending on the number of receivers, you can choose to have a single application instance handle the syphon duties.</span></span> <span data-ttu-id="39093-232">Použití mnoha příjemci má fakturační důsledky pro každou frontu nevyřízených položek.</span><span class="sxs-lookup"><span data-stu-id="39093-232">Using many receivers has billing implications for each backlog queue.</span></span>

<span data-ttu-id="39093-233">Chcete-li použít kód, vytvořte primární [MessagingFactory] [ MessagingFactory] instance, sekundární [MessagingFactory] [ MessagingFactory] instance, sekundární [NamespaceManager] [ NamespaceManager] instance a [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instance.</span><span class="sxs-lookup"><span data-stu-id="39093-233">To use the code, create a primary [MessagingFactory][MessagingFactory] instance, a secondary [MessagingFactory][MessagingFactory] instance, a secondary [NamespaceManager][NamespaceManager] instance, and a [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="39093-234">Volání může být stejně jednoduché jako následující:</span><span class="sxs-lookup"><span data-stu-id="39093-234">The call can be as simple as the following:</span></span>

```csharp
SendAvailabilityPairedNamespaceOptions sendAvailabilityOptions = new SendAvailabilityPairedNamespaceOptions(secondaryNamespaceManager, secondary);
primary.PairNamespaceAsync(sendAvailabilityOptions).Wait();
```

<span data-ttu-id="39093-235">Když úloha vrácený [PairNamespaceAsync] [ PairNamespaceAsync] metoda dokončí, je všechno nastavené a připravené k použití.</span><span class="sxs-lookup"><span data-stu-id="39093-235">When the task returned by the [PairNamespaceAsync][PairNamespaceAsync] method completes, everything is set up and ready to use.</span></span> <span data-ttu-id="39093-236">Předtím, než se vrátí úlohu, pravděpodobně nebyly dokončeny, všechny potřebné pro spárování pracovat přímo práce na pozadí.</span><span class="sxs-lookup"><span data-stu-id="39093-236">Before the task is returned, you may not have completed all of the background work necessary for the pairing to work right.</span></span> <span data-ttu-id="39093-237">V důsledku toho by neměl spustit, odesílání zpráv, dokud vrátí úlohu.</span><span class="sxs-lookup"><span data-stu-id="39093-237">As a result, you should not start sending messages until the task returns.</span></span> <span data-ttu-id="39093-238">Pokud došlo k jeho selhání, třeba chybná přihlašovací údaje nebo selhání vytvoření nevyřízených položek fronty, budou tyto výjimky vyvolány po dokončení úlohy.</span><span class="sxs-lookup"><span data-stu-id="39093-238">If any failures occurred, such as bad credentials, or failure to create the backlog queues, those exceptions will be thrown once the task completes.</span></span> <span data-ttu-id="39093-239">Jakmile vrátí úlohu, ověřte, zda byly fronty najít nebo vytvořit tak, že prověří [BacklogQueueCount] [ BacklogQueueCount] vlastnost na vaše [SendAvailabilityPairedNamespaceOptions] [ SendAvailabilityPairedNamespaceOptions] instance.</span><span class="sxs-lookup"><span data-stu-id="39093-239">Once the task returns, verify that the queues were found or created by examining the [BacklogQueueCount][BacklogQueueCount] property on your [SendAvailabilityPairedNamespaceOptions][SendAvailabilityPairedNamespaceOptions] instance.</span></span> <span data-ttu-id="39093-240">Pro předchozí kód, který operaci vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="39093-240">For the preceding code, that operation appears as follows:</span></span>

```csharp
if (sendAvailabilityOptions.BacklogQueueCount < 1)
{
    // Handle case where no queues were created.
}
```

## <a name="next-steps"></a><span data-ttu-id="39093-241">Další kroky</span><span class="sxs-lookup"><span data-stu-id="39093-241">Next steps</span></span>
<span data-ttu-id="39093-242">Teď, když jste se naučili základy asynchronního zasílání zpráv ve sběrnici Service Bus, přečtěte si další informace o [spárovat obory názvů][paired namespaces].</span><span class="sxs-lookup"><span data-stu-id="39093-242">Now that you've learned the basics of asynchronous messaging in Service Bus, read more details about [paired namespaces][paired namespaces].</span></span>

[ServerBusyException]: /dotnet/api/microsoft.servicebus.messaging.serverbusyexception
[System.TimeoutException]: https://msdn.microsoft.com/library/system.timeoutexception.aspx
[MessagingException]: /dotnet/api/microsoft.servicebus.messaging.messagingexception
[Best practices for insulating applications against Service Bus outages and disasters]: service-bus-outages-disasters.md
[Microsoft.ServiceBus.Messaging.MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[MessageReceiver]: /dotnet/api/microsoft.servicebus.messaging.messagereceiver
[QueueClient]: /dotnet/api/microsoft.servicebus.messaging.queueclient
[TopicClient]: /dotnet/api/microsoft.servicebus.messaging.topicclient
[Microsoft.ServiceBus.Messaging.PairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.pairednamespaceoptions
[MessagingFactory]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory
[SendAvailabilityPairedNamespaceOptions]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions
[NamespaceManager]: /dotnet/api/microsoft.servicebus.namespacemanager
[PairNamespaceAsync]: /dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_PairNamespaceAsync_Microsoft_ServiceBus_Messaging_PairedNamespaceOptions_
[EnableSyphon]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_EnableSyphon
[System.TimeSpan.Zero]: https://msdn.microsoft.com/library/system.timespan.zero.aspx
[IsTransient]: /dotnet/api/microsoft.servicebus.messaging.messagingexception#Microsoft_ServiceBus_Messaging_MessagingException_IsTransient
[UnauthorizedAccessException]: https://msdn.microsoft.com/library/system.unauthorizedaccessexception.aspx
[BacklogQueueCount]: /dotnet/api/microsoft.servicebus.messaging.sendavailabilitypairednamespaceoptions?redirectedfrom=MSDN#Microsoft_ServiceBus_Messaging_SendAvailabilityPairedNamespaceOptions_BacklogQueueCount
[paired namespaces]: service-bus-paired-namespaces.md

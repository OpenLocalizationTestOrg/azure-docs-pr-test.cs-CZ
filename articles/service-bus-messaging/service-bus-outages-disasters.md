---
title: "Izolační aplikace Azure Service Bus proti výpadkům a havárií | Microsoft Docs"
description: "Popisuje postupy, pomocí nichž můžete použít k ochraně aplikací proti potenciální výpadek služby Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: tysonn
ms.assetid: fd9fa8ab-f4c4-43f7-974f-c876df1614d4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/12/2017
ms.author: sethm
ms.openlocfilehash: bc84dbe5c26a834b2cff5f71ba5f541e94ba0b38
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="best-practices-for-insulating-applications-against-service-bus-outages-and-disasters"></a><span data-ttu-id="04a0a-103">Osvědčené postupy pro izolační aplikace proti výpadkům Service Bus a havárií</span><span class="sxs-lookup"><span data-stu-id="04a0a-103">Best practices for insulating applications against Service Bus outages and disasters</span></span>
<span data-ttu-id="04a0a-104">Kritické aplikace musí fungovat nepřetržitě, ani za přítomnosti neplánované výpadky nebo havárie.</span><span class="sxs-lookup"><span data-stu-id="04a0a-104">Mission-critical applications must operate continuously, even in the presence of unplanned outages or disasters.</span></span> <span data-ttu-id="04a0a-105">Toto téma popisuje postupy, pomocí nichž můžete použít k ochraně aplikací Service Bus proti potenciální výpadek služby nebo po havárii.</span><span class="sxs-lookup"><span data-stu-id="04a0a-105">This topic describes techniques you can use to protect Service Bus applications against a potential service outage or disaster.</span></span>

<span data-ttu-id="04a0a-106">Výpadek je definován jako dočasné nedostupnosti Azure Service Bus.</span><span class="sxs-lookup"><span data-stu-id="04a0a-106">An outage is defined as the temporary unavailability of Azure Service Bus.</span></span> <span data-ttu-id="04a0a-107">Se výpadek může ovlivnit některé součásti Service Bus, jako je zasílání zpráv úložiště nebo i celého datového centra.</span><span class="sxs-lookup"><span data-stu-id="04a0a-107">The outage can affect some components of Service Bus, such as a messaging store, or even the entire datacenter.</span></span> <span data-ttu-id="04a0a-108">Po napravení problému, Service Bus opět k dispozici.</span><span class="sxs-lookup"><span data-stu-id="04a0a-108">After the problem has been fixed, Service Bus becomes available again.</span></span> <span data-ttu-id="04a0a-109">Výpadek obvykle nezpůsobí ztrátě zpráv nebo jiná data.</span><span class="sxs-lookup"><span data-stu-id="04a0a-109">Typically, an outage does not cause loss of messages or other data.</span></span> <span data-ttu-id="04a0a-110">Je například selhání součásti nedostupnost konkrétní úložišti pro přenos zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-110">An example of a component failure is the unavailability of a particular messaging store.</span></span> <span data-ttu-id="04a0a-111">Příkladem výpadku celou datacenter je výpadku napájení datovém centru nebo vadný datacenter síťový přepínač.</span><span class="sxs-lookup"><span data-stu-id="04a0a-111">An example of a datacenter-wide outage is a power failure of the datacenter, or a faulty datacenter network switch.</span></span> <span data-ttu-id="04a0a-112">Výpadek může trvat několik minut na několik dní.</span><span class="sxs-lookup"><span data-stu-id="04a0a-112">An outage can last from a few minutes to a few days.</span></span>

<span data-ttu-id="04a0a-113">Havárie je definován jako trvalé ztrátě jednotky škálování služby Service Bus nebo datacenter.</span><span class="sxs-lookup"><span data-stu-id="04a0a-113">A disaster is defined as the permanent loss of a Service Bus scale unit or datacenter.</span></span> <span data-ttu-id="04a0a-114">Datacentru může nebo nemusí opět k dispozici.</span><span class="sxs-lookup"><span data-stu-id="04a0a-114">The datacenter may or may not become available again.</span></span> <span data-ttu-id="04a0a-115">Havárie obvykle způsobí ztrátu některé nebo všechny zprávy nebo jiná data.</span><span class="sxs-lookup"><span data-stu-id="04a0a-115">Typically a disaster causes loss of some or all messages or other data.</span></span> <span data-ttu-id="04a0a-116">Příklady havárie se ještě efektivněji, zahlcení nebo zemětřesení.</span><span class="sxs-lookup"><span data-stu-id="04a0a-116">Examples of disasters are fire, flooding, or earthquake.</span></span>

## <a name="current-architecture"></a><span data-ttu-id="04a0a-117">Aktuální architektura</span><span class="sxs-lookup"><span data-stu-id="04a0a-117">Current architecture</span></span>
<span data-ttu-id="04a0a-118">Service Bus používá několik úložišť pro přenos zpráv k uložení zpráv, které jsou odesílány do fronty nebo témata.</span><span class="sxs-lookup"><span data-stu-id="04a0a-118">Service Bus uses multiple messaging stores to store messages that are sent to queues or topics.</span></span> <span data-ttu-id="04a0a-119">Bez oddílů fronta nebo téma je přiřazený k jedné úložišti pro přenos zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-119">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="04a0a-120">Pokud toto úložiště zasílání zpráv není k dispozici, všechny operace v tomto fronta nebo téma se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="04a0a-120">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span>

<span data-ttu-id="04a0a-121">Všechny služby Service Bus entit pro zasílání zpráv (fronty, témata, předávání) se nacházejí v oboru názvů služby, který je přidružen k datacentru.</span><span class="sxs-lookup"><span data-stu-id="04a0a-121">All Service Bus messaging entities (queues, topics, relays) reside in a service namespace, which is affiliated with a datacenter.</span></span> <span data-ttu-id="04a0a-122">Service Bus neumožňuje automatické geografická replikace dat, k tomu ani obor názvů rozložit několik datových center.</span><span class="sxs-lookup"><span data-stu-id="04a0a-122">Service Bus does not enable automatic geo-replication of data, nor does it allow a namespace to span multiple datacenters.</span></span>

## <a name="protecting-against-acs-outages"></a><span data-ttu-id="04a0a-123">Ochrana proti výpadkům služby ACS</span><span class="sxs-lookup"><span data-stu-id="04a0a-123">Protecting against ACS outages</span></span>
<span data-ttu-id="04a0a-124">Pokud používáte přihlašovací údaje služby ACS a služby ACS není k dispozici, klienti už můžou získat tokeny.</span><span class="sxs-lookup"><span data-stu-id="04a0a-124">If you are using ACS credentials, and ACS becomes unavailable, clients can no longer obtain tokens.</span></span> <span data-ttu-id="04a0a-125">Klienti, kteří mají token v době, kdy ACS ocitne mimo provoz můžete nadále používat Service Bus, dokud nevyprší platnost tokenů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-125">Clients that have a token at the time ACS goes down can continue to use Service Bus until the tokens expire.</span></span> <span data-ttu-id="04a0a-126">Výchozí doba života tokenu je 3 hodiny.</span><span class="sxs-lookup"><span data-stu-id="04a0a-126">The default token lifetime is 3 hours.</span></span>

<span data-ttu-id="04a0a-127">Chcete-li chránit proti výpadkům služby ACS, použijte tokeny sdíleného přístupového podpisu (SAS).</span><span class="sxs-lookup"><span data-stu-id="04a0a-127">To protect against ACS outages, use Shared Access Signature (SAS) tokens.</span></span> <span data-ttu-id="04a0a-128">V tomto případě klient se ověří přímo službou Service Bus podepsáním samoobslužné minted token s tajným klíčem.</span><span class="sxs-lookup"><span data-stu-id="04a0a-128">In this case, the client authenticates directly with Service Bus by signing a self-minted token with a secret key.</span></span> <span data-ttu-id="04a0a-129">Volání služby ACS se už nevyžadují.</span><span class="sxs-lookup"><span data-stu-id="04a0a-129">Calls to ACS are no longer required.</span></span> <span data-ttu-id="04a0a-130">Další informace o tokeny SAS najdete v tématu [ověření sběrnice][Service Bus authentication].</span><span class="sxs-lookup"><span data-stu-id="04a0a-130">For more information about SAS tokens, see [Service Bus authentication][Service Bus authentication].</span></span>

## <a name="protecting-queues-and-topics-against-messaging-store-failures"></a><span data-ttu-id="04a0a-131">Ochrana fronty a témata proti selhání úložiště pro zasílání zpráv</span><span class="sxs-lookup"><span data-stu-id="04a0a-131">Protecting queues and topics against messaging store failures</span></span>
<span data-ttu-id="04a0a-132">Bez oddílů fronta nebo téma je přiřazený k jedné úložišti pro přenos zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-132">A non-partitioned queue or topic is assigned to one messaging store.</span></span> <span data-ttu-id="04a0a-133">Pokud toto úložiště zasílání zpráv není k dispozici, všechny operace v tomto fronta nebo téma se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="04a0a-133">If this messaging store is unavailable, all operations on that queue or topic will fail.</span></span> <span data-ttu-id="04a0a-134">Oddílů fronty, na druhé straně, se skládá z více fragmentů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-134">A partitioned queue, on the other hand, consists of multiple fragments.</span></span> <span data-ttu-id="04a0a-135">Každý fragment je uložen v jiném úložišti zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-135">Each fragment is stored in a different messaging store.</span></span> <span data-ttu-id="04a0a-136">Pro odeslání zprávy do oddílů fronta nebo téma sběrnice přiřadí zpráva jedním z fragmentů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-136">When a message is sent to a partitioned queue or topic, Service Bus assigns the message to one of the fragments.</span></span> <span data-ttu-id="04a0a-137">Pokud odpovídající úložišti pro přenos zpráv není k dispozici, Service Bus zapíše zprávu do různých fragment, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="04a0a-137">If the corresponding messaging store is unavailable, Service Bus writes the message to a different fragment, if possible.</span></span> <span data-ttu-id="04a0a-138">Další informace o dělené entity najdete v tématu [segmentované entity zasílání zpráv][Partitioned messaging entities].</span><span class="sxs-lookup"><span data-stu-id="04a0a-138">For more information about partitioned entities, see [Partitioned messaging entities][Partitioned messaging entities].</span></span>

## <a name="protecting-against-datacenter-outages-or-disasters"></a><span data-ttu-id="04a0a-139">Ochrana proti výpadkům datacenter nebo havárie</span><span class="sxs-lookup"><span data-stu-id="04a0a-139">Protecting against datacenter outages or disasters</span></span>
<span data-ttu-id="04a0a-140">Povolit pro převzetí služeb při selhání dvou Datacenter, můžete vytvořit obor názvů služby Service Bus v každé datové centrum.</span><span class="sxs-lookup"><span data-stu-id="04a0a-140">To allow for a failover between two datacenters, you can create a Service Bus service namespace in each datacenter.</span></span> <span data-ttu-id="04a0a-141">Například oboru názvů služby Service Bus **contosoPrimary.servicebus.windows.net** může nacházet v oblasti USA, Severní a střední a **contosoSecondary.servicebus.windows.net**může nacházet v oblasti USA – jih a střední.</span><span class="sxs-lookup"><span data-stu-id="04a0a-141">For example, the Service Bus service namespace **contosoPrimary.servicebus.windows.net** might be located in the United States North/Central region, and **contosoSecondary.servicebus.windows.net** might be located in the US South/Central region.</span></span> <span data-ttu-id="04a0a-142">Pokud Service Bus entity pro zasílání zpráv musí zůstat přístupný v případě výpadku datového centra, můžete vytvořit dané entity v oba obory názvů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-142">If a Service Bus messaging entity must remain accessible in the presence of a datacenter outage, you can create that entity in both namespaces.</span></span>

<span data-ttu-id="04a0a-143">Další informace najdete v části "Service Bus v rámci datového centra Azure selhání" v [asynchronní vzory a vysoká dostupnost pro zasílání zpráv][Asynchronous messaging patterns and high availability].</span><span class="sxs-lookup"><span data-stu-id="04a0a-143">For more information, see the "Failure of Service Bus within an Azure datacenter" section in [Asynchronous messaging patterns and high availability][Asynchronous messaging patterns and high availability].</span></span>

## <a name="protecting-relay-endpoints-against-datacenter-outages-or-disasters"></a><span data-ttu-id="04a0a-144">Ochranu koncových bodů předávání proti výpadkům datacenter nebo havárie</span><span class="sxs-lookup"><span data-stu-id="04a0a-144">Protecting relay endpoints against datacenter outages or disasters</span></span>
<span data-ttu-id="04a0a-145">Geografická replikace koncových bodů předávání umožňuje služba, která zveřejňuje koncový bod předávání být dostupná v případě výpadku služby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="04a0a-145">Geo-replication of relay endpoints allows a service that exposes a relay endpoint to be reachable in the presence of Service Bus outages.</span></span> <span data-ttu-id="04a0a-146">K dosažení geografická replikace, musíte službu vytvořit dva koncové body předávání v různých oborech názvů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-146">To achieve geo-replication, the service must create two relay endpoints in different namespaces.</span></span> <span data-ttu-id="04a0a-147">Obory názvů se musí nacházet v různých datových centrech a dva koncové body musí mít odlišné názvy.</span><span class="sxs-lookup"><span data-stu-id="04a0a-147">The namespaces must reside in different datacenters and the two endpoints must have different names.</span></span> <span data-ttu-id="04a0a-148">Například můžete v části dostupný primární koncový bod **contosoPrimary.servicebus.windows.net/myPrimaryService**při jeho protějšku sekundární dostupný v části **contosoSecondary.servicebus.windows.net /mySecondaryService**.</span><span class="sxs-lookup"><span data-stu-id="04a0a-148">For example, a primary endpoint can be reached under **contosoPrimary.servicebus.windows.net/myPrimaryService**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/mySecondaryService**.</span></span>

<span data-ttu-id="04a0a-149">Služba pak naslouchá na obou koncových bodů a klient vyvolat službu přes koncový bod.</span><span class="sxs-lookup"><span data-stu-id="04a0a-149">The service then listens on both endpoints, and a client can invoke the service via either endpoint.</span></span> <span data-ttu-id="04a0a-150">Klientská aplikace náhodně vybere jeden z předávání jako primární koncový bod a odešle požadavku aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="04a0a-150">A client application randomly picks one of the relays as the primary endpoint, and sends its request to the active endpoint.</span></span> <span data-ttu-id="04a0a-151">Pokud operace selže s kódem chyby, toto selhání naznačuje, že předávání přes koncový bod není k dispozici.</span><span class="sxs-lookup"><span data-stu-id="04a0a-151">If the operation fails with an error code, this failure indicates that the relay endpoint is not available.</span></span> <span data-ttu-id="04a0a-152">Aplikace se otevře kanál ke koncovému bodu zálohy a znovu vydá požadavek.</span><span class="sxs-lookup"><span data-stu-id="04a0a-152">The application opens a channel to the backup endpoint and reissues the request.</span></span> <span data-ttu-id="04a0a-153">V tomto bodě zálohování koncové body a aktivní přepínač role: klientská aplikace považovat staré aktivní koncový bod nový koncový bod zálohování a původní zálohování koncový bod jako nové aktivní koncový bod.</span><span class="sxs-lookup"><span data-stu-id="04a0a-153">At that point the active and the backup endpoints switch roles: the client application considers the old active endpoint to be the new backup endpoint, and the old backup endpoint to be the new active endpoint.</span></span> <span data-ttu-id="04a0a-154">Pokud obě odeslat operace selže, zůstanou nezměněny role dvě entity a vrátí se chyba.</span><span class="sxs-lookup"><span data-stu-id="04a0a-154">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="04a0a-155">[Geografická replikace s sběrnice zpráv přes předávací službu] [ Geo-replication with Service Bus relayed Messages] ukázka ukazuje, jak replikovat předávací službu.</span><span class="sxs-lookup"><span data-stu-id="04a0a-155">The [Geo-replication with Service Bus relayed messages][Geo-replication with Service Bus relayed Messages] sample demonstrates how to replicate relays.</span></span>

## <a name="protecting-queues-and-topics-against-datacenter-outages-or-disasters"></a><span data-ttu-id="04a0a-156">Ochrana fronty a témata proti výpadkům datacenter nebo havárie</span><span class="sxs-lookup"><span data-stu-id="04a0a-156">Protecting queues and topics against datacenter outages or disasters</span></span>
<span data-ttu-id="04a0a-157">Zajistit odolnost proti výpadkům datového centra při pomocí zprostředkovaného zasílání zpráv Service Bus podporuje dva přístupy: *active* a *pasivní* replikace.</span><span class="sxs-lookup"><span data-stu-id="04a0a-157">To achieve resilience against datacenter outages when using brokered messaging, Service Bus supports two approaches: *active* and *passive* replication.</span></span> <span data-ttu-id="04a0a-158">Pro každý přístup Pokud se daný fronta nebo téma musí zůstat přístupný v případě výpadku datového centra můžete vytvořit ji v oba obory názvů.</span><span class="sxs-lookup"><span data-stu-id="04a0a-158">For each approach, if a given queue or topic must remain accessible in the presence of a datacenter outage, you can create it in both namespaces.</span></span> <span data-ttu-id="04a0a-159">Obě entit může mít stejný název.</span><span class="sxs-lookup"><span data-stu-id="04a0a-159">Both entities can have the same name.</span></span> <span data-ttu-id="04a0a-160">Například dostupný primární fronty pod **contosoPrimary.servicebus.windows.net/myQueue**při jeho protějšku sekundární dostupný v části **contosoSecondary.servicebus.windows.net/myQueue**.</span><span class="sxs-lookup"><span data-stu-id="04a0a-160">For example, a primary queue can be reached under **contosoPrimary.servicebus.windows.net/myQueue**, while its secondary counterpart can be reached under **contosoSecondary.servicebus.windows.net/myQueue**.</span></span>

<span data-ttu-id="04a0a-161">Pokud aplikace nevyžaduje komunikaci trvalé odesílatele k příjemce, můžete aplikaci implementovat trvalé fronty klienta předchází se tak ztrátě zpráv a pro stínění odesílatel z jakékoli přechodné chyby Service Bus.</span><span class="sxs-lookup"><span data-stu-id="04a0a-161">If the application does not require permanent sender-to-receiver communication, the application can implement a durable client-side queue to prevent message loss and to shield the sender from any transient Service Bus errors.</span></span>

## <a name="active-replication"></a><span data-ttu-id="04a0a-162">Replikace služby Active</span><span class="sxs-lookup"><span data-stu-id="04a0a-162">Active replication</span></span>
<span data-ttu-id="04a0a-163">Replikace služby Active používá entity v oba obory názvů pro všechny operace.</span><span class="sxs-lookup"><span data-stu-id="04a0a-163">Active replication uses entities in both namespaces for every operation.</span></span> <span data-ttu-id="04a0a-164">Libovolného klienta, který odešle zprávu odešle dvě kopie stejné zprávy.</span><span class="sxs-lookup"><span data-stu-id="04a0a-164">Any client that sends a message sends two copies of the same message.</span></span> <span data-ttu-id="04a0a-165">První kopie se odesílá do primární entity (například **contosoPrimary.servicebus.windows.net/sales**), a druhé kopie zprávy jsou odeslána do sekundární entitou (například  **contosoSecondary.servicebus.windows.net/sales**).</span><span class="sxs-lookup"><span data-stu-id="04a0a-165">The first copy is sent to the primary entity (for example, **contosoPrimary.servicebus.windows.net/sales**), and the second copy of the message is sent to the secondary entity (for example, **contosoSecondary.servicebus.windows.net/sales**).</span></span>

<span data-ttu-id="04a0a-166">Klient obdrží z obou front zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-166">A client receives messages from both queues.</span></span> <span data-ttu-id="04a0a-167">Příjemce procesy první kopie zprávy, a druhé kopie potlačeno.</span><span class="sxs-lookup"><span data-stu-id="04a0a-167">The receiver processes the first copy of a message, and the second copy is suppressed.</span></span> <span data-ttu-id="04a0a-168">K potlačení duplicitních zpráv, musíte označit odesílatel každou zprávu s jedinečným identifikátorem.</span><span class="sxs-lookup"><span data-stu-id="04a0a-168">To suppress duplicate messages, the sender must tag each message with a unique identifier.</span></span> <span data-ttu-id="04a0a-169">Obě kopie zprávy musí být označené se stejným identifikátorem.</span><span class="sxs-lookup"><span data-stu-id="04a0a-169">Both copies of the message must be tagged with the same identifier.</span></span> <span data-ttu-id="04a0a-170">Můžete použít [BrokeredMessage.MessageId] [ BrokeredMessage.MessageId] nebo [BrokeredMessage.Label] [ BrokeredMessage.Label] vlastnosti nebo vlastní vlastnost k označení zprávy.</span><span class="sxs-lookup"><span data-stu-id="04a0a-170">You can use the [BrokeredMessage.MessageId][BrokeredMessage.MessageId] or [BrokeredMessage.Label][BrokeredMessage.Label] properties, or a custom property to tag the message.</span></span> <span data-ttu-id="04a0a-171">Příjemce musí zachovat seznam zpráv, které již přijal.</span><span class="sxs-lookup"><span data-stu-id="04a0a-171">The receiver must maintain a list of messages that it has already received.</span></span>

<span data-ttu-id="04a0a-172">[Geografická replikace se Service Bus zprostředkované zprávy] [ Geo-replication with Service Bus Brokered Messages] příklad znázorňuje active replikaci entity pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-172">The [Geo-replication with Service Bus Brokered Messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates active replication of messaging entities.</span></span>

> [!NOTE]
> <span data-ttu-id="04a0a-173">Replikace služby active přístup zdvojnásobí počet operací, proto tento přístup může vést k vyšší náklady.</span><span class="sxs-lookup"><span data-stu-id="04a0a-173">The active replication approach doubles the number of operations, therefore this approach can lead to higher cost.</span></span>
> 
> 

## <a name="passive-replication"></a><span data-ttu-id="04a0a-174">Pasivní replikace</span><span class="sxs-lookup"><span data-stu-id="04a0a-174">Passive replication</span></span>
<span data-ttu-id="04a0a-175">V případě selhání bez pasivní replikace používá jenom jeden dva entit pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-175">In the fault-free case, passive replication uses only one of the two messaging entities.</span></span> <span data-ttu-id="04a0a-176">Klient odešle zprávu do active entity.</span><span class="sxs-lookup"><span data-stu-id="04a0a-176">A client sends the message to the active entity.</span></span> <span data-ttu-id="04a0a-177">Pokud operace u active entity selže s kódem chyby, která určuje, že datové centrum, který je hostitelem aktivní entita může být k dispozici, klient odešle kopii zprávy do zálohování entity.</span><span class="sxs-lookup"><span data-stu-id="04a0a-177">If the operation on the active entity fails with an error code that indicates the datacenter that hosts the active entity might be unavailable, the client sends a copy of the message to the backup entity.</span></span> <span data-ttu-id="04a0a-178">V tomto bodě aktivní a entity zálohování přepínač role: odesílání klienta považuje staré active entity, která má být nové entity zálohování a původní zálohování entita je nové aktivní entity.</span><span class="sxs-lookup"><span data-stu-id="04a0a-178">At that point the active and the backup entities switch roles: the sending client considers the old active entity to be the new backup entity, and the old backup entity is the new active entity.</span></span> <span data-ttu-id="04a0a-179">Pokud obě odeslat operace selže, zůstanou nezměněny role dvě entity a vrátí se chyba.</span><span class="sxs-lookup"><span data-stu-id="04a0a-179">If both send operations fail, the roles of the two entities remain unchanged and an error is returned.</span></span>

<span data-ttu-id="04a0a-180">Klient obdrží z obou front zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-180">A client receives messages from both queues.</span></span> <span data-ttu-id="04a0a-181">Protože je pravděpodobné, že příjemce obdrží dvě kopie stejné zprávy, musí příjemce potlačení duplicitních zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-181">Because there is a chance that the receiver receives two copies of the same message, the receiver must suppress duplicate messages.</span></span> <span data-ttu-id="04a0a-182">Duplicitní položky můžete potlačit stejným způsobem, jak je popsáno pro replikace služby active.</span><span class="sxs-lookup"><span data-stu-id="04a0a-182">You can suppress duplicates in the same way as described for active replication.</span></span>

<span data-ttu-id="04a0a-183">Obecně platí je levnější než replikace služby active pasivní replikace, protože ve většině případů je prováděna pouze jednu operaci.</span><span class="sxs-lookup"><span data-stu-id="04a0a-183">In general, passive replication is more economical than active replication because in most cases only one operation is performed.</span></span> <span data-ttu-id="04a0a-184">Latence, propustnosti a náklady na peněžní totožné s nereplikované scénář.</span><span class="sxs-lookup"><span data-stu-id="04a0a-184">Latency, throughput, and monetary cost are identical to the non-replicated scenario.</span></span>

<span data-ttu-id="04a0a-185">Při použití pasivní replikace, v následujících scénářích zprávy můžou ke ztrátě nebo přijímat dvakrát:</span><span class="sxs-lookup"><span data-stu-id="04a0a-185">When using passive replication, in the following scenarios messages can be lost or received twice:</span></span>

* <span data-ttu-id="04a0a-186">**Zpráva zpoždění nebo ztrátě**: předpokládají, že odesílatel zprávu m1 úspěšně odeslán do primární fronty, a pak nedostupný fronty než příjemce obdrží m1.</span><span class="sxs-lookup"><span data-stu-id="04a0a-186">**Message delay or loss**: Assume that the sender successfully sent a message m1 to the primary queue, and then the queue becomes unavailable before the receiver receives m1.</span></span> <span data-ttu-id="04a0a-187">Odesílatel odešle následnou zprávu m2 sekundární fronty.</span><span class="sxs-lookup"><span data-stu-id="04a0a-187">The sender sends a subsequent message m2 to the secondary queue.</span></span> <span data-ttu-id="04a0a-188">Pokud primární fronta je dočasně nedostupný, obdrží příjemce m1 po fronty opět k dispozici.</span><span class="sxs-lookup"><span data-stu-id="04a0a-188">If the primary queue is temporarily unavailable, the receiver receives m1 after the queue becomes available again.</span></span> <span data-ttu-id="04a0a-189">V případě havárie příjemce obdržet nikdy m1.</span><span class="sxs-lookup"><span data-stu-id="04a0a-189">In case of a disaster, the receiver may never receive m1.</span></span>
* <span data-ttu-id="04a0a-190">**Duplicitní příjem**: předpokládá, že odesílatel odešle zprávu m do primární fronty.</span><span class="sxs-lookup"><span data-stu-id="04a0a-190">**Duplicate reception**: Assume that the sender sends a message m to the primary queue.</span></span> <span data-ttu-id="04a0a-191">Service Bus úspěšně zpracuje m, ale selže k odeslání odpovědi.</span><span class="sxs-lookup"><span data-stu-id="04a0a-191">Service Bus successfully processes m but fails to send a response.</span></span> <span data-ttu-id="04a0a-192">Po operaci odeslání vypršení časového limitu, odesílatel odešle identické kopii m sekundární fronty.</span><span class="sxs-lookup"><span data-stu-id="04a0a-192">After the send operation times out, the sender sends an identical copy of m to the secondary queue.</span></span> <span data-ttu-id="04a0a-193">Pokud je příjemce schopný přijímat první kopii m, než bude k dispozici primární fronty, příjemce obdrží obě kopie m přibližně ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="04a0a-193">If the receiver is able to receive the first copy of m before the primary queue becomes unavailable, the receiver receives both copies of m at approximately the same time.</span></span> <span data-ttu-id="04a0a-194">Pokud příjemce není schopný přijímat první kopii m, než bude k dispozici primární fronty, nejprve obdrží druhé kopie m příjemce, ale pak obdrží druhé kopie m, když primární fronty je dostupná.</span><span class="sxs-lookup"><span data-stu-id="04a0a-194">If the receiver is not able to receive the first copy of m before the primary queue becomes unavailable, the receiver initially receives only the second copy of m, but then receives a second copy of m when the primary queue becomes available.</span></span>

<span data-ttu-id="04a0a-195">[Geografická replikace se Service Bus zprostředkované zprávy] [ Geo-replication with Service Bus Brokered Messages] příklad znázorňuje pasivní replikaci entity pro zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="04a0a-195">The [Geo-replication with Service Bus brokered messages][Geo-replication with Service Bus Brokered Messages] sample demonstrates passive replication of messaging entities.</span></span>

## <a name="next-steps"></a><span data-ttu-id="04a0a-196">Další kroky</span><span class="sxs-lookup"><span data-stu-id="04a0a-196">Next steps</span></span>
<span data-ttu-id="04a0a-197">Další informace o zotavení po havárii, najdete v těchto článcích:</span><span class="sxs-lookup"><span data-stu-id="04a0a-197">To learn more about disaster recovery, see these articles:</span></span>

* <span data-ttu-id="04a0a-198">[Kontinuita podnikových procesů Azure SQL Database][Azure SQL Database Business Continuity]</span><span class="sxs-lookup"><span data-stu-id="04a0a-198">[Azure SQL Database Business Continuity][Azure SQL Database Business Continuity]</span></span>
* <span data-ttu-id="04a0a-199">[Návrh odolný aplikací pro Azure.][Azure resiliency technical guidance]</span><span class="sxs-lookup"><span data-stu-id="04a0a-199">[Designing resilient applications for Azure][Azure resiliency technical guidance]</span></span>

[Service Bus Authentication]: service-bus-authentication-and-authorization.md
[Partitioned messaging entities]: service-bus-partitioning.md
[Asynchronous messaging patterns and high availability]: service-bus-async-messaging.md#failure-of-service-bus-within-an-azure-datacenter
[Geo-replication with Service Bus Relayed Messages]: http://code.msdn.microsoft.com/Geo-replication-with-16dbfecd
[BrokeredMessage.MessageId]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_MessageId
[BrokeredMessage.Label]: /dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label
[Geo-replication with Service Bus Brokered Messages]: http://code.msdn.microsoft.com/Geo-replication-with-f5688664
[Azure SQL Database Business Continuity]: ../sql-database/sql-database-business-continuity.md
[Azure resiliency technical guidance]: /azure/architecture/resiliency

---
title: "Vytvoření aplikace, které používají témata a předplatné Azure Service Bus | Microsoft Docs"
description: "Úvod k publikování-přihlášení k odběru možnosti, které nabízí témat a odběrů Service Bus."
services: service-bus-messaging
documentationcenter: na
author: sethmanheim
manager: timlt
editor: 
ms.assetid: a48fc9b0-b7b0-464e-8187-a517bf8b4eb4
ms.service: service-bus-messaging
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: na
ms.date: 04/07/2017
ms.author: sethm
ms.openlocfilehash: eb01120ce9578f716e5381c107faa93f0b36e358
ms.sourcegitcommit: 50e23e8d3b1148ae2d36dad3167936b4e52c8a23
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/18/2017
---
# <a name="create-applications-that-use-service-bus-topics-and-subscriptions"></a><span data-ttu-id="ad316-103">Vytvoření aplikace, které používají témata a odběry Service Bus</span><span class="sxs-lookup"><span data-stu-id="ad316-103">Create applications that use Service Bus topics and subscriptions</span></span>
<span data-ttu-id="ad316-104">Azure Service Bus podporuje sadu založené na cloudu, orientovaný na zprávy middleware technologie včetně služby Řízení front zpráv spolehlivé a trvanlivé publikování a přihlášení k odběru zasílání zpráv.</span><span class="sxs-lookup"><span data-stu-id="ad316-104">Azure Service Bus supports a set of cloud-based, message-oriented middleware technologies including reliable message queuing and durable publish/subscribe messaging.</span></span> <span data-ttu-id="ad316-105">Tento článek je založený na informacích uvedených v [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md) a nabízí úvod k publikování a přihlášení k odběru funkcím, které nabízí témat sběrnice Service Bus.</span><span class="sxs-lookup"><span data-stu-id="ad316-105">This article builds on the information provided in [Create applications that use Service Bus queues](service-bus-create-queues.md) and offers an introduction to the publish/subscribe capabilities offered by Service Bus topics.</span></span>

## <a name="evolving-retail-scenario"></a><span data-ttu-id="ad316-106">Měnící prodejní scénář</span><span class="sxs-lookup"><span data-stu-id="ad316-106">Evolving retail scenario</span></span>
<span data-ttu-id="ad316-107">Tento článek pokračuje prodejní scénář použitý v [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="ad316-107">This article continues the retail scenario used in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span> <span data-ttu-id="ad316-108">Odvolat prodeje dat z jednotlivých bodu prodej (POS) terminály musejí směrovat na systém pro správu inventáře, který používá tato data k určení, kdy musí být doplněny stock.</span><span class="sxs-lookup"><span data-stu-id="ad316-108">Recall that sales data from individual Point of Sale (POS) terminals must be routed to an inventory management system which uses that data to determine when stock has to be replenished.</span></span> <span data-ttu-id="ad316-109">Každý terminál POS sestavy jeho data prodeje odesláním zprávy a pokuste se **DataCollectionQueue** fronty, kde zůstávají, dokud jsou přijímány systém pro správu inventáře, jak je vidět tady:</span><span class="sxs-lookup"><span data-stu-id="ad316-109">Each POS terminal reports its sales data by sending messages to the **DataCollectionQueue** queue, where they remain until they are received by the inventory management system, as shown here:</span></span>

![Service Bus 1](./media/service-bus-create-topics-subscriptions/IC657161.gif)

<span data-ttu-id="ad316-111">Vyvíjí tento scénář, byla do systému přidaný nový požadavek: vlastník úložiště chce moci sledovat, jak úložiště provádí v reálném čase.</span><span class="sxs-lookup"><span data-stu-id="ad316-111">To evolve this scenario, a new requirement has been added to the system: the store owner wants to be able to monitor how the store is performing in real time.</span></span>

<span data-ttu-id="ad316-112">Chcete-li vyřešit tento požadavek, systém musí "klepněte na" off prodeje datový proud.</span><span class="sxs-lookup"><span data-stu-id="ad316-112">To address this requirement, the system must "tap" off the sales data stream.</span></span> <span data-ttu-id="ad316-113">Každá zpráva odeslaná pomocí terminály POS k odeslání do systému správy inventáře jako před stále chceme, ale chceme jinou kopii každé zprávy, můžeme použít na zobrazení řídicího panelu pro vlastníka úložiště.</span><span class="sxs-lookup"><span data-stu-id="ad316-113">We still want each message sent by the POS terminals to be sent to the inventory management system as before, but we want another copy of each message that we can use to present the dashboard view to the store owner.</span></span>

<span data-ttu-id="ad316-114">V každé situaci, jako je tato, ve které budete potřebovat každou zprávu zpracovat více stranami, můžete použít Service Bus *témata*.</span><span class="sxs-lookup"><span data-stu-id="ad316-114">In any situation such as this, in which you require each message to be consumed by multiple parties, you can use Service Bus *topics*.</span></span> <span data-ttu-id="ad316-115">Témata poskytují se vzorem publikovat/odebírat, ve kterém je každá publikovaná zpráva k dispozici jeden nebo více odběrů registrovaným pro příslušné téma.</span><span class="sxs-lookup"><span data-stu-id="ad316-115">Topics provide a publish/subscribe pattern in which each published message is made available to one or more subscriptions registered with the topic.</span></span> <span data-ttu-id="ad316-116">Naopak v případě front každou zprávu přijme jeden spotřebitel.</span><span class="sxs-lookup"><span data-stu-id="ad316-116">In contrast, with queues each message is received by a single consumer.</span></span>

<span data-ttu-id="ad316-117">Zprávy se posílají do tématu stejným způsobem, jako jsou odeslána do fronty.</span><span class="sxs-lookup"><span data-stu-id="ad316-117">Messages are sent to a topic in the same way as they are sent to a queue.</span></span> <span data-ttu-id="ad316-118">Však nejsou přijaty zprávy v tématu přímo. příjmu z předplatného.</span><span class="sxs-lookup"><span data-stu-id="ad316-118">However, messages are not received from the topic directly; they are received from subscriptions.</span></span> <span data-ttu-id="ad316-119">Si můžete představit předplatné téma jako virtuální frontě, která obdrží kopii zprávy, které se odesílají do tohoto tématu.</span><span class="sxs-lookup"><span data-stu-id="ad316-119">You can think of a subscription to a topic as a virtual queue that receives copies of the messages that are sent to that topic.</span></span> <span data-ttu-id="ad316-120">Jsou přijaty zprávy z odběru stejným způsobem jako přijaté z fronty.</span><span class="sxs-lookup"><span data-stu-id="ad316-120">Messages are received from a subscription the same way as they are received from a queue.</span></span>

<span data-ttu-id="ad316-121">Po návratu do prodejní scénář, fronty je nahrazena téma a předplatné se přidá, které můžete použít systémové součásti pro správu inventáře.</span><span class="sxs-lookup"><span data-stu-id="ad316-121">Going back to the retail scenario, the queue is replaced by a topic, and a subscription is added, which the inventory management system component can use.</span></span> <span data-ttu-id="ad316-122">Systém se nyní vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="ad316-122">The system now appears as follows:</span></span>

![Service Bus 2](./media/service-bus-create-topics-subscriptions/IC657165.gif)

<span data-ttu-id="ad316-124">Konfigurace zde funguje stejně jako předchozí návrhu na základě fronty.</span><span class="sxs-lookup"><span data-stu-id="ad316-124">The configuration here performs identically to the previous queue-based design.</span></span> <span data-ttu-id="ad316-125">To znamená, jsou zprávy odeslané do tématu směrovány do **inventáře** předplatného, ze kterého **systém pro správu inventáře** je využívá.</span><span class="sxs-lookup"><span data-stu-id="ad316-125">That is, messages sent to the topic are routed to the **Inventory** subscription, from which the **Inventory Management System** consumes them.</span></span>

<span data-ttu-id="ad316-126">Za účelem podpory řídicí panel správy, vytvoříme druhého předplatného na tématu, jak je vidět tady:</span><span class="sxs-lookup"><span data-stu-id="ad316-126">In order to support the management dashboard, we create a second subscription on the topic, as shown here:</span></span>

![Service Bus 3](./media/service-bus-create-topics-subscriptions/IC657166.gif)

<span data-ttu-id="ad316-128">Pomocí této konfigurace je k dispozici na obě každou zprávu z terminály POS **řídicí panel** a **inventáře** odběry.</span><span class="sxs-lookup"><span data-stu-id="ad316-128">With this configuration, each message from the POS terminals is made available to both the **Dashboard** and **Inventory** subscriptions.</span></span>

## <a name="show-me-the-code"></a><span data-ttu-id="ad316-129">Zobrazit mi kód</span><span class="sxs-lookup"><span data-stu-id="ad316-129">Show me the code</span></span>
<span data-ttu-id="ad316-130">Článek [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md) popisuje, jak vytvořit obor názvů služby a zaregistrujte si účet Azure.</span><span class="sxs-lookup"><span data-stu-id="ad316-130">The article [Create applications that use Service Bus queues](service-bus-create-queues.md) describes how to sign up for an Azure account and create a service namespace.</span></span> <span data-ttu-id="ad316-131">Nejjednodušší způsob, jak odkazovat na závislosti služby Service Bus je instalace služby Service Bus [balíček Nuget](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span><span class="sxs-lookup"><span data-stu-id="ad316-131">The easiest way to reference Service Bus dependencies is to install the Service Bus [Nuget package](https://www.nuget.org/packages/WindowsAzure.ServiceBus/).</span></span> <span data-ttu-id="ad316-132">Můžete také získat knihovny Service Bus v rámci sady Azure SDK.</span><span class="sxs-lookup"><span data-stu-id="ad316-132">You can also find the Service Bus libraries as part of the Azure SDK.</span></span> <span data-ttu-id="ad316-133">Je k dispozici ke stažení [stránky pro stažení sady Azure SDK](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="ad316-133">The download is available at the [Azure SDK download page](https://azure.microsoft.com/downloads/).</span></span>

### <a name="create-the-topic-and-subscriptions"></a><span data-ttu-id="ad316-134">Vytvoření tématu a odběry</span><span class="sxs-lookup"><span data-stu-id="ad316-134">Create the topic and subscriptions</span></span>
<span data-ttu-id="ad316-135">Operace správy pro Service Bus entit pro zasílání zpráv (fronty a publikování a přihlášení k odběru témata) se provádí prostřednictvím [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) třídy.</span><span class="sxs-lookup"><span data-stu-id="ad316-135">Management operations for Service Bus messaging entities (queues and publish/subscribe topics) are performed via the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class.</span></span> <span data-ttu-id="ad316-136">Příslušná pověření jsou nutné k vytvoření **NamespaceManager** instance pro konkrétní obor názvů.</span><span class="sxs-lookup"><span data-stu-id="ad316-136">Appropriate credentials are required in order to create a **NamespaceManager** instance for a particular namespace.</span></span> <span data-ttu-id="ad316-137">Service Bus používá [sdíleného přístupového podpisu (SAS)](service-bus-sas.md) model zabezpečení založený na.</span><span class="sxs-lookup"><span data-stu-id="ad316-137">Service Bus uses a [Shared Access Signature (SAS)](service-bus-sas.md) based security model.</span></span> <span data-ttu-id="ad316-138">[TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) třída představuje poskytovatele tokenu zabezpečení se zabudovanými metodami pro vytváření vracení některé známé poskytovatele tokenů.</span><span class="sxs-lookup"><span data-stu-id="ad316-138">The [TokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#microsoft_servicebus_tokenprovider) class represents a security token provider with built-in factory methods returning some well-known token providers.</span></span> <span data-ttu-id="ad316-139">Použijeme [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) metoda pro uložení pověření SAS.</span><span class="sxs-lookup"><span data-stu-id="ad316-139">We’ll use a [CreateSharedAccessSignatureTokenProvider](/dotnet/api/microsoft.servicebus.tokenprovider#Microsoft_ServiceBus_TokenProvider_CreateSharedAccessSignatureTokenProvider_System_String_) method to hold the SAS credentials.</span></span> <span data-ttu-id="ad316-140">[NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance je pak vytvořený pomocí bázové adresy oboru názvů Service Bus a zprostředkovateli tokenu.</span><span class="sxs-lookup"><span data-stu-id="ad316-140">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) instance is then constructed with the base address of the Service Bus namespace and the token provider.</span></span>

<span data-ttu-id="ad316-141">[NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) třída poskytuje metody pro vytvoření, výčet a odstranění entit přenosu zpráv.</span><span class="sxs-lookup"><span data-stu-id="ad316-141">The [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class provides methods to create, enumerate and delete messaging entities.</span></span> <span data-ttu-id="ad316-142">Kód, který zobrazí se zde zobrazí jak **NamespaceManager** je vytvořit a použít k vytvoření instance **DataCollectionTopic** tématu.</span><span class="sxs-lookup"><span data-stu-id="ad316-142">The code that is shown here shows how the **NamespaceManager** instance is created and used to create the **DataCollectionTopic** topic.</span></span>

```csharp
Uri uri = ServiceBusEnvironment.CreateServiceUri("sb", "test-blog", string.Empty);
string name = "RootManageSharedAccessKey";
string key = "abcdefghijklmopqrstuvwxyz";

TokenProvider tokenProvider = TokenProvider.CreateSharedAccessSignatureTokenProvider(name, key);
NamespaceManager namespaceManager = new NamespaceManager(uri, tokenProvider);

namespaceManager.CreateTopic("DataCollectionTopic");
```

<span data-ttu-id="ad316-143">Všimněte si, že existují přetížení [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) metoda, která vám umožní nastavit vlastnosti tématu.</span><span class="sxs-lookup"><span data-stu-id="ad316-143">Note that there are overloads of the [CreateTopic](/dotnet/api/microsoft.servicebus.namespacemanager#Microsoft_ServiceBus_NamespaceManager_CreateTopic_System_String_) method that enable you to set properties of the topic.</span></span> <span data-ttu-id="ad316-144">Můžete například nastavit výchozí time to live (TTL) hodnotě pro zprávy odeslané do tématu.</span><span class="sxs-lookup"><span data-stu-id="ad316-144">For example, you can set the default time-to-live (TTL) value for messages sent to the topic.</span></span> <span data-ttu-id="ad316-145">Dál přidejte **inventáře** a **řídicí panel** odběry.</span><span class="sxs-lookup"><span data-stu-id="ad316-145">Next, add the **Inventory** and **Dashboard** subscriptions.</span></span>

```csharp
namespaceManager.CreateSubscription("DataCollectionTopic", "Inventory");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard");
```

### <a name="send-messages-to-the-topic"></a><span data-ttu-id="ad316-146">Odesílání zpráv do tématu</span><span class="sxs-lookup"><span data-stu-id="ad316-146">Send messages to the topic</span></span>
<span data-ttu-id="ad316-147">Pro spuštění operace na Service Bus entity; například odesílání a přijímání zpráv, aplikace musíte nejdřív vytvořit [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) objektu.</span><span class="sxs-lookup"><span data-stu-id="ad316-147">For run-time operations on Service Bus entities; for example, sending and receiving messages, an application must first create a [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#microsoft_servicebus_messaging_messagingfactory) object.</span></span> <span data-ttu-id="ad316-148">Podobně jako [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) třídy, **MessagingFactory** instance je vytvořený z bázové adresy oboru názvů služby a zprostředkovateli tokenu.</span><span class="sxs-lookup"><span data-stu-id="ad316-148">Similar to the [NamespaceManager](/dotnet/api/microsoft.servicebus.namespacemanager#microsoft_servicebus_namespacemanager) class, the **MessagingFactory** instance is created from the base address of the service namespace and the token provider.</span></span>

```
MessagingFactory factory = MessagingFactory.Create(uri, tokenProvider);
```

<span data-ttu-id="ad316-149">Zprávy odesílané do a přijetí od témat sběrnice Service Bus jsou instance [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) třídy.</span><span class="sxs-lookup"><span data-stu-id="ad316-149">Messages sent to and received from Service Bus topics, are instances of the [BrokeredMessage](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage) class.</span></span> <span data-ttu-id="ad316-150">Tato třída obsahuje sadu standardních vlastností (jako například [popisek](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) a [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), slovník používaný pro udržení vlastností aplikace a tělo s libovolnými aplikačními daty.</span><span class="sxs-lookup"><span data-stu-id="ad316-150">This class consists of a set of standard properties (such as [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.label?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label) and [TimeToLive](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage.timetolive?view=azureservicebus-4.0.0#Microsoft_ServiceBus_Messaging_BrokeredMessage_TimeToLive)), a dictionary that is used to hold application properties, and a body of arbitrary application data.</span></span> <span data-ttu-id="ad316-151">Aplikace můžete nastavit text tak předávání jakýkoli serializovatelný objekt (v následujícím příkladu předá v **SalesData** objekt, který představuje data z prodeje z terminálu POS), který bude používat [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) k serializaci objektu.</span><span class="sxs-lookup"><span data-stu-id="ad316-151">An application can set the body by passing in any serializable object (the following example passes in a **SalesData** object that represents the sales data from the POS terminal), which will use the [DataContractSerializer](https://msdn.microsoft.com/library/system.runtime.serialization.datacontractserializer.aspx) to serialize the object.</span></span> <span data-ttu-id="ad316-152">Alternativně [datového proudu](https://msdn.microsoft.com/library/system.io.stream.aspx) může být zadán objekt.</span><span class="sxs-lookup"><span data-stu-id="ad316-152">Alternatively, a [Stream](https://msdn.microsoft.com/library/system.io.stream.aspx) object can be provided.</span></span>

```csharp
BrokeredMessage bm = new BrokeredMessage(salesData);
bm.Label = "SalesReport";
bm.Properties["StoreName"] = "Redmond";
bm.Properties["MachineID"] = "POS_1";
```

<span data-ttu-id="ad316-153">Nejjednodušší způsob, jak zasílat zprávy do tématu je použití [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) k vytvoření [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) objektu přímo z [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span><span class="sxs-lookup"><span data-stu-id="ad316-153">The easiest way to send messages to the topic is to use [CreateMessageSender](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageSender_System_String_) to create a [MessageSender](/dotnet/api/microsoft.servicebus.messaging.messagesender) object directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) instance:</span></span>

```csharp
MessageSender sender = factory.CreateMessageSender("DataCollectionTopic");
sender.Send(bm);
```

### <a name="receive-messages-from-a-subscription"></a><span data-ttu-id="ad316-154">Příjem zpráv z odběru</span><span class="sxs-lookup"><span data-stu-id="ad316-154">Receive messages from a subscription</span></span>
<span data-ttu-id="ad316-155">Podobně jako pomocí front, pro příjem zpráv z odběru můžete použít [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) objekt, který vytvoříte přímo z [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) pomocí [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span><span class="sxs-lookup"><span data-stu-id="ad316-155">Similar to using queues, to receive messages from a subscription you can use a [MessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagereceiver) object which you create directly from the [MessagingFactory](/dotnet/api/microsoft.servicebus.messaging.messagingfactory) using [CreateMessageReceiver](/dotnet/api/microsoft.servicebus.messaging.messagingfactory#Microsoft_ServiceBus_Messaging_MessagingFactory_CreateMessageReceiver_System_String_).</span></span> <span data-ttu-id="ad316-156">Můžete použít jednu ze dvou různých režimech přijímat (**ReceiveAndDelete** a **PeekLock**), jak je popsáno v [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md).</span><span class="sxs-lookup"><span data-stu-id="ad316-156">You can use one of the two different receive modes (**ReceiveAndDelete** and **PeekLock**), as discussed in [Create applications that use Service Bus queues](service-bus-create-queues.md).</span></span>

<span data-ttu-id="ad316-157">Všimněte si, že při vytváření **MessageReceiver** pro předplatné, *entityPath* parametr má formát `topicPath/subscriptions/subscriptionName`.</span><span class="sxs-lookup"><span data-stu-id="ad316-157">Note that when you create a **MessageReceiver** for subscriptions, the *entityPath* parameter is of the form `topicPath/subscriptions/subscriptionName`.</span></span> <span data-ttu-id="ad316-158">Proto k vytvoření **MessageReceiver** pro **inventáře** předplatné **DataCollectionTopic** tématu *entityPath* musí být nastavena na `DataCollectionTopic/subscriptions/Inventory`.</span><span class="sxs-lookup"><span data-stu-id="ad316-158">Therefore, to create a **MessageReceiver** for the **Inventory** subscription of the **DataCollectionTopic** topic, *entityPath* must be set to `DataCollectionTopic/subscriptions/Inventory`.</span></span> <span data-ttu-id="ad316-159">Kód zobrazí se následující:</span><span class="sxs-lookup"><span data-stu-id="ad316-159">The code appears as follows:</span></span>

```csharp
MessageReceiver receiver = factory.CreateMessageReceiver("DataCollectionTopic/subscriptions/Inventory");
BrokeredMessage receivedMessage = receiver.Receive();
try
{
    ProcessMessage(receivedMessage);
    receivedMessage.Complete();
}
catch (Exception e)
{
    receivedMessage.Abandon();
}
```

## <a name="subscription-filters"></a><span data-ttu-id="ad316-160">Filtrů odběrů</span><span class="sxs-lookup"><span data-stu-id="ad316-160">Subscription filters</span></span>
<span data-ttu-id="ad316-161">Pokud v tomto scénáři všechny zprávy odeslané do tématu jsou k dispozici všechny odběry registrované.</span><span class="sxs-lookup"><span data-stu-id="ad316-161">So far, in this scenario all messages sent to the topic are made available to all registered subscriptions.</span></span> <span data-ttu-id="ad316-162">Klíče fráze je "k dispozici."</span><span class="sxs-lookup"><span data-stu-id="ad316-162">The key phrase here is "made available."</span></span> <span data-ttu-id="ad316-163">Při odběry služby Service Bus zobrazit všechny zprávy odeslané do tématu, můžete zkopírovat jenom podmnožinu těchto zpráv do fronty virtuální odběru.</span><span class="sxs-lookup"><span data-stu-id="ad316-163">While Service Bus subscriptions see all messages sent to the topic, you can copy only a subset of those messages to the virtual subscription queue.</span></span> <span data-ttu-id="ad316-164">To se provádí pomocí předplatného *filtry*.</span><span class="sxs-lookup"><span data-stu-id="ad316-164">This is performed using subscription *filters*.</span></span> <span data-ttu-id="ad316-165">Při vytváření předplatného, můžete zadat výraz filtru ve formě predikát SQL92 styl, který funguje prostřednictvím vlastnosti zprávy, vlastnosti systému (například [popisek](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) a vlastnosti aplikace, jako například **StoreName** v předchozím příkladu.</span><span class="sxs-lookup"><span data-stu-id="ad316-165">When you create a subscription, you can supply a filter expression in the form of a SQL92 style predicate that operates over the properties of the message, both the system properties (for example, [Label](/dotnet/api/microsoft.servicebus.messaging.brokeredmessage#Microsoft_ServiceBus_Messaging_BrokeredMessage_Label)) and the application properties, such as **StoreName** in the previous example.</span></span>

<span data-ttu-id="ad316-166">Scénář pro znázornění vyvíjejí, druhý úložiště je pro přidání do náš scénář prodejní.</span><span class="sxs-lookup"><span data-stu-id="ad316-166">Evolving the scenario to illustrate this, a second store is to be added to our retail scenario.</span></span> <span data-ttu-id="ad316-167">Prodejní data ze všech terminály POS z obou úložiště ještě směrovat na systém pro správu centralizované inventáře, ale manažera úložiště pomocí nástroje řídicí panel je jen zájem o výkon toto úložiště.</span><span class="sxs-lookup"><span data-stu-id="ad316-167">Sales data from all of the POS terminals from both stores still have to be routed to the centralized inventory management system, but a store manager using the dashboard tool is only interested in the performance of that store.</span></span> <span data-ttu-id="ad316-168">Můžete uživatelům pomocí odběru filtrování dosáhnout.</span><span class="sxs-lookup"><span data-stu-id="ad316-168">You can use subscription filtering to achieve this.</span></span> <span data-ttu-id="ad316-169">Všimněte si, že když terminály POS publikování zpráv, nastaveny **StoreName** vlastnosti aplikace na zprávu.</span><span class="sxs-lookup"><span data-stu-id="ad316-169">Note that when the POS terminals publish messages, they set the **StoreName** application property on the message.</span></span> <span data-ttu-id="ad316-170">Zadána dvě úložiště, například **Redmond** a **Praha**, terminály POS v úložišti Redmond razítka jejich data prodeje zprávy s **StoreName** rovna **Redmond**, zatímco použití terminály POS ukládat Praze **StoreName** rovna **Praha**.</span><span class="sxs-lookup"><span data-stu-id="ad316-170">Given two stores, for example **Redmond** and **Seattle**, the POS terminals in the Redmond store stamp their sales data messages with a **StoreName** equal to **Redmond**, whereas the Seattle store POS terminals use a **StoreName** equal to **Seattle**.</span></span> <span data-ttu-id="ad316-171">Správce obchodu úložiště Redmond pouze chce vidět data z jeho terminály POS.</span><span class="sxs-lookup"><span data-stu-id="ad316-171">The store manager of the Redmond store only wants to see data from its POS terminals.</span></span> <span data-ttu-id="ad316-172">Systém vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="ad316-172">The system appears as follows:</span></span>

![Služby Bus4](./media/service-bus-create-topics-subscriptions/IC657167.gif)

<span data-ttu-id="ad316-174">Chcete-li nastavit tento směrování, musíte vytvořit **řídicí panel** předplatné následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="ad316-174">To set up this routing, you create the **Dashboard** subscription as follows:</span></span>

```csharp
SqlFilter dashboardFilter = new SqlFilter("StoreName = 'Redmond'");
namespaceManager.CreateSubscription("DataCollectionTopic", "Dashboard", dashboardFilter);
```

<span data-ttu-id="ad316-175">Pomocí této [filtr předplatných](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), jen zprávy, které mají **StoreName** vlastnost nastavena na hodnotu **Redmond** se zkopírují do virtuální fronty pro **řídicí panel** předplatné.</span><span class="sxs-lookup"><span data-stu-id="ad316-175">With this [subscription filter](/dotnet/api/microsoft.servicebus.messaging.sqlfilter), only messages that have the **StoreName** property set to **Redmond** will be copied to the virtual queue for the **Dashboard** subscription.</span></span> <span data-ttu-id="ad316-176">Je mnohem víc filtrování předplatné, ale.</span><span class="sxs-lookup"><span data-stu-id="ad316-176">There is much more to subscription filtering, however.</span></span> <span data-ttu-id="ad316-177">Aplikace mohou mít více pravidel filtru na jedno předplatné kromě schopnost jak předává do virtuální fronty odběru upravit vlastnosti zprávy.</span><span class="sxs-lookup"><span data-stu-id="ad316-177">Applications can have multiple filter rules per subscription in addition to the ability to modify the properties of a message as it passes to a subscription's virtual queue.</span></span>

## <a name="summary"></a><span data-ttu-id="ad316-178">Souhrn</span><span class="sxs-lookup"><span data-stu-id="ad316-178">Summary</span></span>
<span data-ttu-id="ad316-179">Všechny důvodů pro použití služby Řízení front popsané v [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md) se rovněž vztahují na témata, konkrétně:</span><span class="sxs-lookup"><span data-stu-id="ad316-179">All of the reasons to use queuing described in [Create applications that use Service Bus queues](service-bus-create-queues.md) also apply to topics, specifically:</span></span>

* <span data-ttu-id="ad316-180">Časové oddělení – producenti a spotřebitelé zpráv nemusí být online ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="ad316-180">Temporal decoupling – message producers and consumers do not have to be online at the same time.</span></span>
* <span data-ttu-id="ad316-181">Vyrovnávání zátěže – vrcholů v zatížení jsou vyhlazené v tématu Povolení přijímajícím aplikacím zřídily pro průměrnou zátěž místo zátěž ve špičce.</span><span class="sxs-lookup"><span data-stu-id="ad316-181">Load leveling – peaks in load are smoothed out by the topic enabling consuming applications to be provisioned for average load instead of peak load.</span></span>
* <span data-ttu-id="ad316-182">Vyrovnávání zatížení – podobně jako fronty, můžete mít několik konkurenčních spotřebitelů naslouchání v rámci jednoho předplatného s každou zprávu předávána pouze jeden příjemce, a tím Vyrovnávání zatížení.</span><span class="sxs-lookup"><span data-stu-id="ad316-182">Load balancing – similar to a queue, you can have multiple competing consumers listening on a single subscription, with each message handed off to only one of the consumers, thereby balancing load.</span></span>
* <span data-ttu-id="ad316-183">Volné párování – zasílání zpráv sítě můžete rozvíjet bez ovlivnění stávající koncové body; například přidáním odběrů nebo změna filtry do tématu povolit pro nové spotřebitele.</span><span class="sxs-lookup"><span data-stu-id="ad316-183">Loose coupling – you can evolve the messaging network without affecting existing endpoints; for example, adding subscriptions or changing filters to a topic to allow for new consumers.</span></span>

## <a name="next-steps"></a><span data-ttu-id="ad316-184">Další kroky</span><span class="sxs-lookup"><span data-stu-id="ad316-184">Next steps</span></span>

<span data-ttu-id="ad316-185">V tématu [vytvářet aplikace, které používají fronty Service Bus](service-bus-create-queues.md) informace o tom, jak používat fronty ve scénáři prodejní POS.</span><span class="sxs-lookup"><span data-stu-id="ad316-185">See [Create applications that use Service Bus queues](service-bus-create-queues.md) for information about how to use queues in the POS retail scenario.</span></span>


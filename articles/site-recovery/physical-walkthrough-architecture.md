---
title: "Zkontrolujte architekturu pro fyzický server replikaci do Azure pomocí Azure Site Recovery | Microsoft Docs"
description: "Tento článek obsahuje přehled součásti a architektura používá při replikace místní fyzických serverů do Azure se službou Azure Site Recovery"
services: site-recovery
documentationcenter: 
author: rayne-wiselman
manager: carmonm
editor: 
ms.assetid: 09c9b136-35f5-465e-8d0f-f4c5d5d9f880
ms.service: site-recovery
ms.workload: storage-backup-recovery
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: article
ms.date: 06/27/2017
ms.author: raynew
ms.openlocfilehash: 843c3f1b54f50fe50b162ed242deab717a080830
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="step-1-review-the-architecture-for-physical-server-replication-to-azure"></a><span data-ttu-id="221a3-103">Krok 1: Posouzení architekturu pro fyzický server replikaci do Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-103">Step 1: Review the architecture for physical server replication to Azure</span></span>

<span data-ttu-id="221a3-104">Tento článek popisuje součásti a procesům používaným při replikaci místní Windows nebo Linuxem fyzických serverů do Azure, pomocí [Azure Site Recovery](site-recovery-overview.md) služby.</span><span class="sxs-lookup"><span data-stu-id="221a3-104">This article describes the components and processes used when you replicate on-premises Windows/Linux physical servers to Azure, using the [Azure Site Recovery](site-recovery-overview.md) service.</span></span>

<span data-ttu-id="221a3-105">Případné připomínky můžete publikovat na konci tohoto článku nebo na [fóru služby Azure Site Recovery](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span><span class="sxs-lookup"><span data-stu-id="221a3-105">Post any comments at the bottom of this article, or ask questions in the [Azure Recovery Services Forum](https://social.msdn.microsoft.com/forums/azure/home?forum=hypervrecovmgr).</span></span>


## <a name="architectural-components"></a><span data-ttu-id="221a3-106">Komponenty architektury</span><span class="sxs-lookup"><span data-stu-id="221a3-106">Architectural components</span></span>

<span data-ttu-id="221a3-107">Tabulka shrnuje součásti, které potřebujete.</span><span class="sxs-lookup"><span data-stu-id="221a3-107">The table summarizes the components you need.</span></span>

<span data-ttu-id="221a3-108">**Komponenta**</span><span class="sxs-lookup"><span data-stu-id="221a3-108">**Component**</span></span> | <span data-ttu-id="221a3-109">**Požadavek**</span><span class="sxs-lookup"><span data-stu-id="221a3-109">**Requirement**</span></span> | <span data-ttu-id="221a3-110">**Podrobnosti**</span><span class="sxs-lookup"><span data-stu-id="221a3-110">**Details**</span></span>
--- | --- | ---
<span data-ttu-id="221a3-111">**Azure**</span><span class="sxs-lookup"><span data-stu-id="221a3-111">**Azure**</span></span> | <span data-ttu-id="221a3-112">Potřebujete účet Azure, účet úložiště Azure a sítě Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-112">You need an Azure account, an Azure storage account, and an Azure network.</span></span> | <span data-ttu-id="221a3-113">Replikovaná data jsou uložena v účtu úložiště a vytvoří se virtuální počítače Azure s replikovaná data, když dojde k převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="221a3-113">Replicated data is stored in the storage account, and Azure VMs are created with the replicated data when failover occurs.</span></span> <span data-ttu-id="221a3-114">Virtuální počítače Azure připojit k virtuální síť Azure, když vytváří.</span><span class="sxs-lookup"><span data-stu-id="221a3-114">Azure VMs connect to the Azure virtual network when they're created.</span></span>
<span data-ttu-id="221a3-115">**Konfigurační server**</span><span class="sxs-lookup"><span data-stu-id="221a3-115">**Configuration server**</span></span> | <span data-ttu-id="221a3-116">Jeden místní server pro správu (fyzický server nebo virtuální počítač VMware) používající všechny místní součásti Site Recovery.</span><span class="sxs-lookup"><span data-stu-id="221a3-116">A single on-premises management server (physical server or VMware VM) that runs all the on-premises Site Recovery components.</span></span> <span data-ttu-id="221a3-117">Mezi ně patří, a konfigurační server, procesový server, hlavní cílový server.</span><span class="sxs-lookup"><span data-stu-id="221a3-117">These include a configuration server, process server, master target server.</span></span> | <span data-ttu-id="221a3-118">Komponenta konfiguračního serveru koordinuje komunikaci mezi místním prostředím a Azure a spravuje replikaci dat.</span><span class="sxs-lookup"><span data-stu-id="221a3-118">The configuration server component coordinates communications between on-premises and Azure, and manages data replication.</span></span>
 <span data-ttu-id="221a3-119">**Procesový server**</span><span class="sxs-lookup"><span data-stu-id="221a3-119">**Process server**</span></span>  | <span data-ttu-id="221a3-120">Obvykle se instaluje na konfigurační server.</span><span class="sxs-lookup"><span data-stu-id="221a3-120">Installed by default on the configuration server.</span></span> | <span data-ttu-id="221a3-121">Funguje jako replikační brána.</span><span class="sxs-lookup"><span data-stu-id="221a3-121">Acts as a replication gateway.</span></span> <span data-ttu-id="221a3-122">Přijímá data replikace, optimalizuje je pomocí ukládání do mezipaměti, komprese a šifrování a odesílá je do úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-122">Receives replication data, optimizes it with caching, compression, and encryption, and sends it to Azure storage.</span></span><br/><br/> <span data-ttu-id="221a3-123">Procesový server také obstará nabízenou instalaci služby Mobility na chráněné počítače.</span><span class="sxs-lookup"><span data-stu-id="221a3-123">The process server also handles push installation of the Mobility service to protected machines.</span></span><br/><br/> <span data-ttu-id="221a3-124">Můžete přidat další samostatný proces vyhrazené servery pro zpracování zvyšující se množství provoz replikace.</span><span class="sxs-lookup"><span data-stu-id="221a3-124">You can add additional separate dedicated process servers, to handle increasing volumes of replication traffic.</span></span>
 <span data-ttu-id="221a3-125">**Hlavní cílový server**</span><span class="sxs-lookup"><span data-stu-id="221a3-125">**Master target server**</span></span> | <span data-ttu-id="221a3-126">Obvykle se instaluje na místní konfigurační server.</span><span class="sxs-lookup"><span data-stu-id="221a3-126">Installed by default on the on-premises configuration server.</span></span> | <span data-ttu-id="221a3-127">Zpracovává replikační data během navracení služeb z Azure po obnovení.</span><span class="sxs-lookup"><span data-stu-id="221a3-127">Handles replication data during failback from Azure.</span></span><br/><br/> <span data-ttu-id="221a3-128">Pokud je objem přenosů při navracení služeb po obnovení příliš vysoký, můžete nasadit samostatný hlavní cílový server pro účely navrácení služeb po obnovení.</span><span class="sxs-lookup"><span data-stu-id="221a3-128">If volumes of failback traffic are high, you can deploy a separate master target server for failback.</span></span>
<span data-ttu-id="221a3-129">**Replikované servery**</span><span class="sxs-lookup"><span data-stu-id="221a3-129">**Replicated servers**</span></span> | <span data-ttu-id="221a3-130">Službu mobility je nainstalována na každém serveru systému Windows nebo Linux, které chcete replikovat.</span><span class="sxs-lookup"><span data-stu-id="221a3-130">The Mobility service component is installed on each Windows/Linux server you want to replicate.</span></span> <span data-ttu-id="221a3-131">Můžete ji nainstalovat na každý počítač ručně, nebo pomocí nabízené instalace z procesového serveru.</span><span class="sxs-lookup"><span data-stu-id="221a3-131">It can be installed manually on each machine, or with a push installation from the process server.</span></span>
<span data-ttu-id="221a3-132">**Navrácení služeb po obnovení**</span><span class="sxs-lookup"><span data-stu-id="221a3-132">**Failback**</span></span> | <span data-ttu-id="221a3-133">Navrácení služeb po obnovení VMware je infrastruktura vyžaduje.</span><span class="sxs-lookup"><span data-stu-id="221a3-133">For failback a VMware infrastructure is required.</span></span> <span data-ttu-id="221a3-134">Nelze navrátit služby po obnovení v případě fyzického serveru.</span><span class="sxs-lookup"><span data-stu-id="221a3-134">You can't fail back to a physical server.</span></span>


<span data-ttu-id="221a3-135">**Obrázek 1: Fyzických součástí Azure**</span><span class="sxs-lookup"><span data-stu-id="221a3-135">**Figure 1: Physical to Azure components**</span></span>

![Komponenty](./media/physical-walkthrough-architecture/arch-enhanced.png)

## <a name="replication-process"></a><span data-ttu-id="221a3-137">Proces replikace</span><span class="sxs-lookup"><span data-stu-id="221a3-137">Replication process</span></span>

1. <span data-ttu-id="221a3-138">Nastavení nasazení, včetně místní a Azure součásti.</span><span class="sxs-lookup"><span data-stu-id="221a3-138">You set up the deployment, including on-premises and Azure components.</span></span> <span data-ttu-id="221a3-139">V trezoru služeb zotavení je třeba zadat replikace zdroje a cíle, nastavení konfigurace serveru, vytvořte zásadu replikace, nasazení služby Mobility, povolit replikaci a spustit testovací převzetí služeb.</span><span class="sxs-lookup"><span data-stu-id="221a3-139">In the Recovery Services vault, you specify the replication source and target, set up the configuration server, create a replication policy, deploy the Mobility service, enable replication, and run a test failover.</span></span>
2.  <span data-ttu-id="221a3-140">Replikovat počítače v souladu s zásady replikace a počáteční kopii data se replikují do úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-140">Machines replicate in accordance with the replication policy, and an initial copy of the data is replicated to Azure storage.</span></span>
4. <span data-ttu-id="221a3-141">Po dokončení počáteční replikace začne replikace rozdílové změny do Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-141">After initial replication finishes, replication of delta changes to Azure begins.</span></span> <span data-ttu-id="221a3-142">Sledované změny se pro jednotlivé počítače ukládají do souboru .hrl.</span><span class="sxs-lookup"><span data-stu-id="221a3-142">Tracked changes for a machine are held in a .hrl file.</span></span>
    - <span data-ttu-id="221a3-143">Počítače, které se replikují, komunikují s konfiguračním serverem kvůli správě replikace na příchozím portu HTTPS 443.</span><span class="sxs-lookup"><span data-stu-id="221a3-143">Replicating machines communicate with the configuration server on port HTTPS 443 inbound, for replication management.</span></span>
    - <span data-ttu-id="221a3-144">Replikaci počítačů odesílat data replikace na procesový server na port HTTPS 9443 příchozí (lze upravit).</span><span class="sxs-lookup"><span data-stu-id="221a3-144">Replicating machines send replication data to the process server on port HTTPS 9443 inbound (can be modified).</span></span>
    - <span data-ttu-id="221a3-145">Konfigurační server orchestruje správu replikace s Azure přes odchozí port HTTPS 443.</span><span class="sxs-lookup"><span data-stu-id="221a3-145">The configuration server orchestrates replication management with Azure over port HTTPS 443 outbound.</span></span>
    - <span data-ttu-id="221a3-146">Procesový server přijímá data ze zdrojového počítače, optimalizuje je a šifruje, a pak je odesílá do úložiště Azure přes odchozí port 443.</span><span class="sxs-lookup"><span data-stu-id="221a3-146">The process server receives data from source machines, optimizes and encrypts it, and sends it to Azure storage over port 443 outbound.</span></span>
    - <span data-ttu-id="221a3-147">Když povolíte konzistenci mezi více virtuálními počítači, budou spolu počítače v replikační skupině komunikovat na portu 20004.</span><span class="sxs-lookup"><span data-stu-id="221a3-147">If you enable multi-VM consistency, then machines in the replication group communicate with each other over port 20004.</span></span> <span data-ttu-id="221a3-148">Konzistence více virtuálních počítačů znamená, že seskupíte víc virtuálních počítačů do replikační skupiny, v rámci které se sdílí body obnovení konzistentní vzhledem k selháním a konzistentní vzhledem k aplikacím, když dojde k převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="221a3-148">Multi-VM is used if you group multiple machines into replication groups that share crash-consistent and app-consistent recovery points when they fail over.</span></span> <span data-ttu-id="221a3-149">To je užitečné, pokud je počítačích spuštěná stejná úloha a je třeba, aby zůstala konzistentní.</span><span class="sxs-lookup"><span data-stu-id="221a3-149">This is useful if machines are running the same workload and need to be consistent.</span></span>
5. <span data-ttu-id="221a3-150">Provoz se přes internet replikuje do veřejných koncových bodů úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-150">Traffic is replicated to Azure storage public endpoints, over the internet.</span></span> <span data-ttu-id="221a3-151">Alternativně můžete použít [veřejný partnerský vztah](../expressroute/expressroute-circuit-peerings.md#public-peering) Azure ExpressRoute.</span><span class="sxs-lookup"><span data-stu-id="221a3-151">Alternately, you can use Azure ExpressRoute [public peering](../expressroute/expressroute-circuit-peerings.md#public-peering).</span></span> <span data-ttu-id="221a3-152">Přenos replikačních dat přes síť site-to-site VPN z místního serveru do Azure není podporovaný.</span><span class="sxs-lookup"><span data-stu-id="221a3-152">Replicating traffic over a site-to-site VPN from an on-premises site to Azure isn't supported.</span></span>

<span data-ttu-id="221a3-153">**Obrázek 2: Fyzicky Azure replikace**</span><span class="sxs-lookup"><span data-stu-id="221a3-153">**Figure 2: Physical to Azure replication**</span></span>

![Rozšířené](./media/physical-walkthrough-architecture/v2a-architecture-henry.png)

## <a name="failover-and-failback-process"></a><span data-ttu-id="221a3-155">Proces převzetí služeb při selhání a navrácení služeb po obnovení</span><span class="sxs-lookup"><span data-stu-id="221a3-155">Failover and failback process</span></span>

<span data-ttu-id="221a3-156">Po ověření správného fungování testovacího převzetí služeb při selhání můžete podle potřeby spouštět neplánovaná převzetí služeb při selhání do Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-156">After you verify that test failover is working as expected, you can run unplanned failovers to Azure as required.</span></span> <span data-ttu-id="221a3-157">Při spuštění převzetí služeb při selhání se virtuální počítače Azure vytvořené z replikovaná data.</span><span class="sxs-lookup"><span data-stu-id="221a3-157">When you run a failover, Azure VMs are created from replicated data.</span></span> <span data-ttu-id="221a3-158">Pak, když primární místní lokalitu opět k dispozici, může selhat zpět.</span><span class="sxs-lookup"><span data-stu-id="221a3-158">Then, when your primary on-premises site is available again, you can fail back.</span></span> <span data-ttu-id="221a3-159">Poznámky:</span><span class="sxs-lookup"><span data-stu-id="221a3-159">Note that:</span></span>

- <span data-ttu-id="221a3-160">Plánované převzetí služeb není podporované.</span><span class="sxs-lookup"><span data-stu-id="221a3-160">Planned failover isn't supported.</span></span>
- <span data-ttu-id="221a3-161">Můžete převzít jeden počítač nebo vytvořit [plány obnovení](site-recovery-create-recovery-plans.md), aby převzetí služeb při selhání více počítačů současně.</span><span class="sxs-lookup"><span data-stu-id="221a3-161">You can fail over a single machine, or create [recovery plans](site-recovery-create-recovery-plans.md), to fail over multiple machines together.</span></span>
- <span data-ttu-id="221a3-162">Po potvrzení procesu převzetí služeb můžete začít používat úlohu na replikovaném virtuálním počítači Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-162">You commit a failover to start accessing the workload from the replica Azure VM.</span></span>
- <span data-ttu-id="221a3-163">Když primární lokality je opět k dispozici, replikovat do primární lokality je počítač ze sekundární.</span><span class="sxs-lookup"><span data-stu-id="221a3-163">When the primary site is available again, you replicate the machine from the secondary to the primary site.</span></span> <span data-ttu-id="221a3-164">Potom spusťte neplánované převzetí služeb při selhání ze sekundární lokality.</span><span class="sxs-lookup"><span data-stu-id="221a3-164">Then, run an unplanned failover from the secondary site.</span></span> <span data-ttu-id="221a3-165">Jakmile toto navrácení služeb potvrdíte, budou data zpět v místní lokalitě a budete muset opět povolit replikaci do Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-165">After you commit this failover, data will be back on-premises, and you need to enable replication to Azure again.</span></span>

<span data-ttu-id="221a3-166">Navrácení služeb po obnovení součásti zahrnují:</span><span class="sxs-lookup"><span data-stu-id="221a3-166">Failback components include:</span></span>

- <span data-ttu-id="221a3-167">**Dočasný procesní server v Azure**: je třeba nastavit virtuální počítač Azure tak, aby fungoval jako server proces pro zpracování replikace z Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-167">**Temporary process server in Azure**: You need to set up an Azure VM to act as a process server, to handle replication from Azure.</span></span> <span data-ttu-id="221a3-168">Tento virtuální počítač je možné po navrácení služeb po obnovení odstranit.</span><span class="sxs-lookup"><span data-stu-id="221a3-168">You can delete this VM after failback finishes.</span></span>
- <span data-ttu-id="221a3-169">**Připojení k síti VPN**: potřebovat připojení VPN (nebo Azure ExpressRoute) ze sítě Azure k místní lokalitě.</span><span class="sxs-lookup"><span data-stu-id="221a3-169">**VPN connection**: You need a VPN connection (or Azure ExpressRoute) from the Azure network to the on-premises site.</span></span>
- <span data-ttu-id="221a3-170">**Samostatný místní hlavní cílový server**: místní hlavní cílový server (nainstalována ve výchozím nastavení na konfiguračním serveru) zpracovává navrácení služeb po obnovení.</span><span class="sxs-lookup"><span data-stu-id="221a3-170">**Separate on-premises master target server**: The on-premises master target server (installed by default on the configuration server) handles failback.</span></span> <span data-ttu-id="221a3-171">Pokud tak zpět velké objemy přenosů, měli byste nastavit samostatný místní hlavní cílový server pro tento účel.</span><span class="sxs-lookup"><span data-stu-id="221a3-171">If you fail back large volumes of traffic, you should set up a separate on-premises master target server for this purpose.</span></span>
- <span data-ttu-id="221a3-172">**Navrácení služeb po obnovení zásad**: budete potřebovat zásadu navrácení služeb po obnovení.</span><span class="sxs-lookup"><span data-stu-id="221a3-172">**Failback policy**: You need a failback policy.</span></span> <span data-ttu-id="221a3-173">Ty se vytvoří automaticky při vytvoření zásad replikace.</span><span class="sxs-lookup"><span data-stu-id="221a3-173">This is automatically created when you created your replication policy.</span></span>
- <span data-ttu-id="221a3-174">**Infrastruktura VMware:** Musíte navrátit služby po obnovení do místního virtuálního počítače VMware.</span><span class="sxs-lookup"><span data-stu-id="221a3-174">**VMware infrastructure**: You must fail back to an on-premises VMware VM.</span></span> <span data-ttu-id="221a3-175">To znamená, že potřebujete místní infrastrukturu VMware, i když místní fyzické servery replikujete do Azure.</span><span class="sxs-lookup"><span data-stu-id="221a3-175">This means you need an on-premises VMware infrastructure, even if you're replicating on-premises physical servers to Azure.</span></span>

<span data-ttu-id="221a3-176">**Obrázek 3: Fyzický server navrácení služeb po obnovení**</span><span class="sxs-lookup"><span data-stu-id="221a3-176">**Figure 3: Physical server failback**</span></span>

![Navrácení služeb po obnovení](./media/physical-walkthrough-architecture/enhanced-failback.png)


## <a name="next-steps"></a><span data-ttu-id="221a3-178">Další kroky</span><span class="sxs-lookup"><span data-stu-id="221a3-178">Next steps</span></span>

<span data-ttu-id="221a3-179">Přejděte na [krok 2: ověření předpoklady a omezení](physical-walkthrough-prerequisites.md)</span><span class="sxs-lookup"><span data-stu-id="221a3-179">Go to [Step 2: Verify prerequisites and limitations](physical-walkthrough-prerequisites.md)</span></span>

---
title: "škálování aaaTroubleshoot s sady škálování virtuálního počítače | Microsoft Docs"
description: "Řešení potíží s škálování s sady škálování virtuálního počítače. Pochopení typické problémy vzniklé a jak tooresolve je."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: 4c9a70992348d87fb43646421a90a027bf400a17
ms.sourcegitcommit: 523283cc1b3c37c428e77850964dc1c33742c5f0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/06/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="1c9f9-104">Řešení potíží s škálování s sady škálování virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="1c9f9-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="1c9f9-105">**Problém** – jste vytvořili automatické škálování infrastruktury v správce Azure Resource Manager pomocí sady škálování virtuálního počítače – například nasazením šablonu takto: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss bottle škálování – máte definované pravidel škálování a vyhovující postup, s tím rozdílem, že bez ohledu na to, kolik zatížení umístěných na hello virtuálních počítačů, se nebude škálování.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on hello VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="1c9f9-106">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="1c9f9-106">Troubleshooting steps</span></span>
<span data-ttu-id="1c9f9-107">Některé věci tooconsider patří:</span><span class="sxs-lookup"><span data-stu-id="1c9f9-107">Some things tooconsider include:</span></span>

* <span data-ttu-id="1c9f9-108">Kolik jader každý virtuální počítač nemá a jsou načítání každý jádra? Šablona Azure Quickstart Hello příkladu výše má do_work.php skript, který načte jediného jádra.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-108">How many cores does each VM have, and are you loading each core? hello example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="1c9f9-109">Pokud používáte virtuálního počítače větší než jedním jádrem velikost virtuálního počítače jako Standard_A1 nebo D1 pak budete potřebovat toorun tato zatížení vícekrát.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-109">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need toorun this load multiple times.</span></span> <span data-ttu-id="1c9f9-110">Zkontrolujte, kolik virtuálních počítačů cores kontrolou [velikosti pro systém Windows virtuálních počítačů v Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="1c9f9-110">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="1c9f9-111">Tom, kolik virtuálních počítačů v hello sady škálování virtuálního počítače, můžete pracujeme na každé z nich?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-111">How many VMs in hello VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="1c9f9-112">Horizontální navýšení kapacity událostí bude, až hello průměrnou hodnotu CPU napříč **všechny** hello virtuální počítače ve škálovací sadě překračuje hello prahovou hodnotu, časem hello interní definované v pravidlech automatického škálování hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-112">A scale out event will only take place when hello average CPU across **all** hello VMs in a scale set exceeds hello threshold value, over hello time internal defined in hello autoscale rules.</span></span>
* <span data-ttu-id="1c9f9-113">Vynechali jste žádné události škálování?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-113">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="1c9f9-114">Zkontrolujte, zda protokoly auditu hello v hello portál Azure pro škálování události.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-114">Check hello audit logs in hello Azure portal for scale events.</span></span> <span data-ttu-id="1c9f9-115">Možná se škálování nahoru a nebyla provedena vertikálně.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-115">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="1c9f9-116">Můžete filtrovat podle "Škálování"...</span><span class="sxs-lookup"><span data-stu-id="1c9f9-116">You can filter by “Scale”..</span></span>
  
    ![Protokoly auditu][audit]
* <span data-ttu-id="1c9f9-118">Jsou vaše škálování in a škálování prahové hodnoty dostatečně neliší?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-118">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="1c9f9-119">Předpokládejme, že nastavíte pravidlo tooscale se při průměrné využití procesoru je větší než 50 % za 5 minut a tooscale v Pokud průměrné využití procesoru je menší než 50 %.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-119">Suppose you set a rule tooscale out when average CPU is greater than 50% over 5 minutes, and tooscale in when average CPU is less than 50%.</span></span> <span data-ttu-id="1c9f9-120">To by způsobilo "flapping" problém při využití procesoru je prahová hodnota zavřít toothis, s akcí škálování, které neustále rostoucí a klesající hello velikost sady hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-120">This would cause a “flapping” problem when CPU usage is close toothis threshold, with scale actions constantly increasing and decreasing hello size of hello set.</span></span> <span data-ttu-id="1c9f9-121">Z toho důvodu hello škálování služby pokusí tooprevent "netřepotá", který můžete manifest jako není škálování.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-121">Because of this, hello autoscale service tries tooprevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="1c9f9-122">Proto zkontrolujte, zda se Škálováním na více systémů a škálování v prahové hodnoty jsou dostatečně neliší tooallow některé prostoru mezi škálování.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-122">Therefore make sure your scale-out and scale-in thresholds are sufficiently different tooallow some space in between scaling.</span></span>
* <span data-ttu-id="1c9f9-123">Můžete psát vlastní šablonu JSON?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-123">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="1c9f9-124">Je snadno toomake chyb, takže začínat šablony jako hello nad které prokazatelně toowork a proveďte malé přírůstkové změny.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-124">It is easy toomake mistakes, so start with a template like hello one above which is proven toowork, and make small incremental changes.</span></span> 
* <span data-ttu-id="1c9f9-125">Můžete je ručně škálovat, příchozí nebo odchozí?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-125">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="1c9f9-126">Zkuste opětovného nasazení hello prostředků s číslem různých "kapacitou" nastavení toochange hello virtuálních počítačů s Škálovací sady virtuálního počítače ručně.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-126">Try redeploying hello VM Scale Set resource with a different “capacity” setting toochange hello number of VMs manually.</span></span> <span data-ttu-id="1c9f9-127">Příklad šablony toodo Toto je tady: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – může být nutné tooedit hello šablony toomake se obsahuje hello stejný počítač velikost jako Škálovací sady používá.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-127">An example template toodo this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need tooedit hello template toomake sure it has hello same machine size as your Scale Set is using.</span></span> <span data-ttu-id="1c9f9-128">Pokud hello počet virtuálních počítačů můžete úspěšně ručně změnit, pak víte, že problém hello je izolovaná tooautoscale.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-128">If you can successfully change hello number of VMs manually, then you know hello problem is isolated tooautoscale.</span></span>
* <span data-ttu-id="1c9f9-129">Zkontrolujte vaše Microsoft.Compute/virtualMachineScaleSet a Microsoft.Insights prostředky v hello [Průzkumníka prostředků Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="1c9f9-129">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in hello [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="1c9f9-130">Jedná se nepostradatelný řešení potíží s nástroji, které se dozvíte, hello stav svých prostředků Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-130">This is an indispensable troubleshooting tool which shows you hello state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="1c9f9-131">Klikněte na vaše předplatné a podívejte se na hello při odstraňování skupiny prostředků.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-131">Click on your subscription and look at hello Resource Group you are troubleshooting.</span></span> <span data-ttu-id="1c9f9-132">V rámci hello výpočetních prostředků zprostředkovatele podívejte se na hello jste vytvořili sady škálování virtuálního počítače a zkontrolujte hello zobrazení Instance, které se dozvíte, hello stavu nasazení.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-132">Under hello Compute resource provider look at hello VM Scale Set you created and check hello Instance View, which shows you hello state of a deployment.</span></span> <span data-ttu-id="1c9f9-133">Také zkontrolujte hello zobrazení instance virtuálních počítačů v hello Škálovací sady virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-133">Also check hello instance view of VMs in hello VM Scale Set.</span></span> <span data-ttu-id="1c9f9-134">Pak přejděte do zprostředkovatele prostředků Microsoft.Insights hello a zkontrolujte, zda pravidla pro automatické škálování hello vypadat dobře.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-134">Then go into hello Microsoft.Insights resource provider and check hello autoscale rules look good.</span></span>
* <span data-ttu-id="1c9f9-135">Je hello rozšíření diagnostiky práce a generování údaje o výkonu?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-135">Is hello Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="1c9f9-136">**Aktualizace:** Azure škálování bylo rozšířené toouse hostitele na základě kanály metriky, které už vyžaduje toobe rozšíření diagnostiky nainstalována.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-136">**Update:** Azure autoscale has been enhanced toouse a host based metrics pipeline which no longer requires a diagnostics extension toobe installed.</span></span> <span data-ttu-id="1c9f9-137">To znamená, že hello další několik odstavců přestanou platit, pokud vytvoříte automatické škálování aplikace pomocí hello nový kanál.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-137">This means hello next few paragraphs no longer apply if you create an autoscaling application using hello new pipeline.</span></span> <span data-ttu-id="1c9f9-138">Příklad šablony Azure, které byly převedený toouse hello hostitele kanálu je: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-138">An example of Azure templates which have been converted toouse hello host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="1c9f9-139">Použití hostitele na základě metriky pro škálování je lepší pro hello následujících důvodů:</span><span class="sxs-lookup"><span data-stu-id="1c9f9-139">Using host based metrics for autoscale is better for hello following reasons:</span></span>
  
  * <span data-ttu-id="1c9f9-140">Méně přesunutí části jako žádná rozšíření diagnostiky potřebovat toobe nainstalována.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-140">Fewer moving parts as no diagnostics extensions need toobe installed.</span></span>
  * <span data-ttu-id="1c9f9-141">Jednodušší šablony.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-141">Simpler templates.</span></span> <span data-ttu-id="1c9f9-142">Stačí přidáte Statistika škálování pravidla tooan existující škálovací sady šablony.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-142">Just add insights autoscale rules tooan existing scale set template.</span></span>
  * <span data-ttu-id="1c9f9-143">Vytváření sestav spolehlivější a rychlejší spouštění nové virtuální počítače.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-143">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="1c9f9-144">Hello pouze důvodů, které že můžete pomocí diagnostiky rozšíření tookeep by pokud budete potřebovat paměti diagnostiky reporting/škálování.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-144">hello only reasons you might want tookeep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="1c9f9-145">Metriky hostitele na základě neoznamuje paměti.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-145">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="1c9f9-146">Si uvědomit pouze podle hello zbývající části tohoto článku Pokud stále používáte rozšíření diagnostiky pro vaše automatické škálování.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-146">With that in mind, only follow hello rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="1c9f9-147">Škálování ve službě Správce prostředků Azure můžete pracovat (ale už má k) prostřednictvím rozšíření virtuálního počítače, názvem hello rozšíření diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-147">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called hello Diagnostics Extension.</span></span> <span data-ttu-id="1c9f9-148">Ho vysílá výkonu dat tooa úložiště účet, který definujete v šabloně hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-148">It emits performance data tooa storage account you define in hello template.</span></span> <span data-ttu-id="1c9f9-149">Tato data se pak agregovat službou Azure monitorování hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-149">This data is then aggregated by hello Azure Monitor service.</span></span>
    
    <span data-ttu-id="1c9f9-150">Pokud hello službě Statistika nelze číst data z hello virtuálních počítačů, by mělo toosend vám e-mail – například pokud hello virtuální počítače byly dolů, proto zkontrolujte e-mailu (hello jeden jste zadali při vytváření hello účet Azure).</span><span class="sxs-lookup"><span data-stu-id="1c9f9-150">If hello Insights service can’t read data from hello VMs, it is supposed toosend you an email – for example if hello VMs were down, so check your email (hello one you specified when creating hello Azure account).</span></span>
    
    <span data-ttu-id="1c9f9-151">Můžete také přejít a prohlížet hello data.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-151">You can also go and look at hello data yourself.</span></span> <span data-ttu-id="1c9f9-152">Podívejte se na hello účtu úložiště Azure pomocí Průzkumníku cloudu.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-152">Look at hello Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="1c9f9-153">Například při použití hello [cloudu Průzkumníka Visual Studio](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), přihlaste se a vyberte hello předplatné Azure, který používáte a hello účet úložiště diagnostiky název odkazuje v hello Definice rozšíření diagnostiky ve vašem nasazení Šablona...</span><span class="sxs-lookup"><span data-stu-id="1c9f9-153">For example using hello [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick hello Azure subscription you’re using, and hello Diagnostics storage account name referenced in hello Diagnostics extension definition in your deployment template..</span></span>
    
    ![Průzkumník cloudu][explorer]
    
    <span data-ttu-id="1c9f9-155">Zde se zobrazí ve svazku tabulek, které ukládají hello dat z jednotlivých virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-155">Here you will see a bunch of tables where hello data from each VM is being stored.</span></span> <span data-ttu-id="1c9f9-156">Převádět Linux a hello procesoru metrika jako příklad, podívejte se na poslední řádky hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-156">Taking Linux and hello CPU metric as an example, look at hello most recent rows.</span></span> <span data-ttu-id="1c9f9-157">Průzkumník cloudu Hello Visual Studio podporuje dotazovací jazyk, takže je možné spustit dotaz jako "časové razítko gt data a času: 2016-02-02T21:20:00Z'" toomake zda získat hello nejaktuálnějších událostí (považovat za čas v UTC).</span><span class="sxs-lookup"><span data-stu-id="1c9f9-157">hello Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” toomake sure you get hello most recent events (assume time is in UTC).</span></span> <span data-ttu-id="1c9f9-158">Hello dat, které vidíte, že existuje odpovídají toohello škálování pravidla, která nastavíte?</span><span class="sxs-lookup"><span data-stu-id="1c9f9-158">Does hello data you see in there correspond toohello scale rules you set up?</span></span> <span data-ttu-id="1c9f9-159">V příkladu hello níže hello procesoru pro počítač 20 spuštění, zvýšit too100 % přes hello posledních 5 minut...</span><span class="sxs-lookup"><span data-stu-id="1c9f9-159">In hello example below, hello CPU for machine 20 started increasing too100% over hello last 5 minutes..</span></span>
    
    ![Úložiště tabulek][tables]
    
    <span data-ttu-id="1c9f9-161">Pokud není hello dat, pak předpokládají, že je hello problém s rozšířením diagnostiky hello spuštěné v hello virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-161">If hello data is not there, then it implies hello problem is with hello diagnostic extension running in hello VMs.</span></span> <span data-ttu-id="1c9f9-162">Pokud hello dat existuje, znamená to, jestli existuje problém s vaší pravidel škálování, nebo se službou Statistika hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-162">If hello data is there, it implies there is either a problem with your scale rules, or with hello Insights service.</span></span> <span data-ttu-id="1c9f9-163">Zkontrolujte [Azure stav](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="1c9f9-163">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="1c9f9-164">Jakmile jste byl pomocí těchto kroků, pokud máte pořád problémy škálování nešlo zkuste fóra hello [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), nebo [přetečení zásobníku](http://stackoverflow.com/questions/tagged/azure), nebo protokolu volání podpory.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-164">Once you’ve been through these steps, if you are still having autoscale problems you could try hello forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="1c9f9-165">Mít připravený tooshare hello šablony a zobrazení dat výkonu hello.</span><span class="sxs-lookup"><span data-stu-id="1c9f9-165">Be prepared tooshare hello template and a view of hello performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png

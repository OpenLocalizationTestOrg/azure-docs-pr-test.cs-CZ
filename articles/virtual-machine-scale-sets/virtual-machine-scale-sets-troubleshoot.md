---
title: "Řešení potíží s škálování s sady škálování virtuálního počítače | Microsoft Docs"
description: "Řešení potíží s škálování s sady škálování virtuálního počítače. Pochopení typické problémy vzniklé a způsob jejich řešení."
services: virtual-machine-scale-sets
documentationcenter: 
author: gbowerman
manager: timlt
editor: 
tags: azure-resource-manager
ms.assetid: c7d87b72-ee24-4e52-9377-a42f337f76fa
ms.service: virtual-machine-scale-sets
ms.workload: na
ms.tgt_pltfrm: windows
ms.devlang: na
ms.topic: article
ms.date: 10/28/2016
ms.author: guybo
ms.openlocfilehash: bd45a0fb99a77851aa7b91d23bd4b830b6f5cc7b
ms.sourcegitcommit: f537befafb079256fba0529ee554c034d73f36b0
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 07/11/2017
---
# <a name="troubleshooting-autoscale-with-virtual-machine-scale-sets"></a><span data-ttu-id="e07d5-104">Řešení potíží s škálování s sady škálování virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="e07d5-104">Troubleshooting autoscale with Virtual Machine Scale Sets</span></span>
<span data-ttu-id="e07d5-105">**Problém** – jste vytvořili automatické škálování infrastruktury v správce Azure Resource Manager pomocí sady škálování virtuálního počítače – například nasazením šablonu takto: https://github.com/Azure/azure-quickstart-templates/tree/master/201- vmss bottle škálování – máte definované pravidel škálování a vyhovující postup, s tím rozdílem, že bez ohledu na to, kolik zatížení vložíte na virtuálních počítačích, se nebude škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-105">**Problem** – you’ve created an autoscaling infrastructure in Azure Resource Manager using VM Scale Sets –  for example by deploying a template like this: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale  – you have your scale rules defined and it works great, except that no matter how much load you put on the VMs, it won’t autoscale.</span></span>

## <a name="troubleshooting-steps"></a><span data-ttu-id="e07d5-106">Řešení potíží</span><span class="sxs-lookup"><span data-stu-id="e07d5-106">Troubleshooting steps</span></span>
<span data-ttu-id="e07d5-107">Některé věci vzít v úvahu, patří:</span><span class="sxs-lookup"><span data-stu-id="e07d5-107">Some things to consider include:</span></span>

* <span data-ttu-id="e07d5-108">Kolik jader každý virtuální počítač nemá a jsou načítání každý jádra?</span><span class="sxs-lookup"><span data-stu-id="e07d5-108">How many cores does each VM have, and are you loading each core?</span></span>
  <span data-ttu-id="e07d5-109">Příklad šablony Azure Quickstart výše má do_work.php skript, který načte jediného jádra.</span><span class="sxs-lookup"><span data-stu-id="e07d5-109">The example Azure Quickstart template above has a do_work.php script, which loads a single core.</span></span> <span data-ttu-id="e07d5-110">Pokud používáte více než jedním jádrem velikost virtuálního počítače jako Standard_A1 nebo D1 virtuálního počítače je nutné ke spuštění této zatížení vícekrát.</span><span class="sxs-lookup"><span data-stu-id="e07d5-110">If you’re using a VM bigger than a single core VM size like Standard_A1 or D1 then you’d need to run this load multiple times.</span></span> <span data-ttu-id="e07d5-111">Zkontrolujte, kolik virtuálních počítačů cores kontrolou [velikosti pro systém Windows virtuálních počítačů v Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span><span class="sxs-lookup"><span data-stu-id="e07d5-111">Check how many cores your VMs by reviewing [Sizes for Windows virtual machines in Azure](../virtual-machines/windows/sizes.md?toc=%2fazure%2fvirtual-machines%2fwindows%2ftoc.json)</span></span>
* <span data-ttu-id="e07d5-112">Tom, kolik virtuálních počítačů v sadě virtuálních počítačů škálování, je pracujeme na každé z nich?</span><span class="sxs-lookup"><span data-stu-id="e07d5-112">How many VMs in the VM Scale Set, are you doing work on each one?</span></span>
  
    <span data-ttu-id="e07d5-113">Horizontální navýšení kapacity událostí bude trvat jenom při umístit průměrné využití procesoru mezi **všechny** virtuální počítače ve škálovací sadě překračuje prahovou hodnotu, časem interní definované v pravidlech automatického škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-113">A scale out event will only take place when the average CPU across **all** the VMs in a scale set exceeds the threshold value, over the time internal defined in the autoscale rules.</span></span>
* <span data-ttu-id="e07d5-114">Vynechali jste žádné události škálování?</span><span class="sxs-lookup"><span data-stu-id="e07d5-114">Did you miss any scale events?</span></span>
  
    <span data-ttu-id="e07d5-115">Zkontrolujte, zda že protokolů auditu na portálu Azure pro škálování události.</span><span class="sxs-lookup"><span data-stu-id="e07d5-115">Check the audit logs in the Azure portal for scale events.</span></span> <span data-ttu-id="e07d5-116">Možná se škálování nahoru a nebyla provedena vertikálně.</span><span class="sxs-lookup"><span data-stu-id="e07d5-116">Maybe there was a scale up and a scale down which was missed.</span></span> <span data-ttu-id="e07d5-117">Můžete filtrovat podle "Škálování"...</span><span class="sxs-lookup"><span data-stu-id="e07d5-117">You can filter by “Scale”..</span></span>
  
    ![Protokoly auditu][audit]
* <span data-ttu-id="e07d5-119">Jsou vaše škálování in a škálování prahové hodnoty dostatečně neliší?</span><span class="sxs-lookup"><span data-stu-id="e07d5-119">Are your scale-in and scale-out thresholds sufficiently different?</span></span>
  
    <span data-ttu-id="e07d5-120">Předpokládejme, že nastavíte pravidlo pro horizontální rozšíření kapacity, když průměrné využití procesoru je větší než 50 % za 5 minut a možnost škálování v Pokud průměrné využití procesoru je menší než 50 %.</span><span class="sxs-lookup"><span data-stu-id="e07d5-120">Suppose you set a rule to scale out when average CPU is greater than 50% over 5 minutes, and to scale in when average CPU is less than 50%.</span></span> <span data-ttu-id="e07d5-121">To by způsobilo "flapping" problém, při využití procesoru je blízko této prahové hodnoty s akcí škálování neustále zvýšení a snížení velikosti sady.</span><span class="sxs-lookup"><span data-stu-id="e07d5-121">This would cause a “flapping” problem when CPU usage is close to this threshold, with scale actions constantly increasing and decreasing the size of the set.</span></span> <span data-ttu-id="e07d5-122">Z toho důvodu škálování služby se pokusí zabránit "netřepotá", který můžete manifest jako není škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-122">Because of this, the autoscale service tries to prevent “flapping”, which can manifest as not scaling.</span></span> <span data-ttu-id="e07d5-123">Proto zkontrolujte, zda že se Škálováním na více systémů a škálování v prahové hodnoty dostatečně neliší umožňující nějaké místo mezi škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-123">Therefore make sure your scale-out and scale-in thresholds are sufficiently different to allow some space in between scaling.</span></span>
* <span data-ttu-id="e07d5-124">Můžete psát vlastní šablonu JSON?</span><span class="sxs-lookup"><span data-stu-id="e07d5-124">Did you write your own JSON template?</span></span>
  
    <span data-ttu-id="e07d5-125">Je snadné uděláte chyby, takže spuštění pomocí šablony jako ten, nad kterou je ověřené k práci a ujistěte se, malé přírůstkové změny.</span><span class="sxs-lookup"><span data-stu-id="e07d5-125">It is easy to make mistakes, so start with a template like the one above which is proven to work, and make small incremental changes.</span></span> 
* <span data-ttu-id="e07d5-126">Můžete je ručně škálovat, příchozí nebo odchozí?</span><span class="sxs-lookup"><span data-stu-id="e07d5-126">Can you manually scale in or out?</span></span>
  
    <span data-ttu-id="e07d5-127">Zkuste to znovu nasazení prostředků Škálovací sady virtuálního počítače s nastavením různých "kapacitou" ručně změnit počet virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="e07d5-127">Try redeploying the VM Scale Set resource with a different “capacity” setting to change the number of VMs manually.</span></span> <span data-ttu-id="e07d5-128">Šablonu příklad k tomu je tady: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – budete muset upravit šablonu a ujistit se, že má stejnou velikost počítače jako sady škálování používá.</span><span class="sxs-lookup"><span data-stu-id="e07d5-128">An example template to do this is here: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-scale-existing – you may need to edit the template to make sure it has the same machine size as your Scale Set is using.</span></span> <span data-ttu-id="e07d5-129">Pokud počet virtuálních počítačů můžete úspěšně ručně změnit, pak víte, že problém je izolovaný chcete používat automatické škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-129">If you can successfully change the number of VMs manually, then you know the problem is isolated to autoscale.</span></span>
* <span data-ttu-id="e07d5-130">Zkontrolujte vaše Microsoft.Compute/virtualMachineScaleSet a Microsoft.Insights prostředky v [Průzkumníka prostředků Azure](https://resources.azure.com/)</span><span class="sxs-lookup"><span data-stu-id="e07d5-130">Check your Microsoft.Compute/virtualMachineScaleSet, and Microsoft.Insights resources in the [Azure Resource Explorer](https://resources.azure.com/)</span></span>
  
    <span data-ttu-id="e07d5-131">To je nezbytné nástroj řešení potíží se zobrazí stav svých prostředků Azure Resource Manager.</span><span class="sxs-lookup"><span data-stu-id="e07d5-131">This is an indispensable troubleshooting tool which shows you the state of your Azure Resource Manager resources.</span></span> <span data-ttu-id="e07d5-132">Klikněte na vaše předplatné a podívejte se na skupinu prostředků, řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="e07d5-132">Click on your subscription and look at the Resource Group you are troubleshooting.</span></span> <span data-ttu-id="e07d5-133">V rámci zprostředkovatele prostředků výpočetního podívejte se na sady škálování virtuálního počítače jste vytvořili a zkontrolujte zobrazení Instance, která ukazuje stav nasazení.</span><span class="sxs-lookup"><span data-stu-id="e07d5-133">Under the Compute resource provider look at the VM Scale Set you created and check the Instance View, which shows you the state of a deployment.</span></span> <span data-ttu-id="e07d5-134">Také zkontrolujte zobrazení instance virtuální počítače ve Škálovací sadě virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="e07d5-134">Also check the instance view of VMs in the VM Scale Set.</span></span> <span data-ttu-id="e07d5-135">Pak přejděte do zprostředkovatele prostředků Microsoft.Insights a zkontrolujte, zda že pravidla škálování vypadat dobře.</span><span class="sxs-lookup"><span data-stu-id="e07d5-135">Then go into the Microsoft.Insights resource provider and check the autoscale rules look good.</span></span>
* <span data-ttu-id="e07d5-136">Je rozšíření diagnostiky práce a generování údaje o výkonu?</span><span class="sxs-lookup"><span data-stu-id="e07d5-136">Is the Diagnostic extension working and emitting performance data?</span></span>
  
    <span data-ttu-id="e07d5-137">**Aktualizace:** Azure automatického škálování je vylepšená tak, aby pomocí kanálu hostitele na základě metriky, které už vyžaduje rozšíření diagnostiky k instalaci.</span><span class="sxs-lookup"><span data-stu-id="e07d5-137">**Update:** Azure autoscale has been enhanced to use a host based metrics pipeline which no longer requires a diagnostics extension to be installed.</span></span> <span data-ttu-id="e07d5-138">To znamená další, které několik odstavců přestanou platit, pokud vytvoříte automatické škálování aplikace pomocí nový kanál.</span><span class="sxs-lookup"><span data-stu-id="e07d5-138">This means the next few paragraphs no longer apply if you create an autoscaling application using the new pipeline.</span></span> <span data-ttu-id="e07d5-139">Příklad šablony Azure, které byly převedeny na použití kanálu hostitele je: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span><span class="sxs-lookup"><span data-stu-id="e07d5-139">An example of Azure templates which have been converted to use the host pipeline is: https://github.com/Azure/azure-quickstart-templates/tree/master/201-vmss-bottle-autoscale.</span></span> 
  
    <span data-ttu-id="e07d5-140">Použití hostitele na základě metriky pro škálování je lepší z následujících důvodů:</span><span class="sxs-lookup"><span data-stu-id="e07d5-140">Using host based metrics for autoscale is better for the following reasons:</span></span>
  
  * <span data-ttu-id="e07d5-141">Méně přesunutí části jako žádná rozšíření diagnostiky je potřeba nainstalovat.</span><span class="sxs-lookup"><span data-stu-id="e07d5-141">Fewer moving parts as no diagnostics extensions need to be installed.</span></span>
  * <span data-ttu-id="e07d5-142">Jednodušší šablony.</span><span class="sxs-lookup"><span data-stu-id="e07d5-142">Simpler templates.</span></span> <span data-ttu-id="e07d5-143">Stačí přidáte pravidla škálování Statistika do stávající šablony sady škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-143">Just add insights autoscale rules to an existing scale set template.</span></span>
  * <span data-ttu-id="e07d5-144">Vytváření sestav spolehlivější a rychlejší spouštění nové virtuální počítače.</span><span class="sxs-lookup"><span data-stu-id="e07d5-144">More reliable reporting and faster launching of new VMs.</span></span>
    
    <span data-ttu-id="e07d5-145">Pouze z důvodů, které že můžete dál používat příponu diagnostiky by, pokud je třeba paměť diagnostiky reporting/škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-145">The only reasons you might want to keep using a diagnostic extension would be if you need memory diagnostics reporting/scaling.</span></span> <span data-ttu-id="e07d5-146">Metriky hostitele na základě neoznamuje paměti.</span><span class="sxs-lookup"><span data-stu-id="e07d5-146">Host based metrics doesn't report memory.</span></span>
    
    <span data-ttu-id="e07d5-147">Si uvědomit pouze podle zbývající části tohoto článku Pokud stále používáte rozšíření diagnostiky pro vaše automatické škálování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-147">With that in mind, only follow the rest of this article if you are still using diagnostic extensions for your autoscaling.</span></span>
    
    <span data-ttu-id="e07d5-148">Škálování ve službě Správce prostředků Azure můžete pracovat (ale už má k) prostřednictvím virtuálního počítače rozšíření nazývá rozšíření diagnostiky.</span><span class="sxs-lookup"><span data-stu-id="e07d5-148">Autoscale in Azure Resource Manager can work (but no longer has to) by means of a VM extension called the Diagnostics Extension.</span></span> <span data-ttu-id="e07d5-149">Ho vysílá údaje o výkonu pro účet úložiště, který definujete v šabloně.</span><span class="sxs-lookup"><span data-stu-id="e07d5-149">It emits performance data to a storage account you define in the template.</span></span> <span data-ttu-id="e07d5-150">Tato data se shromažďují potom pomocí služby Azure monitorování.</span><span class="sxs-lookup"><span data-stu-id="e07d5-150">This data is then aggregated by the Azure Monitor service.</span></span>
    
    <span data-ttu-id="e07d5-151">Pokud služba statistika nelze číst data z virtuálních počítačů, by měla odeslat e-mailu – například pokud virtuální počítače byly dolů, proto zkontrolujte e-mailu (ten, který jste zadali při vytváření účtu Azure).</span><span class="sxs-lookup"><span data-stu-id="e07d5-151">If the Insights service can’t read data from the VMs, it is supposed to send you an email – for example if the VMs were down, so check your email (the one you specified when creating the Azure account).</span></span>
    
    <span data-ttu-id="e07d5-152">Můžete také přejít a prohlížet data.</span><span class="sxs-lookup"><span data-stu-id="e07d5-152">You can also go and look at the data yourself.</span></span> <span data-ttu-id="e07d5-153">Podívejte se na účtu úložiště Azure pomocí Průzkumníku cloudu.</span><span class="sxs-lookup"><span data-stu-id="e07d5-153">Look at the Azure storage account using a cloud explorer.</span></span> <span data-ttu-id="e07d5-154">Například při použití [cloudu Průzkumníka Visual Studio](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), přihlaste se a vyberte předplatné Azure, které používáte a název účtu úložiště diagnostiky odkazuje v definici rozšíření diagnostiky v šabloně nasazení...</span><span class="sxs-lookup"><span data-stu-id="e07d5-154">For example using the [Visual Studio Cloud Explorer](https://visualstudiogallery.msdn.microsoft.com/aaef6e67-4d99-40bc-aacf-662237db85a2), log in and pick the Azure subscription you’re using, and the Diagnostics storage account name referenced in the Diagnostics extension definition in your deployment template..</span></span>
    
    ![Průzkumník cloudu][explorer]
    
    <span data-ttu-id="e07d5-156">Zde se zobrazí ve svazku tabulek, které ukládají data z jednotlivých virtuálních počítačů.</span><span class="sxs-lookup"><span data-stu-id="e07d5-156">Here you will see a bunch of tables where the data from each VM is being stored.</span></span> <span data-ttu-id="e07d5-157">Převádět Linux a metriku procesoru jako příklad, podívejte se na poslední řádky.</span><span class="sxs-lookup"><span data-stu-id="e07d5-157">Taking Linux and the CPU metric as an example, look at the most recent rows.</span></span> <span data-ttu-id="e07d5-158">Průzkumník cloudu Visual Studio podporuje dotazovací jazyk, takže je možné spustit dotaz jako "časové razítko gt data a času: 2016-02-02T21:20:00Z'" a ujistěte se, získat nejnovější události (považovat za čas v UTC).</span><span class="sxs-lookup"><span data-stu-id="e07d5-158">The Visual Studio cloud explorer supports a query language so you can run a query like “Timestamp gt datetime’2016-02-02T21:20:00Z’” to make sure you get the most recent events (assume time is in UTC).</span></span> <span data-ttu-id="e07d5-159">Podporuje dat, které vidíte, že existuje odpovídají pravidlům škálování při nastavování?</span><span class="sxs-lookup"><span data-stu-id="e07d5-159">Does the data you see in there correspond to the scale rules you set up?</span></span> <span data-ttu-id="e07d5-160">V následujícím příkladu procesoru pro počítač 20 spuštění, zvýšit na 100 % za posledních 5 minut...</span><span class="sxs-lookup"><span data-stu-id="e07d5-160">In the example below, the CPU for machine 20 started increasing to 100% over the last 5 minutes..</span></span>
    
    ![Úložiště tabulek][tables]
    
    <span data-ttu-id="e07d5-162">Pokud není data, pak předpokládají, že je problém s příponou diagnostiky spuštěna ve virtuálních počítačích.</span><span class="sxs-lookup"><span data-stu-id="e07d5-162">If the data is not there, then it implies the problem is with the diagnostic extension running in the VMs.</span></span> <span data-ttu-id="e07d5-163">Pokud data existuje, znamená to, jestli existuje problém s vaší pravidel škálování, nebo se službou Statistika.</span><span class="sxs-lookup"><span data-stu-id="e07d5-163">If the data is there, it implies there is either a problem with your scale rules, or with the Insights service.</span></span> <span data-ttu-id="e07d5-164">Zkontrolujte [Azure stav](https://azure.microsoft.com/status/).</span><span class="sxs-lookup"><span data-stu-id="e07d5-164">Check [Azure Status](https://azure.microsoft.com/status/).</span></span>
    
    <span data-ttu-id="e07d5-165">Jakmile jste byl pomocí těchto kroků, pokud máte pořád problémy škálování může vyzkoušejte ve fórech na [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), nebo [přetečení zásobníku](http://stackoverflow.com/questions/tagged/azure), nebo protokolu volání podpory.</span><span class="sxs-lookup"><span data-stu-id="e07d5-165">Once you’ve been through these steps, if you are still having autoscale problems you could try the forums on [MSDN](https://social.msdn.microsoft.com/forums/azure/home?category=windowsazureplatform%2Cazuremarketplace%2Cwindowsazureplatformctp), or [Stack overflow](http://stackoverflow.com/questions/tagged/azure), or log a support call.</span></span> <span data-ttu-id="e07d5-166">Připravte se na sdílet šablony a zobrazení dat výkonu.</span><span class="sxs-lookup"><span data-stu-id="e07d5-166">Be prepared to share the template and a view of the performance data.</span></span>

[audit]: ./media/virtual-machine-scale-sets-troubleshoot/image3.png
[explorer]: ./media/virtual-machine-scale-sets-troubleshoot/image1.png
[tables]: ./media/virtual-machine-scale-sets-troubleshoot/image4.png

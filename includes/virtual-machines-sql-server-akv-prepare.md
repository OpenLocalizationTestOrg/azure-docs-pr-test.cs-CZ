## <a name="prepare-for-akv-integration"></a><span data-ttu-id="a7029-101">Příprava pro integrace se službou AZURE</span><span class="sxs-lookup"><span data-stu-id="a7029-101">Prepare for AKV Integration</span></span>
<span data-ttu-id="a7029-102">Použití Azure Key Vault integrace ke konfiguraci virtuálního počítače SQL serveru, existuje několik předpokladů:</span><span class="sxs-lookup"><span data-stu-id="a7029-102">To use Azure Key Vault Integration to configure your SQL Server VM, there are several prerequisites:</span></span> 

1. [<span data-ttu-id="a7029-103">Instalace prostředí Azure Powershell</span><span class="sxs-lookup"><span data-stu-id="a7029-103">Install Azure Powershell</span></span>](#install-azure-powershell)
2. [<span data-ttu-id="a7029-104">Vytvoření služby Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a7029-104">Create an Azure Active Directory</span></span>](#create-an-azure-active-directory)
3. [<span data-ttu-id="a7029-105">Vytvoření trezoru klíčů</span><span class="sxs-lookup"><span data-stu-id="a7029-105">Create a key vault</span></span>](#create-a-key-vault)

<span data-ttu-id="a7029-106">Následující části popisují tyto požadavky a informace, které je třeba shromáždit později rutin prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7029-106">The following sections describe these prerequisites and the information you need to collect to later run the PowerShell cmdlets.</span></span>

### <a name="install-azure-powershell"></a><span data-ttu-id="a7029-107">Instalace prostředí Azure PowerShell</span><span class="sxs-lookup"><span data-stu-id="a7029-107">Install Azure PowerShell</span></span>
<span data-ttu-id="a7029-108">Ujistěte se, že jste nainstalovali nejnovější sadu Azure PowerShell SDK.</span><span class="sxs-lookup"><span data-stu-id="a7029-108">Make sure you have installed the latest Azure PowerShell SDK.</span></span> <span data-ttu-id="a7029-109">Další informace najdete v tématu [Instalace a konfigurace Azure PowerShellu](/powershell/azureps-cmdlets-docs).</span><span class="sxs-lookup"><span data-stu-id="a7029-109">For more information, see [How to install and configure Azure PowerShell](/powershell/azureps-cmdlets-docs).</span></span>

### <a name="create-an-azure-active-directory"></a><span data-ttu-id="a7029-110">Vytvoření služby Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="a7029-110">Create an Azure Active Directory</span></span>
<span data-ttu-id="a7029-111">Nejdřív je potřeba mít [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) v rámci vašeho předplatného.</span><span class="sxs-lookup"><span data-stu-id="a7029-111">First, you need to have an [Azure Active Directory](https://azure.microsoft.com/trial/get-started-active-directory/) (AAD) in your subscription.</span></span> <span data-ttu-id="a7029-112">Mezi řadu výhod to umožňuje udělit oprávnění k trezoru klíčů pro některé uživatele a aplikace.</span><span class="sxs-lookup"><span data-stu-id="a7029-112">Among many benefits, this allows you to grant permission to your key vault for certain users and applications.</span></span>

<span data-ttu-id="a7029-113">V dalším kroku zaregistrujte aplikaci v AAD.</span><span class="sxs-lookup"><span data-stu-id="a7029-113">Next, register an application with AAD.</span></span> <span data-ttu-id="a7029-114">Tím získáte účet instanční objekt, který má přístup k trezoru klíčů, který bude potřebovat virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="a7029-114">This will give you a Service Principal account that has access to your key vault which your VM will need.</span></span> <span data-ttu-id="a7029-115">V článku Azure Key Vault, můžete najít tyto kroky v [zaregistrovat aplikaci s Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) oddílu, nebo můžete zobrazit kroky se snímky obrazovky v **získat identity pro oddílu aplikace**  z [tomto příspěvku na blogu](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span><span class="sxs-lookup"><span data-stu-id="a7029-115">In the Azure Key Vault article, you can find these steps in the [Register an application with Azure Active Directory](../articles/key-vault/key-vault-get-started.md#register) section, or you can see the steps with screen shots in the **Get an identity for the application section** of [this blog post](http://blogs.technet.com/b/kv/archive/2015/01/09/azure-key-vault-step-by-step.aspx).</span></span> <span data-ttu-id="a7029-116">Před dokončením těchto kroků, mějte na paměti, která potřebujete shromáždit tyto informace během této registrace, který je potřeba později, když povolíte na virtuální počítač SQL Azure Key Vault integrace.</span><span class="sxs-lookup"><span data-stu-id="a7029-116">Before completing these steps, note that you need to collect the following information during this registration that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

* <span data-ttu-id="a7029-117">Po přidání aplikace najít **ID klienta** na **konfigurace** kartě.</span><span class="sxs-lookup"><span data-stu-id="a7029-117">After the application is added, find the **CLIENT ID**  on the **CONFIGURE** tab.</span></span> 
    <span data-ttu-id="a7029-118">![ID klienta Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span><span class="sxs-lookup"><span data-stu-id="a7029-118">![Azure Active Directory Client ID](./media/virtual-machines-sql-server-akv-prepare/aad-client-id.png)</span></span>
  
    <span data-ttu-id="a7029-119">ID klienta je přiřazen později **$spName** parametr (Service Principal name) ve skriptu prostředí PowerShell povolit Azure Key Vault integraci.</span><span class="sxs-lookup"><span data-stu-id="a7029-119">The client ID is assigned later to the **$spName** (Service Principal name) parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span> 
* <span data-ttu-id="a7029-120">Navíc při provádění těchto kroků při vytváření klíče zkopírujte tajný klíč pro váš klíč znázorněné na následujícím snímku obrazovky.</span><span class="sxs-lookup"><span data-stu-id="a7029-120">Also, during these steps when you create your key, copy the secret for your key as is shown in the following screenshot.</span></span> <span data-ttu-id="a7029-121">Tento klíč tajný klíč je přiřazen později **$spSecret** parametr (Service Principal tajný klíč) ve skriptu prostředí PowerShell.</span><span class="sxs-lookup"><span data-stu-id="a7029-121">This key secret is assigned later to the **$spSecret** (Service Principal secret) parameter in the PowerShell script.</span></span>  
    <span data-ttu-id="a7029-122">![Tajný klíč služby Azure Active Directory](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span><span class="sxs-lookup"><span data-stu-id="a7029-122">![Azure Active Directory Secret](./media/virtual-machines-sql-server-akv-prepare/aad-sp-secret.png)</span></span>
* <span data-ttu-id="a7029-123">Je nutné autorizovat toto nové ID klienta do mají následující přístupová oprávnění: **šifrování**, **dešifrovat**, **wrapKey**, **unwrapKey**, **přihlašovací**, a **ověřte**.</span><span class="sxs-lookup"><span data-stu-id="a7029-123">You must authorize this new client ID to have the following access permissions: **encrypt**, **decrypt**, **wrapKey**, **unwrapKey**, **sign**, and **verify**.</span></span> <span data-ttu-id="a7029-124">To lze provést pomocí [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) rutiny.</span><span class="sxs-lookup"><span data-stu-id="a7029-124">This is done with the [Set-AzureRmKeyVaultAccessPolicy](https://msdn.microsoft.com/library/azure/mt603625.aspx) cmdlet.</span></span> <span data-ttu-id="a7029-125">Další informace najdete v části [autorizovat aplikaci pro použití klíče nebo tajného klíče](../articles/key-vault/key-vault-get-started.md#authorize).</span><span class="sxs-lookup"><span data-stu-id="a7029-125">For more information see [Authorize the application to use the key or secret](../articles/key-vault/key-vault-get-started.md#authorize).</span></span>

### <a name="create-a-key-vault"></a><span data-ttu-id="a7029-126">Vytvořte trezor klíčů</span><span class="sxs-lookup"><span data-stu-id="a7029-126">Create a key vault</span></span>
<span data-ttu-id="a7029-127">Abyste mohli používat Azure Key Vault pro ukládání klíčů, které chcete použít pro šifrování v virtuálního počítače, potřebujete přístup k trezoru klíčů.</span><span class="sxs-lookup"><span data-stu-id="a7029-127">In order to use Azure Key Vault to store the keys you will use for encryption in your VM, you need access to a key vault.</span></span> <span data-ttu-id="a7029-128">Pokud již jste nenastavili trezoru klíčů, vytvořte ho pomocí následujících kroků v [Začínáme s Azure Key Vault](../articles/key-vault/key-vault-get-started.md) tématu.</span><span class="sxs-lookup"><span data-stu-id="a7029-128">If you have not already set up your key vault, create one by following the steps in the [Getting Started with Azure Key Vault](../articles/key-vault/key-vault-get-started.md) topic.</span></span> <span data-ttu-id="a7029-129">Před dokončením těchto kroků, Všimněte si, že některé informace, které je třeba během toto nastavení, shromažďovat budete později potřebovat když povolíte na virtuální počítač SQL Azure Key Vault integrace.</span><span class="sxs-lookup"><span data-stu-id="a7029-129">Before completing these steps, note that there is some information you need to collect during this set up that is needed later when you enable Azure Key Vault Integration on your SQL VM.</span></span>

<span data-ttu-id="a7029-130">Když získáte vytvořením krok trezoru klíčů, Všimněte si vrácený **vaultUri** vlastnosti, která je adresa URL trezoru klíčů.</span><span class="sxs-lookup"><span data-stu-id="a7029-130">When you get to the Create a key vault step, note the returned **vaultUri** property, which is the key vault URL.</span></span> <span data-ttu-id="a7029-131">V příkladu v tomto kroku, vidíte níže, že název trezoru klíčů je ContosoKeyVault proto adresu URL trezoru klíčů by být https://contosokeyvault.vault.azure.net/.</span><span class="sxs-lookup"><span data-stu-id="a7029-131">In the example provided in that step, shown below, the key vault name is ContosoKeyVault, therefore the key vault URL would be https://contosokeyvault.vault.azure.net/.</span></span>

    New-AzureRmKeyVault -VaultName 'ContosoKeyVault' -ResourceGroupName 'ContosoResourceGroup' -Location 'East Asia'

<span data-ttu-id="a7029-132">Adresa URL trezoru klíčů je přiřazen později **$akvURL** parametr ve skriptu prostředí PowerShell povolit Azure Key Vault integraci.</span><span class="sxs-lookup"><span data-stu-id="a7029-132">The key vault URL is assigned later to the **$akvURL** parameter in the PowerShell script to enable Azure Key Vault Integration.</span></span>


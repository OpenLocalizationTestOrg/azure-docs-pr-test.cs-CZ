# <a name="back-up-azure-unmanaged-vm-disks-with-incremental-snapshots"></a><span data-ttu-id="633d1-101">Zálohování Azure nespravované disky virtuálních počítačů s přírůstkové snímky</span><span class="sxs-lookup"><span data-stu-id="633d1-101">Back up Azure unmanaged VM disks with incremental snapshots</span></span>
## <a name="overview"></a><span data-ttu-id="633d1-102">Přehled</span><span class="sxs-lookup"><span data-stu-id="633d1-102">Overview</span></span>
<span data-ttu-id="633d1-103">Úložiště Azure poskytuje schopnost pořizovat snímky objektů BLOB.</span><span class="sxs-lookup"><span data-stu-id="633d1-103">Azure Storage provides the capability to take snapshots of blobs.</span></span> <span data-ttu-id="633d1-104">Snímky zaznamenání stavu objektů blob v tomto bodě v čase.</span><span class="sxs-lookup"><span data-stu-id="633d1-104">Snapshots capture the blob state at that point in time.</span></span> <span data-ttu-id="633d1-105">V tomto článku jsme popisují scénáře, ve kterém můžete spravovat zálohy disků virtuálních počítačů pomocí snímků.</span><span class="sxs-lookup"><span data-stu-id="633d1-105">In this article, we describe a scenario in which you can maintain backups of virtual machine disks using snapshots.</span></span> <span data-ttu-id="633d1-106">Můžete použít tuto metodu, když jste zvolit nepoužívání Azure zálohování a obnovení služby a chcete vytvořit vlastní strategii zálohování pro disky virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="633d1-106">You can use this methodology when you choose not to use Azure Backup and Recovery Service, and wish to create a custom backup strategy for your virtual machine disks.</span></span>

<span data-ttu-id="633d1-107">Disky virtuálních počítačů Azure jsou uloženy jako objekty BLOB stránky ve službě Azure Storage.</span><span class="sxs-lookup"><span data-stu-id="633d1-107">Azure virtual machine disks are stored as page blobs in Azure Storage.</span></span> <span data-ttu-id="633d1-108">Vzhledem k tomu, že jsme se s popisem strategie zálohování pro disky virtuálního počítače v tomto článku, označujeme snímky v souvislosti s objekty BLOB stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-108">Since we are describing a backup strategy for virtual machine disks in this article, we refer to snapshots in the context of page blobs.</span></span> <span data-ttu-id="633d1-109">Další informace o snímků, najdete v tématu [vytvoření snímku objektu Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span><span class="sxs-lookup"><span data-stu-id="633d1-109">To learn more about snapshots, refer to [Creating a Snapshot of a Blob](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob).</span></span>

## <a name="what-is-a-snapshot"></a><span data-ttu-id="633d1-110">Co je snímek?</span><span class="sxs-lookup"><span data-stu-id="633d1-110">What is a snapshot?</span></span>
<span data-ttu-id="633d1-111">Objekt blob snímek je jen pro čtení verze objektu blob zachycenou v bodě v čase.</span><span class="sxs-lookup"><span data-stu-id="633d1-111">A blob snapshot is a read-only version of a blob that is captured at a point in time.</span></span> <span data-ttu-id="633d1-112">Po vytvoření snímku, ho můžete číst, kopírovat, nebo odstranit, ale nedojde ke změně.</span><span class="sxs-lookup"><span data-stu-id="633d1-112">Once a snapshot has been created, it can be read, copied, or deleted, but not modified.</span></span> <span data-ttu-id="633d1-113">Snímky poskytují způsob, jak zálohovat objekt blob, jak se objevuje v časovém okamžiku.</span><span class="sxs-lookup"><span data-stu-id="633d1-113">Snapshots provide a way to back up a blob as it appears at a moment in time.</span></span> <span data-ttu-id="633d1-114">Dokud REST verze 2015-04-05 bylo možnost Kopírovat úplné snímky.</span><span class="sxs-lookup"><span data-stu-id="633d1-114">Until REST version 2015-04-05, you had the ability to copy full snapshots.</span></span> <span data-ttu-id="633d1-115">S ostatními verze 2015-07-08 a vyšší, můžete také můžete zkopírovat přírůstkové snímky.</span><span class="sxs-lookup"><span data-stu-id="633d1-115">With the REST version 2015-07-08 and above, you can also copy incremental snapshots.</span></span>

## <a name="full-snapshot-copy"></a><span data-ttu-id="633d1-116">Kopírování úplné snímku</span><span class="sxs-lookup"><span data-stu-id="633d1-116">Full snapshot copy</span></span>
<span data-ttu-id="633d1-117">Snímky je možné zkopírovat do jiného účtu úložiště jako objekt blob zachovat zálohy základní objekt blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-117">Snapshots can be copied to another storage account as a blob to keep backups of the base blob.</span></span> <span data-ttu-id="633d1-118">Můžete také zkopírovat snímek přes jeho základní objekt blob, které je třeba obnovení objektu blob na starší verzi.</span><span class="sxs-lookup"><span data-stu-id="633d1-118">You can also copy a snapshot over its base blob, which is like restoring the blob to an earlier version.</span></span> <span data-ttu-id="633d1-119">Po zkopírování snímek z jednoho účtu úložiště do druhého zabírá na stejném místě jako objekt blob základní stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-119">When a snapshot is copied from one storage account to another, it occupies the same space as the base page blob.</span></span> <span data-ttu-id="633d1-120">Proto kopírování celou snímky z jednoho účtu úložiště do druhého je pomalé a spotřebuje, kolik místa v cílový účet úložiště.</span><span class="sxs-lookup"><span data-stu-id="633d1-120">Therefore, copying whole snapshots from one storage account to another is slow and consumes much space in the target storage account.</span></span>

> [!NOTE]
> <span data-ttu-id="633d1-121">Pokud základní objekt blob zkopírujete na jiný cíl, nejsou spolu se ji zkopírovat snímky objektu blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-121">If you copy the base blob to another destination, the snapshots of the blob are not copied along with it.</span></span> <span data-ttu-id="633d1-122">Podobně přepíšete základní objekt blob se kopie, neovlivní snímky přidružené základní objekt blob a zůstanou beze změn v části název základního objektu blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-122">Similarly, if you overwrite a base blob with a copy, snapshots associated with the base blob are not affected and stay intact under the base blob name.</span></span>
> 
> 

### <a name="back-up-disks-using-snapshots"></a><span data-ttu-id="633d1-123">Zálohovat disky pomocí snímků</span><span class="sxs-lookup"><span data-stu-id="633d1-123">Back up disks using snapshots</span></span>
<span data-ttu-id="633d1-124">Jako strategie zálohování pro disky virtuálního počítače, můžete využít pravidelné snímky objektu blob disk nebo stránce a kopírování je do jiného úložiště účtu pomocí nástroje jako [kopírovat objekt Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operaci nebo [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span><span class="sxs-lookup"><span data-stu-id="633d1-124">As a backup strategy for your virtual machine disks, you can take periodic snapshots of the disk or page blob, and copy them to another storage account using tools like [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) operation or [AzCopy](../articles/storage/common/storage-use-azcopy.md).</span></span> <span data-ttu-id="633d1-125">Snímek můžete zkopírovat na cílový objekt blob stránky s jiným názvem.</span><span class="sxs-lookup"><span data-stu-id="633d1-125">You can copy a snapshot to a destination page blob with a different name.</span></span> <span data-ttu-id="633d1-126">Výsledný objekt blob stránky cílové je objekt blob stránky lze zapisovat a není snímek.</span><span class="sxs-lookup"><span data-stu-id="633d1-126">The resulting destination page blob is a writeable page blob and not a snapshot.</span></span> <span data-ttu-id="633d1-127">Později v tomto článku jsme popisují kroky pro zálohování disky virtuálního počítače pomocí snímků.</span><span class="sxs-lookup"><span data-stu-id="633d1-127">Later in this article, we describe steps to take backups of virtual machine disks using snapshots.</span></span>

### <a name="restore-disks-using-snapshots"></a><span data-ttu-id="633d1-128">Obnovení disků pomocí snímků</span><span class="sxs-lookup"><span data-stu-id="633d1-128">Restore disks using snapshots</span></span>
<span data-ttu-id="633d1-129">Pokud nastane čas k obnovení vašeho disku stabilní verzi, která byla dříve zaznamenána v jednom z snímků zálohy, můžete zkopírovat snímek přes základní stránky objektu blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-129">When it is time to restore your disk to a stable version that was previously captured in one of the backup snapshots, you can copy a snapshot over the base page blob.</span></span> <span data-ttu-id="633d1-130">Po snímku je propagována do základní stránky objektu blob, zůstanou snímku, ale dojde k přepsání zdrojem kopie, kterou může být číst a zapisovat.</span><span class="sxs-lookup"><span data-stu-id="633d1-130">After the snapshot is promoted to the base page blob, the snapshot remains, but its source is overwritten with a copy that can be both read and written.</span></span> <span data-ttu-id="633d1-131">Později v tomto článku jsme popisují postup obnovit předchozí verze disku z jeho snímků.</span><span class="sxs-lookup"><span data-stu-id="633d1-131">Later in this article we describe steps to restore a previous version of your disk from its snapshot.</span></span>

### <a name="implementing-full-snapshot-copy"></a><span data-ttu-id="633d1-132">Implementace kopie úplné snímku</span><span class="sxs-lookup"><span data-stu-id="633d1-132">Implementing full snapshot copy</span></span>
<span data-ttu-id="633d1-133">Pomocí těchto kroků můžete implementovat kopii úplné snímku</span><span class="sxs-lookup"><span data-stu-id="633d1-133">You can implement a full snapshot copy by doing the following,</span></span>

* <span data-ttu-id="633d1-134">Nejprve vytvořte snímek pomocí základní objekt blob [snímku Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operaci.</span><span class="sxs-lookup"><span data-stu-id="633d1-134">First, take a snapshot of the base blob using the [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) operation.</span></span>
* <span data-ttu-id="633d1-135">Zkopírujte snímek pomocí účet cílového úložiště [kopírovat objekt Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="633d1-135">Then, copy the snapshot to a target storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span>
* <span data-ttu-id="633d1-136">Opakujte tento postup k udržování záložní kopie vaše základní objekt blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-136">Repeat this process to maintain backup copies of your base blob.</span></span>

## <a name="incremental-snapshot-copy"></a><span data-ttu-id="633d1-137">Kopírování přírůstkový snímek</span><span class="sxs-lookup"><span data-stu-id="633d1-137">Incremental snapshot copy</span></span>
<span data-ttu-id="633d1-138">Nová funkce v [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) rozhraní API poskytuje mnohem lepší způsob, jak zálohovat snímky objekty BLOB stránky nebo disků.</span><span class="sxs-lookup"><span data-stu-id="633d1-138">The new feature in the [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) API provides a much better way to back up the snapshots of your page blobs or disks.</span></span> <span data-ttu-id="633d1-139">Rozhraní API vrátí seznam změn mezi základní objekt blob a snímky, což snižuje množství prostoru úložiště použít na účet záloh.</span><span class="sxs-lookup"><span data-stu-id="633d1-139">The API returns the list of changes between the base blob and the snapshots, which reduces the amount of storage space used on the backup account.</span></span> <span data-ttu-id="633d1-140">Rozhraní API podporuje objekty BLOB stránky na Storage úrovně Premium, jakož i úložiště Standard Storage.</span><span class="sxs-lookup"><span data-stu-id="633d1-140">The API supports page blobs on Premium Storage as well as Standard Storage.</span></span> <span data-ttu-id="633d1-141">Toto rozhraní API používáte, můžete vytvořit rychlejší a efektivnější řešení zálohování pro virtuální počítače Azure.</span><span class="sxs-lookup"><span data-stu-id="633d1-141">Using this API, you can build faster and more efficient backup solutions for Azure VMs.</span></span> <span data-ttu-id="633d1-142">Toto rozhraní API bude k dispozici REST verze 2015-07-08 a vyšší.</span><span class="sxs-lookup"><span data-stu-id="633d1-142">This API will be available with the REST version 2015-07-08 and higher.</span></span>

<span data-ttu-id="633d1-143">Přírůstkové kopie snímků umožňuje kopírovat z jednoho účtu úložiště do druhého rozdíl mezi,</span><span class="sxs-lookup"><span data-stu-id="633d1-143">Incremental Snapshot Copy allows you to copy from one storage account to another the difference between,</span></span>

* <span data-ttu-id="633d1-144">Základní objekt blob a jeho snímek nebo</span><span class="sxs-lookup"><span data-stu-id="633d1-144">Base blob and its Snapshot OR</span></span>
* <span data-ttu-id="633d1-145">Všechny dva snímky základní objekt blob</span><span class="sxs-lookup"><span data-stu-id="633d1-145">Any two snapshots of the base blob</span></span>

<span data-ttu-id="633d1-146">Za předpokladu, že jsou splněny následující podmínky,</span><span class="sxs-lookup"><span data-stu-id="633d1-146">Provided the following conditions are met,</span></span>

* <span data-ttu-id="633d1-147">Objekt blob byl vytvořen ledna-1-2016 nebo novější.</span><span class="sxs-lookup"><span data-stu-id="633d1-147">The blob was created on Jan-1-2016 or later.</span></span>
* <span data-ttu-id="633d1-148">Objekt blob nebyla přepsána [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) nebo [kopírovat objekt Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) mezi dvěma snímky.</span><span class="sxs-lookup"><span data-stu-id="633d1-148">The blob was not overwritten with [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) or [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob) between two snapshots.</span></span>

<span data-ttu-id="633d1-149">**Poznámka:**: Tato funkce je dostupná pro Premium a Standard objekty BLOB stránky Azure.</span><span class="sxs-lookup"><span data-stu-id="633d1-149">**Note**: This feature is available for Premium and Standard Azure Page Blobs.</span></span>

<span data-ttu-id="633d1-150">Až budete mít vlastní strategii zálohování pomocí snímků, kopírování snímky z jednoho účtu úložiště do druhého může být pomalé a spotřebovat velké úložiště.</span><span class="sxs-lookup"><span data-stu-id="633d1-150">When you have a custom backup strategy using snapshots, copying the snapshots from one storage account to another can be slow and can consume much storage space.</span></span> <span data-ttu-id="633d1-151">Namísto kopírování celý snímek na účet úložiště záloh, můžete napsat rozdíl mezi po sobě jdoucích snímků na objekt blob stránky zálohování.</span><span class="sxs-lookup"><span data-stu-id="633d1-151">Instead of copying the entire snapshot to a backup storage account, you can write the difference between consecutive snapshots to a backup page blob.</span></span> <span data-ttu-id="633d1-152">Tímto způsobem je podstatně snížit čas pro kopírování a místa pro uložení zálohy.</span><span class="sxs-lookup"><span data-stu-id="633d1-152">This way, the time to copy and the space to store backups is substantially reduced.</span></span>

### <a name="implementing-incremental-snapshot-copy"></a><span data-ttu-id="633d1-153">Implementace přírůstkový snímek kopie</span><span class="sxs-lookup"><span data-stu-id="633d1-153">Implementing Incremental Snapshot Copy</span></span>
<span data-ttu-id="633d1-154">Pomocí těchto kroků můžete implementovat přírůstkový snímek kopie</span><span class="sxs-lookup"><span data-stu-id="633d1-154">You can implement incremental snapshot copy by doing the following,</span></span>

* <span data-ttu-id="633d1-155">Pořízení snímku základní objekt blob pomocí [snímku Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span><span class="sxs-lookup"><span data-stu-id="633d1-155">Take a snapshot of the base blob using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob).</span></span>
* <span data-ttu-id="633d1-156">Kopírování snímku do cílového úložiště pro zálohy účtu pomocí [kopírovat objekt Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span><span class="sxs-lookup"><span data-stu-id="633d1-156">Copy the snapshot to the target backup storage account using [Copy Blob](https://docs.microsoft.com/rest/api/storageservices/Copy-Blob).</span></span> <span data-ttu-id="633d1-157">Toto je objektů blob zálohy stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-157">This is the backup page blob.</span></span> <span data-ttu-id="633d1-158">Pořízení snímku objektů blob zálohy stránky a uloží jej v zálohování účtu.</span><span class="sxs-lookup"><span data-stu-id="633d1-158">Take a snapshot of the backup page blob and store it in the backup account.</span></span>
* <span data-ttu-id="633d1-159">Vytvořte nový snímek objektu blob základní pomocí snímku objektů Blob.</span><span class="sxs-lookup"><span data-stu-id="633d1-159">Take another snapshot of the base blob using Snapshot Blob.</span></span>
* <span data-ttu-id="633d1-160">Získat rozdíl mezi prvním a druhém snímkům základní objekt blob pomocí [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span><span class="sxs-lookup"><span data-stu-id="633d1-160">Get the difference between the first and second snapshots of the base blob using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges).</span></span> <span data-ttu-id="633d1-161">Použít nový parametr **prevsnapshot**, zadejte hodnotu data a času chcete získat rozdíl oproti snímku.</span><span class="sxs-lookup"><span data-stu-id="633d1-161">Use the new parameter **prevsnapshot**, to specify the DateTime value of the snapshot you want to get the difference with.</span></span> <span data-ttu-id="633d1-162">Pokud tento parametr, REST odpověď obsahuje pouze stránky, které byly změněny mezi cíl snímku a předchozího snímku, včetně zrušte stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-162">When this parameter is present, the REST response includes only the pages that were changed between target snapshot and previous snapshot including clear pages.</span></span>
* <span data-ttu-id="633d1-163">Použití [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) použití těchto změn na objekt blob stránky zálohování.</span><span class="sxs-lookup"><span data-stu-id="633d1-163">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to apply these changes to the backup page blob.</span></span>
* <span data-ttu-id="633d1-164">Nakonec pořízení snímku objektů blob zálohy stránky a uloží jej v účtu úložiště záloh.</span><span class="sxs-lookup"><span data-stu-id="633d1-164">Finally, take a snapshot of the backup page blob and store it in the backup storage account.</span></span>

<span data-ttu-id="633d1-165">V další části jsme se podrobněji popisují jak můžete spravovat zálohy disků pomocí přírůstkové kopie snímků</span><span class="sxs-lookup"><span data-stu-id="633d1-165">In the next section, we will describe in more detail how you can maintain backups of disks using Incremental Snapshot Copy</span></span>

## <a name="scenario"></a><span data-ttu-id="633d1-166">Scénář</span><span class="sxs-lookup"><span data-stu-id="633d1-166">Scenario</span></span>
<span data-ttu-id="633d1-167">V této části popisují jsme scénář, který zahrnuje vlastní strategii zálohování pro disky virtuálního počítače pomocí snímků.</span><span class="sxs-lookup"><span data-stu-id="633d1-167">In this section, we describe a scenario that involves a custom backup strategy for virtual machine disks using snapshots.</span></span>

<span data-ttu-id="633d1-168">Zvažte DS-series virtuální počítač Azure s připojený disk P30 úložiště premium.</span><span class="sxs-lookup"><span data-stu-id="633d1-168">Consider a DS-series Azure VM with a premium storage P30 disk attached.</span></span> <span data-ttu-id="633d1-169">P30 disk označuje *mypremiumdisk* je uložený v účtu úložiště premium názvem *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-169">The P30 disk called *mypremiumdisk* is stored in a premium storage account called *mypremiumaccount*.</span></span> <span data-ttu-id="633d1-170">Účet standardního úložiště s názvem *mybackupstdaccount* se použije k uložení zálohy *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="633d1-170">A standard storage account called *mybackupstdaccount* is used for storing the backup of *mypremiumdisk*.</span></span> <span data-ttu-id="633d1-171">Rádi bychom se zachovat snímek *mypremiumdisk* každých 12 hodin.</span><span class="sxs-lookup"><span data-stu-id="633d1-171">We would like to keep a snapshot of *mypremiumdisk* every 12 hours.</span></span>

<span data-ttu-id="633d1-172">Další informace o vytváření účtu úložiště a disky, najdete v tématu [účty Azure storage](../articles/storage/storage-create-storage-account.md).</span><span class="sxs-lookup"><span data-stu-id="633d1-172">To learn about creating storage account and disks, refer to [About Azure storage accounts](../articles/storage/storage-create-storage-account.md).</span></span>

<span data-ttu-id="633d1-173">Další informace o zálohování virtuálních počítačů Azure, najdete v tématu [zálohování virtuálního počítače Azure plánování](../articles/backup/backup-azure-vms-introduction.md).</span><span class="sxs-lookup"><span data-stu-id="633d1-173">To learn about backing up Azure VMs, refer to [Plan Azure VM backups](../articles/backup/backup-azure-vms-introduction.md).</span></span>

## <a name="steps-to-maintain-backups-of-a-disk-using-incremental-snapshots"></a><span data-ttu-id="633d1-174">Postup Udržovat zálohy disku pomocí přírůstkové snímků</span><span class="sxs-lookup"><span data-stu-id="633d1-174">Steps to maintain backups of a disk using incremental snapshots</span></span>
<span data-ttu-id="633d1-175">Následující kroky popisují postup pořízení snímků *mypremiumdisk* a udržovat záloh v *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-175">The following steps describe how to take snapshots of *mypremiumdisk* and maintain the backups in *mybackupstdaccount*.</span></span> <span data-ttu-id="633d1-176">Zálohování je objekt blob standardní stránky názvem *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="633d1-176">The backup is a standard page blob called *mybackupstdpageblob*.</span></span> <span data-ttu-id="633d1-177">Objekt blob zálohování stránky vždy odráží stejného stavu jako poslední snímek *mypremiumdisk*.</span><span class="sxs-lookup"><span data-stu-id="633d1-177">The backup page blob always reflects the same state as the last snapshot of *mypremiumdisk*.</span></span>

1. <span data-ttu-id="633d1-178">Vytvořte objekt blob zálohování stránky pro disk úložiště premium, tak, že pořízení snímku *mypremiumdisk* názvem *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="633d1-178">Create the backup page blob for your premium storage disk, by taking a snapshot of *mypremiumdisk* called *mypremiumdisk_ss1*.</span></span>
2. <span data-ttu-id="633d1-179">Zkopírujte tento snímek do mybackupstdaccount jako objekt blob stránky názvem *mybackupstdpageblob*.</span><span class="sxs-lookup"><span data-stu-id="633d1-179">Copy this snapshot to mybackupstdaccount as a page blob called *mybackupstdpageblob*.</span></span>
3. <span data-ttu-id="633d1-180">Pořízení snímku *mybackupstdpageblob* názvem *mybackupstdpageblob_ss1*pomocí [snímku Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) a uloží jej v *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-180">Take a snapshot of *mybackupstdpageblob* called *mybackupstdpageblob_ss1*, using [Snapshot Blob](https://docs.microsoft.com/rest/api/storageservices/Snapshot-Blob) and store it in *mybackupstdaccount*.</span></span>
4. <span data-ttu-id="633d1-181">V daném intervalu zálohování vytvořit snímek jiného *mypremiumdisk*, například *mypremiumdisk_ss2*a ukládá je v *mypremiumaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-181">During the backup window, create another snapshot of *mypremiumdisk*, say *mypremiumdisk_ss2*, and store it in *mypremiumaccount*.</span></span>
5. <span data-ttu-id="633d1-182">Získat přírůstkové změny mezi dvěma snímky *mypremiumdisk_ss2* a *mypremiumdisk_ss1*pomocí [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) na *mypremiumdisk_ ss2* s **prevsnapshot** parametr nastaven na časové razítko *mypremiumdisk_ss1*.</span><span class="sxs-lookup"><span data-stu-id="633d1-182">Get the incremental changes between the two snapshots, *mypremiumdisk_ss2* and *mypremiumdisk_ss1*, using [GetPageRanges](https://docs.microsoft.com/rest/api/storageservices/Get-Page-Ranges) on *mypremiumdisk_ss2* with the **prevsnapshot** parameter set to the timestamp of *mypremiumdisk_ss1*.</span></span> <span data-ttu-id="633d1-183">Zapište tyto přírůstkové změny do objektů blob zálohy stránky *mybackupstdpageblob* v *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-183">Write these incremental changes to the backup page blob *mybackupstdpageblob* in *mybackupstdaccount*.</span></span> <span data-ttu-id="633d1-184">Pokud jsou v přírůstkové změny odstraněné rozsahy, je potřeba smazat z objektů blob zálohy stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-184">If there are deleted ranges in the incremental changes, they must be cleared from the backup page blob.</span></span> <span data-ttu-id="633d1-185">Použití [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) k zápisu do objektů blob zálohy stránky přírůstkové změny.</span><span class="sxs-lookup"><span data-stu-id="633d1-185">Use [PutPage](https://docs.microsoft.com/rest/api/storageservices/Put-Page) to write incremental changes to the backup page blob.</span></span>
6. <span data-ttu-id="633d1-186">Pořízení snímku objektů blob zálohy stránky *mybackupstdpageblob*, volané *mybackupstdpageblob_ss2*.</span><span class="sxs-lookup"><span data-stu-id="633d1-186">Take a snapshot of the backup page blob *mybackupstdpageblob*, called *mybackupstdpageblob_ss2*.</span></span> <span data-ttu-id="633d1-187">Odstranit předchozí snímek *mypremiumdisk_ss1* z prémiový účet úložiště.</span><span class="sxs-lookup"><span data-stu-id="633d1-187">Delete the previous snapshot *mypremiumdisk_ss1* from premium storage account.</span></span>
7. <span data-ttu-id="633d1-188">Opakujte kroky 4 až 6 každých intervalu zálohování.</span><span class="sxs-lookup"><span data-stu-id="633d1-188">Repeat steps 4-6 every backup window.</span></span> <span data-ttu-id="633d1-189">Tímto způsobem můžete udržovat zálohy *mypremiumdisk* v standardní účet úložiště.</span><span class="sxs-lookup"><span data-stu-id="633d1-189">In this way, you can maintain backups of *mypremiumdisk* in a standard storage account.</span></span>

![Zálohování pomocí přírůstkové snímků disku](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-1.png)

## <a name="steps-to-restore-a-disk-from-snapshots"></a><span data-ttu-id="633d1-191">Postup obnovení disku ze snímků</span><span class="sxs-lookup"><span data-stu-id="633d1-191">Steps to restore a disk from snapshots</span></span>
<span data-ttu-id="633d1-192">Následující kroky popisují, jak obnovit premium disk *mypremiumdisk* na dřívějším snímkem z účtu úložiště pro zálohy *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-192">The following steps, describe how to restore the premium disk, *mypremiumdisk* to an earlier snapshot from the backup storage account *mybackupstdaccount*.</span></span>

1. <span data-ttu-id="633d1-193">Identifikujte bod v čase, kterou chcete obnovit premium disk.</span><span class="sxs-lookup"><span data-stu-id="633d1-193">Identify the point in time that you wish to restore the premium disk to.</span></span> <span data-ttu-id="633d1-194">Řekněme, že je snímek *mybackupstdpageblob_ss2*, který je uložený v účtu úložiště pro zálohy *mybackupstdaccount*.</span><span class="sxs-lookup"><span data-stu-id="633d1-194">Let's say that it is snapshot *mybackupstdpageblob_ss2*, which is stored in the backup storage account *mybackupstdaccount*.</span></span>
2. <span data-ttu-id="633d1-195">V mybackupstdaccount, zvýšení úrovně snímku *mybackupstdpageblob_ss2* jako nový objekt blob zálohování základní stránky *mybackupstdpageblobrestored*.</span><span class="sxs-lookup"><span data-stu-id="633d1-195">In mybackupstdaccount, promote the snapshot *mybackupstdpageblob_ss2* as the new backup base page blob *mybackupstdpageblobrestored*.</span></span>
3. <span data-ttu-id="633d1-196">Pořízení snímku tento objekt blob stránky obnovené zálohy, nazývá *mybackupstdpageblobrestored_ss1*.</span><span class="sxs-lookup"><span data-stu-id="633d1-196">Take a snapshot of this restored backup page blob, called *mybackupstdpageblobrestored_ss1*.</span></span>
4. <span data-ttu-id="633d1-197">Kopírovat objekt blob obnovené stránky *mybackupstdpageblobrestored* z *mybackupstdaccount* k *mypremiumaccount* jako nový disk premium *mypremiumdiskrestored*.</span><span class="sxs-lookup"><span data-stu-id="633d1-197">Copy the restored page blob *mybackupstdpageblobrestored* from *mybackupstdaccount* to *mypremiumaccount* as the new premium disk *mypremiumdiskrestored*.</span></span>
5. <span data-ttu-id="633d1-198">Pořízení snímku *mypremiumdiskrestored*, volané *mypremiumdiskrestored_ss1* pro provedení budoucí přírůstkové zálohování.</span><span class="sxs-lookup"><span data-stu-id="633d1-198">Take a snapshot of *mypremiumdiskrestored*, called *mypremiumdiskrestored_ss1* for making future incremental backups.</span></span>
6. <span data-ttu-id="633d1-199">Bodu řady DS virtuální počítač obnovený disk *mypremiumdiskrestored* a odpojit starý *mypremiumdisk* z virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="633d1-199">Point the DS series VM to the restored disk *mypremiumdiskrestored* and detach the old *mypremiumdisk* from the VM.</span></span>
7. <span data-ttu-id="633d1-200">Zahájit proces zálohování popsané v předchozí části pro obnovené disk *mypremiumdiskrestored*pomocí *mybackupstdpageblobrestored* jako objekt blob zálohování stránky.</span><span class="sxs-lookup"><span data-stu-id="633d1-200">Begin the Backup process described in previous section for the restored disk *mypremiumdiskrestored*, using the *mybackupstdpageblobrestored* as the backup page blob.</span></span>

![Obnovení disku ze snímků](../articles/virtual-machines/windows/media/incremental-snapshots/storage-incremental-snapshots-2.png)

## <a name="next-steps"></a><span data-ttu-id="633d1-202">Další kroky</span><span class="sxs-lookup"><span data-stu-id="633d1-202">Next Steps</span></span>
<span data-ttu-id="633d1-203">Další informace o vytváření snímků objektu blob a plánování infrastruktury zálohování virtuálních počítačů pomocí následujících odkazů.</span><span class="sxs-lookup"><span data-stu-id="633d1-203">Use the following links to learn more about creating snapshots of a blob and planning your VM backup infrastructure.</span></span>

* [<span data-ttu-id="633d1-204">Vytvoření snímku objektu Blob</span><span class="sxs-lookup"><span data-stu-id="633d1-204">Creating a Snapshot of a Blob</span></span>](https://docs.microsoft.com/rest/api/storageservices/Creating-a-Snapshot-of-a-Blob)
* [<span data-ttu-id="633d1-205">Plánování vaší infrastruktury zálohování virtuálních počítačů</span><span class="sxs-lookup"><span data-stu-id="633d1-205">Plan your VM Backup Infrastructure</span></span>](../articles/backup/backup-azure-vms-introduction.md)


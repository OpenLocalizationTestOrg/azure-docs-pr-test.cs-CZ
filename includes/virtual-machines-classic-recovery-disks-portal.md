<span data-ttu-id="9fd79-101">Pokud na vašem virtuálním počítači v Azure dochází k chybám spouštění nebo disku, možná bude nutné provést postup při řešení potíží na samotném virtuálním pevném disku.</span><span class="sxs-lookup"><span data-stu-id="9fd79-101">If your virtual machine (VM) in Azure encounters a boot or disk error, you may need to perform troubleshooting steps on the virtual hard disk itself.</span></span> <span data-ttu-id="9fd79-102">Běžným příkladem je aktualizace aplikace, která selhala a brání úspěšnému spuštění virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="9fd79-102">A common example would be a failed application update that prevents the VM from booting successfully.</span></span> <span data-ttu-id="9fd79-103">Tento článek popisuje, jak pomocí webu Azure Portal připojit virtuální pevný disk k jinému virtuálnímu počítači, opravit všechny chyby a potom znovu vytvořit původní virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="9fd79-103">This article describes how to use Azure portal to connect your virtual hard disk to another VM to fix any errors and then re-create your original VM.</span></span>

## <a name="recovery-process-overview"></a><span data-ttu-id="9fd79-104">Přehled procesu obnovení</span><span class="sxs-lookup"><span data-stu-id="9fd79-104">Recovery process overview</span></span>
<span data-ttu-id="9fd79-105">Proces řešení potíží je následující:</span><span class="sxs-lookup"><span data-stu-id="9fd79-105">The troubleshooting process is as follows:</span></span>

1. <span data-ttu-id="9fd79-106">Odstranění virtuálního počítače, na kterém dochází k chybám, při zachování virtuálních pevných disků.</span><span class="sxs-lookup"><span data-stu-id="9fd79-106">Delete the VM that's encountering issues, but retain the virtual hard disks.</span></span>
2. <span data-ttu-id="9fd79-107">Připojení virtuálního pevného disku k jinému virtuálnímu počítači pro účely řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-107">Attach and mount the virtual hard disk to another VM for troubleshooting.</span></span>
3. <span data-ttu-id="9fd79-108">Připojení k virtuálnímu počítači pro řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-108">Connect to the troubleshooting VM.</span></span> <span data-ttu-id="9fd79-109">Opravení chyb na původním virtuálním pevném disku pomocí upravení souborů nebo spuštění nástrojů.</span><span class="sxs-lookup"><span data-stu-id="9fd79-109">Edit files or run tools to fix errors on the original virtual hard disk.</span></span>
4. <span data-ttu-id="9fd79-110">Odpojení virtuálního pevného disku od virtuálního počítače pro řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-110">Unmount and detach the virtual hard disk from the troubleshooting VM.</span></span>
5. <span data-ttu-id="9fd79-111">Vytvoření virtuálního počítače s použitím původního virtuálního pevného disku.</span><span class="sxs-lookup"><span data-stu-id="9fd79-111">Create a VM by using the original virtual hard disk.</span></span>

## <a name="delete-the-original-vm"></a><span data-ttu-id="9fd79-112">Odstranění původního virtuálního počítače</span><span class="sxs-lookup"><span data-stu-id="9fd79-112">Delete the original VM</span></span>
<span data-ttu-id="9fd79-113">Virtuální pevné disky a virtuální počítače jsou v Azure dva různé prostředky.</span><span class="sxs-lookup"><span data-stu-id="9fd79-113">Virtual hard disks and VMs are two distinct resources in Azure.</span></span> <span data-ttu-id="9fd79-114">Virtuální pevný disk je úložištěm operačního systému, aplikací a konfigurací.</span><span class="sxs-lookup"><span data-stu-id="9fd79-114">A virtual hard disk is where the operating system, applications, and configurations are stored.</span></span> <span data-ttu-id="9fd79-115">Virtuální počítač tvoří jenom metadata, která definují velikost nebo umístění a odkazují na prostředky, jako jsou virtuální pevný disk nebo virtuální síťová karta.</span><span class="sxs-lookup"><span data-stu-id="9fd79-115">The VM is just metadata that defines the size or location and that references resources such as a virtual hard disk or virtual network interface card (NIC).</span></span> <span data-ttu-id="9fd79-116">Každému virtuálnímu pevnému disku se při připojení k virtuálnímu počítači přiřadí zapůjčení.</span><span class="sxs-lookup"><span data-stu-id="9fd79-116">Each virtual hard disk gets a lease assigned when that disk is attached to a VM.</span></span> <span data-ttu-id="9fd79-117">Přestože datové disky je možné připojovat a odpojovat dokonce i za běhu virtuálního počítače, disk s operačním systémem není možné odpojit, dokud se neodstraní prostředek virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="9fd79-117">Although data disks can be attached and detached even while the VM is running, the OS disk cannot be detached unless the VM resource is deleted.</span></span> <span data-ttu-id="9fd79-118">Zapůjčení nadále přidružuje disk s operačním systémem k virtuálnímu počítači dokonce i když je virtuální počítač v zastaveném a uvolněném stavu.</span><span class="sxs-lookup"><span data-stu-id="9fd79-118">The lease continues to associate the OS disk to a VM even when that VM is in a stopped and deallocated state.</span></span>

<span data-ttu-id="9fd79-119">Prvním krokem k obnovení virtuálního počítače je odstranění samotného prostředku virtuálního počítače.</span><span class="sxs-lookup"><span data-stu-id="9fd79-119">The first step to recovering your VM is to delete the VM resource itself.</span></span> <span data-ttu-id="9fd79-120">Když odstraníte virtuální počítač, virtuální pevné disky zůstanou ve vašem účtu úložiště.</span><span class="sxs-lookup"><span data-stu-id="9fd79-120">Deleting the VM leaves the virtual hard disks in your storage account.</span></span> <span data-ttu-id="9fd79-121">Po odstranění virtuálního počítače můžete připojit virtuální pevný disk k jinému virtuálnímu počítači za účelem řešení a odstranění problémů.</span><span class="sxs-lookup"><span data-stu-id="9fd79-121">After the VM is deleted, you can attach the virtual hard disk to another VM to troubleshoot and resolve the errors.</span></span> 

1. <span data-ttu-id="9fd79-122">Přihlaste se k webu [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="9fd79-122">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="9fd79-123">V nabídce na levé straně klikněte na **Virtuální počítače (Classic)**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-123">On the menu on the left side, click **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="9fd79-124">Vyberte virtuální počítač, u kterého dochází k problému, klikněte na **Disky** a potom najděte název virtuálního pevného disku.</span><span class="sxs-lookup"><span data-stu-id="9fd79-124">Select the VM that has the problem, click **Disks**, and then identify the name of the virtual hard disk.</span></span> 
4. <span data-ttu-id="9fd79-125">Vyberte virtuální pevný disk s operačním systémem a zkontrolujte **Umístění**, abyste identifikovali účet úložiště, který tento pevný disk obsahuje.</span><span class="sxs-lookup"><span data-stu-id="9fd79-125">Select the OS virtual hard disk and check the **Location** to identify the storage account that contains that virtual hard disk.</span></span> <span data-ttu-id="9fd79-126">V následujícím příkladu je název účtu úložiště řetězec bezprostředně před „.blob.core.windows.net“.</span><span class="sxs-lookup"><span data-stu-id="9fd79-126">In the following example, the string immediately before ".blob.core.windows.net" is the storage account name.</span></span>

    ```
    https://portalvhds73fmhrw5xkp43.blob.core.windows.net/vhds/SCCM2012-2015-08-28.vhd
    ```

    ![Obrázek s umístěním virtuálního počítače](./media/virtual-machines-classic-recovery-disks-portal/vm-location.png)

5. <span data-ttu-id="9fd79-128">Klikněte pravým tlačítkem na virtuální počítač a vyberte **Odstranit**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-128">Right-click the VM and then select **Delete**.</span></span> <span data-ttu-id="9fd79-129">Při odstraňování virtuálního počítače se ujistěte, že nejsou vybrané disky.</span><span class="sxs-lookup"><span data-stu-id="9fd79-129">Make sure that the disks are not selected when you delete the VM.</span></span>
6. <span data-ttu-id="9fd79-130">Vytvořte nový virtuální počítač pro obnovení.</span><span class="sxs-lookup"><span data-stu-id="9fd79-130">Create a new recovery VM.</span></span> <span data-ttu-id="9fd79-131">Tento virtuální počítač musí být ve stejné oblasti a skupině prostředků (cloudová služba) jako problémový virtuální počítač.</span><span class="sxs-lookup"><span data-stu-id="9fd79-131">This VM must be in the same region and resource group (Cloud Service) as the problem VM.</span></span>
7. <span data-ttu-id="9fd79-132">Vyberte virtuální počítač pro obnovení a potom vyberte **Disky** > **Připojit stávající**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-132">Select the recovery VM, and then select **Disks** > **Attach Existing**.</span></span>
8. <span data-ttu-id="9fd79-133">Klikněte na **Soubor VHD** a vyberte váš existující virtuální pevný disk:</span><span class="sxs-lookup"><span data-stu-id="9fd79-133">To select your existing virtual hard disk, click **VHD File**:</span></span>

    ![Vyhledání existujícího VHD procházením](./media/virtual-machines-classic-recovery-disks-portal/select-vhd-location.png)

9. <span data-ttu-id="9fd79-135">Vyberte účet úložiště > kontejner VHD > virtuální pevný disk a kliknutím na **Vybrat** potvrďte výběr.</span><span class="sxs-lookup"><span data-stu-id="9fd79-135">Select the storage account > VHD container > the virtual hard disk, click the **Select** button to confirm your choice.</span></span>

    ![Výběr existujícího VHD](./media/virtual-machines-classic-recovery-disks-portal/select-vhd.png)

10. <span data-ttu-id="9fd79-137">Když je teď vybrán váš VHD, kliknutím na **OK** připojte existující virtuální pevný disk.</span><span class="sxs-lookup"><span data-stu-id="9fd79-137">With your VHD now selected, select **OK** to attach the existing virtual hard disk.</span></span>
11. <span data-ttu-id="9fd79-138">Po několika sekundách se v podokně **Disky** pro váš virtuální počítač zobrazí existující virtuální pevný disk připojený jako datový disk:</span><span class="sxs-lookup"><span data-stu-id="9fd79-138">After a few seconds, the **Disks** pane for your VM will display your existing virtual hard disk connected as a data disk:</span></span>

    ![Existující virtuální pevný disk připojený jako datový disk](./media/virtual-machines-classic-recovery-disks-portal/attached-disk.png)

## <a name="fix-issues-on-the-original-virtual-hard-disk"></a><span data-ttu-id="9fd79-140">Oprava problémů na původním virtuálním pevném disku</span><span class="sxs-lookup"><span data-stu-id="9fd79-140">Fix issues on the original virtual hard disk</span></span>
<span data-ttu-id="9fd79-141">Když je existující virtuální pevný disk připojený, můžete podle potřeby provádět libovolné kroky údržby a řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-141">When the existing virtual hard disk is mounted, you can now perform any maintenance and troubleshooting steps as needed.</span></span> <span data-ttu-id="9fd79-142">Jakmile vyřešíte problémy, pokračujte následujícími kroky.</span><span class="sxs-lookup"><span data-stu-id="9fd79-142">Once you have addressed the issues, continue with the following steps.</span></span>

## <a name="unmount-and-detach-the-original-virtual-hard-disk"></a><span data-ttu-id="9fd79-143">Odpojení původního virtuálního pevného disku</span><span class="sxs-lookup"><span data-stu-id="9fd79-143">Unmount and detach the original virtual hard disk</span></span>
<span data-ttu-id="9fd79-144">Po vyřešení všech chyb odpojte existující virtuální pevný disk od virtuálního počítače pro řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-144">Once any errors are resolved, unmount and detach the existing virtual hard disk from your troubleshooting VM.</span></span> <span data-ttu-id="9fd79-145">Virtuální pevný disk nebude možné použít s žádným jiným virtuálním počítačem, dokud se neuvolní zapůjčení, které virtuální pevný disk připojuje k virtuálnímu počítači pro řešení potíží.</span><span class="sxs-lookup"><span data-stu-id="9fd79-145">You cannot use your virtual hard disk together with any other VM until the lease that attaches the virtual hard disk to the troubleshooting VM is released.</span></span>  

1. <span data-ttu-id="9fd79-146">Přihlaste se k webu [Azure Portal](https://portal.azure.com).</span><span class="sxs-lookup"><span data-stu-id="9fd79-146">Sign in to the [Azure portal](https://portal.azure.com).</span></span> 
2. <span data-ttu-id="9fd79-147">V nabídce na levé straně vyberte **Virtuální počítače (Classic)**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-147">On the menu on the left side, select **Virtual Machines (classic)**.</span></span>
3. <span data-ttu-id="9fd79-148">Vyhledejte virtuální počítač pro obnovení.</span><span class="sxs-lookup"><span data-stu-id="9fd79-148">Locate the recovery VM.</span></span> <span data-ttu-id="9fd79-149">Vyberte Disky, klikněte pravým tlačítkem na disk a potom vyberte **Odpojit**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-149">Select Disks, right-click the disk, and then select **Detach**.</span></span>

## <a name="create-a-vm-from-the-original-hard-disk"></a><span data-ttu-id="9fd79-150">Vytvoření virtuálního počítače z původního pevného disku</span><span class="sxs-lookup"><span data-stu-id="9fd79-150">Create a VM from the original hard disk</span></span>

<span data-ttu-id="9fd79-151">K vytvoření virtuálního počítače ze svého původního virtuálního pevného disku použijte [portál Azure Classic](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="9fd79-151">To create a VM from your original virtual hard disk, use [Azure classic portal](https://manage.windowsazure.com).</span></span>

1. <span data-ttu-id="9fd79-152">Přihlaste se k [portálu Azure Classic](https://manage.windowsazure.com).</span><span class="sxs-lookup"><span data-stu-id="9fd79-152">Sign into [Azure classic portal](https://manage.windowsazure.com).</span></span>
2. <span data-ttu-id="9fd79-153">V dolní části portálu vyberte **Nový** > **Compute** > **Virtuální počítač** > **Z galerie**.</span><span class="sxs-lookup"><span data-stu-id="9fd79-153">At the bottom of the portal, select **New** > **Compute** > **Virtual Machine** > **From Gallery**.</span></span>
3. <span data-ttu-id="9fd79-154">V části **Zvolit image** vyberte **Moje disky** a potom vyberte původní virtuální pevný disk.</span><span class="sxs-lookup"><span data-stu-id="9fd79-154">In the **Choose an Image** section, select **My disks**, and then select the original virtual hard disk.</span></span> <span data-ttu-id="9fd79-155">Zkontrolujte informace o umístění.</span><span class="sxs-lookup"><span data-stu-id="9fd79-155">Check the location information.</span></span> <span data-ttu-id="9fd79-156">To je oblast, ve které musí být virtuální počítač nasazen.</span><span class="sxs-lookup"><span data-stu-id="9fd79-156">This is the region where the VM must be deployed.</span></span> <span data-ttu-id="9fd79-157">Klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="9fd79-157">Select the next button.</span></span>
4. <span data-ttu-id="9fd79-158">V části **Konfigurace virtuálního počítače** zadejte název virtuálního počítače a vyberte jeho velikost.</span><span class="sxs-lookup"><span data-stu-id="9fd79-158">In the **Virtual machine configuration** section, type the VM name and select a size for the VM.</span></span>